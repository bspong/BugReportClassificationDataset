Repository does not release all resources on shutdown
When Jackrabbit is shutdown some java.util.Timer threads are still running in the background even though no tasks are scheduled. This prevents the GC from collecting the classes when Jackrabbit is redeployed within a web application.Jackrabbit now uses a custom Timer class which wraps the java.util.Timer. When there are no tasks scheduled the wrapped java.util.Timer is canceled which effectively terminates the background thread. Fixed in revision 467292What classes are these changes in I d like to packport to 1.1 if possible. What classes are these changes in I d like to packport to 1.1 if possible. See http svn.apache.org viewvc view rev revision 467292 for the changes. The link should also appear on the All and Subversion Commits tabs of this page in a short while as the SVN-Jira integration does it s magic.I tried backporting to 1.1 but it doesn t seem to fix it. Are there other classes that keep on running There s a problem attaching screenshots to this issue..Loaded class count view of tomcat instance after multiple redeployments of webapp with modified jackrabbit core jar.Ditto permgen view.You are right. My test didn t involve a login. I simply re-deployed the jackrabbit-server.war. There is still a commit log thread local which holds a strong reference to a jackrabbit class preventing the GC from collecting the WebappClassLoader.Second attempt Fixed in revision http svn.apache.org viewvc view rev revision 469412It still doesn t work. Are there other classes that needs modification in jackrabbit 1.1 I ve seen that there are threads used in other classes as well eg RepositoryImpl TransientFileFactory ObservationDispatcher and others.What operations do you perform before you re-deploy the web application It works for me when I do a login read a couple of items and logout again.I tried with both a 1.1 with the patches attached and a fresh svn snapshot from Nov 28th 06 and I still see permgen growing without bounds. The code I use is simply public void contextInitialized ServletContextEvent event          set up repository         try             String rootDirectory String ConfigManager.getEnvironmentEntry jackrabbit directory             String configFile String ConfigManager.getEnvironmentEntry jackrabbit configfile             if configFile.indexOf WEB-INF 0                 log.debug loading repository config from web application context root configFile                 URL url event.getServletContext .getResource configFile                 InputStream repositoryXml event.getServletContext .getResourceAsStream configFile                 RepositoryConfig config RepositoryConfig.create repositoryXml rootDirectory                 repository new TransientRepository config              else                 repository new TransientRepository configFile rootDirectory                                       Session session repository.login new SystemCredentials             session.logout                       catch Exception e             log.error unable to configure Jackrabbit repository e               I ve done a bit more testing and it does in-fact seem to work properly now so I guess this issue can be resolved as fixed.
