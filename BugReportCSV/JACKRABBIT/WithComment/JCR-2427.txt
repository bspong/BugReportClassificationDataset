UUIDDocId.getDocumentNumbers may return illegal value
Happens when the node with the given UUID is not present in the index. The method then returns -1 which is illegal. Document numbers must be 0. The method must returns an empty array when the id is invalid as documented in DocId.getDocumentNumbers .Fixed in revision 888419Any chance we could get a fix for this in the 1.6 branch We are experiencing this problem on production systems running v1.6 of Jackrabbit so would also appreciate a backport of the fix into the 1.6 stream.We need this for 1.6 as well. It looks like the backport would be easy - if itemState.isNode - def itemMgr.getDefinition NodeState itemState .unwrap - else - def itemMgr.getDefinition PropertyState itemState .unwrap try if itemState.isNode def itemMgr.getDefinition NodeState itemState .unwrap else def itemMgr.getDefinition PropertyState itemState .unwrap catch ConstraintViolationException e since identifier of assigned definition is not stored anymore with item state see JCR-2170 correct definition cannot be determined for items which have been removed due to removal of a mixin see also JCR-2130 JCR-2408 continue Merged to the 1.6 branch in revision 1174823.We just faced this issue with Magnolia CMS running on Jackrabbit 1.6.4. We ran consistency check on the affected repository and restarted Jackrabbit. Consistency check found a bunch of errors it could not fix orphaned nodes mainly but nothing else obvious was reported . The exception has disappeared since. Is there any way to reproduce this We have seen this before so need to understand when how it happens so we can decide a way to proceed.
