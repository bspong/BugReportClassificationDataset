Removal of a node with shared subnodes fails
A simple testcase Set up first transaction Node a1 testRootNode.addNode a1 Node a2 testRootNode.addNode a2 a2.addMixin mix shareable session.save now we have a shareable node N with path a2 Workspace workspace session.getWorkspace String path a1.getPath b1 workspace.clone workspace.getName a2.getPath path false session.save now we have another shareable node N in the same shared set as N with path a1 b1 Test second transaction testRootNode.remove a1 session.save At least in a transactional repository the node will not be removed an error will be thrown instead.The first patch prevents that an event is fired on the remove of a share when the parent node of the share was also deleted. The second patch allows the correct calculation of the depth of a transient node even if the parent node is removed and in the attic.A small update for better performance.Here comes the complete TestCase - Removal of a share must not be ignored otherwise the index will get inconsistent. See attached patch.Applied latest patch in revision 805702 Thanks a lot for reporting this issue.
