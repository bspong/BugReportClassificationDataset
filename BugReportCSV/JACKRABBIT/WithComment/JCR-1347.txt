Move Jackrabbit Query Parser from core to spi-commons
The query parser can be used outside jackrabbit-core for instances in other repository implementations based on JCR2SPI. Proposal - move source and build infrastructure from o.a.j.core.query to o.a.j.spi.commons.query - switch over jackrabbit.core to use spi-commons for query - optimally add specific test cases for the query tree generation.I just tried this and some of the code used by qom has dependencies on SessionImpl which is not the case for xpath sql . So either we get rid of these dependencies first or we need to restrict the move to those parts JSR170 that actually can be moved. I d prefer to remove the SessionImpl dependencies.Me too see JCR-1378.Marcel thanks for the fixes but qom jsr283 still seem to have dependencies. Proposed change adds JSR-170 query parsers e.g. just XPath and SQL plus the QueryTree code in spi-commons.Moved XPATH and SQL parsers and Query Tree Builder into spi-commons see revisions 628742 628755 628779 628787 628790 Left to do move over QOM and JSR283 parts Marcel do you want to do those Marcel do you want to do those I will take care of it.Copied jsr283.qom qom and sql2 to jackrabbit-spi-commons. svn revision 629123 Adapted packages in revision 629124Removed now obsolete packages from jackrabbit-core. Modify sources to use classes in jackrabbit-spi-commons. svn revision 629125Forgot to adapt some of the package names. Fixed in revision 629877 and 629878There are some more problems with package names being broken because of the package move. Can you be a bit more specific I ve looked through the package names again and they seem to be OK.Ah I missed to say in the javadoc . I fixed some in revision 630195. There maybe some left in sql2 qom. You probably need to run javadoc and grep for core.query in the error messages.
