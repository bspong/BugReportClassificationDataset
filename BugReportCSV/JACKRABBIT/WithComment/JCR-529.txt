New versions added after a restore have bad version name
I add several versions to a node 1.0 1.1 1.2 1.3 1.4 . Perform a restore to version 1.2 and add more versions. After that VersionHistory is like this - 1.0 - 1.1 - 1.2 - 1.3 - 1.4 - 1.3.1 - 1.3.2 - 1.3.3 - 1.3.4 - 1.3.5 New versions should be 1.2.x no 1.3.x isn t it This is a test case.i vaguely remeber a similar bug....what version of jackrabbit are you using the recent checkout Yes I updated Jackarbbit source code yesterday. There is a test case attached if you wan t to test it.I am the only affected by this issue This is my patch for this issue. With this modification the versions are correctly named.fixed as suggested. Committed revision 486694.It seems that after applying patch test org.apache.jackrabbit.core.XATest. testXAVersionsThoroughly fails. junit.framework.ComparisonFailure checkin N1 uncommitted. Version Name expected 1.1.1 but was 1.0.1 at junit.framework.Assert.assertEquals Assert.java 81 at org.apache.jackrabbit.core.XATest.check XATest.java 1140 at org.apache.jackrabbit.core.XATest.testXAVersionsThoroughly XATest.java 1080 at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39 at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25 at java.lang.reflect.Method.invoke Method.java 585 at junit.framework.TestCase.runTest TestCase.java 154 at org.apache.jackrabbit.core.XATest.runTest XATest.java 96 at junit.framework.TestCase.runBare TestCase.java 127 at junit.framework.TestResult 1.protect TestResult.java 106 at junit.framework.TestResult.runProtected TestResult.java 124 at junit.framework.TestResult.run TestResult.java 109 at junit.framework.TestCase.run TestCase.java 118 at org.apache.jackrabbit.test.AbstractJCRTest.run AbstractJCRTest.java 393 at junit.framework.TestSuite.runTest TestSuite.java 208 at junit.framework.TestSuite.run TestSuite.java 203 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests RemoteTestRunner.java 474 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run RemoteTestRunner.java 342 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main RemoteTestRunner.java 194 need to validate testsFrom my point of view the test should check check v1 3 phase 1.0.1 0 And not check v1 3 phase 1.1.1 0 imo this should be the indented behaviour 1.0 Ê 1.1 Ê 1.2 Ê 1.3 1.2.0 1.2.0.0 Ê 1.4 1.2.1 Ê 1.5 1.2.2 1.2.1.0 Ê 1.6 1.2.1.1 so if you restored to 1.2 and 1.3 already exists make a 1.2.0 on checkin since it s the root version of the new branch of the 1.2 version. opinions well the above ascii art did not really work in jira - will attach a file. Version GraphYes I think you are rigth.Marking this for 1.2. Either the unit test or the code needs to be fixed before the release.Committed revision 488639.fixed tests.
