better diagnostics when version storage is broken
In InternalVersionManagerBase the code doesn t do a null-check on the predecessors property assuming it ll always be present. When this is not the case due to a repository problem we ll see a NPE. Proposal add code that generates a more meaningful error message making it easier to debug in production.Proposed change jackrabbit-core src main java org apache jackrabbit core version InternalVersionManagerBase.java revision 1176889 jackrabbit-core src main java org apache jackrabbit core version InternalVersionManagerBase.java working copy -681 6 681 13           else               1. search a predecessor suitable for generating the new name              InternalValue values node.getPropertyValues NameConstants.JCR PREDECESSORS if values null String message mandatory jcr predecessors property missing on node.getNodeId log.error message throw new VersionException message              for InternalValue value values                  InternalVersion pred history.getVersion value.getNodeId                  if best null is VersionException the right one here Maybe create a new exception reserved for case of inconsistent persistence state fixed in trunk with r1177249Removed 2.2.9 fix version already released .With r1177249Fixed in 2.2 with r1177546.
