Issue while loading list of classes at that path itself.
Hi I cannot retrieve list of objects that are directly under the path that they were saved in. I did not know where to simulate this issue and hence I have used DigesterSimpleQueryTest. I have attached the path for the newly added test case testObjectListRetrievalAtBasePath. In case the patch is not up to the mark I have attached the modified file too. Instead of creating Page in test if I create it in sample test and search in sample test it returns nothing but if I search in sample it would return the object. Another important point here is that it is causing issues while retrieving Page class the other test cases that are retrieving Paragraph class embedded inside Page class are still working fine Regards KaizerPatch for a new method of getObjects Class path in OCMThanks but the unit test failed. Can you review your patch for the unit test DigesterSimpleQueryTest and add a new one for the new method getObjectsI have removed the earlier file. I have attached a new zip file JCR-1198.zip which contains the patch JCR-1198.patch and also the source files. The patch also includes the test method testGetObjectsByClassNameAndPath which tests the new method added in OCM. In case of any issues in patch let me know. Since we are in different timezones it would take time to respond back to you. I am not convinced that the code in ObjectContentManager is correct. Extract from my earlier mail so that it is recorded as part of this issue id. - forming of jcrExpression in ObjectContentManagerImpl instead of QueryManager - It will retrieve objects in that path only basically no objects from child nodes are retrieved. Ideally in getObjects I would have formed a Query object and called the method of QueryManager to get the jcrExpression. The reason I could not do it right now is because the way query behaves for objects stored directly under that path. If there is any other idea or suggestion to change this then let me know and I can contribute a patch. Patch applied. Thanks. I changed the jcr expression in the method getObjects otherwise it doesn t work. We have to use and not  Let me know if you are agree with that change. I also change the unit test to add more tests. Tomorrow I will refactor the getObjects impl to use the Query object. I would like also to make public the method getObjects String jcrExpression String language . What do you think about that I had changed the getObjects method to check if the parent path is and if so set it to so that the expression wouldnt become element . But if the path is some test then the parent path would be some in which case the jcr expression should be some element . But if we use wouldnt the expression then become some element If the getObjects method uses a Query object we ll again be faced with the same scenario as the way the QueryManagerImpl builds the jcrExpression does not retrieve objects stored directly under the given path. This is why i feel that perhaps it is Jackrabbits implementation that may be incorrect. Yes i think its a good idea to include the method getObjects String jcrExpression String language . Concerning the Query object it has to manage the node name to make this kind of query. I will review your patch this week-end. anyway the query support in the OCM is not ideal. We should refactor later this part depending the community feedbackKaiser I think the problem is solved. Is it ok for you Did you review the code thanksHi I had a look at the code and it does solve our problem. The test case works perfectly fine. It s a good idea to have the node name in the Filter. Ideally i d have liked the splitting of the path into the scope and the node name that is currently in ObjectContentManager to be part of QueryManagerImpl but i dont think it can be done as then the search would be restricted to that path itself and not its children. I think this issue can be marked as fixed now. Thanks a lot for your help KaizerThanks for the feedback FYI we will maybe refactor the OCM query implementation depending on the community feedback.Hi Please let me know if we would we be getting this fix as part of release 1.4 as it s very important for my project. Thanks.It seems that the original problem still persists. When I verified I checked for objects in that node only and another test case which checked for anywhere in the child. But for query to retrieve objects in current node or anywhere in child self-or-descendant-axis it does not retrieve the objects of current node - . TestGetObjectsAnywhereInPath.patch demonstrates what I have stated above. Is there a way to form a Query in such a way that it retrieves objects from current node and also from its child nodes.This issue seems to be bigger than I thought. Right now objects are retrieved just below one level of the scope set. E.g. after applying the patch TestGetObjectsAnywhereInPath.patch in the method if we change the scope from folder test to folder it just retrieves 4 objects and does not retrieve the one under folder test test1. This has happened after this issue was fixed. In QueryManagerImpl.buildJCRExpression method if I change         if filter.getScope null filter.getScope .equals             jcrExp jcr root filter.getScope element filter.getNodeName          to         if filter.getScope null filter.getScope .equals             if filter.getNodeName .equals filter.getScope .equals                 filter.setScope filter.getScope             jcrExp jcr root filter.getScope element filter.getNodeName          it works fine. Although this looks more like a hack to me but nevertheless all the test cases including new one pass. If there is a better way to accomplish this not changing QueryManagerImpl code then do let me know.Changed the fix versions to 1.4 as this is quite critical part for my project
