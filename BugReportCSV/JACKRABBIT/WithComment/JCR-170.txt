VirtualItemStates of node types definitions not accessible with uuid
The VirtualNodeTypeStateProvider that maps node type definitions into the workspace under jcr system jcr nodeTypes does not implement the methods - internalGetNodeState NodeId id - internalHasNodeState NodeId id This has the effect that ItemStates that reflect node type definitions are not accessible directly with their uuid.all the virtually mapped nodestates are initialized on startup or on registration of new nodetypes. the mechanism is a bit obscure but the createNodeTypeState method calls the createNodeState method of the AbstractVISProvider which puts the newly created state into its cache. the cache is basically implemented with a soft-ref hashmap so the items could disapear. to prevent this they are also added as hard reference to the parent node state. imo the internalGetNodeState and internalHasNodeState should never be called since the items should retain in the cache for ever. as soon as the cache implementation in the AbstractVISProvider changes we might reconsider this issue.I see. However the nodes are not cached on startup but only when the root node of the virtual node type hierarchy is accessed for the first time. A quick dirty fix that worked for me was Index VirtualNodeTypeStateProvider.java VirtualNodeTypeStateProvider.java revision 219171 VirtualNodeTypeStateProvider.java working copy -58 6 58 11      public VirtualNodeTypeStateProvider NodeTypeRegistry ntReg String rootNodeId String parentId          super ntReg new NodeId rootNodeId          this.parentId parentId try getRootState catch ItemStateException e ignore               But there is certainly a more elegant solution to this.fixed using marcels aproach. Author tripod Date Mon Jul 18 04 09 39 2005 New Revision 219466 URL http svn.apache.org viewcvs rev 219466 view rev Log JCR-170 VirtualItemStates of node types definitions not accessible with uuid Modified    incubator jackrabbit trunk core src java org apache jackrabbit core nodetype virtual VirtualNodeTypeStateProvider.java
