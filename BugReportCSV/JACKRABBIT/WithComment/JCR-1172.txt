Better MimeType Handling
After saving a Excel File through WebDAV the mimetype will be changed. The mimetype for a Win2000 Exel File is application vnd.ms-excel. This will be changed to application msexcel. Also problems makes the new office 07 format docx xlsx pptx . They will also be changed to application octet-stream default mimetype . We have a lot of file types that we store in jackrabbit that are not in the properties file MSInfoPath- OutlookMsg- MsAccess-Files ... I think it will be better to let the mimetype property untouched if a mimetype is present so we must not put all the possible mimetypes in the property file. BR clausIs my assumption correct that After saving a... means that you modify an existing resource and that the mimetype was original after creating the resource correct in this case the change you propose is Modify DefaultHandler.java in order not to set the jcr mimeType property if is already present. The drawback would be that the mimetype will not be adjusted even if the file node gets replaced by a file with a different mimetype. For that - maybe not realistic - case the used would have to remove the resource and add the replacement. if that is would you are looking for and if you consider the drawback as negligible i will make that modification. kind regards angela regarding the mimetypes.properties file i think it would be wise to allow for some extension mechanism via the configuration. the only think that inhibited me from doing so was the static nature of the MimeResolver and the IOUtil which are not connected the dav servlet and its config ... ideas welcome ÊWhat WebDAV client are you using My recollection is that the MS Webfolder client does not send a MIME type upon PUT and that some versions of Office send a broken one upon save as . So are you sure that the client indeed sends a Content-Type header hi julian. i am using the new Office 2007 products as webdav client. We do not have webfolders we crap the content always with the ApplicationClient itself. i dont know if MsWord sends a header with the mimetype but i will check it .. angela Is my assumption correct that After saving a... means that you modify an existing resource and that the mimetype was original after creating the resource correct yes thats true The drawback would be that the mimetype will not be adjusted even if the file node gets replaced by a file with a different mimetype. For that - maybe not realistic - case the used would have to remove the resource and add the replacement. i think this scenrio that you open a word file and then save as excel is not realistic. to add mimetypes through a configuration would be fine so we can add other formats. BR claus i have traced the PUT request on a save operation and ms word does not send any content type headers. so what do you think about my suggestion not modify the mimytype for us its important that jackrabbit does not modify the mimetype because we can not test the new office formats because after on save the mimetype will be changed to default mimetype. BR clausi m in favor of this modification as long as only PUT request are affected. a PROPPATCH that tries to set the mimetype or remove the property alltogether should still succeed. but not having looked at the code i guess this should be feasible. do you want to provide a patch or should i change it angelahi angela. i m not very familiar with the code in the server project. if you have time to change the code i think its faster if you change it otherwise i will look into it. BR clausok. i ll take a look at it.fixed with rev. 587149 tests litmus test suite and some manual tests using DavExplorer.hi angela if i add a node to jackrabbit i add the jcr content node as nt resource. if i open now this document with webdav i found that the DefaultHandler looks if the jcr content node is from type nt unstructured .if not the child properties of the content node will be deleted and the properties will be set again. so there is also a problem with the mimetype. if i do that with a office 07 document .docx the original mimetype application msword will be changed to application octet-stream . i think we must restore the original mimetype. what do you think BR clausone more question ... what is the recommended nodetype for the jcr content node and why will it be changed in the DefaultHandler Please don t reopen issues that have already been closed for a release. Regressions should be filed as new bug reports and additional improvements as new improvement requests.
