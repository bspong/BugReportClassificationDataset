allow SPI implementation to compute default values for autocreated properties
Currently when creating nodes in transient space JCR2SPI uses hard-wired logic trying to populate system generated properties such as jcr created jcr uuid and so on. This is problematic as - it doesn t scale it fails for autocreated properties not known to JCR2SPI and - the syntax for the defaults may be dependant on the back end such as legal syntax for UU IDs. Proposal - extend QValueFactory with something like   QValue computeDefaultValue QPropertyDefinition - use that in JCR2SPI getting rid of the currently hard-wired logic. i think i would rather name it create QPropertyDefinition or createFromDefinition QPropertyDefinition . and i think i would return a QValue .... since the prop def could be multi valued couldn t it but i m definitely in favor of this improvement. angela i think i would rather name it create QPropertyDefinition or createFromDefinition QPropertyDefinition . In which case I d prefer the latter in order to avoid confusion with the other create methods. and i think i would return a QValue .... since the prop def could be multi valued couldn t it Correct. In which case I d prefer the latter in order to avoid confusion with the other create methods. ok. the from is may be not totally accurate either. i liked your compute but i wasn t too happy with the default-value... because the default value is something different and it s already present in the property definition isn t it there is no need to compute that one... is it meant to be used for both retrieved default-values AND autocreated values then it would probably be  computeValues. i guess we should also define the behaviour of the method if the QPropertyDefinition does neither define defaultvalues nor is autocreated... throwing ok. the from is may be not totally accurate either. i liked your compute but i wasn t too happy with the default-value... because the default value is something different and it s already present in the property definition isn t it there is no need to compute that one... Right. So how about   QValue computeAuto Created Value ... personally preferring the shorter variant is it meant to be used for both retrieved default-values AND autocreated values then it would probably be computeValues. As we already have an API to get defaults I d prefer to do this just for autocreated values. i guess we should also define the behaviour of the method if the QPropertyDefinition does neither define defaultvalues nor is autocreated... throwing Yes. The contract would be that the method should only be called for autocreated properties and the implementation then could throw a RepositoryException otherwise. Proposed patch SPI JCR2SPI . fine by me.Implemented with revision 590762.
