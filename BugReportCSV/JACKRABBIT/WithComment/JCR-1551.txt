TransientRepository application doesn t exit quickly
When using the TransientRepository the repository should be closed when the last session logs out. This works but in some cases there is a very long 60 seconds delay between closing the last session and closing the repository. Test case     public static void main String args throws Exception         Repository repository new TransientRepository         Session session repository.login new SimpleCredentials new char 0         session.getRootNode .setProperty a 0         session.save very quick logout without this line         session.logout         System.out.println Logout...         final long time System.currentTimeMillis         Runtime.getRuntime .addShutdownHook new Thread             public void run                 System.out.println End after System.currentTimeMillis - time                            The shutdown delay seems to be caused by the static DynamicPooledExecutor instance introduced in JCR-1222.Thanks for the tip Indeed the DynamicPooledExecutor seems to be the problem. from http g.oswego.edu dl classes EDU oswego cs dl util concurrent PooledExecutor.html The default keep-alive value is one minute If I change that to 500 ms the repository is shut down very quickly. I don t know however what the effect on indexing performance is so I wait with committing until somebody with more insight can review the change. See also https issues.apache.org jira browse JCR-1222 Index jackrabbit-core src main java org apache jackrabbit core query lucene DynamicPooledExecutor.java jackrabbit-core src main java org apache jackrabbit core query lucene DynamicPooledExecutor.java revision 651569 jackrabbit-core src main java org apache jackrabbit core query lucene DynamicPooledExecutor.java working copy -49 6 49 7             public DynamicPooledExecutor          executor new PooledExecutor executor.setKeepAliveTime 500          executor.waitWhenBlocked          adjustPoolSize       Looks OK to me. Please go ahead and commit the change.Fixed in revision 654078Merged to the 1.4 branch in revision 654078.
