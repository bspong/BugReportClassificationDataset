NPE in ItemManager when calling Session.save with nothing to save
I m getting an NPE on the id.denoteNodes call below in ItemManager     private ItemData retrieveItem ItemId id         synchronized itemCache             ItemData data itemCache.get id             if data null id.denotesNode ... because the id is null after taking the second branch of this if in SessionSaveOperation.perform         if context.getSessionImpl .hasPermission Session.ACTION READ             id context.getRootNodeId          else             id context.getItemStateManager .getIdOfRootTransientNodeState          context.toString says session-author-3623 ItemManager org.apache.jackrabbit.core.ItemManager 1e911ccc Items in cache SessionItemStateManager org.apache.jackrabbit.core.state.SessionItemStateManager 15472b43 transient attic which I assume means there s nothing to save. The correct behavior is probably to do nothing in perform to avoid the NPE. confirmed by hacking SessionSaveOperation sp the second branch is always taken This seems to reproduce it      https issues.apache.org jira browse JCR-3131     public void testEmptySaveNoRootAccess throws RepositoryException NotExecutableException           no change in the session      Session s getTestSession      s.save      Privilege read privilegesFromName Privilege.JCR READ      try             withdrawPrivileges read getRestrictions superuser path          s.save           finally             givePrivileges read getRestrictions superuser path           to be added in o.a.c.s.a.a.WriteTest 1 the patch looks goodfixed in svn revision 1196062 by committing the patch with some changes i ve chosen a somewhat simpler approach .
