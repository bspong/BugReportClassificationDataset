IllegalStateException thrown when consuming events
i assume when session is closed or beeing closed the observation still tries to deliver some events java 2005-11-24 22 58 41 764 ObservationManager WARN org.apache.jackrabbit.core.observation.ObservationManagerFactory - EventConsumer threw exception java.lang.IllegalStateException not in itialized java 2005-11-24 22 58 41 764 ObservationManager DEBUG org.apache.jackrabbit.core.observation.ObservationManagerFactory - Stacktrace java java.lang.IllegalStateException not initialized java at org.apache.jackrabbit.core.security.SimpleAccessManager.isGranted SimpleAccessManager.java 119 java at org.apache.jackrabbit.core.observation.EventConsumer.consumeEvents EventConsumer.java 231 java at org.apache.jackrabbit.core.observation.ObservationManagerFactory.run ObservationManagerFactory.java 161 java at java.lang.Thread.run Thread.java 595 I agree it probably happens when a session is being closed and the observation manager still tries to deliver events. I ve changed the method EventConsumer.consumeEvents to do some sanity checking on the session to avoid the IllegalStateException. However because events are delivered in a separate thread it may still happen in rare cases that the exception is thrown. The warn log is not severe and does not harm operation of jackrabbit. Costin could you please check if this change avoids the IllegalStateExceptions you see Thanks. Fixed in revision 348920Sure I ll do an update right now and see how it goes . However isn t event delivery guaranteed not matter if it s asynchronous or not A listener should receive events no matter if the session has been closed or not.Every event listener has to be bound to a session to check access rights. See spec section 8.3.5. Event Filtering spec An event listener will only receive events for which its session the session through which it was registered has sufficient access control permissions and which meet the filtering restrictions specified upon registration. See 8.3.3 Observation Manager. spec IMO once the session is logged out there is no way to check for access control anymore and the listener must be unregistered. Which is the case in jackrabbit.I ve checked the example and indeed there are no more exceptions. Thanks.Ok then I ll close this issue. Thanks for testing Costin.
