RequestEntity EntityEnclosingMethod have inconsistent Javadocs use deprecated variables
Robert Manning Robert.Manning at collabraspace.com reported a problem on the httpclient-user list regarding inconsistencies in javadoc of RequestEntity interface and EntityEnclosingMethod class. This prompted me to review the said classes. I have discovered several issues that must be dealt with before 3.0 goes final. 1 There s virtually no test coverage for the EntityEnclosingMethod class 2 The code in EntityEnclosingMethod class extensively uses deprecated methods and variables beyond what is required to maintain backward compatibility with 2.0.x API 3 Existing code cannot gracefully handle faulty RequestEntity implementations if the getContentLength method returns a negative value -2 I have committed additional test cases to cover the most fundamental functionality of EntityEnclosingMethod http svn.apache.org repos asf jakarta commons proper httpclient trunk src test org apache commons httpclient TestEntityEnclosingMethod.java I will submit a patch addressing issues 2 and 3 shortly OlegCreated an attachment id 14727 Patch take1 Folks please review and let me know what you think. OlegHi Oleg Generally speaking I think this is probably the right way to go. The only problem is that this patch changes the behaviour of EntityEnclosingMethod. There is no longer a way to send a request with no content length and that isn t chunked. Previously it was possible to do this by setting a content length less that -2. Doing this is generally not a good idea but it was previously possible. Mike In reply to comment 2 Hi Oleg Generally speaking I think this is probably the right way to go. The only problem is that this patch changes the behaviour of EntityEnclosingMethod. There is no longer a way to send a request with no content length and that isn t chunked. Previously it was possible to do this by setting a content length less that -2. Doing this is generally not a good idea but it was previously possible. Mike Doing that was not not only a bad idea but also a violation of the HTTP spec. I had to revisit the spec while working on HttpClient 4.0. See RFC2616 section 4.4 http www.w3.org Protocols rfc2616 rfc2616-sec4.html sec4.4 gt specifically quote  5.By the server closing the connection. Closing the connection cannot be used to indicate the end of a request body since that would leave no possibility for the server to send back a response. quote OlegI agree it s definitely not a good idea. The only issue is that this changes behaviour pretty late in the 3.0 release cycle. MikeMike I think it is the proverbial case of better late then never . Patch committed. OlegThe behavioural change is okay with me as it is in agreement with the specs. Ortwin Glück
