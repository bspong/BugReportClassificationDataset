 API Doc Improve the description of the preemptive authentication
HttpClient authentication guide does not reflect the fact that preemptive authentication requires default credentials to be set. It should also mention the security implications of preemptive authentication default credentials sent with EVERY request to ANY target proxy server Created an attachment id 11669 Patch against 2.0 branch take 1 Folks please review content- and language-wise. OlegHi Oleg If I m reading the code correctly I believe the part about being cautious when using preemptive authentication PA is not warranted. If the host name is specified when setting the credentials the credentials will only used for authentication with that host. They will not be added when communicating with other hosts. The only piece of info that s missing when using PA is the realm. In particular I m looking at HttpAuthenticator line 166. MikeMike I see three possibilities for the default credentials end up sent to untrusted web application 1 when credentials are set for null host and null realm. We should have never allowed that in the very first place but we did and now we have to live with that. I believe at the very least we should warn the users about security implications of setting default credentials for null host and realm 2 HttpClient 2.0 does not take target port into consideration when selecting credentials for the HTTP state. This also should have not have happened but it did. So even if default credentials are set for a specific host HttpClient can send them to a untrusted application if it is hosted on a different port 3 I believe there are at least several web platforms capable of supporting different authentication realms defined within the same virtual host. There s no way HttpClient can differentiate those realms unless it receives an authorization challenge. 2 and 3 are really fringe cases but they are not impossible. Think of a hosting company serving massive number of virtual sites off the same web platform I do admit that the part about being cautious when using preemptive may be badly worded but I do think it should be there Oleg 1 when credentials are set for null host and null realm. We should have never allowed that in the very first place but we did and now we have to live with that. I believe at the very least we should warn the users about security implications of setting default credentials for null host and realm Completely agree. Having null host and realm is of little practical use. I think we should just document it heavily and let people shoot themselves in the foot if they so choose. 2 HttpClient 2.0 does not take target port into consideration when selecting credentials for the HTTP state. This also should have not have happened but it did. So even if default credentials are set for a specific host HttpClient can send them to a untrusted application if it is hosted on a different port True but this applies to non-preemptive authentication as well. 3 I believe there are at least several web platforms capable of supporting different authentication realms defined within the same virtual host. There s no way HttpClient can differentiate those realms unless it receives an authorization challenge. Agreed. Preemptive authentication as is currently stands cannot be effectively used in this case. Ê 2 and 3 are really fringe cases but they are not impossible. Think of a hosting company serving massive number of virtual sites off the same web platform In this case we should be okay since each virtual host can be differentiated by host name. I do admit that the part about being cautious when using preemptive may be badly worded but I do think it should be there Good I think we re in agreement then We should keep some warnings about preemptive authentication but try to focus on the areas where it could be a potential problem in practice. In my opinion the only real issue is in regard to hosts with multiple realms. MikeCreated an attachment id 11703 Patch take 2 OK. How about this OlegLooks good to me. MikeNo corrections language-wise OlegOk perhaps a few corrections The content I think is good now. I would only suggest changes to the last paragraph. Here s my suggestion Original Text - It is highly recommended to avoid setting credentials for any host and realm code null code host and code null code authentication realm in productive applications. Use the least restrictive credentials scope when debugging only. Suggested Text - Setting credentials with code null code host and realm values is highly discouraged in production applications. Doing this will result in the credentials being sent for all authentication attempts all requests in the case of preemptive authentication . Use of this setting should be limited to debugging only. MikeThanks Mike. The patch with your corrections committed to CVS HEAD and 2.0 branch Oleg
