Wrong cookie matching port number reported when using a proxy
Following the example given in https issues.apache.org jira browse HTTPCLIENT-852 and the route HttpRoute - http xyz.webfactional.com 7295- gt http www.seoconsultants.com one of the new cookies is reported to be added as java 2009 05 28 19 58 23 398 CEST DEBUG RequestAddCookies - Cookie version 0 name ASPSESSIONIDCSARBQBA value MAMPAMKCBDJJFKNAAPKPMDAA domain www.seoconsultants.com path expiry null match www.seoconsultants.com 7295 whereas it should be java 2009 05 28 19 57 46 667 CEST DEBUG RequestAddCookies - Cookie version 0 name ASPSESSIONIDCSARBQBA value AAMPAMKCMBINHNEHPFEBFADA domain www.seoconsultants.com path expiry null match www.seoconsultants.com 80 i.e. the same as without using a proxy. 7295 is the port number used to access the proxy. The target domain www.seoconsultants.com is accessed through the regular HTTP port number 80 thus the cookie matching should also refer to port 80 and not the proxy s port.Fixed in SVN trunk. Please verify. OlegI couldn t verify this one the snapshot that I ve retrieved last httpclient-4.0-beta3-SNAPSHOT.jar Tue Jun 02 00 39 55 GMT 00 00 20090 seems broken.      java 2009 06 02 13 14 12 150 CEST DEBUG SingleClientConnManager - Get connection for route HttpRoute - http www.seoconsultants.com       java 2009 06 02 13 14 12 334 CEST DEBUG ClientParamsStack - http.tcp.nodelay true       java 2009 06 02 13 14 12 335 CEST DEBUG ClientParamsStack - http.socket.buffer-size 8192       java 2009 06 02 13 14 12 360 CEST DEBUG ClientParamsStack - http.protocol.version HTTP 1.1       java 2009 06 02 13 14 12 361 CEST DEBUG ClientParamsStack - http.useragent Mozilla 5.0 Macintosh U Intel Mac OS X 10.5 en-US rv 1.9.0.10 Gecko 2009042315 Firefox 3.0.10       java 2009 06 02 13 14 12 362 CEST DEBUG RequestAddCookies - CookieSpec selected best-match       java 2009 06 02 13 14 12 362 CEST DEBUG DefaultClientConnection - Connection shut down       java 2009 06 02 13 14 12 363 CEST DEBUG SingleClientConnManager - Releasing connection org.apache.http.impl.conn.SingleClientConnManager ConnAdapter 3136e5       java Exception in thread main java.lang.ClassCastException org.apache.http.auth.AuthSchemeRegistry       java at org.apache.http.client.protocol.RequestAddCookies.process RequestAddCookies.java 154       java at org.apache.http.protocol.BasicHttpProcessor.process BasicHttpProcessor.java 251       java at org.apache.http.protocol.HttpRequestExecutor.preProcess HttpRequestExecutor.java 168       java at org.apache.http.impl.client.DefaultRequestDirector.execute DefaultRequestDirector.java 427       java at org.apache.http.impl.client.AbstractHttpClient.execute AbstractHttpClient.java 607       java at org.apache.http.impl.client.AbstractHttpClient.execute AbstractHttpClient.java 542       java at org.apache.http.impl.client.AbstractHttpClient.execute AbstractHttpClient.java 520 My bad. Please try again with the latest build OlegOK the output is now as expected. Thx 
