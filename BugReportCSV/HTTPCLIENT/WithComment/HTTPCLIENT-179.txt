HTTPS Post Does Not Work
Using Java 1.4.1 01 on Windows 2000. An HTTPS Post results in HTTP 100-Continue messages. The same code posting to a non HTTPS URL works. The code populates the request body using a NameValuePair array.Cliff This bug has been fixed a while ago. Please upgrade to the most recent nightly build. http jakarta.apache.org commons httpclient downloads.html Beta-1 release is due next week This bug has been marked as a duplicate of 17432 Hello i ve got the same problem like Cliff. My sample code posts a xml file to a servlet on a tomcat-4.1.18 tomcat-4.1.24 server and response a very simple html page. The sample code likes the sample PostXML.java of httpclient. With JDK 1.4.1 02 and commons-httpclient-20030408.zip everything works fine but with JDK 1.3.1 07 the application response the following data ... 65854 main WARN org.apache.commons.httpclient.HttpMethod - Recoverable exception caught when reading response 65854 main DEBUG org.apache.commons.httpclient.HttpMethod - Closing the connection. 65854 main DEBUG org.apache.commons.httpclient.HttpConnection - enter HttpConnection.close 65854 main DEBUG org.apache.commons.httpclient.HttpConnection - enter HttpConnection.closeSockedAndStreams 65854 main ERROR Testclient - IOException org.apache.commons.httpclient.HttpRecoverableException Error in parsing the status line from the response unable to find line starting with HTTP Andy What I can see from the debug trace is that HttpClient does not seem to receive any response from the server. I am not sure at all that it s HttpClient at fault here Ê1 Are you using SSL Ê2 If yes are you sure SSL is properly configured for JDK 1.3.1 07 Ê3 Can you provide me with the complete wire debug log OlegCreated an attachment id 5694 Log file Created an attachment id 5695 Log file Created an attachment id 5696 Log file Created an attachment id 5697 Log file Created an attachment id 5698 Log file Hey Oleg Ê1 Are you using SSL Ê2 If yes are you sure SSL is properly configured for JDK 1.3.1 07 Ê3 Can you provide me with the complete wire debug log 1. Yes i m using ssl. 2. Yes I think so. I ve tried a https GET request with httpclient-2.0a3 everything works fine but with all newer versions of httpclient GET and POST requests doesn t work anymore. 3. Logging Please see the attachement. Sorry i send the logfile 5 times. first read then click ... Andy all I can see from these logs is that the server fails to send back any sort of response. Please examine server s logs to find out whay may be causing the problem on the server side. 1 Could you please send me the wire log generated by 2.0alpha3 for comparison 2 Could you please try executing the same request using plain HTTP and see if that works OlegCreated an attachment id 5700 getxml-httpclient-2.0a3.log https get request jdk1.3.1 07 everything works fine Created an attachment id 5701 postxml-httpclient-2.0a3.log https post request jdk1.3.1 07 response status code 100 Oleg i send two log files https get works fine https post doesn t work . This is the tomcat server log entry for one requests 2003-04-08 18 03 04 InvokerFilter ApplicationFilterConfig name Path Mapped Filter filterClass filters.ExampleFilter 0 millisesconds Thanks for your trouble - Andy so far there s nothing to thank me for. I missed the point regarding the Tomcat. Are you saying that the request was filtered out OlegOleg the tomcat server logs only if the he can handle the request. None of the nightly versions 0407 0408 which I tested write a log entry. Last night I ve tested the original 2.0a3 httpclient with a https request GET POST once again. And what did I see If setHttp11 false it works fine with the tomcat. But if i change to a nightly build httplient nothing works. If the application sends a GET POST request the following is written into the tomcat log file only httpclient-2.0a3 works fine 2003-04-08 18 03 04 InvokerFilter ApplicationFilterConfig name Path Mapped Filter filterClass filters.ExampleFilter 0 millisesconds Andy the tomcat server logs only if the he can handle the request. None of the nightly versions 0407 0408 which I tested write a log entry. I do not think you are right. If Tomcat drops a request for whatever reason an entry stating this fact should be added to the log. Since there s no corresponding entry in the Tomcat log it leads me to assume that the request has not reached the servlet engine at all. If was dropped off before it could hit Tomcat. Maybe at the SSL layer or even earlier. That exlains why HttpClient does not receive a response. Are you hitting Tomcat directly or through a HTTP server Is there a proxy or a firewall between the client and the server Have you tried using plain HTTP This is important. Please do test plain HTTP And what did I see If setHttp11 false it works fine with the tomcat. Sure. expect 100-continue handshake is only used with HTTP 1.1 I think something is fishy about your local setup. There have been no changes in the HTTP GET logic since alpha-3. HTTP GET should work in any case. Since it does not I tend to believe that the problem you have been experiencing is not due to a flaw in HttpClient OlegI m hitting the tomcat server directly without any proxy or HTTP server. With plain HTTP everything works fine. All POST and GET requests will be response httpclient nightly or 2.0a3 . I ve also tested tomcat server on my local machine but i got the same errors like the network access. Notice with the jdk1.4.1 02 all works fine. Could it be a problem with my jdk1.3.1 07 JSSE configuration Could it be a problem with my jdk1.3.1 07 JSSE configuration Andi that s what I have been hinting at all along. I have just downloaded JDK 1.3.1.07 for Windows and I ll try to emulate your environment as close as possible. If I fail to reproduce the problem I ll have to mark this bug report as works for me OlegAndi you were right. I was wrong. It does appear to be a bug in HttpClient introduced by a post 2.0a3 feature. The bug is reproducible across various Sun s JDK below 1.4.1 Sun JDK 1.2.2.13 Sun JDK 1.3.1.07 with JCE 1.2.2 JSSE 1.0.3.01 and across various platforms Windows 2000 server SP3 Redhat Linux 9 . Sun JDK 1.4.1.b21 does not exhibit this problem. I ll be working on a fix. Many thanks for tracking the bug down OlegCreated an attachment id 5751 fix It looks like pre-1.4 implementations were counting on the method write byte int int being called on the SSL socket. When wrapped in a standard FilterOutputStream this method is never called. MikeCreated an attachment id 5758 slightly better patch This is pretty much the same as the previous patch but it s a little more thorough I think. MikeMike the patch looks ok to me. I think you should go ahead and commit it OlegPatch applied.
