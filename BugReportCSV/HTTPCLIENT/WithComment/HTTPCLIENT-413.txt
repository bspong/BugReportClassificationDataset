Cookie with domain .mydomain.com not sent to host mydomain.com
A cookie with for example   .mydomain.com as domain property is not sent to the host   mydomain.com without www. or anything else before mydomain.com This concern all CookieSpec as the relevant code is located in CookieSpecBase     public boolean domainMatch final String host final String domain         return host.endsWith domain      It should be changed for instance to something like     public boolean domainMatch final String host final String domain          take care of host myDomain.com and domain .myDomain.com         return host.endsWith domain host.equals domain.substring 1      RFC2109 section 2 quote Hosts names can be specified either as an IP address or a FQHN string. Sometimes we compare one host name with another. Host A s name domain-matches host B s if both host names are IP addresses and their host name strings match   exactly or both host names are FQDN strings and their host name strings match   exactly or A is a FQDN string and has the form NB where N is a non-empty name   string B has the form .B and B is a FQDN string. So x.y.com   domain-matches .y.com but not y.com. Note that domain-match is not a commutative operation a.b.c.com domain-matches .c.com but not the reverse. quote Marc Please correct me if I am wrong but based on the above quote I believe HttpClient correctly implements the domain matching algorithm as defined by the RFC2109. If you are absolutely positive that so called mainstream browsers implement a different domain matching differently we may consider relaxing the browser compatibility spec. OlegI faced the problem with htmlunit that uses itself commons-httpclient. Just after having reported this bug I ve found that on the website I was testing on the problem was caused by an htmlunit feature that changed domain of cookies like mydomain.com to .mydomain.com . This feature has been added for not so long time and I currently don t understand why. I close this bug as invalid. If I get some feedback on the reason of the patch in htmlunit I will reopen it. Sorry for the lost time.Mmm...irony. I was the one responsible for the bad patch in htmlunit that Marc found. However mainstream browsers like Mozilla 1.7.5 Firefox 1.0 and Safari 1.2.4 all support this behavior. I have also tested MSIE 5.2 for Mac which behaves this way as well. I have created a patch to CookieSpecBase.domainMatch that fixes this issue although it will change the behavior of the NetscapeDraftSpec subclass since it doesn t override the domainMatch method . This makes the CookiePolicy.BROWSER COMPATIBILITY mode more...compatible...with browsers. Created an attachment id 13964 Patch v1 Note that this change to CookieSpecBase.domainMatch is the flip side of the logic in the CookieSpecBase.validate method which allows this type of cookie to be set in the first place in CookiePolicy.BROWSER COMPATIBILITY mode . Created an attachment id 14133 David s patch test cases Folks If I hear no complaints I ll commit the patch in a few days OlegLooks good to me. I ll call for a 3.0 RC1 release later today now that this is taken care of. MikePatch committed. OlegNOTE The patch committed for this bug created HTTPCLIENT-467.
