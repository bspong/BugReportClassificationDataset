URIUtils.extractHost ... throws a NumberFormatException line 310
Original Jboss-seam-wicket-booking application in Jboss-4.2.3.GA started post a login request thanks httpclient then NumberFormatException. regarding this page http hc.apache.org httpcomponents-client-dev httpclient clover org apache http client utils URIUtils.html 305 Extract the port suffix if present 306 if host null 307 int colon host.indexOf 308 if colon 0 309 if colon 1 host.length 310 port Integer.parseInt host.substring colon 1 311 312 host host.substring 0 colon 313 314 resolving the port throw a NumberFormatException java.lang.NumberFormatException For input string 8080 jsessionid 9E9EDA0B6E1CDD499A0A15C4A8F212D8 at java.lang.NumberFormatException.forInputString NumberFormatException.java 48 at java.lang.Integer.parseInt Integer.java 458 at java.lang.Integer.parseInt Integer.java 499 at org.apache.http.client.utils.URIUtils.extractHost URIUtils.java 310 at org.apache.http.impl.client.AbstractHttpClient.determineTarget AbstractHttpClient.java 764 at org.apache.http.impl.client.AbstractHttpClient.execute AbstractHttpClient.java 754 at org.tagbrowser.api.TagBrowser.request TagBrowser.java 109 another case of this problem canbe found hier https gitorious.org yacy rc1 commit 8b0920b0b5eb67ae17eec24c1bf3a059543cb6e8 diffsWhat is the exact request URI Olegthe submitted URI is http localhost 8080 jsessionid AA70063844D65B7A6175481FB8447A51 wicket interface 0 login IFormSubmitListener The URL is invalid. Its authority part is incorrectly terminated is missing . This is likely the reason why java.net.URI fails to parse it and HttpClient has to fall back onto its custom parsing algorithm. Olegthat the url is not written correctly i knew it. i think it s not the right way to leave the application throwing a NumberFormatException. why don t we throw a MalformedURIException this bring trouble searching bugs in the application Fair enough. A runtime exception thrown in this case is clearly wrong. At the same I am not very comfortable throwing MalformedURIException either as the URI was partially parsed and accepted by java.net.URI. I just tweaked the fall-back parsing logic in the extractHost method and made sure NumberFormatException would not get thrown. Oleg
