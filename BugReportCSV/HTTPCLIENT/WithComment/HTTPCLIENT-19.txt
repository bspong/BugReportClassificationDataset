Response Folded Headers throws HttpException
As of 4 4 02 CVS repository the HttpMethodBase class doesn t handle folded headers in the readResponseHeaders method HTTP 1.1 and HTTP 1.0 descriptions of folded headers see section 2.2 Basic Rules http www.ietf.org rfc rfc2616.txt http www- old.ics.uci.edu pub ietf http rfc1945.html Basic-Rules I ve prepared a patch and was emailed to jakarta-commons jakarta.apache.orgIndex HttpMethodBase.java RCS file home cvspublic jakarta- commons httpclient src java org apache commons httpclient HttpMethodBase.java v retrieving revision 1.28 diff -u -b -r1.28 HttpMethodBase.java HttpMethodBase.java 16 Apr 2002 14 30 42 -0000 1.28 HttpMethodBase.java 19 Apr 2002 19 49 40 -0000 -1032 6 1032 8                    responseHeaders.clear   String name null String value null          for              String line conn.readLine              if line null line.length 1 -1039 20 1041 42                               Parse the header name and value Check for folded headers first Detect LWS-char see HTTP 1.0 or HTTP 1.1 Section 2.2 discussion on folded headers boolean isFolded false if line.charAt 0 line.charAt 0 t we have continuation folded header so append value isFolded true value line.substring 1 .trim else Otherwise we should have normal HTTP header line              int colon line.indexOf              if colon 0                  throw new HttpException Unable to parse header line               - String name line.substring 0 colon .trim name line.substring 0 colon .trim value line.substring colon 1 .trim               String match name.toLowerCase - String value line.substring colon 1 .trim               Header header Header responseHeaders.get match              if null header                  header new Header name value               else                  String oldvalue header.getValue                  if null oldvalue if isFolded LWS becomes space plus extended value header new Header name oldvalue value else Append additional header value                       header new Header name oldvalue value                   else                      header new Header name value                   Eric is quite right about this problem. I was not around for the discussion of this during April so I do not know if there is a good reason not to fullfill this bug. The patch is not good inlined in the message like it is and refrences some strnage file names and does not apply directly. Eric perhaps you can re-submit this patch in context with the current code base and please use the Create a new attachment on the bug itself and use cvs diff -u to create the patch. Don t forget to add your name to the authors list at the top of the file. cite href http www.ietf.org rfc rfc2616.txt    HTTP 1.1 header field values can be folded onto multiple lines if the    continuation line begins with a space or horizontal tab. All linear    white space including folding has the same semantics as SP. A    recipient MAY replace any linear white space with a single SP before    interpreting the field value or forwarding the message downstream. cite Created an attachment id 2416 Uptodate patch for this bug. Created an attachment id 2417 TestCase for this bug. Jeff Added an up-to-date patch and a testcase....See attachments at http nagoya.apache.org bugzilla show bug.cgi id 7754. Thanks dimsPatch applied. Test cases added.
