Digest auth uses incorrect URI
This bug seems to be strongly related to 36918. But in this case I don t have proxy and it is GET method. The problem is that when a GET request with query parameters is sent to the server uri does not count in the parameters. The server Apache 1.3 then responds with HTTP 1.1 400 Bad Request. In the error log the server writes Digest uri mismatch - query.cgi does not match request-uri query.cgi format advanced js 1 rememberjs 1 As far as I can tell the problem is with the following line of code cut DigestScheme.java public String authenticate Credentials credentials HttpMethod method .... getParameters .put uri method.getPath .... cut I am inclined to quick-hack this and add method.getQueryString to the uri but to make it right it probably needs some refactoring esp. considering issue 36918.Igor Please attach a wire context log of the HTTP session that exhibits the problem. The relevant extracts from the Apache HTTPD log would help as well. OlegCreated an attachment id 17276 http client log look for 400 Bad Request Created an attachment id 17277 extract from server access log Created an attachment id 17278 extract from server error log Created an attachment id 17284 Patch take 1 I doubt we can do much about it. The proposed fix admittedly hackish seems the way to go for 3.x series. HttpClient 4.0 based on HttpComponents is not affected by this problem as it will have a radically different architecture Please review and comment OlegThe patch works thanks Good luck with 4.0 Igorreplace   if query.indexOf 0 with   if query.charAt 0 otherwise fine with me In reply to comment 7 replace if query.indexOf 0 with if query.charAt 0 otherwise fine with me Odi Unfortunately this is needed to be in sync with HttpMethodBase generateRequestLine . See http jakarta.apache.org commons httpclient xref org apache commons httpclient HttpMethodBase.html 1408 OlegWe could just change them both to   if query.charAt 0 Doesn t really matter too much to me though. Patch away. MikeBut be careful if query.length 0 it will throw an exception My preference would be if query.startsWith ... However for the compatibility sake we probably should leave things as they are OlegPatch checked in Oleg
