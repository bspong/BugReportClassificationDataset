Cookies with null path attribute are rejected in the compatibility mode
Weblogic sends cookies with path empty httpclient emits a warning and doesn t send back the cookie to server. Maybe httpclient works in the RFC s ways but this doesn t reproduce common web browsers behaviours. Our application works well with IE Opera and Netscape httpunit also sends back the cookie to the server. When receving the response httpclient emits the followin warning WARN HttpMethod - -Invalid cookie header JTD O 2FdF13CDb1W7H2GNfUTS2YQ3Zt6bCW6ZKZRvVJ9FwaadQLxXVI7rgii 2FwbxeCsqym7dcWKDxSj 2Bg1ubJRSVRhYGb7wRLjp5c0v2R3QrCIXVhMKDjuwuXDXnjbH3LHSWG7bfzJSmS7nXk9R 2FqMIRHb5najLQkU7WkuPGgXUnUln 2BF51TajkVmXkrLMYN7MHDT48BEHvFQFNXBlmSRejWqrd 2Fiiao0flObOrT3HcaWI09B1vekpAcPmgvMD2oZzXQWJwjDZIX6QoVVD6U8CXPSvVQjITyaxf6AqaS 2BAFJgRsqbZBc0 2BV5G 2FnzE87ggOVIozfPFn99ny0kxiPGBEisJIy 3D 3D Version 1 Path Max-Age 604800 . Missing value for path attribute That s right maybe the http header is not correct but I think httpclient should handle this case without error in order to have the same behaviour as common browsers. We have no way to give a better value to this path.I personally do not find all big boys do it sort of arguments very convincing. The cookie is clearly malformed and HttpClient s behavior is absolutely correct. If better ideas are lacking one can always send instead of null. This said I ll adapt our compatibility cookie policy to conform to this kind of mis- behavior.Created an attachment id 6496 Patch take 1 Oleg I think we to set the path to if the trimmed path as well. Otherwise I think this patch is good. MikeCreated an attachment id 6497 Patch take 2 Looks good to go. I would say go ahead and commit since beta 1 has aleady been tagged. MikePatch applied. OlegOk I compiled from CVS source and now it works for me.Hi I did open this bug and snapshot version solved the problem. I ve downloaded 2.0-beta2 today and my problem came back. I think there has been a merge problem since I don t find patch modifications in the sources I downloaded today. MickaelMickael Are you sure you downloaded beta 2 I just downloaded beta2 and both the source and JADed binary appear to have this fix. MikeHi First thanks for your reactivity and your contribution to free software. I did download v2.0-beta2 but you re right patch has been applied I mistaked files sorry. But the problem remains. I think I understand what happened I did download beta-1 applied the patch myslef by hand and I made a mistake that made it work but the patch correctly applied doesn t work. I think that only the patch on CookieSpecBase.java should be applied the patch on RFC2109Spec.java stills throws an exception line 119. I mofified it today on a snapshot and it works for me. Simply remove patch on RFC21109Spec.java so remove lines from 116 to 127 and line 128 replace else if by if . Sorry for the mistake. MickaelMickael The cookie in question still violates RFC 2109 and therefore should be rejected in RFC2109 mode default . The cookie should be acceptable in the compatibility mode though. The patch was intended to fix compatibility cookie mode only. Sorry for not having been clear enough. Please give the compatibility cookie policy a try. Oleg
