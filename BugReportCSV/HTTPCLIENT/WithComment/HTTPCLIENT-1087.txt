Proxy authentication error Unexpected state MSG TYPE3 GENERATED when using NTLM authentication
Trying to connect to a website that requires basic authentication through a proxy that requires NTLM authentication. Proxy authentication fails with Proxy authentication error Unexpected state MSG TYPE3 GENERATED . Full wire log attached. Code to replicate problem follows     private void execute throws HttpException IOException           URL targetUrl new URL TARGET URL              DefaultHttpClient httpclient new DefaultHttpClient         HttpHost targetHost new HttpHost targetUrl.getHost         HttpHost proxyHost new HttpHost PROXY HOST PROXY PORT                  httpclient.getParams .setParameter ConnRoutePNames.DEFAULT PROXY          proxyHost         CredentialsProvider credProvider httpclient.getCredentialsProvider                  Credentials proxyCredentials new NTCredentials PROXY USER          PROXY PASSWORD PROXY MACHINE PROXY DOMAIN         AuthScope proxyAuthScope new AuthScope proxyHost.getHostName          proxyHost.getPort                  credProvider.setCredentials proxyAuthScope proxyCredentials                  Credentials targetCredentials new UsernamePasswordCredentials          TARGET USER TARGET PASSWORD         AuthScope targetAuthScope new AuthScope targetHost.getHostName          targetHost.getPort                  credProvider.setCredentials targetAuthScope targetCredentials                HttpGet httpget new HttpGet targetUrl.getPath         HttpResponse response httpclient.execute targetHost httpget                  System.out.println response response                       Could you please apply this patch to the latest snapshot of HttpClient off SVN trunk and re-test your application http svn.apache.org repos asf httpcomponents httpclient trunk OlegWire log after patch.Grabbed the trunk source applied the patch manually and re-tested. The modified code seemed to go into a loop. I ve attached a new wire log.David Could you please try a slightly different take and let me know the result OlegOleg This seems to work much better ... it appears to work fine in my test harness. I ll try it in my real application.Looks good ... even patched into 4.1.1. Any idea when 4.1.2 is going to be released Sometime in June or July would be my guess. OlegDavid I ended up committing a slightly different patch to both trunk and 4.1.x. Could you please re-test your application with the latest SVN snapshot and confirm the fix still works OlegSeems to work OK thanks.
