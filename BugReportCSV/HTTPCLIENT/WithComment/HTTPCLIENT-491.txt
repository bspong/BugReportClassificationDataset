nonce-count in digest auth should not be quoted
In 3.0rc3 nonce-count nc is enclosed in quote marks. According to rfc2617 this is wrong nonce-count shouldn t be enclosed in quote marks. 3.2.2 The Authorization Request Header The client is expected to retry the request passing an Authorization header line which is defined according to the framework above utilized as follows. credentials Digest digest-response digest-response 1 username realm nonce digest-uri response algorithm cnonce opaque message-qop nonce-count auth-param username username username-value username-value quoted-string digest-uri uri digest-uri-value digest-uri-value request-uri As specified by HTTP 1.1 message-qop qop qop-value cnonce cnonce cnonce-value cnonce-value nonce-value nonce-count nc nc-value nc-value 8LHEX response response request-digest request-digest 32LHEX LHEX 0 1 2 3 4 5 6 7 8 9 a b c d e f It appears that we can not use the same setting of ParameterFormatter.setAlwaysUseQuotes boolean to format all parameters. Since some parameters need to be quoted and others must not.It does appear so. The immediate fix would be to set ParameterFormatter setAlwaysUseQuotes to false. We might have to do away with the ParameterFormatter altogether in order to be 100 compliant. Essentially I believe this is an unfortunate inconsistency in the spec. For instance if my memory serves me well Apache HTTPD is not affected by this problem. I usually test our Digest code against Apache HTTPD OlegCreated an attachment id 16208 Proposed fix As AuthSchemes are stateful they are inherently thread-un-safe and we can just change the setAlwaysUseQuotes property as necessary.Works for me. A test case would be nice though - OlegYes I can hack up a test case tonight. I consider it important. I actually wanted to include one but it seems a little trickier than I originally thought and I wanted to get the fix out quickly.Absolutely trivial assertEquals s Digest nc 00001 ... should suffice imo OlegCreated an attachment id 16397 Test case Not the best but works.I think this is as good as it gets Oleg
