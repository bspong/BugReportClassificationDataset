 100-continue response times out unexpectedly
Entity encosing methods time out 3 seconds rather than getting the 100-continue response. Then after it has send the body the 100-continue response is received and returned. Adding   method.setUseExpectHeader false seems to fix it. Platform 1 Jetty server on Windows XP Sun JDK 1.4.1 01 Platform 2 Tomcat-4.1.18 Turbine on Windows 2000 Pro Sun JDK 1.3.1 Platform 3 Tomcat-4.1.18 on Linux if the connection is running over stunnel-4.00 Reported by  Simon Roberts simon.roberts fifthweb.net  Aurelien Pernoud apernoud sopragroup.com  Ingo Brunberg ib fiz-chemie.de Guys Could you please install test webapp and run standard HttpClient test cases on your system Please refer to the document below for instructions http jakarta.apache.org commons httpclient testwebapp.html I need to know if the problem can be reliably reproduced or it occurs only sporadically. OlegCreated an attachment id 5057 Output from test-local of testwebapp installed into Jetty server Previous attachment is the system described as Platform 1 . NOTE the issue actually happens using HTTPS and I m unable to test with HTTP the certificate is critical for my application .I have also encountered this same bug using httpclient to access an https server using client side certificates.Created an attachment id 5119 RFC 2616 chapter 10.1 compliance fix The patch does not really fix address the cause of the problem. I merely fixes RFC2616 non-compliant handling of 100 responses which should prevent HttpClient from failing when an unexpected 100 continue response is received RFC2616 10.1 Informational 1xx    ...    A client MUST be prepared to accept one or more 1xx status responses    prior to a regular response even if the client does not expect a 100     Continue status message. Unexpected 1xx status responses MAY be    ignored by a user agent.    ... Vagueness of this particular paragraph begs a question. Shouldn t HttpClient ignore the complete 1xx range in order to be 100 compliant As far as I know protocol change response status code 101 is not currently supported Oleg I agree it seems like all 1XX responses should be ignored. Other than support for ignoring other 1XX responses I would say this patch is good to go. MikeCreated an attachment id 5124 RFC 2616 chapter 10.1 compliance fix take 2 Looks good to me. Nice work Oleg. This makes the code for handling 100-continue much cleaner.Created an attachment id 5148 RFC 2616 chapter 10.1 compliance fix take 3 New patch removes CPU-bound busy wait used when expecting a 100 response. Socket SO TIMEOUT is used instread. Suggested by Simon RobertsPatch has been committed. Please retest and inform me if the problem still persists Oleg HTTPCLIENT-179 has been marked as a duplicate of this bug. 
