warn on invalid set-cookie header
I had a problem on a WS server that comes from some proxy misconfiguration... resulting in this reponse beeing received by HTTPclient 17 26 36 489 DEBUG header HTTP 1.1 200 OK r n 17 26 36 489 DEBUG header Set-Cookie f448bb59feedbaaabaee path r n 17 26 36 489 DEBUG header Date Tue 15 Nov 2005 16 26 36 GMT r n 17 26 36 489 DEBUG header Server Apache r n 17 26 36 489 DEBUG header Connection close r n 17 26 36 489 DEBUG header Transfer-Encoding chunked r n 17 26 36 489 DEBUG header Content-Type text xml charset utf-8 r n The set-cookie header is malformed as cookie has no name so the HTTP head may be considered invalid. This results in an error when building the NEXT request. I d expect httpclient to WARN on malformed header and drop it.Nicolas May I ask which cookie policy you are using Ortwin GlückI didn t know what cookie policy was and just read http jakarta.apache.org commons httpclient cookies.html . I m using commons-httpclient from an Axis client. So it may use default configuration RFC2109 Please notice this issue is for httpclient not warning about invalid set-cookie header not on my HTTP message that is invalid due to external system errors.But I guess the cookie is dropped I get this error on my second request first request gets the invalid HTTP set-cookie in response Maybe this is an Axis issue  faultCode http schemas.xmlsoap.org soap envelope Server.userException  faultSubcode  faultString java.lang.IllegalArgumentException Cookie name may not be blank  faultActor  faultNode  faultDetail http xml.apache.org axis stackTrace java.lang.IllegalArgumentException Cookie name may not be blank at org.apache.commons.httpclient.Cookie. lt init gt Cookie.java 113 at org.apache.axis.transport.http.CommonsHTTPSender.addCookie CommonsHTTPSender.java 368 at org.apache.axis.transport.http.CommonsHTTPSender.fillHeaders CommonsHTTPSender.java 356 at org.apache.axis.transport.http.CommonsHTTPSender.invoke CommonsHTTPSender.java 183 In reply to comment 4 I get this error on my second request first request gets the invalid HTTP set-cookie in response Maybe this is an Axis issue No. This is most likely a bug in HttpClient. I ll be working on a fix Oleg java.lang.IllegalArgumentException Cookie name may not be blank at org.apache.commons.httpclient.Cookie. lt init gt Cookie.java 113 at org.apache.axis.transport.http.CommonsHTTPSender.addCookie CommonsHTTPSender.java 368 at org.apache.axis.transport.http.CommonsHTTPSender.fillHeaders CommonsHTTPSender.java 356 at org.apache.axis.transport.http.CommonsHTTPSender.invoke CommonsHTTPSender.java 183 To me this looks as if Axis is trying to do cookie management by itself. The Cookie class refuses to be initialized with an empty name which is correct. If Axis was using HttpClient s HttpState there shouldn t be a need to create a Cookie object cheers   RolandCreated an attachment id 16987 Patch take 1 The cause of the problem turned out to be a bug in ParameterParser. Folks please review and comment Nicolas could you please get the latest SVN snapshot apply the patch and test it against your application OlegCreated an attachment id 16988 Patch take 2 Minor code tweakCan paramName never be null then In reply to comment 9 Can paramName never be null then In practical terms no because this condition always evaluates to true http jakarta.apache.org commons httpclient xref org apache commons httpclient util ParameterParser.html 99 I can make code more defensive though OlegCreated an attachment id 16990 Patch take 3 Added null check suggested by OdiI feel more confident now - Looks fine. MikePatch committed to Commons HttpClient trunk and HttpComponents trunk Oleg
