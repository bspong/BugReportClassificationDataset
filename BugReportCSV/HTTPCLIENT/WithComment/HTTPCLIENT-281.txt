DefaultHttpParamsFactory violates applet sandbox
The DefaultHttpParamsFactory in nightly build 20031009 makes two calls to System.getProperties . This is by default verboten in an applet. I have patched the source to catch the security exceptions and set the properties to a default value. My modified code block follows          TODO To be removed. Provided for backward compatibility         try           String agent System.getProperties .getProperty httpclient.useragent           if agent null             params.setParameter HttpMethodParams.USER AGENT agent                             catch SecurityException dontCare          TODO To be removed. Provided for backward compatibility         try           String preemptiveDefault System.getProperties               .getProperty httpclient.authentication.preemptive           if preemptiveDefault null             preemptiveDefault preemptiveDefault.trim .toLowerCase             if preemptiveDefault.equals true               params.setParameter HttpClientParams.PREEMPTIVE AUTHENTICATION on                          else if preemptiveDefault.equals false               params.setParameter HttpClientParams.PREEMPTIVE AUTHENTICATION off                                          catch SecurityException dontCare I ve got a similiar issue in both org.apache.commons.httpclient.URI my modified code follows          in order to support platform encoding         try           defaultDocumentCharsetByPlatform System.getProperty file.encoding           if defaultDocumentCharset null              set the default document charset             defaultDocumentCharset defaultDocumentCharsetByPlatform                             catch SecurityException dontCare as well as org.apache.commons.httpclient.HttpClient     static         if LOG.isDebugEnabled             try               LOG.debug Java version System.getProperty java.version               LOG.debug Java vendor System.getProperty java.vendor               LOG.debug Java class path System.getProperty java.class.path               LOG.debug Operating system name System.getProperty os.name               LOG.debug Operating system architecture System.getProperty os.arch               LOG.debug Operating system version System.getProperty os.version                          catch SecurityException dontCare             Provider providers Security.getProviders Hopefully this is the last sandbox case org.apache.commons.httpclient.cookie.CookiePolicy         String s null         try s System.getProperty SYSTEM PROPERTY         catch SecurityException dontCare         if COMPATIBILITY .equalsIgnoreCase s We are planning to remove all the System.getProperty calls in the future releases of HttpClient. For the time being I ll apply the suggested fix. OlegOleg Are you going to put this in 2.0 or HEAD There are also all of the debug statements in HttpClient. Most likely there are other problems as well. MikeI am planning to provide a patch for both 2.0 branch and head as the suggested fix is merely an additional safe-guard and should have no functional impact on the existing code OlegFYI - after those fixes were applied I could use HttpClient in my applet. There should be no other sandbox-related security issues.Sounds good to me. MikeCreated an attachment id 8521 Patch against 2.0 branch take 1 Created an attachment id 8523 Patch against HEAD take 1 Any objections to committing the patches OlegGo for it. MikePatches committed. Oleg
