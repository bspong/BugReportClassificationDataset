Crashes when it gets a redirect
I get the following crash when VFS not my code calls HttpClient. This code worked with some older version of HttpClient is my belief but doesn t appear to work with CVS HEAD hence this posting. Note I m sorry but I don t know which Method it was calling but hopefully a redirect is a redirect and the bug stands irrespective of that. This is major to me and Ruper cos it is the first thing it does before attempting to read the contents of that location. regards Adam java.lang.NullPointerException at org.apache.commons.httpclient.HttpMethodDirector.processRedirectResponse HttpMethodDirector.java 454 at org.apache.commons.httpclient.HttpMethodDirector.isRetryNeeded HttpMethodDirector.java 639 at org.apache.commons.httpclient.HttpMethodDirector.executeMethod HttpMethodDirector.java 145 at org.apache.commons.httpclient.HttpClient.executeMethod HttpClient.java 378 at org.apache.commons.httpclient.HttpClient.executeMethod HttpClient.java 268Hi Adam Thank you for posting this bug. I tried this out and was unfortunately unable to reproduce the problem. Here s what I tried         System.setProperty org.apache.commons.logging.Log org.apache.commons.logging.impl.SimpleLog         System.setProperty org.apache.commons.logging.simplelog.showdatetime true         System.setProperty org.apache.commons.logging.simplelog.log.httpclient.wire debug          System.setProperty org.apache.commons.logging.simplelog.log.org.apache.commons.httpclient debug                  String url http www.ibiblio.org maven                  HttpClient client new HttpClient         GetMethod get new GetMethod url                  client.executeMethod get         get.getResponseBody The request was redirected successfully. There are also a number of test cases for redirects that work with HEAD. Is must be something about how HttpClient is configured or being called. Can you provide a test case and or a wire log http jakarta.apache.org commons httpclient logging.html Thanks MikeI found the settings that VFS was using and tried to emulate. It seems to need the MultiThreadedHttpConnectionManager plus HEAD to crash. HttpClient client new HttpClient new MultiThreadedHttpConnectionManager HeadMethod head new HeadMethod url client.executeMethod head Hi Adam I have just done the same thing. As you point out the problem is in using the MultiThreadedHttpConnectionManager and in particular the HttpConnectionAdapter.  The connection is being released by HeadMethod because the HttpConnectionAdapter is not aware of the new locked option. This is clearly a bug. I will work on a solution. Thanks MikeCreated an attachment id 8078 Quick fix. Here s a quick fix for this. While I feel this is not the ideal solution it should get things working for now. MikeAny objections if I apply this to HEAD MikePatch applied. Mike
