Provide fail-over for multi-home remote servers if one server in a farm goes down 
The HTTP Client does not provide automatic fail-over for multi-home remote servers web-farm if one server in a farm goes downAttached is example of code MultiHomeProtocolSocketFactory.java and MultiHomeSSLProtocolSocketFactory.java to resolve this issueAttached is example of code MultiHomeProtocolSocketFactory.java and MultiHomeSSLProtocolSocketFactory.java to resolve this issueFolks This looks useful to me. The questions is whether we want to put this code to the contrib package or to HttpClient proper. What do you think OlegShould definitely go into proper. It s a common use case.Looks like a case for proper. The error handling and Java version support needs a bit of polishing though. cheers   Roland Another question to follow immediately what target release 3.1 3.2 or 4.0 Since 3.1-rc1 has already been officially released 3.1 is supposed to be in the state of code freeze by now barring serious bugs only. Thoughts OlegWe can certainly bundle it as an addition in 3.1 if it is not set as the default.I can live with putting this into 3.1. It does not affect either binary or source compatibility. And it makes sense. We should not let users wait for this code for several releases just to stick to the RC definition. But if you don t like the idea I have no problem with putting it into 3.1 contrib and 4.0 proper either. cheers   Roland Very well 3.1 it is. OlegVadim I took a closer look at the code and found out that both factories would not work as advertised no fail-over for multi-home remote servers if the connect timeout was set to a non-zero value. This needs to be fixed if you want the code to be accepted into the main distribution of HttpClient. OlegFolks This patch is not ready for inclusion into the stable distribution without additional work. I have no cycles left to work on anything but major bugs in the HttpClient 3.x code line. I suggest we postpone this issue until 4.0 OlegHi Oleg Sorry I did not look in this thread for a long time and now my reply is probably too late but anyway I hope it may be useful. I put here the code just as an example how the problem was resolved in our case. I don t pretend it to go to any version unchanged and I did not test this code with all possible scenarios but actually it works fine for me if the connect timeout is set to a non-zero value. I m not sure why it does not work in your case can you please provide a bit more info Vadim Because both socket factories do not seem to provide the same fail-over logic when the connection timeout is set to a non zero value. They merely call the ControllerThreadSocketFactory createSocket method     int timeout params.getConnectionTimeout     if timeout 0            return createSocket host port localAddress localPort          return ControllerThreadSocketFactory.createSocket         this host port localAddress localPort timeout    I still intend to incorporate the patch into the 4.0 branch in the due course. You are very welcome to give me a helping hand though if you want this to happen sooner - OlegI see. This is what I did not mention I registered http protocol with MultiHomeProtocolSocketFactory and https with MultiHomeSSLProtocolSocketFactory.    register custom http and https protocols   static        Protocol protocolHttp new Protocol http                                       ProtocolSocketFactory new MultiHomeProtocolSocketFactory                                      DEFAULT HTTP PORT     Protocol.registerProtocol http protocolHttp     Protocol protocolHttps new Protocol https                              ProtocolSocketFactory new MultiHomeSSLProtocolSocketFactory                             DEFAULT HTTPS PORT     Protocol.registerProtocol https protocolHttps    I did not need to change any code in HTTP Client which I like a lot nice architecture just created these 2 Factories and registered in my other class. In this case the MultiHomeProtocolSocketFactory createSocket will be called from ControllerThreadSocketFactory createSocket. Oleg Any problems using it as I described above Regards VadimNo no problem but as far as I understand this only works when the factory is registered as the default one. OlegAutomatic connect fail-over for multi-home remote servers implemented in SVN trunk Oleg
