Minor performance improvement to IdleConnectionHandler
The attached patch does the following changes to IdleConnectionHandler  - as it iterator over a map of connections using a LinkedHashMap is a faster  - rather than using an iterator over the keyset and subsequently getting the values an iterator over the entry set is used instead for efficiency at least according to FindBugs Note that the patch contains other changes to make variables final where possible. This was done automatically by Eclipse and can be removed if desired. However I see no harm in them other than they affect more of the code than intended by the patch.This patch s usage of LinkedHashMap means it requires Java 1.4 . Is this the case for HttpClient Attached a second version of the patch with suffix .patch2 without the whitespace and final changes.Agree that using entry set is better if one wants both key and values. Whether LHM is faster overall is less immediately obvious and will depend on how the map is used not just how it is iterated. The patch has spurious white-space changes as well as the final changes which make it very much harder to review. Also when patches are committed it is generally prefereable to fix one problem per commit. Please provide patches that fix only the problem at hand. The original code for which you have provided a patch includes generics which require Java 1.5 so LinkedHashMap must be OKAttached .patch3 which uses spaces rather than tabs as per conventions and removed use of final keyword to be consistent with rest of file.According to Java Generics and Collections O Reilly Chapter 16 LinkedHashMap has slightly worse performance overall than HashMap and should only be used if insertion or access order is important. That makes sense because the LHM has to maintain its links. BTW when providing updated patches it may be clearer to replace the original file with a new one. IIf the old file is to be kept please use a fixed type e.g. .patch and change the file stem e.g. try3.patch otherwise the attachment may be treated as binary. I ve applied the patch without the change to use LHM. URL http svn.apache.org viewvc rev 899957 view rev Log HTTPCLIENT-906 Minor performance improvement to IdleConnectionHandler Replace keySet get with entrySet Modified    httpcomponents httpclient trunk httpclient src main java org apache http impl conn IdleConnectionHandler.javaThanks. Agreed LHM is slower for some operation however it does have faster iteration performance http www.artima.com weblogs viewpost.jsp thread 122295 . I guess I was optimizing for my particular use-case where I don t add new connections frequently but do try and close idle ones every 5 seconds. Anyway am happy either way.
