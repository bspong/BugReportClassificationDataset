relative URIs with internal double-slashes misparsed
URI.parseUriReference s heuristic for interpreting URI parts is thrown off by relative URIs which include an internal . As a result portions of the supplied relative URI path can be lost. For example URI rel new URI foo bar baz rel.toString java.lang.String bar baz The culprit seems to be line 1961 of URI improperly concluding that two slashes later than the beginning of tmp are still indicative the URI is a net path . A possible quick fix might be to add a isStartedFromPath to the beginning of the line 1961 test making the line             if isStartedFromPath at 2 length tmp.charAt at 1 ... and thus preventing the misguided authority-parsing from happening when earlier analysis already identified the current string as a strictly path-oriented URI. It also appears the setting of the is net path boolean at the end of this if s block may be wrong this code is run for hier path URIs that are not net paths in the 2396 syntax. For example URI uri new URI http www.example.com some page uri.isNetPath   boolean true We will happily accept a patch OlegAttached patch avoids double-slash-triggered parsing of authority when it would be inappropriate when URI is a simple authority-less path. Test for setting isStartedWithPath improved to not indicate true for URIs that begin isStartedWithPath reused in later check to suppress inappropriate authority-parsing. Unit test verifies problem in current code and corrected behavior for test case after fix.Seems all right. I ll check the patch in in a few days if nobody complains Oleglooks good cheers   RolandPatch checked in. Many thanks Gordon Oleg
