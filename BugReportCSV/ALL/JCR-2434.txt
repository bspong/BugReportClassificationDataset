Occasional IndexingQueueTest failure
Usually the following assertion fails junit.framework.AssertionFailedError at junit.framework.Assert.fail Assert.java 47 at junit.framework.Assert.assertTrue Assert.java 20 at junit.framework.Assert.assertTrue Assert.java 27 at org.apache.jackrabbit.core.query.lucene.IndexingQueueTest.testQueue IndexingQueueTest.java 77 There is a problematic thread communication between the indexing queue check timer which does MultiIndex.checkIndexingQueue and the thread that executes the test and does IndexingQueue.waitUntilEmpty . The timer thread will detect a finished extraction and remove the lucene document from the indexing queue followed by an index update. The notification about the empty indexing queue is done before the index is updated. I ve changed the notification a bit and now the waiting thread will be notified after the index is updated. Fixed in revision 889976
