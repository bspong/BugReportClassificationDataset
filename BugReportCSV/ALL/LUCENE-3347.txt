XMLparser drops user boosting
The lucene XML parser seems to convert user defined boosting back to default 1.0 and thus boosting value is dropped from the query... e.g. BooleanQuery Clause occurs must BooleanQuery Clause occurs should UserQuery fieldName Vehicle.Colour red 66 blue 8 UserQuery Clause BooleanQuery Clause Clause occurs should BooleanQuery Clause occurs should UserQuery fieldName Vehicle.Colour black 0.01 UserQuery Clause BooleanQuery Clause BooleanQuery produces a lucene query Vehicle.Colour red 66 Vehicle.Colour blue 0.5 8 Vehicle.Colour black The expected query Vehicle.Colour red 66 Vehicle.Colour blue 0.5 8 Vehicle.Colour black 0.01 I have developed a work around by modifying line 77 of UserInputQueryBuilder.java from q.setBoost DOMUtils.getAttribute e boost 1.0f to q.setBoost DOMUtils.getAttribute e boost q.getBoost That s indeed a bug your workaround is the correct fix. In my opinion the original query s boost should be multiplied else it makes it impossible on the other hand to modify the final score by a boost attribute q.setBoost q.getBoost DOMUtils.getAttribute e boost 1.0f So UserQuery fieldName Vehicle.Colour boost 2.0 black 0.01 UserQuery would produce a boost of 0.02. This is especially important for combined queries. You bug does not occur for the first clauses as the userquery nodes produce itsself a BooleanQuery but with boost 1.0 on top-level see the additional brackets . But the fix behaves identical here. Patch with test I think it s ready to commit Committed trunk revision 1152525 Committed 3.x revision 1152526
