NoSuchItemStateException on checkin after removeVersion in XA Environment
After removing a version a checkin on the same node in a different transaction with a different session fails. The NoSuchItemStateException refer to the uuid of the previously removed version. I ll attach a test demonstrating the problem.I think a node.store is missing in InternalVersionHistoryImpl.removeVersion when no references to the version history were found. Without the store operation the cache in the LocalItemStateManager is not updated. See proposed patch based on the 1.6-branch I suppose the bug was introduced by JCR-134 and affects all version since 1.6.0fixed in 1.6 branch by revision 936666 also fixed in trunk by revision 936668.Merged to the 2.1 branch in revision 982266 and to the 2.0 branch in revision 982270.
