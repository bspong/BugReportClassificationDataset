Changes from Session.move to a top-level node aren t seen in a second session
I ll attach a test case but basically... Create two sessions Create a top-level node in the first session and save it. Move the top-level node using the first session In the second session try itemExists for the path of the node. It returns true when it should be false.this was observed while debugging a Sling test thus the package name. if you want me to provide a patch against the JR source tree please let me know what test to put this in or where I should create a new testtried a few things... none of which work refresh true instead of refresh false nodeExists instead of itemExists session.getWorkspace .move instead of session.move i tried to reproduce the said behavior on jackrabbit trunk with the provided test case however i failed i.e. the test case succeeded as expected . all i had to change was the package statement. btw you don t need to call session2.refresh when using jackrabbit-core since changes saved by one session should be visible to other sessions instantly. could you please try to reproduce the issue on jackrabbit trunk non-reproducable so far adjusting priority.Stefan- Sorry I missed your response to this issue. I can reproduce this against trunk with or without the refresh call I ll attach a patch with the test case. Justinhere s a patch with the test case added to o.a.j.core.MoveTestI believe this is due to the special way we handle the root path in the CachingHierarchyManager. The attached patch makes the nodeModified event handler take that special case into account so that also changes to the paths of top-level nodes are correctly reflected in the path cache.Fixed in revision 1000408.
