SearcherManager misses to close IR if manager is closed during reopen
if we close SM while there is a thread calling maybReopen and swapSearcher throws already closed exception we miss to close the searcher reader. here is a fix. Nice You removed swapSearcher s sync too. Thanks OK mulling on this some more.... I don t think we should go to such great lengths to remove the sync d from swapSearcher. That sync is harmless in practice it s uncontended unless the app screws up and calls .close while another thread is calling .maybeReopen and the changes necessary to make it truly lockless makes SearcherManager s code quite a bit more complex. Don t get me wrong it s an impressive feat of concurrent programming to make swapSearcher lock-free but just because you can remove a sync doesn t mean you should. But we should still fix the original issue for those apps that do mess up can t we simply move the swapSearcher inside the try finally success there is no need to make this non-blocking though I agree from a perf perspective. I personally don t like this unchecked exception in swapSearcher but since its internal that s ok. I had to make close synced too to make sure we can call close more than once this is what the interface says in its jdocs . committed to trunk in rev. 1177940 backported to 3.x in rev. 1177943 Thanks Simon Bulk close after release of 3.5
