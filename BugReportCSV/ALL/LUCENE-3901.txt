Add katakana stem filter to better deal with certain katakana spelling variants
Many Japanese katakana words end in a long sound that is sometimes optional. For example and are both perfectly valid for party . Similarly we have and that are variants of center as well as and for server . I m proposing that we add a katakana stemmer that removes this long sound if the terms are longer than a configurable length. It s also possible to add the variant as a synonym but I think stemming is preferred from a ranking point of view. Patch for this coming up shortly. Find attached a patch for this. The stemming is done by KuromojiKatakanaStemFilter which has been added to KuromojiAnalyzer and a corresponding KuromojiKatakanaStemFilterFactory has been added to the text ja field type in schema.xml. Note that this stemming is now turned on by default and I think it makes good sense to do so. The minimum length of a token considered for stemming is configurable and I ve made the default of 4 explicit in schema.xml to convey that it s there. The stemmer only supports full-width katakana and should be used in combination with a CJKWidthFilter if stemming half-width characters is required and you re doing your wiring. Both text ja and KuromojiAnalyzer takes care of this and the default overall processing is the same. There are some test cases in TestKuromojiKatakanaStemFilter but I ve added a case to TestKuromojiAnalyzer that demonstrates how the stemming works in combination with katakana compound splitting. In Japanese manager can be written both as and and probably also and for the compound senior project manager we now get tokens senior project manager and we ve stemmed the last token by removing the trailing . Kuromoji also makes the compound a synonym to and is also removed for the synonym compound. Tests pass and I ve also tested this end-to-end in a Solr trunk build. patch looks great Thanks a lot Robert. I ll do some more testing and hopefully I can commit this to trunk and branch 3x tomorrow. Updated patch with minor whitespace changes to schema.xml and added an entry in CHANGES.txt. Committed revision 1304719 on trunk. Backporting to branch 3x. Committed revision 1304727 on branch 3x. Fixed a small javadoc issue in revisions 1304728 and 1304741.
