Hostname verification turn off wildcards when CN is an IP address
Hostname verification turn off wildcards when CN is an IP address. This is a further improvement on HTTPCLIENT-613 and HTTPCLIENT-614. Example - don t allow CN .114.102.2 I m thinking of grabbing the substring following the final dot and running it through Integer.parseInt . If the NumberFormatException isn t thrown so Integer.parseInt actually worked then I ll turn off wildcard matching. Notice that this won t be a problem with IP6 addresses since they don t use dots. It s only a problem with IP4 where the meaning of the dots clashes with dots in domain names. Note when I turn off wildcard matching I still attempt an exact match with the hostname. If through some weird mechanism the client is actually able to use a hostname such as https .114.102.2 then they will be okay if that s what the certificate on the server contains.Hi Julius throwing an exception is generally a very expensive operation. Code that throws and catches exceptions in the normal course of operations is highly questionable. This is HttpClient 4.x so the prerequisite is Java 1.4 which already supports regular expressions. If you have to check a string for a format as simple as this please use a precompiled regular expression. If you re not familiar with the regexp format I ll help you out. cheers   Roland good point I ll run Character.isDigit against each character of that last sub-string instead of Integer.parseInt . That way even unicode digits in Arabic will be caught. - Hi Julius I m not sure that an IP address is allowed to have anything but US-ASCII digits 0-9. And instead of hand-parsing you could just use a precompiled regular expression... - The precompiled is important here. If it s not precompiled hand-parsing will definitely be more efficient. cheers   Roland It would be good to have a couple of tool functions to check for these cases isIPv4Address isIPv6Address Pitty the InetAddress class doesn t provide this functionality in an inexpensive way.Julius I added a utility class InetAddressUtils which can be used to test if a string represents a valid IPv4 or IPv6 address. http svn.apache.org repos asf jakarta httpcomponents httpclient trunk module-client src main java org apache http conn util InetAddressUtils.java What else needs to be done to close this issue OlegThanks Oleg Here s what I had in mind see attached patch . I ll try and put together a junit test for this - hopefully soon famous last words . Unfortunately I have to remember how to use openssl to generate an X509 cert with CN .1.2.3 but should hopefully find time this weekend. yours JuliusPatch checked in. Many thanks Julius. Test cases would be very welcome as always. Oleg
