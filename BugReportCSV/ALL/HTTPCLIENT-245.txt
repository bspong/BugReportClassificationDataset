customize handling of 302 redirects
I tried this with both the beta2 2.0 release and the nightly build. The following code snippet describes what I am trying to do httpClient.getHostConfiguration .setHost sHost 80 http HttpMethod method null if sMethod.indexOf POST -1      method new PostMethod sURLInfo else      method new GetMethod sURLInfo method.setFollowRedirects true httpClient.executeMethod method After this code executes the getFollowRedirects method still returns false and any redirects which are sent by the webserver are not followed. As a temporary workaround since I want all redirects followed I commented out the following code in the HttpMethodBase class in the processRedirectResponse method if getFollowRedirects      LOG.info Redirect requested but followRedirects is       disabled      return false If this bug has already been reported I apologize...I searched for and found nothing related to this issue.Aaron This is in fact a very well known problem. There are two aspects to it - We are not supposed to automatically redirect POST requests if we strictly follow the word of the RFC - Sadly enough we simply can t do it at the moment due to design limitations. RFC requires HTTP agents to issue a GET not a POST against the new location in response to a POST redirect. Currently classes that implement HttpMethod interface represent both a request and a response. This is a fundamental mistake which prevents us from being able to convert a request of type POST to request of type GET. We are planning to fix the problem in the 3.0 release OlegOleg writes We are not supposed to automatically redirect POST requests if we strictly follow the word of the RFC . However as I understand it this is not true for 303 See Other redirects. According to the RFC 303 redirects should be automatically redirected http www.w3.org Protocols rfc2616 rfc2616-sec10.html sec10.3.4 -Tony. In reply to comment 2 Oleg writes We are not supposed to automatically redirect POST requests if we strictly follow the word of the RFC . However as I understand it this is not true for 303 See Other redirects. According to the RFC 303 redirects should be automatically redirected http www.w3.org Protocols rfc2616 rfc2616-sec10.html sec10.3.4 -Tony. quote The response to the request can be found under a different URI and SHOULD be retrieved using a strong GET method strong on that resource quote Oleg In reply to comment 3 First of all thanks for responding to my comment Oleg. Much appreciated. I think there may be a misunderstanding since I think the bug is that HttpClient doesn t follow a 303 response to a POST. As I see it if the response is a 303 there isn t any need for confirmation from the user and the redirect can be followed automatically. The sequence is 1. client sends post 2. server sends back 303 with Location header 3. client visits location with a GET It s step 3 that has to be a GET not step 1. So it isn t the RFC that s preventing us from following a redirect as a response to a post it s just the limitation in the HttpClient code. Anyway that s how I read it. Thanks again for your help. Cheers Tony. In reply to comment 4 In reply to comment 3 First of all thanks for responding to my comment Oleg. Much appreciated. You are welcome ... So it isn t the RFC that s preventing us from following a redirect as a response to a post it s just the limitation in the HttpClient code. This is correct. Cheers Oleg Anyway that s how I read it. Thanks again for your help. Cheers Tony. Would be useful if there was an option to treat 302 responses like 303 as proposed above. I use HttpClient to interact with several web sites that use the redirect-after-post pattern but most return 302 rather than 303 because some older browsers such as Netscape 4.7 don t support 303... Hello Eric 303 responses are currently not handled automatically as discussed above. To treat 302 responses like 303 responses just disable redirect handling. For 4.0 we ll probably come up with something that allows automatic redirect handling of both though the default will still be to treat 303 different from 302 responses as required by the specification. cheers   Roland For 4.0 we ll probably come up with something that allows automatic redirect handling of both though the default will still be to treat 303 different from 302 responses as required by the specification. Great something to look forward to - original title was POST redirects cannot be executed Fixed in SVN trunk. HttpClient will always execute HTTP GET when automatically redirecting to a new location regardless of the original method type. Latest changes in trunk finally fixed one of the long standing design limitations in HttpClient Oleg
