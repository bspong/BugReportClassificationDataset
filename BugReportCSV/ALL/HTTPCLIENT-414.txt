cookies 20 years invalidated
ÊAmazon sets its user cookie to year 38 which is a problem because httpclient thinks 1938 and ignores the cookie. The reason why it does this lies in SimpleDateFormat From the JDK For parsing with the abbreviated year pattern y or yy SimpleDateFormat must interpret the abbreviated year relative to some century. It does this by adjusting dates to be within 80 years before and 20 years after the time the SimpleDateFormat instance is created. For example using a pattern of MM dd yy and a SimpleDateFormat instance created on Jan 1 1997 the string 01 11 12 would be interpreted as Jan 11 2012 while the string 05 04 64 would be interpreted as May 4 1964. So in effect any cookie set more than 20 years in the future and using a 2 digit format is gonna be screwed. The assumption being made that all two digit years current YY 20 are last century. To change the assumption all thats needed is to pass in a two year start to DateUtil.parseDate which should be 20 in the expires field check IMHO. This wouldnt affect any fully specified years and any other users of the field can use 19 if so desired. Tangentially the making of the simple date format in the local loop aint ideal... from if dateParser null ÊdateParser new SimpleDateFormat format Locale.US ÊdateParser.setTimeZone TimeZone.getTimeZone GMT to if dateParser null ÊdateParser new SimpleDateFormat format Locale.US ÊdateParser.setTimeZone TimeZone.getTimeZone GMT ÊdateParser.setTwoDigitYearStart two year start newCreated an attachment id 13839 Patch take 1 Please let me know what you think. OlegLooks good to me. MikePatch committed. Oleg
