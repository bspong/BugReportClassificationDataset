NPE in RequestProxyAuthentication on Android
Got a NPE backtrace in RequestProxyAuthentication.process . HttpRoute route conn.getRoute         if route.isTunnelled line 88 NPE here             return          There s no null check on the returned route although getRoute can return null. I guess it s not supposed to happen. In the httpclient code there s a few more calls to getRoute without a null check on the returned route. java.lang.NullPointerException at com.bubblesoft.org.apache.http.client.protocol.RequestProxyAuthentication.process SourceFile 88 at com.bubblesoft.org.apache.http.protocol.ImmutableHttpProcessor.process SourceFile 108 at com.bubblesoft.org.apache.http.protocol.HttpRequestExecutor.preProcess SourceFile 174 at com.bubblesoft.org.apache.http.impl.client.DefaultRequestDirector.execute SourceFile 457 at com.bubblesoft.org.apache.http.impl.client.AbstractHttpClient.createHttpProcessor SourceFile 821                                                                  execute at com.bubblesoft.org.apache.http.impl.client.AbstractHttpClient.createHttpProcessor SourceFile 755                                                                  execute at com.bubblesoft.org.apache.http.impl.client.AbstractHttpClient.createHttpProcessor SourceFile 733                                                                  execute Michael It is the same situation as with HTTPCORE-263. I really have no idea how to reproduce the issue and suspect the problem might be a side effect of obfuscation with Proguard. I will not be able to fix the problem without a reproducer. OlegNoted although this will be impossible to reproduce. Stack trace seems legit though. Proguard optimizations were disabled. Recent versions of HttpComponents has been very little tested on Android as 99.999 of Android developers use the httpclient httpcore of the platform from 2008 that has been hacked by Google. There might be some specific bugs on Android especially due to bad connectivity that can be lost at any time more often that any other platform. I ve had very few issues with 4.1.1 besides a few more HTTPCORE-263 crashes in automatic user crash reports with matching backtrace lines this time . For this specific issue why not add null checks for calls to conn.getRoute The HttpRoute should never be null a connection is always open for a particular route unless the request has been aborted in the middle of execution process. I ll try to mitigate the problem by adding a check for HttpRoute being non-null but it would be helpful to know what exactly Httpclient was doing at the point when the exception occurred. OlegNow that I think of it the app code related to the stack trace above does indeed have plenty of HttpRequest.abort going on while the request is executing. I d say it has more aborting than usual since requests are made to download thumbnails images in a list and requests are aborted during scrolling when previously visible list item are now invisible.With new ManagedClientConnection implementation the route for managed connections should never be null. OlegThanks for the fix. Here s another stack trace that looks legit on an unchecked null route that might confirm there was indeed a problem java.lang.NullPointerException at com.bubblesoft.org.apache.http.client.protocol.RequestClientConnControl.process SourceFile 86 at com.bubblesoft.org.apache.http.protocol.ImmutableHttpProcessor.process SourceFile 108 at com.bubblesoft.org.apache.http.protocol.HttpRequestExecutor.preProcess SourceFile 174 at com.bubblesoft.org.apache.http.impl.client.DefaultRequestDirector.execute SourceFile 457 at com.bubblesoft.org.apache.http.impl.client.AbstractHttpClient.createHttpProcessor SourceFile 821                                                                  execute 1650775d at com.bubblesoft.org.apache.http.impl.client.AbstractHttpClient.createHttpProcessor SourceFile 733                                                                  execute at com.bubblesoft.android.utils.AndroidHttpClient.execute SourceFile 279 at com.bubblesoft.android.utils.BitmapDownload.download SourceFile 56 at com.bubblesoft.android.utils.BitmapDownloadTask.doInBackground SourceFile 33 at com.bubblesoft.android.utils.BitmapDownloadTask.doInBackground SourceFile 1 at android.os.AsyncTask 2.call AsyncTask.java 185 
