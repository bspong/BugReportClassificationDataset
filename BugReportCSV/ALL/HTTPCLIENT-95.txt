Proxy authentication does not handle multiple multiple authentication schemes
My proxy server returns the following header lines in the response     Proxy-Authenticate NTLM     Proxy-Authenticate Basic realm 10.105.20.201 i.e. it returns two Proxy-Authenticate header lines. Unfortunately this does not work. In line 253 of class Authenticator method authenticate HttpMethod HttpState Header String I see this comment      FIXME Note that this won t work if there is more than one realm within the challenge so it looks like this is something that isn t yet implemented. In the log I can see that the Authenticator attempts to parse the realm but it looks like this is not being done correctly    411 DEBUG Attempting to authenticate challenge Proxy-Authenticate NTLM Basic realm 10.105.20.201    411 DEBUG Parsed realm ealm 10.105.20.201 from challenge NTLM Basic realm 10.105.20.201 .    421 WARN Exception thrown authenticating java.lang.UnsupportedOperationException Authentication type NTLM is not recognized.     at org.apache.commons.httpclient.Authenticator.authenticate Authenticator.java 274     at org.apache.commons.httpclient.Authenticator.authenticateProxy Authenticator.java 178     at org.apache.commons.httpclient.HttpMethodBase.processAuthenticationResponse HttpMethodBase.java 580     at org.apache.commons.httpclient.HttpMethodBase.execute HttpMethodBase.java 668     at org.apache.commons.httpclient.HttpClient.executeMethod HttpClient.java 355     at com.cmg.httptest.Main.main Main.java 34 It looks wrong to me that the realm name seems to be parsed as ealm 10.105.20.201 I understand that Authenticator does not know what NTLM is but I would like it to use Basic authentication in this case. If there are more authentication methods possible how can I specify which one I want to use Jesper de JongThis is definately a problem. Not just an issue with the authenticate headers but for many multivalued headerst. There is talk of moving to regular expression pattern matching for parsing but that will not be a 2.0 feature. However we will correct this issue for the soonest possible timeframe 2.0 Milestone 1. As for which authentication scheme to use when there are multiple authentication schemes cite href http www.ietf.org rfc rfc2617.txt 4.6 Weakness Created by Multiple Authentication Schemes    An HTTP 1.1 server may return multiple challenges with a 401     Authenticate response and each challenge may use a different    auth-scheme. A user agent MUST choose to use the strongest auth-    scheme it understands and request credentials from the user based    upon that challenge. cite The behaviour in the citation is not the current behaviour of HttpClient.Created an attachment id 2627 Patch for parsing multiple authenticate headers correctly Created an attachment id 2628 Improved test cases fixes another bug with multiple proxy authentication headers Applied patch http nagoya.apache.org bugzilla showattachment.cgi attach id 2628 Added test cases in the test-nohost suite for both WWW-Auth and Proxy-Auth. Please re-test in your environment and change bug status to FIXED if you are satisfied. Otherwise add a comment and reassign to component owner. HTTPCLIENT-84 has been marked as a duplicate of this bug. Works with the nightly build of 08 08 2002. Jesper
