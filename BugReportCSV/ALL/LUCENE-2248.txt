Tests using Version.LUCENE CURRENT will produce problems in backwards branch when development for 3.2 starts
A lot of tests for the most-recent functionality in Lucene use Version.LUCENE CURRENT which is fine in trunk as we use the most recent version without hassle and changing this in later versions. The problem is if we copy these tests to backwards branch after 3.1 is out and then start to improve analyzers we then will have the maintenance hell for backwards tests. And we loose backward compatibility testing for older versions. If we would specify a specific version like LUCENE 31 in our tests after moving to backwards they must work without any changes To not always modify all tests after a new version comes out e.g. after switching to 3.2 dev I propose to do the following declare a static final Version TEST VERSION Version.LUCENE CURRENT or better Version.LUCENE 31 in LuceneTestCase 4J . change all tests that use Version.LUCENE CURRENT using eclipse refactor to use this constant and remove unneeded import statements. When we then move the tests to backward we must only change one line depending on how we define this constant If in trunk LuceneTestCase it s Version.LUCENE CURRENT we just change the backwards branch to use the version numer of the released thing. If trunk already uses the LUCENE 31 constant I prefer this we do not need to change backwards but instead when switching version numbers we just move trunk forward to the next major version after added to Version enum . 1 Uwe as I already said while we where discussion this I would add the version to LuceneTestCase or equivalent for JU4 and then we can do the tests in sub-issues which prevents those super huge patches. thoughts Here my first patch. Please tell me which name for the static constant should be used I use CURRENT VERSION. Maybe something with test in it I transformed TestCharArraySet as a demonstation. Patch looks good uwe I think we should reflect its purpose in the name maybe TEST VERSION LATEST or TEST VERSION CURRENT simon Simon I opened a sub-issue for contrib and assigned you to it I will change to TEST VERSION CURRENT and then run eclipse to do the refactoring. Patch with updated constant name. Simon if you like you can use it as basis and start with contrib. Simon if you like you can use it as basis and start with contrib. will do... Here the patch for all core tests. I also did a eclipse import cleanup to remove the unused Version imports. Now the code is also clean from a full-specified class name o.a.l.util.Version.LUCENE CURRENT I introduced during my 3.0 refactoring I did not add the import statements at this time . I would like to commit this soon if nobody objects because the patch could get out of sync very fast. Updated patch I missed some LUCENE CURRENT occurences. Now all are catched and changed. My sed-command was wrong missed to replace all occurences in one line All test pass still. Will commit if nobody objects this evening. Committed revision 908496 I forgot to add the latest patch.
