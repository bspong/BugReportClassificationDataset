Some improvements to Benchmark
I ve noticed that WriteLineDocTask declares it does not support multi-threading but taking a closer look I think this is really for no good reason. Most of the work is done by reading from the ContentSource and constructing the document. If those two are mult-threaded and I think all ContentSources are then we can synchronize only around writing the actual document to the line file. While investigating that I ve noticed some 1.5 TODOs and some other minor improvements that can be made. If you ve wanted to make some minor improvements to benchmark let me know . I intend to include only minor and trivial ones. Removed unrelated jdoc in DirContentSource LongToEnglishContentSource - added jdoc improved synchronization added ASF license WriteLineDocTask is now threadsafe - uses PrintWriter and a ThreadLocal for threads buffer Added relevant test to WriteLineDocTaskTest Deleted Format.simpleName Class and replaced by class.getSimpleName Handled 3.0 TODOs Renamed StringBufferReader to StringBuilderReader Changed to use StringBuilder in TrecContentSource In order to apply the patch you need to first svn mv lucene contrib benchmark src java org apache lucene benchmark byTask utils StringBufferReader.java lucene contrib benchmark src java org apache lucene benchmark byTask utils StringBuilderReader.java All benchmark tests pass. I plan to commit shortly. LongToEnglishContentSource did not synchronize properly - fixed On the way I ve noticed it only outputs negative numbers and starts from the odd value Long.MIN VAL 10 why the 10 . Unless someone creates THAT MANY documents you ll never get positive numbers w that content source. Committed revision 938582. Backport to 3.1 Committed revision 941396. Bulk close for 3.1
