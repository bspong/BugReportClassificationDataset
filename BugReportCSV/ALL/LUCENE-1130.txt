Hitting disk full during DocumentWriter.ThreadState.init ... can cause hang
More testing of RC2 ... I found one case if you hit disk full during init in DocumentsWriter.ThreadState when we first create the term vectors fields writer such that subsequent calls to IndexWriter.add updateDocument will then hang forever. What s happening in this case is we are incrementing nextDocID even though we never call finishDocument because we thought init did not succeed . Then when we finish the next document it will never actually write because missing finishDocument call never happens. I created two test cases that show the issue patch that fixes it attached. All tests pass. I plan to commit to trunk in 1 day and I think we should also push this fix into a 2.3 RC3 Michael . and I think we should also push this fix into a 2.3 RC3 Michael . Yes. We have a disk full test scenario in our project and I ll test RC2 your patch today I think we should definitely push this into 2.3. I ll build RC3 after I finished the tests and you committed it. Attached take2 patch. I created a few more disk full threaded stress tests whereby multiple threads are indexing at some point start hitting disk full but keep on trying to add docs for a while after that disk full. This uncovered a number of sneaky thread safety issues with how DocumentsWriter was handling exceptions aborting etc.. I ve fixed them and all tests pass. I ll wait another day before committing. Mike all core contrib tests pass for me. Also the disk full test that I mentioned passes with your take2 patch. Without the patch it fails with RC2. So 1 for committing it to trunk 2.3 branch I ll build RC3 once this is committed. OK I will commit today. Thanks for testing Michael Thanks for testing Michael I ll forward the thanks to my colleagues they re doing a great job with testing the 2.3 RCs currently Thank YOU for the quick fixes Mike OK fixed ported to 2.3 branch 
