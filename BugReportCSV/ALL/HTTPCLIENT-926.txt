Add Amazon S3 authentication support
Add support for the the Amazon S3 authentication scheme as defined by the online document http docs.amazonwebservices.com AmazonS3 latest index.html RESTAuthentication.htmlImplementation of Amazon s spec. Verified working against HttpClient 4.0 and 4.1.alpha1.Jean-Philippe I committed the code you contributed to the SVN repository. I made some minor changes to the exception handling code and also had to remove author tags. Please review. http svn.apache.org viewvc rev 934160 view rev Many thanks for this contribution OlegHi Jean-Philippe I was testing this and noticed that the Base64.encodeBase64String inserts a CRLF even when the size is much less than 76 characters.. and thus causes problems a connection reset from Amazon for a GET request in my test base64-encode the hmac result Base64.encodeBase64String rawHmac A simple replace as follows fixes this issue but as I am not much familiar with the AWS S3 API want to check this with you if this indeed is a simple oversight or if there could be other cases I am not aware of base64-encode the hmac return Base64.encodeBase64URLSafeString rawHmac cheers asankha Seems like my earlier comment was written in a hurry.. I still have issues and will get back with my findings My earlier suggestion has been reporting a successful response but with an error that the signature did not match which I did not notice .. A working solution is to just remove the trailing r n which otherwise can be interpreted as part of another malformed request. Since this is only at the end this should not cause an issue - but if a r n indeed does occur within the header value due to some long signature etc that could still cause problems.. For now I ve checked this into SVN String headerValue NAME credentials.getUserPrincipal .getName signature.trim cheers asankhaHi Asankha Thanks for the feedback. I ve found a similar issues with the code that I had to use some workarounds for. I m continuing to investigate this and will take your considerations into account. I also discovered an issue with some S3 based servers required the Content-MD5 header to be set. I will be submitting an update to the code that hopefully addresses your issue plus the Content-MD5 issue. Cheers Jean-Philippe
