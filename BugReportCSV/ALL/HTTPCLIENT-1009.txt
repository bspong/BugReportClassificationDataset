http client cache SizeLimitedResponseReader is not setting content type for InputStreamEntity in constructResponse 
the newly created InputStreamEntity should be populated with content-encoding and content-type.The following test that I am adding to TestSizeLimitedResponseReader confirms that if the header is on the original response from the server it is moved onto the response      Test     public void testResponseCopiesAllOriginalHeaders throws Exception         byte buf new byte 1 2 3         HttpResponse response new BasicHttpResponse HttpVersion.HTTP 1 1 HttpStatus.SC OK OK         response.setEntity new ByteArrayEntity buf         response.setHeader Content-Encoding gzip         impl new SizeLimitedResponseReader new HeapResourceFactory MAX SIZE request response         impl.readResponse         boolean tooLarge impl.isLimitReached         HttpResponse reconstructed impl.getReconstructedResponse         byte result EntityUtils.toByteArray reconstructed.getEntity         Assert.assertFalse tooLarge         Assert.assertArrayEquals buf result         Assert.assertEquals gzip reconstructed.getFirstHeader Content-Encoding .getValue      If the response does not contain the headers for Content-Encoding and Content-Type in the first place - it really should not be the responsibility of the client side cache to add them or attempt to determine what they should be and place them onto the response. I don t believe that this is an issue of the cache.This patch adds an additional test to the file TestSizeLimitedResponseReader for verifying that headers on the original response are copied onto the reconstructed response. This patch is submitted with the permission of my employer.I was not referring to the response headers which are correctly copied over but the entity attributes which are not copied over. I m attaching a patch test case that fixes the issue. I think I signed a waiver a few years ago that allows me to contribute to the apache commons.Both patches checked in. OlegOleg     The fix patch was missing one additional item The value for isChunked that was not being copied from the old entity onto the new one. This patch adds just that one line. This patch is submitted with the permission of my employer.Patch checked in. Many thanks Joe Oleg
