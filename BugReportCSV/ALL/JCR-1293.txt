ReorderReferenceableSNSTest failure
I have checked out the Jackrabbit 1.4 branch to a new directory and called mvn clean install The error is Building Jackrabbit JCR to SPI   task-segment clean install ... testRevertReorder org.apache.jackrabbit.jcr2spi.ReorderReferenceableSNSTest junit.framework.AssertionFailedError Reorder added a child node.        at junit.framework.Assert.fail Assert.java 47        at org.apache.jackrabbit.jcr2spi.ReorderTest.testOrder ReorderTest.java 90        at org.apache.jackrabbit.jcr2spi.ReorderTest.testRevertReorder ReorderTest.java 122 checked out 1.4 branch and tried to build it 1st try didn t manage to get to the jcr2spi tests. the build already failed at the core Running org.apache.jackrabbit.core.integration.JCRAPITest Failed tests   testRestoreName org.apache.jackrabbit.test.api.version.RestoreTest 2nd try core passed. but jcr2spi build fails due to Failed tests   testRestoreName org.apache.jackrabbit.test.api.version.RestoreTest 3rd try building jackrabbit-core fails again Failed tests   testRestoreName org.apache.jackrabbit.test.api.version.RestoreTest i get the same as thomas. building and testing core works like a charm reorder test fails. Test set org.apache.jackrabbit.jcr2spi.TestAll Tests run 218 Failures 1 Errors 0 Skipped 0 Time elapsed 2.394 sec FAILURE testRevertReorderToEnd org.apache.jackrabbit.jcr2spi.ReorderReferenceableSNSTest Time elapsed 0.02 sec FAILURE junit.framework.AssertionFailedError Reorder added a child node.         at junit.framework.Assert.fail Assert.java 47         at org.apache.jackrabbit.jcr2spi.ReorderTest.testOrder ReorderTest.java 90 the test passes fails at random. not sure if this is really related to issue JCR-1197 anymore.i don t manage to get the reorder-test failing. after running the build a couple of times the restore-tests pass as well and yes i had that before but i never paid attention to it ...i was able to reproduce the failure a couple of times. although only when running the test on a already tested repository. i.e. the first time when the repository is created all tests pass. i also reverted the changes from issue 1197 but the error still occurs. so i think it is not related to that issue. when debugging the test - it passed of course - . so i think there is a async. problem somewhere. either in a weak hashmap or some async listener.While testing for this I also saw occasional failures of o.a.j.test.api.version.RemoveVersionTest and o.a.j.jcr2spi.version.LabelTest. In revision 610155 I tagged all three test cases as known issues for the 1.4 release. Once we figure this out we can include a fix in a 1.4.x patch release.i managed to get the ReorderReferenceableSNSTest.testRevertReorder failing. up to now i saw 2 variants of the reorder-tests failing both due to additional child-nodes and i don t know yet whether they are related a the additional nodes had not uniqueID means that they are not mix referenceable in the underlying jackrabbit repository which i verified looking at the jackrabbit-nodes directly . this is somehow unexpected sinde the tests only creates referenceable child nodes at least it are intended to do so . the result in this situation is always inconsistent state and the teardown fails with InvalidItemStateException. b cleanUpTestRoot of the AbstractJCRTest is called twice both in the setup and in the teardown and it retrieves all child-nodes from the testRoot and removes them. i saw that from time to time not all child-nodes get removed i imagine due to the weak nature of the hierarchy ... in this case one test simple failed without causing inconsistencies for the subsequent tests.
