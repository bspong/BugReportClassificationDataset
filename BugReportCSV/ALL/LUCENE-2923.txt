cleanup contrib demo
I don t think we should include optimize in the demo many people start from the demo and may think you must optimize to do searching and that s clearly not the case. I think we should also use a buffered reader in FileDocument And... I m tempted to remove IndexHTML and the html parser entirely. It s ancient and we now have Tika to extract text from many doc formats. Yeah we remove the optimize. Too many people tell me exactly that they should optimize because they see it in almost every demo code. Optimizing is with recent Lucene versions not needed anymore. It s hard to explain to people so example code and books should never tell to optimize. In books about lucene there should also be an explanation when optimizing is needed or usefully put prevent people from always doing this. Patch. I think we should also use a buffered reader in FileDocument And close the reader... I don t think we should include optimize in the demo I wonder if it wouldn t be better to leave it but commented out - with a short explanation. Optimizing is not necessary but it clearly has benefits to query perf If you are not updating often I think it can make perfect sense. So I m fine with just dropping but not sure if commenting it out and putting something like for an index that is not updated often we might optimize now or variation... OK new patch fixing a number of things I close the Reader thanks Mark . I cutover to NumericField and stopped using DateTools for the modified field. I added a -create option to IndexFiles so you can see how to CREATE vs CREATE OR APPEND I left commented-out optional things Ð calling optimize increasing IW s RAM buffer. Don t use Version.LUCENE CURRENT. I sucked in test files from Lucene in Action 2E s tests open source licenses . I use addDocument or updateDocument depending on -create. I made the demo html parser private to modules benchmark which had a dependency on it. Can someone lookover my changes to the build xml files Especially the Maven part where I completely guessed . IndexHTML is gone and the webapp src jsp is gone too. To apply the patch you first have to do this svn mv lucene contrib benchmark src java org apache lucene demo html modules benchmark src java org apache lucene benchmark byTask feeds demohtml svn mv lucene contrib demo src test org apache lucene demo html modules benchmark src test org apache lucene benchmark byTask feeds demohtml New patch. I inverted IndexFiles -create to IndexFiles -update ie default is now create like before . Added reference to web-site docs in the jdocs and added comment on the optional increase RAM buffer size that you should also -Xmx your JVM. I think it s ready to commit but separately we have to fix the web site. Can someone lookover my changes to the build xml files Especially the Maven part where I completely guessed . I skimmed the patch and can see that you removed the specializations of the dist-maven task in both modules benchmark and lucene contrib demo . For benchmark the specialization was trivial and didn t change any behavior so I assume that s why you dropped it. In the demo case the specialization was introduced to be able to deploy the .war file but since the .war file is no longer produced the dist-maven specialization is no longer required. Later today I ll have time to apply the patch and do sanity checking on the maven outputs. One thing left to do I can handle this separately change the Maven POMs for the benchmark and demo modules. Thanks Steven. Right I removed both because I think we don t need maven details in the build.xml since the Maven POMs are now separately configured .. well and because we don t make a WAR anymore. Mike a small typo To apply the patch you first have to do this svn mv lucene contrib benchmark src java org apache lucene demo html modules benchmark src java org apache lucene benchmark byTask feeds demohtml That should be svn mv lucene contrib demo src ... modules benchmark src ... Woops Thanks Steven. This patch adds the following and includes all of Mike s patch IntelliJ IDEA configuration adjustments Maven POM adjustments Source and regenerated site docs contrib demo build.xml builds the Lucene core jar in the init target if it doesn t exist or if its .java source files are newer than the jar. contrib demo build.xml default target is now jar-core At Mike s suggestion on lucene IRC added javadoc comment to IndexFiles pointing out that 1 input doc per file is slow and that good throughput can be gained by putting multiple docs in a single input file. Other minor cleanups Committing shortly. Thanks Steven Here s a patch that removes the custom collector and the -paging false streaming option simplifying the demo a lot more. Here s a patch that removes the custom collector and the -paging false streaming option simplifying the demo a lot more. 1. I think the site docs will also need some revision. Initial patch commited trunk rev. 1072250 branch 3x rev. 1072386. Leaving this issue open to deal with Robert s patch. The nightly hudson trunk maven build failed last night because the benchmark jar wasn t being produced by the dist-maven target which is called from the generate-maven-artifacts target. From https hudson.apache.org hudson job Lucene-Solr-Maven-trunk 31 consoleText dist-maven artifact deploy Deploying to file usr home hudson hudson-slave workspace Lucene-Solr-Maven-trunk checkout modules dist maven artifact deploy An error has occurred while processing the Maven artifact tasks. artifact deploy Diagnosis artifact deploy artifact deploy Error deploying artifact org.apache.lucene lucene-benchmark jar Error deploying artifact File usr home hudson hudson-slave workspace Lucene-Solr-Maven-trunk checkout modules benchmark build lucene-benchmark-4.0-SNAPSHOT.jar does not exist BUILD FAILED This can be fixed by putting back the dist-maven specialization that I took out of modules benchmark build.xml target name dist-maven depends jar-core javadocs contrib-build.dist-maven Committing shortly. Fix for modules benchmark build.xml committed to trunk rev. 1072393. branch 3x doesn t have this problem since it has no modules and the benchmark contrib works the same as the other contribs for the generate-maven-artifacts target. This patch fixes demo2.html to remove description of the streaming search removed from the SearchFiles demo app by Robert s patch removes the obsolete root directory text from the usage message in the IndexFiles demo app as well as the same info in demo.html Stops the SearchFiles demo app in interactive mode from asking for which page to navigate to when there are zero results - instead asks for another query. Committing shortly. crap - forgot to commit branch 3x part 3 port... Bulk close for 3.1
