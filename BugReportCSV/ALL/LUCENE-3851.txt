TestTermInfosReaderIndex failing always reproducible 
Always fails on branch use reproduce string below git clone depth 1 -b rr git github.com dweiss lucene solr.git junit4 Running org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex junit4 FAILURE 0.04s J0 TestTermInfosReaderIndex.testSeekEnum junit4 Throwable 1 java.lang.AssertionError expected field9 z91ob3wozm6d but was junit4 at randomizedtesting.SeedInfo.seed C7597DFBBE0B3D7D C6D9CEDD0700AAFF 0 junit4 at org.junit.Assert.fail Assert.java 93 junit4 at org.junit.Assert.failNotEquals Assert.java 647 junit4 at org.junit.Assert.assertEquals Assert.java 128 junit4 at org.junit.Assert.assertEquals Assert.java 147 junit4 at org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex.testSeekEnum TestTermInfosReaderIndex.java 137 junit4 at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method junit4 at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39 junit4 at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25 junit4 at java.lang.reflect.Method.invoke Method.java 597 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke RandomizedRunner.java 1766 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.access 1000 RandomizedRunner.java 141 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 6.evaluate RandomizedRunner.java 728 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 7.evaluate RandomizedRunner.java 789 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 8.evaluate RandomizedRunner.java 803 junit4 at org.apache.lucene.util.LuceneTestCase SubclassSetupTeardownRule 1.evaluate LuceneTestCase.java 744 junit4 at org.apache.lucene.util.LuceneTestCase InternalSetupTeardownRule 1.evaluate LuceneTestCase.java 636 junit4 at org.apache.lucene.util.SystemPropertiesInvariantRule 1.evaluate SystemPropertiesInvariantRule.java 22 junit4 at org.apache.lucene.util.LuceneTestCase TestResultInterceptorRule 1.evaluate LuceneTestCase.java 550 junit4 at org.apache.lucene.util.LuceneTestCase RememberThreadRule 1.evaluate LuceneTestCase.java 600 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest RandomizedRunner.java 735 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.access 600 RandomizedRunner.java 141 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 3 1.run RandomizedRunner.java 586 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 3.evaluate RandomizedRunner.java 605 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 4.evaluate RandomizedRunner.java 641 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 5.evaluate RandomizedRunner.java 652 junit4 at org.apache.lucene.util.SystemPropertiesInvariantRule 1.evaluate SystemPropertiesInvariantRule.java 22 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite RandomizedRunner.java 533 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner.access 400 RandomizedRunner.java 141 junit4 at com.carrotsearch.randomizedtesting.RandomizedRunner 2.run RandomizedRunner.java 479 junit4 junit4 2 NOTE reproduce with ant test -Dtests.filter .TestTermInfosReaderIndex -Dtests.filter.method testSeekEnum -Drt.seed C7597DFBBE0B3D7D -Dargs -Dfile.encoding UTF-8 junit4 2 junit4 AfterClass output junit4 2 NOTE test params are codec Appending sim DefaultSimilarity locale en timezone Atlantic Stanley junit4 2 NOTE all tests run in this JVM junit4 2 TestLock TestFileSwitchDirectory TestWildcardRandom TestVersionComparator TestTermdocPerf TestBitVector TestParallelTermEnum TestSimpleSearchEquivalence TestNumericRangeQuery64 TestSort TestIsCurrent TestToken TestIntBlockCodec TestDocumentsWriterDeleteQueue TestPagedBytes TestThreadedForceMerge TestOmitTf TestSegmentTermEnum TestIndexWriterConfig TestCheckIndex TestTermVectorsWriter TestNumericTokenStream TestSearchAfter TestRegexpQuery InBeforeClass InAfterClass InTestMethod NonStringProperties TestIndexWriterMergePolicy TestVirtualMethod TestFieldCache TestSurrogates TestSegmentTermDocs TestMultiValuedNumericRangeQuery TestBasicOperations TestCodecs TestDateSort TestPositiveScoresOnlyCollector TestBooleanQuery TestIndexInput TestMinimize TestNumericRangeQuery32 TestBoolean2 TestSloppyPhraseQuery TestNoDeletionPolicy TestFieldCacheTermsFilter TestRandomStoredFields TestDocBoost TestTransactionRollback TestUnicodeUtil TestIndexWriterLockRelease TestUTF32ToUTF8 TestFixedBitSet TestDoubleBarrelLRUCache TestTimeLimitingCollector TestSpanFirstQuery TestDirectory TestSpansAdvanced2 TestConcurrentMergeScheduler TestIndexWriterExceptions TestDocValues TestCustomNorms TestFieldValueFilter TestTermVectors TestTermInfosReaderIndex junit4 2 NOTE Linux 2.6.32-38-server amd64 Sun Microsystems Inc. 1.6.0 20 64-bit cpus 4 threads 1 free 100102360 total 243859456 junit4 2 Thanks Dawid i ll take a look at this first chance i get unless Mike beats me to it . This looks scary we ve had bugs with 3.x s terms dict around emptyField emptyTerm before. I hope its just a test bug. I have a build that failed on this with the trunk as well. Testsuite org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex build 06-Mar-2012 02 00 19 junit Testcase testSeekEnum org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex FAILED build 06-Mar-2012 02 00 19 junit expected field9 vifzlsx301lb but was build 06-Mar-2012 02 00 19 junit junit.framework.AssertionFailedError expected field9 vifzlsx301lb but was build 06-Mar-2012 02 00 19 junit at org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex.testSeekEnum TestTermInfosReaderIndex.java 137 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCase SubclassSetupTeardownRule 1.evaluate LuceneTestCase.java 736 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCase InternalSetupTeardownRule 1.evaluate LuceneTestCase.java 632 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.SystemPropertiesInvariantRule 1.evaluate SystemPropertiesInvariantRule.java 22 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCase TestResultInterceptorRule 1.evaluate LuceneTestCase.java 531 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCase RememberThreadRule 1.evaluate LuceneTestCase.java 593 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 165 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 57 build 06-Mar-2012 02 00 19 junit at org.apache.lucene.util.SystemPropertiesInvariantRule 1.evaluate SystemPropertiesInvariantRule.java 22 build 06-Mar-2012 02 00 19 junit build 06-Mar-2012 02 00 19 junit build 06-Mar-2012 02 00 19 junit Tests run 3 Failures 1 Errors 0 Time elapsed 2.017 sec build 06-Mar-2012 02 00 19 junit build 06-Mar-2012 02 00 19 junit Standard Error build 06-Mar-2012 02 00 19 junit NOTE reproduce with ant test -Dtestcase TestTermInfosReaderIndex -Dtestmethod testSeekEnum -Dtests.seed -f25df3791460298 -695efbb1146e1fcc -249645e649da7915 -Dargs -Dfile.encoding UTF-8 build 06-Mar-2012 02 00 19 junit NOTE test params are codec Lucene40 sim RandomSimilarityProvider queryNorm false coord true locale ro RO timezone Europe Kaliningrad build 06-Mar-2012 02 00 19 junit NOTE all tests run in this JVM build 06-Mar-2012 02 00 19 junit TestMockAnalyzer TestMockCharFilter TestTermInfosReaderIndex build 06-Mar-2012 02 00 19 junit NOTE Linux 2.6.32-38-server amd64 Sun Microsystems Inc. 1.6.0 20 64-bit cpus 4 threads 1 free 106885096 total 157810688 build 06-Mar-2012 02 00 19 junit build 06-Mar-2012 02 00 19 junit TEST org.apache.lucene.codecs.lucene3x.TestTermInfosReaderIndex FAILED This is reproducible on trunk as well. I m looking at this... Thanks Mike. Let me know if you need anything that I can help you with... . I committed a fix it was a test bug when the number of indexed terms was 0 mod termIndexInterval... the test incorrectly thought the last term would be an indexed term. I also added some missing asserts so the next time this happens the exceptions won t look so scary Thanks Dawid Mike... a lot less scarier than it could have been Thanks Dawid Thanks Mike 
