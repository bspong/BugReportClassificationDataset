Use Apache Tika for text extraction
Once Apache Tika is released with a resolution to TIKA-175 making Tika available to Java 1.4 projects we should replace our direct parser library dependencies with Tika parsers. Ideally we d just use the Tika AutoDetectParser that ll automatically detect the type of a binary and parse it accordingly solving JCR-728. I guess we should keep some level of backwards compatibility with existing textFilterClasses ... configurations perhaps by keeping the existing TextExtractor classes as wrappers around respective Tika parsers.Jackrabbit now uses Apache Tika version 0.3 as the default text extractor. All the previous text extractor classes still exist so any existing configurations should still work as before.I don t feel that comfortable with the new dependencies that were added with this change. More specifically the size of icu4j and ooxml-schemas. The first is about 4MB and the latter 13MB . Comparing the size of jackrabbit-standalone in 1.5 with current trunk shows that it doubled from 20 to over 40 MB. What do others think about this I think using tika would be great. But I agree this increase makes me shiver ...We need the ooxml-schemas dependency in any case if we want to support Microsoft Office 2007 files see JCR-1887 . I think that s a pretty important improvement that s definitely worth keeping even if it notably increases the standalone jar size. I ll ping the POI people on whether the ooxml-schemas jar could be trimmed down somehow. Also in Tika we could perhaps find some ways to reduce the size of the dependencies as not all of the included functionality is really needed text extraction is typically just a part of the functionality included in the parser libraries . Anyway I m reopening this issue until we have a solution that satisfies everyone.There is progress in Tika to address these concerns for example the ICU4J dependency was replaced by inlining just those classes that are really needed but I don t think we ll have a Tika 0.4 release out in time for Jackrabbit 1.6. Thus I m inclined to revert these and JCR-1887 changes from the 1.x branch and focus on Jackrabbit 2.0 for Tika integration.OK reverted the changes from 1.x in revision 779501. Targeting the 2.0 release instead.I upgraded the Tika dependency to 0.4 in revision 807139. This dropped the size of jackrabbit-standalone jar from 44MB to 39MB. It s still quite a bit but until we have an alternative way to extract text from OOXML files we re stuck with the large ooxml-schemas jar. I had a discussion with the POI team about a trimmed down extract only version of the OOXML support but it looks like that would have to use a different design than the current implementation and there doesn t seem to be too many people with such an itch. So for now I m OK to live with the extra megabytes.I have now dropped the jackrabbit-text-extractors component in favor of a direct Apache Tika dependency. TODO Add a configuration option for using custom Tika settings Replace extractor pool configuration with repository-global pool config Document the change in the release notesResolving as fixed we can add the extra configuration options in later releases.
