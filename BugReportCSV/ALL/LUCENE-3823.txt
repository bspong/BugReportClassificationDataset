Add a field-filtering FilterAtomicReader to 4.0 so ParallelReaders can be better tested in LTC.maybeWrapReader 
In addition to the filters in contrib misc for horizontally filtering by doc-id AtomicReader it would be good to have the same vertically by field . For now I will add this implementation to test-framework as it cannot stay in contrib misc because LTC will need it for maybeWrapReader. LTC will use this FilterAtomicReader to construct a ParallelAtomicReader out of two or maybe more FieldFilterAtomicReaders. Patch. Tests mostly pass there is still some insane FieldCache in some tests thats unrelated to this change but can be made appearing more often by remving rarely from the maybeWrapReader method. Mostly affected is insane field cache in TestExplanations and QueryUtils that check explanations. The attached patch simply implement the vertical index splitter in test-framework. If there is interest in this FilterAtomicReader we can move it e.g. to core. New patch that fixes the insanity and also removes the hack in QueryUtils added y Robert. The problem causing insanity was the wrapping by MultiReader which is detected by FC checker as insanity if it is wrapped by Slow and the checker can walk down to a SegmentReader e.g. SlowMultiReaderWrapper MultiReader StandardDirectoryReader . The trick was to make the returned fake reader have an own cache key so FC checker does not recognize the insanity . This patch also fixes the getTermVectors method in the FieldFilterAtomicReader to return null if none of the remaining fields have TVs. Fix also TestDuellingCodecs to no longer rely on order of stored fields see comment by Mike Robert . All tests pass now will commit this later. Committed trunk revision 1293965
