Break the spi2dav dependency to jcr-server
Currently the spi2dav component has a dependency on the jcr-server component which is troublesome due to the extra transitive dependencies and which strictly speaking should not be necessary from an architectural point of view. The dependency exists mostly for sharing a number of JCR-specific WebDAV constants. I d like to push those constants down to jackrabbit-webdav as they are essentially just shared strings and as jackrabbit-webdav already contains a number of constants used by JCR extensions. In addition to constant values code in the following classes is shared between jcr-server and spi2dav JcrValueType NamespacesProperty NodeTypesProperty SearchResultProperty SubscriptionImpl ValuesProperty. The shared code in JcrValueType and SubscriptionImpl is mostly just about mapping constant value mappings and could fairly easily be moved to jackrabbit-webdav. The Property classes are a but trickier but it looks like it would be possible to split the code to separate server- and client-side classes for jcr-server and spi2dav.Attached an initial draft of the required changes. All the shared constants are moved to jackrabbit-webdav. For now the patch simply copies the relevant code in the shared classes to o.a.j.spi2dav.server. More work is needed to avoid the duplication.I solved part of this issue by explicitly excluding the troublesome transitive dependencies in revision 896870.i don t agree with the proposed changes. the jackrabbit-webdav project must not have any notion of JCR as it is designed to work with any kind of webdav implementation. the constants invented for the JCR remoting over webdav do not belong there from my point of view. For now the patch simply copies the relevant code in the shared classes to o.a.j.spi2dav.server then i would rather copy the constants to spi2dav. the jackrabbit-webdav project must not have any notion of JCR What about existing classes like o.a.j.webdav.observation.ObservationConstants I definitely agree that we don t want to introduce a JCR API dependency on jackrabbit-webdav. But just like we include support for other WebDAV extensions like DASL or the extra properties used by Microsoft can we not also include similar support for the JCR extensions What about existing classes like o.a.j.webdav.observation.ObservationConstants as far as i know there is no JCR constant in there... it s a custom extension of webdav that isn t defined by either of the dav-rfcs. If you want to move the jcr-remoting specific stuff to the webdav project they should at least be renamed from JCR-something to Jackrabbit-something or Day-something and put into a different Constants class in order to make sure that those constants have nothing to do with standard webdav. i really don t want JCR to appear in the dav library... it s hard enough to explain why jackrabbit which is known as reference implementation for JCR provides it s own webdav library. we definitely should avoid anything that introduces additional confusions. no jcr strings within the dav-library... why not moving the shared code to jcr-commons actually i already happen to put code shared davex and the server into the commons package before... it would have been natural to move the rest as well. i can take care of that.
