Data Store enable and fix tests
Currently the unit test TestTwoGetStreams fails in the trunk it worked in older versions . This should be fixed. Also the data store is disabled by default so this test doesn t run by default. The data store should be enabled for testing.Revision 783243 trunk bugfix Revision 783245 trunk enabled data store tests. Unfortunately they are slow 74 seconds I will try to speed them up.Revision 783347 trunk fixed broken testsI still see test failure from time to time. Actually quite regularly - testEventListener org.apache.jackrabbit.core.data.GCEventListenerTest Time elapsed 11.984 sec ERROR javax.jcr.ItemNotFoundException cafebabe-cafe-babe-cafe-babecafebabe at org.apache.jackrabbit.core.ItemManager.getItemData ItemManager.java 284 at org.apache.jackrabbit.core.ItemManager.getItem ItemManager.java 228 at org.apache.jackrabbit.core.ItemManager.getItem ItemManager.java 493 at org.apache.jackrabbit.core.ItemManager.getRootNode ItemManager.java 416 at org.apache.jackrabbit.core.SessionImpl.getRootNode SessionImpl.java 840 at org.apache.jackrabbit.core.data.GarbageCollector.scanNodes GarbageCollector.java 194 at org.apache.jackrabbit.core.data.GarbageCollector.scan GarbageCollector.java 178 at org.apache.jackrabbit.core.data.GCEventListenerTest.doTestEventListener GCEventListenerTest.java 85 at org.apache.jackrabbit.core.data.GCEventListenerTest.testEventListener GCEventListenerTest.java 50 Environment Windows XP Java 1.6.0 12-b04The stack trace looks like the root node is missing. Are you sure this is related to this bug No I just assumed it is related because it s a DataStore test and you earlier wrote that data store tests are now enabled.Another potentially related test failure I see every now and then testContentIdentity org.apache.jackrabbit.core.data.TestTwoGetStreams Time elapsed 0.379 sec FAILURE junit.framework.AssertionFailedError time 111 at junit.framework.Assert.fail Assert.java 47 at junit.framework.Assert.assertTrue Assert.java 20 at org.apache.jackrabbit.core.data.TestTwoGetStreams.testContentIdentity TestTwoGetStreams.java 83 I think Marcel problem is fixed now Marcel could you verify this . testContentIdentity tries to test if only the identifier was copied but not the data itself. To do that it measures the time that is used to copy a binary object. It s not a good idea to do that and specially a bad idea to use a fixed amount of milliseconds. I changed the test to compare the time it takes to save one object with the time it takes to copy it 100 times. Now it should fail only if copying the object 100 times takes more than 50 times as long as saving it once. Marcel could you verify this well that s a bit difficult because I saw this test failure only occasionally. But I ll file an issue if I encounter a failure again.OK thanks. Using relative timing probably works better for the test.
