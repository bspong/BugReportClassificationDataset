Some contribs depend on core tests to be compiled and fail when ant clean was done before
If you do ant clean on the root level of Lucene and then go to e.g. contrib queryparser 3.x only or contrib misc 3.x and trunk and call ant test the build of tests fails contrib queryparser s ExtendedableQPTests extend a core TestQueryParser 3.x only in module this works of course contrib misc TestIndexSplitter uses a core class to build its index To find the root cause We should first remove the core tests from contrib classpath so the issue gets visible even without ant clean before. Then we can fix this. I agree in some of these cases we might be able to refactor helper methods and such into tests-framework which would be cleaner. we shouldn t necessarily do this in all cases but at least clean up the obvious ones patch for trunk Here s the explanation since patch will not apply as it contains svn moves disabled the lucene src test from contrib classpath moved the fieldcacherewritemethod and tests to core src test as discussed in LUCENE-3271 moved the europarl data file to tests-framework because some contribs use it moved that createDocument method from TestIndexWriterReader to DocHelper if there are no objections I would like to commit soon. Patch for trunk looks fine Thanks The stupid 3.x-extends-TestQueryParser problem is more challenging I agree so the issue is still open for 3.x What i did was merge back the applicable improvements from the trunk patch but the contrib classpath still contains src test for now. I ll try to look at the queryparser tests in general maybe we can cleanup here i ve noticed a lot of duplication in the tests before. hopefully we can clean up the tests a bit and fix the build at the same time... analyzers was broken too i moved VocabularyAssert to tests-framework trunk too ok this fixes branch 3x. I refactored TestQueryParser into a QueryParserTestBase and extended it by the core TestQP and this ExtendableQP. Really we should clean this up more for a bunch of the other QPs but this is a start and fixes the build. I think thats fine as a start. This would not work in test-framework in trunk but there we dont have that problem as all QParsers live in one module. So the abstract base class can live there. All done... its good you brought this up Uwe in fact the ExtendableQPTest was not overriding the correct method so really it wasnt being tested we were just running the core QP tests again 
