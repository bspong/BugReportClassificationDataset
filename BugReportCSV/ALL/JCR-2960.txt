Long values not properly stored
When a long value assigned to a property is too big when restarting the server the value become 0 The test pass with versions 1.6.4 and 2.0regression of JCR-2762. test case any long value 0x3FFFFFFFFFFFFFFF i.e. with any of the 2 most significant bits set causes an overflow on deserialization. this obviously also includes Long.MAX VALUE and Long.MIN VALUE... example long test 0x3FFFFFFFFFFFFFFFL Ê BundleWriter.writeVarLong test test BundleReader.readVarLong ok test BundleWriter.writeVarLong test BundleReader.readVarLong returns 0Ouch good catch Fixed in revision 1100286 along with tests also for some other value types. Luckily this is not a serialization bug so none of the stored data itself is compromized unless used as input for copies or further calculations. However we ll need to backport this fix to the 2.2 branch and warn people not to rely on large values read from the repository until this fix has been applied. I ll take care of that first thing next week.Merged to the 2.2 branch in revision 1127054.
