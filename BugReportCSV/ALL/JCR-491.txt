TCK PredefinedNodeTypeTest does not allow additions to the predefined node types hierarchy
As explained in section 6.7.22.2 page 147 of the JSR 170 specification an implementation is allowed to customize a predefined noe type definition with additional supertypes. The tests in PredefinedNodeTypeTest do not account for that and expect an exact match with the predefined node types.Proposal change getNodeTypeSpec to omit additional supertypes. nodetype PredefinedNodeTypeTest.java revision 422074 nodetype PredefinedNodeTypeTest.java working copy -254 17 254 28             private static String getNodeTypeSpec NodeType type              throws RepositoryException String typeName type.getName          StringWriter buffer new StringWriter             PrintWriter writer new PrintWriter buffer          writer.println NodeTypeName - writer.println type.getName writer.println typeName          writer.println Supertypes          NodeType supertypes type.getDeclaredSupertypes          if supertypes.length 0              Arrays.sort supertypes NODE TYPE COMPARATOR              for int i 0 i supertypes.length i - writer.println supertypes i .getName String name supertypes i .getName if name.startsWith nt name.startsWith jcr name.equals mix referenceable typeName.equals mix versionable typeName.equals nt resource typeName.equals nt versionHistory typeName.equals nt version typeName.equals nt frozenNode writer.println supertypes i .getName                         else              writer.println Hi Nicolas Thank you for the proposal. The patch introduces a check for supertype names that have the prefix jcr . I don t see why this is necessary. Afaik there are only predefined node types with prefixes nt and mix . Is this some kind of left over or why is it necessary Other than that the patch looks fine.I have checked with David Pitfield who authored this patch and he agrees that the line you mention is not necessary.Fixed in revision 425992
