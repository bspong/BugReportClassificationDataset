IndexReader.isCurrent lies if documents were only removed by latest commit
Usecase is as following 1. Get indexReader via indexWriter. 2. Delete documents by Term via indexWriter. 3. Commit indexWriter. 4. indexReader.isCurrent returns true. Usually there is a check if index reader is current. If not then it is reopened re-obtained via writer or ect. . But this causes the problem when documents can still be found through the search after deletion. Testcase is attached. Nice catch Ð thanks Nikolay I attached a patch including tweaked test case added copyright removed author cutover to random and fix. In the NRT case we were failing to check whether a commit had occurred since the NRT reader was opened. Thanks for quick reaction and response Thank you for discovering raising the bug That s the hardest part
