A Linux-specific Directory impl that bypasses the buffer cache
I ve been testing how we could prevent Lucene s merges from evicting pages from the OS s buffer cache. I tried fadvise madvise via JNI but frustratingly I could not get them to work details at http chbits.blogspot.com 2010 06 lucene-and-fadvisemadvise.html . The only thing that worked was to use Linux s O DIRECT flag which forces all IO to bypass the buffer cache entirely... so I created a Linux-specific Directory impl to do this. Attached patch with new Directory impl DirectIOLinuxDirectory. Uwe found this nice ant plugin http ant-contrib.sourceforge.net cpptasks index.html It would allow us to optionally build the dynamic lib JNI extension from ant. But I m not going to have any time any time soon to try it... and I m not good with The Ant. DirectIOLinuxDirectory is in trunk and works Are we using it with segment merging yet Perhaps a separate Jira issue It does work but it s not general purpose ie it s up to the app to only use it for indexing and not searching. With IOContext we should be able to make it general purpose ie whether to use direct IO or not can be determined by looking at the context. I guess it would not be difficult to add Mac OS X support via F NOCACHE see http evanjones.ca write-latency-alignment.html Nice Actually I d like to generalize this Dir impl to be a UnixFSDirectory adding ifdefs to handle the flags for the various flavors and fix it once we have IOContext to properly decide when to use direct IO and when not to. This way it s safe to just use on any Unix platform... see LUCENE-2795 . Bulk close for 3.1
