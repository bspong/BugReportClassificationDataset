occasional MergeException while indexing
TestStressIndexing2.testMultiConfig occasionally hits merge exceptions OK not much info to reproduce at this point except to put the iteratons to 1000000 on testMultiConfig and let it run for a while. Here is an example exception Exception in thread Lucene Merge Thread 1 org.apache.lucene.index.MergePolicy MergeException java.io.FileNotFoundException 5 1.del at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException ConcurrentMergeScheduler.java 320 at org.apache.lucene.index.ConcurrentMergeScheduler MergeThread.run ConcurrentMergeScheduler.java 297 Caused by java.io.FileNotFoundException 5 1.del at org.apache.lucene.store.RAMDirectory.fileLength RAMDirectory.java 167 at org.apache.lucene.index.SegmentInfo.sizeInBytes SegmentInfo.java 216 at org.apache.lucene.index.IndexWriter.mergeMiddle IndexWriter.java 3750 at org.apache.lucene.index.IndexWriter.merge IndexWriter.java 3354 at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge ConcurrentMergeScheduler.java 211 at org.apache.lucene.index.ConcurrentMergeScheduler MergeThread.run ConcurrentMergeScheduler.java 266 It could potentially either be a problem in indexing or in RAMDirectory. Another exception this time during IndexReader.open after an indexing run. java.io.FileNotFoundException a.fdt at org.apache.lucene.store.RAMDirectory.openInput RAMDirectory.java 234 at org.apache.lucene.store.Directory.openInput Directory.java 104 at org.apache.lucene.index.FieldsReader. init FieldsReader.java 75 at org.apache.lucene.index.SegmentReader.initialize SegmentReader.java 308 at org.apache.lucene.index.SegmentReader.get SegmentReader.java 262 at org.apache.lucene.index.SegmentReader.get SegmentReader.java 197 at org.apache.lucene.index.MultiSegmentReader. init MultiSegmentReader.java 55 at org.apache.lucene.index.DirectoryIndexReader 1.doBody DirectoryIndexReader.java 91 at org.apache.lucene.index.SegmentInfos FindSegmentsFile.run SegmentInfos.java 651 at org.apache.lucene.index.DirectoryIndexReader.open DirectoryIndexReader.java 79 at org.apache.lucene.index.IndexReader.open IndexReader.java 209 at org.apache.lucene.index.IndexReader.open IndexReader.java 192 at org.apache.lucene.index.TestStressIndexing2.verifyEquals TestStressIndexing2.java 161 at org.apache.lucene.index.TestStressIndexing2.testMultiConfig TestStressIndexing2.java 72 Yonik are you able to repro this on 2.3 I can t. And on trunk I can only repro your first exception. The issue with that one is missing synchronization from the changes from LUCENE-1044. I m attaching the patch that fixes the first exception in my testing. Any ideas on how to get that 2nd exception to happen would be most welcome I ll try on Lucene 2.3 soon. I had assumed that the second exception had the same root cause as the first. I also switched to fsdirectory and let it run overnight... no exceptions with that. FYI I wasn t able to reproduce on the 2.3 branch. FYI I wasn t able to reproduce on the 2.3 branch. OK that s good I can t either. Things looking good Mike I haven t been able to produce an exception after this patch Super me neither I ll resolve this. Thank you for such an awesome test Yonik In uncovered some sneaky cases... From reading this issue it is unclear whether this bug exists in any released version of Lucene or not. Could someone clear this up for me please If this bug exists in released versions then I would also like to know if the problem only existed for RAMDirectory or if FSDirectory is potentially affected as well This bug never appeared in a released version it was only in trunk after 2.3 was released. The bug would happen on any Directory implementation.
