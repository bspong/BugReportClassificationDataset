add infrastructure for longer running nightly test cases
I m spinning this out of LUCENE-2762... The patch there adds initial infrastructure for tests to pull documents from a line file and adds a longish running test case using that line file to test NRT. I d like to see some tests run on more substantial indices based on real data... so this is just a start. Patch. in revision 1036038 i set -Dtests.nightly 1 for running tests during hudson nightly but i didnt set it for the clover portion... i think it would only cause the nightly job to take an eternity ok i have two potential solutions and no particular preference as to which we do we upgrade our Junit from 4.7 to 4.8 and use the Category support. in this case you would use IncludeCategory Nightly.class to annotate your test. http kentbeck.github.com junit doc ReleaseNotes4.8.html we add our own annotation e.g. Nightly and use that. in either case we hack our runner to respect it so its the same amount of work junit 4.8 won t actually save us anything since we won t use its RunWith Categories.class but our own runner its just about syntax and possibly if we care about consistency with junit or envision other optional categories beyond nightly . in revision 1036038 i set -Dtests.nightly 1 for running tests during hudson nightly but i didnt set it for the clover portion... i think it would only cause the nightly job to take an eternity 1 we also have no tests.multiplier for clover patch that adds support for annotating tests with Nightly. you can also annotate a whole class with this in that case import it from LuceneTestCase . the only trick is that junit always requires a class to have at least one runnable method or it throws an exception. in this special case that all methods or the whole class are somehow Nightly we add a fake Ignored method so we get tests run 0 and the NOTE instead of this exception. Here is the output when tests.nightly is disabled default and a method or class is Nightly respectively junit Testsuite org.apache.lucene.TestDemo junit Tests run 0 Failures 0 Errors 0 Time elapsed 0.17 sec junit junit Standard Error junit NOTE Ignoring nightly-only test method testDemo junit junit Testsuite org.apache.lucene.TestDemo junit Tests run 0 Failures 0 Errors 0 Time elapsed 0.171 sec junit junit Standard Error junit NOTE Ignoring nightly-only test class TestDemo junit Looks good the hack is a hack lol but should work and lead to no problems. I would only change the sysprop and static var to a Boolean and add a RuntimeException to the empty catch block in the reflection part. here is an updated patch with Uwe s suggestions additionally i made the fake method final. I ll commit this soon then Mike can setup his test to use it. ok I committed the lucenetestcase ant support in revision 1036088 1036094 3x To make nightly-only tests annotate the methods with Nightly. to run tests including nightly-only tests use -Dtests.nightly true Another iteration... made the test somewhat more evil but it didn t find any bugs... yet . I also made a quick Python script to munge the nice Europarl http www.statmt.org europarl corpus into a line file. The resulting line file is multi-lingual and has a nice mix of big and small docs. I d like to check this in somewhere where src test can use it Ð any suggestions Probably I should check in the Python script in the same place... This test is time limited when it runs under nightly it runs for 5 minutes and under non-nightly for 5 seconds. Attached Python script that parses Europarl into lines file and the small subset 5.7 MB to checkin for tests to use... New patch. I put the test line file and the Python script to regenerate it in src test under oal.util and use getResourceAsStream to load it. I also added a -Dtests.linedocsfile so we can override it. Separately after I commit this I d like to fix nightly build to have the full line docs file maybe randomly picking between the small docs vs medium docs files. OK I committed the new test... I ll leave this open to get the nightly to use the larger test files... I think this is fixed. Bulk close for 3.1
