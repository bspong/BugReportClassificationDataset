add offsets into lucene40 postings
LUCENE-3684 added support for IndexOptions.DOCS AND FREQS AND POSITIONS AND OFFSETS but only SimpleText implements it. I think we should implement it in the other 4.0 codecs starting with Lucene40PostingsFormat . Patch but I think we need more tests offsets payloads skipping to proceed. the existing offsets random test and other tests pass though. Here s just a quick comparison of size against term vectors with the current patch. I can play around and see if we can do better. EnglishVectors total 860961 drwx 2 rmuir None 40960 Jan 18 19 03 . drwx 6 rmuir None 0 Jan 18 18 54 .. -rwx 1 rmuir None 328731623 Jan 18 19 03 f.fdt -rwx 1 rmuir None 1004692 Jan 18 19 03 f.fdx -rwx 1 rmuir None 31 Jan 18 19 02 f.fnm -rwx 1 rmuir None 63 Jan 18 19 03 f.per -rwx 1 rmuir None 251106 Jan 18 19 03 f.tvd -rwx 1 rmuir None 417626058 Jan 18 19 03 f.tvf -rwx 1 rmuir None 2009380 Jan 18 19 03 f.tvx -rwx 1 rmuir None 50348161 Jan 18 19 03 f 0.frq -rwx 1 rmuir None 75146262 Jan 18 19 03 f 0.prx -rwx 1 rmuir None 6164520 Jan 18 19 03 f 0.tim -rwx 1 rmuir None 146233 Jan 18 19 03 f 0.tip -rwx 1 rmuir None 31 Jan 18 19 03 f nrm.cfe -rwx 1 rmuir None 125608 Jan 18 19 03 f nrm.cfs -rwx 1 rmuir None 20 Jan 18 19 03 segments.gen -rwx 1 rmuir None 265 Jan 18 19 03 segments 1 EnglishOffsets total 552569 drwx 2 rmuir None 28672 Jan 18 19 08 . drwx 7 rmuir None 4096 Jan 18 19 06 .. -rwx 1 rmuir None 328731623 Jan 18 19 07 s.fdt -rwx 1 rmuir None 1004692 Jan 18 19 07 s.fdx -rwx 1 rmuir None 31 Jan 18 19 07 s.fnm -rwx 1 rmuir None 63 Jan 18 19 08 s.per -rwx 1 rmuir None 52354303 Jan 18 19 08 s 0.frq -rwx 1 rmuir None 177235787 Jan 18 19 08 s 0.prx -rwx 1 rmuir None 6181626 Jan 18 19 08 s 0.tim -rwx 1 rmuir None 146248 Jan 18 19 08 s 0.tip -rwx 1 rmuir None 31 Jan 18 19 08 s nrm.cfe -rwx 1 rmuir None 125608 Jan 18 19 08 s nrm.cfs -rwx 1 rmuir None 20 Jan 18 19 08 segments.gen -rwx 1 rmuir None 265 Jan 18 19 08 segments 1 Patch looks good We save a lot of space 860 MB - 552 MB putting the offsets in the postings instead of term vectors. Updated patch with tests for skipping and offsets payloads. this found a bad assert in FieldInfosWriter I think its ready now.
