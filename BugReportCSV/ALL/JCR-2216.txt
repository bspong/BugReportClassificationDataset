Append-only index updates
Currently index updates modify some existing files. This is troublesome in scenarios like a backup or when an index will be shared in a cluster though this is not yet the case . Requirements are - index segments need a custom lucene IndexDeletionPolicy to keep index commits for a given time. - index segments are not only referenced by their name but also with their generation - the segments file must now also record the generation of a segment. the file itself must be generational itself. - purging of outdated index segment commits Initial patch. Comments welcome.Updated patch.Updated patch again.OK this one is now really against current trunk Committed most recent patch in revision 801253 Index segment information and redo logs are now write once and append only. That is both now have a generation suffix. E.g. you might now see files like indexes 13 and redo 13.log The indexes file references the persistent index segment while the associated redo log contains the changes on top of them that are not currently flushed to disk. There is a new parameter maxHistoryAge which tells the index for how long it should keep past index commit points basically the indexes gen and possibly unused the index segments it references . The default value is zero which means past index commit points are deleted immediately.
