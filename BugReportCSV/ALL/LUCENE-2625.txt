IndexReader.termDocs retrieves no documents
TermDocs object returned by indexReader.termDocs retrieves no documents howerver the documents are retrieved correctly when using indexReader.termDocs Term indexReader.termDocs null and indexSearcher.search Query . This test case reproduces the problem. It fails using branch 3x rev 989949 but passes fine using lucene 3.0.2 You add the field as NOT ANALYZED therefore there is no indexed term field value . Is the first assert succeeds I d assume it should return false. Hi I m not sure about this one being a bug the test calls termDocs which is unpositioned the test then calls next but it never positions it with seek so in my opinion calling next on an uninitialized iterator can return wrong results throw an exception or return nothing at all. Hi Shai Sorry but what do you mean by no field value indexed NOT ANALYZED means the term will be indexed as is. And yes all assertions pass fine but the last one which only fails using lucene 3x rev 989949 Sorry I ve misread NOT ANALYZED w NO. Too early for me . I agree w Robert though. Calling termDocs w o first positioning it by seeking is meaningless. If it returned false true in 2.9 I don t think it matters Thanks for the quick reply Shai and Robert. It makes sense now but it should be documented somewhere mainly because the behavior has change from 3.0 to 3.1. Everybody since version 2 that used to iterate over all documents that way still expects it to work without calling seek at least I did. In my opinion being unpositioned means the user needs to be aware about docs being retrieved in any order all that matters after all is to iterate over all documents in the index. Another question is if indexReader.termDocs null is used where is it positioned if nothing was defined in the parameter Shouldn t it work as termDocs It just feels inconsistent to me. Just confirmed here invoking seek does fix the problem In my opinion being unpositioned means the user needs to be aware about docs being retrieved in any order all that matters after all is to iterate over all documents in the index. termDocs is unpositioned implying you will seek it yourself with Term TermEnum Another question is if indexReader.termDocs null is used where is it positioned if nothing was defined in the parameter Shouldn t it work as termDocs It just feels inconsistent to me. termDocs term is like termDocs seek term except for the special null case as listed in the docs If term is null then all non-deleted docs are returned with freq 1 i m inclined to agree termDocs null is inconsistent because it doesnt work like termDocs seek null but instead returns the wacky AllTermsDocs javadocs patch reminding you to first seek the unpositioned termdocs javadoc patch looks good Robert Thanks for bringing this up Adriano Bulk close for 3.1
