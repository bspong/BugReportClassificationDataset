multitermquery scoring differences between 3x and trunk
try this patch with a test that applies clean to both 3x and trunk but fails on trunk. if you modify the test-data-generator to use TopTerms BoostOnly rewrite then it acts like TestFuzzyQuery2 and passes. So the problem is in TopTermsScoringBooleanRewrite or BooleanQuery or somewhere else. The bug is in TermQuery Term int docfreq if i change this to public TermQuery Term t int docFreq term t this.docFreq docFreq this.docFreq -1 then the test passes here s a patch really a bad bug the df was wrong here but never used until we started doing these optimizations recently. i committed the bugfix but i will write a good test before resolving the issue. the test i uploaded here is no good its huge and undebuggable and dependent on the scoring system. Uwe s assert in LUCENE-2690 is better than any test i could add here... it even found a bug in another TermEnum impl. Thanks 
