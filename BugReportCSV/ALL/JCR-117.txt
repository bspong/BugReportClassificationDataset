Test cases not fully initialized at first run
It seems that some test cases in o.a.j.test.api.query and o.a.j.test.api do not properly initialized the test repository before running tests against it. The repository gets initialized by other test cases and later runs of the troublesome tests report no errors. Thus the problem appears right after a fresh checkout and a tree cleanup. The command sequence below illustrates this problem. The error messages reported by the initial test runs are Workspace does not contain test data at testdata query and Workspace does not contain test data at testdata . I tried tracing the cause of this problem but couldn t find it easily as I m not yet too familiar with the test setup. svn co maven test      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 30 Errors 0 Time elapsed 5 333 sec      junit ERROR TEST org.apache.jackrabbit.test.api.query.TestAll FAILED      junit Running org.apache.jackrabbit.test.api.TestAll      junit Tests run 534 Failures 181 Errors 0 Time elapsed 16 105 sec      junit ERROR TEST org.apache.jackrabbit.test.api.TestAll FAILED maven test      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 0 Errors 0 Time elapsed 5 887 sec      junit Running org.apache.jackrabbit.test.api.TestAll      junit Tests run 534 Failures 0 Errors 0 Time elapsed 18 427 sec maven clean maven test      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 30 Errors 0 Time elapsed 13 185 sec      junit ERROR TEST org.apache.jackrabbit.test.api.query.TestAll FAILED      junit Running org.apache.jackrabbit.test.api.TestAll      junit Tests run 534 Failures 181 Errors 0 Time elapsed 40 42 sec      junit ERROR TEST org.apache.jackrabbit.test.api.TestAll FAILED maven test      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 0 Errors 0 Time elapsed 5 942 sec      junit Running org.apache.jackrabbit.test.api.TestAll      junit Tests run 534 Failures 0 Errors 0 Time elapsed 17 797 sec Updated the correct test output for the first two test runs. fixing a copy-paste mistake That is strange. Works fine on my machine. When I run the tests the sequence of test suites is      junit Running org.apache.jackrabbit.core.config.TestAll      junit Tests run 2 Failures 0 Errors 0 Time elapsed 0.591 sec      junit Running org.apache.jackrabbit.core.nodetype.xml.TestAll      junit Tests run 32 Failures 0 Errors 0 Time elapsed 0.851 sec      junit Running org.apache.jackrabbit.core.observation.TestAll      junit Tests run 1 Failures 0 Errors 0 Time elapsed 2.614 sec      junit Running org.apache.jackrabbit.core.query.TestAll      junit Tests run 63 Failures 0 Errors 0 Time elapsed 3.576 sec      junit Running org.apache.jackrabbit.core.state.TestAll      junit Tests run 3 Failures 0 Errors 0 Time elapsed 0.852 sec      junit Running org.apache.jackrabbit.core.TestAll      junit Tests run 13 Failures 0 Errors 0 Time elapsed 1.072 sec      junit Running org.apache.jackrabbit.init.TestAll      junit Tests run 4 Failures 0 Errors 0 Time elapsed 1.442 sec      junit Running org.apache.jackrabbit.test.api.lock.TestAll      junit Tests run 19 Failures 0 Errors 0 Time elapsed 1.983 sec      junit Running org.apache.jackrabbit.test.api.nodetype.TestAll      junit Tests run 99 Failures 0 Errors 0 Time elapsed 1.743 sec      junit Running org.apache.jackrabbit.test.api.observation.TestAll      junit Tests run 40 Failures 0 Errors 0 Time elapsed 6.711 sec      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 0 Errors 0 Time elapsed 3.195 sec      junit Running org.apache.jackrabbit.test.api.TestAll .... more tests .... In order to successfully run the read-only test cases the o.a.j.init.TestAll test suite must run before any o.a.j.test.api tests are run. Maybe this is an platform specific issue as we do not explicitly specify the sequence. Can you please check the sequence of test suites on your checkout My full test output from a fresh svn checkout is test test      junit Running org.apache.jackrabbit.test.api.query.TestAll      junit Tests run 77 Failures 30 Errors 0 Time elapsed 5 776 sec      junit ERROR TEST org.apache.jackrabbit.test.api.query.TestAll FAILED      junit Running org.apache.jackrabbit.test.api.nodetype.TestAll      junit Tests run 99 Failures 0 Errors 0 Time elapsed 2 702 sec      junit Running org.apache.jackrabbit.test.api.version.TestAll      junit Tests run 214 Failures 0 Errors 0 Time elapsed 58 748 sec      junit Running org.apache.jackrabbit.test.api.util.TestAll      junit Tests run 0 Failures 0 Errors 0 Time elapsed 0 457 sec      junit Running org.apache.jackrabbit.test.api.lock.TestAll      junit Tests run 19 Failures 0 Errors 0 Time elapsed 4 136 sec      junit Running org.apache.jackrabbit.test.api.observation.TestAll      junit Tests run 40 Failures 0 Errors 0 Time elapsed 9 sec      junit Running org.apache.jackrabbit.test.api.TestAll      junit Tests run 583 Failures 184 Errors 0 Time elapsed 30 213 sec      junit ERROR TEST org.apache.jackrabbit.test.api.TestAll FAILED      junit Running org.apache.jackrabbit.init.TestAll      junit Tests run 4 Failures 0 Errors 0 Time elapsed 3 529 sec      junit Running org.apache.jackrabbit.core.query.TestAll      junit Tests run 63 Failures 0 Errors 0 Time elapsed 7 55 sec      junit Running org.apache.jackrabbit.core.nodetype.xml.TestAll      junit Tests run 32 Failures 0 Errors 0 Time elapsed 1 551 sec      junit Running org.apache.jackrabbit.core.state.TestAll      junit Tests run 3 Failures 0 Errors 0 Time elapsed 2 681 sec      junit Running org.apache.jackrabbit.core.config.TestAll      junit Tests run 2 Failures 0 Errors 0 Time elapsed 0 801 sec      junit Running org.apache.jackrabbit.core.observation.TestAll      junit Tests run 1 Failures 0 Errors 0 Time elapsed 3 123 sec      junit Running org.apache.jackrabbit.core.TestAll      junit Tests run 13 Failures 0 Errors 0 Time elapsed 3 236 sec Produced using Maven 1.0.2 on JDK 1.4.2 on Linux Fedora Core 3 . I ll see if I can trace where the order of the test cases is determined.It seems that the Maven test test goal is implemented using the Ant JUnit task with a FileSet containing all files that match the unitTest includes defined in project.xml. I m not an expert on how Ant FileSets work under the hood but I believe that the order of the unit tests is determined either by a HashSet somewhere along the line or the order in which the underlying filesystem returns the file names. Based on the fact that your test cases seem to be executed in alphabetical order I d suspect that the problem is in the underlying filesystem on Linux you need to specifically sort file names if you want them ordered . I ll check if I could instruct Maven to process the tests in some specific order.No hope. Even specifying the test cases one by one in unitTest includes does not help. Would it be possible to refactor the initialization code so that either all API tests check for initialization in setUp or a separate Maven test test preGoal performs the initialization before any of the test cases are run Moved init test cases to a preGoal. Fixed in svn revision 210145Brilliant thanks a lot for the simple and effective fix 
