Wrap SegmentInfos in public class
Wrap SegmentInfos in a public class so that subclasses of MergePolicy do not need to be in the org.apache.lucene.index package. In order for this class to be compatible with out current default LogMergePolicy we ll need to expose readers from the IW reader pool. This is because presumably classes may need to access readers such as in LogMergePolicy.findMergesToExpungeDeletes. After looking at it I wasn t sure why we couldn t simply make the read only methods in SegmentInfo and SegmentInfos and the classes public. Maybe this can make it into 2.9 I agree it d be good to do this and this baby step making the read-only methods public seems like a good start. Would we want better names here Segments Segment as Earwin suggested a while back Can you also mark these classes as Expert and add the subject to change w o warning between releases caveat Added some more javadocs as suggested . More could be added to the SegmentInfo and SegmentInfos methods. Made SegmentReader public. I think we need to do this as it s becoming more necessary after LUCENE-1483 where the user may access individual readers Would we want better names here Segments Segment as Earwin suggested a while back Wouldn t this require a bunch of renaming refactoring Earwin what was your suggestion couldn t find it I don t think we should make IndexWriter s ReaderPool public just yet Maybe instead we can add API to query for whether a segment has pending unflushed deletes And fix core merge policies to use that API when deciding how to expungeDeletes . Reader pool isn t public anymore Left methods of reader as public could roll back I d rather that readerpool be public however since it s new I guess we don t want people relying on it All tests pass It would be great to get this into 2.9 Latest patch looks good Jason I ll commit soon. since it s new I guess we don t want people relying on it Right and we haven t thought about tested for users randomly checking out readers from a writer at different times it d make me nervous to expose that now. LogMergePolicy needs to access the pooled reader s num deletes. I ll add it remove IW.hasDeletes and offer IW.numDeletedDocs SegmentInfo Added IW.numDeletedDocs method which LogMergePolicy uses to obtain the delCount of an info Updated to trunk Attached patch with tiny changes made a few more read-only methods public fixed javadoc warning one formatting fix added CHANGES. I think it s ready to commit. I ll commit soon... Thanks Jason 
