bad normalization in sorted search returning TopDocs
FieldSortedHitQueue.maxscore is maintained in the lessThan method which never gets called if a single document is added to the queue . I ve checked in a test to TestSort.testTopDocsScores with the final assertion commented out. Proposed patch attached insert FieldDoc keeps track of maxscore and calls super.insert Object the maximum score is now kept track of even if it is less than 1.0 getMaxScore added This should also be slightly faster than the old way since there are only n comparisons against maxscore. Previously two comparisons would be done for every call to lessThan 2 nlog maybe fixed.
