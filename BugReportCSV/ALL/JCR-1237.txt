Change default value for respectDocumentOrder
The current default value for the search index configuration parameter respectDocumentOrder is true. Almost all applications are not interested in document order while this default adds significant overhead to query execution because document order information is present in the index but has to be calculated over the complete result set. I propose to change the default value to false and document this change in the 1.4 release notes. If an application relies on document order one can still explicitly set the parameter in the configuration to true.I agree. Defaults obviously can better have not a large performance hit certainly not when most apps don t use it but people are not aware of its impact. 1I was about to vote -1 on this but then I realized that the JCR spec doesn t actually require document order as the default ordering it s just an optional default. So 0 as this seems useful even though it does mean that a client would need to use some yet to be implemented custom extension to request document ordering on a workspace with this default configuration. Also we would need to change the QUERY XPATH DOC ORDER repository descriptor to false. As a somewhat questionable side effect this change would allow us to resolve JCR-591 and perhaps even JCR-392 as Won t Fix.Hmm I completely forgot about the repository descriptor. This is currently hard coded in a properties file. With Jackrabbit it is actually possible to have document order on results in one workspace but not in another one. Which raises an interesting question. What does QUERY XPATH DOC ORDER return in that case Jackrabbit should probably enable or disable document order on all workspaces and not selectively. Jukka wrote it does mean that a client would need to use some yet to be implemented custom extension my intention was to provide a default configuration where you won t have document order but if you wish the repository to do so you could enable it in the configuration.Marcel What does QUERY XPATH DOC ORDER return in that case I think the only really correct result would be for the descriptor to be false or actually not to exist in the first place . But given that few if any clients actually use that descriptor for in any real functional sense one could argue that the descriptor is more useful as an informational tool to human operators in which case making the descriptor reflect the default setting would also make sense. We could use the default setting from the Workspace template in repository.xml to decide the state of the QUERY XPATH DOC ORDER descriptor. my intention was to provide a default configuration where you won t have document order but if you wish the repository to do so you could enable it in the configuration. The information is still in the query index isn t it What should I do if I have a client that mostly doesn t about document order for most queries but occasionally would like to use the ordering within the same workspace The information is still in the query index isn t it I m not sure I understand your question. But the document order is never available in the index. It is always calculated. What should I do if I have a client that mostly doesn t about document order for most queries but occasionally would like to use the ordering within the same workspace You would set respectDocumentOrder to true and omit an order by in your query to get document order otherwise you should add an order by jcr score. This effectively disables document order.Marcel I m not sure I understand your question. But the document order is never available in the index. It is always calculated. Sorry my obscured point was that the query engine is still able to return results in document order even if the default would be to not do that. Unfortunately there is no way for a client to explicitly request that the results should be document-ordered if that s not the default. But I guess that s a secondary concern and probably should be addressed with a separate feature request. 1 to change the default for respectDocumentOrder to false . Most people don t care about document order but about performance and they should get the best performance as possible by default. It s better to let the minority find out how to enable document order than to let the majority find out how to make jackrabbit perform better. I think the descriptor should just tell that document order is not supported. Anyone can still enable it for whichever workspaces they like.I ve changed the default for respectDocumentOrder to false. The repository descriptor QUERY XPATH DOC ORDER still returns true. If code relies on results in document order the workspace.xml needs to be adapted when upgrading to 1.5. Committed in revision 612420I think we should drop the QUERY XPATH DOC ORDER descriptor. It s absence doesn t mean that the repository couldn t return query results in document order if so configured.I disabled the QUERY XPATH DOC ORDER descriptor in revision 613226.This also mean that the four test cases in XPathDocOrderTest are now not executable anymore.
