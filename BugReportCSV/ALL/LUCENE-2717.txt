BasicOperations.concatenate creates invariants
I started writing a test for LUCENE-2716 and i found a problem with BasicOperations.concatenate Automaton Automaton it creates automata with invariant representation which should never happen unless you manipulate states transitions manually . strangely enough the BasicOperations.concatenate List Automaton does not have this problem. attached is a patch with test and a sub-optimal fix. I ll work on a better fix. here s the fix. the problem is if you concatenate empty with any automaton the result must be empty. so if the RHS was empty the concatenation was correct but it would create epsilon transitions from the LHS s accept states all to dead states... in the fix i just return makeEmpty if either is empty which is a very quick check. will commit soon. Committed revision 1026104
