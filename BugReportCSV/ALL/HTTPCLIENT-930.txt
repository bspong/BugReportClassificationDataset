Unencoded redirect URI causes exception when following redirects
When HttpClient is set to follow redirects the DefaultRedirectHandler gets the redirect location from the appropriate request header and attempts to create a new java.net.URI from it. If the location contains an invalid URI character creating the URI fails. For example if the redirect location were foo bar baz it would fail because the and are not legal in a URI. I m not sure if this should actually be considered a bug in HttpClient since the website in question should probably be responsible for encoding the URI appropriately however browsers handle the situation gracefully and it would be nice if this excellent library would do so as well.We had similar reports in the past and they all were rejected as invalid see HTTPCLIENT-778 for example. I am also not sure the way browsers handle this kind of problems can be defined as graceful. I suspect that browsers simply use the good ol principle of garbage in - garbage out and do not even attempt to escape redirect urls. What theoretically can be done about is the following the abs path and query parts of the redirect URI are scanned for illegal characters and if any is found the entire URI is considered un-escaped. This of course does not help if you have situations like that Ê garbage 20in 20garbage 20 param screw you all . Bottom line malformed request URIs are inherently ambiguous and there is nothing that can be done about it. Oleg ÊYeah I can t disagree with any of that. For my application at least I ll have to try the escape if it looks unescaped thing. If you don t want to add support for that in HttpClient can I get a new method in DefaultRedirectHandler that I can override and add this behavior to Either protected String getLocation HttpResponse response ... or protected URI createLocationUri String location ... Extract one or both of these methods from the getLocationURI method and then I could encode the string either after it gets extracted from the response or before the URI is built.Implemented in SVN trunk http svn.apache.org viewvc rev 930560 view rev Please note HttpClient 4.1 uses newer interface RedirectStrategy instead of deprecated RedirectHandler Oleg
