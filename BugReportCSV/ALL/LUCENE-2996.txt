addIndexes IndexReader incorrectly applies existing deletes
If you perform these operations deleteDocuments Term for all the new documents addIndexes IndexReader commit Then addIndexes applies the previous deletes on the incoming indexes as well which is incorrect. If you call addIndexes Directory instead the deletes are applied beforehand as they should. The solution as Mike indicated here http osdir.com ml general 2011-03 msg20876.html is to add flush false true to addIndexes IndexReader . I will create a patch with a matching unit test shortly. Patch adds a test to TestAddIndexes and the trivial fix to IndexWriter against 3x . I will port to trunk and 3.1 branch after a review. Shai patch looks ok. shouldn t the test use newIndexWriterConfig TEST VERSION CURRENT new MockAnalyzer instead of new IndexWriterConfig ... shouldn t the test use newIndexWriterConfig TEST VERSION CURRENT new MockAnalyzer instead of new IndexWriterConfig ... Good catch it was a remnant from the time this test was a static main . Committed revision 1086275 3x . Committed revision 1086288 trunk . I don t know if it s ok to commit to branches lucene solr 3 1 just yet so I ll keep this open for now. Committed revision 1087647 3.1.1 . Bulk closing for 3.2
