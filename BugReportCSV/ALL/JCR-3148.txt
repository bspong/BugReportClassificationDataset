Using transactions still leads to memory leak
This is a result of the way that JCR-395 was fixed. If you look at the code you ll see that txGlobal.remove xid is called as the last statement in both XASessionImpl.commit and XASessionImpl.rollback . However in both methods an exception could be thrown either as a result of calling tx.commit or tx.prepare and tx.rollback . As a result the transaction will not be removed from txGlobals whenever the commit or the rollback has failed for any reason. My suggestion would be to move the txGlobal.remove xid into a finally block.Moved txGlobals.remove xid into finally blockthanks for the patch. commited patch in rev. 1202144 If you need it in the 2.2 branch please comment on this issueMerged to the 2.2 branch in revision 1235755.
