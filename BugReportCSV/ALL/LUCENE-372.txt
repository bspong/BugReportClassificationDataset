Unmatched right parentheses truncates query
The query processor truncates a query when right parentheses are unmatched. E.g. secret AND illegal AND access confidential will not result in a ParseException instead will run as secret AND illegal The reason for this is that the parse method does not ensure that the entire input string has been consumed. Query will simply return if it encounters an unexpected token relying on its caller to consume that token. If the query is nested the call will throw an exception. But at the top-level the caller is parse and it does not make sure that EOF is reached. A simple fix is to introdice a new nonterminal TopLevelQuery Query EOF and parse calls TopLevelQuery. I have a patch for this will post it together with a few new unit test cases for this. Andreas. This patch contains 5 files I was not sure whether to include the JavaCC-generated files ended up including them QueryParser.jJ introduced a new nonterminal TopLevelQuery QueryParser.java generated from QueryParser.jj by javaCC QueryParserTokenManager.java generated from QueryParser.jj by javaCC TestQueryParser.java rewrote testException and added a few more tests. TestMultiFieldQueryParser.java fixed testSimple because it was passing in unbalanced quotation marks. That caused a failure with the new QueryParser. Andreas. Somehow the patch got some extra line feeds in some of the javacc created files. This version takes those out. I like it. There are some extra tests that demonstrate where parse exceptions are going to be thrown which is nice. It would be nice if we could perhaps be more liberal in what we accept. For example I ve always thought it would be nice if we could add in missing terminators e.g. quotes parentheses. in the spirit of being liberal in what you accept. But I don t see that being too feasible with an automatically generated parser. I do think completely ignoring terms which this patch fixes is the wrong way to be liberal. I just committed this. Thanks Andreas 
