MockDirectoryWrapper should wrap the lockfactory
After applying the patch from LUCENE-3147 I added a line to make the test fail if it cannot remove its temporary directory. I ran ant test on linux 50 times and it passed all 50 times. But on windows it failed often because of write.lock... this is because of unclosed writers in the test. MockDirectoryWrapper is currently unaware of this write.lock I think it should wrap the lockfactory so that .close will fail if there are any outstanding locks. Then hopefully these tests would fail on linux too. attached is a patch... all the windows-only problems i found with LUCENE-3147 now fail on linux and are corrected in the patch Patch looks great Nice to have MDW catch un-released locks too ok i committed to our branch... i ll keep testing with windows but I think between the two issues we have now fixed all the bugs in MockDirectoryWrapper so it consistently acts like windows . This is great I think this one can be committed. I ran tests on my Windows machine and all passed. Robert can we close this now that LUCENE-3147 is closed oops i meant to close this bulk close for 3.3
