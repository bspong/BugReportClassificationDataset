Config incorrectly handles Windows absolute pathnames
I have no idea how no one ran into this so far but I tried to execute an .alg file which used ReutersContentSource and referenced both docs.dir and work.dir as Windows absolute pathnames e.g. d something . Surprisingly the run reported an error of missing content under benchmark work something. I ve traced the problem back to Config where get String String includes the following code if sval.indexOf 0 return sval first time this prop is extracted by round int k sval.indexOf String colName sval.substring 0 k sval sval.substring k 1 ... It detects in the value and so it thinks it s a per-round property thus stripping d from the value ... fix is very simple if sval.indexOf 0 return sval else if sval.indexOf 0 this previously messed up absolute path names on Windows. Assuming there is no real value that starts with return sval first time this prop is extracted by round int k sval.indexOf String colName sval.substring 0 k sval sval.substring k 1 I ll post a patch w the above fix test shortly. The fix is only relevant to get String String and not to all other get String type variants. Benchmark test passed but after I svn up to include the latest parallel test thing the test just sits idle after finishing waiting for something. If I run the tests in eclipse they pass. So I m guessing it s a problem w my env. or build.xml I also tried ant clean test from within benchmark but it didn t help. I then tried ant clean from root and ant test from benchmark but the test just keeps waiting on WriteLineDocTaskTest on this line junit config properties junit directory RAMDirectory junit doc.maker org.apache.lucene.benchmark.byTask.tasks.WriteLineDocTaskTest JustDateDocMaker junit line.file.out D dev lucene lucene-trunk build contrib benchmark test W one-line junit I think this can go in if it passes on someone else s machine while I figure out what s wrong in my env. separately. I don t have an account yet so I cannot commit this on my own. Any volunteers Updated to also match c temp like paths which are also accepted on Windows Unless there are objections I plan to commit this shortly Committed revision 929520. Shai I am having the same issue with the test hanging on my Windows box with both Revision 931573 and Revision 931304 when running the tests from root. Tests hang in WriteLineDocTaskTest on this line junit config properties junit directory RAMDirectory junit doc.maker org.apache.lucene.benchmark.byTask.tasks.WriteLineDocTaskTest JustDateDocMaker junit line.file.out D dev lucene lucene-trunk build contrib benchmark test W one-line junit Should I open a separate JIRA issue about the test Tom Burton-West Actually we ve reopened LUCENE-1709 to track that. This is not related to this issue s changes but seems to be related to benchmark test in specifically. Please have a look there at a patch I ve posted which forces benchmark tests to run in sequential mode. Additionally you can ant test -Drunsequential 1 from the command line benchmark s root folder to achieve the same. And it d be great if you post the above on LUCENE-1709 as well Ð because now I know I m not the only one running into this .
