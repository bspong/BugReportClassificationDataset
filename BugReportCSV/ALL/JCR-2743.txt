ClassCastException in GroupImpl.isCyclicMembership
Given three groups and one user with the following membership relation group1 group2 group3 group2 user where x y means x contains y. group3.addMember group1 throws a ClassCastException. The reason is that the search type i.e. UserManager.SEARCH TYPE GROUP is not honored correctly when constructing the transitive membership relation.BTW this was introduced with JCR-2726Here is a test proving the case             group1 userMgr.createGroup getTestPrincipal             group2 userMgr.createGroup getTestPrincipal             group3 userMgr.createGroup getTestPrincipal             group1.addMember getTestUser superuser             group2.addMember getTestUser superuser             assertTrue group1.addMember group2             assertTrue group2.addMember group3             assertFalse group3.addMember group1 the last line throws a ClassCastExceptionFixed at revision 995401
