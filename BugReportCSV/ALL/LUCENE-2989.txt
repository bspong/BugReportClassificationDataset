TestCollectionUtil fails on IBM JRE
 junit Testcase testEmptyArraySort org.apache.lucene.util.TestCollectionUtil Caused an ERROR junit CollectionUtil can only sort random access lists in-place. junit-sequential junit Testsuite org.apache.lucene.util.TestCollectionUtil junit Tests run 1 Failures 0 Errors 1 Time elapsed 0.173 sec junit junit Standard Error junit NOTE reproduce with ant test -Dtestcase TestCollectionUtil -Dtestmethod testEmptyArraySort -Dtests.seed 7789232519167372758 -4267884142251261003 junit NOTE test params are codec PreFlex locale fr CH timezone America Nassau junit NOTE all tests run in this JVM junit TestCollectionUtil junit NOTE Windows Vista 6.0 build 6002 Service Pack 2 x86 IBM Corporation 1.6.0 32-bit cpus 4 threads 2 free 374312 total 4194304 junit junit Testcase testEmptyArraySort org.apache.lucene.util.TestCollectionUtil Caused an ERROR junit CollectionUtil can only sort random access lists in-place. junit java.lang.IllegalArgumentException CollectionUtil can only sort random access lists in-place. junit at org.apache.lucene.util.CollectionUtil.getSorter CollectionUtil.java 70 junit at org.apache.lucene.util.CollectionUtil.quickSort CollectionUtil.java 113 junit at org.apache.lucene.util.TestCollectionUtil.testEmptyArraySort TestCollectionUtil.java 95 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1214 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1146 junit junit junit Test org.apache.lucene.util.TestCollectionUtil FAILED The issue looks like a bug in IBM s Collections class but it isn t. The List returned by emptyList does not implement RandomAccess. I fixed the test unfortunately it s clear that emptyList should return a random access list but it s not in the spec so it s not really IBM s fault . The fix is to use a realy empty Array and wrap it with Arrays.asList . Robert can you test test passes I will commit to trunk 3.x If we respin 3.1 we could also merge there but its not a blocker. Committed trunk revision 1085004 Committed 3.x revision 1085006 I will keep this issue open that we can merge to 3.1 branch too. Merged also to 3.1.0 Bulk close for 3.1
