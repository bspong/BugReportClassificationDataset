Deployment of webdav servlet on Jboss problem - logging
Tested two different installs of JBoss to verify problem is not related to a specific version. There is a problem with the jackrabbit-server.war when deploying on jboss. Here are the details during deployment 13 20 48 654 INFO TomcatDeployer deploy ctxPath jackrabbit-server warUrl ... deploy jackrabbit-server.war 13 20 48 857 INFO STDOUT log4j ERROR A org.jboss.logging.util.OnlyOnceErrorHandler object is not assignable to a o rg.apache.log4j.spi.ErrorHandler variable. 13 20 48 857 INFO STDOUT log4j ERROR The class org.apache.log4j.spi.ErrorHandler was loaded by 13 20 48 857 INFO STDOUT log4j ERROR WebappClassLoader   delegate false   repositories      WEB-INF classes Parent Classloader java.net.FactoryURLClassLoader 19d277e whereas object of type 13 20 48 857 INFO STDOUT log4j ERROR org.jboss.logging.util.OnlyOnceErrorHandler was loaded by org.jboss.system.se rver.NoAnnotationURLClassLoader ab95e6 . 13 20 48 904 INFO STDOUT log4j ERROR Could not create an Appender. Reported error follows. 13 20 48 904 INFO STDOUT java.lang.ClassCastException org.jboss.logging.appender.DailyRollingFileAppender 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.parseAppender DOMConfigurator.java 165 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.findAppenderByName DOMConfigurator.java 140 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.findAppenderByReference DOMConfigurator.java 153 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.parseChildrenOfLoggerElement DOMConfigurator.jav a 415 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.parseRoot DOMConfigurator.java 384 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.parse DOMConfigurator.java 783 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.doConfigure DOMConfigurator.java 666 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.doConfigure DOMConfigurator.java 616 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.doConfigure DOMConfigurator.java 602 13 20 48 904 INFO STDOUT at org.apache.log4j.helpers.OptionConverter.selectAndConfigure OptionConverter.java 460 13 20 48 904 INFO STDOUT at org.apache.log4j.LogManager. clinit LogManager.java 113 13 20 48 904 INFO STDOUT at org.apache.log4j.xml.DOMConfigurator.configure DOMConfigurator.java 543 13 20 48 904 INFO STDOUT at org.apache.jackrabbit.j2ee.LoggingServlet.configureXML LoggingServlet.java 148 13 20 48 904 INFO STDOUT at org.apache.jackrabbit.j2ee.LoggingServlet.configure LoggingServlet.java 115 13 20 48 904 INFO STDOUT at org.apache.jackrabbit.j2ee.LoggingServlet.init LoggingServlet.java 86   Unlike most logging problems this is having an impact during runtime - when trying to do DASL searches will return a 500 error as the server was unable to log correctly. Installation was based on http wiki.apache.org jackrabbit JackrabbitOnJBoss Runtime error details causing 500 error on DASL searches 10 37 42 569 INFO STDOUT 12.07.2006 10 37 42 INFO RepositoryAccessServlet Acquired repository via JNDI. Reposito ryAccessServlet.java line 133 10 37 42 569 INFO STDOUT 12.07.2006 10 37 42 INFO RepositoryAccessServlet Jackrabbit v1.0-dev RepositoryAccessSe rvlet.java line 196 10 37 42 631 INFO jcr local Created session org.apache.jackrabbit.core.XASessionImpl 566b3e 10 37 42 710 WARN JBossManagedConnectionPool Destroying connection that could not be successfully matched org.jboss. resource.connectionmanager.TxConnectionManager TxConnectionEventListener 19ab9c5 state NORMAL mc org.apache.jackrabbit.j ca.JCAManagedConnection 1ba1894 handles 0 lastUse 1152715062678 permit false trackByTx false mcp org.jboss.resource.conn ectionmanager.JBossManagedConnectionPool OnePool a3bb2e context org.jboss.resource.connectionmanager.InternalManagedConn ectionPool 155e508 xaResource org.apache.jackrabbit.core.XASessionImpl 566b3e txSync null 10 37 42 710 INFO jcr local Created session org.apache.jackrabbit.core.XASessionImpl dd23cf 10 37 42 710 INFO STDOUT 12.07.2006 10 37 42 INFO JCRWebdavServer login User root logged in. JCRWebdavServer. java line 177 10 37 42 850 INFO STDOUT 12.07.2006 10 37 42 INFO JCRWebdavServer Removed reference org.apache.jackrabbit.webdav. WebdavRequestImpl 1ff3fcf to session org.apache.jackrabbit.server.jcr.JCRWebdavServer DavSessionImpl 1461c98 JCRWebdavS erver.java line 211 10 37 42 850 INFO STDOUT 12.07.2006 10 37 42 INFO JCRWebdavServer No more references present on webdav session -  clean up. JCRWebdavServer.java line 217 10 37 42 850 INFO STDOUT 12.07.2006 10 37 42 ERROR JCRWebdavServer Servlet.service for servlet JCRWebdavServer  threw exception Log4JLogger.java line 119 java.lang.IllegalStateException Inactive logical session handle called         at org.apache.jackrabbit.jca.JCAManagedConnection.getSession JCAManagedConnection.java 214         at org.apache.jackrabbit.jca.JCASessionHandle.getSession JCASessionHandle.java 84         at org.apache.jackrabbit.jca.JCASessionHandle.getUserID JCASessionHandle.java 98         at org.apache.jackrabbit.server.jcr.JCRWebdavServer SessionCache.getUserID JCRWebdavServer.java 288         at org.apache.jackrabbit.server.jcr.JCRWebdavServer SessionCache.removeReference JCRWebdavServer.java 222         at org.apache.jackrabbit.server.jcr.JCRWebdavServer SessionCache.access 400 JCRWebdavServer.java 139         at org.apache.jackrabbit.server.jcr.JCRWebdavServer DavSessionImpl.removeReference JCRWebdavServer.java 132         at org.apache.jackrabbit.server.jcr.JCRWebdavServer.releaseSession JCRWebdavServer.java 93         at org.apache.jackrabbit.server.AbstractWebdavServlet.service AbstractWebdavServlet.java 203         at javax.servlet.http.HttpServlet.service HttpServlet.java 810         at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter ApplicationFilterChain.java 252         at org.apache.catalina.core.ApplicationFilterChain.doFilter ApplicationFilterChain.java 173         at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter ReplyHeaderFilter.java 96         at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter ApplicationFilterChain.java 202         at org.apache.catalina.core.ApplicationFilterChain.doFilter ApplicationFilterChain.java 173         at org.apache.catalina.core.StandardWrapperValve.invoke StandardWrapperValve.java 213         at org.apache.catalina.core.StandardContextValve.invoke StandardContextValve.java 178         at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke SecurityAssociationValve.java 175         at org.jboss.web.tomcat.security.JaccContextValve.invoke JaccContextValve.java 74         at org.apache.catalina.core.StandardHostValve.invoke StandardHostValve.java 126         at org.apache.catalina.valves.ErrorReportValve.invoke ErrorReportValve.java 105         at org.apache.catalina.core.StandardEngineValve.invoke StandardEngineValve.java 107         at org.apache.catalina.connector.CoyoteAdapter.service CoyoteAdapter.java 148         at org.apache.coyote.http11.Http11Processor.process Http11Processor.java 869         at org.apache.coyote.http11.Http11BaseProtocol Http11ConnectionHandler.processConnection Http11BaseProtocol.java 664         at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket PoolTcpEndpoint.java 527         at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run MasterSlaveWorkerThread.java 112         at java.lang.Thread.run Thread.java 595 Hi Darren IMO these are unrelated problems. 1 13 20 48 857 INFO STDOUT log4j ERROR A org.jboss.logging.util.OnlyOnceErrorHandler object is not assignable to a o rg.apache.log4j.spi.ErrorHandler variable. I think this is caused by a duplicated jar in your deployment we should probably update the instructions at http wiki.apache.org jackrabbit JackrabbitOnJBoss. A quick fix would be to remove log4j from the war and remove all the lines in the log4j.xml descriptor. e.g. WEB-INF log4j.xml xml version 1.0 encoding UTF-8 DOCTYPE log4j configuration SYSTEM log4j.dtd log4j configuration xmlns log4j http jakarta.apache.org log4j log4j configuration 2 java.lang.IllegalStateException Inactive logical session handle called         at org.apache.jackrabbit.jca.JCAManagedConnection.getSession JCAManagedConnection.java 214 This problem is caused by a problem in a logging call which afaik shouldn t affect the servlet normal behaviour. it s fixed in rev. 421405 br edgarchanging priority since afaik it s only a logging problemconfirmed removing log4j.jar and modifying the log4j.xml file corrected the logging problem. Also tested on 421603 and the described problem has disappeared.
