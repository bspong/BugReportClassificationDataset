Support easy pre-authenticated login
Some applications authenticate users themselves and just need to access the repository on behalf of these pre-authenticated users. Examples of such pre-authentications include SSO solutions or web applications using a web-based authentication protocol not easily implementable in a JAAS LoginModule for example OpenID or similar. In such situations a password may not be provided in SimpleCredentials and thus regular login with user name and password is not possible. Therefore I propose the enhancement of the AbstractLoginModule to allow for setting a specific attribute in the SimpleCredentials attribute map. If this attribute is set authentication and login succeeds and a session for the user named in the SimpleCredentials is created. As a starter we might just check for the presence of the attribute.Patch extending the AbstractLoginModule with support for pre-authentication. This patch adds the following    Support for a configuration parameter declaring a SimpleCredentials attribute for pre-authentication    Add an isPreAuthenticated Credentials method used by the login method The isPreAuthenticated method is protected and can be overwritten by AbstractLoginModule implementations to either switch pre authentication off completely or to apply different and more elaborate checks on the credentials.After having received the ok from Angela I commit this patch in Rev. 825125. 0 This approach seems a bit hacky to me a separate SingleSignOnCredentials class would feel cleaner or perhaps an out-of-band approach often used by JAAS implementations but it s probably the most straightforward and easy to implement solution to the described use case.Ahem this can be a security breach This attribute trust credentials attribute on SimpleCredentials basically works as a very simple master password. Hence this patch implicitly trusts the calling code but if the repository is available eg. via RMI anyone could connect to it and log in as any user because that attribute can be set over RMI afaik . A big -1. It should rather be easy to write a special login module that can be set by configuration and handles SSO things and co. I agree that the security might be hampered with when this is used unknowningly. Still it must explicitly be enabled on a repository configuration level and the default is that it is not enabled. I am perfectly ok to raise the requirements for the attribute above the basic presence. For example we could say the attribute must be set to a session which has certain access rights. This would limit the use of this functionality to code which already has access to the repository at a certain level. On another you raised your veto. Do you stand by this veto In this case since you are a member of the PMC I would have to remove the code again.Ok I thought it would be enabled by default. Hence I revert my -1 vote. I would note that one should see this attribute like a password that then must be set on both the client code and the repository configuration. It should rather be easy to write a special login module that can be set by configuration and handles SSO things and co. As Felix pointed out to me certain login mechanisms like openID which involve multiple http requests cannot be easily done by a jackrabbit loginmodule.Thanks for reverting your veto. So We keep this change committed.
