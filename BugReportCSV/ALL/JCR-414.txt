jcr successors property not persisted correctly within a transaction
During a transaction if you create a new version then read the version history the jcr successors property is not updated. Note that jcr predecessors is updated properly. Also the version history is sometimes not propertly read. During the transaction it might appear empty. This behavior in not consistent from one execution to another. After a restart of the repository the version history and the jcr successors property is read properly. Tests cases will follow shortly. Thanks NicolasShows that jcr successors in not properly updated in the context of a transaction.If you execute this a couple of times you should notice that reads are not consistent. Sometimes the version history is empty on the first print sometimes not. Note also that successors are never updated correclty.i modified the versionmanager behaviour a little. the jcr successor virtual property is not longer virtual but is also persisted in the version persistence manager. unfortunately this does not fix this issue at all. it is a fundamental problem that modifications to the version store within a transaction are not seen from the session using that transaction. i also added a new testcase that finds this problem. v1 is a version from session 1 v2 the same version from session 2 Ê ÊOK V1 name jcr rootVersion succ 0 ÊOK V2 name jcr rootVersion succ 0 checkout checkin n1 uncommitted ERR V1 name jcr rootVersion succ 0 1 ÊOK V2 name jcr rootVersion succ 0 ÊOK V1 name 1.0 succ 0 checkout checkin n1 comitted ÊOK V1 name jcr rootVersion succ 1 ÊOK V2 name jcr rootVersion succ 1 ÊOK V1 name 1.0 succ 0 As you can see the number of successors is only correct after the commit. the same happens for RemoveVersion . this probably needs a more thorough change to the code.fixed. Committed revision 412995.
