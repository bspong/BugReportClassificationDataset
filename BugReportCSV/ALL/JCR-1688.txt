Query parser builds invalid parse tree
Calling org.apache.jackrabbit.spi.commons.query.QueryParser.parse on SELECT prop1 FROM nt unstructured WHERE prop1 IS NOT NULL ORDER BY prop1 ASC results in the following parse tree Select properties prop1   PathQueryNode     LocationStepQueryNode NodeTest Descendants true Index NONE       RelationQueryNode Op NOT NULL Prop prop1 Type STRING Value       NodeTypeQueryNode Prop http www.jcp.org jcr 1.0 primaryType Value http www.jcp.org jcr nt 1.0 unstructured   OrderQueryNode     prop1 asc true The RelationQueryNode should not have a second operand since the NOT NULL operator is unary. Another query which creates a bad parse tree SELECT FROM nt base WHERE jcr path LIKE AND NOT jcr path LIKE results in Select properties    PathQueryNode      LocationStepQueryNode NodeTest Descendants false Index NONE      LocationStepQueryNode NodeTest Descendants false Index NONE        AndQueryNode          NotQueryNode Note the AndQueryNode having a single operand and the NotQueryNode having no operand at all.Fixed the first issue in revision 679054Also fixed second issue. svn revision 679093 Thank you for reporting this issue.Works great thanks.
