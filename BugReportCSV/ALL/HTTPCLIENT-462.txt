ProtocolException thrown on slightly broken headers
HTTPClient throws an exception when parsing headers returned by GET from the following URL Êhttp butler.cit.nih.gov hembase hembase.taf The headers returned are as follows HTTP 1.0 200 OK r nServer WebSTAR 1.0 ID ACGI r nMIME-Version 1.0 r nContent-Type text html r nSet-Cookie Tango UserReference ADC5871C57FABEDEC63DD47B path n r r n r n DOCTYPE HTML PUBLIC - W3C DTD HTML 4.01 Transitional EN ... Please note the superfluous r in the line separating headers from the body. IMHO this type of error should generate a warning but then it should cause a graceful recovery. Currently a ProtocolException is thrown. Standard java.net.HttpURLConnection handles this just fine without giving any warning.Created an attachment id 15153 Patch take 1 I can t say I agree entirely but I can live with this patch OlegAndrzej It s not an extra r but rather n and r are swapped. Headers must be separated with r n. But the cookie header rather ends in n r. Which I find a bad violation of the specs really. What is WebSTAR 1.0 anyway Yes it s plainly broken but still I would expect HttpClient to gracefully recover from this... Oleg s patch solves this for me - thanks I have no idea what that server is it s just one out of a large number of sites that I m crawling.Looks good to me. A test case would be nice though... MikeCreated an attachment id 15248 Patch test case All right. How about this OlegLooks good. MikePatch committed. Oleg
