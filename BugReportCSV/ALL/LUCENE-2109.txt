Make DocsEnum subclass of DocIdSetIterator
Spinoff from LUCENE-1458 One thing I came along long time ago but now with a new API it get s interesting again DocsEnum should extend DocIdSetIterator that would make it simplier to use and implement e.g. in MatchAllDocQuery.Scorer FieldCacheRangeFilter and so on. You could e.g. write a filter for all documents that simply returns the docs enumeration from IndexReader. So it should be an abstract class that extends DocIdSetIterator. It has the same methods only some methods must be a little bit renamed. The problem is because java does not support multiple inheritace we cannot also extends attributesource Would DocIdSetIterator be an interface it would work this is one of the cases where interfaces for really simple patterns can be used like iterators . The problem with multiple inheritance could be solved by an additional method attributes that creates a new AttributeSource on first access then because constructing an AttributeSource is costly . The same applies for the other Enums it should be separated for lazy init. DocsEnum could look like this public abstract class DocsEnum extends DocIdSetIterator private AttributeSource atts null public int freq public DontKnowClassName positions public final AttributeSource attributes if atts null atts new AttributeSource return atts ...default impl of the bulk access using the abstract methods from DocIdSetIterator Here the patch. The DocIdSetIterator approach can be easily used for some queries or scorers as it could be e.g. directly returned by filters. A TermFilter is simply returning the DocsEnum for the specific TermRef as iterator very simple. Small updates in JavaDocs were sometimes copied from deprecated classes . What do you think can we move this way and commit this Looks great Uwe I d say commit it. OK will do shortly after all tests are run also contrib bw this time . Thanks for reviewing. Here the latest patch with fixed contrib there were still some next calls on DocsEnum . All tests pass. I will commit later this evening ok Again the patch. I made the attributes calls unfinal which is not the best to ensure final but the FilteredTermsEnum needs to override the method to return the attributes of the underlying TermsEnum. So everybody happy Looks good Uwe Vielen Dank für diese Gründlichkeit. Danke Mache ich doch gerne Committed revision 887509 Thanks for reviewing 
