if you use setNorm lucene writes a headerless separate norms file
In this case SR.reWrite just writes the bytes with no header... we should write it always. we can detect in these cases segment written 3.1 with a sketchy length maxDoc check. changing fix version to 3.2 especially given LUCENE-3014 Updated patch against branch 3x for simplicity that uses the LUCENE-3014 comparator API. Because separate norms files are independent of the version that created the segment e.g. one can call setNorm with 3.6 for a 3.1 segment I think its really important that we fix this in 3.2 to write the header. If there are no objections I d like to commit and then regenerate the tentative 3.2 indexes for trunk s TestBackwardsCompatibility. There s no need to change the fileformats.html documentation as what we are doing now is actually inconsistent with it thus the bug. I agree this is important to fix Patch looks good. Committed revision 1124366 1124369 Bulk closing for 3.2
