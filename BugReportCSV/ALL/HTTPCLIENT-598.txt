ContentLengthInputStream does not implement available properly
ContentLengthInputStream should either extend FilterInputStream or should delegate available to wrappedStream. Otherwise available on the response stream an instance of AutoCloseInputStream which is properly extending FilterInputStream and therefore delegating to the ContentLengthInputStream always returns 0. This issue is important for the clients that try to improve performance by processing all data that can be read in a non-blocking way before blocking on the network.Proposed fix. Please review and let me know what you think OlegOleg I think this fix does not work. The contract of available is that it guarantees many bytes read will return successfully and without blocking. A better fix seems to be public int available throws IOException         if closed               return 0         int avail this.wrappedStream.available         if pos avail contentLength             avail contentLength - pos         return avail Yes indeed. This does seem like the right fix. Folks if I hear no complaints I ll commit the patch in a few days OlegPatch checked in. Many thanks Igor. Oleg
