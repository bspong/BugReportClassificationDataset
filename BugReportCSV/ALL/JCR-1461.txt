Deadlock on concurrent commit checkin operations
Running concurrently jackrabbit transactions including checkin operations leads to deadlock.Thread dump attached 2 threads only Can you please provide a test case So far I haven t been able to reproduce the deadlock with a test. Just looking at the thread dump we can avoid the deadlock by pulling the getPath in LockManagerImpl.getLockInfo out of the acquire release scope. I ve attached a patch with that change. Przemo can you please build jackrabbit-core-1.3.4-rc1 again with this patch applied and check if the deadlock still occurs It also seems that there s another thread involved in the deadlock. Can you please attach the complete thread dump Stripping off application specific stack frames is of course OK.Hm deadlock occured when running 2 threads only. How do you know that another thread was involved I thought there was another thread holding the write lock on the SISM of the version manager but it is in fact the grinder thread 1. The So you re right those are the only two threads than can be involved.The patch seems correct enough to me would there be a need to get the path within the locked region so I d like to commit it to trunk and the 1.3 branch for proceeding with a 1.3.4 release candidate. would there be a need to get the path within the locked region according to dominique pfister this is not needed. based on his statement I ve moved the call further up outside the locked region. Feel free to commit the patch or let me know if I should do it.Could we wait for feedback from Przemo re re-runnig his test using the patched jackrabbit 1.3.4rc Could we wait for feedback from Przemo re re-runnig his test using the patched jackrabbit 1.3.4rc Sure. Przemo any update Patch applied in revision 637106. Merged to 1.4 in revision 637107 and to 1.3 in revision 637110. Resolving as Fixed as it seems obvious that at least the specific deadlock issue shown in the thread dump can not occur after this fix. Please reopen only if there s a regression caused by this issue and file separate issues if other deadlocks occur.I ve finally been able to reproduce the deadlock with new random operation tests. I ll commit them soon. Btw that s without the patch that Jukka recently applied.
