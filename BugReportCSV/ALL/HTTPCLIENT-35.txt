 HttpClient Better proxy support in HttpMultiClient
If proxy requires authentication it sends status 407 Proxy Authentication Required and the response header Proxy-Authenticate see RFC2616 e.g. Squid can be configured to do so . HttpClient doesn t yet process this response. Behavior should be similar to processing of status 401 Unauthorized . HTTPCLIENT-64 has been marked as a duplicate of this bug. Fullly supported proxy authentication and handling is required. Needs functional unit testing as well setup public test proxy Encapsulate proxy details into a class as was done in LatkaI just submitted a patch to the mailing list.Created an attachment id 2380 Cummulative patch for SSL and proxy auth Created an attachment id 2382 new file ConnectMethod.java not included in patch The above patch contains the following changes - Proxy Authentication - SSL tunneling through proxies ConnectMethod - free choice of the SSLSocketFactory - setting SO TIMEOUT from HttpClient - POST method accepts InputStream as body - POST and PUT do not follow redirects by default - GetMethod doc Note that HttpMultiClient was not touched. Testing was done with one of our applications that uses HttpClient against an authencticating proxy using SSL SSLava . Still all the Webapp tests need to be modified so that one can specify if to run them through a proxy or not. Evert This patch contains the patch that I sent you three weeks ago so this patch will conflict with the one you supplied earlier but was only partly committed. I attach a patch file along with a newly added source file. Since I have no commit rights I can not add a file myself. I tried to keep the diff as clean as possible.Created an attachment id 2410 updated Patch resolved conflicts do not use old one Created an attachment id 2411 updates File ConnectMethod do not use old one Patches awaiting approval. HTTPCLIENT-40 has been marked as a duplicate of this bug. HTTPCLIENT-49 has been marked as a duplicate of this bug. Created an attachment id 2434 updated Patch resolved conflicts do not use older ones Patch applied locally. Checking and testing the patchCreated an attachment id 2445 updated File commons-logging do not use old ones Created an attachment id 2446 Patch for tests src test HTTPCLIENT-76 has been marked as a duplicate of this bug. Still testing....a couple of tests fail due to the API change on PostMethod.getRequestBody ....am fixing nowIn the present version of HttpMultiClient setting of proxies must be done at the entire HttpMultiClient level which may not be ideal requirement. An application may want to use only one instance of HttpMultiClient to serve internal as well as external behind firewalls hosts and hence setting the proxy on the HMC will fail to work with internal hosts. Moreover it may be desired to use a different proxy server for different host connections. What could be a good solution Having proxy host port setters in the UrlMethod class may not be ideal. I suggest adding a proxyHost proxyPort and useProxy boolean as parameters to the HttpMultiClient.execute method itself. If no proxy host and port is specified and useProxy is true the default value set in HMC will be used. Sometimes it may also be desirable to have a support for multiple proxies. So if the first one is down the second one is used and so on. An elegant solution maybe if we have a new class to handle proxy related affairs including hand shaking authentication daisy chaining of proxies and other proxy rules.Awaiting testing before closureAll done.
