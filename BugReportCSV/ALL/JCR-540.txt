AbstractJCRTest fails on level 1 repositories
If a test case indicates that it s not read-only org.apache.jackrabbit.test.AbstractJCRTest tries to cleanup the test root in the setUp method. This will cause the test case to fail because a Level 1 repository will throw an UnsupportedOperationException here. Proposal before trying the cleanup check for L2 functionality and throw a NotExecutableException otherwise             if isSupported Repository.LEVEL 2 SUPPORTED               cleanUp               String msg Test case requires level 2 functionality               throw new NotExecutableException msg              Proposed patch.This is done on purpose. Throwing a NotExecutableException will indicate to the TCK that the test case did not fail even though it did not run. Hence the test was successful. If all Level 2 tests on a Level 1 repository throw NotExecutableExceptions the TCK would finally declare the Repository Level 2 compliant which is not the case. Failing Level 2 test cases of a Level 1 repository do not have an effect on its Level 1 compliance.Well. I can t run api.TestAll on a level 1 rep because the cleanup code tails and leaves dangling sessions. So - at least over here - the test suite never terminates. Can we agree that at a minimum that needs to be fixed Furthermore is there a way to run just the level 1 tests If not how is a tester supposed to know whether the repository is L1 compliant without having to investigate each and every test failure New proposed patch not using NotExecutableException. I d still like to see an easy way to find out whether a repository supports L1 completely. Did I miss something If not should I open a separate issue I agree. This session leak should be fixed. Which means this is indeed a bug not an enhancement.Thank you for the patch. I slightly changed your proposal because I would rather like to call fail instead of throwing a RepositoryException. WDYT Does that work for you I d still like to see an easy way to find out whether a repository supports L1 completely. Yes there is the official TCK which comes with a test harness that executes the various test cases grouped in the specified compliance levels and optional features. There you can easily see which level 1 tests failed. See http jcp.org aboutJava communityprocess final jsr170 index.html and http www.day.com site en index related downloads tck form.html Please note that the currently available TCK is based on the test cases present in the jackrabbit branch ri-1.0. While you are the test cases from jackrabbit trunk which will eventually go into a maintenance release of the TCK at some time.Marcel yes that patch works for me. Thanks. Applied JCR-540-svn430367.patch. svn revision 430758 Thank you for reporting this issue.
