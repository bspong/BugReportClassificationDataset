Buffered output to socket
 Posted by Slavik Markovich Hi all This is probably a known issue but I haven t found the answer for it yet . I m using httpclient to post data to a remote server but as far as I can see using ethereal the client is writing every line to the wire without buffering. After examining the code I can see that the HttpConnection class is using the output stream received from the socket directly. Is there a reason for the direct writing This is a problem for me cause the remote server sets a very low timeout and returns a bad request response after receiving the request line without any other header line or request body . Can I easily add a buffered behavior to the http client 10xCreated an attachment id 5938 patch 1 Attached is a patch that adds buffering to the HttpConnection socket OutputStream. The only testing I performed was the various test cases. I m not sure how robust this is but I think it s pretty close. I do not know if we want to try this one before beta1 but I think it should be pretty safe with exception of those HttpMethods that do not extend HttpMethodBase are there any . On a related note as mentioned by Slavik it seems that this has a fairly significant performance impact. On average the runtime of the test-localhost went from 10 seconds pre-buffering to 8 seconds post-buffering. I do not know how valid this will be in real life but it was more than I expected. MikeMy performance gains are more modest when run on the localhost. However for high latency sites the output buffering may indeed result in massive performance improvement. As to how robust the buffered socket is going to be we can t really tell unless we try. I vote for including this patch into the forthcoming beta-1 release OlegI agree. I think we should go ahead and throw it in the mix for beta1. MikeTarget this one for beta-1. OlegOleg Do you think I should go ahead and apply this one or should we wait till the NTLM proxy stuff settles down MikeI believe these two problems are not interrelated. Therefore I d say you should go ahead and commit the patch. OlegPatch applied.
