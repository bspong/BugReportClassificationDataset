Refactor FieldCacheRangeFilter.FieldCacheDocIdSet to be separate class and fix the dangerous matchDoc throws AIOOBE requirement
Followup from LUCENE-3593 The FieldCacheRangeFilter.FieldCacheDocIdSet class has a strange requirement on the abstract matchDoc It should throw AIOOBE if the docId is maxDoc. This check should be done by caller as especially on trunk e.g. FieldCacheTermsFilter does not seem to always throw this exception correctly getOrd is a method and no array in TermsIndex cache . Also in 3.x the Filter does not correctly respect deletions when a FieldCache based on a reopened reader is used. This issue will refactor this and fix the bugs and moves the docId check up to the iterator. Patch for trunk. Previous patch had missing else . Final patch for trunk will commit now and backport. Committed trunk revision 1206033 Now backporting. Patch for Lucene 3.x. This also fixes the TODO in LUCENE-3593 respects deleted docs for the FixedBitSet case . Improvements. Ready to commit. Committed 3.x revision 1206040 I committed a change in trunk branch to do the acceptDocs check after the matchDoc to be consistent with other implementations. This should also be faster as bit twiddling is only done when a match was found. At revision 1206155
