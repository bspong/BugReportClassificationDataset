isCurrent and getVersion on an NRT reader are broken
Right now isCurrent will always return true for an NRT reader and getVersion will always return the version of the last commit. This is because the NRT reader holds the live segmentInfos. I think isCurrent should return false when any further changes have occurred with the writer else true. This is actually fairly easy to determine since the writer tracks how many docs deletions are buffered in RAM and these counters only increase with each change. getVersion should return the version as of when the reader was created. Attached patch. Now for an NRT reader isCurrent returns false if there have been any changes in the writer since it was opened. I plan to back-port this to 2.9.x since we re doing a 2.9.1 shortly... Bulk close all 2.9.1 issues. Reopening to fix on 3.1 after flex lands... OK fixed on 3.1.
