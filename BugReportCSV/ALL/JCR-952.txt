Support lower and upper case functions in order by clause
The query languages should support lower- and upper-case functions within the order by clause. This would provide case-insensitive ordering of query results. Example Find all nt base nodes ordered by the foo property but ignoring case In XPath element nt base order by fn lower-case foo In SQL SELECT FROM nt base ORDER BY lower foo What I don t understand is why is this issue open for 2 5 years already And why is it a minor issue As far as I m concerned this is a major issue. Can this be easily solved What I don t understand is why is this issue open for 2 5 years already because nobody provided a patch And why is it a minor issue because this is a feature that is not part of the JCR specification. As far as I m concerned this is a major issue. Feel free to contribute a patch. Can this be easily solved It is actually solved already. At least partially. Using JQOM or JCR SQL2 you already have the ability to use a lower upper case function in the order by clause. XPath and SQL the query syntax defined in JCR 1.0 do not support them yet. See classes LowerCaseSortComparator and UpperCaseSortComparator in jackrabbit-core. The parsers for XPath and SQL are in the module spi-commons.Is there a usecase where people would like to sort case sensitive If not we could easily change the code snippet below to first lowercase the terms. But I am not sure whether we do want to have the option to sort case sensitive. In SharedFieldSortComparator return new ScoreDocComparator            public final int compare final ScoreDoc i final ScoreDoc j                int idx1 readerIndex i.doc                int idx2 readerIndex j.doc                String iTerm indexes idx1 .getTerm i.doc - starts idx1                String jTerm indexes idx2 .getTerm j.doc - starts idx2                if iTerm jTerm                    return 0                 else if iTerm null                    return -1                 else if jTerm null                    return 1                 else                    return iTerm.compareTo jTerm                             I think there are use cases for both. But we cannot just change the current behaviour and redefine it. That might break existing clients.Yes agreed What solution do you guys propose Support for lower and upper functions in the order by clause or perhaps the change proposed by Ard but then as an optional feature I have changed openjpa openjpa-kernel src main jjtree org apache openjpa kernel jpql JPQL.jjt void orderby extension ORDERBYEXTENSION     aggregate select expression to void orderby extension ORDERBYEXTENSION     aggregate select expression upper and it works Developers who knows code well any potential problems I can meet due to my fix Thanks. I have changed openjpa openjpa-kernel src main jjtree org apache openjpa kernel jpql JPQL.jjt Wrong issue Yep sorry tentative patch. Needs cleanup and javadocCommitted modified version of the patch at revision 1051916XPath queries of the following form are now supported element nt base order by fn lower-case foo element nt base order by fn upper-case foo Meaning the property used for sorting is first converted to lower upper case before comparison takes place.
