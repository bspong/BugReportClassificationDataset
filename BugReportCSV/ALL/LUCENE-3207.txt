CustomScoreQuery calls weight where it should call createWeight 
Thanks to Uwe for helping me track down this bug after I pulled my hair out for hours on LUCENE-3174. as an explanation this causes this query to call sumOfSquaredWeights queryNorm normalize twice. the reason it doesnt cause any tests to fail in trunk is this in trunk sumOfSquaredWeights is not really a getter its also a setter Override public float sumOfSquaredWeights queryWeight idf getBoost compute query weight return queryWeight queryWeight square it in my patch on LUCENE-3174 my sumOfSquaredWeights returns queryWeight queryWeight but doesn t reset any state. so you end out normalizing twice and thats why the test failed on the branch. This bug is stupid I had a similar issue during the rewrite of ConstantScoreQuery to directly wrap queries where I copied some code from CustomScoreQuery just removed the custom scoring . I fixed it in Constant not sure why I left CustomScoreQuery unchanged. Maybe because tests passed. Fixed through LUCENE-3208. bulk close for 3.3
