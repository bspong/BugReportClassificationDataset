create configuration on InputStream
RepositoryConfig should be possible to create based on InputStreams in case of URLs right now it s possible only using String and InputSource. Please update also the JCA connector.You can use InputStreams just by wrapping them into InputSources     String repositoryHome ...     InputStream repositoryXml ...     RepositoryConfig config RepositoryConfig.create new InputSource repositoryXml repositoryHome The API uses InputSources as they make for better XML error messages The JCA case is a bit more difficult. It might make sense to allow URLs instead of just file paths as configuration file paths in RepositoryConfig.create String String Would this cover your use case Yes it would. The JCA relies on the RepositoryConfigu so it just needs some methods which accept InputSources instead of just Strings. As for the InputSource why doesn t JackRabbit creates it internally - the client is force to have the InputSource library in the classpath just as a dependency.org.xml.sax.InputSource is a part of Java 1.4 so no extra dependencies are required. An InputSource is created internally when RepositoryConfig is given a configuration file path and it would certainly be possible to add a utility method that does the same for an InputStream. I m just hesitant on extending this semi-public API without a good use case for it. Extending the RepositoryConfig.create String String method to allow URLs in addition to file paths is a cleaner extension so I d like to do that instead if it is good enough for you. This extension would also require no changes in JCA. You are right about the extra dependecy however considering that an InputSource is created internally by JackRabbit if a String is used I think using an InputStream is the best alternative. The configuration implementation doesn t have to treat the case of file url or InputSource or anything like that - maybe the client is using a PipedStream. Indeed I have a hook create the InputSource but I think it would be easier if the would be a generic method which accepts the inputStream and the rest of the method internally delegate to it InputStream is the lowest common dominator and there is always a situation where the client doesn t use URLs or File. My main motivation behind the issue is the update of the JCA contribution so if I can hook an input stream to it no matter if I have to create an InputSource or not . when dealing with xml configuration an InputSource signature should be provided. the InputSource also hold information about the SystemId or PublishId. this information is used to resolve external entities or DTDs.But you can create an InputSource based on an InputStream i.e. InputSource xmlSource new InputSource myInputStream . Am I missing something here sure you can. but then you loose the ability to resolve relative entities. currently the config does not make use of those so this is no problem. my point is the following - adding a new signature that takes an inputstream would just be convenience. the overhead in typing new InputSource in is very low - only having the InputStream signature is not acceptable since the XML parsing could need the information stored in the InputSource. Tobias is right InputSource is the correct format to use. I added r312816 the convenience methods create URI String and create InputStream String . This should cover all use cases.Can you please also update the JCA connector configuration methods Costin Leau wrote Can you please also update the JCA connector configuration methods Ah sorry. Reopened the issue and assigned to Dominique. Dominique could you take a look at this The current JCA configuration is based on the repository configuration file name and I m not sure about all the implications of changing that.It s quite easy - the JCA connector creates the repository and it s configuration from Strings - the update should add the rest of the methods from repository config create URI String and create InputStream String . That s it.I m just curious about how to handle the property declarations in ra.xml and more generally whether it even makes sense to allow InputStreams as declarative connector properties.According to the J2EE Connector Architecture Specification 1.0 custom properties for the managed connection factory class must be of one of the following types - java.lang.Boolean - java.lang.String - java.lang.Integer - java.lang.Double - java.lang.Byte - java.lang.Short - java.lang.Long - java.lang.Float - java.lang.Character Adding URI and or InputStream would then obviously be in violation to this. It would of course make sense to add a property of type String named URI that would internally be converted to a URI before creating the RepositoryConfig object but what about InputStream Resolving this issue as Fixed even though the JCA connector isn t changed. As commented by Dominique the JCA spec doesn t allow for InputStream configuration so it doesn t make sense to implement that in the connector.
