Improve automaton s MinimizeOperations.minimizeHopcroft to not create so many objects
MinimizeOperations.minimizeHopcroft creates a lot of objects because of strange arrays and useless ArrayLists with fixed length. E.g. it created List List List . This patch minimizes this and makes the whole method much more GC friendler by using simple arrays or avoiding empty LinkedLists at all inside reverse array . minimize is called very very often especially in tests MockAnalyzer . A test for the method is prepared by Robert we found a bug somewhere else in automaton so this is pending until his issue and fix arrives. It still creates lots of objects depending on the size and states of the automaton but a lot less If I will look several times over it I may find more improvements. The Hopcroft-Policeman This thing will make your head explode thanks for cleaning it up Ok I fixed LUCENE-2717 in revision 1026104. In that issue I added a basic random test for minimize maybe we can improve it but it should be pretty good at finding any bugs. it doesnt find any bugs with this patch Final patch will commit now. Committed revision 1026168 More stuff to optimize no longer LinkedLists and ArrayLists Hopcroft Policeman is back Same patch with OpenBitSet for comparison Commit standard BitSet variant in revision 1026190 OpenBitSet is 64bit and set get of single bits is ineffective on 32bit machines no need for bulk transformations 
