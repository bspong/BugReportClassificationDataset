optimize contrib regex for flex
changes RegexCapabilities match String to match BytesRef the jakarta and jdk impls uses CharacterIterator CharSequence matching against the utf16result instead. i also reuse the matcher for jdk i don t see why we didnt do this before but it makes sense esp since we reuse the CSQ simple patch we will have to list the break matches String - matches BytesRef in contrib changes because RegexCapabilities is an interface no way to do any back compat. attached is another iteration because the Query stores RegexCapabilities i pulled the matcher stuff out so the enum just calls matcher capability.compile pattern This way the capabilities stores no real state only the matcher which is created in the TermsEnum. the RegexCapabilities is also marked serializable LUCENE-961 Looks good The thing was broken in 3.x and 3.0 too as it was not threadsafe if the same capabilities object was used in multiple threads. Looks good The thing was broken in 3.x and 3.0 too as it was not threadsafe if the same capabilities object was used in multiple threads. True I think we have the opportunity to fix it in 4.x since we have to break the interface anyway. Should we do anything about 3.x It seems good to fix bugs but it would be frustrating if someone has a custom RegexCapabilities to break the API in 3.x then in 4.x again Committed revision 987129.
