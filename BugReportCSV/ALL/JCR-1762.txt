Improvement to MultiValueCollectionConverterImpl to Map collections with element class Object.class
Currently MultiValueCollectionConverterImpl does not support elements of type Object.class. The type of the contained class has to be specified either through the mapping file or through the Bean annotation. Even with that flexibility Object.class is specifically excluded For good reasons. . My view is that by definition MultiValueCollectionConverterImpl should make a best effort to convert and that best effort should include using Undefined UndefinedTypeConverterImpl to convert an object when all the other conversion strategies run out. To this resolve I have patched the OCM source. I have test cases also. I will upload the patch files right after.Files Changed src main java org apache jackrabbit ocm manager collectionconverter impl MultiValueCollectionConverterImpl.java src main java org apache jackrabbit ocm mapper impl AbstractMapperImpl.java src main java org apache jackrabbit ocm mapper impl annotation AnnotationDescriptorReader.java Test Cases Added Some modified Path src test java org apache jackrabbit ocm AnnotationTestBase.java src test test-config jcrmapping-atomic.xml jsrc test ava org apache jackrabbit ocm manager collectionconverter AnnotationMultiValueWithObjectCollectionConverterImplTest.java src test java org apache jackrabbit ocm manager collectionconverter DigesterMultiValueWithObjectCollectionConverterImplTest.java src test java org apache jackrabbit ocm testmodel MultiValueWithObjectCollection.java Hi Boni Can you provide a patch instead of a full java classes. It will be easier to apply changes because I m also working AnnotationDescriptorReader AbstractMapperImpl Thanks.The patch file from running svn diff on jackrabbit-ocm folder.The old patch missed two files.trying to apply the patch but I got a NullPointerException java.lang.NullPointerException at org.apache.jackrabbit.ocm.manager.objectconverter.impl.ObjectConverterImpl.getPath ObjectConverterImpl.java 612 at org.apache.jackrabbit.ocm.manager.impl.ObjectContentManagerImpl.insert ObjectContentManagerImpl.java 388 at org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationMultiValueWithObjectCollectionConverterImplTest.checkMultiValue AnnotationMultiValueWithObjectCollectionConverterImplTest.java 81 at org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationMultiValueWithObjectCollectionConverterImplTest.testMultiValue AnnotationMultiValueWithObjectCollectionConverterImplTest.java 59 at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39 at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25 at java.lang.reflect.Method.invoke Method.java 585 at junit.framework.TestCase.runTest TestCase.java 154 at junit.framework.TestCase.runBare TestCase.java 127 at junit.framework.TestResult 1.protect TestResult.java 106 at junit.framework.TestResult.runProtected TestResult.java 124 at junit.framework.TestResult.run TestResult.java 109 at junit.framework.TestCase.run TestCase.java 118 at junit.framework.TestSuite.runTest TestSuite.java 208 at junit.framework.TestSuite.run TestSuite.java 203 at junit.extensions.TestDecorator.basicRun TestDecorator.java 22 at junit.extensions.TestSetup 1.protect TestSetup.java 19 at junit.framework.TestResult.runProtected TestResult.java 124 at junit.extensions.TestSetup.run TestSetup.java 23 at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run JUnit3TestReference.java 130 at org.eclipse.jdt.internal.junit.runner.TestExecution.run TestExecution.java 38 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests RemoteTestRunner.java 460 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests RemoteTestRunner.java 673 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run RemoteTestRunner.java 386 at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main RemoteTestRunner.java 196 Maybe it is due to my latest changes. I will investigate later. I think so too. Cause I just ran the test cases once again got ocm and all passed. If you have something important to commit please go ahead I will rework on the patch and submit. E boni jackrabbit-src trunk jackrabbit-ocm mvn clean test INFO Scanning for projects... INFO INFO Building Jackrabbit Object Content Mapping INFO task-segment clean test INFO INFO clean clean INFO Deleting directory E boni jackrabbit-src trunk jackrabbit-ocm target INFO resources resources INFO Using default encoding to copy filtered resources. INFO snapshot org.apache.jackrabbit jackrabbit-core 1.5-SNAPSHOT checking for updates from apache.snapshots 7K downloaded INFO snapshot org.apache.jackrabbit jackrabbit-api 1.5-SNAPSHOT checking for updates from apache.snapshots 2K downloaded INFO snapshot org.apache.jackrabbit jackrabbit-jcr-commons 1.5-SNAPSHOT checking for updates from apache.snapshots 2K downloaded INFO snapshot org.apache.jackrabbit jackrabbit-spi-commons 1.5-SNAPSHOT checking for updates from apache.snapshots 7K downloaded INFO snapshot org.apache.jackrabbit jackrabbit-spi 1.5-SNAPSHOT checking for updates from apache.snapshots 2K downloaded INFO snapshot org.apache.jackrabbit jackrabbit-text-extractors 1.5-SNAPSHOT checking for updates from apache.snapshots 2K downloaded INFO compiler compile INFO Compiling 106 source files to E boni jackrabbit-src trunk jackrabbit-ocm target classes INFO resources testResources INFO Using default encoding to copy filtered resources. 1645K downloaded 26K downloaded 197K downloaded 509K downloaded 21K downloaded 32K downloaded INFO compiler testCompile INFO Compiling 169 source files to E boni jackrabbit-src trunk jackrabbit-ocm target test-classes INFO surefire test INFO Surefire report directory E boni jackrabbit-src trunk jackrabbit-ocm target surefire-reports  T E S T S Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationMultiValueWithObjectCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 32.434 sec Running org.apache.jackrabbit.ocm.querymanager.DigesterQueryManagerTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.61 sec Running org.apache.jackrabbit.ocm.manager.query.DigesterMultiValueQueryTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.35 sec Running org.apache.jackrabbit.ocm.manager.atomic.DigesterAtomicTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.125 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterResidualPropertiesCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.08 sec Running org.apache.jackrabbit.ocm.manager.proxy.DigesterProxyTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 2.143 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationResidualNodesCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.395 sec Running org.apache.jackrabbit.ocm.manager.query.AnnotationScopeQueryTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.982 sec Running org.apache.jackrabbit.ocm.manager.auto.DigesterAutoTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.125 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationDefaultCollectionConverterImplTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.69 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterMultiValueWithObjectCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.09 sec Running org.apache.jackrabbit.ocm.manager.beanconverter.AnnotationBeanDescriptorTest Paragraph path test paragraph 2 Paragraph path test paragraph 3 Paragraph path test paragraph Tests run 4 Failures 0 Errors 0 Skipped 0 Time elapsed 0.332 sec Running org.apache.jackrabbit.ocm.mapper.AnnotationMapperImplTest Tests run 9 Failures 0 Errors 0 Skipped 0 Time elapsed 0.103 sec Running org.apache.jackrabbit.ocm.manager.inheritance.DigesterInheritanceConcreteClassTest Tests run 5 Failures 0 Errors 0 Skipped 0 Time elapsed 11.938 sec Running org.apache.jackrabbit.ocm.manager.query.DigesterIteratorQueryTest getObject takes 3 getObject takes 18 getObject takes 1 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.635 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterNTCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.293 sec Running org.apache.jackrabbit.ocm.manager.basic.DigesterRemoveTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.284 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationArrayListTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.575 sec Running org.apache.jackrabbit.ocm.manager.jcrnodetype.AnnotationJcrPropertyTest org.apache.jackrabbit.ocm.exception.ObjectContentManagerException Cannot persist current session changes. nested exception is thConstraintsProp invalid value does not satisfy the constraint ddd javax.jcr.nodetype.ConstraintViolationException test ocm autoCreatedWithConstraintsProp invalid value does not satisfy the         at org.apache.jackrabbit.core.ItemImpl.validateTransientItems ItemImpl.java 500         at org.apache.jackrabbit.core.ItemImpl.save ItemImpl.java 1037         at org.apache.jackrabbit.core.SessionImpl.save SessionImpl.java 846         at org.apache.jackrabbit.ocm.manager.impl.ObjectContentManagerImpl.save ObjectContentManagerImpl.java 1070         at org.apache.jackrabbit.ocm.manager.jcrnodetype.AnnotationJcrPropertyTest.testRequiredProperty AnnotationJcrPropertyTes         at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method         at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597         at junit.framework.TestCase.runTest TestCase.java 154         at junit.framework.TestCase.runBare TestCase.java 127         at junit.framework.TestResult 1.protect TestResult.java 106         at junit.framework.TestResult.runProtected TestResult.java 124         at junit.framework.TestResult.run TestResult.java 109         at junit.framework.TestCase.run TestCase.java 118         at junit.framework.TestSuite.runTest TestSuite.java 208         at junit.framework.TestSuite.run TestSuite.java 203         at junit.extensions.TestDecorator.basicRun TestDecorator.java 22         at junit.extensions.TestSetup 1.protect TestSetup.java 19         at junit.framework.TestResult.runProtected TestResult.java 124         at junit.extensions.TestSetup.run TestSetup.java 23         at sun.reflect.GeneratedMethodAccessor97.invoke Unknown Source         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597         at org.apache.maven.surefire.junit.JUnitTestSet.execute JUnitTestSet.java 213         at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet AbstractDirectoryTestSuite.java 140         at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute AbstractDirectoryTestSuite.java 127         at org.apache.maven.surefire.Surefire.run Surefire.java 177         at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method         at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597         at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess SurefireBooter.java 338         at org.apache.maven.surefire.booter.SurefireBooter.main SurefireBooter.java 997 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.068 sec Running org.apache.jackrabbit.ocm.manager.atomic.DigesterNullAtomicTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.048 sec Running org.apache.jackrabbit.ocm.manager.inheritance.DigesterInheritanceHierarchyTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.141 sec Running org.apache.jackrabbit.ocm.manager.basic.AnnotationCopyMoveTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.541 sec Running org.apache.jackrabbit.ocm.manager.query.AnnotationAtomicQueryTest getObjects 31 getObjects 2 2 getObjects 21 Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 1.318 sec Running org.apache.jackrabbit.ocm.manager.proxy.AnnotationProxyTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 1.309 sec Running org.apache.jackrabbit.ocm.manager.query.AnnotationSimpleQueryTest Tests run 5 Failures 0 Errors 0 Skipped 0 Time elapsed 1.325 sec Running org.apache.jackrabbit.ocm.manager.basic.AnnotationSimpleTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.21 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationResidualPropertiesCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.038 sec Running org.apache.jackrabbit.ocm.mapper.DigesterMapperImplTest Tests run 9 Failures 0 Errors 0 Skipped 0 Time elapsed 0.056 sec Running org.apache.jackrabbit.ocm.manager.atomic.AnnotationNullAtomicTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.048 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationMultiValueCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.046 sec Running org.apache.jackrabbit.ocm.manager.jcrnodetype.DigesterJcrPropertyTest org.apache.jackrabbit.ocm.exception.ObjectContentManagerException Cannot persist current session changes. nested exception is thConstraintsProp invalid value does not satisfy the constraint ddd javax.jcr.nodetype.ConstraintViolationException test ocm autoCreatedWithConstraintsProp invalid value does not satisfy the         at org.apache.jackrabbit.core.ItemImpl.validateTransientItems ItemImpl.java 500         at org.apache.jackrabbit.core.ItemImpl.save ItemImpl.java 1037         at org.apache.jackrabbit.core.SessionImpl.save SessionImpl.java 846         at org.apache.jackrabbit.ocm.manager.impl.ObjectContentManagerImpl.save ObjectContentManagerImpl.java 1070         at org.apache.jackrabbit.ocm.manager.jcrnodetype.DigesterJcrPropertyTest.testRequiredProperty DigesterJcrPropertyTest.ja         at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method         at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597         at junit.framework.TestCase.runTest TestCase.java 154         at junit.framework.TestCase.runBare TestCase.java 127         at junit.framework.TestResult 1.protect TestResult.java 106         at junit.framework.TestResult.runProtected TestResult.java 124         at junit.framework.TestResult.run TestResult.java 109         at junit.framework.TestCase.run TestCase.java 118         at junit.framework.TestSuite.runTest TestSuite.java 208         at junit.framework.TestSuite.run TestSuite.java 203         at junit.extensions.TestDecorator.basicRun TestDecorator.java 22         at junit.extensions.TestSetup 1.protect TestSetup.java 19         at junit.framework.TestResult.runProtected TestResult.java 124         at junit.extensions.TestSetup.run TestSetup.java 23         at sun.reflect.GeneratedMethodAccessor97.invoke Unknown Source         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597         at org.apache.maven.surefire.junit.JUnitTestSet.execute JUnitTestSet.java 213         at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet AbstractDirectoryTestSuite.java 140         at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute AbstractDirectoryTestSuite.java 127         at org.apache.maven.surefire.Surefire.run Surefire.java 177         at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method         at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39         at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25         at java.lang.reflect.Method.invoke Method.java 597 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.058 sec         at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess SurefireBooter.java 338         at org.apache.maven.surefire.booter.SurefireBooter.main SurefireBooter.java 997 Running org.apache.jackrabbit.ocm.manager.interfaces.AnnotationInterfaceHierarchyTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.077 sec Running org.apache.jackrabbit.ocm.manager.query.DigesterSimpleQueryTest Tests run 6 Failures 0 Errors 0 Skipped 0 Time elapsed 7.54 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterHashMapTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.163 sec Running org.apache.jackrabbit.ocm.manager.lock.AnnotationLockTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 2.987 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.MapReferenceValueEncoderTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.008 sec Running org.apache.jackrabbit.ocm.manager.uuid.AnnotationUuidTest UUID 6d3c9a45-541f-4f61-83ee-30259b9523cf org.apache.jackrabbit.ocm.exception.RepositoryException Impossible to get the object with uuid 1234 nested exception is java UUID 182f8b07-ec01-4ac2-b758-d35b369e6471 Invalid uuid org.apache.jackrabbit.ocm.exception.IncorrectAtomicTypeException Impossible to convert the value into a referenc avax.jcr.ValueFormatException not a valid UUID format 1245 UUID 19a5bc21-1f1b-422c-918b-b05365251b54 Invalid uuid value in the collection org.apache.jackrabbit.ocm.exception.ObjectContentManagerException Cannot insert collecti uuid.B nested exception is javax.jcr.ValueFormatException not a valid UUID format 12345 UUID da9ecd49-1c3c-4170-89e5-6aa244cbe12d Tests run 7 Failures 0 Errors 0 Skipped 0 Time elapsed 0.489 sec Running org.apache.jackrabbit.ocm.querymanager.AnnotationQueryManagerTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.024 sec Running org.apache.jackrabbit.ocm.manager.version.DigesterBasicVersionningTest Base version 1.1 Root version jcr rootVersion Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 1.196 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationHashMapTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.336 sec Running org.apache.jackrabbit.ocm.manager.beanconverter.DigesterBeanDescriptorTest Paragraph path test paragraph Paragraph path test paragraph 3 Paragraph path test paragraph 2 Tests run 4 Failures 0 Errors 0 Skipped 0 Time elapsed 0.324 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.BeanReferenceMapConverterImplTest Tests run 6 Failures 0 Errors 0 Skipped 0 Time elapsed 0.179 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterMultiValueCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.067 sec Running org.apache.jackrabbit.ocm.manager.basic.AnnotationRemoveTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.1 sec Running org.apache.jackrabbit.ocm.manager.jcrnodetype.DigesterJcrNodeTypeTest Folder creation date java.util.GregorianCalendar time 1222523368465 areFieldsSet true areAllFieldsSet true lenient true zone s 0 useDaylight false transitions 6 lastRule null firstDayOfWeek 1 minimalDaysInFirstWeek 1 ERA 1 YEAR 2008 MONTH 8 WEEK OF YEAR WEEK IN MONTH 4 AM PM 1 HOUR 7 HOUR OF DAY 19 MINUTE 19 SECOND 28 MILLISECOND 465 ZONE OFFSET 19800000 DST OFFSET 0 File resource calendar java.util.GregorianCalendar time 1222523368465 areFieldsSet true areAllFieldsSet true lenient true zone 0 useDaylight false transitions 6 lastRule null firstDayOfWeek 1 minimalDaysInFirstWeek 1 ERA 1 YEAR 2008 MONTH 8 WEEK OF YEAR WEEK IN MONTH 4 AM PM 1 HOUR 7 HOUR OF DAY 19 MINUTE 19 SECOND 28 MILLISECOND 465 ZONE OFFSET 19800000 DST OFFSET 0 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.072 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterArrayListTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.281 sec Running org.apache.jackrabbit.ocm.manager.interfaces.DigesterInterfaceHierarchyTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.109 sec Running org.apache.jackrabbit.ocm.manager.interfaces.DigesterConcreteClassTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 9.681 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterDefaultCollectionConverterImplTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 1.067 sec Running org.apache.jackrabbit.ocm.manager.uuid.DigesterUuidTest UUID a11ebb40-df17-4d5d-bc65-746254516172 org.apache.jackrabbit.ocm.exception.RepositoryException Impossible to get the object with uuid 1234 nested exception is java UUID 0f17a653-a19d-41fc-b2fd-95f6cfba567b Invalid uuid org.apache.jackrabbit.ocm.exception.IncorrectAtomicTypeException Impossible to convert the value into a referenc avax.jcr.ValueFormatException not a valid UUID format 1245 UUID 71ca7ca9-ca83-4d23-bd09-6432dbc207e9 Invalid uuid value in the collection org.apache.jackrabbit.ocm.exception.ObjectContentManagerException Cannot insert collecti uuid.B nested exception is javax.jcr.ValueFormatException not a valid UUID format 12345 UUID 0fd60251-606f-42f8-b4e4-9479cf7bb938 Tests run 6 Failures 0 Errors 0 Skipped 0 Time elapsed 0.353 sec Running org.apache.jackrabbit.ocm.manager.query.DigesterScopeQueryTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.94 sec Running org.apache.jackrabbit.ocm.repository.NodeUtilTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.003 sec Running org.apache.jackrabbit.ocm.manager.jcrnodetype.AnnotationJcrNodeTypeTest Folder creation date java.util.GregorianCalendar time 1222523380984 areFieldsSet true areAllFieldsSet true lenient true zone s 0 useDaylight false transitions 6 lastRule null firstDayOfWeek 1 minimalDaysInFirstWeek 1 ERA 1 YEAR 2008 MONTH 8 WEEK OF YEAR WEEK IN MONTH 4 AM PM 1 HOUR 7 HOUR OF DAY 19 MINUTE 19 SECOND 40 MILLISECOND 984 ZONE OFFSET 19800000 DST OFFSET 0 File resource calendar java.util.GregorianCalendar time 1222523380984 areFieldsSet true areAllFieldsSet true lenient true zone 0 useDaylight false transitions 6 lastRule null firstDayOfWeek 1 minimalDaysInFirstWeek 1 ERA 1 YEAR 2008 MONTH 8 WEEK OF YEAR WEEK IN MONTH 4 AM PM 1 HOUR 7 HOUR OF DAY 19 MINUTE 19 SECOND 40 MILLISECOND 984 ZONE OFFSET 19800000 DST OFFSET 0 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.041 sec Running org.apache.jackrabbit.ocm.manager.inheritance.AnnotationInheritanceConcreteClassTest Tests run 5 Failures 0 Errors 0 Skipped 0 Time elapsed 29.571 sec Running org.apache.jackrabbit.ocm.manager.atomic.AnnotationDefaultValueTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.095 sec Running org.apache.jackrabbit.ocm.manager.query.AnnotationIteratorQueryTest getObjectIterator takes 9 getObject takes 39 getObjectIterator takes 2 Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 1.372 sec Running org.apache.jackrabbit.ocm.manager.basic.AnnotationSameNameSiblingTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.232 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.DigesterResidualNodesCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.552 sec Running org.apache.jackrabbit.ocm.manager.collectionconverter.AnnotationNTCollectionConverterImplTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 1.112 sec Running org.apache.jackrabbit.ocm.manager.basic.DigesterAvoidRecursiveLoopTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.13 sec Running org.apache.jackrabbit.ocm.manager.atomic.AnnotationAtomicTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.071 sec Running org.apache.jackrabbit.ocm.manager.auto.AnnotationAutoTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.124 sec Running org.apache.jackrabbit.ocm.manager.version.AnnotationBasicVersionningTest Base version 1.1 Root version jcr rootVersion Base version 1.1 Root version jcr rootVersion Tests run 4 Failures 0 Errors 0 Skipped 0 Time elapsed 3.077 sec Running org.apache.jackrabbit.ocm.manager.query.DigesterAtomicQueryTest getObjects 15 getObjects 2 1 getObjects 14 Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 1.884 sec Running org.apache.jackrabbit.ocm.manager.basic.DigesterSimpleTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.348 sec Running org.apache.jackrabbit.ocm.manager.basic.DigesterSameNameSiblingTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.203 sec Running org.apache.jackrabbit.ocm.manager.atomic.DigesterDefaultValueTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.092 sec Running org.apache.jackrabbit.ocm.manager.inheritance.AnnotationInheritanceHierarchyTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.135 sec Running org.apache.jackrabbit.ocm.manager.interfaces.AnnotationConcreteClassTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 11.467 sec Running org.apache.jackrabbit.ocm.repository.RelfectionUtilTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.004 sec Running org.apache.jackrabbit.ocm.manager.query.AnnotationMultiValueQueryTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.037 sec Running org.apache.jackrabbit.ocm.manager.lock.DigesterLockTest Tests run 2 Failures 0 Errors 0 Skipped 0 Time elapsed 0.235 sec Running org.apache.jackrabbit.ocm.testmodel.PropertyTest Tests run 0 Failures 0 Errors 0 Skipped 0 Time elapsed 0.021 sec Running org.apache.jackrabbit.ocm.repository.RepositoryUtilTest Tests run 4 Failures 0 Errors 0 Skipped 0 Time elapsed 0.031 sec Running org.apache.jackrabbit.ocm.manager.basic.AnnotationAvoidRecursiveLoopTest Tests run 1 Failures 0 Errors 0 Skipped 0 Time elapsed 0.044 sec Running org.apache.jackrabbit.ocm.manager.basic.DigesterCopyMoveTest Tests run 3 Failures 0 Errors 0 Skipped 0 Time elapsed 0.552 sec Results Tests run 174 Failures 0 Errors 0 Skipped 0 INFO INFO BUILD SUCCESSFUL INFO INFO Total time 4 minutes 20 seconds INFO Finished at Sat Sep 27 19 20 35 IST 2008 INFO Final Memory 15M 40M INFO I have committed. You can update the project to get my changes. If you have no sufficient time I will review this problem tomorrow. thanks I am At revision 699765 of the whole trunk. All tests are passing. I am attaching my test execution and an updated patch.Test results for revision 699765and wrt to OCM E boni jackrabbit-src trunk jackrabbit-ocm svn info Path . URL http svn.apache.org repos asf jackrabbit trunk jackrabbit-ocm Repository Root http svn.apache.org repos asf Repository UUID 13f79535-47bb-0310-9956-ffa450edef68 Revision 699767 Node Kind directory Schedule normal Last Changed Author clombart Last Changed Rev 699628 Last Changed Date 2008-09-27 18 07 02 0530 Sat 27 Sep 2008 Now it works on my machine with the updated patch - thanks I have reviewed your patch and I m wondering why you have modified the class AbstractMapperImpl with that change -198 7 200 7     public ClassDescriptor getClassDescriptorByClass Class clazz   ClassDescriptor descriptor mappingDescriptor.getClassDescriptorByName clazz.getName   if descriptor null - throw new IncorrectPersistentClassException Class of type clazz.getName has no descriptor. throw new IncorrectPersistentClassException Class of type clazz.getName has no descriptor.           return descriptor      If we keep the old code your patch is still working. The patch has been applied - Thanks for your contribution.
