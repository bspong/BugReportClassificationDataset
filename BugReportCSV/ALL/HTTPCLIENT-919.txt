NTLM implementation lacks support for NTLMv1 NTLMv2 and NTLM2 Session forms of NTLM
The current HttpClient implementation lacks support for all enhancements to NTLM after Windows 95. That includes NTLMv1 NTLMv2 and NTLM2 Session Response varieties of the protocol. This seriously impacts the usability of HttpClient in enterprise situations which has required the Lucene Connector Framework team to extend HttpClient to address the issue. I ve attached a patch which contains the implementation used by LCF. Hi all Lack of native NTLM support in 4.x also may block Lucene Connector Framework from using 4.x. This is because many of its connectors require NTLM. HttpClient 4.x s solution requires jcifs and jcifs is a LGPL-licensed component which means we cannot distribute it according to Apache rules. The submitted patch has been granted to ASF officially to Apache as part of the software grant for LCF and thus it can form the basis of a full featured NTLM implementation in HttpClient which we feel would be highly desirable for the above reason. Karl NTLMvis a very touchy subject. I understand a lot of hard work has gone into this patch but I am afraid at this point of time it cannot be accepted. The trouble is we as well as ASF in general cannot distribute NTLM implementations for legal reasons. NTLM encryption algorithms may be covered by patents held by Microsoft which would make commercial users of open-source NTLM implementations liable for the use of Microsoft intellectual property. Various high ranking ASF people are aware of the situation and promised to have this issue up with Microsoft but to my knowledge there has been no practical outcome so far. I would even go as far as strongly suggesting that the custom extensions to HttpClient that implement NTLM encryption algorithms be removed from Lucene Connector Framework for the same reason they have been removed from HttpClient For details on NTLM support in HttpClient 4.0 see http hc.apache.org httpcomponents-client ntlm.html OlegPlease see comments regarding this issue I ve attached to httpclient-917. If we conclude that patents will be violated I will indeed remove all NTLM implementations from LCF which would include even the upstream patch to httpclient-3.1 that was granted. However the consequences are severe to the functionality of that component that we d want to verify this. An NTLM implementation is also available for the Google connector framework by the way for what it is worth. Reviewers here want to know if there s any controlling legal ASF document that describes the described policy available for their perusal. A URL will do or even a document title if you recall seeing such a thing anywhere . Also FWIW our expert here believes that ASF s legal structure may protect individual Apache contributors from liability concerns of this kind. That s kind of why Apache exists was the comment. None I am aware of. You should ask at legal apache.org OlegI raised this specific issue on legal-discuss apache.org yesterday and received the following response from William A. Rowe Jr. AIUI - this is probably covered under the interop Microsoft patent pledge. If it is not asking them to make it explicitly so might not be a big issue. See http www.microsoft.com openspecifications programs wspp wspp-patents wspp-patent-pledges and related documents. The document in question apparently pledges to protect open-source developers and their community against direct patent-infringement lawsuits for certain areas of their IP including protocol specifications as described in this document http www.microsoft.com openspecifications programs wspp wspp-patents The patents that Microsoft licenses are described by protocol in the following document http download.microsoft.com download 1 0 4 1041AEF2-0ABC-4D48-A909-EC3CD52A7F13 WSPP Patent Mapping.pdf That document explicitly mentions NTLM as being a Microsoft protocol but asserts no patent claims against it. So if I read this correctly 1 Open source developers are not subject to patent claims by Microsoft in any case and 2 Microsoft asserts no patent claims whatsoever against NTLM and does not suggest patent licensing for native implementations of such even against for-profit corporations. I will of course post any further responses that appear from legal-discuss. Karl Given that we now have an explicit OK to include NTLM implementations in the ASF code LEGAL-80 I can commit your patch to the project repository. However there is one minor technicality that we need to discuss first. HttpClient 3.1 is effectively EOL and is not planned to have any official releases any more. So the patch needs to be ported to the 4.x API. Would you have time and inclination to work on the port or is that something I would have to do myself OlegThat s great news If the authentication architecture is at all similar it should not take me too long to do this. The logic trickiness is in all the encryption and perhaps in getting some DC s set up with the proper switches for testing. But I won t be able to start on it for a couple of weeks at best. But by then I am hoping to have procured access to my old testing environment formerly at MetaCarta and now at qBase so that I can verify the code. If your time frame is too urgent for that then by all means I urge you to go ahead. I would like to have the NTLM code incorporated before 4.1 goes BETA in order to have more time for testing. I ll take a stab at porting the patch but I would really appreciate if you could invest some effort into testing NTLM authentication in HttpClient 4.1 once ready. Some test coverage would also be nice - OlegPatch ported and committed to SVN trunk. Karl could you please review test NTLM support in HttpClient 4.1 when you happen to have time OlegI will test as soon as I have the means. Hopefully that willl be sometime next week. Does this mean that the patch checked into SVN changes this http hc.apache.org httpcomponents-client-ga ntlm.html i.e. No need for JCIFS etc. Also do you know when 4.1 Alpha3 will be released AndrewAndrew JCIFS is no longer required. NTLM should work right out of the box with the next release. HttpClient 4.1-beta1 can be expected within a week. Oleg
