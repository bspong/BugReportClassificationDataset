Remove deprecate IndexReader.undeleteAll
This API is rather dangerous in that it s best effort since it can only un-delete docs that have not yet been merged away or dropped as of LUCENE-2010 . Given that it exposes impl details of how Lucene prunes deleted docs I think we should remove this API. Are there legitimate use cases.... The MultiPassIndexSplitter won t work without this API. It can be modified to use a subclass of IndexReader term postings enumerators to restore the current behavior or it can be rewritten entirely as a fabled SinglePassIndexSplitter. I think it is correct to say that if the result of ir.numDeletedDocs is N then calling ir.undeleteAll will undelete exactly N documents ... or am I missing it Because if a merge was invoked for the segments seen by this reader I see two options A merge is on going or the merge is done but uncommitted yet. This means that an index writer has a lock on the index hence ir.undeleteAll will fail to get the lock. The merge was already committed. This means that the index reader will fail to get write permission for being Stale. So I think this method behaves deterministically - perhaps its jdoc should say something like Undeletes all numDeletedDocs documents currently marked as deleted in this index. I think it is correct to say that if the result of ir.numDeletedDocs is N then calling ir.undeleteAll will undelete exactly N documents ... or am I missing it That s right... it s just that you can no longer rely on how IW reclaims del docs. But I ll just commit that clarification to the javadoc and leave the API for now... I just sharpened the jdocs... Bulk close for 3.1
