HttpUrl does not accept unescaped passwords
- Taken from an email from Gustav Munkby posted to the HttpClient dev mailing list - If I do HTTPUrl url new HTTPUrl kurt nicepass hostname 80 path throws a URIException with message port number invalid . First of all the message is wrong... Next attempt was to urlencode the password which resulted in the above line working but the password was sent url-encoded to the destination which can hardly be the desired behaviour Created an attachment id 11398 fix 1 Though is not a valid char in the userinfo the various HttpUrl constructors are supposed to accept non escaped values. To me that means they should be escaping any non-valid characters. The attached patch should fix this one. The only problem now is that HttpMethodBase.generateRequestLine does not include the userinfo. MikeLooks good to me OlegApplied to HEAD and 2.0. MikeThe same applies to HttpsURL. The relevant piece of code is duplicated in these two classes but it was only fixed in HttpURL.I ll tackle this issue in a second.Created an attachment id 11545 fix for HttpsURL committed to HEAD and 2.0 branchCreated an attachment id 12669 Proposed fix for HttpURL The userinfo is still not quite escaped correctly. Last time there were more and more reports of users that tried to use e-mail addresses as usernames and therefore had a problem with the character. I have attached a patch for HttpURL that should solve that problem. A similar patch is however needed for HttpsURL as well. Note that I have removed duplicate checkValid calls and deprecated the constructors that take a userinfo as an argument because you cannot determine from that whether a colon is within a username or password or serves to separate these two components.Created an attachment id 12670 The same patch im unified diff format forgot the -u sorry Ooops. Looks like we all have overlooked this report. Odi are you planning to have a resolution on this one before 2.0.2 OlegYes I will get a patch ready before 12h00 CEST GMT 2 .Created an attachment id 12901 complete patch I changed the contract of all HttpURL and HttpsURL constructors that accept the userinfo field to expect the userinfo in URL escaped form. Come code duplication has been removed. There is still some duplicate code between HttpURL and HttpsURL but I left this for the moment. I hope this change is acceptable for 2.0. Test cases are included. The patch applies to HEAD and 2.0 Branch. If there are no objections I will commit this patch tonight around 18h00 CEST GMT 2 this is in 7.5 hrs so our north american friends have a chance to have a look at it.Works for me. Though the contract didn t previously require escaped userinfo it didn t work if it wasn t. MikePatch committed to HEAD and 2.0 branch.
