BundleDBPersistenceManager does not free blobStore resources
When removing binary property from node or removing node containing binary property resources occupied by binary property are not freed orphaned records remains in associated schemaObjectPrefix BINVAL table .Attached patch proposal. Abstract method destroy PropertyState added to AbstractBundlePM and called during store. Method implemented in BundleDB PM to ensure that blob resources are removed from underlying blobstore. Not sure if something needs to be done in BundleFS PM so method remains empty there. Looks good to me. Przemo feel free to commit this. Though it would be nice if you used spaces instead of tabs. Toby or Przemo are you planning to act on this in near future If not I ll take over and commit the patch in a few days.This seems more complex than expected. There is already an existing remove property code path based on BLOBFileValue.remove but that doesn t work correctly for database persistence with externalBLOBs set to false because the BLOBFileValue.remove call ends up removing the temporary copy of the value instead of the actual database row. Instead of adding a new code path for handling database persistence I d rather have a way that hooks the required functionality to the existing code path. Also this issue might get obsoleted with the new data store feature. Thus I m removing this issue from the 1.3.2 roadmap.right. since the handling of blobs is dependent of the bundlebinding i suggest to include this in the nodeprop bundles and let the destroy method of the property entry free the resource. i will attach a patch. 1 That looks nice and clean yup 1 for toby s patchcommitted proposed patch revision 604211.
