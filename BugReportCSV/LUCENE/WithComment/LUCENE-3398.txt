TestCompoundFile fails on windows
ant test-core -Dtestcase TestCompoundFile -Dtestmethod testReadNestedCFP -Dtests.seed -61cb66ec0d71d1ac -46685c36ec38fd32 568c63299214892c junit-sequential junit Testsuite org.apache.lucene.index.TestCompoundFile junit Tests run 1 Failures 0 Errors 1 Time elapsed 0.227 sec junit junit Standard Error junit NOTE reproduce with ant test -Dtestcase TestCompoundFile -Dtestmethod testReadNestedCFP -Dtests.seed -61cb66ec0d71d1ac -46685c36ec38fd32 568c63299214892c junit NOTE test params are codec RandomCodecProvider locale de DE timezone Asia Gaza junit NOTE all tests run in this JVM junit TestCompoundFile junit NOTE Windows Vista 6.0 x86 Sun Microsystems Inc. 1.6.0 23 32-bit cpus 4 threads 1 free 11693688 total 16252928 junit junit Testcase testReadNestedCFP org.apache.lucene.index.TestCompoundFile Caused an ERROR junit Cannot delete C Users rmuir workspace trunky lucene build test 1 test5610056101tmp b 1.xyz junit java.io.IOException Cannot delete C Users rmuir workspace trunky lucene build test 1 test5610056101tmp b 1.xyz junit at org.apache.lucene.store.FSDirectory.deleteFile FSDirectory.java 287 junit at org.apache.lucene.store.CompoundFileWriter.copyFileEntry CompoundFileWriter.java 205 junit at org.apache.lucene.store.CompoundFileWriter.prunePendingEntries CompoundFileWriter.java 272 junit at org.apache.lucene.store.CompoundFileWriter.access 200 CompoundFileWriter.java 59 junit at org.apache.lucene.store.CompoundFileWriter DirectCFSIndexOutput.close CompoundFileWriter.java 335 junit at org.apache.lucene.index.TestCompoundFile.testReadNestedCFP TestCompoundFile.java 722 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1530 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1432 junit junit junit Test org.apache.lucene.index.TestCompoundFile FAILED I had this failure while working on LUCENE-3218 so there is a fix for this issue. However I will upload a patch then you can run it I have no windows ready and see if that fixes this issue too. Is it reproducible for you on Windows here is a patch basically extracted the fix from LUCENE-3218 which tries to delete the file after the stream referencing it is closed. Hey Robert I committed LUCENE-3218 yesterday which includes the fix I uploaded here. Can you verify if this still fails on windows Aside from this it seems we need a dedicated Windows machine that runs our tests though. The good sign is that I had the same failure on a linux box while refactoring CFS to what it is now so it seems our Windows-Behavior mocking works. The tests are fine on windows now...we can close this issue. thanks robert for confirming.
