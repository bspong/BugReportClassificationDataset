if you open an NRT reader while addIndexes is running it may miss segments
Earwin spotted this in pending ongoing refactoring of Dir MultiReader but I wanted to open this separately just to make sure we fix it for 3.1... This is the fix Index src java org apache lucene index DirectoryReader.java src java org apache lucene index DirectoryReader.java revision 919119 src java org apache lucene index DirectoryReader.java working copy -145 7 145 7 for int i 0 i numSegments i boolean success false try - final SegmentInfo info infos.info upto final SegmentInfo info infos.info i if info.dir dir readers upto writer.readerPool.getReadOnlyClone info true termInfosIndexDivisor Mike - is this still a problem w the refactoring done recently to addIndexes I.e. now they operate on the side changing the segmentInfos in the end only ... Nope In 4.0 this is automatically fixed since addIndexes is now well behaved Nice Cleans up DirReader s loading of segments from IW. I removed code since a SegmentInfo s dir is never external anymore I won t do this when backporting to 3.0.x 2.9.x . In 4.0 this is automatically fixed since addIndexes is now well behaved So is in 3.1. So is in 3.1. Yes.
