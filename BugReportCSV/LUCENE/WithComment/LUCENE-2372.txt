Replace deprecated TermAttribute by new CharTermAttribute
After LUCENE-2302 is merged to trunk with flex we need to carry over all tokenizers and consumers of the TokenStreams to the new CharTermAttribute. We should also think about adding a AttributeFactory that creates a subclass of CharTermAttributeImpl that returns collation keys in toBytesRef accessor. CollationKeyFilter is then obsolete instead you can simply convert every TokenStream to indexing only CollationKeys by changing the attribute implementation. Here a first patch for the core tokenstreams. Tests not yet changed. The following things were additionally fixed StandardAnalyzer was made final backwards break we forgot to made it final in the 3.0 TS finalization issue . This enabled me to subclass StopwordAnalyzerBase and remove heavy code duplication. The original code also contained a bug in the tokenStream method no setReplaceInvalidAcronym which was correctin reusableTokenStream. Now it is correct. I will post further patches for core. Patch that removes deprecated usage of TermAttribute from Lucene Core completely all tests also fixed. Small updates. Just one question The only non-final Analyzer left is KeywordAnalyzer. If I make it final and also use ReusableTokenizerBase we can remove the overridesTokenStream check completely The question is whoever wants to override this class. StandardAnalyzer was made final in this patch why not also this one If I make it final and 1 - lets just remember to add these breaks to the CHANGES BW break section... 1 to making KeywordAnalyzer final. Did it already for StandardAna see patch . One more PerFieldAnalyzerWrapper - Sorry Updated patch now also KeywordAnalyzer and PerFieldAnalyzerWrapper made final and the backwards layer removed. I will commit this later this day and proceed with contrib. Robert we should talk who does which one Updated patch after last commit. Committed core part in revision 932749 here is a start for the remaining ones what was in contrib analyzers . theres a few more i didnt do yet but most are done. i converted some more usages here... there is still a lot more to do. separately we should open another issue if there isnt one for use of other preflex apis in contrib as i see some uses of TermEnum etc just fixing these up. separately we should open another issue if there isnt one for use of other preflex apis in contrib as i see some uses of TermEnum etc just fixing these up. We have LUCENE-2378 open for this Ð I gotta get to it ok this is the rest of it minus anything tricky. i will leave the hard stuff to uwe i updated the patch with the problematic ones... we can fix their other problems on LUCENE-2378 for example convert MemoryIndex to use byte in this patch i only switch it to consume with BytesRef but it calls utf8ToString since the whole thing still works with String. i updated the patch to remove all uses of deprecated CharTermAttributeImpl methods such as via Token.term etc. with this patch we can then remove TermAttribute from trunk completely by removing deprecations and the sophisticated backwards layer in the indexer. Committed LUCENE-2372 contrib solr.patch revisions 950008 trunk 950026 3x everything is cutover to the new attribute now Bulk close for 3.1
