improve windows defaults in FSDirectory
Currently windows defaults to SimpleFSDirectory but this is a problem due to the synchronization. I have been benchmarking queries sequentially and was pretty surprised at how much faster MMapDirectory is for example for cases that do many seeks. I think we should change the defaults for windows as such if WINDOWS and UNMAP SUPPORTED and 64-bit use MMapDirectory else use SimpleFSDirectory I think we should just consider doing this for 4.0 only and see how it goes. Here s the patch sets the defaults as described in the issue turns on unmap by default if its possible when unmapping inputs we should be careful to never allow the region to be accessed. so in close we ensure that clones too set their buffer to null. and in clone we add a friendlier exception rather than NPE. by the way all lucene solr tests pass on 64-bit windows with -Dtests.directory FSDirectory I think we should just consider doing this for 4.0 only and see how it goes. 1 that does seem to be the best option for windows servers at this point. same patch only i added the same safety ensuring clones null their buffers to the MultiMMapII that I added to the MMapII. by the way i ran all tests with -Dtests.directory MMapDirectory under both Oracle BEA Jrockit and IBM although this one 32 bit both these support the unmap hack and all lucene solr tests pass except for an unrelated thai issue LUCENE-2653 so i d like to commit this to trunk only in a few days if no one objects. I m going to add the extra safety here for cloned mmapindexinputs as a separate commit from changing the defaults in case we have to revert the defaults . Its also good to backport unlike the defaults Committed revision 999409 to trunk. I d like to reopen this issue to propose backporting the defaults change for 64-bit windows to 3.x Its been a few months now with this default in trunk and there haven t been any reported problems. Additionally our tests are much better now e.g. we test all directory impls . Committed revision 1043666 branch 3x Bulk close for 3.1
