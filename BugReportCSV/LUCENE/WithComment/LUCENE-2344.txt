PostingsConsumer merge does not call finishDoc
We discovered that the current merge function in PostingsConsumer is not calling the finishDoc method. This does not have consequences for the standard codec since the lastPosition is set to 0 in startDoc and its finishDoc method is empty but for the SepCodec this results in position file corruption the lastPosition is set to 0 in finishDoc for the SepCodec . Good catch I ll commit shortly. Include a fix for PostingsConsumer merge and a unit test using the SepCodec for reproducing the errors. Sorry Michael I had already the patch on the way. Feel free to use it or not. Cheers Patch looks great Ð I like the new unit test. I m going to try to get some of our tests to actively test the other codecs so we catch this sort of thing sooner... New patch starting from Renaud s and then adding a new oal.util.MultiCodecTestCase which a test class can subclass if it wants to run all tests on the 4 core codecs. I also cutover a few tests to use it... Thanks Renaud 
