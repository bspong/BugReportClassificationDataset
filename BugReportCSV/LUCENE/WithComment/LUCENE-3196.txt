Optimize FixedStraightBytes for bytes size 1
Currently we read all the bytes in a PagedBytes instance wich is unneeded for single byte values like norms. For fast access this should simply be a straight array. here is a patch Looks good Simon Probably other smallish sizes 2 3 4 ... could be a single array too ie paged or not should be separately controllable but we can do that later this is a great baby step since we need this for norms cutover. Do we have a test eg a random test that picks random fixed byte size that covers this... Do we have a test eg a random test that picks random fixed byte size that covers this... yes the fixed length is selected at random in the tests I fixed that in the patch too. Ahh yes great selckin s random number generator should hit 1 frequently I am planning to commit this soon if nobody objects. Looks fine using this approach separate norms impl can hopefully go away quite fast g For the PreFlex codec I even have an idea for the codec and backwards compatibility The old norms file could be exposed as standard DocValues field by PreFlex codec. The r w StandardCodec would never write separate norms files instead simply write docvalues using this 1 byte approach of course configureable to have e.g. read float norms and other additional BM25 statistics or whatever . Just ideas Uwe Committed in revision 1135293.
