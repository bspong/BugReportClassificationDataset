AttributeSource.addAttribute should only accept interfaces the missing test leads to problems with Token.TOKEN ATTRIBUTE FACTORY
This is a blocker because you can call addAttribute Token.class without getting an error message. I will commit the fix and restart the vote for 3.0. This also applies to 2.9 but there is no Token Attribute Factory. But I will merge to 2.9 too if a 2.9.2 comes. Here the patch will commit soon and respawn 3.0. I will also merge to 2.9 branch. Attribute.class.isAssignableFrom attClass What is this for This line public A extends Attribute A addAttribute Class A attClass ensures the same at compile time. If you use it type unsafe without generics it will break. And we need it for 2.9. You can break this if you do addAttribute Class List.class I was thinking about both variants and thought it would be better to leave it in. I will merge this now to 2.9 too where we need it in all cases. This patch shows how you can break. As Shai said the problem is not only that it may have no effect it completely breaks the behaviour of AttributeSource when you do this. Because of that the extra check is needed. Thinking about it more and reading http bugs.sun.com bugdatabase view bug.do bug id 6461827 maybe we should remove it again. But addAttributeImpl already does a lot of isAssignableFrom checks but cached so maybe we should remove it for 3.0 3.1. In 2.9 it must stay alive. What do others think But its no problem anymore the sun bug is fixed since Release Fixed 6u2 b01 5.0u12 b02 Bug ID 2144702 hs10 b07 Bug ID 2146432 7 b07 Bug ID 2176843 Let s keep it in. Forgot to resolve this.
