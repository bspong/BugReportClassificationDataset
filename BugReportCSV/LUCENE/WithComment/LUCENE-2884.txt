StandardCodec sometimes supplies skip pointers past EOF
Pretty sure this is 4.0-only I added an assertion the test to reproduce is ant test-core -Dtestcase TestPayloadNearQuery -Dtestmethod testMinFunction -Dtests.seed 4841190615781133892 3888521539169738727 -Dtests.multiplier 3 junit Testcase testMinFunction org.apache.lucene.search.payloads.TestPayloadNearQuery FAILED junit invalid skip pointer 404 length 337 junit junit.framework.AssertionFailedError invalid skip pointer 404 length 337 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1127 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1059 junit at org.apache.lucene.index.codecs.MultiLevelSkipListReader.init MultiLevelSkipListReader.java 176 junit at org.apache.lucene.index.codecs.standard.DefaultSkipListReader.init DefaultSkipListReader.java 50 junit at org.apache.lucene.index.codecs.standard.StandardPostingsReader SegmentDocsAndPositionsAndPayloadsEnum.advance StandardPostingsReader.java 742 junit at org.apache.lucene.search.spans.TermSpans.skipTo TermSpans.java 72 wierd as simon mentioned its not entirely deterministic. sometimes the test passes with the same seed... sometimes not. if I wire the test to use SerialMergeScheduler it passes always. OK I found the problem Ð in SPR.nextTerm when the term s docFreq is low enough to not have any skip data we don t change the .skipOffset in the TermState. This then confuses the D P enums because they check this field to decide whether to load skip data. I have no idea why suddenly today this caused so many failures Will commit a fix shortly... Thanks for tracking this down Mike 
