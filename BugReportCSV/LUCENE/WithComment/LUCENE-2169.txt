Speedup of CharArraySet copy if a CharArraySet instance is passed to copy.
the copy method should use the entries array itself to copy the set internally instead of iterating over all values. this would speedup copying even small set here is a patch Patch that extends test to verify that the documented behaviour on arbitrary objects using toString works correctly. This also fixes the issue of preserving matchVersion. Better patch that is more clear and structured. Also improved javadocs. Uwe when I first looked at your patch I thought that is a good idea but once I looked at the usecases of CharArraySet differentiating between matchVersion if the given set is an instance of CharArraySet is not idea IMO. Imagine you create an analyzer with CharArraySet the analyzer will use its own given version together with the copy method internally if the analyzer is created with a different version than the provided stopset which is already a CharArraySet copy could change the behavior due to the given version with is actually the matchVersion for the analyzer not for the set. I would leave the decision to the user if a copy with a different version is what the user wants. If the version should not be preserved and the set to copy is a charArraySet users should use the constructor directly. I will attach a patch shortly patch that incorporates uwes additions to the testcases and enforces the Version of the source set in the copy if it is an instance of CharArraySet But you now changed the behaviour of copy . Before the patch it changed the CharArraySets matchVersion... That was what my patch was doing to preserve this behaviour. But you now changed the behaviour of copy . Before the patch it changed the CharArraySets matchVersion... That was what my patch was doing to preserve this behaviour. the CharArraySet did not have a Version before 3.1 so this code has never been released. Changing this behavior is fine and will not break anything though. simon OK. I will commit this together with LUCENE-2179. Committed revision 893655
