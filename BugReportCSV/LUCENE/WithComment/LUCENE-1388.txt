Add init method to CloseableThreadLocal
Java ThreadLocal has an init method that allows subclasses to easily instantiate an initial value. LUCENE-1388.patch Added the initialValue method and a test case. Wrong test case in previous patch. Normally initialValue is called from get the first time get is invoked if set wasn t called . But this patch calls it in the ctor in which case I think we should simply pass in the initial value as an arg to the ctor The code is incorrect. It needs to be in the get method as each thread needs to have initialValue called on the first get . LUCENE-1388.patch Initvalue is summoned in the get method. Includes a extraordinarily simple test case. Patch looks good I ll commit shortly. Thanks Jason Sending src java org apache lucene util CloseableThreadLocal.java Adding src test org apache lucene index TestCloseableThreadLocal.java Transmitting file data .. Committed revision 695899. Should the null check in the get method by synchronized Or does it matter Should the null check in the get method by synchronized I don t think that s necessary.
