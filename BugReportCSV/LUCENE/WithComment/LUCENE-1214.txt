Possible hidden exception on SegmentInfos commit
I am not sure if this is that big of a deal but I just ran into it and thought I might mention it. SegmentInfos.commit removes the Segments File if it hits an exception. If it cannot remove the Segments file because its not there or on Windows something has a hold of it another Exception is thrown about not being able to delete the Segments file. Because of this you lose the first exception which might have useful info including why the segments file might not be there to delete. Mark Good catch Mark. It seems like we should ignore any exception while trying to delete the partially written segments N file and throw the original exception. I ll do that. How did you hit these two exceptions Attached patch. All tests pass. I plan to commit in a day or so. I am still trying to work that out...some craziness that started after I updated Lucene to trunk but also made other fundamental changes and windows vista may be haunting me too... The gist of it is that Lucene is failing when it tries to create an index file creates the directory fine . I don t think its Lucene related at the moment but I havnt gotten to the bottom of it either. Oddly if I stop using the NoLockFactory I manually manage a single Writer things work...still digging though.
