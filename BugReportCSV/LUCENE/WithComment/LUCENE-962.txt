I O exception in DocsWriter add or updateDocument may not delete unreferenced files
If an I O exception is thrown in DocumentsWriter addDocument or updateDocument the stored fields files may not be cleaned up. Patch adds wrappers in IndexWriter to catch exceptions thrown in docswriter and to call deleter.refresh before passing the exception back to the caller. Adds a test. I might have possibly not picked the best place to do that catch ... Good catch Steven I think where you put the try finally is good. The only tiny thing I noticed is in your unit test when you create the MockRAMDirectory you don t have to pass in an empty RAMDirectory you can just use the no-argument constructor instead. I will commit this.
