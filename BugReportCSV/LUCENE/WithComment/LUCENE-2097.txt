In NRT mode and CFS enabled IndexWriter incorrectly ties up disk space
Spinoff of java-user thread titled searching while optimize ... If IndexWriter is in NRT mode you ve called getReader at least once and CFS is enabled then internally the writer pools readers. However after a merge completes it opens the reader against het non-CFS segment files and pools that. It then builds the CFS file as well thus tying up the storage for that segment twice. Functionally the bug is harmless it s only a disk space issue . Also when the segment is merged the disk space is released again though the newly merged segment will also be double-tied-up . Simple workaround is to use non-CFS mode or don t use getReader. Attached patch with test case that shows the issue. Not yet sure what s the best way to fix it... probably we have to build the CFS before opening the reader we want to pool. This was separately fixed Ð we now build the CFS before cutting over to it in the in-memory segments. Bulk close for 3.1
