Sep codec should store less in terms dict
I m working on improving Lucene s performance with int block codecs FOR PFOR but in early perf testing I found that these codecs cause a big perf hit to those MTQs that need to scan many terms but don t end up accepting many of those terms eg fuzzy wildcard regexp . This is because sep codec stores much more in the terms dict since each file is separate ie seek points for each of doc frq pos pyl skp files. So I d like to shift these seek points to instead be stored in the doc file except for the doc seek point itself. Since a given query will always need to seek to the doc file this does not add an extra seek. But it saves tons of vInt decodes for the next seke intensive MTQs... Patch. Note that this is a change to the index format but no core codecs actually use the abstract sep codec yet LUCENE-1410 will change that . So I ran a simple perf test using MockSep which naively writes each vInt separately Query QPS trunk QPS patch Pct diff unit state 7.74 7.78 0.4 uni 17.12 17.31 1.1 unit state 10.75 10.95 1.9 unit 29.71 30.38 2.3 unit state 11.99 12.36 3.1 un d 65.00 67.85 4.4 state 38.43 40.16 4.5 u d 19.92 21.94 10.1 united 0.7 24.02 30.30 26.2 united 0.6 5.26 7.00 33.2 It s a good speedup for the two fuzzy queries and also u d...
