IndexWriter.commit does not update the index version
IndexWriter.commit can update the index version and generation but the update of version is lost. As result added documents are not seen by IndexReader.reopen . There might be other side effects that I am not aware of . The fix is 1 line - update also the version in SegmentsInfo.updateGeneration . Finding this line involved more lines though... Patch with a fix a test that demonstrates the bug. All core tests pass. Will run all tests later on. Good catch Doron thanks This only affects trunk 2.4 . Oh good less migration to do. Mmm.. so it is not related to Daniel s Document ID shuffling under 2.3.x in the user list. Does SegmentInfos really need both version and generation Is generation sufficient Does SegmentInfos really need both version and generation Is generation sufficient I believe they are in fact redundant. I tested this with a small change to just return generation when getVersion is called and all tests pass. I ll open a new issue. Committed.
