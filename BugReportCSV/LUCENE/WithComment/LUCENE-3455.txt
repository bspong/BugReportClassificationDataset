All Analysis Consumers should use reusableTokenStream
With Analyzer now using TokenStreamComponents theres no reason for Analysis consumers to use tokenStream it just gives bad performance . Consequently all consumers will be moved over to using reusableTokenStream . The only challenge here is that reusableTokenStream throws an IOException which many consumers are not rigged to deal with. Once all consumers have been moved we can rename reusableTokenStream back to tokenStream . 1 there is a lot of crazy code around this area consumers catching the exception from reusableTokenStream and falling back to tokenStream and other silly things. Patch which converts all test consumers over to using reusableTokenStream. Included is a fix for PatternAnalyzer where I had missed re-creating the Matcher which prevented reuse. I m going to commit this shortly and then attack production code. Fixed some failing tests. Now everything is passing. Committing shortly. Committed revision 1175670. Patch which converts the last consumers over to using reusableTokenStream . Couple of changes to the classic QP included in this. Rather than silently returning null on an IOException a ParseException is now thrown. Equally where before the IOException was simply ignored an Exception is thrown. Going to commit this shortly and then change reusableTokenStream to tokenStream . Committed revision 1176191.
