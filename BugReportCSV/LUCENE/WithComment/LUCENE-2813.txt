TestIndexWriterDelete fails randomly
10 out of 9 runs with that see fail on my trunk ant test-core -Dtestcase TestIndexWriterDelete -Dtestmethod testErrorAfterApplyDeletes -Dtests.seed 4269712067829708991 1888184886355172227 -Dtests.codec randomPerField with this result junit-sequential junit Testsuite org.apache.lucene.index.TestIndexWriterDelete junit Tests run 1 Failures 2 Errors 0 Time elapsed 1.725 sec junit junit Standard Output junit NOTE reproduce with ant test -Dtestcase TestIndexWriterDelete -Dtestmethod testErrorAfterApplyDeletes -Dtests.seed 4269712067829708991 1888184886355172227 -Dtests.codec randomPerField junit NOTE test params are codec RandomCodecProvider id Standard contents SimpleText city MockSep locale ar QA timezone VST junit junit Standard Error junit NOTE all tests run in this JVM junit TestIndexWriterDelete junit junit Testcase testErrorAfterApplyDeletes org.apache.lucene.index.TestIndexWriterDelete FAILED junit junit junit.framework.AssertionFailedError junit at org.apache.lucene.index.TestIndexWriterDelete.testErrorAfterApplyDeletes TestIndexWriterDelete.java 736 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1043 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 981 junit junit junit Testcase testErrorAfterApplyDeletes org.apache.lucene.index.TestIndexWriterDelete FAILED junit ConcurrentMergeScheduler hit unhandled exceptions junit junit.framework.AssertionFailedError ConcurrentMergeScheduler hit unhandled exceptions junit at org.apache.lucene.util.LuceneTestCase.tearDown LuceneTestCase.java 503 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 1043 junit at org.apache.lucene.util.LuceneTestCase LuceneTestCaseRunner.runChild LuceneTestCase.java 981 junit junit junit Test org.apache.lucene.index.TestIndexWriterDelete FAILED Hmm I can t reproduce this neither w that seed nor w the while1 tester. Not good that we have a repro bug. That assertion trip means that the mock-failure the test tries to throw failed to throw. Also what s up w the additional CMS unhandled exc failure You don t see any other exceptions printed for CMS threads I just committed some verbosity Ð can you make a failure happen w -Dtests.verbose true and post the output we should dig deeper. i reproduced trivially on the mac. i tried windows 32bit 64bit linux 32bit all with 500 iterations this test never fails. first try on the mac boom Darwin new-host.home 10.4.0 Darwin Kernel Version 10.4.0 Fri Apr 23 18 28 53 PDT 2010 root xnu-1504.7.4 1 RELEASE I386 i386 i386 Java TM SE Runtime Environment build 1.6.0 20-b02-279-10M3065 Java HotSpot TM 64-Bit Server VM build 16.3-b01-279 mixed mode output with -Dtests.verbose true OK thanks for the output Robert. It s a test bug Ð the mock failure was throwing into a merge thread instead of the main thread. Can you try the attached patch Patch works here i tried 100 times with Simon s seed then 100 times normally... no problems. Test only bug. i tried windows 32bit 64bit linux 32bit all with 500 iterations this test never fails. weird thing - I was just gonna dig deeper but you fixed it already thanks mike robert... simon Bulk close for 3.1
