PackedInts does not support structures above 256MB
The PackedInts Packed32 and Packed64 fails when the internal structure exceeds 256MB. This is due to a missing cast that results in the bit position calculation being limited by Integer.MAX VALUE 256MB 8 2GB . Bug fixed for Packed32 and Packe64. Unit test added that triggers the bug in the non-patched versions. See LUCENE-1990 for discussion of this fix. Any objections to at least committing the fix the casts are clearly needed while we wait and sort out the test Appears to be a clear and simple bug but the test issue is not so clear and simple and looks like it could drag out the fix being applied here - but that doesn t seem necessary 1 if the test is problematic we can always either comment out the new test or Ignore it and add a note. 1 if the test is problematic we can always either comment out the new test or Ignore it and add a note. 1 - I thought about something like the Assume assumeTrue MAX HEAP MEM 256 http kentbeck.github.com junit javadoc latest org junit Assume.html assumeTrue boolean which could be set to a certain default value and would exclude the test if not enough memory is available. That would prevent uncommenting the test - I guess Ignore would work too but maybe we want disable enable at a central place for tests like that. simon I have no problems running ant test with this patch test applied. as mentioned on LUCENE-1990 ant allows 512MB in our build already. i mentioned there that it would be nice to reduce this to say 256MB but its not causing me any problems personally and computers get more RAM every day. I think we should commit with the test enabled. Runs fine for me too Ð the test only needs 256 MB so I think it s fine. Thanks Toke Bulk close after release of 3.5
