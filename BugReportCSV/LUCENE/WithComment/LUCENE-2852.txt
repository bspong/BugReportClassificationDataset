RAMInputStream hits false EOF if you seek to EOF then seek back then readBytes
TestLazyLoadThreadSafety fails in hudson possibly an issue with RAMDirectory. If you hack lucene testcase to return another directory the same seed will pass. junit NOTE reproduce with ant test -Dtestcase TestThreadSafe -Dtestmethod testLazyLoadThreadSafety -Dtests.seed -1064017852044447297 2570930923565383654 -Dtests.multiplier 3 I dont have time to dig into this one right now but i think the first thing to check is if the problem is when filesize buffersize 0 If this is the case its the same off-by-one we had in MMapDirectory. Patch. Amazing this corner case has lasted so long undetected If you seek to EOF or beyond and then seek back to the same block as where you just were then the currentBufferIndex is off and you hit premature EOF. Fixed on 3.1 4.0... I ll leave open for 2.9.x 3.0.x in case we do another release for them. Resolving. If we ever do another 2.9.x 3.0.x we can backport by looking resolved 3.x issues. Bulk close for 3.1
