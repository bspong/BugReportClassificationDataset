IndexWriter ConcurrentMergeScheduler deadlock case if starting a merge hits an exception
If you re using CMS the default and mergeInit hits an exception eg OOME we are not properly clearing IndexWriter s internal tracking of running merges. This causes IW.close to hang while it incorrectly waits for these non-started merges to finish. The fix is trivial add a try finally to mergeInit to clear the internal tracking on exception. I ll commit shortly. Uhm shouldn t the patch be committed in the 2.3 branch too as it affects 2.3.1 Yes I agree. At some point soon we should do a 2.3.2 point release and I ll port this issue back for that. targeted for 2.3.2 bug fix release
