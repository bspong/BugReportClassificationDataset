<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:59 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2730/LUCENE-2730.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2730] intermittent deadlock in TestAtomicUpdate,TestIndexWriterExceptions</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2730</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;While backporting issues for 2.9.x/3.0.x release I hit deadlocks in these two tests, under both test-core and test-tag.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12478721">LUCENE-2730</key>
            <summary>intermittent deadlock in TestAtomicUpdate,TestIndexWriterExceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sat, 30 Oct 2010 15:07:39 +0100</created>
                <updated>Wed, 1 Dec 2010 14:50:36 +0000</updated>
                    <resolved>Sun, 31 Oct 2010 14:43:41 +0000</resolved>
                            <version>2.9.3</version>
                <version>3.0.2</version>
                                <fixVersion>2.9.4</fixVersion>
                <fixVersion>3.0.3</fixVersion>
                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12926579" author="rcmuir" created="Sat, 30 Oct 2010 15:11:34 +0100"  >&lt;p&gt;I&apos;ve experienced this before too (even a few months ago).&lt;/p&gt;

&lt;p&gt;I&apos;ll try to find what rev this was introduced.&lt;/p&gt;</comment>
                    <comment id="12926581" author="mikemccand" created="Sat, 30 Oct 2010 15:30:13 +0100"  >&lt;p&gt;Attached patch.&lt;/p&gt;

&lt;p&gt;The deadlock in TestIndexWriterExceptions was due to locks being acquired in the wrong order; to fix this I&apos;ve removed synchronized from TestHash.abort.  DocumentsWriter idles all other threads before calling abort so we don&apos;t need to sync.  I&apos;ll also remove this from trunk and 3.x.&lt;/p&gt;

&lt;p&gt;TestAtomicUpdate&apos;s deadlock only happens when autoCommit=true, when one thread has called commit and the flush by that commit tries to spawn new merges, which enters CMS who then hits the max merge thread count and waits for merge threads to finish while another merge thread is attempting an autoCommit.  I don&apos;t think we need to make any changes to 3.x/trunk for this (autoCommit is gone).&lt;/p&gt;</comment>
                    <comment id="12926584" author="thetaphi" created="Sat, 30 Oct 2010 15:49:47 +0100"  >&lt;p&gt;It&apos;s there since the very beginning of 2.9/3.0. I had the hangs also in some test runs when releaseing 3.0.0! I mendioned that, but we said &quot;its a test failure, lets ignore it).&lt;/p&gt;</comment>
                    <comment id="12926585" author="thetaphi" created="Sat, 30 Oct 2010 15:50:05 +0100"  >&lt;p&gt;It happens also in backwards tests (much more often!)&lt;/p&gt;</comment>
                    <comment id="12926588" author="rcmuir" created="Sat, 30 Oct 2010 16:00:03 +0100"  >&lt;p&gt;hmm ok, because I&apos;m able to easily reproduce the TestIndexWriterExceptions with 3.0.2, &lt;br/&gt;
but i haven&apos;t had any luck with TestAtomicUpdate (seems like a different problem)&lt;/p&gt;

&lt;p&gt;pretty sure TestAtomicUpdate doesn&apos;t hang often even in 3.0.x for me now, i&apos;ll try on linux&lt;br/&gt;
too just in case.&lt;/p&gt;</comment>
                    <comment id="12926589" author="thetaphi" created="Sat, 30 Oct 2010 16:14:39 +0100"  >&lt;p&gt;Windows 7 1.5.0_22 64 hangy very often in test-tag (every 2 times)&lt;/p&gt;</comment>
                    <comment id="12926590" author="rcmuir" created="Sat, 30 Oct 2010 16:17:46 +0100"  >&lt;p&gt;Right, mine hangs very often, but on TestIndexWriterExceptions, not TestAtomicUpdate.&lt;/p&gt;

&lt;p&gt;its the TestAtomicUpdate hang that is hard to reproduce for me&lt;/p&gt;</comment>
                    <comment id="12926594" author="thetaphi" created="Sat, 30 Oct 2010 16:39:07 +0100"  >&lt;p&gt;TestAtomicUpdate is the one that hangs for me in test-tag every 2 times. Don&apos;t know why, maybe the JVM or processor speed?&lt;/p&gt;</comment>
                    <comment id="12926595" author="mikemccand" created="Sat, 30 Oct 2010 16:41:22 +0100"  >&lt;p&gt;Uwe can you test the patch and see if that fixes your TestAtomicUpdate hang?&lt;/p&gt;</comment>
                    <comment id="12926596" author="mikemccand" created="Sat, 30 Oct 2010 16:43:41 +0100"  >&lt;p&gt;OK so the TestAtomicUpdate hang only affects 2.9.x, since we removed autoCommit in 3.0.x.&lt;/p&gt;</comment>
                    <comment id="12926597" author="rcmuir" created="Sat, 30 Oct 2010 16:45:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;TestAtomicUpdate is the one that hangs for me in test-tag every 2 times. Don&apos;t know why, maybe the JVM or processor speed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, its because it does not hang in 3.0.x, only 2.9.x, they are not the same bugfix level &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12926598" author="thetaphi" created="Sat, 30 Oct 2010 16:47:50 +0100"  >&lt;p&gt;I have seen the synchronized also in TermsHash in 3.x... Do we need to remove it there, too?&lt;/p&gt;</comment>
                    <comment id="12926600" author="mikemccand" created="Sat, 30 Oct 2010 16:58:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;I have seen the synchronized also in TermsHash in 3.x... Do we need to remove it there, too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will also remove from 3.x &amp;amp; trunk, but, this does not lead to deadlock because we&apos;ve simplified how IW re-uses RAM, so this particular deadlock case can&apos;t occur.&lt;/p&gt;

&lt;p&gt;Still we should remove it, so I will...&lt;/p&gt;</comment>
                    <comment id="12926602" author="rcmuir" created="Sat, 30 Oct 2010 17:13:19 +0100"  >&lt;p&gt;I ran with the patch here on 2.9.x, and still encountered the hang in TestAtomicUpdate...&lt;/p&gt;</comment>
                    <comment id="12926603" author="thetaphi" created="Sat, 30 Oct 2010 17:21:21 +0100"  >&lt;p&gt;For me it now passes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In my opinion we should remove the stupid synchronized in TermsHash completely (also trunk and 3.x, I removed at least the compact()-sync). This class needs no sync.&lt;/p&gt;</comment>
                    <comment id="12926605" author="thetaphi" created="Sat, 30 Oct 2010 17:37:34 +0100"  >&lt;p&gt;Hangs in this and other tests can also come from incorrect test MT programming. Just think about Michael Busch&apos;s talk @ LuceneRev. The test uses some fields in the thread that are not volatile or synchronized on. The test is fixed in trunk/3.x during our total test overhaul. There are about 10 tests using the same wrong thread inner class.&lt;/p&gt;

&lt;p&gt;If we want to fix that we must also fix backwards... happy tag creating again &lt;b&gt;g&lt;/b&gt;&lt;/p&gt;</comment>
                    <comment id="12926606" author="rcmuir" created="Sat, 30 Oct 2010 17:40:46 +0100"  >&lt;p&gt;well, it still doesnt fix the problem for me, so i dont think we should go changing things yet, until we find the real cause of the hang.&lt;/p&gt;</comment>
                    <comment id="12926696" author="rcmuir" created="Sun, 31 Oct 2010 12:13:01 +0000"  >&lt;p&gt;I made my own test runner, and ran this test for hours, but i couldnt reproduce the hang.&lt;/p&gt;

&lt;p&gt;There is a general problem on windows: if we run a test and it hangs there is no way to get the SIGQUIT stacktrace.&lt;br/&gt;
if you use control-break, it only gives you the stacktrace of the &apos;ant&apos; jvm itself... somehow I would like to fix this later.&lt;/p&gt;

&lt;p&gt;but don&apos;t let me stand in the way here... perhaps i made some mistake/didn&apos;t ant clean, something silly! sorry!&lt;/p&gt;</comment>
                    <comment id="12926702" author="mikemccand" created="Sun, 31 Oct 2010 13:08:44 +0000"  >&lt;p&gt;OK I&apos;ll commit... we can reopen if the hangs happen again!&lt;/p&gt;</comment>
                    <comment id="12926704" author="mikemccand" created="Sun, 31 Oct 2010 13:22:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;In my opinion we should remove the stupid synchronized in TermsHash completely (also trunk and 3.x, I removed at least the compact()-sync). This class needs no sync.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have to be somewhat careful w/ this.&lt;/p&gt;

&lt;p&gt;Eg in 2.9.x/3.0.x some of the sync is needed because IW calls freeRAM &quot;freely&quot;, ie, while other threads are indexing.  IW still calls freeRAM in 3.x/4.0, but it&apos;s a no-op there since we don&apos;t recycle RAM as aggressively anymore.  So likely we could remove sync from TermsHash on 3.x/trunk, but let&apos;s do that another day...&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12458479" name="LUCENE-2730.patch" size="3730" author="mikemccand" created="Sat, 30 Oct 2010 15:30:13 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 30 Oct 2010 14:11:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11120</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24962</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>