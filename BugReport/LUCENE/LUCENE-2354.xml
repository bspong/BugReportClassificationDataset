<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:22:44 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2354/LUCENE-2354.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2354] Convert NumericUtils and NumericTokenStream to use BytesRef instead of Strings/char[]</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2354</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2302&quot; title=&quot;Replacement for TermAttribute+Impl with extended capabilities (byte[] support, CharSequence, Appendable)&quot;&gt;&lt;del&gt;LUCENE-2302&lt;/del&gt;&lt;/a&gt;, we should use TermToBytesRefAttribute to index using NumericTokenStream. This also should convert the whole NumericUtils to use BytesRef when converting numerics.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12460456">LUCENE-2354</key>
            <summary>Convert NumericUtils and NumericTokenStream to use BytesRef instead of Strings/char[]</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Mar 2010 22:54:06 +0000</created>
                <updated>Fri, 10 May 2013 11:44:59 +0100</updated>
                    <resolved>Mon, 5 Apr 2010 09:07:59 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12850682" author="thetaphi" created="Sun, 28 Mar 2010 16:04:57 +0100"  >&lt;p&gt;Here a first preview patch.&lt;/p&gt;

&lt;p&gt;NumericUtils still contains lots of unused String-based methods, I think we should remove them, the class is expert-only and also experimental. Backwards compatibility is broken even with those backwards layers (as the split functions were changed to use BytesRefs. Also these backwards methods are simply slow now (as the byte[] is copied to char[] and vice-versa).&lt;/p&gt;

&lt;p&gt;The new NumericTokenStream now uses a special NumericTermAttribute, so possibly Filters coming later have access to shift value and so on. This attribute also implements the TermToBytesRefAttribute for the indexer. Please note: This attribute is a hack and does not support copyTo/clone/...., so you cannot put away tokens (which is not needed), but its still possible to add further attributes to numeric tokens (which is why the attribute is there).&lt;/p&gt;

&lt;p&gt;The NumericTokenStream backwards test was removed, because the new stream does no longer contain a TermAttribute, so the test always fails.&lt;/p&gt;

&lt;p&gt;TODO: A better inline-hashCode generation for the numeric-to-BytesRef transformation&lt;/p&gt;</comment>
                    <comment id="12851008" author="mikemccand" created="Mon, 29 Mar 2010 18:12:44 +0100"  >&lt;blockquote&gt;&lt;p&gt;NumericUtils still contains lots of unused String-based methods, I think we should remove them&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Patch looks good!&lt;/p&gt;

&lt;p&gt;NumericFields are the first thing to index terms directly as byte[]&lt;br/&gt;
(ie not first going through char[]) in flex.  But the encoding is&lt;br/&gt;
unchanged right?  (Ie only using 7 bits per byte, same as trunk).&lt;/p&gt;

&lt;p&gt;And you cutover to BytesRef TermsEnum API too &amp;#8211; great.  Presumably&lt;br/&gt;
search perf would improve but only a tiny bit since NRQ visits so few&lt;br/&gt;
terms?&lt;/p&gt;</comment>
                    <comment id="12851010" author="thetaphi" created="Mon, 29 Mar 2010 18:22:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;But the encoding is unchanged right? (Ie only using 7 bits per byte, same as trunk).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. And i think we should keep it for now using 7 bit. Problems start when the sort order of terms is needed (which is the case for NRQ). As default in flex is the UTF-8 term comparator, it would not sort correctly for numeric fields with full 8 bits?&lt;/p&gt;

&lt;p&gt;By the way, the recently added backwards test checks that an old index with NumericField behaves as before! This is why I added a new zip file to TestBackwardCompatibility.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And you cutover to BytesRef TermsEnum API too - great. Presumably search perf would improve but only a tiny bit since NRQ visits so few terms?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I dont think you will notice a difference. A standard int range contains maybe 10 to 20 sub-ranges (at maximum), so converting between string and TermRef should not count. But the new implementation is more clean. In principle we could remove the whole char[]/String based API in NumericUtils - I only have to rewrite the tests and remove the NumericUtils test in backwards (as no longer applies then, too).&lt;/p&gt;</comment>
                    <comment id="12851598" author="thetaphi" created="Tue, 30 Mar 2010 22:15:56 +0100"  >&lt;p&gt;Will work here the next days and rewrite the tests.&lt;/p&gt;

&lt;p&gt;One problem: Solr at the moment uses the deprecated string api for building a TermQuery. This should be replaced by a NRQ with upper==lower(inclusive), as this disables scoring, which is wrong for Numeric fields.&lt;/p&gt;</comment>
                    <comment id="12853268" author="thetaphi" created="Sun, 4 Apr 2010 18:09:40 +0100"  >&lt;p&gt;Here updated patch with cleaned up NumericUtils (no String methods anymore). For now I just commented them out, if we want to reactivate parts of them. Before release the methods should be removed.&lt;/p&gt;

&lt;p&gt;I changed all tests (and deactivated tests in backwards) using those String methods. Also rewrote the CartesianShapeFilter in contrib/spatial to use flex API (optimized for the one-term-case without OpenBitSet allocation). Also changed spatial tests to use NumericField.&lt;/p&gt;</comment>
                    <comment id="12853273" author="mikemccand" created="Sun, 4 Apr 2010 21:07:18 +0100"  >&lt;p&gt;Patch looks good Uwe!&lt;/p&gt;</comment>
                    <comment id="12853281" author="thetaphi" created="Mon, 5 Apr 2010 00:16:44 +0100"  >&lt;p&gt;Updated patch with lots of javadocs cleanups and new getPrefixCodedXxxShift() methods. Also optimized some methods.&lt;/p&gt;

&lt;p&gt;I will commit this tomorrow!&lt;/p&gt;</comment>
                    <comment id="12853335" author="thetaphi" created="Mon, 5 Apr 2010 09:07:58 +0100"  >&lt;p&gt;Committed revision: 930821&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12460445">LUCENE-2352</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="12310040">
                <name>Required</name>
                                <outwardlinks description="requires">
                            <issuelink>
            <issuekey id="12458401">LUCENE-2302</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12440725" name="LUCENE-2354.patch" size="72398" author="thetaphi" created="Mon, 5 Apr 2010 00:16:44 +0100" />
                    <attachment id="12440721" name="LUCENE-2354.patch" size="67775" author="thetaphi" created="Sun, 4 Apr 2010 18:09:40 +0100" />
                    <attachment id="12440011" name="LUCENE-2354.patch" size="39043" author="thetaphi" created="Sun, 28 Mar 2010 16:04:57 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 29 Mar 2010 17:12:44 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11442</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25336</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>