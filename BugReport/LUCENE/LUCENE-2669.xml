<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:29:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2669/LUCENE-2669.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2669] NumericRangeQuery.NumericRangeTermsEnum sometimes seeks backwards</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2669</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Subclasses of FilteredTermsEnum are &quot;supposed to&quot; seek forwards only (this gives better performance, typically).&lt;/p&gt;

&lt;p&gt;However, we don&apos;t check for this, so I added an assert to do that (while digging into testing the SimpleText codec) and NumericRangeQuery trips the assert!&lt;/p&gt;

&lt;p&gt;Other MTQs seem not to trip it.&lt;/p&gt;

&lt;p&gt;I think I know what&apos;s happening &amp;#8211; say NRQ has term ranges a-c, e-f to seek to, but then while it&apos;s .next()&apos;ing through the first range, the first term after c is f.  At this point NRQ sees the range a-c is done, and then tries to seek to term e which is before f.  Maybe NRQ&apos;s accept method should detect this case (where you&apos;ve accidentally .next()&apos;d into or possibly beyond the next one or more seek ranges)?&lt;/p&gt;</description>
                <environment></environment>
            <key id="12475141">LUCENE-2669</key>
            <summary>NumericRangeQuery.NumericRangeTermsEnum sometimes seeks backwards</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sun, 26 Sep 2010 18:57:55 +0100</created>
                <updated>Fri, 10 May 2013 11:43:37 +0100</updated>
                    <resolved>Mon, 27 Sep 2010 05:08:08 +0100</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12915009" author="mikemccand" created="Sun, 26 Sep 2010 18:59:49 +0100"  >&lt;p&gt;Patch w/ 2 asserts.  NRQ only trips up on the first (FilteredTermsEnum) assert.  That it doesn&apos;t trip the 2nd shows that indeed its seek ranges are properly sorted...&lt;/p&gt;</comment>
                    <comment id="12915013" author="rcmuir" created="Sun, 26 Sep 2010 19:23:52 +0100"  >&lt;p&gt;This is a good catch: NRQ should play ping-pong to avoid these unnecessary seeks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12915028" author="thetaphi" created="Sun, 26 Sep 2010 21:07:46 +0100"  >&lt;p&gt;Here a patch that fixed NRTE to only seek forward. This should also improve NRQ&apos;s perf in trunk.&lt;/p&gt;

&lt;p&gt;It works like the following:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;nextSeekTerm() checks that the next range already fits the &lt;b&gt;current&lt;/b&gt; term. If not it forwards to the next sub-range and returns a seek term that is at least greater or equal the &lt;b&gt;current&lt;/b&gt; term&lt;/li&gt;
	&lt;li&gt;accept() checks for the non-hit case (seldom as for a NRQ most terms are hits until the upper sub-range-bound is reached), if the next sub-range lower bound term on the stack is greater that the &lt;b&gt;current&lt;/b&gt; one, and only then returns NO_AND_SEEK. If this is not the case, it does not seek but instead only move forward to the next sub-range and repeats the bounds checks &lt;span class=&quot;error&quot;&gt;&amp;#91;for(;;) loop&amp;#93;&lt;/span&gt;.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                    <comment id="12915030" author="thetaphi" created="Sun, 26 Sep 2010 21:25:33 +0100"  >&lt;p&gt;Slightly more readable patch: for(;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;-loop removed and so first if check in accept() negated and used as while-clause instead&lt;/p&gt;

&lt;p&gt;Mike you set this as fix 3.1 and 4.0, but 3.1 does not have FilteredTermsEnum. We cannot fix it there easily, as it uses the old style logic from 3.0.&lt;/p&gt;</comment>
                    <comment id="12915031" author="mikemccand" created="Sun, 26 Sep 2010 21:27:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;Mike you set this as fix 3.1 and 4.0, but 3.1 does not have FilteredTermsEnum. We cannot fix it there easily, as it uses the old style logic from 3.0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Woops, right &amp;#8211; I&apos;ll fix to 4.0 only.&lt;/p&gt;</comment>
                    <comment id="12915032" author="thetaphi" created="Sun, 26 Sep 2010 21:28:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;Mike you set this as fix 3.1 and 4.0, but 3.1 does not have FilteredTermsEnum. We cannot fix it there easily, as it uses the old style logic from 3.0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can maybe fix this also in 3.0 and not fetch a new enum, when the same conditions apply. But its totally different code, will do that in a separate patch, if its easy (the 3.0/3.1 enum is complicated...)&lt;/p&gt;</comment>
                    <comment id="12915108" author="thetaphi" created="Mon, 27 Sep 2010 05:08:08 +0100"  >&lt;p&gt;Committed revision: 1001582&lt;/p&gt;

&lt;p&gt;Thanks Mike for catching this!&lt;/p&gt;</comment>
                    <comment id="12915243" author="mikemccand" created="Mon, 27 Sep 2010 10:12:21 +0100"  >&lt;p&gt;Sweet, that was fast &amp;#8211; thanks Uwe!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12455622" name="LUCENE-2669.patch" size="3567" author="thetaphi" created="Sun, 26 Sep 2010 21:25:33 +0100" />
                    <attachment id="12455621" name="LUCENE-2669.patch" size="3574" author="thetaphi" created="Sun, 26 Sep 2010 21:07:46 +0100" />
                    <attachment id="12455615" name="LUCENE-2669.patch" size="1490" author="mikemccand" created="Sun, 26 Sep 2010 18:59:48 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 26 Sep 2010 18:23:52 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11172</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25023</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>