<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-265/LUCENE-265.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-265] [PATCH] to remove synchronized code from TermVectorsReader</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-265</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Otis,&lt;/p&gt;

&lt;p&gt;here the latest and last patch to get rid of all synchronized code from&lt;br/&gt;
TermVectorsReader. It should include at least 3 files, TermVectorsReader.diff,&lt;br/&gt;
SegmentReader.diff and the new junit test case TestMultiThreadTermVectors.java.&lt;br/&gt;
The patch was generated against the current CVS version of TermVectorsReader and&lt;br/&gt;
SegmentReader. All lucene related junit tests pass fine.&lt;/p&gt;

&lt;p&gt;best regards&lt;br/&gt;
Bernhard&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
            <key id="12314415">LUCENE-265</key>
            <summary>[PATCH] to remove synchronized code from TermVectorsReader</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="java-dev@lucene.apache.org">Lucene Developers</assignee>
                                <reporter username="bernhard.messer@intrafind.de">Bernhard Messer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Aug 2004 03:53:19 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:40 +0100</updated>
                    <resolved>Sat, 27 May 2006 02:38:06 +0100</resolved>
                                                            <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12321845" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:54:30 +0100"  >&lt;p&gt;Created an attachment (id=12477)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;PATCH&amp;#93;&lt;/span&gt; new version of TermVectorsReader without synchronized code.&lt;/p&gt;</comment>
                    <comment id="12321846" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:55:22 +0100"  >&lt;p&gt;Created an attachment (id=12478)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;PATCH&amp;#93;&lt;/span&gt; new version of SegmentReader using ThreadLocal for accessing TermVectorsReader&lt;/p&gt;</comment>
                    <comment id="12321847" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:55:56 +0100"  >&lt;p&gt;Created an attachment (id=12479)&lt;br/&gt;
[PATCH} new multithreaded TermVectors test class&lt;/p&gt;</comment>
                    <comment id="12321848" author="otis@apache.org" created="Thu, 19 Aug 2004 19:47:49 +0100"  >&lt;p&gt;Bernhard,&lt;/p&gt;

&lt;p&gt;Thanks for the patch.  The unit test requires class o.a.lucene.util.English. &lt;br/&gt;
This is not in CVS.  Is this something that should be in the CVS?  What is it?&lt;/p&gt;

&lt;p&gt;I am also wondering about this piece of code:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;termVectorsReader = new TermVectorsReader(cfsDir, segment, fieldInfos);&lt;br/&gt;
+       final Directory dir = cfsDir;&lt;br/&gt;
+       termVectorsLocal = new ThreadLocal() {&lt;br/&gt;
+               protected synchronized Object initialValue() 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                       try {
+                               return new TermVectorsReader(dir, segment,
fieldInfos);
+                       } catch (IOException ioe) {
+                               ioe.printStackTrace();
+                               return null;
+                       }+               }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+       };&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Is is a good thing to &apos;eat&apos; that IOException and quietly return null?  The&lt;br/&gt;
method where this code is, is already throwing IOException, so why not let the&lt;br/&gt;
IOException pop up?&lt;/p&gt;

&lt;p&gt;Finally, it looks like diffs contain tabs.  Could you please change tabs to 2&lt;br/&gt;
spaces?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Otis&lt;/p&gt;</comment>
                    <comment id="12321849" author="bernhard.messer@intrafind.de" created="Sun, 22 Aug 2004 03:15:29 +0100"  >&lt;p&gt;Created an attachment (id=12501)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;PATCH&amp;#93;&lt;/span&gt; all source and diff files necessary for the patch&lt;/p&gt;</comment>
                    <comment id="12321850" author="bernhard.messer@intrafind.de" created="Sun, 22 Aug 2004 03:15:50 +0100"  >&lt;p&gt;Otis,&lt;/p&gt;

&lt;p&gt;here is the patch to get rid of synchronized parts in TermVectorsReader. As&lt;br/&gt;
described in my previous mail, TermVectorReader is cloneable now. In&lt;br/&gt;
SegmentReader there is still the original TermVectorReader object created,. This&lt;br/&gt;
object is necessary so that we can close opened streams. All threads get there&lt;br/&gt;
own local copy, which is a clone from the original and stored within the&lt;br/&gt;
ThreadLocal.&lt;/p&gt;

&lt;p&gt;There is also a change in Exception handling. I noticed that IndexReader already&lt;br/&gt;
throws an IOException in the two getTermFreqVectors(...) methods. In the&lt;br/&gt;
implementation of the cvs version, TermVectorsReader class catches all&lt;br/&gt;
exceptions and prints either stacktrace or swallowed it. Exception within&lt;br/&gt;
TermVecvtorsReader never popped up at the caller. The patch now catches all&lt;br/&gt;
possible exceptions in TermVectorsReader and is throwing a new IOException which&lt;br/&gt;
is passed to SegmentReader.&lt;/p&gt;

&lt;p&gt;The zip attachment includes 5 files:&lt;br/&gt;
TermVectorsReader.diff&lt;br/&gt;
SegmentReader.diff&lt;br/&gt;
TestMultiThreadTermVectors.java &amp;#8211; this is a new junit test to test multithreading&lt;br/&gt;
TestSegmentReader.diff &amp;#8211; IOException has to be caught&lt;br/&gt;
TestTermVectorsReader.diff &amp;#8211; adjust to the new behaviour&lt;/p&gt;

&lt;p&gt;all junit tests passed fine. Although a test indexing 25.000 text files passed.&lt;/p&gt;

&lt;p&gt;best regards&lt;br/&gt;
Bernhard&lt;/p&gt;</comment>
                    <comment id="12321851" author="otis@apache.org" created="Mon, 23 Aug 2004 21:18:30 +0100"  >&lt;p&gt;Bernhard,&lt;/p&gt;

&lt;p&gt;I&apos;ll try looking at this some time this week.  Did you run your performance&lt;br/&gt;
tests against the code with these changes applied?  What is the performance gain&lt;br/&gt;
now?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    <comment id="12321852" author="bernhard.messer@intrafind.de" created="Tue, 24 Aug 2004 04:57:22 +0100"  >&lt;p&gt;yes i did. The performance improve will be visible having multiple threads&lt;br/&gt;
fetching term vectors and sharing the same IndexReader. It&apos;s hardly to test on a&lt;br/&gt;
single processor machine and thats all i have for the moment. The tests i did, &lt;br/&gt;
runs against an index with 25.000 text files (avg. 4KB per file). The test is&lt;br/&gt;
firing 500 calls per thread to fetch term vectors with a random generated&lt;br/&gt;
document id. Before i start the real measurement, i&apos;m running several thousand&lt;br/&gt;
queries against the index to warm up lucene and the file system cache. What you&lt;br/&gt;
see is that the performance boost is between 0% running a single thread and 30%&lt;br/&gt;
running 10 threads. I&apos;m sure it would be even better running it on a multiple&lt;br/&gt;
processor machine.&lt;br/&gt;
Where i have no explanation for, is that the index creation process is about 10%&lt;br/&gt;
faster using the patch.&lt;/p&gt;

&lt;p&gt;best regards&lt;br/&gt;
Bernhard&lt;/p&gt;</comment>
                    <comment id="12321853" author="goller@detego-software.de" created="Wed, 6 Oct 2004 19:43:03 +0100"  >&lt;p&gt;Thank you very much for your patch. &lt;br/&gt;
I reviewed and applied it.&lt;/p&gt;

&lt;p&gt;best regards,&lt;br/&gt;
Christoph&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312381" name="ASF.LICENSE.NOT.GRANTED--SegmentReader.diff" size="2436" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:55:22 +0100" />
                    <attachment id="12312380" name="ASF.LICENSE.NOT.GRANTED--TermVectorsReader.diff" size="1333" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:54:30 +0100" />
                    <attachment id="12312383" name="ASF.LICENSE.NOT.GRANTED--TermVectorsReaderPatch.tgz" size="3620" author="bernhard.messer@intrafind.de" created="Sun, 22 Aug 2004 03:15:29 +0100" />
                    <attachment id="12312382" name="ASF.LICENSE.NOT.GRANTED--TestMultiThreadTermVectors.java" size="4227" author="bernhard.messer@intrafind.de" created="Thu, 19 Aug 2004 03:55:56 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>30736</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 19 Aug 2004 18:47:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13484</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27466</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>