<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:47 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-393/LUCENE-393.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-393] Inconsistent scoring with SpanTermQuery in BooleanQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-393</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;When a SpanTermQuery is added to a BooleanQuery, incorrect results are &lt;br/&gt;
returned.&lt;/p&gt;

&lt;p&gt;I am running Lucene 1.9 RC1 on Windows XP.  I have a test case which has &lt;br/&gt;
several tests.  It has an index with 4 identical documents in it.&lt;/p&gt;

&lt;p&gt;When two TermQuerys are used in a BooleanQuery, the score looks like this:&lt;br/&gt;
  4 hits for search: two term queries&lt;br/&gt;
    ID:1 (score:0.54932046)&lt;br/&gt;
    ID:2 (score:0.54932046)&lt;br/&gt;
    ID:3 (score:0.54932046)&lt;br/&gt;
    ID:4 (score:0.54932046)&lt;/p&gt;

&lt;p&gt;Notice how it is correctly setting the score to be the same for each document.&lt;/p&gt;

&lt;p&gt;When two SpanQuerys are used in a BooleanQuery, the score looks like this:&lt;br/&gt;
  2 hits for search: two span queries&lt;br/&gt;
    ID:1 (score:0.3884282)&lt;br/&gt;
    ID:4 (score:0.1942141)&lt;/p&gt;

&lt;p&gt;Notice how it only returned two documents instead of four.  And the two it did &lt;br/&gt;
return have differing scores.&lt;/p&gt;

&lt;p&gt;I believe that there is an error in the scoring algorithm that is making the &lt;br/&gt;
other two documents not show up.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
            <key id="12314543">LUCENE-393</key>
            <summary>Inconsistent scoring with SpanTermQuery in BooleanQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="java-dev@lucene.apache.org">Lucene Developers</assignee>
                                <reporter username="yahootintin-lucene@yahoo.com">Reece (YT)</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jun 2005 02:31:42 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:29 +0100</updated>
                    <resolved>Sat, 27 May 2006 02:39:06 +0100</resolved>
                                                            <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12322422" author="yahootintin-lucene@yahoo.com" created="Thu, 2 Jun 2005 02:41:38 +0100"  >&lt;p&gt;Created an attachment (id=15247)&lt;br/&gt;
Test case that demonstrates the SpanTermQuery issue&lt;/p&gt;</comment>
                    <comment id="12322423" author="yahootintin-lucene@yahoo.com" created="Thu, 2 Jun 2005 03:00:22 +0100"  >&lt;p&gt;The test case also fails with Lucene 1.4.3 on Windows.&lt;/p&gt;</comment>
                    <comment id="12322424" author="paul.elschot@xs4all.nl" created="Thu, 2 Jun 2005 04:48:32 +0100"  >&lt;p&gt;Created an attachment (id=15251)&lt;br/&gt;
The same test case using a RAMDirectory&lt;/p&gt;

&lt;p&gt;I think a SpanTermQuery is not intended to be used directly in a BooleanQuery,&lt;br/&gt;
and only SpanNearQuery, SpanNotQuery or SpanFirstQuery should be used&lt;br/&gt;
as subqueries of BooleanQuery.&lt;/p&gt;

&lt;p&gt;Nevertheless, with the current javadocs, I think one would expect this&lt;br/&gt;
to work.&lt;/p&gt;

&lt;p&gt;The attachment is in package org.apache.lucene.search.spans and it&apos;s adapted&lt;br/&gt;
to use a RAMDirectory, unchanged for the rest.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Paul Elschot.&lt;/p&gt;</comment>
                    <comment id="12322425" author="yahootintin-lucene@yahoo.com" created="Thu, 2 Jun 2005 08:18:50 +0100"  >&lt;p&gt;I think I&apos;m on the right track but could use some advice from someone who &lt;br/&gt;
understands the ConjuctionScorer better than I.&lt;/p&gt;

&lt;p&gt;The ConjuctionScorer.doNext() method calls skipTo(lastDocId) which makes the &lt;br/&gt;
SpanScorer skip to the last span.  This means that the middle spans are &lt;br/&gt;
skipped and so those spans are incorrectly omitted from the results.  &lt;/p&gt;

&lt;p&gt;Does anyone know why this scorer is trying to skip to the last document?  I &lt;br/&gt;
presume its necessary but am not sure why.&lt;/p&gt;</comment>
                    <comment id="12322426" author="yahootintin-lucene@yahoo.com" created="Thu, 2 Jun 2005 08:33:56 +0100"  >&lt;p&gt;(In reply to comment #4)&lt;br/&gt;
&amp;gt; I think I&apos;m on the right track but could use some advice from someone who &lt;br/&gt;
&amp;gt; understands the ConjuctionScorer better than I.&lt;br/&gt;
&amp;gt; The ConjuctionScorer.doNext() method calls skipTo(lastDocId) which makes the &lt;br/&gt;
&amp;gt; SpanScorer skip to the last span.  This means that the middle spans are &lt;br/&gt;
&amp;gt; skipped and so those spans are incorrectly omitted from the results.  &lt;br/&gt;
&amp;gt; Does anyone know why this scorer is trying to skip to the last document?  I &lt;br/&gt;
&amp;gt; presume its necessary but am not sure why.&lt;/p&gt;

&lt;p&gt;Ignore this.  I figured it out and am working on a fix.&lt;/p&gt;</comment>
                    <comment id="12322427" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 07:58:11 +0100"  >&lt;p&gt;Created an attachment (id=15273)&lt;br/&gt;
Proposed patch to fix problem&lt;/p&gt;

&lt;p&gt;Here is the patch that fixes the problem.&lt;/p&gt;</comment>
                    <comment id="12322428" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 07:59:37 +0100"  >&lt;p&gt;Created an attachment (id=15274)&lt;br/&gt;
Simple test case that demonstrates failure.&lt;/p&gt;</comment>
                    <comment id="12322429" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 08:00:31 +0100"  >&lt;p&gt;Created an attachment (id=15275)&lt;br/&gt;
Expanded test case to make sure other SpanTermQuery functionality isn&apos;t broken.&lt;/p&gt;</comment>
                    <comment id="12322430" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 08:05:37 +0100"  >&lt;p&gt;This patch stops spans from being skipped.  A simple test in the skipTo method &lt;br/&gt;
solves the problem.&lt;/p&gt;

&lt;p&gt;The first test case shows the problem and proves that this patch solves it.  &lt;br/&gt;
The second test case contains several other tests to see if this change &lt;br/&gt;
affects other features of the SpanTermQuery.  The tests that in here all pass &lt;br/&gt;
with the patch.&lt;/p&gt;</comment>
                    <comment id="12322431" author="jakarta@ehatchersolutions.com" created="Fri, 3 Jun 2005 12:26:13 +0100"  >&lt;p&gt;Applied patch and tests.  Thanks!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312632" name="ASF.LICENSE.NOT.GRANTED--diffs.txt" size="557" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 07:58:11 +0100" />
                    <attachment id="12312634" name="ASF.LICENSE.NOT.GRANTED--TestSpanQueryBugExpanded.java" size="3586" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 08:00:31 +0100" />
                    <attachment id="12312633" name="ASF.LICENSE.NOT.GRANTED--TestSpanQueryBug.java" size="5592" author="yahootintin-lucene@yahoo.com" created="Fri, 3 Jun 2005 07:59:37 +0100" />
                    <attachment id="12312631" name="ASF.LICENSE.NOT.GRANTED--TestSpanQueryBug.java" size="7323" author="paul.elschot@xs4all.nl" created="Thu, 2 Jun 2005 04:48:32 +0100" />
                    <attachment id="12312630" name="ASF.LICENSE.NOT.GRANTED--TestSpanQueryBug.java" size="7323" author="yahootintin-lucene@yahoo.com" created="Thu, 2 Jun 2005 02:41:38 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35157</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 2 Jun 2005 03:48:32 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13356</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27338</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>