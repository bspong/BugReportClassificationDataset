<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:08:19 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2642/LUCENE-2642.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2642] merge LuceneTestCase and LuceneTestCaseJ4</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2642</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We added Junit4 support, but as a separate test class.&lt;/p&gt;

&lt;p&gt;So unfortunately, we have two separate base classes to maintain: LuceneTestCase and LuceneTestCaseJ4.&lt;br/&gt;
This creates a mess and is difficult to manage.&lt;/p&gt;

&lt;p&gt;Instead, I propose a single base test class that works both junit3 and junit4 style.&lt;/p&gt;

&lt;p&gt;I modified our LuceneTestCaseJ4 in the following way:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the methods to run are not limited to the ones annotated with @Test, but also any void no-arg methods that start with &quot;test&quot;, like junit3. this means you dont have to sprinkle @Test everywhere.&lt;/li&gt;
	&lt;li&gt;of course, @Ignore works as expected everywhere.&lt;/li&gt;
	&lt;li&gt;LuceneTestCaseJ4 extends TestCase so you dont have to import static Assert.* to get all the asserts.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;for most tests, no changes are required. but a few very minor things had to be changed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;setUp() and tearDown() must be public, not protected.&lt;/li&gt;
	&lt;li&gt;useless ctors must be removed, such as TestFoo(String name) 
{ super(name); }&lt;/li&gt;
	&lt;li&gt;LocalizedTestCase is gone, instead of
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestQueryParser &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; LocalizedTestCase {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it is now&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@RunWith(LuceneTestCase.LocalizedTestCaseRunner.class)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestQueryParser &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; LuceneTestCase {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Same with MultiCodecTestCase: (LuceneTestCase.MultiCodecTestCaseRunner.class}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I only did the core tests in the patch as a start, and i just made an empty LuceneTestCase extends LuceneTestCaseJ4.&lt;/p&gt;

&lt;p&gt;I&apos;d like to do contrib and solr and rename this LuceneTestCaseJ4 to only a single class: LuceneTestCase.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12473969">LUCENE-2642</key>
            <summary>merge LuceneTestCase and LuceneTestCaseJ4</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Sep 2010 12:18:16 +0100</created>
                <updated>Wed, 30 Mar 2011 16:50:10 +0100</updated>
                    <resolved>Mon, 13 Sep 2010 21:08:55 +0100</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>general/test</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12908725" author="rcmuir" created="Mon, 13 Sep 2010 12:18:53 +0100"  >&lt;p&gt;patch for core tests only, all tests pass.&lt;/p&gt;</comment>
                    <comment id="12908733" author="thetaphi" created="Mon, 13 Sep 2010 12:59:57 +0100"  >&lt;p&gt;Why not simply extend the org.junit.Assert class? This would remove use of deprecated old JUnit3 Framework completely?&lt;/p&gt;</comment>
                    <comment id="12908735" author="rcmuir" created="Mon, 13 Sep 2010 13:02:06 +0100"  >&lt;blockquote&gt;&lt;p&gt;Why not simply extend the Assert abstract class? This would remove use of deprecated old JUnit3 Framework completely?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would like to do this under a different issue.&lt;/p&gt;

&lt;p&gt;We cannot do this, until all assertEquals(float, float) are changed to use epsilons, for example.&lt;/p&gt;

&lt;p&gt;By extending Assert, we can catch all the places we don&apos;t use epsilons and fix them, which&lt;br/&gt;
is a great improvement, but out of scope of this issue.&lt;/p&gt;</comment>
                    <comment id="12908736" author="thetaphi" created="Mon, 13 Sep 2010 13:04:10 +0100"  >&lt;p&gt;I am just afraid of extending form the old JUnit Testcase. We can simply add @Deprecated methods to asser floats without epsilon, that we can then remove.&lt;/p&gt;

&lt;p&gt;So extend Assert and the add missing static methods for compatibility.&lt;/p&gt;</comment>
                    <comment id="12908739" author="rcmuir" created="Mon, 13 Sep 2010 13:12:33 +0100"  >&lt;blockquote&gt;&lt;p&gt;I am just afraid of extending form the old JUnit Testcase.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;we already extend this! Have you looked at LuceneTestCase lately?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So extend Assert and the add missing static methods for compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please, i would like to keep the epsilon stuff out of this issue. All tests pass the way it is now, there is no&lt;br/&gt;
problem.&lt;/p&gt;

&lt;p&gt;We can fix epsilons in a followup issue, and then use no junit3 code at all... as I said its a great improvement, but not necessary to mix in with this change.&lt;/p&gt;

&lt;p&gt;By doing both at once, if somethign goes wrong, it will be more difficult to debug. Lets keep the scope under control.&lt;/p&gt;</comment>
                    <comment id="12908770" author="thetaphi" created="Mon, 13 Sep 2010 13:59:50 +0100"  >&lt;p&gt;Here the patch, so LuceneTestCaseJ4 only extends Assert without importing extra crap. The double/float API of old Junit3 is emulated using static overrides. After applying patch do a ant clean, else you will get lining errors.&lt;/p&gt;</comment>
                    <comment id="12908786" author="rcmuir" created="Mon, 13 Sep 2010 14:55:20 +0100"  >&lt;p&gt;updated patch, with all of lucene/solr and including uwe&apos;s stuff.&lt;/p&gt;

&lt;p&gt;all tests pass.&lt;/p&gt;</comment>
                    <comment id="12908856" author="mikemccand" created="Mon, 13 Sep 2010 17:43:30 +0100"  >&lt;p&gt;This is great Robert!  Patch works for me (except for bizarre hang in Solr&apos;s TestSolrCoreProperties, apparently only on my machine, that&apos;s pre-existing).&lt;/p&gt;</comment>
                    <comment id="12908861" author="thetaphi" created="Mon, 13 Sep 2010 18:03:01 +0100"  >&lt;p&gt;Looks good, this is a really good step forwards. We can write old-style tests, butuse JUnit4 and can optionally add the @BeforeClass and so on &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12908866" author="rcmuir" created="Mon, 13 Sep 2010 18:11:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;We can write old-style tests, butuse JUnit4 and can optionally add the @BeforeClass and so on &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah i&apos;ve never understood why Junit4 requires all these static imports and annotations... i just care about @BeforeClass!&lt;/p&gt;</comment>
                    <comment id="12908888" author="thetaphi" created="Mon, 13 Sep 2010 19:08:22 +0100"  >&lt;p&gt;Some small fixes in reflection inspection:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;exclude static and abstract methods&lt;/li&gt;
	&lt;li&gt;check native return type&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12908890" author="rcmuir" created="Mon, 13 Sep 2010 19:12:38 +0100"  >&lt;p&gt;thanks Uwe, i can merge this into the 3x backport too.&lt;/p&gt;</comment>
                    <comment id="12908896" author="rcmuir" created="Mon, 13 Sep 2010 19:24:19 +0100"  >&lt;p&gt;OK, i didnt merge the reflection fixes yet, but i backported the patch to 3x.&lt;/p&gt;

&lt;p&gt;Committed revision 996611, 996630 (3x).&lt;/p&gt;

&lt;p&gt;Will mark the issue resolved when Uwe is out of reflection hell &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12908979" author="rcmuir" created="Mon, 13 Sep 2010 21:08:55 +0100"  >&lt;p&gt;OK i merged back all of Uwe&apos;s improvements. Thanks for the help Uwe.&lt;/p&gt;

&lt;p&gt;I think now in future issues we can clean up and improve this test case a lot.&lt;br/&gt;
I felt discouraged from doing so with the previous duplication...&lt;/p&gt;</comment>
                    <comment id="13013388" author="gsingers" created="Wed, 30 Mar 2011 16:50:10 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12454447" name="LUCENE-2642-extendAssert.patch" size="7656" author="thetaphi" created="Mon, 13 Sep 2010 13:59:50 +0100" />
                    <attachment id="12454462" name="LUCENE-2642-fixes.patch" size="1038" author="thetaphi" created="Mon, 13 Sep 2010 19:08:22 +0100" />
                    <attachment id="12454448" name="LUCENE-2642.patch" size="153957" author="rcmuir" created="Mon, 13 Sep 2010 14:55:20 +0100" />
                    <attachment id="12454445" name="LUCENE-2642.patch" size="91302" author="rcmuir" created="Mon, 13 Sep 2010 12:18:53 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 13 Sep 2010 11:59:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11195</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25050</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>