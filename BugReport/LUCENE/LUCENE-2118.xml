<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:23 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2118/LUCENE-2118.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2118] Intermittent failure in TestIndexWriterMergePolicy.testMaxBufferedDocsChange</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2118</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Last night&apos;s build failed from it: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Lucene-trunk/1019/changes&quot; class=&quot;external-link&quot;&gt;http://hudson.zones.apache.org/hudson/job/Lucene-trunk/1019/changes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s the exc:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] Testcase: testMaxBufferedDocsChange(org.apache.lucene.index.TestIndexWriterMergePolicy):	FAILED
    [junit] maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10
    [junit] junit.framework.AssertionFailedError: maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.checkInvariants(TestIndexWriterMergePolicy.java:234)
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.testMaxBufferedDocsChange(TestIndexWriterMergePolicy.java:164)
    [junit] 	at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:208)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test doesn&apos;t fail if I run on opensolaris nor os X machines...&lt;/p&gt;</description>
                <environment></environment>
            <key id="12442570">LUCENE-2118</key>
            <summary>Intermittent failure in TestIndexWriterMergePolicy.testMaxBufferedDocsChange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Dec 2009 09:13:19 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:16 +0100</updated>
                    <resolved>Thu, 11 Nov 2010 18:04:45 +0000</resolved>
                            <version>3.1</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12795982" author="mikemccand" created="Sun, 3 Jan 2010 15:32:45 +0000"  >&lt;p&gt;Robert hit this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit] Testsuite: org.apache.lucene.index.TestIndexWriterMergePolicy
   [junit] Tests run: 6, Failures: 1, Errors: 0, Time elapsed: 0.731 sec
   [junit]
   [junit] Testcase:
testMaxBufferedDocsChange(org.apache.lucene.index.TestIndexWriterMergePolicy):
FAILED
   [junit] maxMergeDocs=2147483647; numSegments=11; upperBound=10;
mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32
_5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32
_61:c10-&amp;gt;_32 62:c8-&amp;gt;_32 _64:c2-&amp;gt;_62
   [junit] junit.framework.AssertionFailedError:
maxMergeDocs=2147483647; numSegments=11; upperBound=10;
mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32
_5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32
_61:c10-&amp;gt;_32 _62:c8-&amp;gt;_32 _64:c2-&amp;gt;_62
   [junit]     at
org.apache.lucene.index.TestIndexWriterMergePolicy.checkInvariants(TestIndexWriterMergePolicy.java:234)
   [junit]     at
org.apache.lucene.index.TestIndexWriterMergePolicy.testMaxBufferedDocsChange(TestIndexWriterMergePolicy.java:164)
   [junit]     at
org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12896287" author="mikemccand" created="Sat, 7 Aug 2010 22:48:37 +0100"  >&lt;p&gt;I found the root cause here; it&apos;s a rare case, due to shared doc stores.  Whenever the merge must merge doc stores and at least 1 segment is referencing the currently open shared doc stores, IW must flush.  It&apos;s an &quot;unusual&quot; flush because it&apos;s triggered by the right merge and not maxBuffereDocs/RAM being consumed.&lt;/p&gt;

&lt;p&gt;When this happens we fail to check for newly required merges, which can then leave the index in a state where it needs a merge, causing this failure.&lt;/p&gt;

&lt;p&gt;I can&apos;t repro this failure, but I think very likely this is the cause.  The fix is to call updatePendingMerges in the two places where we do these &quot;unusual&quot; flushes.  I&apos;ll commit shortly.&lt;/p&gt;</comment>
                    <comment id="12901381" author="mikemccand" created="Mon, 23 Aug 2010 14:04:44 +0100"  >&lt;p&gt;Alas this issue still happens.  I just hit this on trunk:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testsuite: org.apache.lucene.index.TestIndexWriterMergePolicy
    [junit] Testcase: testMaxBufferedDocsChange(org.apache.lucene.index.TestIndexWriterMergePolicy):	FAILED
    [junit] maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32 _5w:c10-&amp;gt;_32
      _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32 _61:c10-&amp;gt;_32 _62:c1-&amp;gt;_32 _63:c9-&amp;gt;_62
    [junit] junit.framework.AssertionFailedError: maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32
      _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32 _5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32 _61:c10-&amp;gt;_32 _62:c1-&amp;gt;_32 _63:c9-&amp;gt;_62
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.checkInvariants(TestIndexWriterMergePolicy.java:251)
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.testMaxBufferedDocsChange(TestIndexWriterMergePolicy.java:177)
    [junit] 	at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:385)
    [junit] 	at org.apache.lucene.util.LuceneTestCase.run(LuceneTestCase.java:377)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12906720" author="mikemccand" created="Tue, 7 Sep 2010 10:19:31 +0100"  >&lt;p&gt;Steven A Rowe just hit this again, on trunk:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;NOTE: random codec of testcase &apos;testMaxBufferedDocsChange&apos; was: MockSep
NOTE: random locale of testcase &apos;testMaxBufferedDocsChange&apos; was: en_PH
NOTE: random timezone of testcase &apos;testMaxBufferedDocsChange&apos; was: America/Indianapolis
NOTE: random seed of testcase &apos;testMaxBufferedDocsChange&apos; was: 4118460220441676374

junit.framework.AssertionFailedError: maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32 _5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32 _61:c10-&amp;gt;_32 _62:c1-&amp;gt;_32 _63:c9-&amp;gt;_62
       at org.apache.lucene.index.TestIndexWriterMergePolicy.checkInvariants(TestIndexWriterMergePolicy.java:251)
       at org.apache.lucene.index.TestIndexWriterMergePolicy.testMaxBufferedDocsChange(TestIndexWriterMergePolicy.java:177)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
       at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:395)
       at org.apache.lucene.util.LuceneTestCase.run(LuceneTestCase.java:387)
       at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
       at org.junit.runners.Suite.runChild(Suite.java:128)
       at org.junit.runners.Suite.runChild(Suite.java:24)
       at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
       at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
       at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
       at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
       at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
       at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
       at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
       at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:94)
       at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:192)
       at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:64)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
       at com.intellij.rt.execution.application.AppMain.main(AppMain.java:115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12921839" author="rcmuir" created="Sun, 17 Oct 2010 13:41:43 +0100"  >&lt;p&gt;Hudson hit this last night (brancH_3x)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testsuite: org.apache.lucene.index.TestIndexWriterMergePolicy
    [junit] Testcase: testMaxBufferedDocsChange(org.apache.lucene.index.TestIndexWriterMergePolicy):	FAILED
    [junit] maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32 _5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32 _61:c10-&amp;gt;_32 _62:c5-&amp;gt;_32 _63:c5-&amp;gt;_62
    [junit] junit.framework.AssertionFailedError: maxMergeDocs=2147483647; numSegments=11; upperBound=10; mergeFactor=10; segs=_65:c5950 _5t:c10-&amp;gt;_32 _5u:c10-&amp;gt;_32 _5v:c10-&amp;gt;_32 _5w:c10-&amp;gt;_32 _5x:c10-&amp;gt;_32 _5y:c10-&amp;gt;_32 _5z:c10-&amp;gt;_32 _60:c10-&amp;gt;_32 _61:c10-&amp;gt;_32 _62:c5-&amp;gt;_32 _63:c5-&amp;gt;_62
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:770)
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:737)
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.checkInvariants(TestIndexWriterMergePolicy.java:243)
    [junit] 	at org.apache.lucene.index.TestIndexWriterMergePolicy.testMaxBufferedDocsChange(TestIndexWriterMergePolicy.java:169)
    [junit] 
    [junit] 
    [junit] Tests run: 6, Failures: 1, Errors: 0, Time elapsed: 2.31 sec
    [junit] 
    [junit] ------------- Standard Output ---------------
    [junit] NOTE: reproduce with: ant test -Dtestcase=TestIndexWriterMergePolicy -Dtestmethod=testMaxBufferedDocsChange -Dtests.seed=5199282654207860248:-4379090235199517829 -Dtests.multiplier=3
    [junit] NOTE: test params are: locale=is_IS, timezone=Africa/Porto-Novo
    [junit] ------------- ---------------- ---------------
    [junit] TEST org.apache.lucene.index.TestIndexWriterMergePolicy FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12931101" author="mikemccand" created="Thu, 11 Nov 2010 17:37:27 +0000"  >&lt;p&gt;OK I think (again!) I found the root cause here &amp;#8211; patch attached.&lt;/p&gt;

&lt;p&gt;Basically the test and LogMergePolicy disagreed on the boundary case of when a segment falls into the minimum level.  Just have to change &amp;lt; to &amp;lt;=.&lt;/p&gt;</comment>
                    <comment id="12931102" author="mikemccand" created="Thu, 11 Nov 2010 17:46:20 +0000"  >&lt;p&gt;Urgh &amp;#8211; my commit breaks this test case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test-core -Dtestcase=TestIndexWriter -Dtestmethod=testOptimizeMaxNumSegments2 -Dtests.seed=6113348674281247226:-4858946393178103452
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12931103" author="jasonrutherglen" created="Thu, 11 Nov 2010 17:56:11 +0000"  >&lt;p&gt;Ah, I saw this error from &quot;testMaxBufferedDocsChange&quot; in testing &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2680&quot; title=&quot;Improve how IndexWriter flushes deletes against existing segments&quot;&gt;&lt;del&gt;LUCENE-2680&lt;/del&gt;&lt;/a&gt;.  Maybe it&apos;s not the changes I made in that particular case!&lt;/p&gt;</comment>
                    <comment id="12931110" author="mikemccand" created="Thu, 11 Nov 2010 18:04:45 +0000"  >&lt;p&gt;Slowly, nervously, I again mark this one fixed...&lt;/p&gt;</comment>
                    <comment id="13013419" author="gsingers" created="Wed, 30 Mar 2011 16:50:16 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12459366" name="LUCENE-2118.patch" size="610" author="mikemccand" created="Thu, 11 Nov 2010 17:37:26 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 17 Oct 2010 12:41:43 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11661</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25607</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>