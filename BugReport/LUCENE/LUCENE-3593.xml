<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:29:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3593/LUCENE-3593.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3593] Add a filter returning all document without a value in a field</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3593</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In some situations it would be useful to have a Filter that simply returns all document that either have at least one or no value in a certain field. We don&apos;t have something like that out of the box and adding it seems straight forward.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12532656">LUCENE-3593</key>
            <summary>Add a filter returning all document without a value in a field</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Nov 2011 21:45:00 +0000</created>
                <updated>Fri, 10 May 2013 11:43:36 +0100</updated>
                    <resolved>Thu, 24 Nov 2011 23:45:42 +0000</resolved>
                            <version>3.6</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13156910" author="simonw" created="Thu, 24 Nov 2011 21:50:09 +0000"  >&lt;p&gt;here is an initial patch. maybe somebody more familiar with our new filter hierarchy etc. can review this. There is still a nocommit in there since I am not sure if that is the best way of doing this. Uwe had some ideas I think..&lt;/p&gt;</comment>
                    <comment id="13156917" author="thetaphi" created="Thu, 24 Nov 2011 22:22:35 +0000"  >&lt;p&gt;Hi Simon,&lt;/p&gt;

&lt;p&gt;the first patch looks exactly like I said in our first ideas-exchange!&lt;/p&gt;

&lt;p&gt;There are smaller problems (but solveable) and one optimization... (a trick one...): FieldCacheDocIdSet has some special cases which work with the implementation here, but are unclean and should violate some assertions - and should be fixed...:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FieldCacheDocIdSet excepts that the match() method throws ArrayIndexOutOfBoundsException when the FieldCacheArray is out of bounds. With the FixedBitSet behind that implementation of the FieldCache this basically works, but should violate some code assertions added by MikeMcCandless (not sure why the testcase does not hit this - doesn&apos;t it - I assume it does not because the trunk bits() on DocIdSet will intercept this as our filter is not sparse -&amp;gt; it switches to random access)&lt;/li&gt;
	&lt;li&gt;The FieldCacheDocIdSet should maybe made un-private and refactored out of the FieldCacheRangeFilter.&lt;/li&gt;
	&lt;li&gt;The positive case could be optimized: A instanceof check in the getDocIdSet() method could check for the positive case that the FieldCacheImpl itsself returns a FixedBitSet/DocIdSet already and return this directly:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Bits docsWithField = FieldCache.DEFAULT.getDocsWithField(context.reader, field);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (negate &amp;amp;&amp;amp; docsWithField &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; DocIdSet) &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is always the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; our current impl - but who knows :-)
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (DocIdSet) docsWithField;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In general the other cases can be easily done by the default stupid (stupid in the case that its slowly iterating by doc++ and in trunk directly uses the Bits) impl like you did, but once factoring out the FieldCacheRangeFilter.FieldCacheDocIdSet we could optimize this and maybe have a better negation.&lt;/p&gt;

&lt;p&gt;In all cases I dont like double negation of this Filter.&lt;/p&gt;

&lt;p&gt;I&apos;ll work on the problems and make this filter work better. Should I take this issue and solve the problems first? I also want to backport the FieldCacheTermsFilter code-duplication removal in trunk to 3.x, so some cleanup is really needed!&lt;/p&gt;

&lt;p&gt;I will come with a patch adressing those problems later or tomorrow.&lt;/p&gt;</comment>
                    <comment id="13156918" author="rcmuir" created="Thu, 24 Nov 2011 22:30:12 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I think rather than having NoFieldValueFilter with boolean negate, we should instead use a positive name for the filter, to avoid requiring double negations.&lt;/p&gt;

&lt;p&gt;So the name would something positive like FieldValueFilter instead.&lt;/p&gt;</comment>
                    <comment id="13156920" author="thetaphi" created="Thu, 24 Nov 2011 22:34:43 +0000"  >&lt;p&gt;Robert: I already said that. The Filter could also live of the shortcuts, if getDocsWithField returns MatchAllBits it could shortcut to MatchAllDocsQuery/Filter or return null (depending on negation or not). In all cases this Filter could in all cases do some shortcuts &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I will provide a patch later adressing also the stupid &quot;rely on ArrayIndexOutOfBoundsException&quot;. I am not even sure that FieldCacheTermsFilter works correct in trunk... I would prefer to add the &quot;&amp;lt; maxDoc&quot; check in the iterator impl beyond FieldCacheDocIdSet.&lt;/p&gt;</comment>
                    <comment id="13156925" author="simonw" created="Thu, 24 Nov 2011 22:55:49 +0000"  >&lt;p&gt;guys thanks for the comments! I incorporated uwes shortcut and fixed the name to FieldValueFilter. I extened the testcase to also use deletions. Uwe, whatever you want to do feel free to upload a new patch. I already added a changes.txt entry for this too...&lt;/p&gt;</comment>
                    <comment id="13156929" author="thetaphi" created="Thu, 24 Nov 2011 23:05:23 +0000"  >&lt;p&gt;Patch looks good, except the AIOOBE requirement - which is a broken API. I will fix this now by always doing (doc &amp;lt; maxDoc) check in the iterator and also factor out the abstract class from FCRF. Also 3.x has a bug in FCRF with respecting deletions (I already discussed with Mike several weeks ago).&lt;/p&gt;</comment>
                    <comment id="13156932" author="simonw" created="Thu, 24 Nov 2011 23:18:12 +0000"  >&lt;p&gt;next iteration. I added a AIOOBE to all the match methods to make the interface happy. I think we should fix this as uwe mentioned. Uwe, can you create a subtask / issue to fix this.. I think you already on it no? I added some more optimizations if the Bits is instanceof MatchNoBits / MatchAllBits respectively I return null instead of the DocIdSetIterator when appropriate. all test pass.. &lt;/p&gt;

&lt;p&gt;I think it&apos;s ready..&lt;/p&gt;</comment>
                    <comment id="13156933" author="thetaphi" created="Thu, 24 Nov 2011 23:22:22 +0000"  >&lt;p&gt;+1 looks fine. Cool heavy fast ping-pong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I will open new issue and fix the TODO, especially as I dont know if trunk really likes e.g. on FieldCacheTermsFilter that getOrd() is called with doc id out of range... Maybe it throws AIOOBE, but thats ugly.&lt;/p&gt;</comment>
                    <comment id="13156934" author="thetaphi" created="Thu, 24 Nov 2011 23:32:24 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3595&quot; title=&quot;Refactor FieldCacheRangeFilter.FieldCacheDocIdSet to be separate class and fix the dangerous matchDoc() throws AIOOBE requirement&quot;&gt;&lt;del&gt;LUCENE-3595&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="13156940" author="simonw" created="Thu, 24 Nov 2011 23:45:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3595&quot; title=&quot;Refactor FieldCacheRangeFilter.FieldCacheDocIdSet to be separate class and fix the dangerous matchDoc() throws AIOOBE requirement&quot;&gt;&lt;del&gt;LUCENE-3595&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;thanks! I committed this to trunk and backported to 3.x &lt;/p&gt;

&lt;p&gt;nice iterations.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; heavy committing &lt;/p&gt;</comment>
                    <comment id="13156962" author="thetaphi" created="Fri, 25 Nov 2011 02:14:31 +0000"  >&lt;p&gt;Hi Simon, I fixed the TODO for the DocIdSet special case (@UweSays) to resepect deletions (with fixes from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3595&quot; title=&quot;Refactor FieldCacheRangeFilter.FieldCacheDocIdSet to be separate class and fix the dangerous matchDoc() throws AIOOBE requirement&quot;&gt;&lt;del&gt;LUCENE-3595&lt;/del&gt;&lt;/a&gt;). Code needed for Lucene 3.x was copied from CachingWrapperFilter.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12532661">LUCENE-3595</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12505043" name="LUCENE-3593.patch" size="10563" author="simonw" created="Thu, 24 Nov 2011 23:18:11 +0000" />
                    <attachment id="12505042" name="LUCENE-3593.patch" size="9793" author="simonw" created="Thu, 24 Nov 2011 22:55:49 +0000" />
                    <attachment id="12505040" name="LUCENE-3593.patch" size="8229" author="simonw" created="Thu, 24 Nov 2011 21:50:09 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 24 Nov 2011 22:22:35 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>218390</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24104</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>