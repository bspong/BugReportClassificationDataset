<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:02:59 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1754/LUCENE-1754.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1754] Get rid of NonMatchingScorer from BooleanScorer2</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1754</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Over in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1614&quot; title=&quot;Add next() and skipTo() variants to DocIdSetIterator that return the current doc, instead of boolean&quot;&gt;&lt;del&gt;LUCENE-1614&lt;/del&gt;&lt;/a&gt; Mike has made a comment about removing NonMatchinScorer from BS2, and return null in BooleanWeight.scorer(). I&apos;ve checked and this can be easily done, so I&apos;m going to post a patch shortly. For reference: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1614?focusedCommentId=12715064&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12715064&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-1614?focusedCommentId=12715064&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12715064&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve marked the issue as 2.9 just because it&apos;s small, and kind of related to all the search enhancements done for 2.9.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12430909">LUCENE-1754</key>
            <summary>Get rid of NonMatchingScorer from BooleanScorer2</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Jul 2009 07:44:08 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:29 +0100</updated>
                    <resolved>Mon, 27 Jul 2009 12:24:18 +0100</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12733145" author="shaie" created="Mon, 20 Jul 2009 08:00:15 +0100"  >&lt;p&gt;I thought it&apos;s going to be easy too soon &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;After I&apos;ve made the changes, some tests in TestBooleanMinShouldMatch fail w/ NPE. That&apos;s because previously we always returned BS2, which used NonMatchingScorer internally, and now we return null. Therefore this looks like a back-compat issue, but not sure how serious it is. The reason is that BooleanWeight.scorer() already returns null today in some situations, therefore any code that calls BooleanWeight.scorer() directly should already check that it didn&apos;t get null. So I&apos;m not sure if it&apos;s indeed back-compat problem or not.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                    <comment id="12733188" author="mikemccand" created="Mon, 20 Jul 2009 11:55:57 +0100"  >&lt;p&gt;It seems like Weight.scorer() in general is allowed to return null to indicate &quot;no docs will match&quot; (since some scorers do so, though others do not)?  Though that &quot;right&quot; wasn&apos;t spelled out anywhere in the javadocs as best I can tell.  So... I don&apos;t think this is really a back-compat break?&lt;/p&gt;

&lt;p&gt;I think we should allow this, and document it clearly, going forward (in QueryWeight.scorer)?&lt;/p&gt;

&lt;p&gt;I suppose we could fix the emulation of Weight on top of QueryWeight (QueryWeightWrapper) to return NonMatchingScorer if it gets null back from QueryWeight.scorer?&lt;/p&gt;</comment>
                    <comment id="12733208" author="shaie" created="Mon, 20 Jul 2009 13:31:26 +0100"  >&lt;p&gt;Patch which removes NonMatchingScorer, fixes tests and tag.&lt;/p&gt;

&lt;p&gt;I also agree this is not a back-compat change, since BooleanQuery returns null today already. I just fixed the test to check whether the scorer returned is not null.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should return NonMatchingScorer from QueryWeightWrapper, since it will hide the already returned null Scorer. I.e., I think that will cause some apps to break, since if previously they relied on null, now they will get an instance which if they&apos;ll call its score() or doc() methods will get UOE.&lt;/p&gt;</comment>
                    <comment id="12733209" author="yseeley@gmail.com" created="Mon, 20 Jul 2009 13:37:39 +0100"  >&lt;blockquote&gt;&lt;p&gt;It seems like Weight.scorer() in general is allowed to return null to indicate &quot;no docs will match&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmmm, that&apos;s a bit of a surprise... I had thought one would always get a scorer instance back .  There&apos;s probably a lot of lurking bugs.&lt;br/&gt;
See ConstantScoreQuery.explain() for instance.&lt;/p&gt;</comment>
                    <comment id="12733213" author="shaie" created="Mon, 20 Jul 2009 14:10:19 +0100"  >&lt;blockquote&gt;&lt;p&gt;See ConstantScoreQuery.explain() for instance.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;CSQ calls its own scorer(), therefore it knows it&apos;s going to get an instance back.&lt;/p&gt;

&lt;p&gt;In general, BooleanQuery already returns null today, so all I was saying is that if someone called BQ.weight.scorer(), he had to check for null anyway. If he didn&apos;t then his app would be exposed?&lt;/p&gt;</comment>
                    <comment id="12733315" author="mikemccand" created="Mon, 20 Jul 2009 19:54:09 +0100"  >&lt;p&gt;TermWeight.scorer returns null if the termDocs is null (though it looks like DirectoryIndexReader will never return null termDocs).&lt;/p&gt;

&lt;p&gt;PhraseQuery and MultiPhraseQuery return null scorer if they have 0 terms.&lt;/p&gt;

&lt;p&gt;A number of scorers check for null returns from their sub-scorers and then return null to their caller.  IndexSearcher also handles a null scorer.&lt;/p&gt;

&lt;p&gt;It looks like null is already in general an accepted/possible return from Weight.scorer().&lt;/p&gt;</comment>
                    <comment id="12733402" author="yseeley@gmail.com" created="Tue, 21 Jul 2009 00:47:45 +0100"  >&lt;p&gt;Still surprising that scorer() can return null... I guess it&apos;s been a blind spot.&lt;/p&gt;

&lt;p&gt;Another question - from QueryWrapperFilter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DocIdSet getDocIdSet(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IndexReader reader) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; QueryWeight weight = query.queryWeight(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IndexSearcher(reader));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DocIdSet() {
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DocIdSetIterator iterator() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; weight.scorer(reader, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      }
    };
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So is it the case that DocIdSet.iterator() can also return null?  That&apos;s what this code does.&lt;/p&gt;</comment>
                    <comment id="12733493" author="shaie" created="Tue, 21 Jul 2009 07:06:44 +0100"  >&lt;p&gt;That&apos;s a good point. IndexSearcher does not protect against this case (it only asserts the filter is not null, but not the DISI returned from it).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I guess it&apos;s been a blind spot. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that you&apos;re right. And more than that, we don&apos;t have unit tests that cover these cases (I believe there are some that cover a null Scorer, but not a null DISI). And I wonder how this hasn&apos;t come up until now. I mean, the examples Mike gave above do not sound way too extreme to me.&lt;/p&gt;

&lt;p&gt;So does this mean we should document that scorer cannot be null? And if so, we make NonMatchingScorer public and recommend to return it if the query does not expect to return any documents? We can also make NMS not instantiable (is it a word?), with a static instance() method, but that&apos;s a minor thing.&lt;/p&gt;

&lt;p&gt;Or ... we leave everything as-is, and add some test cases which test this exactly, and change QueryWrapperFilter to return NMS in case the scorer returned by Weight is null.&lt;/p&gt;

&lt;p&gt;I think I prefer the first approach.&lt;/p&gt;</comment>
                    <comment id="12733605" author="tsmith" created="Tue, 21 Jul 2009 13:57:28 +0100"  >&lt;p&gt;If making NonMatchingScorer public, i suggest potentially implementing a NonMatchingQuery as well&lt;/p&gt;

&lt;p&gt;this way, if a query has to rewrite() to null, it could return a NonMatchingQuery instead (which would protect against null pointer exceptions)&lt;/p&gt;</comment>
                    <comment id="12733748" author="shaie" created="Tue, 21 Jul 2009 18:49:10 +0100"  >&lt;p&gt;So if we agree that scorer() cannot return null, I think that most of the patch can be reverted, and I&apos;ll change the scorer() impls which return null to return NMS instead?&lt;/p&gt;

&lt;p&gt;About NonMatchingQuery, I don&apos;t mind adding it, though why should a Query rewrite to null?&lt;/p&gt;</comment>
                    <comment id="12733753" author="yseeley@gmail.com" created="Tue, 21 Jul 2009 19:00:47 +0100"  >&lt;blockquote&gt;&lt;p&gt;So if we agree that scorer() cannot return null, I think that most of the patch can be reverted, and I&apos;ll change the scorer() impls which return null to return NMS instead? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I haven&apos;t looked deeply into it, but at first blush that could simplify client code.&lt;br/&gt;
Need to watch out if there are any implementations of Weight.explain() that cast to a Specific type of scorer - hence one would get a cast exception if &quot;return null&quot; were blindly replaced with &quot;return NMS&quot;.&lt;/p&gt;</comment>
                    <comment id="12733756" author="tsmith" created="Tue, 21 Jul 2009 19:04:09 +0100"  >&lt;p&gt;Here&apos;s a couple of use cases where a Query should rewrite to null/NonMatchingQuery (in my opinion):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Wildcard query that maps to 0 terms in the index&lt;/li&gt;
	&lt;li&gt;range query that again maps to 0 terms in the index&lt;/li&gt;
	&lt;li&gt;boolean query that has 0 clauses&lt;/li&gt;
	&lt;li&gt;filter based constant score query that has 0 docs in it&lt;/li&gt;
	&lt;li&gt;(and thats just in the in the lucene tree, nothing to do with custom query implementations)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Most of these situations would actually preempt needing to return null from a scorer, since the query would already have been rewritten to a NonMatchingQuery/null prior to asking for a scorer&lt;/p&gt;

&lt;p&gt;BooleanQuery could then also do instanceof checks on return from clause rewrite. If a NonMatchingQuery/null is returned for a required clause, the BooleanQuery itself can rewrite to NonMatchingQuery, also, if a prohibited clause rewrites to NonMatchingQuery/null, that clause can be removed entirely, if an optional clause rewrites to NonMatchingQUery/null, that clause can also be removed safely&lt;/p&gt;</comment>
                    <comment id="12733759" author="shaie" created="Tue, 21 Jul 2009 19:07:15 +0100"  >&lt;blockquote&gt;&lt;p&gt;hence one would get a cast exception if &quot;return null&quot; were blindly replaced with &quot;return NMS&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So this means that that someone is prepared to get a null Scorer right? So I&apos;m confused - are you for returning null or not? Of course, something I just realized, returning null from scorer() does not break back-compat, while returning NMS does (or at least may).&lt;/p&gt;

&lt;p&gt;How about if we fix QueryWrapperFilter to return NMS then? Or we document that Filter.getDocIdSet may return null, and fix IndexSearcher accordingly (this again is not a back-compat thing, while returning NMS is)?&lt;/p&gt;</comment>
                    <comment id="12733760" author="shaie" created="Tue, 21 Jul 2009 19:10:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;BooleanQuery could then also do instanceof checks on return from clause rewrite&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is a good point you raise. Actually today, BQ is quite efficient in that it compares to null. If we change scorer() to return NMS, we&apos;d need to check instanceof which is way more expensive (we&apos;d still need to check for null though, because we cannot enforce NMS).&lt;/p&gt;

&lt;p&gt;So I think I&apos;m still in favor of returning null ... or should I say - keep the currently not documented, but in effect, behavior.&lt;/p&gt;</comment>
                    <comment id="12734149" author="shaie" created="Wed, 22 Jul 2009 16:22:03 +0100"  >&lt;p&gt;Any thoughts on that?&lt;/p&gt;

&lt;p&gt;If we keep null, then I&apos;ll fix IndexSearcher to check whether filter.getDocIdSet did not return null. If it did, don&apos;t execute the query.&lt;/p&gt;

&lt;p&gt;I&apos;d like to move on with this, if we have some sort of consensus.&lt;/p&gt;</comment>
                    <comment id="12734154" author="tsmith" created="Wed, 22 Jul 2009 16:29:42 +0100"  >&lt;p&gt;keeping null should be fine, as long as this is documented and all core query implementations handle this behavior, and all searcher code handles the null return properly&lt;br/&gt;
at this point, NonMatchingScorer could be removed and null returned in its place (being package private, no one writing applications can make any assumptions on a NonMatchingScorer being returned)&lt;/p&gt;

&lt;p&gt;however, this should also be documented for the rewrite() method (currently this looks to always expect a non-null return value), also the searcher will throw null pointers if a null query is passed to it &lt;/p&gt;
</comment>
                    <comment id="12734164" author="mikemccand" created="Wed, 22 Jul 2009 16:50:02 +0100"  >&lt;p&gt;I think we continue to allow scorer() and getDocIdSet to return null to mean &quot;no matches&quot;, though they are not required too (ie, one cannot assume that a non-null return means there are matches).&lt;/p&gt;

&lt;p&gt;And we should make this clear in the javadocs.&lt;/p&gt;

&lt;p&gt;And remove NonMatchingScorer.&lt;/p&gt;</comment>
                    <comment id="12734168" author="shaie" created="Wed, 22 Jul 2009 16:54:20 +0100"  >&lt;p&gt;ok then I&apos;ll add a test case to the patch which uses QWF w/ a query that it&apos;s scorer returns null, and then fix IndexSearcher accordingly. And update the javadocs as needed.&lt;/p&gt;</comment>
                    <comment id="12734196" author="shaie" created="Wed, 22 Jul 2009 18:10:13 +0100"  >&lt;ul&gt;
	&lt;li&gt;Added a test case to TestDocIdSet which returns a null DocIdSet and indeed IndexSearcher failed.&lt;/li&gt;
	&lt;li&gt;Fixed IndexSearcher and all other places in the code which called scorer() or getDocIdSet() and could potentially hit NPE.&lt;/li&gt;
	&lt;li&gt;Added EmptyDocIdSetIterator for use by classes (such as ChainFilter) that need a DISI, but got a null DocIdSet.&lt;/li&gt;
	&lt;li&gt;Updated CHANGES.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All search tests pass.&lt;/p&gt;</comment>
                    <comment id="12734202" author="mikemccand" created="Wed, 22 Jul 2009 18:19:51 +0100"  >&lt;p&gt;For some reason I can&apos;t apply the patch &amp;#8211; I get this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ patch -p0 &amp;lt; /x/tmp/LUCENE-1754.patch.txt 
patching file CHANGES.txt
patch: **** malformed patch at line 20: @@ -629,6 +638,11 @@
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12734204" author="shaie" created="Wed, 22 Jul 2009 18:27:54 +0100"  >&lt;p&gt;My fault. After I created it, I manually edited the CHANGES section, which messed up the lines count.&lt;/p&gt;</comment>
                    <comment id="12734245" author="mikemccand" created="Wed, 22 Jul 2009 19:48:05 +0100"  >&lt;p&gt;OK patch looks good, thanks Shai!&lt;/p&gt;

&lt;p&gt;I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12735260" author="mikemccand" created="Sat, 25 Jul 2009 11:37:28 +0100"  >&lt;p&gt;New patch attached &amp;#8211; sync&apos;d to trunk, and, fixed places to also catch when disi.iterator() returns null.&lt;/p&gt;</comment>
                    <comment id="12735545" author="mikemccand" created="Mon, 27 Jul 2009 10:50:04 +0100"  >&lt;p&gt;Thanks Shai!&lt;/p&gt;</comment>
                    <comment id="12735556" author="shaie" created="Mon, 27 Jul 2009 11:59:41 +0100"  >&lt;p&gt;EmptyDocIdSetIterator is not necessary as DocIdSet already defines an EMPTY_DOCIDSET member. We should use it.&lt;/p&gt;</comment>
                    <comment id="12735557" author="shaie" created="Mon, 27 Jul 2009 11:59:54 +0100"  >&lt;p&gt;Removed EmptyDocIdSetIterator and changed DocIdSet.EMPTY_DOCIDSET to impl iterator() to always return the same, empty, instance.&lt;/p&gt;</comment>
                    <comment id="12735563" author="mikemccand" created="Mon, 27 Jul 2009 12:11:51 +0100"  >&lt;p&gt;New patch looks good Shai, thanks!  I&apos;ll commit shortly.&lt;/p&gt;</comment>
                    <comment id="12735564" author="thetaphi" created="Mon, 27 Jul 2009 12:15:39 +0100"  >&lt;p&gt;There is no need to make this empty DIS a subvclass of SortedVIntList&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DocIdSet EMPTY_DOCIDSET = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SortedVIntList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[0]) {
+-&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DocIdSet EMPTY_DOCIDSET = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DocIdSet() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Else is OK!&lt;/p&gt;</comment>
                    <comment id="12735565" author="shaie" created="Mon, 27 Jul 2009 12:15:44 +0100"  >&lt;p&gt;Wait ! DocIdSet.EMPTY should not do &quot;new SortedVIntList&quot;, just &quot;new DocIdSet()&quot;.&lt;/p&gt;</comment>
                    <comment id="12735566" author="shaie" created="Mon, 27 Jul 2009 12:16:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;There is no need to make this empty DIS a subvclass of SortedVIntList &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We probably posted at the same time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12735568" author="thetaphi" created="Mon, 27 Jul 2009 12:22:16 +0100"  >&lt;p&gt;Hihi! Sometimes it is not the best to be too fast &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;I am now satisfied with the latest patch, this new DocdSet impl is better than the SortedVInitList (which was OK, too, in my opinion. There was a very lengthly discussion in another JIRA issue about that DIS(I)).&lt;/p&gt;</comment>
                    <comment id="12735569" author="mikemccand" created="Mon, 27 Jul 2009 12:23:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;DocIdSet.EMPTY should not do &quot;new SortedVIntList&quot;, just &quot;new DocIdSet()&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, committed.&lt;/p&gt;</comment>
                    <comment id="12735570" author="thetaphi" created="Mon, 27 Jul 2009 12:24:56 +0100"  >&lt;p&gt;I also removed the note about SortedVInitList in the JavaDocs, Mike, should I commit?&lt;/p&gt;</comment>
                    <comment id="12735572" author="shaie" created="Mon, 27 Jul 2009 12:30:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;I also removed the note about SortedVInitList in the JavaDocs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Argh ... I guess I tried to create the patch too fast (before Mike commits) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
When you do this, the import of SVIL can also be removed.&lt;/p&gt;</comment>
                    <comment id="12735573" author="thetaphi" created="Mon, 27 Jul 2009 12:30:40 +0100"  >&lt;p&gt;I am a little bit confused about the JavaDocs of iterator():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/** Provides a {@link DocIdSetIterator} to access the set.
 * This may (but is not required to) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there
 * are no docs that match. */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is it really allowed to return null instead of an empty iterator? If not, we should silently remove this part of the docs (and hopefully do not break some filters written by someone).&lt;/p&gt;
</comment>
                    <comment id="12735574" author="shaie" created="Mon, 27 Jul 2009 12:34:49 +0100"  >&lt;blockquote&gt;&lt;p&gt;Is it really allowed to return null instead of an empty iterator?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Some iterators already return null as an iterator, perhaps unknowingly. QueryWrapperFilter will do that if the Query produced a null Scorer, which is legal, or at least the de facto impl of some Queries.&lt;/p&gt;

&lt;p&gt;I think that the decisions on this issue were made because we observed that returning null &quot;already exists&quot;, and moving to not return null, or saying that null should not be returned, may break back-compat (e.g. if someone relies on null to mean &quot;there are no docs to match&quot;).&lt;/p&gt;</comment>
                    <comment id="12735575" author="thetaphi" created="Mon, 27 Jul 2009 12:37:04 +0100"  >&lt;p&gt;OK, so maybe we change the JavaDoc and state, that optimally a Filter should return the empty DocIdSet instance. This is e.g. how MultiTermQueryWrapperFilter works.&lt;/p&gt;</comment>
                    <comment id="12735576" author="shaie" created="Mon, 27 Jul 2009 12:46:17 +0100"  >&lt;p&gt;Even though I don&apos;t know if it&apos;s &quot;optimal&quot;, I think this makes sense to document, i.e. change the javadoc to something like &quot;if there are no docs that match, the implementation can return null or DocIdSet.EMPTY_DOCIDSET.iterator()&quot;?&lt;/p&gt;

&lt;p&gt;Can you do this while changing the javadoc of EMPTY_DOCIDSET as well as the unnecessary import?&lt;/p&gt;</comment>
                    <comment id="12735578" author="thetaphi" created="Mon, 27 Jul 2009 13:04:20 +0100"  >&lt;p&gt;DONE! I hope this is the last commit for this issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12735583" author="mikemccand" created="Mon, 27 Jul 2009 13:27:17 +0100"  >&lt;p&gt;Phew, thanks guys!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12414605" name="LUCENE-1754-2.patch" size="6921" author="shaie" created="Mon, 27 Jul 2009 12:15:44 +0100" />
                    <attachment id="12414604" name="LUCENE-1754-2.patch" size="6685" author="shaie" created="Mon, 27 Jul 2009 11:59:54 +0100" />
                    <attachment id="12414510" name="LUCENE-1754.patch" size="25339" author="mikemccand" created="Sat, 25 Jul 2009 11:37:28 +0100" />
                    <attachment id="12414226" name="LUCENE-1754.patch" size="27044" author="shaie" created="Wed, 22 Jul 2009 18:27:54 +0100" />
                    <attachment id="12414224" name="LUCENE-1754.patch" size="27051" author="shaie" created="Wed, 22 Jul 2009 18:10:13 +0100" />
                    <attachment id="12414003" name="LUCENE-1754.patch" size="11979" author="shaie" created="Mon, 20 Jul 2009 13:31:25 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 20 Jul 2009 10:55:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12006</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25972</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>