<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:58 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1420/LUCENE-1420.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1420] Similarity.lengthNorm and positionIncrement=0</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1420</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Calculation of lengthNorm factor should in some cases take into account the number of tokens with positionIncrement=0. This should be made optional, to support two different scenarios:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;when analyzers insert artificially constructed tokens into TokenStream (e.g. ASCII-fied versions of accented terms, stemmed terms), and it&apos;s unlikely that users submit queries containing both versions of tokens: in this case lengthNorm calculation should ignore the tokens with positionIncrement=0.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;when analyzers insert synonyms, and it&apos;s likely that users may submit queries that contain multiple synonymous terms: in this case the lengthNorm should be calculated as it is now, i.e. it should take into account all terms no matter what is their positionIncrement.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The default should be backward-compatible, i.e. it should count all tokens.&lt;/p&gt;

&lt;p&gt;(See also the discussion here: &lt;a href=&quot;http://markmail.org/message/vfvmzrzhr6pya22h&quot; class=&quot;external-link&quot;&gt;http://markmail.org/message/vfvmzrzhr6pya22h&lt;/a&gt; )&lt;/p&gt;</description>
                <environment></environment>
            <key id="12406291">LUCENE-1420</key>
            <summary>Similarity.lengthNorm and positionIncrement=0</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="ab">Andrzej Bialecki </reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Oct 2008 11:08:40 +0100</created>
                <updated>Fri, 13 May 2011 19:20:36 +0100</updated>
                    <resolved>Mon, 3 Nov 2008 18:05:08 +0000</resolved>
                            <version>2.9</version>
                                <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12639054" author="ab" created="Mon, 13 Oct 2008 14:50:24 +0100"  >&lt;p&gt;This patch adds Similarity,length(fieldName, numTokens, numOverlapTokens), and provides backward-compatible implementation in Similarity.java.&lt;/p&gt;</comment>
                    <comment id="12639112" author="mikemccand" created="Mon, 13 Oct 2008 18:06:43 +0100"  >&lt;p&gt;Looks good, thanks Andrzej.  I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12639668" author="hossman" created="Wed, 15 Oct 2008 01:27:21 +0100"  >&lt;p&gt;1) i only skimmed this quickly, but i don&apos;t think the changes to SweetSpotSimilarity are back compatible ... setLengthNormFactors has a new arg list.&lt;/p&gt;

&lt;p&gt;2) ditto for the public &quot;Info&quot; constructor in MemoryIndex.java&lt;/p&gt;

&lt;p&gt;3) as long as we are adding a new lengthNorm method that has access to new data about the stream, would it also make sense to pass in fieldState.position?  and/or a new count of hte number of times getPositionIncrementGap(fieldInfo.name) is called?  Those also seem like they could be useful, and should be just as cheap to keep track of as numOverlap and length.  (this occured to me because of recent threads on solr-user asking about lengthNorm and multivalued fields ... there may only be one fieldNorm per field name, but with stats like that we could at least do some interesting things based on the average length of each field value.&lt;/p&gt;

&lt;p&gt;4) independent of #3, we may want to consider making FieldInvertState a public class and passing it directly to lengthNorm ... that way lengthNorm can utilize whatever data it wants, and we can add more available data later without changing the API again.  We could even deprecate lengthNorm entirely and add a new FieldInvertState.norm property that a new Similarity.computeNorm(FieldInvertState) could set directly so it could choose to ignore the doc &amp;amp; field boosts altogether if it wanted to.&lt;/p&gt;</comment>
                    <comment id="12640115" author="mikemccand" created="Thu, 16 Oct 2008 10:28:47 +0100"  >&lt;p&gt;Re 1 &amp;amp; 2: I agree.  Even though the back compat is &quot;looser&quot; for contribs, we still should not break it unless we have to.  In this case we definitely don&apos;t have to.&lt;/p&gt;

&lt;p&gt;Re 3 &amp;amp; 4: I like this in principle, but I&apos;m nervous about making FieldInvertState public since it&apos;s such a new API.  I guess if we put the &quot;this API is new &amp;amp; subject to change&quot; caveat on there, to reserve the right to change it, that&apos;s OK.  I also like having Similiarity.computeNorm factor in the boost, and extending FieldInverState to track the number of field occurrences that had been processed.&lt;/p&gt;

&lt;p&gt;Andrzej, can you update the patch to address these issues?&lt;/p&gt;</comment>
                    <comment id="12642613" author="mikemccand" created="Sat, 25 Oct 2008 11:39:00 +0100"  >&lt;p&gt;Andrzej are you &lt;span class=&quot;error&quot;&gt;&amp;#91;going to&amp;#93;&lt;/span&gt; work out a new patch here?  I&apos;d like to bring closure.&lt;/p&gt;</comment>
                    <comment id="12642663" author="ab" created="Sat, 25 Oct 2008 23:56:22 +0100"  >&lt;p&gt;Patch that uses FieldInvertState, as suggested. Changes in other classes are limited to minimum in this patch - users of Similarity other than o.a.l.index.* still use lengthNorm(String, int).&lt;/p&gt;</comment>
                    <comment id="12643213" author="mikemccand" created="Tue, 28 Oct 2008 14:04:59 +0000"  >&lt;p&gt;Thanks Andrzej.&lt;/p&gt;

&lt;p&gt;I made some further changes (attached new patch):&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Changed the new Similarity.computeNorm(String, FieldInvertState)&lt;br/&gt;
    method to return the float norm instead of setting it on the&lt;br/&gt;
    FieldInvertState.  I also removed FieldInvertState.
{get,set}
&lt;p&gt;Norm.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I put back the changes to SweetSpotSimilarity &amp;amp; MemoryIndex, but&lt;br/&gt;
    kept the old APIs (deprecated) for back compat.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I added 
{set/get}
&lt;p&gt;DiscountOverlaps to DefaultSimilarity, and also&lt;br/&gt;
    overrode computeNorm to use discountOverlaps to compute the number&lt;br/&gt;
    of tokens to pass to lengthNorm.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The Info class is private inside MemoryIndex, even though its ctor&lt;br/&gt;
    is public, so, I just added boolean to its ctor (ie, there&apos;s no&lt;br/&gt;
    back-compat issue).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Tweaked javadocs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So now, both DefaultSimilarity and SweetSpotSimilarity have the option&lt;br/&gt;
to discount overlaps, but do not do so by default.&lt;/p&gt;</comment>
                    <comment id="12643231" author="ab" created="Tue, 28 Oct 2008 15:16:12 +0000"  >&lt;p&gt;Thanks for a thorough review. I&apos;m fine with these changes, and the idea to gently introduce discountOverlaps in the Similarity API is great. Please go ahead if there are no further objections.&lt;/p&gt;</comment>
                    <comment id="12643614" author="mikemccand" created="Wed, 29 Oct 2008 19:15:51 +0000"  >&lt;p&gt;OK thanks Andrzej.  I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12644772" author="mikemccand" created="Mon, 3 Nov 2008 18:05:08 +0000"  >&lt;p&gt;Committed revision 710117.  Thanks Andrzej!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12392932" name="LUCENE-1420.patch" size="25063" author="mikemccand" created="Tue, 28 Oct 2008 14:04:59 +0000" />
                    <attachment id="12392011" name="similarity.patch" size="15416" author="ab" created="Mon, 13 Oct 2008 14:50:24 +0100" />
                    <attachment id="12392830" name="similarity-v2.patch" size="14940" author="ab" created="Sat, 25 Oct 2008 23:56:22 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 13 Oct 2008 17:06:43 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12331</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26308</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>