<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2542/LUCENE-2542.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2542] TopDocsCollector should be abstract super class that is the real &quot;TopDocsCollector&quot; contract, a subclass should implement the priority-queue logic. e.g. PQTopDocsCollector</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2542</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;TopDocsCollector is both an abstract interface for producing TopDocs as well as a PriorityQueue based implementation.&lt;br/&gt;
Not all Collectors that could produce TopDocs must use a PriorityQueue, and it would be advantageous to allow the TopDocsCollector to be an &quot;interface&quot; type abstract class, with a PQTopDocsCollector sub-class.&lt;br/&gt;
While doing this, it&apos;d be good to clean up the generics uses in these classes. As it&apos;s odd to create a TopFieldCollector and have to case the TopDocs object, when this can be fixed with generics.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12469540">LUCENE-2542</key>
            <summary>TopDocsCollector should be abstract super class that is the real &quot;TopDocsCollector&quot; contract, a subclass should implement the priority-queue logic. e.g. PQTopDocsCollector</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="woody.anderson@gmail.com">Woody Anderson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 17 Jul 2010 20:34:21 +0100</created>
                <updated>Wed, 30 Mar 2011 16:49:50 +0100</updated>
                    <resolved>Wed, 21 Jul 2010 20:00:41 +0100</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12889546" author="woody.anderson@gmail.com" created="Sun, 18 Jul 2010 00:01:03 +0100"  >&lt;p&gt;I&apos;m providing this patch in case you want to have this fix for 3.0.2 based lucene branch. It breaks the back compatibility test, b/c i changed the &apos;meaning&apos; of TopDocsCollector. You could probably introduce a new class that is a superclass of TDC, but that makes code/files less readable and less representative.&lt;br/&gt;
So, since few people are probably patching 3.0.2 in this case anyway, it&apos;s here only for those few want that. There will be another patch for 4.0 release target, where the back compatibility is not enforced.&lt;/p&gt;</comment>
                    <comment id="12889549" author="woody.anderson@gmail.com" created="Sun, 18 Jul 2010 00:18:11 +0100"  >&lt;p&gt;this patch was generated against lucene/trunk&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
~/g/lucene-trunk -&amp;gt; svn info
Path: .
URL: http:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf/lucene/dev/trunk
&lt;/span&gt;Repository Root: http:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf
&lt;/span&gt;Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68
Revision: 964467
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I generated the diff with svn, but did not &quot;add with history&quot; when i moved TopDocs* to PQTopDocs*, this allows the diff to apply cleanly with patch, but is not optimal for svn history management.&lt;/p&gt;

&lt;p&gt;with svn i guess, it&apos;s technically better to preserve the history and svn merge, which can track file adds w/ history etc.&lt;br/&gt;
i track my local changes with git, which does that automatically, so if there is a &quot;preferred&quot; way to generate patches wrt to svn that can actually apply with patch i&apos;ll generate that way.&lt;/p&gt;

&lt;p&gt;Or if there is a way to apply a history preserving patch with svn, i&apos;d love to know what it is. And i can figure out how to jostle that diff into my git repo on my own.&lt;/p&gt;</comment>
                    <comment id="12889555" author="shaie" created="Sun, 18 Jul 2010 04:03:53 +0100"  >&lt;p&gt;I am not sure that we should do this change. The purpose behind TDC was its PQ usage. On top of it we created TSDC and TFC. What is the benefit of having TDC w/o PQ, just so that we can have a PQTFC?&lt;/p&gt;

&lt;p&gt;Collector is the base class for all, and if someone wants to create a non-PQ TDC he can do so ... not sure this should be in Lucene core though.&lt;/p&gt;</comment>
                    <comment id="12889559" author="woody.anderson@gmail.com" created="Sun, 18 Jul 2010 05:21:13 +0100"  >&lt;p&gt;Well, the idea of &quot;top N documents&quot; is, imo, distinct from how it is implemented, (e.g. with lucene&apos;s internal PQ impl).&lt;/p&gt;

&lt;p&gt;I think, at some level we disagree on what TopDocsCollector is &quot;for&quot;, you say it&apos;s for a PQ implementation; whereas, I think it&apos;s for the public interface, namely:&lt;br/&gt;
getTopDocs(..) and getTotalHits(). The that fact that the implementation uses org.apache.lucene.util.PriorityQueue is not necessarily a positive thing for my purposes.&lt;/p&gt;

&lt;p&gt;Alternate impls certainly could subclass Collector directly, but much of the time when getting documents, getting a TopDocs is preferred, and there is value in expressing that capability abstractly. And there is value in expressing accomplishing that w/o being tied it to a single possible implementation. Overall, the PQ based impl is effective, but that doesn&apos;t mean that it&apos;s always the most effective impl capable of yielding TopDocCollector functionality, and by that i mean the public interface.&lt;/p&gt;

&lt;p&gt;I have uses of this code that require referring abstractly to Collectors that produce TopDocs, doing that without any common interface or abstract class (whole separate issue with the fact that Collector is not in iface &amp;amp; ditto TDC) requires wrapping a TopDocsCollector in a proxy, which is just kind of silly to me.&lt;/p&gt;

&lt;p&gt;Also, i&apos;m entirely missing the downside?&lt;/p&gt;</comment>
                    <comment id="12889581" author="shaie" created="Sun, 18 Jul 2010 08:32:05 +0100"  >&lt;p&gt;First, we didn&apos;t make an interface out of Collector or any of its derivatives on purpose - that&apos;s the approach that&apos;s adopted in many places of the code - when you want to add a method, it&apos;s impossible to do it with an interface w/o breaking back-compat, while abstract classes give us the freedom to do so w/ a default impl (when possible).&lt;/p&gt;

&lt;p&gt;You can already sub-class TDC and not rely on its PQ, by passing null to its ctor and override all of the topDocs methods. I agree that looks odd (why pass null in the first place). But then, there is a point where you need to ask yourself &quot;what must be in core Lucene&quot;, &quot;what is a nice to have&quot; and &quot;what is completely app-specific usage&quot;. Collector is a &quot;must have in core&quot;, no arguments about it. Previously, TDC was actually TSDC and had only one derivative &amp;#8211; TFC. But a while ago, when the Collector API was changed, TDC was created for TSDC and TFC to override it (rather than TFC overriding TSDC) and a &quot;nice to have&quot; side effect was that app-specific PQ-based collectors can override TDC as well.&lt;/p&gt;

&lt;p&gt;The question I&apos;m asking myself is whether a generic &quot;TDC&quot;, which will be entirely abstract &amp;#8211; no chance for common impl, perhaps except for getTotalHits(), which is redundant &apos;cause TopDocs has totalHits already &amp;#8211; is a &quot;nice to have&quot; in Lucene. It&apos;s certainly not a &quot;must have&quot; ... and it adds complexity more than it simplifies the API. After all, Lucene&apos;s external API accepts and handles Collector. Internally it creates TSDC or TFC. It couldn&apos;t care less what those two extend.&lt;/p&gt;

&lt;p&gt;It seems to me that only the app will benefit from having this abstraction, and seems to me you can do so w/o having TDC in core Lucene. You can have your own TDC, w/ a wrapper for &quot;Lucene TDCs&quot; and your own extensions ...&lt;/p&gt;</comment>
                    <comment id="12889745" author="woody.anderson@gmail.com" created="Mon, 19 Jul 2010 03:42:50 +0100"  >&lt;p&gt;I&apos;m pretty sure that you cannot usefully pass null to the TDC constructor due to various final methods (all the public methods are final), e.g. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /** Returns the top docs that were collected by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; collector. */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TopDocs topDocs() {
    &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; pq was populated with sentinel values, there might be less
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// results than pq.size(). Therefore &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; all results until either
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// pq.size() or totalHits.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; topDocs(0, totalHits &amp;lt; pq.size() ? totalHits : pq.size());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which actually begs the question, should the constructor validate that the PQ is non-null, as it clearly cannot produce a TopDocs if it is&lt;br/&gt;
I imagine there were performance reasons that it was made final? or is extension in this case frowned upon?&lt;/p&gt;

&lt;p&gt;At any rate, I agree that this isn&apos;t a &quot;must have&quot;, i do think that since a lot of useful collectors conform to the TDC contract, it&apos;s useful to allow that definition to be extensible to implementations not provided by core lucene. Code &quot;sharing&quot; is not the only reason to allow for oo abstractions, and though the implementations don&apos;t all belong in core lucene, the ability to refer to them collectively does have value. I would suggest that the value of the abstraction is there for more developers than just me, otherwise i wouldn&apos;t have submitted the patch.&lt;/p&gt;

&lt;p&gt;I agree with your last comment the most, that IF TDC were extensible for my purposes, then that would be far superior to my submitted patch of adding classes.&lt;br/&gt;
We could un-final all the public methods of the TDC, which would basically allow someone to fullfil the contract without using the PQ system TDC is built upon. &lt;/p&gt;

&lt;p&gt;What do you think of that?&lt;/p&gt;</comment>
                    <comment id="12889759" author="shaie" created="Mon, 19 Jul 2010 06:13:53 +0100"  >&lt;p&gt;Personally I don&apos;t mind removing the final modifier from the methods. I see that jdocs need to be fixed anyway, cause they mention one can override topDocs which is wrong. What do others think?&lt;/p&gt;</comment>
                    <comment id="12890127" author="woody.anderson@gmail.com" created="Tue, 20 Jul 2010 02:40:23 +0100"  >&lt;p&gt;simple un-final patch with simple unit test that won&apos;t compile if they are final.&lt;br/&gt;
updated javadocs as well. Though, i defer final wording in that regard.&lt;/p&gt;</comment>
                    <comment id="12890246" author="shaie" created="Tue, 20 Jul 2010 13:03:40 +0100"  >&lt;p&gt;Can you please add the TDC impl to JustCompileSearch (instead of the testcase you wrote)? Look at other internal classes there for an example. This class is not a test per se, however it&apos;s there to ensure certain extensions are possible.&lt;/p&gt;

&lt;p&gt;Also, can you change the jdoc from &quot;Most extending classes ...&quot; to &quot;Extending classes can override any of the methods to provide their own implementation, as well as avoid the use of the priority queue entirely by passing null to &lt;/p&gt;
{@link #TopDocsCollector(PriorityQueue)}
&lt;p&gt;. In that case however, you might want to consider overriding all methods, in order to avoid an NullPointerException.&lt;/p&gt;

&lt;p&gt;Then, you can remove the jdoc of the ctor.&lt;/p&gt;</comment>
                    <comment id="12890539" author="woody.anderson@gmail.com" created="Wed, 21 Jul 2010 03:35:26 +0100"  >&lt;p&gt;went with your suggestions verbatim.&lt;br/&gt;
as a &quot;just compile&quot; test, we lose the test/proof that super(null) will not NPE, but that&apos;s presumably a fairly minor issue, and was previously not enforced by a test case anyway.&lt;br/&gt;
adding that test would be trivial, we could simply  &quot;new JustCompileTopDocsCollector(null)&quot;, though that would go against &quot;just compile&quot;, otherwise we&apos;re back to a test pretty much the same as the previous patch.&lt;/p&gt;</comment>
                    <comment id="12890575" author="shaie" created="Wed, 21 Jul 2010 07:48:38 +0100"  >&lt;p&gt;Patch looks good. I think it&apos;s ready to commit, but it will take me another day or two until I can get to it. So if someone else wants to commit it, please do.&lt;/p&gt;</comment>
                    <comment id="12890824" author="yseeley@gmail.com" created="Wed, 21 Jul 2010 20:00:41 +0100"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                    <comment id="13013271" author="gsingers" created="Wed, 30 Mar 2011 16:49:50 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12450012" name="LUCENE-2542.patch" size="3432" author="woody.anderson@gmail.com" created="Wed, 21 Jul 2010 03:35:26 +0100" />
                    <attachment id="12449905" name="LUCENE-2542.patch" size="4783" author="woody.anderson@gmail.com" created="Tue, 20 Jul 2010 02:40:22 +0100" />
                    <attachment id="12449774" name="LUCENE-2542.patch" size="38983" author="woody.anderson@gmail.com" created="Sun, 18 Jul 2010 00:18:11 +0100" />
                    <attachment id="12449773" name="LUCENE_3.0.2-2542.patch" size="35697" author="woody.anderson@gmail.com" created="Sun, 18 Jul 2010 00:01:03 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 18 Jul 2010 03:03:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11286</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25150</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>