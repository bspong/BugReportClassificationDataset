<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:08 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2876/LUCENE-2876.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2876] Remove Scorer.getSimilarity()</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2876</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Originally this was part of the patch for per-field Similarity (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2236&quot; title=&quot;Similarity can only be set per index, but I may want to adjust scoring behaviour at a field level&quot;&gt;&lt;del&gt;LUCENE-2236&lt;/del&gt;&lt;/a&gt;), but I pulled it &lt;br/&gt;
out here as its own issue as its really mostly unrelated. I also like it as a separate issue &lt;br/&gt;
to apply the deprecation to branch_3x to just make less surprises/migration hassles for 4.0 users.&lt;/p&gt;

&lt;p&gt;Currently Scorer takes a confusing number of ctors, either a Similarity, or a Weight + Similarity.&lt;br/&gt;
Also, lots of scorers don&apos;t use the Similarity at all, and its not really needed in Scorer itself.&lt;br/&gt;
Additionally, the Weight argument is often null. The Weight makes sense to be here in Scorer, &lt;br/&gt;
its the parent that created the scorer, and used by Scorer itself to support &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2590&quot; title=&quot;Enable access to the freq information in a Query&amp;#39;s sub-scorers&quot;&gt;&lt;del&gt;LUCENE-2590&lt;/del&gt;&lt;/a&gt;&apos;s features.&lt;br/&gt;
But I dont think all queries work with this feature correctly right now, because they pass null.&lt;/p&gt;

&lt;p&gt;Finally the situation gets confusing if you start to consider delegators like ScoreCachingWrapperScorer,&lt;br/&gt;
which arent really delegating correctly so I&apos;m unsure features like &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2590&quot; title=&quot;Enable access to the freq information in a Query&amp;#39;s sub-scorers&quot;&gt;&lt;del&gt;LUCENE-2590&lt;/del&gt;&lt;/a&gt; aren&apos;t working with this.&lt;/p&gt;

&lt;p&gt;So I think we should remove the getSimilarity, if your scorer uses a Similarity its already coming&lt;br/&gt;
to you via your ctor from your Weight and you can manage this yourself.&lt;/p&gt;

&lt;p&gt;Also, all scorers should pass the Weight (parent) that created them, and this should be Scorer&apos;s only ctor.&lt;br/&gt;
I fixed all core/contrib/solr Scorers (even the internal ones) to pass their parent Weight, just for consistency&lt;br/&gt;
of this visitor interface. The only one that passes null is Solr&apos;s ValueSourceScorer.&lt;/p&gt;

&lt;p&gt;I set fix-for 3.1, not because i want to backport anything, only to mark the getSimilarity deprecated there.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12496085">LUCENE-2876</key>
            <summary>Remove Scorer.getSimilarity()</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Jan 2011 01:38:47 +0000</created>
                <updated>Wed, 30 Mar 2011 16:49:57 +0100</updated>
                    <resolved>Fri, 21 Jan 2011 03:51:07 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/query/scoring</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12984148" author="rcmuir" created="Thu, 20 Jan 2011 12:12:29 +0000"  >&lt;p&gt;I&apos;d like to commit this later today if there aren&apos;t any objections (its just boring cleanup).&lt;/p&gt;

&lt;p&gt;As far as 3.1, i rethought the issue, and i think e.g. DisjunctionMaxQuery should really work with &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2590&quot; title=&quot;Enable access to the freq information in a Query&amp;#39;s sub-scorers&quot;&gt;&lt;del&gt;LUCENE-2590&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So i&apos;ll look at fixing trying to pass non-null weight in 3.x too, i think users will see it as a bug...&lt;/p&gt;</comment>
                    <comment id="12984171" author="doronc" created="Thu, 20 Jan 2011 13:15:01 +0000"  >&lt;p&gt;Patch looks good. &lt;/p&gt;

&lt;p&gt;+1 for this cleanup which removes calls with null arg and comment &lt;/p&gt;
{&quot;//similarity not in use&quot;}
&lt;p&gt;. &lt;/p&gt;

&lt;p&gt;Some minor comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;jdoc: in some of the scorer constructors a Weight param was added but existing jdocs for the costructor which document (some) params was not updated to also mention the weight. I am not 100% sure this should be fixed, as there is inconsistency in the level of jdoc for scorer implementations. So if there were no jdocs at all there I would say nothing, but since there were some now they became less complete...&lt;/li&gt;
	&lt;li&gt;ExactPhraseScorer is created with both Weight and Similarity - I think the Similarity param can be removed as part of this cleanup.&lt;/li&gt;
	&lt;li&gt;Same for SloppyPhraseScorer, PhraseScorer, SpanScorer, TermScorer, MatchAllDocsScorer - Similarity param can be removed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One question not related to this patch - just saw it  reviewing:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;it is interesting that SloppyPhraseScorer now extends PhraseScorer but ExactPhraseScorer does not, is this on purpose? Perhaps related do Mike&apos;s recent optimizations in this scorer?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12984177" author="rcmuir" created="Thu, 20 Jan 2011 13:31:29 +0000"  >&lt;p&gt;Thanks for the review Doron!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;jdoc: in some of the scorer constructors a Weight param was added but existing jdocs for the costructor which document (some) params was not updated to also mention the weight. I am not 100% sure this should be fixed, as there is inconsistency in the level of jdoc for scorer implementations. So if there were no jdocs at all there I would say nothing, but since there were some now they became less complete...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll fix this, thanks!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ExactPhraseScorer is created with both Weight and Similarity - I think the Similarity param can be removed as part of this cleanup.&lt;br/&gt;
Same for SloppyPhraseScorer, PhraseScorer, SpanScorer, TermScorer, MatchAllDocsScorer - Similarity param can be removed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These still need the Similarity param? They use it in scoring, its just they don&apos;t pass it to the superclass constructor (Scorer&apos;s constructor).&lt;/p&gt;

&lt;p&gt;Its possible I misunderstood your idea though. Lets take the TermQuery example, are you suggesting that &lt;br/&gt;
we should expose TermWeight&apos;s &quot;Similarity&quot; and just pass TermWeight to TermScorer (requiring TermScorer&lt;br/&gt;
to take a TermWeight in its ctor instead of Weight + Similarity?) Currently TermWeight&apos;s local copy of &lt;br/&gt;
Similarity, which it uses to compute IDF, is private.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it is interesting that SloppyPhraseScorer now extends PhraseScorer but ExactPhraseScorer does not, is this on purpose? Perhaps related do Mike&apos;s recent optimizations in this scorer?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s correct. Just at a glance he might have done this so that ExactPhraseScorer can compute a &lt;br/&gt;
score cache like TermScorer, and other similar optimizations since the &quot;tf&quot; values are really integers for &lt;br/&gt;
this exact case. &lt;/p&gt;

&lt;p&gt;It might be that if we look at splitting calculations and matching out from Scorer, that we can make&lt;br/&gt;
these &quot;matchers&quot; like ExactPhrase/SloppyPhrase simpler, and we could then clean up... not sure though!&lt;/p&gt;</comment>
                    <comment id="12984186" author="doronc" created="Thu, 20 Jan 2011 13:43:38 +0000"  >&lt;blockquote&gt;
&lt;p&gt;These still need the Similarity param? They use it in scoring, its just they don&apos;t pass it to the superclass constructor (Scorer&apos;s constructor).&lt;br/&gt;
... Currently TermWeight&apos;s local copy of Similarity, which it uses to compute IDF, is private.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right, I was for some reason under the impression that part of the reason for the change is that Weight already exposes Similarity but it is not, and I think it shouldn&apos;t, so current patch is good here.&lt;/p&gt;</comment>
                    <comment id="12984198" author="rcmuir" created="Thu, 20 Jan 2011 14:05:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;You&apos;re right, I was for some reason under the impression that part of the reason for the change is that Weight already exposes Similarity but it is not, and I think it shouldn&apos;t, so current patch is good here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, mainly it was just to correct the inconsistencies:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the base class does nothing with Similarity, and its often null, so i don&apos;t think it needs to know about it.&lt;/li&gt;
	&lt;li&gt;the base class does however, provide functionality that depends on Weight, and I think it should be non-null to support that. We might want to expand on this functionality in the future too.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I wish i could have thrown IAE on null Weight (I did this to find all scorers that did not comply), but there is again&lt;br/&gt;
the one ValueSourceScorer in Solr that isn&apos;t easily fixed... at least the patch creates more consistency.&lt;/p&gt;

&lt;p&gt;I&apos;ll review all javadocs for the scorers, and try to make sure the param documentation is up to date.&lt;/p&gt;

&lt;p&gt;Thanks again for taking the time to review these scoring issues.&lt;/p&gt;</comment>
                    <comment id="12984205" author="rcmuir" created="Thu, 20 Jan 2011 14:27:19 +0000"  >&lt;p&gt;Updated patch: with javadocs inconsistencies corrected.&lt;/p&gt;</comment>
                    <comment id="12984387" author="rcmuir" created="Thu, 20 Jan 2011 20:39:05 +0000"  >&lt;p&gt;Committed revision 1061499.&lt;/p&gt;

&lt;p&gt;Will work on adding the @deprecated and fixing javadocs and null Weights in branch_3x,&lt;br/&gt;
but we need to provide Similarity where we were providing it before for backwards compatibility.&lt;/p&gt;</comment>
                    <comment id="12984547" author="rcmuir" created="Fri, 21 Jan 2011 03:51:07 +0000"  >&lt;p&gt;backported to 3.x: revision 1061615.&lt;/p&gt;</comment>
                    <comment id="13013316" author="gsingers" created="Wed, 30 Mar 2011 16:49:57 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12468852" name="LUCENE-2876.patch" size="42562" author="rcmuir" created="Thu, 20 Jan 2011 14:27:19 +0000" />
                    <attachment id="12468812" name="LUCENE-2876.patch" size="39090" author="rcmuir" created="Thu, 20 Jan 2011 01:39:25 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 20 Jan 2011 13:15:01 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10990</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24816</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>