<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 12:57:21 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-456/LUCENE-456.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-456] Duplicate hits and missing hits in sorted search</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-456</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;If using a searcher that subclasses from IndexSearcher I get different result sets (besides the ordering of course). The problem only occurrs if the searcher is wrapped by (Parallel)MultiSearcher and the index is not too small. The number of hits returned by un unsorted and a sorted search are identical but the hits are referencing different documents. A closer look at the result sets revealed that the sorted search returns duplicate hits.&lt;/p&gt;

&lt;p&gt;I created test cases for Lucene 1.4.3 as well as for the head release. The problem showed up for both, the number of duplicates beeing bigger for the head realease. The test cases are written for package org.apache.lucene.search. There are messages describing the problem written to the console. In order to see all those hints the asserts are commented out. So dont&apos;t be confused if junit reports no errors. (Sorry, beeing a novice user of the bug tracker I don&apos;t see any means to attach the test cases on this screen. Let&apos;s see.)&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.4.2_06, probably OS independant, testet on Solaris 8 and Win2000&lt;/p&gt;</environment>
            <key id="12318013">LUCENE-456</key>
            <summary>Duplicate hits and missing hits in sorted search</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="mseitz">Martin Seitz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Oct 2005 16:16:20 +0100</created>
                <updated>Sat, 27 May 2006 02:39:14 +0100</updated>
                    <resolved>Fri, 11 Nov 2005 12:34:15 +0000</resolved>
                            <version>1.4</version>
                                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12332188" author="mseitz" created="Mon, 17 Oct 2005 16:18:17 +0100"  >&lt;p&gt;The test case for Lucene 1.4.3.&lt;/p&gt;</comment>
                    <comment id="12332189" author="mseitz" created="Mon, 17 Oct 2005 16:21:42 +0100"  >&lt;p&gt;Test case for HEAD revision form oct 12, 2005.&lt;/p&gt;</comment>
                    <comment id="12332225" author="lvl" created="Mon, 17 Oct 2005 22:26:07 +0100"  >&lt;p&gt;This could be related to issue 453 I submitted a few days ago.&lt;/p&gt;

&lt;p&gt;(Parallel-)MultiSearcher uses a FieldDocSortedHitQueue to merge the results from the underlying IndexSearchers into the final result list (even if there&apos;s only one).&lt;/p&gt;

&lt;p&gt;There&apos;s a bug if two documents are compared that don&apos;t have the field that is being compared.  If one document doesn&apos;t have the field, then it should come first, but if both don&apos;t have it, they should be considered equal and the next SortField tried.&lt;/p&gt;

&lt;p&gt;In the current implementation (1.4.3 and head) when both fields are null, one of the two is always chosen as being &apos;lessThan&apos; the other.  Since this is not consistent (the value of the lessThan depends of the order of the parameters in that case) it changes the sort order (as I observed) and can probably &apos;confuse&apos; the queue implementation so you get dropped and double hits.&lt;/p&gt;

&lt;p&gt;Could you try to apply the patch I submitted for FieldDocSortedHitQueue and see if that helps in your case too?&lt;/p&gt;</comment>
                    <comment id="12332248" author="mseitz" created="Tue, 18 Oct 2005 02:37:32 +0100"  >&lt;p&gt;The patch doesn&apos;t fix the problem. On the contrary the number of reported duplicates increases. However, the fact that the patch changes the behaviour at all may imply that the problem does relate to the FieldSortedHitQueue.&lt;br/&gt;
As an additional test I removed the if statement in my testcase that causes field &quot;publicationDate_&quot; staying empty for some documents. (So that all documents have that field.) After the change there are still duplicates in the result set, however there are less. This implies that the problem has not directly to do with sorting of empty fields.&lt;/p&gt;</comment>
                    <comment id="12332391" author="yseeley@gmail.com" created="Wed, 19 Oct 2005 04:42:14 +0100"  >&lt;p&gt;The problem is when docs are equal, the order is unspecified.  That in conjunction with the fact that Hits can do multiple searches under the covers, leads to your document duplication.&lt;/p&gt;

&lt;p&gt;Everything works fine after I apply the patch I&apos;m attaching here, in addition to the patch here:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/LUCENE-453&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/browse/LUCENE-453&lt;/a&gt;&lt;br/&gt;
And for good measure, the patch here:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/LUCENE-374&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/browse/LUCENE-374&lt;/a&gt;&lt;/p&gt;
</comment>
                    <comment id="12332465" author="mseitz" created="Wed, 19 Oct 2005 20:16:57 +0100"  >&lt;p&gt;Yep! That did it. I applied the three patches (I had to modify them slightly for release 1.4.3) and it works - the test cases as well as my application.&lt;/p&gt;</comment>
                    <comment id="12332478" author="lvl" created="Wed, 19 Oct 2005 23:47:49 +0100"  >&lt;p&gt;I applied the three patches as well and I also don&apos;t see any anomalies any more.&lt;/p&gt;

&lt;p&gt;Perhaps the fact that there is a &apos;hidden&apos; ultimate sorting key (based on the internal document number) for equal documents should be mentioned somewhere in the &lt;br/&gt;
the documentation.  It&apos;s the most logical solution to make the sort stable without sacrificing speed.&lt;/p&gt;

&lt;p&gt;If I understand correctly, that already existed for standalone IndexSearchers, but was &apos;forgotten&apos; for (Parallel-)MultiSearchers.&lt;/p&gt;</comment>
                    <comment id="12357340" author="yseeley@gmail.com" created="Fri, 11 Nov 2005 12:34:15 +0000"  >&lt;p&gt;patch applied to the current version.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12314938" name="FieldDocSortedHitQueue_dups.txt" size="503" author="yseeley@gmail.com" created="Wed, 19 Oct 2005 04:42:14 +0100" />
                    <attachment id="12314911" name="TestCustomSearcherSort_1_4_3.java" size="10119" author="mseitz" created="Mon, 17 Oct 2005 16:18:17 +0100" />
                    <attachment id="12314912" name="TestCustomSearcherSort_HEAD.java" size="10301" author="mseitz" created="Mon, 17 Oct 2005 16:21:42 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 17 Oct 2005 21:26:07 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13293</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27275</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>