<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:09:06 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1296/LUCENE-1296.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1296] Allow use of compact DocIdSet in CachingWrapperFilter</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1296</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Extends CachingWrapperFilter with a protected method to determine the DocIdSet to be cached.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12397102">LUCENE-1296</key>
            <summary>Allow use of compact DocIdSet in CachingWrapperFilter</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="paul.elschot@xs4all.nl">Paul Elschot</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 May 2008 21:14:49 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:06 +0100</updated>
                    <resolved>Mon, 1 Dec 2008 18:51:46 +0000</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>2</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12600907" author="paul.elschot@xs4all.nl" created="Thu, 29 May 2008 21:18:26 +0100"  >&lt;p&gt;The 20080529 patch patches CachingWrapperFilter and its test to add a choice of a compact filter to be cached, as well as some recently patched  ( &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1187&quot; title=&quot;Things to be done now that Filter is independent from BitSet&quot;&gt;&lt;del&gt;LUCENE-1187&lt;/del&gt;&lt;/a&gt; ) contrib filter classes to remove the corresponding functionality there.&lt;/p&gt;</comment>
                    <comment id="12600911" author="paul.elschot@xs4all.nl" created="Thu, 29 May 2008 21:20:19 +0100"  >&lt;p&gt;Once more, with licence and copyright assigned to ASF.&lt;/p&gt;</comment>
                    <comment id="12601504" author="paul.elschot@xs4all.nl" created="Sun, 1 Jun 2008 23:51:05 +0100"  >&lt;p&gt;I tried to come up with a sensible performance test to determine a good criterium to choose between OpenBitSet and SortedVIntList as the DocIdSet supporting data structure to be cached.&lt;br/&gt;
There is a criterium for this in the patch in docIdSetToCache() method of CachingWrapperFilter, but it&apos;s only based on byte size, and it favours SortedVIntList when it is defenitely more compact than OpenBitSet.&lt;/p&gt;

&lt;p&gt;The current criterium is to use (cardinality (=nr bits set in OpenBitSet) &amp;lt; maxDocs/9) as a test to prefer SortedVIntList over OpenBitSet for caching. The constant 9 might be replaced by a configuration parameter to allow easy performance experiments there. It could be that a larger value than 9 is  turns out to be &quot;optimal&quot; in runtime.&lt;/p&gt;

&lt;p&gt;In some cases OpenBitSet can be faster on skipTo(int docNum) than SortedVIntList, even when SortedVIntList is more compact. As Filters can be expected to use skipTo() heavily, this could be important for performance.&lt;/p&gt;

&lt;p&gt;Even even though it might be possible to measure the skipTo() performance directly, the effect of the more compact cached data structure of SortedVIntList on garbage collection is (pretty close to) impossible to measure in a simple test case.&lt;/p&gt;

&lt;p&gt;Eks Dev had some interesting results there in the very early stages of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-584&quot; title=&quot;Decouple Filter from BitSet&quot;&gt;&lt;del&gt;LUCENE-584&lt;/del&gt;&lt;/a&gt; (September 2006), so I wonder whether these results could be confirmed somehow using the patch here and the current trunk.&lt;/p&gt;

&lt;p&gt;Comments?&lt;/p&gt;

</comment>
                    <comment id="12601699" author="paul.elschot@xs4all.nl" created="Mon, 2 Jun 2008 19:21:41 +0100"  >&lt;p&gt;For the record: the patch of 20080529 leaves some imports of SortedVIntList unused.&lt;/p&gt;</comment>
                    <comment id="12602565" author="paul.elschot@xs4all.nl" created="Thu, 5 Jun 2008 08:25:11 +0100"  >&lt;p&gt;In the 20080605 patch the docIdSetToCache method simply returns its argument, which would normally be an OpenBitSet when using a Filter from the core. Anyone who wants to have another filter data structure cached can override this method.&lt;/p&gt;</comment>
                    <comment id="12602566" author="paul.elschot@xs4all.nl" created="Thu, 5 Jun 2008 08:26:30 +0100"  >&lt;p&gt;Once more, with licence granted to ASF.&lt;/p&gt;</comment>
                    <comment id="12624658" author="paul.elschot@xs4all.nl" created="Fri, 22 Aug 2008 12:47:57 +0100"  >&lt;p&gt;I think this is ready to commit.&lt;br/&gt;
Even so, I&apos;d like to repeat that it also removes the choice of another DocIdSet in the contrib search/BooleanFilter and misc/ChainedFilter.&lt;br/&gt;
In the latest patch, the actual choice of another DocIdSet is left to subclasses of CachingWrapperFilter that are not implemented.&lt;/p&gt;

&lt;p&gt;One detail: for maximum flexibility, the 2nd argument to the protected method docIdSetToCache might be replaced by the indexreader. At the moment the 2nd arg is maxDoc of the indexreader, which is the only info I have needed so far to chose another DocIdSet.&lt;/p&gt;</comment>
                    <comment id="12640832" author="paul.elschot@xs4all.nl" created="Sun, 19 Oct 2008 11:51:02 +0100"  >&lt;p&gt;This didn&apos;t make it into 2.4.&lt;/p&gt;

&lt;p&gt;A side effect of that is that SortedVIntList will sometimes be used instead of an OpenBitSet in contrib search/BooleanFilter and misc/ChainedFilter. So far no problems have surfaced there, which is good news. I wonder if there was any performance improvement in practice because of this.&lt;/p&gt;</comment>
                    <comment id="12641968" author="mikemccand" created="Wed, 22 Oct 2008 21:56:05 +0100"  >&lt;p&gt;Sigh.  Should have marked it as 2.4 fix version &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One detail: for maximum flexibility, the 2nd argument to the protected method docIdSetToCache might be replaced by the indexreader.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="12641973" author="mikemccand" created="Wed, 22 Oct 2008 22:17:19 +0100"  >&lt;p&gt;I guess we should deprecate the finalResult methods in BooleanFilter &amp;amp; ChainedFilter, and suggest using CachingWrapperFilter instead?&lt;/p&gt;

&lt;p&gt;Also, why not put your logic to sometimes choose a SortedVIntList impl into CachingWrapperFilter.docIdSetToCache by default?&lt;/p&gt;</comment>
                    <comment id="12646954" author="paul.elschot@xs4all.nl" created="Wed, 12 Nov 2008 17:10:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, why not put your logic to sometimes choose a SortedVIntList impl intoCachingWrapperFilter.docIdSetToCache by default?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The main reason is that there are circumstances under which skipTo() is faster on an OpenBitSet than on a SortedVIntList. OpenBitSet allows random access, so it can start the skip from any point, but SortedVIntList can only start the skip from its current position.&lt;br/&gt;
OTOH SortedVIntList does have the advantage of being smaller when the set is sparse, and this may bring garbage collection advantages.&lt;br/&gt;
In all, not completely convincing either way.&lt;/p&gt;
</comment>
                    <comment id="12649816" author="mikemccand" created="Fri, 21 Nov 2008 21:52:37 +0000"  >&lt;p&gt;Paul are you going to pull together another patch here?&lt;/p&gt;</comment>
                    <comment id="12649851" author="paul.elschot@xs4all.nl" created="Fri, 21 Nov 2008 23:40:08 +0000"  >&lt;p&gt;Adds a docIdSetToCache method to CachingWrapperFilter.&lt;br/&gt;
Removes the choice of a compact underlying data structure from contrib filters.&lt;/p&gt;</comment>
                    <comment id="12649908" author="mikemccand" created="Sat, 22 Nov 2008 10:07:10 +0000"  >&lt;p&gt;It looks like the patch removed finalResult from contrib&apos;s ChainedFilter but not from contrib&apos;s BooleanFilter?&lt;/p&gt;</comment>
                    <comment id="12649923" author="paul.elschot@xs4all.nl" created="Sat, 22 Nov 2008 13:47:00 +0000"  >&lt;p&gt;This time with finalResult() also removed from BooleanFilter.&lt;/p&gt;</comment>
                    <comment id="12651983" author="mikemccand" created="Mon, 1 Dec 2008 12:24:35 +0000"  >&lt;p&gt;Paul, I reverted the changes to ChainedFilter &amp;amp; BooleanFilter, and instead deprecated the new finalResult method.  It&apos;s dangerous to just remove protected methods since on upgrading there will be no errors but, silently, the finalResult method will no longer be called.  I think in 3.0 when we remove these methods, rather than simply removing them we should actually mark them final such that any subclasses still using them will see hard compilation errors.&lt;/p&gt;

&lt;p&gt;Can you look over the new patch?&lt;/p&gt;</comment>
                    <comment id="12652081" author="paul.elschot@xs4all.nl" created="Mon, 1 Dec 2008 18:16:45 +0000"  >&lt;p&gt;Indeed it is better to be conservative about released things as in today&apos;s patch.&lt;/p&gt;</comment>
                    <comment id="12652092" author="mikemccand" created="Mon, 1 Dec 2008 18:51:46 +0000"  >&lt;p&gt;Committed revision 722174.&lt;/p&gt;

&lt;p&gt;Thanks Paul!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12383048" name="cachedFilter20080529.patch" size="6658" author="paul.elschot@xs4all.nl" created="Thu, 29 May 2008 21:20:19 +0100" />
                    <attachment id="12383438" name="cachedFilter20080605.patch" size="4246" author="paul.elschot@xs4all.nl" created="Thu, 5 Jun 2008 08:26:29 +0100" />
                    <attachment id="12394486" name="LUCENE-1296b.patch" size="3977" author="paul.elschot@xs4all.nl" created="Sat, 22 Nov 2008 13:47:00 +0000" />
                    <attachment id="12395017" name="LUCENE-1296.patch" size="3290" author="mikemccand" created="Mon, 1 Dec 2008 12:24:35 +0000" />
                    <attachment id="12394466" name="LUCENE-1296.patch" size="3373" author="paul.elschot@xs4all.nl" created="Fri, 21 Nov 2008 23:40:08 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 22 Oct 2008 20:56:05 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12452</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26432</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>