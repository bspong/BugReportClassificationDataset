<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:22:17 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1771/LUCENE-1771.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1771] Using explain may double ram reqs for fieldcaches when using ValueSourceQuery/CustomScoreQuery or for ConstantScoreQuerys that use a caching Filter.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1771</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description></description>
                <environment></environment>
            <key id="12431840">LUCENE-1771</key>
            <summary>Using explain may double ram reqs for fieldcaches when using ValueSourceQuery/CustomScoreQuery or for ConstantScoreQuerys that use a caching Filter.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jul 2009 21:46:05 +0100</created>
                <updated>Thu, 2 May 2013 03:29:21 +0100</updated>
                    <resolved>Wed, 12 Aug 2009 02:32:40 +0100</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12737288" author="markrmiller@gmail.com" created="Thu, 30 Jul 2009 22:08:53 +0100"  >&lt;p&gt;reminder to add warning for custom queries - you shouldn&apos;t use top level reader to access fieldcache values for explain&lt;/p&gt;</comment>
                    <comment id="12738102" author="markrmiller@gmail.com" created="Sun, 2 Aug 2009 18:44:34 +0100"  >&lt;p&gt;Current state of fix (being iterated on in the fieldcache introspection issue - will be fully spun over to this issue after its shaken out)&lt;/p&gt;</comment>
                    <comment id="12739106" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 20:13:32 +0100"  >&lt;p&gt;Unless there is an objection, and after another review, I will commit this soon.&lt;/p&gt;</comment>
                    <comment id="12739124" author="mikemccand" created="Tue, 4 Aug 2009 20:59:09 +0100"  >&lt;p&gt;I think we should change the approach here, based on Yonik&apos;s last suggestion on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1749&quot; title=&quot;FieldCache introspection API&quot;&gt;&lt;del&gt;LUCENE-1749&lt;/del&gt;&lt;/a&gt;, so that QueryWeight.explain receives &lt;b&gt;both&lt;/b&gt; the top-level Searcher and the sub-reader, with the docID pre-resolved to that sub-reader.  This way individual queries are not responsible for resolving to sub-readers.&lt;/p&gt;

&lt;p&gt;Actually, since QueryWeight is new in 2.9, we can simply make this change w/o deprecation.&lt;/p&gt;</comment>
                    <comment id="12739126" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:02:30 +0100"  >&lt;p&gt;okay, sounds good&lt;/p&gt;</comment>
                    <comment id="12739130" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:11:13 +0100"  >&lt;p&gt;searcher doesn&apos;t have access to numDocs (termqueryweight) at the moment ...&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;N/M - the IndexSearcher will have getIndexReader&lt;/p&gt;</comment>
                    <comment id="12739132" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 21:16:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;searcher doesn&apos;t have access to numDocs (termqueryweight) at the moment ... &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good... cause it&apos;s a bug and it shouldn&apos;t be using it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  When was that added?&lt;/p&gt;</comment>
                    <comment id="12739135" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:22:43 +0100"  >&lt;blockquote&gt;&lt;p&gt;Actually, since QueryWeight is new in 2.9, we can simply make this change w/o deprecation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We do have to be back compat with Weight though - ugg - so QueryWeight would somehow need to expose a deprecated working explain(IndexReader, int) ? ...&lt;br/&gt;
but if we could do that ...&lt;/p&gt;</comment>
                    <comment id="12739137" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 21:25:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;Good... cause it&apos;s a bug and it shouldn&apos;t be using it  When was that added?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tried out IntelliJ&apos;s &quot;show history for selection&quot; for the first time - cool stuff!&lt;br/&gt;
Anyway, the bug was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1066&quot; title=&quot;better explain output&quot;&gt;&lt;del&gt;LUCENE-1066&lt;/del&gt;&lt;/a&gt;, Nov-2007&lt;/p&gt;</comment>
                    <comment id="12739138" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 21:28:37 +0100"  >&lt;blockquote&gt;&lt;p&gt;We do have to be back compat with Weight though - ugg - so QueryWeight would somehow need to expose a deprecated working explain(IndexReader, int) ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;QueryWeight doesn&apos;t need a explain(IndexReader, int)... but perhaps implementations of explain(IndexReader, Searcher, int) do need to handle a null searcher.  And no, the &lt;b&gt;output&lt;/b&gt; of explain won&apos;t be 100% compatible (or 100% accurate) but we&apos;re too far down the road of per-segment searching, and too close to a release to fix that now IMO.&lt;/p&gt;</comment>
                    <comment id="12739145" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:37:30 +0100"  >&lt;p&gt;CustomScoreQuery has no access to the top level Searcher without docking it on the QueryWeight -&lt;/p&gt;

&lt;p&gt;    /*(non-Javadoc) @see org.apache.lucene.search.Scorer#explain(int) */&lt;br/&gt;
    public Explanation explain(int doc) throws IOException {&lt;br/&gt;
      Explanation subQueryExpl = weight.subQueryWeight.explain(null, reader,doc); // nocommit: needs resolution&lt;/p&gt;</comment>
                    <comment id="12739148" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:39:06 +0100"  >&lt;blockquote&gt;&lt;p&gt;QueryWeight doesn&apos;t need a explain(IndexReader, int)...&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Why not? QueryWeight implements Weight for back compat ...&lt;/p&gt;</comment>
                    <comment id="12739154" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 21:47:19 +0100"  >&lt;blockquote&gt;&lt;p&gt;Why not? QueryWeight implements Weight for back compat...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Couldn&apos;t QueryWeight just have the following default implementation?&lt;br/&gt;
 public Explanation explain(IndexReader reader, int doc) throws IOException &lt;/p&gt;
{
   explain(reader,doc,null);
 }

&lt;p&gt;And implementations would just need to be able to handle a null searcher (for now).&lt;/p&gt;</comment>
                    <comment id="12739160" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 21:57:50 +0100"  >&lt;p&gt;Yes - but then I think we have to use the top reader for that (impls already expect it) - so you could have double caching problems where Weight is still used. I think we will have to live with that though.&lt;/p&gt;</comment>
                    <comment id="12739166" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:08:12 +0100"  >&lt;blockquote&gt;&lt;p&gt;This way individual queries are not responsible for resolving to sub-readers.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;... so who is? The user I guess? The only place explain(IndexReader reader, int doc) appears to be called in Lucene code is with the customscore query. So with the current patch, you can call these methods and pass the top level reader like normal, but with this change, you have to get the subreader yourself.&lt;/p&gt;

&lt;p&gt;Also, the one internal place that  explain(IndexReader reader, int doc) is called (CustomScoreQuery) would have to pass null for the IndexSearcher.&lt;/p&gt;

&lt;p&gt;Something doesn&apos;t seem right with this stuff ...&lt;/p&gt;</comment>
                    <comment id="12739173" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 22:19:25 +0100"  >&lt;blockquote&gt;&lt;p&gt;.. so who is? (responsible for resolving to sub-readers)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I assumed IndexSearcher.explain().... which brings up another point... isn&apos;t a back-compat break too (since Weight is not a QueryWeight)?&lt;/p&gt;

&lt;p&gt;IndexSearcher.Explanation explain(QueryWeight weight, int doc) throws IOException;&lt;/p&gt;
</comment>
                    <comment id="12739182" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:30:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;which brings up another point... isn&apos;t a back-compat break too (since Weight is not a QueryWeight)? IndexSearcher.Explanation explain(QueryWeight weight, int doc) throws IOException;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;nice catch.&lt;/p&gt;

&lt;p&gt;Hmmm - so scorer.explain(doc) would need to be deprecated cause it would need to take a Searcher (too avoid putting it on QueryWeight) and the sub-reader - and again this would need to be solved (like the current patch) a Query at a time. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;And then there is somehow handling the back compat of that deprecation ...&lt;/p&gt;</comment>
                    <comment id="12739193" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:46:21 +0100"  >&lt;p&gt;Exploratory test patch&lt;/p&gt;</comment>
                    <comment id="12739194" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:47:41 +0100"  >&lt;p&gt;Ignore my previous comment - was missing the IndexSearcher call because it was still calling explain(reader,doc) rather than explain(searcher, reader, doc)&lt;/p&gt;</comment>
                    <comment id="12739195" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:50:55 +0100"  >&lt;p&gt;whoops - don&apos;t need to sub reader break out in boolean query&lt;/p&gt;</comment>
                    <comment id="12739203" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 23:06:46 +0100"  >&lt;p&gt;Okay - here is patch that should be good enough for evaluating this method.&lt;/p&gt;

&lt;p&gt;My scorer.explain concern was invalid because Mike deprecated it anyway, so I just moved that logic up a level, and now none of the searcher,reader stuff needs to be passed to it. IndexSearcher.explain now does the reader resolve.&lt;/p&gt;
</comment>
                    <comment id="12739208" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 23:13:41 +0100"  >&lt;p&gt;Too continue my JIRA spam on this issue:&lt;/p&gt;

&lt;p&gt;So the only way I can kind of get away with this without even more back compat issues is because back compat is already broken where it uses QueryWeight rather than Weight (as Yonik points out).&lt;/p&gt;</comment>
                    <comment id="12739216" author="mikemccand" created="Tue, 4 Aug 2009 23:23:26 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;searcher doesn&apos;t have access to numDocs (termqueryweight) at the moment ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good... cause it&apos;s a bug and it shouldn&apos;t be using it  When was that added?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m confused... why is that a bug?&lt;/p&gt;</comment>
                    <comment id="12739218" author="mikemccand" created="Tue, 4 Aug 2009 23:27:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;isn&apos;t a back-compat break too (since Weight is not a QueryWeight)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Searcher defines this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Explanation explain(Weight weight, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; doc) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; explain(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryWeightWrapper(weight), doc);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But, yes, QueryWeightWrapper will need to forward explain to the Weight, somehow.  This stuff is hard to think about!!&lt;/p&gt;</comment>
                    <comment id="12739222" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 23:38:36 +0100"  >&lt;p&gt;Ah right - the wrapper call is on Searcher - tricky.&lt;/p&gt;

&lt;p&gt;So one issue with the current patch is that the old weight impls will get a sub-reader and they should still get a top level reader.&lt;/p&gt;</comment>
                    <comment id="12739226" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 23:48:07 +0100"  >&lt;p&gt;Also the doc passed to explain from IndexSearcher needs to be de-based&lt;/p&gt;</comment>
                    <comment id="12739237" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 00:14:16 +0100"  >&lt;p&gt;with doc debase and top level reader to for weight explain&lt;/p&gt;</comment>
                    <comment id="12739298" author="yseeley@gmail.com" created="Wed, 5 Aug 2009 02:10:46 +0100"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m confused... why is that a bug?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Because it&apos;s maxDoc() not numDocs() that&apos;s used in the idf calculation... so if you tried to duplicate the idf calculation given the explain factors, it wouldn&apos;t match up for terms with deleted docs.&lt;/p&gt;</comment>
                    <comment id="12739384" author="mikemccand" created="Wed, 5 Aug 2009 10:10:15 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m confused... why is that a bug?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Because it&apos;s maxDoc() not numDocs() that&apos;s used in the idf calculation&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ahh, right.  Mark do you want to fold that fix into your next patch here?&lt;/p&gt;</comment>
                    <comment id="12739529" author="mikemccand" created="Wed, 5 Aug 2009 15:41:49 +0100"  >&lt;p&gt;Hmm... shouldn&apos;t explain take the top-level Searcher (not IndexSearcher)?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we have to use the top reader for that (impls already expect it) - so you could have double caching problems where Weight is still used. I think we will have to live with that though.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe instead we should simply throw an exception if QueryWeight.explain(IndexReader, int) is called, stating that the Query impl must instead implement the new explain (that takes the top-level Searcher)?  Would that be safer than risking accidental 2X mem usage due to a custom Query&apos;s explain?&lt;/p&gt;</comment>
                    <comment id="12739541" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 15:59:39 +0100"  >&lt;blockquote&gt;&lt;p&gt;Hmm... shouldn&apos;t explain take the top-level Searcher (not IndexSearcher)? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I can switch it - I only changed it to that to match the ability to get numDocs (by getting the IndexReader). If we fix that issue though, we don&apos;t need that and it can go back to Searcher.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe instead we should simply throw an exception if QueryWeight.explain(IndexReader, int) is called, stating that the Query impl must instead implement the new explain (that takes the top-level Searcher)? Would that be safer than risking accidental 2X mem usage due to a custom Query&apos;s explain?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And break back compat?! Yeah, that seems reasonable to me. Anyone else?&lt;/p&gt;</comment>
                    <comment id="12739547" author="mikemccand" created="Wed, 5 Aug 2009 16:04:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;And break back compat?! Yeah, that seems reasonable to me. Anyone else?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right.  Though, we&apos;d fix all core/contrib Query classes to cutover to the new API.  It&apos;d only be external (custom) Query impls that&apos;d hit this.  I think a hard break is better than a subtle and rather shocking &quot;my explain method just consumed XXX MB&quot; failure.&lt;/p&gt;</comment>
                    <comment id="12739550" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 16:06:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think a hard break is better than a subtle and rather shocking &quot;my explain method just consumed XXX MB&quot; failure.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I agreed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But shouldn&apos;t we just make it a compile time error? What if explain is part of their current apps code? Should we wait to blow up on them?&lt;/p&gt;</comment>
                    <comment id="12739561" author="mikemccand" created="Wed, 5 Aug 2009 16:14:12 +0100"  >&lt;blockquote&gt;&lt;p&gt;But shouldn&apos;t we just make it a compile time error?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, that&apos;s even better!&lt;/p&gt;</comment>
                    <comment id="12739741" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 21:52:34 +0100"  >&lt;p&gt;But it would imply that we merge QueryWeight back into Weight? That seems like the logical break ...&lt;/p&gt;</comment>
                    <comment id="12739776" author="mikemccand" created="Wed, 5 Aug 2009 22:49:59 +0100"  >&lt;p&gt;Hmm, Weight is an interface, which we are wanting to get away from.  We could simply change the explain in Weight to take the Searcher?  That&apos;d break compilation but let us keep the switch to abstract class QueryWeight?&lt;/p&gt;</comment>
                    <comment id="12739779" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 22:54:07 +0100"  >&lt;p&gt;That was my first consideration - but then I though, why not just make them switch to QueryWeight then? And then why not just make QueryWeight back to Weight (but abstract) - its not really much more work, and if you have to do work anyway, why not come all the way forward for a couple more lines?&lt;/p&gt;</comment>
                    <comment id="12739785" author="mikemccand" created="Wed, 5 Aug 2009 23:16:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;why not just make QueryWeight back to Weight (but abstract) &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK I think that&apos;s a good idea... so then the compilation errors a custom Query will see is 1) they have to change from &quot;implements Weight&quot; to &quot;extends Weight&quot;, and 2) they have to add the Searcher arg to explain (and fix their explain code so it expects a single segment w/ the IndexReader, and the top-level Searcher).&lt;/p&gt;

&lt;p&gt;Sheesh we&apos;re really pulling on the little string, here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12739853" author="markrmiller@gmail.com" created="Thu, 6 Aug 2009 02:05:38 +0100"  >&lt;p&gt;Here it is basically.&lt;/p&gt;

&lt;p&gt;Core tests pass, but oddly TestCompoundWordTokenFilter took a real long time in contrib.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testsuite: org.apache.lucene.analysis.compound.TestCompoundWordTokenFilter&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 4, Failures: 0, Errors: 0, Time elapsed: 195.028 sec&lt;/p&gt;

&lt;p&gt;Benchmark also was pretty slow. I&apos;m guessing because of autocommit. Similar symptoms.&lt;/p&gt;

&lt;p&gt;Perhaps my OS is messed up - would be odd though - fresh install from a week ago. Never noticed things being so slow before though. TestQualityRun is taking forever. So the benchmark thing could very well be an isolated issue.&lt;/p&gt;</comment>
                    <comment id="12739885" author="markrmiller@gmail.com" created="Thu, 6 Aug 2009 03:43:54 +0100"  >&lt;p&gt;Well nevermind - no auto commit in either of those. Looks like it was a network issue of some kind for downloading files. All of a sudden both are fast again, and when they were so slow, TestCompoundWordTokenFilter was hung up sun.net.www.http.KeepAliveCache.run(). Different issue, but had something of a similar look to it.&lt;/p&gt;</comment>
                    <comment id="12739894" author="rcmuir" created="Thu, 6 Aug 2009 04:46:11 +0100"  >&lt;p&gt;it looks like it is downloading files due to licensing constraints (it checks compounding against a german file that is under the LaTeX license).&lt;/p&gt;

&lt;p&gt;however that project has apache 2 licensed files for danish and italian so we can look at testing in one of those languages instead in the future, that way test data could simply be included?&lt;/p&gt;

&lt;p&gt;the test being slow/downloading files has confused me before as well.&lt;/p&gt;</comment>
                    <comment id="12739944" author="mikemccand" created="Thu, 6 Aug 2009 09:57:23 +0100"  >&lt;blockquote&gt;&lt;p&gt;however that project has apache 2 licensed files for danish and italian so we can look at testing in one of those languages instead in the future, that way test data could simply be included?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, this would be awesome&lt;/p&gt;

&lt;p&gt;In general I&apos;m wary of having our tests rely on external sites being available...&lt;/p&gt;

&lt;p&gt;TestCompoundWordTokenFilter frequently takes waaaay long for me, while it goes and downloads the test files.  We must be generating too much traffic by running our unit tests so much &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12739978" author="mikemccand" created="Thu, 6 Aug 2009 11:21:25 +0100"  >&lt;p&gt;Patch looks good Mark!  This is a nice cleanup (coming full circle, back to just Weight, again).&lt;/p&gt;

&lt;p&gt;You need to fix back-compat tests, too.&lt;/p&gt;</comment>
                    <comment id="12740334" author="hossman" created="Fri, 7 Aug 2009 01:50:59 +0100"  >&lt;p&gt;FWIW: the last patch was giving me compile errors because BoostingNearQuery still referenced the removed QueryWeight class.&lt;/p&gt;

&lt;p&gt;I think this is the correct fix.&lt;/p&gt;</comment>
                    <comment id="12740343" author="markrmiller@gmail.com" created="Fri, 7 Aug 2009 02:08:51 +0100"  >&lt;p&gt;Thanks - BoostingNearQuery was just added, so it wasn&apos;t around for the patch.&lt;/p&gt;</comment>
                    <comment id="12740351" author="markrmiller@gmail.com" created="Fri, 7 Aug 2009 02:22:07 +0100"  >&lt;p&gt;workarounds for the back compat test branch&lt;/p&gt;</comment>
                    <comment id="12740667" author="mikemccand" created="Fri, 7 Aug 2009 19:24:08 +0100"  >&lt;p&gt;Patch looks good!:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Looks like you need to &quot;svn rm&lt;br/&gt;
    src/java/org/apache/lucene/search/QueryWeight.java&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Some javadocs still reference QueryWeight&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Why do we need this in Weight?
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Explanation explain(IndexReader reader, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; doc) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; explain(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, reader, doc);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;    Ie, do we think there are places outside of Lucene that invoke&lt;br/&gt;
    Weight.explain directly?&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12740929" author="markrmiller@gmail.com" created="Sat, 8 Aug 2009 18:56:22 +0100"  >&lt;p&gt;The Changes for this one is kind of complicated ...&lt;/p&gt;</comment>
                    <comment id="12740996" author="markrmiller@gmail.com" created="Sun, 9 Aug 2009 00:43:47 +0100"  >&lt;p&gt;javadoc tweak/fix&lt;br/&gt;
removed explain(reader,doc)&lt;/p&gt;

&lt;p&gt;how to handle all of the previous change entries this affects ... ?&lt;/p&gt;</comment>
                    <comment id="12741011" author="markrmiller@gmail.com" created="Sun, 9 Aug 2009 03:32:54 +0100"  >&lt;p&gt;One last patch - fix/doc null weight.explain null searcher issue&lt;br/&gt;
remove a few unused imports&lt;/p&gt;</comment>
                    <comment id="12741132" author="mikemccand" created="Sun, 9 Aug 2009 20:35:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;how to handle all of the previous change entries this affects ... ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think they should all be fixed?&lt;/p&gt;

&lt;p&gt;Ie, the CHANGES.txt is something users can read to see what&apos;s changed since the last release, not the blow-by-blow account of the series of iterations we went through before releasing.&lt;/p&gt;</comment>
                    <comment id="12741654" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 02:14:29 +0100"  >&lt;p&gt;updates to apply to trunk and adds a stab at reconciling Changes&lt;/p&gt;</comment>
                    <comment id="12741656" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 02:20:31 +0100"  >&lt;p&gt;Hoss Man uses Chris Hostetter in Changes? Weak. I&apos;ll update it before committing.&lt;/p&gt;</comment>
                    <comment id="12741657" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 02:22:13 +0100"  >&lt;p&gt;I&apos;m going to give this one another day or two and then commit if nothing comes up.&lt;/p&gt;</comment>
                    <comment id="12742037" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 21:07:56 +0100"  >&lt;p&gt;I think the Changes entries could still use some polish.&lt;/p&gt;

&lt;p&gt;Here are the originals:&lt;/p&gt;

&lt;p&gt; 3. &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1630&quot; title=&quot;Mating Collector and Scorer on doc Id orderness&quot;&gt;&lt;del&gt;LUCENE-1630&lt;/del&gt;&lt;/a&gt;: Deprecate Weight in favor of QueryWeight: added&lt;br/&gt;
    matching methods to Searcher to take QueryWeight and deprecated&lt;br/&gt;
    those taking Weight.  If you have a Weight implementation, you can&lt;br/&gt;
    turn it into a QueryWeight with QueryWeightWrapper (will be&lt;br/&gt;
    removed in 3.0). All of the Weight-based methods were implemented&lt;br/&gt;
    by calling the QueryWeight variants by wrapping the given Weight.&lt;br/&gt;
    Going forward Searchable will be kept for convenience only and may&lt;br/&gt;
    be changed between minor releases without any deprecation&lt;br/&gt;
    process. It is not recommended to implement it, but rather extend&lt;br/&gt;
    Searcher.  (Shai Erera via Mike McCandless)&lt;/p&gt;

&lt;p&gt;24. &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1630&quot; title=&quot;Mating Collector and Scorer on doc Id orderness&quot;&gt;&lt;del&gt;LUCENE-1630&lt;/del&gt;&lt;/a&gt;: Deprecate Weight in favor of QueryWeight, which adds&lt;br/&gt;
    a scorer(IndexReader, boolean /* scoreDocsInOrder &lt;b&gt;/, boolean /&lt;/b&gt;&lt;br/&gt;
    topScorer */) method instead of scorer(IndexReader) (now&lt;br/&gt;
    deprecated). The new method is used by IndexSearcher to mate&lt;br/&gt;
    between Collector and Scorer orderness of doc IDs. Some Scorers&lt;br/&gt;
    (like BooleanScorer) are much more efficient if out-of-order&lt;br/&gt;
    documents scoring is allowed by a Collector.  Collector must now&lt;br/&gt;
    implement acceptsDocsOutOfOrder. If you write a Collector which&lt;br/&gt;
    does not care about doc ID orderness, it is recommended that you&lt;br/&gt;
    return true.  QueryWeight has the scoresDocsOutOfOrder method,&lt;br/&gt;
    which by default returns false.  If you create a QueryWeight which&lt;br/&gt;
    will score documents out of order if that&apos;s requested, you should&lt;br/&gt;
    override that method to return true.  Also deprecated&lt;br/&gt;
    BooleanQuery&apos;s setAllowDocsOutOfOrder and getAllowDocsOutOfOrder&lt;br/&gt;
    as they are not needed anymore. BooleanQuery will now score docs&lt;br/&gt;
    out of order when used with a Collector that can accept docs out&lt;br/&gt;
    of order. (Shai Erera via Mike McCandless)&lt;/p&gt;

&lt;p&gt;And I&apos;ve changed to:&lt;/p&gt;

&lt;p&gt; 3. &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1630&quot; title=&quot;Mating Collector and Scorer on doc Id orderness&quot;&gt;&lt;del&gt;LUCENE-1630&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1771&quot; title=&quot;Using explain may double ram reqs for fieldcaches when using ValueSourceQuery/CustomScoreQuery or for ConstantScoreQuerys that use a caching Filter.&quot;&gt;&lt;del&gt;LUCENE-1771&lt;/del&gt;&lt;/a&gt;: Weight, previously an interface, is now an abstract &lt;br/&gt;
    class. Some of the method signatures have changed, but it should be fairly&lt;br/&gt;
    easy to see what adjustments must be made to existing code to sync up&lt;br/&gt;
    with the new API. You can find more detail in the API Changes section.&lt;/p&gt;

&lt;p&gt;    Going forward Searchable will be kept for convenience only and may&lt;br/&gt;
    be changed between minor releases without any deprecation&lt;br/&gt;
    process. It is not recommended that you implement it, but rather extend&lt;br/&gt;
    Searcher.  (Shai Erera, Chris Hostetter, Mark Miller via Mike McCandless)&lt;/p&gt;

&lt;p&gt;24. &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1630&quot; title=&quot;Mating Collector and Scorer on doc Id orderness&quot;&gt;&lt;del&gt;LUCENE-1630&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1771&quot; title=&quot;Using explain may double ram reqs for fieldcaches when using ValueSourceQuery/CustomScoreQuery or for ConstantScoreQuerys that use a caching Filter.&quot;&gt;&lt;del&gt;LUCENE-1771&lt;/del&gt;&lt;/a&gt;: Weight is now an abstract class, andd adds&lt;br/&gt;
    a scorer(IndexReader, boolean /* scoreDocsInOrder &lt;b&gt;/, boolean /&lt;/b&gt;&lt;br/&gt;
    topScorer */) method instead of scorer(IndexReader). The new method &lt;br/&gt;
    is used by IndexSearcher to mate Collector and Scorer orderness &lt;br/&gt;
    of doc IDs. Some Scorers (like BooleanScorer) are much more efficient &lt;br/&gt;
    if out-of-order documents scoring is allowed by a Collector.  Collector &lt;br/&gt;
    must now implement acceptsDocsOutOfOrder. If you write a Collector &lt;br/&gt;
    which does not care about doc ID orderness, it is recommended that you&lt;br/&gt;
    return true.  Weight has a scoresDocsOutOfOrder method, which by default &lt;br/&gt;
    returns false.  If you create a Weight which will score documents out of&lt;br/&gt;
    order if requested, you should override that method to return true. &lt;br/&gt;
    BooleanQuery&apos;s setAllowDocsOutOfOrder and getAllowDocsOutOfOrder have &lt;br/&gt;
    been deprecated as they are not needed anymore. BooleanQuery will now &lt;br/&gt;
    score docs out of order when used with a Collector that can accept docs &lt;br/&gt;
    out of order. Finally, Weight#explain now also takes a Searcher.&lt;br/&gt;
    (Shai Erera, Chris Hostetter, Mark Miller via Mike McCandless)&lt;/p&gt;

&lt;p&gt;So one thing I don&apos;t like is &lt;blockquote&gt;&lt;p&gt; The new method is used by IndexSearcher to mate Collector and Scorer orderness of doc IDs. &lt;/p&gt;&lt;/blockquote&gt; I know what it means, but its a bit vague and awkward. I&apos;m not sure how to best rewrite it though.&lt;/p&gt;

&lt;p&gt;Also, while the entry talks a lot about the orderedIds param, it doesn&apos;t really mention the topScorer param. I&apos;m still not 100% clear on it after looking at the javadocs either (without looking at the code). I don&apos;t think top scorer can be defined using primarily the term top scorer - it might as well be the omega scorer unless you can point me to the Lucene dictionary where I can look it up:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  * @param topScorer
   *          specifies whether the returned {@link Scorer} will be used as a
   *          top scorer or as in iterator. I.e., &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
   *          {@link Scorer#score(Collector)} will be called; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
   *          {@link Scorer#nextDoc()} and/or {@link Scorer#advance(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)} will
   *          be called.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I still want to beef up these changes a bit, and I think the javadoc needs to be a bit more clear - as we don&apos;t provide a convenience method that chooses defaults for those params, it should be very easy to quickly figure out whats best to pass. Right now, its just a little less than clear without some code browsing.&lt;/p&gt;</comment>
                    <comment id="12742051" author="mikemccand" created="Tue, 11 Aug 2009 21:40:45 +0100"  >&lt;p&gt;Maybe say &quot;Weight#explain now takes the top-level searcher, sub-reader and sub-docID&quot;?&lt;/p&gt;

&lt;p&gt;Also there&apos;s a small typo (andd -&amp;gt; and).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;So one thing I don&apos;t like is&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The new method is used by IndexSearcher to mate Collector and Scorer orderness of doc IDs.&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;

&lt;p&gt;How about &quot;IndexSearcher uses this method to obtain a scorer matching the capabilities of the Collector wrt orderness of docIDs&quot;?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, while the entry talks a lot about the orderedIds param, it doesn&apos;t really mention the topScorer param&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about simply removing the first sentence, ie, just jump straight into &quot;if true...&quot;?&lt;/p&gt;</comment>
                    <comment id="12742063" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 22:19:55 +0100"  >&lt;p&gt;Okay - just ran the tests one more time and looked over everything. I&apos;m going to commit this later tonight unless anything comes up.&lt;/p&gt;</comment>
                    <comment id="12742171" author="markrmiller@gmail.com" created="Wed, 12 Aug 2009 02:32:40 +0100"  >&lt;p&gt;committed - thanks all!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12424750">LUCENE-1630</issuekey>
        </issuelink>
                    </outwardlinks>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12433243">LUCENE-1818</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12433681">LUCENE-1837</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                        <issuelinktype id="10001">
                <name>dependent</name>
                                                <inwardlinks description="is depended upon by">
                            <issuelink>
            <issuekey id="12430699">LUCENE-1749</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12415803" name="LUCENE-1771.bc-tests.patch" size="21486" author="markrmiller@gmail.com" created="Fri, 7 Aug 2009 02:22:07 +0100" />
                    <attachment id="12416148" name="LUCENE-1771.patch" size="96645" author="markrmiller@gmail.com" created="Tue, 11 Aug 2009 02:14:29 +0100" />
                    <attachment id="12415976" name="LUCENE-1771.patch" size="92507" author="markrmiller@gmail.com" created="Sun, 9 Aug 2009 03:32:54 +0100" />
                    <attachment id="12415972" name="LUCENE-1771.patch" size="93081" author="markrmiller@gmail.com" created="Sun, 9 Aug 2009 00:43:47 +0100" />
                    <attachment id="12415800" name="LUCENE-1771.patch" size="84521" author="hossman" created="Fri, 7 Aug 2009 01:50:59 +0100" />
                    <attachment id="12415684" name="LUCENE-1771.patch" size="89107" author="markrmiller@gmail.com" created="Thu, 6 Aug 2009 02:05:38 +0100" />
                    <attachment id="12415542" name="LUCENE-1771.patch" size="22830" author="markrmiller@gmail.com" created="Wed, 5 Aug 2009 00:14:16 +0100" />
                    <attachment id="12415532" name="LUCENE-1771.patch" size="22270" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 23:04:15 +0100" />
                    <attachment id="12415530" name="LUCENE-1771.patch" size="20623" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 22:52:38 +0100" />
                    <attachment id="12415288" name="LUCENE-1771.patch" size="10408" author="markrmiller@gmail.com" created="Sun, 2 Aug 2009 18:44:34 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 4 Aug 2009 19:59:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11991</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25955</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>