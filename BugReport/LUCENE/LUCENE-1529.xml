<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1529/LUCENE-1529.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1529] back-compat tests (&quot;ant test-tag&quot;) should test JAR drop-in-ability</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1529</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>
&lt;p&gt;We now test back-compat with &quot;ant test-tag&quot;, which is very useful for&lt;br/&gt;
catching breaks in back compat before committing.&lt;/p&gt;

&lt;p&gt;However, that currently checks out &quot;src/test&quot; sources and then&lt;br/&gt;
compiles them against the trunk JAR, and runs the tests.  Whereas our&lt;br/&gt;
back compat policy:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://wiki.apache.org/lucene-java/BackwardsCompatibility&quot; class=&quot;external-link&quot;&gt;http://wiki.apache.org/lucene-java/BackwardsCompatibility&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;states that no recompilation is required on upgrading to a new JAR.&lt;br/&gt;
Ie you should be able to drop in the new JAR in place of your old one&lt;br/&gt;
and things should work fine.&lt;/p&gt;

&lt;p&gt;So... we should fix &quot;ant test-tag&quot; to:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Do full checkout of core sources &amp;amp; tests from the back-compat-tag&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Compile the JAR from the back-compat sources&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Compile the tests against that back-compat JAR&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Swap in the trunk JAR&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Run the tests&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
            <key id="12413257">LUCENE-1529</key>
            <summary>back-compat tests (&quot;ant test-tag&quot;) should test JAR drop-in-ability</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="michaelbusch">Michael Busch</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jan 2009 13:40:19 +0000</created>
                <updated>Fri, 25 Sep 2009 17:23:18 +0100</updated>
                    <resolved>Tue, 14 Apr 2009 22:19:57 +0100</resolved>
                            <version>2.9</version>
                                <fixVersion>2.9</fixVersion>
                                <component>general/build</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12683611" author="michaelbusch" created="Thu, 19 Mar 2009 20:59:30 +0000"  >&lt;p&gt;Changes &apos;test-tag&apos; in build.xml to executes the compatibility tests like Mike described here.&lt;/p&gt;</comment>
                    <comment id="12683798" author="michaelbusch" created="Fri, 20 Mar 2009 08:47:55 +0000"  >&lt;p&gt;Committed revision 756374.&lt;/p&gt;</comment>
                    <comment id="12698799" author="mikemccand" created="Tue, 14 Apr 2009 16:12:54 +0100"  >&lt;p&gt;I think something is wrong with this fix.  Over in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1593&quot; title=&quot;Optimizations to TopScoreDocCollector and TopFieldCollector&quot;&gt;&lt;del&gt;LUCENE-1593&lt;/del&gt;&lt;/a&gt; we hit a case where (I think) the test should have failed, because we changed a method from returning void to returning something else.&lt;/p&gt;

&lt;p&gt;EG if you change IndexWriter.addDocument to (say) return int instead of void, then I think ant test-tag should fail, but it doesn&apos;t.&lt;/p&gt;</comment>
                    <comment id="12698907" author="shaie" created="Tue, 14 Apr 2009 21:12:26 +0100"  >&lt;p&gt;Perhaps that&apos;s related: target test-tag has this step:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	  &amp;lt;!-- compile tag tests against tag jar --&amp;gt;	
	  &amp;lt;compile-test-macro srcdir=&lt;span class=&quot;code-quote&quot;&gt;&quot;${tags.dir}/${tag}/src/test&quot;&lt;/span&gt; destdir=&lt;span class=&quot;code-quote&quot;&gt;&quot;${build.dir}/${tag}/classes/test&quot;&lt;/span&gt;
			  			  test.classpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;tag.test.classpath&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that test.classpath is set to tag.test.classpath, which is defined as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;path id=&lt;span class=&quot;code-quote&quot;&gt;&quot;tag.test.classpath&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;path refid=&lt;span class=&quot;code-quote&quot;&gt;&quot;demo.classpath&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;path refid=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit-path&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;pathelement location=&lt;span class=&quot;code-quote&quot;&gt;&quot;${build.dir}/${tag}/classes/test&quot;&lt;/span&gt;/&amp;gt;
  	&amp;lt;pathelement location=&lt;span class=&quot;code-quote&quot;&gt;&quot;${build.dir}/${tag}/${tag}.jar&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/path&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&quot;demo.classpath&quot; includes build/classes/demo as well as build/classes/java, which includes the current trunk&apos;s build classes.&lt;/p&gt;

&lt;p&gt;If I change the definition to rely only on tag.jar, demo classes and junit jar:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;path id=&lt;span class=&quot;code-quote&quot;&gt;&quot;tag.test.classpath&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;path refid=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit-path&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;pathelement location=&lt;span class=&quot;code-quote&quot;&gt;&quot;${build.dir}/classes/demo&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;pathelement location=&lt;span class=&quot;code-quote&quot;&gt;&quot;${build.dir}/${tag}/${tag}.jar&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/path&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get errors like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [javac] Compiling 128 source files to D:\dev\lucene\lucene-trunk\build\lucene_2_4_back_compat_tests_20090320\classes\test
    [javac] D:\dev\lucene\lucene-trunk\tags\lucene_2_4_back_compat_tests_20090320\src\test\org\apache\lucene\index\TestIndexReaderReopen.java:323: cannot find symbol
    [javac] symbol  : method getSequentialSubReaders()
    [javac] location: class org.apache.lucene.index.MultiSegmentReader
    [javac]       IndexReader[] subReaders0 = ((MultiSegmentReader) reader0).getSequentialSubReaders();
    [javac]                                   ^
    [javac] D:\dev\lucene\lucene-trunk\tags\lucene_2_4_back_compat_tests_20090320\src\test\org\apache\lucene\index\TestIndexReaderReopen.java:335: cannot find symbol
    [javac] symbol  : method getSequentialSubReaders()
    [javac] location: class org.apache.lucene.index.MultiSegmentReader
    [javac]       IndexReader[] subReaders1 = ((MultiSegmentReader) reader1).getSequentialSubReaders();
    [javac]                                   ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s because tag.jar&apos;s MultiSegmentReader does not have a getSequentialSubReaders method, however TestIndexReaderReopen calls it. Is that ok?&lt;/p&gt;

&lt;p&gt;Anyway, can it be that the classes/java in the classpath cause this change to not fail?&lt;/p&gt;</comment>
                    <comment id="12698932" author="mikemccand" created="Tue, 14 Apr 2009 22:07:16 +0100"  >&lt;blockquote&gt;&lt;p&gt;If I change the definition to rely only on tag.jar, demo classes and junit jar:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ooh that&apos;s good progress!&lt;/p&gt;

&lt;p&gt;Hmm, yes we will now see compilation errors because over time we&apos;ve made &quot;legal&quot; fixes to the test source code, corresponding to changes in 2.9.  Eg, since FieldInfo is package private, we&apos;re allowed to rename omitTf to OmitTermFreqAndPositions, and if a test (TestOmitTf) is using package-private access to access omitTf, it&apos;s OK to fix that test to match the new name.&lt;/p&gt;

&lt;p&gt;So I think the only way to make &quot;legal&quot; changes to the back-compat tests is to backport &lt;span class=&quot;error&quot;&gt;&amp;#91;a subset of, or perhaps compile-time emulation of&amp;#93;&lt;/span&gt; the 2.9 changes onto the 2.4 branch src/java/*.  Or, to fix tests not to rely on package private APIs.  I think that&apos;s OK (we make such changes rarely)?  I&apos;ll go and fix the back-compat branch accordingly...&lt;/p&gt;</comment>
                    <comment id="12698941" author="mikemccand" created="Tue, 14 Apr 2009 22:19:57 +0100"  >&lt;p&gt;OK I think it&apos;s all fixed now.  Thanks Shai!&lt;/p&gt;</comment>
                    <comment id="12699012" author="michaelbusch" created="Wed, 15 Apr 2009 02:16:11 +0100"  >&lt;p&gt;Good catch! Thanks for fixing this, Shai and Mike!&lt;/p&gt;</comment>
                    <comment id="12699030" author="shaie" created="Wed, 15 Apr 2009 03:27:44 +0100"  >&lt;p&gt;Mike - you &apos;almost&apos; fixed it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I &quot;ant clean test-tag&quot; and still sees failures. So I checked and common-build.xml still references lucene_2_4_back_compat_tests_20090320. I do see your changes on the lucene_2_4_back_compat_tests branch, but you didn&apos;t tag those changes?&lt;/p&gt;

&lt;p&gt;We can either move to checkout this code from the branch (thus preventing such issues in the future), in build.xml target=download-tag, or tag the changes and update common-build.xml.&lt;/p&gt;</comment>
                    <comment id="12699177" author="mikemccand" created="Wed, 15 Apr 2009 13:58:02 +0100"  >&lt;p&gt;Yes, indeed &amp;#8211; should be fixed now (I retagged it).  We can&apos;t change it to checkout the branch since people with older checkouts will suddenly see the the back-compat tests failing.  That&apos;s why we switched to a tag a while back.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12402602" name="lucene-1529.patch" size="3451" author="michaelbusch" created="Thu, 19 Mar 2009 20:59:30 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 19 Mar 2009 20:59:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12224</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26200</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>