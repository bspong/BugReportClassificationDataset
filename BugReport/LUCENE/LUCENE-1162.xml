<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:32:05 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1162/LUCENE-1162.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1162] Improve architecture of FieldSortedHitQueue</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1162</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Per the discussion (quite some time ago) on issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-806&quot; title=&quot;Synchronization bottleneck in FieldSortedHitQueue with many concurrent readers&quot;&gt;&lt;del&gt;LUCENE-806&lt;/del&gt;&lt;/a&gt;, I&apos;d like to propose an architecture change to the way FieldSortedHitQueue works, and in particular the way it creates SortComparatorSources. I think (I hope) that anyone who looks at the FSHQ code will agree that the class does a lot and much of it&apos;s repetitive stuff that really has no business being in that class.&lt;/p&gt;

&lt;p&gt;I am about to attach a patch which, in and of itself, doesn&apos;t really achieve much that&apos;s concrete but does tidy things up a great deal and makes it easier to plug in different behaviours. I then have a subsequent patch which provides a fairly simple and flexible example of how you might replace an implementation, in this case the field-local-String-comparator version from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-806&quot; title=&quot;Synchronization bottleneck in FieldSortedHitQueue with many concurrent readers&quot;&gt;&lt;del&gt;LUCENE-806&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The downside to this patch is that it involved changing the signature of SortComparatorSource.newComparator to take a Locale. There would be ways around this (letting FieldSortedHitQueue take in either a SortComparatorSource or some new, improved interface which takes a Locale (and possibly extends SortComparatorSource). I&apos;m open to this but personally I think that the Locale version makes sense and would suggest that the code would be nicer by breaking the API (and hence targeting this to, presumably, 3.0 at a minimum).&lt;/p&gt;

&lt;p&gt;This code does not include specific tests (I will add these, if people like the general idea I&apos;m proposing here) but all current tests pass with this change.&lt;/p&gt;

&lt;p&gt;Patch to follow.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12387458">LUCENE-1162</key>
            <summary>Improve architecture of FieldSortedHitQueue</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="pcowan">Paul Cowan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2008 10:08:30 +0000</created>
                <updated>Sat, 25 Apr 2009 14:52:42 +0100</updated>
                    <resolved>Sat, 25 Apr 2009 14:52:42 +0100</resolved>
                            <version>2.3</version>
                                                <component>core/query/scoring</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12563935" author="pcowan" created="Wed, 30 Jan 2008 10:12:12 +0000"  >&lt;p&gt;Attached lucene-fshq-restructure.patch &amp;#8211; this cleans up the architecture of FSHQ with no real functional changes. Example of how this might be used for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-806&quot; title=&quot;Synchronization bottleneck in FieldSortedHitQueue with many concurrent readers&quot;&gt;&lt;del&gt;LUCENE-806&lt;/del&gt;&lt;/a&gt; to follow.&lt;/p&gt;</comment>
                    <comment id="12563936" author="pcowan" created="Wed, 30 Jan 2008 10:16:40 +0000"  >&lt;p&gt;Attaching patch (lucene-threadlocal.patch) which serves as an example for how the previous patch might be built-upon to provide improvements or pluggable functionality. This is a fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-806&quot; title=&quot;Synchronization bottleneck in FieldSortedHitQueue with many concurrent readers&quot;&gt;&lt;del&gt;LUCENE-806&lt;/del&gt;&lt;/a&gt; (the need to use ThreadLocal Comparators for sorting performance); it provides a replacement implementation of StringComparatorSource. Enabling this functionality would be as simple as:&lt;br/&gt;
  FieldSortedHitQueue.registerComparatorSource(SortField.STRING, new ThreadLocalStringComparatorSource());&lt;br/&gt;
and the new behaviour would kick in, relatively seamlessly.&lt;/p&gt;

&lt;p&gt;Note that this patch includes a new version of StringComparatorSource, which replaces the one from the previous patch.&lt;/p&gt;

&lt;p&gt;I will attach this to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-806&quot; title=&quot;Synchronization bottleneck in FieldSortedHitQueue with many concurrent readers&quot;&gt;&lt;del&gt;LUCENE-806&lt;/del&gt;&lt;/a&gt; as well for discussion on that end.&lt;/p&gt;</comment>
                    <comment id="12702699" author="markrmiller@gmail.com" created="Sat, 25 Apr 2009 14:52:42 +0100"  >&lt;p&gt;this class is deprecated&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12363067">LUCENE-806</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12374358" name="lucene-fshq-restructure.patch" size="35432" author="pcowan" created="Wed, 30 Jan 2008 10:12:12 +0000" />
                    <attachment id="12374359" name="lucene-threadlocal.patch" size="6204" author="pcowan" created="Wed, 30 Jan 2008 10:16:40 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 25 Apr 2009 13:52:42 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12582</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26567</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>