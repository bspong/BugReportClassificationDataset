<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:33:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3539/LUCENE-3539.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3539] IndexFormatTooOld/NewExc should try to include fileName + directory when possible</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3539</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;(Spinoff from &lt;a href=&quot;http://markmail.org/thread/t6s7nn3ve765nojc&quot; class=&quot;external-link&quot;&gt;http://markmail.org/thread/t6s7nn3ve765nojc&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;When we throw a too old/new exc we should try to include the full path to the offending file, if possible.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12529144">LUCENE-3539</key>
            <summary>IndexFormatTooOld/NewExc should try to include fileName + directory when possible</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Oct 2011 22:16:17 +0100</created>
                <updated>Sun, 27 Nov 2011 12:29:30 +0000</updated>
                    <resolved>Fri, 4 Nov 2011 18:54:27 +0000</resolved>
                                            <fixVersion>3.5</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13138207" author="mikemccand" created="Fri, 28 Oct 2011 11:30:59 +0100"  >&lt;p&gt;Patch.  I now pass DataInput down to IndexFormatTooNew/OldExc, and&lt;br/&gt;
.toString() it, and impl&apos;d .toString in the all the IndexInput impls I&lt;br/&gt;
could find.&lt;/p&gt;</comment>
                    <comment id="13138303" author="rcmuir" created="Fri, 28 Oct 2011 14:03:30 +0100"  >&lt;p&gt;I dont think i like all the duplication/extra tracking in every indexinput impl... &lt;/p&gt;

&lt;p&gt;In my opinion its not worth it!&lt;/p&gt;

&lt;p&gt;can this be done in a cleaner way?&lt;/p&gt;</comment>
                    <comment id="13138314" author="thetaphi" created="Fri, 28 Oct 2011 14:12:17 +0100"  >&lt;p&gt;I agree with Robert, adding this to IndexInput is stupid.&lt;/p&gt;

&lt;p&gt;I think, only adding the file name as done before should be fine. There are only few places where we pass null as file name to the exception (whoch may be fixed). Passing the whole directory name is in my opinion useless. Its up to the implementation using lucene to keep track of its directory name (when it opens a IndexReader it already knows its dir name).&lt;/p&gt;

&lt;p&gt;I would close this as won&apos;t fix and maybe only fix the remaining places that misses the file name (e.g. SegmentTermsEnumReader).&lt;/p&gt;</comment>
                    <comment id="13138322" author="rcmuir" created="Fri, 28 Oct 2011 14:14:10 +0100"  >&lt;p&gt;you might be able to work me down to a partial path rather than a full path...&lt;/p&gt;

&lt;p&gt;like if IndexInput takes String name in its ctor (the same one passed to Directory.openInput &lt;b&gt;NOT&lt;/b&gt; the full path, keeps String as a private variable), and implements toString itself.&lt;/p&gt;

&lt;p&gt;then we wouldnt have to track additional variables in each indexinput impl, only change openinput and the ctors to pass this information.&lt;/p&gt;

&lt;p&gt;But i&apos;m still not sure how useful this is. &lt;/p&gt;

&lt;p&gt;It really seems like an implementation detail that we check the stored fields to determine if an indexformat is too old. who cares what the file name is?&lt;/p&gt;</comment>
                    <comment id="13138694" author="rcmuir" created="Fri, 28 Oct 2011 20:54:40 +0100"  >&lt;p&gt;Some more thoughts:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;maybe IndexInput should have a ctor like IndexInput(String resourceDescription)&lt;/li&gt;
	&lt;li&gt;then, in &lt;b&gt;all&lt;/b&gt; error messages (e.g. read past EOF) we could include this, for better error descriptions&lt;/li&gt;
	&lt;li&gt;when directories call openInput they could pass whatever they want (e.g. filename), and CFS could include the &quot;real&quot; file within cfs&lt;/li&gt;
	&lt;li&gt;we could declare this as just an opaque string describing the indexinput (yeah and II could use it in its toString() as well)&lt;/li&gt;
	&lt;li&gt;if we do this, i think it should be non-null (e.g. in 3.x we add no-arg ctor that forwards to &quot;no additional details&quot; or whatever)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we did it consistently like this, i think it could improve error messages and debugging and be a pretty clean change.&lt;/p&gt;</comment>
                    <comment id="13139181" author="mikemccand" created="Sat, 29 Oct 2011 11:42:53 +0100"  >&lt;p&gt;+1, I like that solution, Robert.  I&apos;ll rework the patch...&lt;/p&gt;</comment>
                    <comment id="13141791" author="mikemccand" created="Wed, 2 Nov 2011 00:11:32 +0000"  >&lt;p&gt;New patch folding in Robert&apos;s idea....&lt;/p&gt;

&lt;p&gt;I added final String resourceDescription to II, returned from&lt;br/&gt;
toString, made it required arg to the ctor, and fix all II subclasses&lt;br/&gt;
to pass something reasonable.&lt;/p&gt;

&lt;p&gt;When our II impls originate an exception (eg from EOF), I also include&lt;br/&gt;
II.toString(); if a method they call throws IOE (eg file.read(...)&lt;br/&gt;
inside SimpleFSII), then I catch &amp;amp; rethrow w/ II.toString() included.&lt;/p&gt;

&lt;p&gt;I also include the sub-file name when inside a sliced II (CFS/CFX);&lt;br/&gt;
I added a required arg (sliceDescription) to the sliceInput method&lt;br/&gt;
for this.&lt;/p&gt;</comment>
                    <comment id="13143317" author="rcmuir" created="Thu, 3 Nov 2011 17:02:12 +0000"  >&lt;p&gt;Patch looks good, only one minor idea for improvement:&lt;/p&gt;

&lt;p&gt;When we throw &quot;read past EOF&quot; I think we should throw java.io.EOFException (extends IOException) rather than a generic one?&lt;/p&gt;</comment>
                    <comment id="13143329" author="mikemccand" created="Thu, 3 Nov 2011 17:18:22 +0000"  >&lt;p&gt;OK, new patch; I changed to EOFE, and I just use in.toString() instead of special casing DI vs II.&lt;/p&gt;

&lt;p&gt;I think it&apos;s ready!&lt;/p&gt;</comment>
                    <comment id="13144395" author="simonw" created="Fri, 4 Nov 2011 22:06:01 +0000"  >&lt;p&gt;mike can we close &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3138&quot; title=&quot;IW.addIndexes should fail fast if an index is too old/new&quot;&gt;LUCENE-3138&lt;/a&gt; too?&lt;/p&gt;</comment>
                    <comment id="13144767" author="mikemccand" created="Sat, 5 Nov 2011 17:59:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;mike can we close &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3138&quot; title=&quot;IW.addIndexes should fail fast if an index is too old/new&quot;&gt;LUCENE-3138&lt;/a&gt; too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm I don&apos;t think so.  It&apos;s unrelated to my fixes here?  Here I just &quot;improved&quot; the error message you see when you get an IOE, CorruptIndexE, IndexFormatTooXE out of Lucene.&lt;/p&gt;</comment>
                    <comment id="13157779" author="thetaphi" created="Sun, 27 Nov 2011 12:29:30 +0000"  >&lt;p&gt;Bulk close after release of 3.5&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12502179" name="LUCENE-3539.patch" size="46315" author="mikemccand" created="Thu, 3 Nov 2011 17:18:22 +0000" />
                    <attachment id="12501881" name="LUCENE-3539.patch" size="46117" author="mikemccand" created="Wed, 2 Nov 2011 00:11:32 +0000" />
                    <attachment id="12501269" name="LUCENE-3539.patch" size="28222" author="mikemccand" created="Fri, 28 Oct 2011 11:30:59 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 28 Oct 2011 13:03:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>215005</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24158</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>