<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:44 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1095/LUCENE-1095.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1095] StopFilter should have option to incr positionIncrement after stop word</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1095</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I&apos;ve seen this come up on the mailing list a few times in the last month, so i&apos;m filing a known bug/improvement arround it...&lt;/p&gt;

&lt;p&gt;StopFilter should have an option that if set, records how many stop words are &quot;skipped&quot; in a row, and then sets that value as the positionIncrement on the &quot;next&quot; token that StopFilter does return.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12384902">LUCENE-1095</key>
            <summary>StopFilter should have option to incr positionIncrement after stop word</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="doronc">Doron Cohen</assignee>
                                <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Dec 2007 20:03:25 +0000</created>
                <updated>Mon, 31 Dec 2007 08:29:07 +0000</updated>
                    <resolved>Mon, 31 Dec 2007 08:29:07 +0000</resolved>
                                                                    <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12552901" author="steve_rowe" created="Tue, 18 Dec 2007 21:12:34 +0000"  >&lt;p&gt;From &amp;lt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200510.mbox/%3c435D44FA.6050702@syr.edu%3e&quot; class=&quot;external-link&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200510.mbox/%3c435D44FA.6050702@syr.edu%3e&lt;/a&gt;&amp;gt;:&lt;/p&gt;

&lt;p&gt;A patch implementing this approach was actually applied to &lt;br/&gt;
StopFilter.java in late 2003, but was reverted shortly afterward, &lt;br/&gt;
because this approach conflicts with the QueryParser and PhraseQuery &lt;br/&gt;
implementations.&lt;/p&gt;

&lt;p&gt;See Doug Cutting&apos;s description of the problem with the position &lt;br/&gt;
increment modification approach here:&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-java-dev/200312.mbox/%3c3FCFB3CA.9000103@lucene.com%3e&quot; class=&quot;external-link&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-java-dev/200312.mbox/%3c3FCFB3CA.9000103@lucene.com%3e&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;See a colored diff of StopFilter.java, just before and after the &lt;br/&gt;
position increment modification patch was reverted, here:&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/lucene/java/trunk/src/java/org/apache/lucene/analysis/StopFilter.java?rev=150152&amp;amp;r1=150150&amp;amp;r2=150152&amp;amp;diff_format=h&quot; class=&quot;external-link&quot;&gt;http://svn.apache.org/viewcvs.cgi/lucene/java/trunk/src/java/org/apache/lucene/analysis/StopFilter.java?rev=150152&amp;amp;r1=150150&amp;amp;r2=150152&amp;amp;diff_format=h&lt;/a&gt;&amp;gt;&lt;/p&gt;</comment>
                    <comment id="12552903" author="doronc" created="Tue, 18 Dec 2007 21:29:08 +0000"  >&lt;p&gt;The problem Doug refers to is the effect of this on a Phrase Query.&lt;br/&gt;
I believe that if same analyzer with same stop filter and same option enables is used at search, the PhrasePositions would reflect the same increments due to stop word removals, and so phrase search should work. &lt;br/&gt;
I didn&apos;t  check this though.&lt;br/&gt;
To be also verified for Span Queries.&lt;/p&gt;</comment>
                    <comment id="12552905" author="ehatcher" created="Tue, 18 Dec 2007 21:40:30 +0000"  >&lt;p&gt;I believe QueryParser has been fixed since that first change I made mentioned by Steven to account for positions returned from an Analyzer.    So maybe all is well with fixing StopFilter now.  Unit tests needed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12552906" author="hossman" created="Tue, 18 Dec 2007 21:42:29 +0000"  >&lt;p&gt;I knew there must have been a good reason why it hadn&apos;t been done before, but there are some distinctions between then and now:&lt;/p&gt;

&lt;p&gt;1) then the position incrementing wasn&apos;t optional, i wouldn&apos;t suggest making that some change, just making it easier for people who want to do this without having to write an entirely new Filter.&lt;/p&gt;

&lt;p&gt;2) now PhraseQuery actually supports the notion of relative positions, so people can do the kind of thing Doug was talking about in the email you linked to ... but i won&apos;t go so far as to suggest we should make those changes by default in the QueryParser &lt;/p&gt;</comment>
                    <comment id="12552911" author="doronc" created="Tue, 18 Dec 2007 22:18:56 +0000"  >&lt;p&gt;I checked further. &lt;/p&gt;

&lt;p&gt;Query parser currently ignores the position increment - it is calling PhraseQuery.add(Term) rather than add(Term,position). &lt;/p&gt;

&lt;p&gt;So without changing this - either by default or optionally - the whole thing will not work. &lt;/p&gt;

&lt;p&gt;(I think current QP behavior is wrong in this regard.)&lt;br/&gt;
Is there a good reason &lt;b&gt;not&lt;/b&gt; to change QP to &lt;b&gt;always&lt;/b&gt; pass the position to the PhraseQuery?&lt;/p&gt;</comment>
                    <comment id="12552916" author="steve_rowe" created="Tue, 18 Dec 2007 22:29:10 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Is there a good reason &lt;b&gt;not&lt;/b&gt; to change QP to &lt;b&gt;always&lt;/b&gt; pass the position to the PhraseQuery?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Backward compatibility &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  In all seriousness, if QP&apos;s default behavior is changed, regardless of correctness, shouldn&apos;t it wait until 3.0?&lt;/p&gt;

&lt;p&gt;Hoss&apos;s suggestion changes no defaults, so &lt;b&gt;caveat user&lt;/b&gt; applies - no problem applying to trunk immediately.  Maybe a different patch to change the default behavior in StopFilter and in QP for 3.0?&lt;/p&gt;</comment>
                    <comment id="12554242" author="doronc" created="Mon, 24 Dec 2007 11:33:50 +0000"  >&lt;p&gt;This patch enables increments optionally in QueryParser and StopFilter, as discussed above.&lt;br/&gt;
The default behavior has not changed, so there should be no back-comp issues.&lt;/p&gt;

&lt;p&gt;The implementation in StopFilter differs slightly from the &quot;older&quot; reverted code in&lt;br/&gt;
that it does not assume incoming tokens to have position-increment of 1. So it&lt;br/&gt;
should work ok when stop filters and &quot;expanders&quot; are concatenated.&lt;/p&gt;

&lt;p&gt;Added API:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   QueryParser {
       &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getApplyPositionIncrements();
       &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setApplyPositionIncrements(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; applyPositionIncrements);
   }  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    StopFilter {
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getApplyPositionIncrements();
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setApplyPositionIncrements(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; applyPositionIncrements);
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getDefaultApplyPositionIncrements()
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setDefaultApplyPositionIncrements(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; defaultApplyPositionIncrements)
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the two new static methods in StopFilter - these allow to control behavior system wide, and this way affect the behavior of classes that construct a StopFilter internally, like StopAnalyzer and StandardAnalyzer, without needing to  pollute the API of many classes (all Snowball analyzers for instance) with new API. &lt;/p&gt;

&lt;p&gt;Parse tests and search tests were added.&lt;br/&gt;
All tests pass.&lt;/p&gt;

&lt;p&gt;Feedback is required:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Comments on the proposed API:
	&lt;ul&gt;
		&lt;li&gt;the static methods approach?&lt;/li&gt;
		&lt;li&gt;perhaps &quot;enable&quot; instead of &quot;apply&quot;?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Do you think this should be added now (it is ready I think) or would you rather to hold this for after 2.3?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12554249" author="doronc" created="Mon, 24 Dec 2007 13:03:20 +0000"  >&lt;blockquote&gt;
&lt;p&gt;... it does not assume incoming tokens to have position-increment of 1. &lt;br/&gt;
So it should work ok when stop filters and &quot;expanders&quot; are concatenated.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, chaining stop filters didn&apos;t work in previous patch.&lt;br/&gt;
Attached patch fixed this.&lt;/p&gt;

&lt;p&gt;Problem was with tokenizers reuse of tokens (next(Token)).&lt;br/&gt;
CharTokenizer, KeywordTokenizer and StandardTokenizer &lt;br/&gt;
were fixed to reset positionIncrement to 1.&lt;/p&gt;

&lt;p&gt;The way I see it &lt;b&gt;Tokenizers must&lt;/b&gt; do this and &lt;b&gt;Filters must not&lt;/b&gt; do this.&lt;br/&gt;
If there&apos;s no objection to this observation I&apos;ll javadoc it in Tokenizer&lt;br/&gt;
for future implementors.&lt;/p&gt;</comment>
                    <comment id="12554472" author="doronc" created="Wed, 26 Dec 2007 22:10:08 +0000"  >&lt;p&gt;Ok I separated the tokenizers fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1101&quot; title=&quot;TokenStream.next(Token) reuse &amp;#39;policy&amp;#39;: calling Token.clear() should be responsibility of producer.&quot;&gt;&lt;del&gt;LUCENE-1101&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Patch here stands-alone (not depending on 1101), will &lt;br/&gt;
update it once 1101 gets committed.&lt;/p&gt;</comment>
                    <comment id="12554983" author="doronc" created="Sun, 30 Dec 2007 08:11:10 +0000"  >&lt;p&gt;Updated patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Token reuse fixes omitted (handled by &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1101&quot; title=&quot;TokenStream.next(Token) reuse &amp;#39;policy&amp;#39;: calling Token.clear() should be responsibility of producer.&quot;&gt;&lt;del&gt;LUCENE-1101&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;new feature methods renamed from &quot;apply&quot; to &quot;enable&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass, default behavior unmodified, ready to commit.&lt;/p&gt;</comment>
                    <comment id="12555071" author="doronc" created="Mon, 31 Dec 2007 08:29:07 +0000"  >&lt;p&gt;Committed . (already yesterday actually, I was sure that I already resolved it...)&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                                <inwardlinks description="is blocked by">
                            <issuelink>
            <issuekey id="12385220">LUCENE-1101</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12372336" name="lucene-1095-pos-incr.patch" size="23486" author="doronc" created="Sun, 30 Dec 2007 08:11:10 +0000" />
                    <attachment id="12372161" name="lucene-1095-pos-incr.patch" size="25099" author="doronc" created="Mon, 24 Dec 2007 13:03:20 +0000" />
                    <attachment id="12372155" name="lucene-1095-pos-incr.patch" size="22542" author="doronc" created="Mon, 24 Dec 2007 11:33:50 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 18 Dec 2007 21:12:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12650</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26634</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>