<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:04:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2208/LUCENE-2208.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2208] Token div exceeds length of provided text sized 4114</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2208</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I have a doc which contains html codes. I want to strip html tags and make the test clear after then apply highlighter on the clear text . But highlighter throws an exceptions if I strip out the html characters  , if i don&apos;t strip out , it works fine. It just confuses me at the moment &lt;/p&gt;

&lt;p&gt;I copy paste 3 thing here from the console as it may contain special characters which might cause the problem.&lt;/p&gt;


&lt;p&gt;1 -) Here is the html text &lt;/p&gt;

&lt;p&gt;          &amp;lt;h2&amp;gt;Starter&amp;lt;/h2&amp;gt;&lt;br/&gt;
          &amp;lt;div id=&quot;tab1-content&quot; class=&quot;tabContent selected&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;head&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;body&quot;&amp;gt;&lt;br/&gt;
             &amp;lt;div class=&quot;subject-header&quot;&amp;gt;Learning path: History&amp;lt;/div&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;Key question&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;p&amp;gt;Did transport fuel the industrial revolution?&amp;lt;/p&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;Learning Objective&amp;lt;/h3&amp;gt;&lt;br/&gt;
	      &amp;lt;ul&amp;gt;&lt;br/&gt;
              &amp;lt;li&amp;gt;To categorise points as for or against an argument&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;&lt;br/&gt;
	      &amp;lt;p&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;What to do?&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;ul&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;Watch the clip: &amp;lt;em&amp;gt;Transport fuelled the industrial revolution.&amp;lt;/em&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;&lt;br/&gt;
              &amp;lt;p&amp;gt;The clips claims that transport fuelled the industrial revolution. Some historians argue that the industrial revolution only happened because of developments in transport.&amp;lt;/p&amp;gt;&lt;br/&gt;
			  &amp;lt;ul&amp;gt;&lt;br/&gt;
			  	&amp;lt;li&amp;gt;Read the statements below and decide which points are &amp;lt;em&amp;gt;for&amp;lt;/em&amp;gt; and which points are &amp;lt;em&amp;gt;against&amp;lt;/em&amp;gt; the argument that industry expanded in the 18th and 19th centuries because of developments in transport.&amp;lt;/li&amp;gt;&lt;br/&gt;
			&amp;lt;/ul&amp;gt;&lt;/p&gt;

&lt;p&gt;			&amp;lt;ol type=&quot;a&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;Industry expanded because of inventions and the discovery of steam power.&amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;Improvements in transport allowed goods to be sold all over the country and all over the world so there were more customers to develop industry for.&amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;Developments in transport allowed resources, such as coal from mines and cotton from America to come together to manufacture products.&amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;Transport only developed because industry needed it. It was slow to develop as money was spent on improving roads, then building canals and the replacing them with railways in order to keep up with industry.&amp;lt;/li&amp;gt;&lt;br/&gt;
			&amp;lt;/ol&amp;gt;&lt;/p&gt;

&lt;p&gt;			&amp;lt;p&amp;gt;Now try to think of 2 more statements of your own.&amp;lt;/p&amp;gt;&lt;/p&gt;

&lt;p&gt;            &amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;foot&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;h2&amp;gt;Main activity&amp;lt;/h2&amp;gt;&lt;br/&gt;
          &amp;lt;div id=&quot;tab2-content&quot; class=&quot;tabContent&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;head&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;body&quot;&amp;gt;&amp;lt;div class=&quot;subject-header&quot;&amp;gt;Learning path: History&amp;lt;/div&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;Learning Objective&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;ul&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;To select evidence to support points&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;What to do?&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;!--&amp;lt;ul&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;Watch the clip: &amp;lt;em&amp;gt;Windmill and water mill&amp;lt;/em&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;--&amp;gt;&lt;br/&gt;
              &amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Choose the 4 points that you think are most important - try to be balanced by having two &amp;lt;strong&amp;gt;for&amp;lt;/strong&amp;gt; and two &amp;lt;strong&amp;gt;against&amp;lt;/strong&amp;gt;.&amp;lt;/li&amp;gt;&lt;br/&gt;
			  &amp;lt;li&amp;gt;Write one in each of the point boxes of the paragraphs on the sheet &amp;lt;a href=&quot;lp_history_industry_transport_ws1.html&quot; class=&quot;link-internal&quot;&amp;gt;Constructing a balanced argument&amp;lt;/a&amp;gt;.&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt; &amp;lt;p&amp;gt;You might like to re write the points in your own words and use connectives to link the paragraphs.&amp;lt;/p&amp;gt;&lt;/p&gt;

&lt;p&gt;			  &amp;lt;p&amp;gt;In history and in any argument, you need evidence to support your points.&amp;lt;/p&amp;gt;&lt;br/&gt;
			  &amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Find evidence from these sources and from your own knowledge to support each of your points:&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&lt;br/&gt;
			  &amp;lt;ol&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?template=vid&amp;amp;macro=setResource&amp;amp;resourceID=2044&quot; class=&quot;link-internal&quot;&amp;gt;At a toll gate&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?macro=setResource&amp;amp;template=vid&amp;amp;resourceID=2046&quot; class=&quot;link-internal&quot;&amp;gt;Canals&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?macro=setResource&amp;amp;template=vid&amp;amp;resourceID=2043&quot; class=&quot;link-internal&quot;&amp;gt;Growing cities: traffic&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?macro=setResource&amp;amp;template=vid&amp;amp;resourceID=2047&quot; class=&quot;link-internal&quot;&amp;gt;Impact of the railway&amp;lt;/a&amp;gt; &amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?macro=setResource&amp;amp;template=vid&amp;amp;resourceID=2048&quot; class=&quot;link-internal&quot;&amp;gt;Sailing ships&amp;lt;/a&amp;gt; &amp;lt;/li&amp;gt;&lt;br/&gt;
				&amp;lt;li&amp;gt;&amp;lt;a href=&quot;../servlet/link?macro=setResource&amp;amp;template=vid&amp;amp;resourceID=2050&quot; class=&quot;link-internal&quot;&amp;gt;Liverpool: Capital of Culture&amp;lt;/a&amp;gt; &amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ol&amp;gt;&lt;br/&gt;
			  &amp;lt;p&amp;gt;Try to be specific in your evidence - use named examples of places or people. Use dates if you can.&amp;lt;/p&amp;gt;&lt;br/&gt;
            &amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;foot&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;h2&amp;gt;Plenary&amp;lt;/h2&amp;gt;&lt;br/&gt;
          &amp;lt;div id=&quot;tab3-content&quot; class=&quot;tabContent&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;head&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;body&quot;&amp;gt;&amp;lt;div class=&quot;subject-header&quot;&amp;gt;Learning path: History&amp;lt;/div&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;Learning Objective&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;ul&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;To judge which of the arguments is most valid&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;What to do?&amp;lt;/h3&amp;gt;&lt;br/&gt;
&amp;lt;!--              &amp;lt;ul&amp;gt;&lt;br/&gt;
                &amp;lt;li&amp;gt;Watch the clip: &amp;lt;em&amp;gt;Food of the rich&amp;lt;/em&amp;gt;&amp;lt;/li&amp;gt;&lt;br/&gt;
              &amp;lt;/ul&amp;gt;--&amp;gt;&lt;br/&gt;
              &amp;lt;p&amp;gt;In order to be a good historian, and get good marks in exams, you need to show your evaluation skills and make a judgement. Having been through the evidence which point do you think is most important? Why? Is there more evidence? Is the evidence more convincing?&amp;lt;/p&amp;gt;&lt;br/&gt;
			  &amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;In the final box on your worksheet write a conclusion explaining whether on balance the evidence is enough to convince you that transport fuelled the industrial revolution.&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&lt;br/&gt;
            &amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;foot&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;h2&amp;gt;Extension&amp;lt;/h2&amp;gt;&lt;br/&gt;
          &amp;lt;div id=&quot;tab4-content&quot; class=&quot;tabContent&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;head&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;body&quot;&amp;gt;&amp;lt;div class=&quot;subject-header&quot;&amp;gt;Learning path: History&amp;lt;/div&amp;gt;&lt;br/&gt;
              &amp;lt;h3&amp;gt;What to do?&amp;lt;/h3&amp;gt;&lt;br/&gt;
              &amp;lt;p&amp;gt;Watch the clip &amp;lt;em&amp;gt;Stress in a ski resort&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;&lt;br/&gt;
			  &amp;lt;p&amp;gt;New industries, such as tourism, can now be said to be fuelled by transport improvements.&amp;lt;/p&amp;gt;&lt;br/&gt;
              &amp;lt;ul&amp;gt;&amp;lt;li&amp;gt;Search Clipbank, using the Related clip lists as well as the search function, to find examples from around the world of how transport has helped industry.&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;              &lt;br/&gt;
            &amp;lt;/div&amp;gt;&lt;br/&gt;
            &amp;lt;div class=&quot;foot&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
          &amp;lt;/div&amp;gt;&lt;/p&gt;


&lt;p&gt;2-) here is the text after stripped html tags  out &lt;/p&gt;

&lt;p&gt;           Starter &lt;/p&gt;



&lt;p&gt;              Learning path: History &lt;br/&gt;
               Key question &lt;br/&gt;
               Did transport fuel the industrial revolution? &lt;br/&gt;
               Learning Objective &lt;/p&gt;

&lt;p&gt;               To categorise points as for or against an argument &lt;/p&gt;


&lt;p&gt;               What to do? &lt;/p&gt;

&lt;p&gt;                 Watch the clip:  Transport fuelled the industrial revolution.  &lt;/p&gt;

&lt;p&gt;               The clips claims that transport fuelled the industrial revolution. Some historians argue that the industrial revolution only happened because of developments in transport. &lt;/p&gt;

&lt;p&gt;			  	 Read the statements below and decide which points are  for  and which points are  against  the argument that industry expanded in the 18th and 19th centuries because of developments in transport. &lt;/p&gt;



&lt;p&gt;				 Industry expanded because of inventions and the discovery of steam power. &lt;br/&gt;
				 Improvements in transport allowed goods to be sold all over the country and all over the world so there were more customers to develop industry for. &lt;br/&gt;
				 Developments in transport allowed resources, such as coal from mines and cotton from America to come together to manufacture products. &lt;br/&gt;
				 Transport only developed because industry needed it. It was slow to develop as money was spent on improving roads, then building canals and the replacing them with railways in order to keep up with industry. &lt;/p&gt;


&lt;p&gt;			 Now try to think of 2 more statements of your own. &lt;/p&gt;




&lt;p&gt;           Main activity &lt;/p&gt;


&lt;p&gt;              Learning path: History &lt;br/&gt;
               Learning Objective &lt;/p&gt;

&lt;p&gt;                 To select evidence to support points &lt;/p&gt;

&lt;p&gt;               What to do? &lt;/p&gt;

&lt;p&gt;                Choose the 4 points that you think are most important - try to be balanced by having two  for  and two  against . &lt;br/&gt;
			   Write one in each of the point boxes of the paragraphs on the sheet  Constructing a balanced argument .    You might like to re write the points in your own words and use connectives to link the paragraphs. &lt;/p&gt;

&lt;p&gt;			   In history and in any argument, you need evidence to support your points. &lt;br/&gt;
			    Find evidence from these sources and from your own knowledge to support each of your points:  &lt;/p&gt;

&lt;p&gt;                  At a toll gate  &lt;br/&gt;
                  Canals  &lt;br/&gt;
                  Growing cities: traffic  &lt;br/&gt;
				  Impact of the railway   &lt;br/&gt;
				  Sailing ships   &lt;br/&gt;
				  Liverpool: Capital of Culture   &lt;/p&gt;

&lt;p&gt;			   Try to be specific in your evidence - use named examples of places or people. Use dates if you can. &lt;/p&gt;



&lt;p&gt;           Plenary &lt;/p&gt;


&lt;p&gt;              Learning path: History &lt;br/&gt;
               Learning Objective &lt;/p&gt;

&lt;p&gt;                 To judge which of the arguments is most valid &lt;/p&gt;

&lt;p&gt;               What to do? &lt;/p&gt;

&lt;p&gt;               In order to be a good historian, and get good marks in exams, you need to show your evaluation skills and make a judgement. Having been through the evidence which point do you think is most important? Why? Is there more evidence? Is the evidence more convincing? &lt;br/&gt;
			    In the final box on your worksheet write a conclusion explaining whether on balance the evidence is enough to convince you that transport fuelled the industrial revolution.  &lt;/p&gt;



&lt;p&gt;           Extension &lt;/p&gt;


&lt;p&gt;              Learning path: History &lt;br/&gt;
               What to do? &lt;br/&gt;
               Watch the clip  Stress in a ski resort  &lt;br/&gt;
			   New industries, such as tourism, can now be said to be fuelled by transport improvements. &lt;br/&gt;
                Search Clipbank, using the Related clip lists as well as the search function, to find examples from around the world of how transport has helped industry.                &lt;/p&gt;




&lt;p&gt;         3-) here is the exception I get&lt;/p&gt;

&lt;p&gt;org.apache.lucene.search.highlight.InvalidTokenOffsetsException: Token div exceeds length of provided text sized 4114&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:228)&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestFragments(Highlighter.java:158)&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestFragments(Highlighter.java:462)&lt;/p&gt;
</description>
                <environment>&lt;p&gt; diagnostics = &lt;/p&gt;
{os.version=5.1, os=Windows XP, lucene.version=3.0.0 883080 - 2009-11-22 15:43:58, source=flush, os.arch=x86, java.version=1.6.0_12, java.vendor=Sun Microsystems Inc.}
</environment>
            <key id="12445424">LUCENE-2208</key>
            <summary>Token div exceeds length of provided text sized 4114</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="steve_rowe">Steve Rowe</assignee>
                                <reporter username="rvarlikli@yahoo.com">Ramazan VARLIKLI</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jan 2010 18:40:55 +0000</created>
                <updated>Fri, 10 May 2013 11:43:43 +0100</updated>
                    <resolved>Tue, 24 Jan 2012 15:56:19 +0000</resolved>
                            <version>3.0</version>
                                <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/highlighter</component>
                        <due></due>
                    <votes>5</votes>
                        <watches>6</watches>
                                                    <comments>
                    <comment id="12856520" author="lukeforehand" created="Tue, 13 Apr 2010 19:02:06 +0100"  >&lt;p&gt;I just opened a bug for what appears to be the same issue in the SOLR project:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1883&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/browse/SOLR-1883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There you will find an attachment of the document that I am attempting to query with a highlight query but it fails.  I also pasted my schema.xml and the exception stacktrace.&lt;/p&gt;</comment>
                    <comment id="12856670" author="lukeforehand" created="Tue, 13 Apr 2010 23:37:44 +0100"  >&lt;p&gt;Sorry for what seems like cross posting, but I&apos;m not sure if the issue is in SOLR or Lucene.  I have uploaded to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1883&quot; title=&quot;Highlighting failure caused by InvalidTokenOffsetsException&quot;&gt;&lt;del&gt;SOLR-1883&lt;/del&gt;&lt;/a&gt; an easy to execute test case that consistently reproduces this bug.  I also confirm (like the original reporter of this issue) that removing the HTMLStripCharFilterFactory during indexing fixes the highlight query problem, but obviously we need to strip the HTML so this isn&apos;t a solution.&lt;/p&gt;</comment>
                    <comment id="12989215" author="rcmuir" created="Tue, 1 Feb 2011 14:32:22 +0000"  >&lt;p&gt;Definitely looks like a bug in HTMLStripCharFilter.&lt;/p&gt;

&lt;p&gt;attached is a simple test case demonstrating the bug&lt;/p&gt;</comment>
                    <comment id="12989965" author="hwang" created="Thu, 3 Feb 2011 05:24:36 +0000"  >&lt;p&gt;added patch(&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2208&quot; title=&quot;Token div exceeds length of provided text sized 4114&quot;&gt;&lt;del&gt;LUCENE-2208&lt;/del&gt;&lt;/a&gt;.patch) to fix org.apache.lucene.search.highlight.InvalidTokenOffsetsException.&lt;/p&gt;

&lt;p&gt;The exception is caused by HTML escape characters (e.g., &amp;#38;#38;, &amp;amp;amp;  ) which are counted as 1 character in text.length() in Highlighter.getBestTextFragments, but in HTMLStripCharfilter, they are counted as N characters(&amp;#38;#38; counted as 5). &lt;/p&gt;

&lt;p&gt;In the patch, I commented out an incorrect test case in HTMLStripCharFilterTest.testOffset()(&quot;X &amp;amp; X &amp;#40; X &amp;lt; &amp;gt; X&quot;). The commented out test case is covered by Robert&apos;s test patch. &lt;/p&gt;</comment>
                    <comment id="12990342" author="rcmuir" created="Thu, 3 Feb 2011 22:35:11 +0000"  >&lt;p&gt;Hi Hsiu, thanks for uploading a patch to the issue.&lt;/p&gt;

&lt;p&gt;Koji, maybe you can take a look at this when you get a chance? &lt;br/&gt;
It seems to be an important bug to fix, but I don&apos;t know the HtmlStripCharFilter that well.&lt;/p&gt;</comment>
                    <comment id="13059836" author="iorixxx" created="Tue, 5 Jul 2011 12:03:51 +0100"  >&lt;p&gt;Hello, I am using very recent trunk, I received the same exception (InvalidTokenOffsetsException) with PatternReplaceCharFilter. I observed that HTMLStripCharFilter sometimes causes wrong words getting highlighted. So I was playing with PatternReplaceCharFilter to somehow remove html tags hoping highlighting won&apos;t be broken this time. &lt;/p&gt;

&lt;p&gt;I remember tokenizer versions of htmlStrip has problems with highlighting. It seems that it is continued with charFilters. Hsiu Wang, do you think the reason (HTMLStripCharFilter causes wrong words getting highlighted) is the same as here (what you explained here)?&lt;/p&gt;</comment>
                    <comment id="13082315" author="ldb" created="Wed, 10 Aug 2011 14:15:26 +0100"  >&lt;p&gt;same problem here with solr 4.0, nightly build &quot;apache-solr-4.0-2011-08-03_08-19-32&quot;.&lt;br/&gt;
interestingly, when i delete the sort params, the query works.&lt;/p&gt;

&lt;p&gt;xxx.:8983/solr/clustering&amp;amp;rows=40&amp;amp;start=0&amp;amp;fl=content+pubDate&amp;amp;sort=pubDate+desc&amp;amp;q=london&lt;/p&gt;


&lt;p&gt;2 Log-snippets:&lt;br/&gt;
Http - 500 Internal Server Error&lt;br/&gt;
Error:     Carrot2 clustering failed........&lt;/p&gt;

&lt;p&gt;And this was caused by:&lt;br/&gt;
Http - 500 Internal Server Error&lt;br/&gt;
Error:     org.apache.lucene.search.highlight.InvalidTokenOffsetsException: Token the exceeds length of provided text sized 41&lt;/p&gt;
</comment>
                    <comment id="13162898" author="zinger" created="Mon, 5 Dec 2011 17:46:50 +0000"  >&lt;p&gt;Hello Guys,&lt;/p&gt;

&lt;p&gt;I am blocked with bug as well.&lt;/p&gt;

&lt;p&gt;Is there any update / progress on this subject?&lt;/p&gt;

&lt;p&gt;Thank you in advance...&lt;/p&gt;</comment>
                    <comment id="13163713" author="oldskoolmark" created="Tue, 6 Dec 2011 17:49:00 +0000"  >&lt;p&gt;Same problem here with 3.4. Removing HTMLStripCharFilterFactory solves the problem. Turns out I don&apos;t need this filter anyway, as I remove the HTML markup when my data import handler pulls the data from an Sqlite3 DB. &lt;/p&gt;</comment>
                    <comment id="13164478" author="ldb" created="Wed, 7 Dec 2011 16:16:16 +0000"  >&lt;p&gt;Added patch doesn&apos;t work, unfortunately. Removing HTMLStripCharFilterFactory solves the problem but is not a solution. I need this Filter.&lt;/p&gt;</comment>
                    <comment id="13170778" author="rcmuir" created="Fri, 16 Dec 2011 05:05:01 +0000"  >&lt;p&gt;This filter has at least 2 bugs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;wrong end-offsets that sometimes go past the end of the actual text&lt;/li&gt;
	&lt;li&gt;wrong final offsets that are sometimes shorter than the actual text&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I committed a (disabled) random test exposing these issues.&lt;/p&gt;</comment>
                    <comment id="13184750" author="steve_rowe" created="Thu, 12 Jan 2012 06:21:16 +0000"  >&lt;p&gt;The JFlex-based &lt;tt&gt;HTMLStripCharFilter&lt;/tt&gt; replacement at &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3690&quot; title=&quot;JFlex-based HTMLStripCharFilter replacement&quot;&gt;&lt;del&gt;LUCENE-3690&lt;/del&gt;&lt;/a&gt; should fix the offset problems reported here.  (It passes the &lt;tt&gt;assertLegalOffsets()&lt;/tt&gt; test in Robert Muir&apos;s test patch on this issue, as well as the random test Robert added to &lt;tt&gt;HTMLStripCharFilterTest&lt;/tt&gt;.)&lt;/p&gt;</comment>
                    <comment id="13185491" author="ldb" created="Fri, 13 Jan 2012 08:45:44 +0000"  >&lt;p&gt;Hello Steven, thanks, i&apos;ll test it.&lt;br/&gt;
is it right:&lt;br/&gt;
i can use furthermore my HTMLStripCharFilterFactory with this patch(&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3690&quot; title=&quot;JFlex-based HTMLStripCharFilter replacement&quot;&gt;&lt;del&gt;LUCENE-3690&lt;/del&gt;&lt;/a&gt;.patch) with no changes in my schema.xml?&lt;/p&gt;</comment>
                    <comment id="13185580" author="steve_rowe" created="Fri, 13 Jan 2012 13:35:29 +0000"  >&lt;p&gt;Hi Vadim,&lt;/p&gt;

&lt;p&gt;This patch is against trunk (which will eventually be released as v4.0).  Also, it&apos;s not yet setup to be a replacement for the existing HTMLStripCharFilter, so even if you apply this patch to trunk, it still won&apos;t work for you.&lt;/p&gt;

&lt;p&gt;I will post a patch in the next day or two that you should be able to test; I&apos;ll add a note here when it&apos;s ready.&lt;/p&gt;</comment>
                    <comment id="13185588" author="ldb" created="Fri, 13 Jan 2012 14:00:34 +0000"  >&lt;p&gt;Hi Steven,&lt;br/&gt;
ok, thanks for your feedback &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
It would be nice if you could post a patch, i&apos;m blocked a little bit with this bug.&lt;br/&gt;
Cheers Vadim&lt;/p&gt;</comment>
                    <comment id="13192227" author="steve_rowe" created="Tue, 24 Jan 2012 15:56:19 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3690&quot; title=&quot;JFlex-based HTMLStripCharFilter replacement&quot;&gt;&lt;del&gt;LUCENE-3690&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310051">
                <name>Supercedes</name>
                                                <inwardlinks description="is superceded by">
                            <issuelink>
            <issuekey id="12538152">LUCENE-3690</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12470101" name="LUCENE-2208.patch" size="5644" author="hwang" created="Thu, 3 Feb 2011 05:24:36 +0000" />
                    <attachment id="12469927" name="LUCENE-2208_test.patch" size="1166" author="rcmuir" created="Tue, 1 Feb 2011 14:32:22 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 13 Apr 2010 18:02:06 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11579</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25517</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>