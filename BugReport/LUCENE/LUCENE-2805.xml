<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:09:28 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2805/LUCENE-2805.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2805] SegmentInfos shouldn&apos;t blindly increment version on commit</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2805</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;SegmentInfos currently increments version on the assumption that there are always changes.&lt;/p&gt;

&lt;p&gt;But, both DirReader and IW are more careful about tracking whether there are changes.  DirReader has hasChanges and IW has changeCount.  I think these classes should notify the SIS when there are in fact changes; this will fix the case Simon hit on fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2082&quot; title=&quot;Performance improvement for merging posting lists&quot;&gt;LUCENE-2082&lt;/a&gt; when the NRT reader thought there were changes, but in fact there weren&apos;t because IW simply committed the exact SIS it already had.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12492568">LUCENE-2805</key>
            <summary>SegmentInfos shouldn&apos;t blindly increment version on commit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Dec 2010 00:44:19 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:21 +0100</updated>
                    <resolved>Wed, 8 Dec 2010 13:27:02 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12968521" author="mikemccand" created="Tue, 7 Dec 2010 00:53:05 +0000"  >&lt;p&gt;Duh, make that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2802&quot; title=&quot;DirectoryReader ignores NRT SegmentInfos in #isOptimized()&quot;&gt;&lt;del&gt;LUCENE-2802&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="12968522" author="mikemccand" created="Tue, 7 Dec 2010 00:53:49 +0000"  >&lt;p&gt;Attached first cut patch, just moving the .version++ responsibility into DirReader/IW.&lt;/p&gt;

&lt;p&gt;But I haven&apos;t verified if it fixes the case in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2802&quot; title=&quot;DirectoryReader ignores NRT SegmentInfos in #isOptimized()&quot;&gt;&lt;del&gt;LUCENE-2802&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="12968558" author="simonw" created="Tue, 7 Dec 2010 03:45:38 +0000"  >&lt;p&gt;this should be fixed together with &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2802&quot; title=&quot;DirectoryReader ignores NRT SegmentInfos in #isOptimized()&quot;&gt;&lt;del&gt;LUCENE-2802&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                    <comment id="12968567" author="simonw" created="Tue, 7 Dec 2010 04:21:51 +0000"  >&lt;p&gt;here is a slightly updated patch that removes the blind increment from DefaultSegmentInfosWriter, adds #changed() calles to contrib classes and adds a missing #changed() call to IW#deleteAll() &lt;/p&gt;

&lt;p&gt;test pass also for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2802&quot; title=&quot;DirectoryReader ignores NRT SegmentInfos in #isOptimized()&quot;&gt;&lt;del&gt;LUCENE-2802&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12968637" author="mikemccand" created="Tue, 7 Dec 2010 09:17:18 +0000"  >&lt;p&gt;Nice catches on all the other places Simon!   Patch looks good.&lt;/p&gt;

&lt;p&gt;Except I think we can now simplify IW.nrtIsCurrent to this?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nrtIsCurrent(SegmentInfos infos) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; segmentInfos.version == infos.version &amp;amp;&amp;amp; !docWriter.anyChanges();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12968713" author="simonw" created="Tue, 7 Dec 2010 13:00:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Except I think we can now simplify IW.nrtIsCurrent to this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yay, this make the nrtIsCurrent check simpler too. Lemme see if anything breaks, I think that could cause a test to fail since we compared the seg infos though.&lt;/p&gt;</comment>
                    <comment id="12968736" author="simonw" created="Tue, 7 Dec 2010 13:54:44 +0000"  >&lt;p&gt;next iteration - I simplified nrtIsCurrent which is nice and all tests pass. Yet, I couldn&apos;t get any test failing with this version&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nrtIsCurrent(SegmentInfos infos) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; segmentInfos.version == infos.version;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so I added another test that crashes immediately if we don&apos;t check the docWriter for changes. I also added a changes entry to runtime behavior section since the version number are different to previos versions.&lt;/p&gt;

&lt;p&gt;I also had to update an assert in TestIndexWriterReader#testAddIndexes since we now don&apos;t increment the version on a commit if there are no changes but generation might have been changed though.&lt;/p&gt;

&lt;p&gt;I think we are good to go.&lt;/p&gt;</comment>
                    <comment id="12968850" author="simonw" created="Tue, 7 Dec 2010 17:57:56 +0000"  >&lt;p&gt;Committed revision 1043148.&lt;/p&gt;

&lt;p&gt;I will backport later today&lt;/p&gt;</comment>
                    <comment id="12969159" author="simonw" created="Wed, 8 Dec 2010 02:51:38 +0000"  >&lt;p&gt;here is a patch against 3.x. I needed to change an assert in the backwards tests so that is potentially a bw break and I am not 100% sure how we handle this right now. Is changing the bw test ok in this case? If its really a bw break I guess we should also list it in the BW section in CHANGES.txt&lt;/p&gt;</comment>
                    <comment id="12969253" author="mikemccand" created="Wed, 8 Dec 2010 09:18:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;needed to change an assert in the backwards tests so that is potentially a bw break and I am not 100% sure how we handle this right now. Is changing the bw test ok in this case? If its really a bw break I guess we should also list it in the BW section in CHANGES.txt&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s fine to change the test &amp;#8211; and the CHANGES entry already explains this?  (Though maybe fix the CHANGES to explain that this now means some readers will in fact return &quot;true&quot; from isCurrent when then before incorrectly returned &quot;false&quot;?).&lt;/p&gt;</comment>
                    <comment id="12969299" author="simonw" created="Wed, 8 Dec 2010 13:27:01 +0000"  >&lt;p&gt;Backported in  revision 1043406.&lt;/p&gt;</comment>
                    <comment id="13013449" author="gsingers" created="Wed, 30 Mar 2011 16:50:21 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12492154">LUCENE-2802</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12465772" name="LUCENE-2805_3x.patch" size="11846" author="simonw" created="Wed, 8 Dec 2010 02:51:38 +0000" />
                    <attachment id="12465690" name="LUCENE-2805.patch" size="11014" author="simonw" created="Tue, 7 Dec 2010 13:54:44 +0000" />
                    <attachment id="12465658" name="LUCENE-2805.patch" size="6508" author="simonw" created="Tue, 7 Dec 2010 04:21:51 +0000" />
                    <attachment id="12465643" name="LUCENE-2805.patch" size="3331" author="mikemccand" created="Tue, 7 Dec 2010 00:53:49 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 7 Dec 2010 03:45:38 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11052</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24887</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>