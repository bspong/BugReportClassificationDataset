<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3309/LUCENE-3309.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3309] Add narrow API for loading stored fields, to replace FieldSelector</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3309</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I think we should &quot;invert&quot; the FieldSelector API, with a &quot;push&quot; API&lt;br/&gt;
whereby FieldsReader invokes this API once per field in the document&lt;br/&gt;
being visited.&lt;/p&gt;

&lt;p&gt;Implementations of the API can then do arbitrary things like save away&lt;br/&gt;
the field&apos;s size, load the field, clone the IndexInput for later lazy&lt;br/&gt;
loading, etc.&lt;/p&gt;

&lt;p&gt;This very thin API would be a mirror image of the very thin index time&lt;br/&gt;
API we now have (IndexableField) and, importantly, it would have no&lt;br/&gt;
dependence on our &quot;user space&quot; Document/Field/FieldType impl, so apps&lt;br/&gt;
are free to do something totally custom.&lt;/p&gt;

&lt;p&gt;After we have this, we should build the &quot;sugar&quot; API that rebuilds a&lt;br/&gt;
Document instance (ie IR.document(int docID)) on top of this new thin&lt;br/&gt;
API.  This&apos;ll also be a good test that the API is sufficient.&lt;/p&gt;

&lt;p&gt;Relevant discussions from IRC this morning at&lt;br/&gt;
&lt;a href=&quot;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2011-07-13#l76&quot; class=&quot;external-link&quot;&gt;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2011-07-13#l76&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
            <key id="12513944">LUCENE-3309</key>
            <summary>Add narrow API for loading stored fields, to replace FieldSelector</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jul 2011 17:07:18 +0100</created>
                <updated>Thu, 14 Jul 2011 15:23:48 +0100</updated>
                    <resolved>Thu, 14 Jul 2011 11:23:46 +0100</resolved>
                                            <fixVersion>Field Type branch</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13064810" author="mikemccand" created="Wed, 13 Jul 2011 20:59:33 +0100"  >&lt;p&gt;Initial patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds IndexReader.FieldVisitor and abstract&lt;br/&gt;
    IndexReader.document(int docID, FieldVisitor visitor).  IR&lt;br/&gt;
    subclasses and FieldsReader implement this.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Stop storing tokenized bit in stored fields &amp;#8211; the fast vector&lt;br/&gt;
    highlighter was actually using this metadata; I change it to&lt;br/&gt;
    always insert the separator char (even for not-analyzed fields)&lt;br/&gt;
    and changed the keyword analyzer in the tests to set offset gap&lt;br/&gt;
    to 1.  We need to do this anyway for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2309&quot; title=&quot;Fully decouple IndexWriter from analyzers&quot;&gt;&lt;del&gt;LUCENE-2309&lt;/del&gt;&lt;/a&gt;, and since we are&lt;br/&gt;
    making an API here we may as well remove it now...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Implement IndexReader.document(int) using only the new&lt;br/&gt;
    FieldVisitor API.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass.&lt;/p&gt;

&lt;p&gt;I think next up is to cutover the various FieldSelector impls to&lt;br/&gt;
FieldVisitor impls, move them to contrib, and then remove&lt;br/&gt;
FieldSelector from core.&lt;/p&gt;</comment>
                    <comment id="13064961" author="mikemccand" created="Thu, 14 Jul 2011 00:46:27 +0100"  >&lt;p&gt;New patch, this time moving *FieldSelector (including LazyField) to&lt;br/&gt;
contrib/misc, and adding a &quot;bridge class&quot; (FieldSelectorVisitor) that&lt;br/&gt;
implements the new FieldVisitor, wrapping a FieldSelector.&lt;/p&gt;

&lt;p&gt;FieldsReader is now very simple &amp;#8211; the only API it supports for&lt;br/&gt;
reading a doc is visitDocument (taking FieldsVisitor).  It now knows&lt;br/&gt;
nothing about Document/Field (same w/ the IR impls; only IR base class&lt;br/&gt;
knows about Document/Field since it impls the sugar API).&lt;/p&gt;

&lt;p&gt;Tests pass; I think it&apos;s ready to commit!&lt;/p&gt;</comment>
                    <comment id="13065046" author="cmale" created="Thu, 14 Jul 2011 05:39:27 +0100"  >&lt;p&gt;Hey Mike,&lt;/p&gt;

&lt;p&gt;Wow you&apos;re fast! I love the ideas in this.  Just a few things:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Applied your patch and theres something not quite right.  It doesn&apos;t contain FieldSelectorVisitor and FieldSelector hasn&apos;t been moved to contrib/misc (in fact, there are imports of document.FieldSelector when its actually in document2.FieldSelector).&lt;/li&gt;
	&lt;li&gt;Can we rename FieldVisitor to StoredFieldVisitor? FieldVisitor sounds really general and like it visits all fields, not just stored ones.&lt;/li&gt;
	&lt;li&gt;What do you think about popping FieldVisitor and the standard impl out of IndexReader? I&apos;m envisaging situations where people may want to extend the standard impl in some way.&lt;/li&gt;
	&lt;li&gt;I saw a few javadoc errors floating round but they may just be intellij lying to me.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="13065154" author="mikemccand" created="Thu, 14 Jul 2011 10:59:03 +0100"  >&lt;p&gt;Thanks Chris &amp;#8211; great feedback!  I agree with all your suggestions...&lt;/p&gt;

&lt;p&gt;New patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Removed oal.documen2.FieldSelector*&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Renamed &amp;amp; moved to standalone StoredFieldVisitor.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Made the default/sugar visitor first class, as&lt;br/&gt;
    DocumentStoredFieldVisitor.java, also allowing it to optionally&lt;br/&gt;
    accept Set&amp;lt;String&amp;gt; fieldsToLoad.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Fix javadoc errors I think I caused, but we &lt;span class=&quot;error&quot;&gt;&amp;#91;separately&amp;#93;&lt;/span&gt; have&lt;br/&gt;
    pre-existing javadoc errors that need fixing (Nikola: can you&lt;br/&gt;
    address these?  Thanks!).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Sorry, my changes have some svn mvs, and my last patch was from &quot;svn&lt;br/&gt;
diff&quot;.  New patch should be fully applyable... (to field type&lt;br/&gt;
branch).&lt;/p&gt;</comment>
                    <comment id="13065165" author="cmale" created="Thu, 14 Jul 2011 11:14:29 +0100"  >&lt;p&gt;Super, +1 to committing.&lt;/p&gt;</comment>
                    <comment id="13065188" author="simonw" created="Thu, 14 Jul 2011 12:21:02 +0100"  >&lt;p&gt;ah man I am to late &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I only looked at the StoredFieldVisitor briefly, what I always missed is a String... fieldsToLoad ctor for convenience which simply passes an array that is used to create a set. in several environments this would be helpful for example when you get the fields to load from a request or something like that.&lt;/p&gt;

&lt;p&gt;I also don&apos;t understand why the set is null in the default ctors, can&apos;t we use the empty set here. If we want to prevent the method call if no fields should be loaded there should be a LoadNoFieldsVisitor I think, no?&lt;/p&gt;</comment>
                    <comment id="13065223" author="mikemccand" created="Thu, 14 Jul 2011 13:47:55 +0100"  >&lt;blockquote&gt;&lt;p&gt;ah man I am to late &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No you&apos;re not!  It&apos;s just software &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  The iterations go on and on and on...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I only looked at the StoredFieldVisitor briefly, what I always missed is a String... fieldsToLoad ctor for convenience which simply passes an array that is used to create a set&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You mean DocumentStoredFieldVisitor, right?  Ie the default/sugar visitor that makes a Document.  I agree we should add a sugar ctor taking String... I&apos;ll do that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I also don&apos;t understand why the set is null in the default ctors, can&apos;t we use the empty set here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm but the default ctor means all fields are accepted (empty set would mean none).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we want to prevent the method call if no fields should be loaded there should be a LoadNoFieldsVisitor I think, no?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wait, shouldn&apos;t the app just not call IR.document() if it wants no fields?&lt;/p&gt;</comment>
                    <comment id="13065289" author="simonw" created="Thu, 14 Jul 2011 15:23:48 +0100"  >&lt;blockquote&gt;&lt;p&gt;Wait, shouldn&apos;t the app just not call IR.document() if it wants no fields?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;nevermind I was confused about the null set.&lt;/p&gt;

&lt;p&gt;simon&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12486421" name="LUCENE-3309.patch" size="181703" author="mikemccand" created="Thu, 14 Jul 2011 10:59:03 +0100" />
                    <attachment id="12486388" name="LUCENE-3309.patch" size="143363" author="mikemccand" created="Thu, 14 Jul 2011 00:46:27 +0100" />
                    <attachment id="12486359" name="LUCENE-3309.patch" size="21860" author="mikemccand" created="Wed, 13 Jul 2011 20:59:33 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 14 Jul 2011 04:39:27 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2758</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24387</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>