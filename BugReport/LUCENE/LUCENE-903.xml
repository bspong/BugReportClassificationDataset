<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:34:15 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-903/LUCENE-903.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-903] FilteredQuery explanation inaccuracy with boost</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-903</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The value of explanation is different than the product of its part if boost &amp;gt; 1.&lt;br/&gt;
This is exposed after tightening the explanation check (part of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-446&quot; title=&quot;search.function - (1) score based on field value, (2) simple score customizability&quot;&gt;&lt;del&gt;LUCENE-446&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;
</description>
                <environment></environment>
            <key id="12370777">LUCENE-903</key>
            <summary>FilteredQuery explanation inaccuracy with boost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="doronc">Doron Cohen</assignee>
                                <reporter username="doronc">Doron Cohen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Jun 2007 09:37:51 +0100</created>
                <updated>Tue, 19 Jun 2007 09:14:57 +0100</updated>
                    <resolved>Mon, 4 Jun 2007 21:55:15 +0100</resolved>
                            <version>2.2</version>
                                <fixVersion>2.2</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12501007" author="doronc" created="Sun, 3 Jun 2007 09:55:22 +0100"  >&lt;p&gt;Attached lucene-903.patch change the explanation test in CheckHits to verify that the explanation value matches the explanation details. This new test makes assumptions on the description of an explanation that has multi sub-details, which might be controversial: the description is assumed to comply with one of:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;end with &quot;product of:&quot;&lt;/li&gt;
	&lt;li&gt;end with &quot;sum of:&quot;&lt;/li&gt;
	&lt;li&gt;end with &quot;sum of:&quot;&lt;/li&gt;
	&lt;li&gt;contain &quot;max plus &amp;lt;x&amp;gt; times others&quot; (where &amp;lt;x&amp;gt; is float)&lt;br/&gt;
While this seems to cover all the current scoring combinations, future scorers might not fit in.&lt;br/&gt;
We can always expand this list of course.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this check, TestSimpleExplanations fails for FilteredQuery - testFQ6(). &lt;br/&gt;
Fix included.&lt;/p&gt;

&lt;p&gt;Also failing is TestBoostingTermQuery, just because its explanation had no &quot;product of:&quot;.&lt;br/&gt;
Fix included.&lt;/p&gt;

&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                    <comment id="12501009" author="doronc" created="Sun, 3 Jun 2007 09:58:45 +0100"  >&lt;p&gt;(explanation validity including for FilteredQuery was handled there.)&lt;/p&gt;</comment>
                    <comment id="12501067" author="hossman" created="Mon, 4 Jun 2007 01:11:31 +0100"  >&lt;p&gt;I have some reservations about this patch.&lt;/p&gt;

&lt;p&gt;I think it&apos;s fine to set as a goal that all &quot;core&quot; query classes should have Explanations where the description accurately describes a mathematical calculation that can be performed on the details to arrive at the value of the Explanation &amp;#8211; which is easy to do since we have the luxury of changing the CHeckHits class to suit our needs anytime we add a new class that has a more &quot;interesting&quot; mathematical calculation then we can current account for.&lt;/p&gt;

&lt;p&gt;But we should also try to maintain CheckHIts as a reusable class that clients can use to run basic sanity tests on their own custom Query classes, and holding them to the same standard (when they can&apos;t easily modify the string pattern rules in CheckHits) doesn&apos;t seem fair.&lt;/p&gt;

&lt;p&gt;lemme try to refactor the current patch a bit so that the &quot;deep&quot; Explanation testing is optional (and used by the core tests)&lt;/p&gt;</comment>
                    <comment id="12501074" author="doronc" created="Mon, 4 Jun 2007 02:04:08 +0100"  >&lt;p&gt;&amp;gt; holding them to the same standard (when they can&apos;t easily modify &lt;br/&gt;
&amp;gt; the string pattern rules in CheckHits) doesn&apos;t seem fair. &lt;/p&gt;

&lt;p&gt;&amp;gt; lemme try to refactor the current patch a bit so that the &quot;deep&quot; &lt;br/&gt;
&amp;gt; Explanation testing is optional (and used by the core tests) &lt;/p&gt;

&lt;p&gt;I agree (and pointed that) the &quot;deep&quot; explanation test is imperfect in this regard. But it seems to me that it is the benefit of new query writers to have their new queries explanations tested as thorough as possible. So I am not sure that disabling this test by default (for non core queries) is the right thing to do.&lt;/p&gt;

&lt;p&gt;How do you feel about adding an escape way, allowing one to specify that a certain (part of an) explanation is not to be checked in this manner?&lt;/p&gt;

&lt;p&gt;I see two immediate ways to add this: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;by the explanation text: if the description starts with &quot;other:&quot; the explanation is not subject to this &quot;deep&quot; check&lt;/li&gt;
	&lt;li&gt;by api: adding a property to Explanation class - disabledDeepCheck - false by default - allows new unique queries to deliberately disable this &quot;deep&quot; test.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12501077" author="hossman" created="Mon, 4 Jun 2007 02:48:00 +0100"  >&lt;p&gt;in general i&apos;m not fond of the inspecting the string to determine whether the math is correct ... in an ideal world every query would have it&apos;s own unit test class and it would have a &quot;testExplanation&quot; method that would know exactly what structure (ie: how many sub-details) to expect from an artificially constructed query instance.  the current approach of having big &quot;explanation&quot; test classes that validate an explanation by comparing them to the scores is a fairly big hack (and i say that as the guy that added it).&lt;/p&gt;

&lt;p&gt;But i&apos;m okay with the string comparisons as a &quot;Convenience&quot; to make it easier for us to test the explanations of the core queries (since so many of them follow very clear patterns) ... but i think we should avoid having any sort of expectation on the string for custom queries (either that they match &quot;product of&quot; or that they match &quot;other:&quot;)&lt;/p&gt;

&lt;p&gt;my main concern is purely with giving people a way to do the same kind of Explanation testing they could do before (that the root value equals the score) even if the details of their explanation don&apos;t fit any of the patterns of the existing core queries.  (i&apos;d hate for people to not even do shallow testing of their Explanations just because we don&apos;t give them a method for doing so)&lt;/p&gt;

&lt;p&gt;this refactoring...&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;makes verifyExplanations a public method in CheckHits that anyone can call&lt;/li&gt;
	&lt;li&gt;adds a &quot;deep&quot; boolean option to verifyExplanations&lt;/li&gt;
	&lt;li&gt;adds variants of CheckHits.checkExplanations and the ExplanationAsserter to make the &quot;deep&quot; testing optional&lt;/li&gt;
	&lt;li&gt;makes QueryUtils.checkExplanations use the &quot;deep&quot; option&lt;/li&gt;
	&lt;li&gt;makes TestExplanations explicitly use deep testing&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...at the moment, the &quot;old&quot; APIs default to deep==false but i&apos;m on board with changing those to &quot;true&quot; if you want to (in theory it&apos;s a non-backawards compatible API change, but since it&apos;s in src/test we can probably get away with it).&lt;/p&gt;</comment>
                    <comment id="12501318" author="doronc" created="Mon, 4 Jun 2007 20:11:22 +0100"  >&lt;p&gt;Thanks for the review Hoss!&lt;/p&gt;

&lt;p&gt;I like with your changes to the patch. &lt;br/&gt;
I modified further:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;do a &quot;deep&quot; check in TestBoostingTermQuery.java&lt;/li&gt;
	&lt;li&gt;remove the call to checkExplanations from TestExplanations.qtest() because&lt;br/&gt;
   that is also called in QueryUtils.checkQuery(). (otherwise it would be done twice.)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I am ok with original checkExplanations() remaining &quot;shallow&quot;, since all core tests now call the &quot;deep&quot; version.&lt;/p&gt;

&lt;p&gt;I intend to commit this shortly.&lt;/p&gt;</comment>
                    <comment id="12501366" author="doronc" created="Mon, 4 Jun 2007 21:55:15 +0100"  >&lt;p&gt;committed the last patch, thanks for your help Hoss.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12332762">LUCENE-557</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12358896" name="lucene-903.patch" size="14882" author="doronc" created="Mon, 4 Jun 2007 20:11:22 +0100" />
                    <attachment id="12358793" name="lucene-903.patch" size="12276" author="hossman" created="Mon, 4 Jun 2007 02:48:00 +0100" />
                    <attachment id="12358772" name="lucene-903.patch" size="7404" author="doronc" created="Sun, 3 Jun 2007 09:55:21 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 4 Jun 2007 00:11:31 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12839</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26826</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>