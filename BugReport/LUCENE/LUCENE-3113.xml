<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:35:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3113/LUCENE-3113.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3113] fix analyzer bugs found by MockTokenizer</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3113</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3064&quot; title=&quot;add checks to MockTokenizer to enforce proper consumption&quot;&gt;&lt;del&gt;LUCENE-3064&lt;/del&gt;&lt;/a&gt;, we beefed up MockTokenizer with assertions, and I&apos;ve switched over the analysis tests to use MockTokenizer for better coverage.&lt;/p&gt;

&lt;p&gt;However, this found a few bugs (one of which is &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3106&quot; title=&quot;commongrams filter calls incrementToken() after it returns false&quot;&gt;&lt;del&gt;LUCENE-3106&lt;/del&gt;&lt;/a&gt;):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;incrementToken() after it returns false in CommonGramsQueryFilter, HyphenatedWordsFilter, ShingleFilter, SynonymFilter&lt;/li&gt;
	&lt;li&gt;missing end() implementation for PrefixAwareTokenFilter&lt;/li&gt;
	&lt;li&gt;double reset() in QueryAutoStopWordAnalyzer and ReusableAnalyzerBase&lt;/li&gt;
	&lt;li&gt;missing correctOffset()s in MockTokenizer itself.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it would be nice to just fix all the bugs on one issue... I&apos;ve fixed everything except Shingle and Synonym&lt;/p&gt;</description>
                <environment></environment>
            <key id="12507496">LUCENE-3113</key>
            <summary>fix analyzer bugs found by MockTokenizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2011 15:15:47 +0100</created>
                <updated>Fri, 3 Jun 2011 17:37:11 +0100</updated>
                    <resolved>Wed, 18 May 2011 14:00:05 +0100</resolved>
                                            <fixVersion>3.2</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13034778" author="rcmuir" created="Tue, 17 May 2011 15:16:41 +0100"  >&lt;p&gt;attached is a patch, the synonyms and shingles tests still fail.&lt;/p&gt;</comment>
                    <comment id="13034802" author="rcmuir" created="Tue, 17 May 2011 15:58:17 +0100"  >&lt;p&gt;updated patch, fixing the bugs in Synonyms and ShingleFilter.&lt;/p&gt;

&lt;p&gt;also, i found two more bugs: the ShingleAnalyzerWrapper was double-resetting, and the PrefixAndSuffixAwareTokenFilter was missing end() also&lt;/p&gt;</comment>
                    <comment id="13034806" author="rcmuir" created="Tue, 17 May 2011 16:03:54 +0100"  >&lt;p&gt;I think this patch is ready to commit, i&apos;ll wait and see if anyone feels like reviewing it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13034816" author="thetaphi" created="Tue, 17 May 2011 16:32:46 +0100"  >&lt;p&gt;A quick check on the fixes in the implementations: all fine. I was just confused about PrefixAndSuffixAwareTF, but thats fine (Robert explained it to me - this Filters are very complicated from the code/class hierarchy design &lt;b&gt;g&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;I did not verify the Tests, I assume its just dumb search-replacements.&lt;/p&gt;</comment>
                    <comment id="13034846" author="rcmuir" created="Tue, 17 May 2011 17:15:10 +0100"  >&lt;p&gt;Uwe, I think i&apos;ll open a followup issue to clean up the code about PrefixAndSuffixAwareTF. I don&apos;t like how tricky it is.&lt;/p&gt;</comment>
                    <comment id="13034956" author="steve_rowe" created="Tue, 17 May 2011 19:40:36 +0100"  >&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the ShingleAnalyzerWrapper was double-resetting&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Your patch just removes the reset call:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@@ -201,7 +201,6 @@
       TokenStream result = defaultAnalyzer.reusableTokenStream(fieldName, reader);
       if (result == streams.wrapped) {
         /* the wrapped analyzer reused the stream */
-        streams.shingle.reset(); 
       } else {
         /* the wrapped analyzer did not, create a new shingle around the new one */
         streams.wrapped = result;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but inverting the condition would read better:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;       TokenStream result = defaultAnalyzer.reusableTokenStream(fieldName, reader);
-      if (result == streams.wrapped) {
-        /* the wrapped analyzer reused the stream */
-        streams.shingle.reset(); 
-      } else {
-        /* the wrapped analyzer did not, create a new shingle around the new one */
+      if (result != streams.wrapped) {
+        // The wrapped analyzer did not reuse the stream. 
+        // Wrap the new stream with a new ShingleFilter.
         streams.wrapped = result;
         streams.shingle = new ShingleFilter(streams.wrapped);
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13035007" author="rcmuir" created="Tue, 17 May 2011 20:53:13 +0100"  >&lt;p&gt;thanks for reviewing Steven, I agree! I&apos;ve made this change and will commit shortly.&lt;/p&gt;</comment>
                    <comment id="13035353" author="rcmuir" created="Wed, 18 May 2011 14:00:05 +0100"  >&lt;p&gt;Committed revision 1104519, 1124242 (branch_3x)&lt;/p&gt;</comment>
                    <comment id="13043469" author="rcmuir" created="Fri, 3 Jun 2011 17:37:11 +0100"  >&lt;p&gt;Bulk closing for 3.2&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                <outwardlinks description="incorporates">
                            <issuelink>
            <issuekey id="12507437">LUCENE-3106</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12479463" name="LUCENE-3113.patch" size="115731" author="rcmuir" created="Tue, 17 May 2011 15:58:17 +0100" />
                    <attachment id="12479460" name="LUCENE-3113.patch" size="111293" author="rcmuir" created="Tue, 17 May 2011 15:16:41 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 17 May 2011 15:32:46 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2135</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24582</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>