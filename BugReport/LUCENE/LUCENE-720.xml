<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:22:55 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-720/LUCENE-720.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-720] Unit tests TestBackwardsCompatibility and TestIndexFileDeleter might fail depending on JVM</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-720</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In the two units tests TestBackwardsCompatibility and TestIndexFileDeleter several index file names are hardcoded. For example, in TestBackwardsCompatibility.testExactFileNames() it is tested if the index directory contains exactly the expected files after several operations like addDocument(), deleteDocument() and setNorm() have been performed. Apparently the unit tests pass on the nightly build machine, but in my environment (Windows XP, IBM JVM 1.5) they fail for the following reason:&lt;/p&gt;

&lt;p&gt;When IndexReader.setNorm() is called a new norm file for the specified field is created with the file  ending .sx, where x is the number of the field. The problem is that the SegmentMerger can not guarantee to keep the order of the fields, in other words after a merge took place a field can have a different field number. This specific testcase fails, because it expects the file ending .s0, but the file has the ending .s1.&lt;/p&gt;

&lt;p&gt;The reason why the field numbers can be different on different JVMs is the use of HashSet in SegmentReader.getFieldNames(). Depending on the HashSet implementation an iterator might not iterate over the entries in insertion order. When I change HashSet to LinkedHashSet, the two testcases pass.&lt;/p&gt;

&lt;p&gt;However, even with a LinkedHashSet the order of the field numbers might change during a merge, because the order in which the SegmentMerger merges the FieldInfos depends on the field options like TERMVECTOR, INDEXED... (see SegmentMerger.mergeFields() for details). &lt;/p&gt;

&lt;p&gt;So I think we should not use LinkedHashSet but rather change the problematic testcases. Furthermore I&apos;m not sure if we should have hardcoded filenames in the tests anyway, because if we change the index format or file names in the future these test cases would fail without modification.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP, IBM JVM 1.5 SP3&lt;/p&gt;</environment>
            <key id="12356221">LUCENE-720</key>
            <summary>Unit tests TestBackwardsCompatibility and TestIndexFileDeleter might fail depending on JVM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="michaelbusch">Michael Busch</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Nov 2006 23:26:52 +0000</created>
                <updated>Tue, 27 Feb 2007 18:10:36 +0000</updated>
                    <resolved>Wed, 22 Nov 2006 17:07:54 +0000</resolved>
                            <version>2.1</version>
                                <fixVersion>2.1</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12451607" author="mikemccand" created="Tue, 21 Nov 2006 11:43:43 +0000"  >&lt;p&gt;Whoa, good catch &amp;amp; explanation of the issue!  Sorry about this.&lt;/p&gt;

&lt;p&gt;I will fix these tests so they resolve the field by name and do their comparisons on that basis.&lt;/p&gt;

&lt;p&gt;I realize that exact file name tests will need to be updated when we change the file format, but, I really wanted test coverage that verifies the generational logic to derive file names is working correctly for segments, del and separate norms files.&lt;/p&gt;

&lt;p&gt;I will temporarily turn off TestBackwardsCompatibility.testExactFileNames, and TestIndexFileDeleter, until I can resolve this.&lt;/p&gt;</comment>
                    <comment id="12451991" author="mikemccand" created="Wed, 22 Nov 2006 17:07:54 +0000"  >&lt;p&gt;OK I was able to reproduce the failure using IBMs JDK 5.0 on Linux.  I changed the tests to load the field infos and compute which field index corresponds to the &quot;content&quot; field and then use that field index instead, and the tests pass.&lt;/p&gt;</comment>
                    <comment id="12452001" author="michaelbusch" created="Wed, 22 Nov 2006 17:51:47 +0000"  >&lt;p&gt;The tests now pass on my machine too. Good job, Mike! Thanks.&lt;/p&gt;</comment>
                    <comment id="12452010" author="mikemccand" created="Wed, 22 Nov 2006 18:32:37 +0000"  >&lt;p&gt;Thank you for tracking this down!  I did not realize field number assinment was volatile across JREs.&lt;/p&gt;</comment>
                    <comment id="12476273" author="mikemccand" created="Tue, 27 Feb 2007 18:10:36 +0000"  >&lt;p&gt;Closing all issues that were resolved for 2.1.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 21 Nov 2006 11:43:43 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13032</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27010</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>