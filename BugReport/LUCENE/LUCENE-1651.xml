<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:19:00 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1651/LUCENE-1651.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1651] Make IndexReader.open() always return MSR to simplify (re-)opens.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1651</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;As per discussion in mailing list, I&apos;m making DirectoryIndexReader.open() always return MSR, even for single-segment indexes.&lt;br/&gt;
While theoretically valid in the past (if you make sure to keep your index constantly optimized) this feature is made practically obsolete by per-segment collection.&lt;/p&gt;

&lt;p&gt;The patch somewhat de-hairies (re-)open logic for MSR/SR.&lt;br/&gt;
SR no longer needs an ability to pose as toplevel directory-owning IR.&lt;br/&gt;
All related logic is moved from DIR to MSR.&lt;br/&gt;
DIR becomes almost empty, and copying two or three remaining fields over to MSR/SR, I remove it.&lt;br/&gt;
Lots of tests fail, as they rely on SR returned from IR.open(), I fix by introducing SR.getOnlySegmentReader static package-private method.&lt;br/&gt;
Some previous bugs are uncovered, one is fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1645&quot; title=&quot;Deleted documents are visible across reopened MSRs&quot;&gt;&lt;del&gt;LUCENE-1645&lt;/del&gt;&lt;/a&gt;, another (partially fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1648&quot; title=&quot;when you clone or reopen an IndexReader with pending changes, the new reader doesn&amp;#39;t commit the changes&quot;&gt;&lt;del&gt;LUCENE-1648&lt;/del&gt;&lt;/a&gt;) is fixed in this patch. &lt;/p&gt;</description>
                <environment></environment>
            <key id="12426028">LUCENE-1651</key>
            <summary>Make IndexReader.open() always return MSR to simplify (re-)opens.</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="earwin">Earwin Burrfoot</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2009 16:46:39 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:25 +0100</updated>
                    <resolved>Sun, 7 Jun 2009 17:34:01 +0100</resolved>
                            <version>2.9</version>
                                <fixVersion>2.9</fixVersion>
                                        <due></due>
                    <votes>1</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12711665" author="earwin" created="Thu, 21 May 2009 16:58:11 +0100"  >&lt;p&gt;Okay, here&apos;s the first patch, against latest trunk.&lt;br/&gt;
test-core, test-contrib pass. test-tag fails due to no-longer-correct test assumptions. Should I checkout the branch and make a separate patch, or how is it done?&lt;/p&gt;</comment>
                    <comment id="12711668" author="mikemccand" created="Thu, 21 May 2009 17:05:20 +0100"  >&lt;p&gt;Excellent!  Thanks Earwin.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;test-tag fails due to no-longer-correct test assumptions. Should I checkout the branch and make a separate patch, or how is it done?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, please make mods to the tags/XXX checkout, and include those mods in the patch.&lt;/p&gt;</comment>
                    <comment id="12713170" author="mikemccand" created="Tue, 26 May 2009 19:09:51 +0100"  >&lt;p&gt;Earwin are you working on the patch for back-compat tests, here?&lt;/p&gt;</comment>
                    <comment id="12713195" author="earwin" created="Tue, 26 May 2009 20:09:58 +0100"  >&lt;p&gt;Yup, will post one soon, didn&apos;t have enough time on hands.&lt;/p&gt;</comment>
                    <comment id="12715672" author="earwin" created="Tue, 2 Jun 2009 21:40:11 +0100"  >&lt;p&gt;Hm.. okay, I&apos;ve got back to work on this patch. To fix tests relying on getting SR from IR.open() on trunk I introduced a package-private utility method that extracts SR from MSR if it is the only one there. The tests in tags/XXX don&apos;t see this method, should I backport it somewhere there?&lt;/p&gt;</comment>
                    <comment id="12715676" author="mikemccand" created="Tue, 2 Jun 2009 21:46:04 +0100"  >&lt;p&gt;You can add a stub method (matches signature but does nothing) to src/java in the back-compat branch, just so the tests compile.  The back-compat tests run against the trunk&apos;s jar.&lt;/p&gt;</comment>
                    <comment id="12715721" author="earwin" created="Tue, 2 Jun 2009 23:21:19 +0100"  >&lt;p&gt;Here are the patches for current lucene trunk and back compat tag.&lt;/p&gt;</comment>
                    <comment id="12715777" author="mikemccand" created="Wed, 3 Jun 2009 03:02:29 +0100"  >&lt;p&gt;I&apos;m hitting compilation errors:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
common.compile-core:
    [mkdir] Created dir: /lucene/src/msr.1651/build/classes/java
    [javac] Compiling 374 source files to /lucene/src/msr.1651/build/classes/java
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:419: directory has &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; access in org.apache.lucene.index.IndexReader
    [javac]     instance.directory = dir;
    [javac]             ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:420: cannot find symbol
    [javac] symbol  : variable readOnly
    [javac] location: class org.apache.lucene.index.SegmentReader
    [javac]     instance.readOnly = readOnly;
    [javac]             ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:562: cannot find symbol
    [javac] symbol  : variable readOnly
    [javac] location: class org.apache.lucene.index.SegmentReader
    [javac]       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; clone(readOnly); &lt;span class=&quot;code-comment&quot;&gt;// Preserve current readOnly
&lt;/span&gt;    [javac]                    ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:588: cannot find symbol
    [javac] symbol  : variable readOnly
    [javac] location: class org.apache.lucene.index.SegmentReader
    [javac]     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (normsUpToDate &amp;amp;&amp;amp; deletionsUpToDate &amp;amp;&amp;amp; !doClone &amp;amp;&amp;amp; openReadOnly &amp;amp;&amp;amp; readOnly) {
    [javac]                                                                           ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:611: cannot find symbol
    [javac] symbol  : variable readOnly
    [javac] location: class org.apache.lucene.index.SegmentReader
    [javac]       clone.readOnly = openReadOnly;
    [javac]            ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:612: directory has &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; access in org.apache.lucene.index.IndexReader
    [javac]       clone.directory = directory;
    [javac]            ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:612: directory has &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; access in org.apache.lucene.index.IndexReader
    [javac]       clone.directory = directory;
    [javac]                         ^
    [javac] /lucene/src/msr.1651/src/java/org/apache/lucene/index/SegmentReader.java:1214: directory has &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; access in org.apache.lucene.index.IndexReader
    [javac]     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; directory;
    [javac]            ^
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details.
    [javac] 8 errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12715836" author="earwin" created="Wed, 3 Jun 2009 07:38:17 +0100"  >&lt;p&gt;Seems the patch didn&apos;t apply completely. Your line numbers are off, also directory/readOnly are now members of SegmentReader, no way they can&apos;t be seen:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
class SegmentReader &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; IndexReader &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Cloneable&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Directory directory;
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; readOnly;

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; segment;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SegmentInfo si;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; readBufferSize;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s corresponding part of the patch, I bet $Id$ is the reason.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-/**
- * @version $Id$
- */
-class SegmentReader &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DirectoryIndexReader {
+/** @version $Id$ */
+class SegmentReader &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; IndexReader &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Cloneable&lt;/span&gt; {
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Directory directory;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; readOnly;
+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12715888" author="mikemccand" created="Wed, 3 Jun 2009 11:12:21 +0100"  >&lt;p&gt;Hmm &amp;#8211; let me figure out what happened.  Sorry for the false alarm!&lt;/p&gt;</comment>
                    <comment id="12715900" author="mikemccand" created="Wed, 3 Jun 2009 11:58:45 +0100"  >&lt;p&gt;OK, I had one hunk fail in SegmentReader.java patch; once I fixed that, t&apos;sall good.&lt;/p&gt;

&lt;p&gt;Patch looks good Earwin, thanks!&lt;/p&gt;

&lt;p&gt;I think we should now rename MultiSegmentReader to DirectoryIndexReader?&lt;/p&gt;</comment>
                    <comment id="12715908" author="earwin" created="Wed, 3 Jun 2009 12:42:48 +0100"  >&lt;blockquote&gt;&lt;p&gt;Patch looks good Earwin, thanks!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe the readers can be cleaned up further, but I&apos;m short on time and don&apos;t want to delay it for another week or two, and then rebase it against updated trunk once again. Might as well do that under a separate issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we should now rename MultiSegmentReader to DirectoryIndexReader?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe DirectoryReader instead of DirectoryIndexReader? But all three are in fact okay with me, I really don&apos;t have any preference here.&lt;/p&gt;</comment>
                    <comment id="12715935" author="mikemccand" created="Wed, 3 Jun 2009 15:20:51 +0100"  >&lt;p&gt;Let&apos;s just go w/ DirectoryReader?  Can you post a new patch w/ that?  Thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I believe the readers can be cleaned up further, but I&apos;m short on time and don&apos;t want to delay it for another week or two, and then rebase it against updated trunk once again. Might as well do that under a separate issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed!  Progress not perfection.&lt;/p&gt;</comment>
                    <comment id="12715964" author="earwin" created="Wed, 3 Jun 2009 17:02:15 +0100"  >&lt;p&gt;Argh! The rename broke test-tag again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; in new and innovative ways.&lt;br/&gt;
New patches attached.&lt;/p&gt;</comment>
                    <comment id="12715969" author="earwin" created="Wed, 3 Jun 2009 17:15:44 +0100"  >&lt;p&gt;One more version, applies against current trunk without fuzzy hunk matching.&lt;/p&gt;</comment>
                    <comment id="12716004" author="mikemccand" created="Wed, 3 Jun 2009 18:44:33 +0100"  >&lt;p&gt;OK patch looks good. I plan to commit in a day or two. Thanks Earwin!&lt;/p&gt;</comment>
                    <comment id="12717051" author="mikemccand" created="Sun, 7 Jun 2009 17:34:01 +0100"  >&lt;p&gt;Thanks Earwin!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10001">
                <name>dependent</name>
                                                <inwardlinks description="is depended upon by">
                            <issuelink>
            <issuekey id="12425944">LUCENE-1648</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12409786" name="LUCENE-1651.patch" size="164910" author="earwin" created="Wed, 3 Jun 2009 17:15:44 +0100" />
                    <attachment id="12409781" name="LUCENE-1651.patch" size="164910" author="earwin" created="Wed, 3 Jun 2009 17:02:15 +0100" />
                    <attachment id="12409711" name="LUCENE-1651.patch" size="93671" author="earwin" created="Tue, 2 Jun 2009 23:21:19 +0100" />
                    <attachment id="12408713" name="LUCENE-1651.patch" size="94252" author="earwin" created="Thu, 21 May 2009 16:58:11 +0100" />
                    <attachment id="12409782" name="LUCENE-1651-tag.patch" size="17238" author="earwin" created="Wed, 3 Jun 2009 17:02:15 +0100" />
                    <attachment id="12409712" name="LUCENE-1651-tag.patch" size="10723" author="earwin" created="Tue, 2 Jun 2009 23:21:19 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 21 May 2009 16:05:20 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12107</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26076</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>