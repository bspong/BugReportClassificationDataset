<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:02 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3433/LUCENE-3433.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3433] Random access non RAM resident IndexDocValues (CSF)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3433</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;There should be a way to get specific IndexDocValues by going through the Directory rather than loading all of the values into memory.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12522953">LUCENE-3433</key>
            <summary>Random access non RAM resident IndexDocValues (CSF)</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Sep 2011 21:52:09 +0100</created>
                <updated>Fri, 10 May 2013 11:44:33 +0100</updated>
                    <resolved>Fri, 7 Oct 2011 10:06:09 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13103988" author="simonw" created="Tue, 13 Sep 2011 22:07:46 +0100"  >&lt;p&gt;yonik, do we really need random access? we already have an enum for on disk lookups which is essentially a DocIDSetIterator.&lt;/p&gt;</comment>
                    <comment id="13104049" author="rcmuir" created="Tue, 13 Sep 2011 23:37:28 +0100"  >&lt;p&gt;Simon: I think it would be a really nice feature.&lt;/p&gt;

&lt;p&gt;Imagine someone that has a large collection and maybe quite a few docvalues fields:&lt;br/&gt;
it would be nice if you have a fixed int64 docvalues for it to just be a mmap&apos;ed readLong() for example.&lt;/p&gt;

&lt;p&gt;I think in a lot of cases the memory resident random-access that we have now is going to be great, e.g.&lt;br/&gt;
if someone wants to use it for a scoring factor and its going to be super-hot.&lt;/p&gt;

&lt;p&gt;but in other more advanced cases (especially if you have many of them or access is relatively infrequent)&lt;br/&gt;
it would be a nice option to have available where currently you have to deal with the downsides of &lt;br/&gt;
&apos;fake terms&apos; with a payload or stored fields.&lt;/p&gt;</comment>
                    <comment id="13104079" author="jasonrutherglen" created="Wed, 14 Sep 2011 00:40:41 +0100"  >&lt;p&gt;This is somewhat funny, as it seems the opinion has changed on MMap&apos;ing and the potential for page faults:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.lucidimagination.com/search/document/8951a336dffa9535/storing_and_loading_the_fst_directly_from_disk#8951a336dffa9535&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/8951a336dffa9535/storing_and_loading_the_fst_directly_from_disk#8951a336dffa9535&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13104091" author="rcmuir" created="Wed, 14 Sep 2011 01:15:22 +0100"  >&lt;p&gt;no opinion has changed: traversing on disk automata in the way you describe is inefficient. &lt;/p&gt;

&lt;p&gt;here I describe accessing a fixed long value: 1 seek per access.&lt;/p&gt;

&lt;p&gt;how many seeks will an fst lookup take? hint: its more than 1!&lt;/p&gt;</comment>
                    <comment id="13104165" author="jasonrutherglen" created="Wed, 14 Sep 2011 03:05:18 +0100"  >&lt;p&gt;Here&apos;s another thread discussing MMap&apos;ing and field caches, where the consensus is against it:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.lucidimagination.com/search/document/70623ef5879bca38/fst_and_fieldcache#45006a7fe2847c09&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/70623ef5879bca38/fst_and_fieldcache#45006a7fe2847c09&lt;/a&gt; posted in &quot;1969-12-31 19:00&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13104184" author="rcmuir" created="Wed, 14 Sep 2011 03:38:43 +0100"  >&lt;p&gt;this isn&apos;t the field cache.&lt;/p&gt;</comment>
                    <comment id="13119998" author="simonw" created="Tue, 4 Oct 2011 11:40:52 +0100"  >&lt;p&gt;I looked at the code and figured that there is actually not much difference implementation wise to random access vs. advance(). I basically renamed int advance(int) to int seek(int) which has similar semantics as advance has but can do seek forward and backwards. I think we can go with such an approach since we still have advance etc. and implementation wise there is not much overhead.&lt;/p&gt;</comment>
                    <comment id="13120734" author="simonw" created="Wed, 5 Oct 2011 08:32:23 +0100"  >&lt;p&gt;any comments on the patch here? If nobody objects I am going to commit this later today.&lt;/p&gt;</comment>
                    <comment id="13120737" author="cmale" created="Wed, 5 Oct 2011 08:44:35 +0100"  >&lt;p&gt;I don&apos;t have any particular comments on the implementation, but I really like the seek() API, its nice and clear so +1 to committing.&lt;/p&gt;</comment>
                    <comment id="13120787" author="mikemccand" created="Wed, 5 Oct 2011 11:02:36 +0100"  >&lt;p&gt;Do we have any DV enum impls that cannot move backwards?  If not, maybe we should just remove advance() and only have seek()?&lt;/p&gt;</comment>
                    <comment id="13120794" author="rcmuir" created="Wed, 5 Oct 2011 11:10:54 +0100"  >&lt;p&gt;Maybe we should take a look at the bigger picture: perhaps DocValues should really just be&lt;br/&gt;
a ByteBuffer where offsets are docids, maybe even just using ByteBuffer etc API?&lt;/p&gt;

&lt;p&gt;Personally i think the seek() versus advance() is overkill, I think having DISI-like enums&lt;br/&gt;
doesn&apos;t really make sense for CSF (which is random access by definition), it only&lt;br/&gt;
needs get(int) apis.&lt;/p&gt;
</comment>
                    <comment id="13120807" author="simonw" created="Wed, 5 Oct 2011 11:24:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;Maybe we should take a look at the bigger picture: perhaps DocValues should really just be&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;a ByteBuffer where offsets are docids, maybe even just using ByteBuffer etc API?&lt;/p&gt;

&lt;p&gt;this looks like a very big change to me. you should open an issue and uplaod a patch so we can see how that looks like for variable bytes etc.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Personally i think the seek() versus advance() is overkill, I think having DISI-like enums&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;doesn&apos;t really make sense for CSF (which is random access by definition), it only&lt;br/&gt;
needs get(int) apis.&lt;/p&gt;

&lt;p&gt;I figured adding this is a quick win. I&apos;d rather refine the API in a different issue?&lt;/p&gt;</comment>
                    <comment id="13120812" author="rcmuir" created="Wed, 5 Oct 2011 11:31:27 +0100"  >&lt;blockquote&gt;
&lt;p&gt;this looks like a very big change to me. you should open an issue and uplaod a patch so we can see how that looks like for variable bytes etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well this is just discussion? Basically I&apos;m trying to shoot for some simplification here.&lt;/p&gt;

&lt;p&gt;As far as variable bytes, maybe DocValues shouldn&apos;t actually implement variable bytes,&lt;br/&gt;
but instead is used only to implement the docid -&amp;gt; offset part. In other words, the variable bytes&lt;br/&gt;
is basically like stored fields today, and docvalues just does the FDX part. This means&lt;br/&gt;
docvalues doesnt need a variable bytes impl at all, you just use a Long impl.&lt;/p&gt;

&lt;p&gt;For the &quot;FDT&quot; part of variable bytes we could have something else? then this would simplify&lt;br/&gt;
DocValues some more and narrow its scope.&lt;/p&gt;</comment>
                    <comment id="13120824" author="simonw" created="Wed, 5 Oct 2011 11:50:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;Well this is just discussion? Basically I&apos;m trying to shoot for some simplification here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;to this seems like a major rewrite and far more than this issue, no? Can you create a new issue for this &amp;amp; the discussion&lt;/p&gt;</comment>
                    <comment id="13120826" author="rcmuir" created="Wed, 5 Oct 2011 11:59:12 +0100"  >&lt;p&gt;I don&apos;t know, to me it seems to fit this issue perfectly.&lt;/p&gt;

&lt;p&gt;If we are looking at CSF as a random-access per-doc value, then I&apos;m just suggesting perhaps&lt;br/&gt;
the APIs should reflect its random-access-ness... just a get(int docid) basically.&lt;/p&gt;

&lt;p&gt;we dont have to do this immediately, we can add seek to the enums like you did for now,&lt;br/&gt;
though i&apos;m slightly concerned this would make it more difficult to nuke the enums later if&lt;br/&gt;
we decide to try to simplify the APIs much later down the road, but this isn&apos;t a big deal.&lt;/p&gt;</comment>
                    <comment id="13120839" author="thetaphi" created="Wed, 5 Oct 2011 12:29:24 +0100"  >&lt;p&gt;I agree, the DocValues should be designed to be random access from the beginning, Iterators just look wrong. We can supply them on top, but the basic API should look like ByteBuffer, FloatBuffer, IntBuffer,...&lt;/p&gt;</comment>
                    <comment id="13120892" author="yseeley@gmail.com" created="Wed, 5 Oct 2011 13:41:41 +0100"  >&lt;p&gt;A faster short-term &quot;expert level&quot; API for fixed width values would be to just allow the retrieval of the underlying IndexInput (and return null if not supported so we don&apos;t box ourselves in).  Then a getLong() for example, would go right to ByteBuffer.getLong() (for the mmap directory) and avoid extra checking and copying to another BytesRef.&lt;/p&gt;

&lt;p&gt;Anyway, it would be nice to eventually have something closer to the metal in the spirit of the bulk-api branch that doesn&apos;t impose per-call bounds checking and other book keeping like advance() currently does (I can see Uwe cringing now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Aside: in FixedStraightBytesEnum, I see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (target &amp;gt;= maxDoc || size == 0) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The size==0 check shouldn&apos;t be needed, right?&lt;/p&gt;</comment>
                    <comment id="13120914" author="ab" created="Wed, 5 Oct 2011 13:55:34 +0100"  >&lt;p&gt;Random access is also important if we want to use DocValues instead of norms.&lt;/p&gt;</comment>
                    <comment id="13121126" author="simonw" created="Wed, 5 Oct 2011 17:48:48 +0100"  >&lt;blockquote&gt;&lt;p&gt;Random access is also important if we want to use DocValues instead of norms.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;we have random access already for in memory source.&lt;/p&gt;

&lt;p&gt;To simplify this here a bit we could remove ValuesEnum and use Source also for on disk access. The source API is already pretty much like ByteBuffer etc but provides the flexibility we need on the impl level.&lt;/p&gt;
</comment>
                    <comment id="13121132" author="simonw" created="Wed, 5 Oct 2011 17:55:52 +0100"  >&lt;p&gt;This patch removes all uses of ValuesEnum and adds a IndexDocValues#getDirectSource() which provides direct access without loading into memory. This patch also removes all bounds checks and improves on disk access on several variants. &lt;/p&gt;

&lt;p&gt;its still a bit rough but reflects the idea. However, this patch also removes the sorted variant for efficiency reasons. Currently those variant require a lot of memory during merge as well as a sep. interface (sortedSource) which adds another complexity to the API. With this patch we only have a single API (Source) which is a good start to further improve this.&lt;/p&gt;</comment>
                    <comment id="13121151" author="rcmuir" created="Wed, 5 Oct 2011 18:06:10 +0100"  >&lt;p&gt;I like the direction of this patch!&lt;/p&gt;</comment>
                    <comment id="13121167" author="mikemccand" created="Wed, 5 Oct 2011 18:21:28 +0100"  >&lt;blockquote&gt;&lt;p&gt;However, this patch also removes the sorted variant for efficiency reasons. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wait, we lose SortedSource entirely?  Or just for getDirectSource?&lt;/p&gt;

&lt;p&gt;Can we break out that lossage as a separate issue?  (I don&apos;t think we&lt;br/&gt;
should drop it?).  Or is it somehow coupled to removal of the enums?&lt;/p&gt;

&lt;p&gt;This value type is useful for apps that want to sort by string field,&lt;br/&gt;
without paying the high uninversion-on-reader-init that you now pay&lt;br/&gt;
(to use FieldCache).  Grouping should also cutover to this (away&lt;br/&gt;
from FieldCache).&lt;/p&gt;</comment>
                    <comment id="13121172" author="rcmuir" created="Wed, 5 Oct 2011 18:23:45 +0100"  >&lt;blockquote&gt;
&lt;p&gt;This value type is useful for apps that want to sort by string field,&lt;br/&gt;
without paying the high uninversion-on-reader-init that you now pay&lt;br/&gt;
(to use FieldCache). Grouping should also cutover to this (away&lt;br/&gt;
from FieldCache).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is bogus? If you have high-turnaround/NRT you are gonna pay the price to uninvert somewhere,&lt;br/&gt;
so it doesnt matter where you do it.&lt;/p&gt;

&lt;p&gt;If you don&apos;t, then you shouldnt be closing your IndexReader and reopening the same one again.&lt;/p&gt;

&lt;p&gt;+1 to drop SortedSource&lt;/p&gt;</comment>
                    <comment id="13121360" author="simonw" created="Wed, 5 Oct 2011 19:54:41 +0100"  >&lt;blockquote&gt;&lt;p&gt;Wait, we lose SortedSource entirely? Or just for getDirectSource?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;SortedSource or rather its impls. are hairy and horribly inefficient during merge. They only support 2GB max. and load everything into heap memory during merge. I think we can make this more efficient but as long as it is using so much memory we shouldn&apos;t release this. I am going to create another issue we can pick up later with a patch that contains the sorted source impls we have today. we can then pick it up from there.&lt;/p&gt;
</comment>
                    <comment id="13121410" author="mikemccand" created="Wed, 5 Oct 2011 20:59:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;SortedSource or rather its impls. are hairy and horribly inefficient during merge. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well let&apos;s address that (&quot;remove SortedSource&quot;) under a different issue?  I don&apos;t think we should remove them here because it&apos;s unrelated (there are other great simplifications here).&lt;/p&gt;

&lt;p&gt;I&apos;m all for simplifying, but not if we lose good functionality (cut into the bone).&lt;/p&gt;

&lt;p&gt;Loading everything into heap can be solved, but, I think is relatively low priority because that&apos;s how the search app would use sorted DV at search time anyway.  Ie, an app sets this on their &quot;country&quot; field because they know they want to sort by &quot;country&quot; at search time, and they will load the DV into RAM at search time.  We only hold this RAM allocated while we merge the one field, then it&apos;s freed, so if multiple DV sort fields are used, merging takes less RAM than searching.  I think the merge RAM usage is relatively minor.&lt;/p&gt;

&lt;p&gt;The SortedSource has a simple API (just like FC.DocTermsIndex): getOrd(int docID), getValue(int ord).  I don&apos;t see why this is adding complexity to DV.&lt;/p&gt;</comment>
                    <comment id="13121413" author="rcmuir" created="Wed, 5 Oct 2011 21:05:07 +0100"  >&lt;p&gt;I agree with simon here, can&apos;t we spin off a different issue for these?&lt;/p&gt;

&lt;p&gt;Seems like this is really a higher level thing that belongs on a fieldcache issue, in my opinion docvalues should just be per-document values... &lt;br/&gt;
(i think its great if we can use it under the covers to speed up some use case: not sure one exists here...)&lt;/p&gt;

&lt;p&gt;I would rather we simplify docvalues behind the scenes, allow it to grow and mature iteratively on its own without shoving fieldcache into it.&lt;/p&gt;</comment>
                    <comment id="13121822" author="simonw" created="Thu, 6 Oct 2011 11:22:50 +0100"  >&lt;p&gt;here is a new patch containing a bunch of cleanup and javadocs. &lt;/p&gt;

&lt;p&gt;I also attached a patch that adds back the sorted source so we can spin off a new issue and make them efficient without writing it from the scratch.&lt;/p&gt;

&lt;p&gt;this one seems close / ready.&lt;/p&gt;</comment>
                    <comment id="13121830" author="mikemccand" created="Thu, 6 Oct 2011 11:53:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;I agree with simon here, can&apos;t we spin off a different issue for these?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1: I agree removal of SortedSource is unrelated to this issue.  We&lt;br/&gt;
should discuss it under a new issue (it&apos;s obviously contentious), and&lt;br/&gt;
for this issue do the nice cleanups we all agree on.  It shouldn&apos;t be&lt;br/&gt;
removed under this one.&lt;/p&gt;

&lt;p&gt;One shouldn&apos;t have to pay such a high price (uninversion on searcher&lt;br/&gt;
startup) to sort or group by a string field, which we do today.  It&apos;s&lt;br/&gt;
silly to re-invert on every searcher startup when we can sort once&lt;br/&gt;
during indexing and record that in the doc values, and SortedSource&lt;br/&gt;
gives us that.&lt;/p&gt;

&lt;p&gt;Besides the merge RAM usage (which I think is minor) is there a&lt;br/&gt;
technical/code complexity reason that SortedSource should be removed?&lt;br/&gt;
Does it somehow require the enums or something?  I&apos;m trying to&lt;br/&gt;
understand how/why it suddenly got coupled into this issue...&lt;/p&gt;

&lt;p&gt;I think sorting and grouping by string fields are first class&lt;br/&gt;
functions for Lucene.&lt;/p&gt;</comment>
                    <comment id="13121831" author="mikemccand" created="Thu, 6 Oct 2011 11:54:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;I also attached a patch that adds back the sorted source so we can spin off a new issue and make them efficient without writing it from the scratch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Simon, can you invert this patch, and open a new issue for removing&lt;br/&gt;
SortedSource?&lt;/p&gt;</comment>
                    <comment id="13121840" author="martijn.v.groningen" created="Thu, 6 Oct 2011 12:03:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think sorting and grouping by string fields are first class functions for Lucene.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;And faceting too!&lt;/p&gt;

&lt;p&gt;Maybe we should have DocTermIndex that is independent of source and have impls for DV and impls for indexed values.&lt;br/&gt;
Maybe the name DocTermIndex doesn&apos;t make sense then, because it suggests that values come from the inverted index which might not be the case.&lt;/p&gt;</comment>
                    <comment id="13121859" author="rcmuir" created="Thu, 6 Oct 2011 12:34:22 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I think sorting and grouping by string fields are first class&lt;br/&gt;
functions for Lucene.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree: if you aren&apos;t sorting by score, then go use a database.&lt;/p&gt;</comment>
                    <comment id="13121860" author="simonw" created="Thu, 6 Oct 2011 12:36:47 +0100"  >&lt;blockquote&gt;&lt;p&gt;Simon, can you invert this patch, and open a new issue for removing SortedSource?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;actually my plan was to have one iterface for now and then open an issue to add back the SortedSource with an impl that we all agree on. Currently, the sorted variants are somewhat flaky and heavy I think we should simply remove it here and then go and work out a plan how to implement this. The technical reason here is simply to rethink the interface, we now have one which is simple so let see what we can do to make this work with sorted variants. &lt;/p&gt;

&lt;p&gt;simon&lt;/p&gt;</comment>
                    <comment id="13121862" author="rcmuir" created="Thu, 6 Oct 2011 12:44:03 +0100"  >&lt;blockquote&gt;
&lt;p&gt;+1: I agree removal of SortedSource is unrelated to this issue. We&lt;br/&gt;
should discuss it under a new issue (it&apos;s obviously contentious), and&lt;br/&gt;
for this issue do the nice cleanups we all agree on. It shouldn&apos;t be&lt;br/&gt;
removed under this one.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats not what i meant by spin off a different issue, i think we should&lt;br/&gt;
spin off a different issue to add back SortedSource.&lt;/p&gt;

&lt;p&gt;Docvalues really needs to be simplified, Simon has done just that, and I think&lt;br/&gt;
its great as a part of that that it focuses on what it should be, thats per-document values,&lt;br/&gt;
not being some precomputed FieldCache.&lt;/p&gt;
</comment>
                    <comment id="13121884" author="markrmiller@gmail.com" created="Thu, 6 Oct 2011 13:34:46 +0100"  >&lt;blockquote&gt;&lt;p&gt;I agree removal of SortedSource is unrelated to this issue. We&lt;br/&gt;
should discuss it under a new issue (it&apos;s obviously contentious), and&lt;br/&gt;
for this issue do the nice cleanups we all agree on. It shouldn&apos;t be&lt;br/&gt;
removed under this one.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 - something contentious should not be removed in an unrelated issue like this. If it&apos;s already in, but some want it out, let&apos;s make an a new issue to discuss. Once something is in, there should be a clear and dedicated issue discussing it&apos;s removal if there is dispute. I don&apos;t agree with simply pulling it and putting the onus on those who want it to make an issue to get it back in.&lt;/p&gt;</comment>
                    <comment id="13121911" author="simonw" created="Thu, 6 Oct 2011 14:11:03 +0100"  >&lt;blockquote&gt;&lt;p&gt;+1 - something contentious should not be removed in an unrelated issue like this. If it&apos;s already in, but some want it out, let&apos;s make an a new issue to discuss. Once something is in, there should be a clear and dedicated issue discussing it&apos;s removal if there is dispute. I don&apos;t agree with simply pulling it and putting the onus on those who want it to make an issue to get it back in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;there is no dispute here If you&apos;d have looked at the API and the code you&apos;d know what I talk about though. We cut over to a new api where sorted source doesn&apos;t fit in nicely. We had ValuesEnum used for merging as the LCD between SortedSource and Source. Now we only have Source as a RandomAccess API. To keep this at a reasonable size we should try to add the missing part in a different issue. We should also rethink how to merge sortd sources since they are quite mem heavy (I think this is a potential issue). Adding back SortedSource is going to be tough without a new issue since lots of stuff has changed. To make this dev process easier backing out and re-adding seems best to me. Don&apos;t worry we gonna add it back though.&lt;/p&gt;</comment>
                    <comment id="13121918" author="markrmiller@gmail.com" created="Thu, 6 Oct 2011 14:17:26 +0100"  >&lt;blockquote&gt;&lt;p&gt;there is no dispute here&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If there is no dispute, what exactly is Mike talking about?&lt;/p&gt;</comment>
                    <comment id="13121935" author="rcmuir" created="Thu, 6 Oct 2011 14:25:08 +0100"  >&lt;p&gt;Here is the way i see the problem:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Currently docvalues is a bit confusing... I think a lot of this is due to the current API&lt;/li&gt;
	&lt;li&gt;no offense to simon but i think in a way this forces him to feel responsible for doing all work on it. The complexity makes it hard for others to get involved.&lt;/li&gt;
	&lt;li&gt;with this patch, the api becomes a lot simpler: i&apos;m sure its not perfect but the API seems to correspond to what DV does, at least it makes sense to me.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;can we temporarily drop SortedSource, open a new issue to add it back (mark it blocker for 4.0 even?!). This way, we can rethink how to implement this functionality (maybe it doesnt even belong as docvalues but something on top of it, or something else entirely).&lt;/p&gt;</comment>
                    <comment id="13122037" author="simonw" created="Thu, 6 Oct 2011 17:12:51 +0100"  >&lt;p&gt;here we go.. the make everybody happy patch! I added SortedSource back and integrated it into the Source pattern for random access. we now have an entirely disk resident SortedSource impl for both variants and a single interface in the first place. SortedSource instance can be obtained via Source#asSortedSource() which returns null if the source is not sorted. With this random access DirectSortedSource we can also improve the merging for sorted sources which was one of my major issues here.&lt;/p&gt;</comment>
                    <comment id="13122130" author="mikemccand" created="Thu, 6 Oct 2011 19:17:39 +0100"  >&lt;p&gt;Thanks Simon!  I&apos;ll look through the patch... it&apos;s a great cleanup.&lt;/p&gt;</comment>
                    <comment id="13122312" author="mikemccand" created="Thu, 6 Oct 2011 22:23:33 +0100"  >&lt;p&gt;Patch is awesome Simon; thank you.&lt;/p&gt;

&lt;p&gt;Only thing I noticed: can you fix SortedSource.numOrds back to .getValueCount?&lt;/p&gt;

&lt;p&gt;+1 to commit!&lt;/p&gt;</comment>
                    <comment id="13122615" author="simonw" created="Fri, 7 Oct 2011 09:27:33 +0100"  >&lt;blockquote&gt;&lt;p&gt;Only thing I noticed: can you fix SortedSource.numOrds back to .getValueCount?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yeah thats the better name though - no idea why I changed that though.... anyway I will commit this soon if nobody objects.&lt;/p&gt;

&lt;p&gt;simon&lt;/p&gt;</comment>
                    <comment id="13122635" author="cmale" created="Fri, 7 Oct 2011 09:57:18 +0100"  >&lt;p&gt;Having the simpler interface seems like a great achievement.  I love that we can keep SortedSource.&lt;/p&gt;

&lt;p&gt;+1 to committing.&lt;/p&gt;</comment>
                    <comment id="13122644" author="simonw" created="Fri, 7 Oct 2011 10:06:09 +0100"  >&lt;p&gt;committed in rev. 1179970&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12498023" name="LUCENE-3433.patch" size="196563" author="simonw" created="Thu, 6 Oct 2011 17:12:51 +0100" />
                    <attachment id="12497968" name="LUCENE-3433.patch" size="186642" author="simonw" created="Thu, 6 Oct 2011 11:22:50 +0100" />
                    <attachment id="12497814" name="LUCENE-3433.patch" size="138745" author="simonw" created="Wed, 5 Oct 2011 17:55:52 +0100" />
                    <attachment id="12497612" name="LUCENE-3433.patch" size="29953" author="simonw" created="Tue, 4 Oct 2011 11:40:52 +0100" />
                    <attachment id="12497969" name="sorted_source.patch" size="50192" author="simonw" created="Thu, 6 Oct 2011 11:22:50 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 13 Sep 2011 21:07:46 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2953</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24263</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>