<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:24:35 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2955/LUCENE-2955.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2955] Add utitily class to manage NRT reopening</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2955</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I created a simple class, NRTManager, that tries to abstract away some&lt;br/&gt;
of the reopen logic when using NRT readers.&lt;/p&gt;

&lt;p&gt;You give it your IW, tell it min and max nanoseconds staleness you can&lt;br/&gt;
tolerate, and it privately runs a reopen thread to periodically reopen&lt;br/&gt;
the searcher.&lt;/p&gt;

&lt;p&gt;It subsumes the SearcherManager from LIA2.  Besides running the reopen&lt;br/&gt;
thread, it also adds the notion of a &quot;generation&quot; containing changes&lt;br/&gt;
you&apos;ve made.  So eg it has addDocument, returning a long.  You can&lt;br/&gt;
then take that long value and pass it back to the getSearcher method&lt;br/&gt;
and getSearcher will return a searcher that reflects the changes made&lt;br/&gt;
in that generation.&lt;/p&gt;

&lt;p&gt;This gives your app the freedom to force &quot;immediate&quot; consistency (ie&lt;br/&gt;
wait for the reopen) only for those searches that require it, like a&lt;br/&gt;
verifier that adds a doc and then immediately searches for it, but&lt;br/&gt;
also use &quot;eventual consistency&quot; for other searches.&lt;/p&gt;

&lt;p&gt;I want to also add support for the new &quot;applyDeletions&quot; option when&lt;br/&gt;
pulling an NRT reader.&lt;/p&gt;

&lt;p&gt;Also, this is very new and I&apos;m sure buggy &amp;#8211; the concurrency is either&lt;br/&gt;
wrong over overly-locking.  But it&apos;s a start...&lt;/p&gt;</description>
                <environment></environment>
            <key id="12500907">LUCENE-2955</key>
            <summary>Add utitily class to manage NRT reopening</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2011 16:55:51 +0000</created>
                <updated>Sat, 2 Jul 2011 03:40:15 +0100</updated>
                    <resolved>Tue, 14 Jun 2011 17:10:10 +0100</resolved>
                                            <fixVersion>3.3</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13004650" author="mikemccand" created="Wed, 9 Mar 2011 16:59:46 +0000"  >&lt;p&gt;Patch.&lt;/p&gt;

&lt;p&gt;The sources are in Lucene core now but I think we should commit into contrib somewhere since this is really a &quot;wrapper&quot; around core APIs.&lt;/p&gt;</comment>
                    <comment id="13043562" author="rcmuir" created="Fri, 3 Jun 2011 17:40:48 +0100"  >&lt;p&gt;bulk move 3.2 -&amp;gt; 3.3&lt;/p&gt;</comment>
                    <comment id="13046251" author="mikemccand" created="Wed, 8 Jun 2011 23:00:28 +0100"  >&lt;p&gt;New patch; I think it&apos;s ready to commit.&lt;/p&gt;

&lt;p&gt;You can now specify, when requesting the new searcher, whether deletes must have been applied.&lt;/p&gt;</comment>
                    <comment id="13046496" author="simonw" created="Thu, 9 Jun 2011 13:15:24 +0100"  >&lt;p&gt;Mike, nice work so far &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I have to admit that I really don&apos;t like the reopen thread. I think reopen in the background should be abstracted and the Reopen thread should not be part of the core manager. By default I think we should consult a ReopenStrategy on change and hijack indexing threads to reopen the reader. we can still sychronized the reopeing with a lock.tryLock() and by default go with a timed reopen policy. Thoughts?&lt;/p&gt;

&lt;p&gt;simon&lt;/p&gt;</comment>
                    <comment id="13046518" author="cmale" created="Thu, 9 Jun 2011 14:07:03 +0100"  >&lt;p&gt;I agree with Simon.  I think providing a ReopenStrategy abstraction will be helpful.  &lt;/p&gt;</comment>
                    <comment id="13046644" author="jasonrutherglen" created="Thu, 9 Jun 2011 17:02:00 +0100"  >&lt;p&gt;Perhaps we can merge this functionality with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2565&quot; title=&quot;Prevent IW#close and cut over to IW#commit&quot;&gt;&lt;del&gt;SOLR-2565&lt;/del&gt;&lt;/a&gt; and/or &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2566&quot; title=&quot;Add NRT support to SOLR&quot;&gt;&lt;del&gt;SOLR-2566&lt;/del&gt;&lt;/a&gt;, such that Solr utilizes it for reader opening.  However why would this issue use a background thread and Solr performs a max time reopen?&lt;/p&gt;</comment>
                    <comment id="13046889" author="mikemccand" created="Thu, 9 Jun 2011 23:50:52 +0100"  >
&lt;p&gt;OK, new patch, folding in Simon&apos;s &amp;amp; Chris&apos;s feedback (thanks!).&lt;/p&gt;

&lt;p&gt;I pulled out the reopen thread into a separate class, so that one can&lt;br/&gt;
now instantiate NRTManager but do their own reopening (no bg reopen&lt;br/&gt;
thread).  So eg if you want to hijack indexing threads to do reopen,&lt;br/&gt;
you can.&lt;/p&gt;

&lt;p&gt;But if you want to simply reopen on a periodic basis with the bg&lt;br/&gt;
thread, instantiate NRTManagerReopenThread, passing it the manager and&lt;br/&gt;
your max and min staleness.  Max staleness applies when no caller is&lt;br/&gt;
waiting for a specific indexing change; min applies when one is.&lt;/p&gt;

&lt;p&gt;I didn&apos;t implement a ReopenStrategy... I think that should live&lt;br/&gt;
&quot;above&quot; this class.  But, I did add a WaitingListener so that such a&lt;br/&gt;
reopener reopener can be notified when someone is waiting for a&lt;br/&gt;
specific generation to be visible (NRTManagerReopenThread uses&lt;br/&gt;
that).&lt;/p&gt;</comment>
                    <comment id="13058926" author="rcmuir" created="Sat, 2 Jul 2011 03:40:15 +0100"  >&lt;p&gt;bulk close for 3.3&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12481991" name="LUCENE-2955.patch" size="50321" author="mikemccand" created="Thu, 9 Jun 2011 23:50:52 +0100" />
                    <attachment id="12481875" name="LUCENE-2955.patch" size="44747" author="mikemccand" created="Wed, 8 Jun 2011 23:00:28 +0100" />
                    <attachment id="12473160" name="LUCENE-2955.patch" size="23272" author="mikemccand" created="Wed, 9 Mar 2011 16:59:46 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 3 Jun 2011 16:40:48 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10921</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24737</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>