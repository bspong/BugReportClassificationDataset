<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:35:45 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-374/LUCENE-374.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-374] You cannot sort on fields that don&apos;t exist</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-374</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;While it&apos;s possible to search for fields that don&apos;t exist (you&apos;ll get 0 hits),  &lt;br/&gt;
you&apos;ll get an exception if you try to sort by a field that has no values. The  &lt;br/&gt;
exception is this:  &lt;/p&gt;

&lt;p&gt;if (termEnum.term() == null) {  &lt;br/&gt;
  throw new RuntimeException (&quot;no terms in field &quot; + field);  &lt;br/&gt;
}  &lt;/p&gt;

&lt;p&gt;I&apos;ll attach a change suggested by Yonik Seeley that removes this exception. &lt;/p&gt;

&lt;p&gt;Also, the if-condition above is incomplete anyway, so currently the exception &lt;br/&gt;
is not always thrown (as termEnum .term() might well be != null but point to a &lt;br/&gt;
term in a different field already)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
            <key id="12314524">LUCENE-374</key>
            <summary>You cannot sort on fields that don&apos;t exist</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="daniel.naber@t-online.de">Daniel Naber</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Apr 2005 07:44:12 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:34 +0100</updated>
                    <resolved>Tue, 14 Feb 2006 06:46:21 +0000</resolved>
                                            <fixVersion>1.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>4</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12322286" author="daniel.naber@t-online.de" created="Sat, 16 Apr 2005 07:45:44 +0100"  >&lt;p&gt;Created an attachment (id=14735)&lt;br/&gt;
patch to remove exception&lt;/p&gt;</comment>
                    <comment id="12322287" author="daniel.naber@t-online.de" created="Sun, 17 Apr 2005 09:57:35 +0100"  >&lt;p&gt;Are there objections against this patch? If not, I&apos;m going to commit it.  &lt;/p&gt;
</comment>
                    <comment id="12322288" author="jakarta@ehatchersolutions.com" created="Sun, 17 Apr 2005 10:04:03 +0100"  >&lt;p&gt;I&apos;d like to have a test case added to Lucene that demonstrates this bug along with this patch that fixes &lt;br/&gt;
it, but other than that I&apos;m +1 on committing - looks reasonable to me.&lt;/p&gt;</comment>
                    <comment id="12322289" author="yseeley@gmail.com" created="Sun, 17 Apr 2005 10:54:22 +0100"  >&lt;p&gt;That fix was just a template.  The changes need to be made in multiple places.&lt;br/&gt;
There are currently 8 RuntimeExceptions thrown in FieldCacheImpl.java&lt;br/&gt;
After a very quick look, it looks like only one is valid.&lt;/p&gt;

&lt;p&gt;The only one I would leave in is: &quot;there are more terms than documents in field&quot;&lt;/p&gt;

&lt;p&gt;Most of them need the same fix.  getAuto() looks like it needs a different fix&lt;br/&gt;
(a default fieldtype if there aren&apos;t any terms).&lt;/p&gt;

&lt;p&gt;For tests, looks like one for each possible fieldtype + auto is needed. &lt;/p&gt;</comment>
                    <comment id="12322290" author="daniel.naber@t-online.de" created="Sun, 17 Apr 2005 20:43:04 +0100"  >&lt;p&gt;I just see that there&apos;s another problem: the exception also occurs when you &lt;br/&gt;
have a field, but it isn&apos;t indexed. I think that&apos;s a common case and these &lt;br/&gt;
cases should not be silently ignored. &lt;/p&gt;</comment>
                    <comment id="12322291" author="yseeley@gmail.com" created="Mon, 18 Apr 2005 00:45:20 +0100"  >&lt;p&gt;&amp;gt; I just see that there&apos;s another problem: the exception also occurs when&lt;br/&gt;
&amp;gt; you have a field, but it isn&apos;t indexed. I think that&apos;s a common case&lt;br/&gt;
&amp;gt; and these cases should not be silently ignored. &lt;/p&gt;

&lt;p&gt;While this condition would be possible to check for, it would lead to some of&lt;br/&gt;
the same inconsistencies and problems as trying to ban sorting on a field that&lt;br/&gt;
doesn&apos;t exist.&lt;/p&gt;

&lt;p&gt;Lucene doesn&apos;t restrict every field with the same name to be of the same type. &lt;br/&gt;
Field &quot;foo&quot; may be indexed for some documents and not indexed for others.  So we&lt;br/&gt;
are back in the same situation of not knowing if the query is a bug, or if it&apos;s&lt;br/&gt;
just that no documents with &quot;foo&quot; indexed currently exist in the index, but may&lt;br/&gt;
in the future or may have in the past.&lt;/p&gt;

&lt;p&gt;Since Lucene is a search engine rather than a search server, we should strive to&lt;br/&gt;
keep it as flexible as possible to enable that many more applications to be&lt;br/&gt;
built on top of it. &lt;/p&gt;

&lt;p&gt;Once this bug is fixed, I think FieldCacheImpl.java should have only one&lt;br/&gt;
RuntimeException remaining.&lt;/p&gt;
</comment>
                    <comment id="12322292" author="daniel.naber@t-online.de" created="Mon, 18 Apr 2005 02:59:35 +0100"  >&lt;p&gt;I now hesitate to commit this patch in its current form, as many people will &lt;br/&gt;
be confused when sorting doesn&apos;t give the right results (because a field isn&apos;t &lt;br/&gt;
indexed) but doesn&apos;t return an error or warning either. I think we need a &lt;br/&gt;
small logging framework inside Lucene to notify the developer about such &lt;br/&gt;
potential problems. &lt;/p&gt;</comment>
                    <comment id="12322293" author="cutting@apache.org" created="Tue, 19 Apr 2005 05:41:44 +0100"  >&lt;p&gt;If someone searches for a field that has no values indexed then they will not&lt;br/&gt;
find anything, and no warning is issued.  Is it that different if they sort by a&lt;br/&gt;
field that has no values indexed?&lt;/p&gt;</comment>
                    <comment id="12322294" author="daniel.naber@t-online.de" created="Tue, 19 Apr 2005 06:02:35 +0100"  >&lt;p&gt;If we just remove the Exceptions, a non-indexed field will be ignored for &lt;br/&gt;
sorting (i.e. it will be treated as if it was empty). So you&apos;d get matches, &lt;br/&gt;
but they probably won&apos;t be sorted the way you expect. This is difficult to &lt;br/&gt;
debug without warnings, especially if there is more than one sort key and only &lt;br/&gt;
some of them are ignored. So yes, I think it&apos;s worse than getting 0 matches, &lt;br/&gt;
which is at least a clear indication that something is wrong. &lt;/p&gt;</comment>
                    <comment id="12322295" author="cutting@apache.org" created="Tue, 19 Apr 2005 06:14:45 +0100"  >&lt;p&gt;Would it be more sensible to throw an exception only if both the sort field is&lt;br/&gt;
unindexed and the search returns zero documents?  In other words, the exception&lt;br/&gt;
could be thrown when the sorter is used, not when it is constructed.&lt;/p&gt;</comment>
                    <comment id="12322296" author="yseeley@gmail.com" created="Tue, 19 Apr 2005 10:57:00 +0100"  >&lt;p&gt;&amp;gt; This is difficult to debug without warnings&lt;/p&gt;

&lt;p&gt;I think these types of checks should be done in a separate place (or at least be&lt;br/&gt;
optional somehow).  There are many other potential problems than sorting on a&lt;br/&gt;
field that doesn&apos;t exist... but all developers shouldn&apos;t have to pay the price&lt;br/&gt;
in overhead or lack of flexibility.&lt;/p&gt;

&lt;p&gt;How about a checkQuery() or a debugQuery() that could check for things like:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;searching on a non-indexed field&lt;/li&gt;
	&lt;li&gt;sorting on a non-indexed field&lt;/li&gt;
	&lt;li&gt;documents that have multiple terms for the sort field&lt;/li&gt;
	&lt;li&gt;documents matching a query that have no term for the sort field&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12330662" author="yseeley@gmail.com" created="Wed, 28 Sep 2005 11:50:55 +0100"  >&lt;p&gt;Updated my original patch from&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/java-user@lucene.apache.org/msg00611.html&quot; class=&quot;external-link&quot;&gt;http://www.mail-archive.com/java-user@lucene.apache.org/msg00611.html&lt;/a&gt;&lt;br/&gt;
which actually wasn&apos;t meant to be a complete patch, but just a template for one.&lt;/p&gt;

&lt;p&gt;This patch removes the &quot;no terms in field&quot; exception for all the types except Auto, which people probably shouldn&apos;t use anyway.&lt;br/&gt;
I think it&apos;s important for the reasons detailed in that thread.&lt;/p&gt;</comment>
                    <comment id="12330663" author="yseeley@gmail.com" created="Wed, 28 Sep 2005 12:33:44 +0100"  >&lt;p&gt;Attaching latest version.&lt;/p&gt;

&lt;p&gt;I looked into TestSort to add some tests for this, and was surprised to see some tests that should have covered it: testEmptyIndex()&lt;br/&gt;
It turns out FieldCacheImpl special-cased an empty index with &quot;if (retArray.length &amp;gt; 0) {&quot;&lt;/p&gt;

&lt;p&gt;After removing only  those special-case checks from FieldCacheImpl, the tests fail (demonstrating the problem).&lt;br/&gt;
After applying my full patch, all tests pass again.&lt;/p&gt;

&lt;p&gt;This latest diff is a little hard to read because indentation changed due to the removal of the &quot;if&quot; test, but that&apos;s only difference between this and the last diff.&lt;/p&gt;</comment>
                    <comment id="12332659" author="yseeley@gmail.com" created="Fri, 21 Oct 2005 12:07:37 +0100"  >&lt;p&gt;This patch is also needed  to ensure that searches on a multisearcher will be the same regardless of how documents are distributed among the subsearchers.&lt;/p&gt;</comment>
                    <comment id="12357177" author="yseeley@gmail.com" created="Thu, 10 Nov 2005 11:45:40 +0000"  >&lt;p&gt;I cloned this bug to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-459&quot; title=&quot;Warnings needed for sorting on non existant or non indexed fields&quot;&gt;&lt;del&gt;LUCENE-459&lt;/del&gt;&lt;/a&gt; to capture the desire for warnings in certain circumstances.&lt;br/&gt;
I don&apos;t think those concerns should hold up this patch, which fixes clearly inconsistent behavior.  If anyone still has concerns with this patch, speak up before it get&apos;s committed.&lt;/p&gt;</comment>
                    <comment id="12366248" author="yseeley@gmail.com" created="Tue, 14 Feb 2006 06:46:21 +0000"  >&lt;p&gt;Patch applied.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10020">
                <name>Cloners</name>
                                <outwardlinks description="is cloned as">
                            <issuelink>
            <issuekey id="12424941">LUCENE-1631</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12325104">LUCENE-459</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12371121">LUCENE-916</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12312564" name="ASF.LICENSE.NOT.GRANTED--sort.diff" size="843" author="daniel.naber@t-online.de" created="Sat, 16 Apr 2005 07:45:44 +0100" />
                    <attachment id="12314602" name="sort.diff" size="9946" author="yseeley@gmail.com" created="Wed, 28 Sep 2005 12:33:43 +0100" />
                    <attachment id="12314601" name="sort.diff" size="3063" author="yseeley@gmail.com" created="Wed, 28 Sep 2005 11:50:54 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>34477</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 17 Apr 2005 09:04:03 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13375</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27357</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>