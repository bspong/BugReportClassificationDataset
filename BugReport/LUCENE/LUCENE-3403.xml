<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:03:46 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3403/LUCENE-3403.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3403] Term vectors missing after addIndexes + optimize</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3403</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I encountered a problem with addIndexes where term vectors disappeared following optimize(). I wrote a simple test case which demonstrates the problem. The bug appears with both addIndexes() versions, but does not appear if addDocument is called twice, committing changes in between.&lt;/p&gt;

&lt;p&gt;I think I tracked the problem down to IndexWriter.mergeMiddle() &amp;#8211; it sets term vectors before merger.merge() was called. In the addDocs case, merger.fieldInfos is already populated, while in the addIndexes case it is empty, hence fieldInfos.hasVectors returns false.&lt;/p&gt;

&lt;p&gt;will post a patch shortly.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12520218">LUCENE-3403</key>
            <summary>Term vectors missing after addIndexes + optimize</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="shaie">Shai Erera</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Aug 2011 07:35:53 +0100</created>
                <updated>Sun, 27 Nov 2011 12:31:43 +0000</updated>
                    <resolved>Sat, 27 Aug 2011 07:23:11 +0100</resolved>
                            <version>3.3</version>
                                <fixVersion>3.4</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="13091634" author="shaie" created="Fri, 26 Aug 2011 07:48:31 +0100"  >&lt;p&gt;Patch adds 3 test cases to TestTermVectors. If you don&apos;t apply the fix to IndexWriter, the tests which call addIndexes fail.&lt;/p&gt;

&lt;p&gt;It also moves the setHasVectors call after merger.merge() in IndexWriter.&lt;/p&gt;

&lt;p&gt;BTW, if you omit the optimize() call and the fix to IW, the tests pass.&lt;/p&gt;</comment>
                    <comment id="13091660" author="simonw" created="Fri, 26 Aug 2011 08:45:30 +0100"  >&lt;p&gt;good catch Shai, Does this happen on 4.0 too? I don&apos;t think we have setHasVectors there anymore. I am just wondering since you put 4.0 as a fix version.&lt;/p&gt;</comment>
                    <comment id="13091709" author="shaie" created="Fri, 26 Aug 2011 11:59:47 +0100"  >&lt;p&gt;You&apos;re right, it does not happen on trunk. I still want to commit the test cases to trunk too, so that we&apos;ve got that covered there as well. Therefore I think I should keep the 4.0 fix version?&lt;/p&gt;

&lt;p&gt;The problem is that SegmentMerger receives its FieldInfos from DocumentsWriter, and it knows whether to set hasVector according to what it receives. When you addDoc, DW has FieldInfos, but when you only addIndexes, DW doesn&apos;t.&lt;/p&gt;

&lt;p&gt;In fact, the field infos are read only on IW open ... so even if I addIndexes(), commit(), addIndexes(), the field infos would still be missing. A workaround I see for now is to addIndexes(), close(), new IW(), continue with addIndexes() or optimize(). Which is ugly but it&apos;s a workaround until we release a new version. I&apos;ll try that.&lt;/p&gt;

&lt;p&gt;If it&apos;s ok, I&apos;ll commit the fix to 3x and the tests-only to trunk.&lt;/p&gt;</comment>
                    <comment id="13091712" author="simonw" created="Fri, 26 Aug 2011 12:15:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;You&apos;re right, it does not happen on trunk. I still want to commit the test cases to trunk too, so that we&apos;ve got that covered there as well. Therefore I think I should keep the 4.0 fix version?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;don&apos;t get me wrong I was just double checking because 4.0 was not in the affected version. I don&apos;t wanna miss such a trap. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The problem is that SegmentMerger receives its FieldInfos from DocumentsWriter, and it knows whether to set hasVector according to what it receives. When you addDoc, DW has FieldInfos, but when you only addIndexes, DW doesn&apos;t.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;maybe we should adopt what trunk does, checking all the FI if one of the stores vectors unless you FIs is readonly?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If it&apos;s ok, I&apos;ll commit the fix to 3x and the tests-only to trunk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 tests are great!&lt;/p&gt;
</comment>
                    <comment id="13091739" author="mikemccand" created="Fri, 26 Aug 2011 13:37:24 +0100"  >&lt;p&gt;Phew nice catch Shai!&lt;/p&gt;</comment>
                    <comment id="13092206" author="shaie" created="Sat, 27 Aug 2011 07:23:11 +0100"  >&lt;p&gt;Committed revision 1162300 (3x).&lt;br/&gt;
Committed revision 1162301 (trunk &amp;#8211; tests only).&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12491750" name="LUCENE-3403.patch" size="4862" author="shaie" created="Fri, 26 Aug 2011 07:48:31 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 26 Aug 2011 07:45:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2707</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24293</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>