<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:04:31 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3188/LUCENE-3188.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3188] The class from cotrub directory org.apache.lucene.index.IndexSplitter creates a non correct index</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3188</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;When using the method IndexSplitter.split(File destDir, String[] segs) from the Lucene cotrib directory (contrib/misc/src/java/org/apache/lucene/index) it creates an index with segments descriptor file with wrong data. Namely wrong is the number representing the name of segment that would be created next in this index.&lt;br/&gt;
If some of the segments of the index already has this name this results either to impossibility to create new segment or in crating of an corrupted segment.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Bug is present for all environments.&lt;br/&gt;
I used in this case - Windows Server 2003, Java Hot Spot Virtual Machine.&lt;/p&gt;</environment>
            <key id="12509812">LUCENE-3188</key>
            <summary>The class from cotrub directory org.apache.lucene.index.IndexSplitter creates a non correct index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="steve_rowe">Steve Rowe</assignee>
                                <reporter username="ivandimitrovvasile">Ivan Dimitrov Vasilev</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2011 10:28:49 +0100</created>
                <updated>Sat, 2 Jul 2011 03:40:16 +0100</updated>
                    <resolved>Sun, 12 Jun 2011 10:54:59 +0100</resolved>
                            <version>3.0</version>
                <version>3.2</version>
                                <fixVersion>3.3</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13047101" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 10:33:04 +0100"  >&lt;p&gt;The attached file TestIndexSplitter.java contains test that shows the bug (when running IndexSplitter from contrib) and the fix (when running IndexSplitter that is attached here as a patch)&lt;/p&gt;</comment>
                    <comment id="13047164" author="steve_rowe" created="Fri, 10 Jun 2011 13:54:51 +0100"  >&lt;p&gt;Hi Ivan,&lt;/p&gt;

&lt;p&gt;Your submissions should be in the form of a patch (for an explanation see e.g. &lt;a href=&quot;http://en.wikipedia.org/wiki/Patch_%28computing%29&quot; class=&quot;external-link&quot;&gt;http://en.wikipedia.org/wiki/Patch_%28computing%29&lt;/a&gt;).  To generate a patch, after you make modifications in a locally checked-out Subversion working copy, use the shell command &quot;svn diff&quot; at the top level, and redirect its output to a file named for the issue you want to attach to, with extension &quot;.patch&quot;, e.g.: &lt;tt&gt;svn diff &amp;gt; ../&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3188&quot; title=&quot;The class from cotrub directory org.apache.lucene.index.IndexSplitter creates a non correct index&quot;&gt;&lt;del&gt;LUCENE-3188&lt;/del&gt;&lt;/a&gt;.patch&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Also, when you attached the two files to this issue, you did not click on the radio button next to the text &quot;Grant license to ASF for inclusion in ASF works (as per the Apache License &#167;5)&quot;.  You must do this for the Lucene project to be able to use code you contribute.  When you attach your patch, please click on the radio button indicating you grant license to the ASF.  (I haven&apos;t looked at your code yet for this reason.)&lt;/p&gt;

&lt;p&gt;Steve&lt;/p&gt;</comment>
                    <comment id="13047245" author="steve_rowe" created="Fri, 10 Jun 2011 16:34:43 +0100"  >&lt;p&gt;This is a better Wikipedia article on (source code) patching than the one I gave above: &lt;a href=&quot;http://en.wikipedia.org/wiki/Patch_%28Unix%29&quot; class=&quot;external-link&quot;&gt;http://en.wikipedia.org/wiki/Patch_%28Unix%29&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13047269" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 17:24:40 +0100"  >&lt;p&gt;The file &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3188&quot; title=&quot;The class from cotrub directory org.apache.lucene.index.IndexSplitter creates a non correct index&quot;&gt;&lt;del&gt;LUCENE-3188&lt;/del&gt;&lt;/a&gt;.patch contains the needed changes to IndexSplitter to fix this issue.&lt;/p&gt;</comment>
                    <comment id="13047279" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 17:36:23 +0100"  >&lt;p&gt;Hi Steve,&lt;/p&gt;

&lt;p&gt;I attached the patch to this issue as required from Apache (or at least I think so &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;br/&gt;
I do not have lot of time now to read in depth Apache docs about the procedures when contributing but I saw on the wiki that I should provide also test cases that show the bug and they should be in form of unit tests. I provided a test case that is not in JUnit form but still works. As I saw when submitted patch the tests do not need granting license so you can use it. I do not have much time now because we are before release and this was one of the bugs that I should fix (and I did it).&lt;/p&gt;

&lt;p&gt;I guess you are the one who discovered this Splitter. Thank you very much for this you saved me a lot of hard work because in our previous releases we used a class that generated segments descriptor file out of given segments and looking for content of this file was very difficult.&lt;/p&gt;</comment>
                    <comment id="13047354" author="steve_rowe" created="Fri, 10 Jun 2011 19:25:21 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I attached the patch to this issue as required from Apache (or at least I think so ).&lt;br/&gt;
I do not have lot of time now to read in depth Apache docs about the procedures when contributing but I saw on the wiki that I should provide also test cases that show the bug and they should be in form of unit tests. I provided a test case that is not in JUnit form but still works. As I saw when submitted patch the tests do not need granting license so you can use it. I do not have much time now because we are before release and this was one of the bugs that I should fix (and I did it).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for reporting and providing a patch.  I can take it from here.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I guess you are the one who discovered this Splitter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you have me confused with someone else &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - Jason Rutherglen wrote it: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1959&quot; title=&quot;Index Splitter&quot;&gt;&lt;del&gt;LUCENE-1959&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="13047831" author="steve_rowe" created="Sat, 11 Jun 2011 04:59:08 +0100"  >&lt;p&gt;Patch against branch_3x.&lt;/p&gt;

&lt;p&gt;I converted Ivan&apos;s test class into a unit test.  Without Ivan&apos;s patch, the test fails, and with the patch, it succeeds.&lt;/p&gt;

&lt;p&gt;Here&apos;s the test failure I got without Ivan&apos;s patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.lucene.index.TestIndexSplitter,testDeleteThenOptimize
NOTE: reproduce with: ant test -Dtestcase=TestIndexSplitter -Dtestmethod=testDeleteThenOptimize -Dtests.seed=5250008618328265481:-4070453331991284264
WARNING: test class left thread running: merge thread: _0(3.3):c2/1 into _0 [optimize]
RESOURCE LEAK: test class left 1 thread(s) running
Exception in thread &quot;Lucene Merge Thread #0&quot; NOTE: test params are: locale=es_BO, timezone=Australia/Tasmania
org.apache.lucene.util.ThreadInterruptedException: java.lang.InterruptedException: sleep interrupted
	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:515)
	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)
Caused by: java.lang.InterruptedException: sleep interrupted
	at java.lang.Thread.sleep(Native Method)
	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:513)
	... 1 more
NOTE: all tests run in this JVM:
[TestIndexSplitter]
NOTE: Windows 7 6.1 amd64/Sun Microsystems Inc. 1.5.0_22 (64-bit)/cpus=4,threads=2,free=99874080,total=128057344

java.io.IOException: background merge hit exception: _0(3.3):c2/1 into _0 [optimize]
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2536)
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2474)
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2444)
	at org.apache.lucene.index.TestIndexSplitter.testDeleteThenOptimize(TestIndexSplitter.java:145)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1268)
	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1186)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:94)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:192)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:64)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:115)
Caused by: java.io.IOException: MockDirectoryWrapper: file &quot;_0.cfs&quot; is still open: cannot overwrite
	at org.apache.lucene.store.MockDirectoryWrapper.createOutput(MockDirectoryWrapper.java:360)
	at org.apache.lucene.index.CompoundFileWriter.close(CompoundFileWriter.java:167)
	at org.apache.lucene.index.SegmentMerger.createCompoundFile(SegmentMerger.java:137)
	at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4242)
	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3853)
	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:388)
	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:456)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13047900" author="steve_rowe" created="Sat, 11 Jun 2011 15:03:30 +0100"  >&lt;p&gt;Mike McCandless reviewed for me; see &lt;a href=&quot;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2011-06-11#l45&quot; class=&quot;external-link&quot;&gt;the IRC log&lt;/a&gt;.  &lt;/p&gt;

&lt;p&gt;In summary: This is a bug, and the fix is appropriate.  The problem is that the split index is created with an incorrect next-segment-name counter (always 0).  A simpler fix than Ivan&apos;s would be to copy the counter over from the source index.  Also, it would be good to include a check for this problem to the CheckIndex tool:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;mikemccand: ie it&apos;d just verify sis.counter is &amp;gt; all segs in the index&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll make a patch with these changes.&lt;/p&gt;</comment>
                    <comment id="13048080" author="steve_rowe" created="Sun, 12 Jun 2011 00:01:55 +0100"  >&lt;p&gt;Attachment with above-described changes.&lt;/p&gt;

&lt;p&gt;I plan on committing shortly, then porting to trunk.&lt;/p&gt;</comment>
                    <comment id="13048183" author="steve_rowe" created="Sun, 12 Jun 2011 00:41:04 +0100"  >&lt;p&gt;Committed:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;r1134823: branch_3x&lt;/li&gt;
	&lt;li&gt;r1134829: trunk&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks Ivan!&lt;/p&gt;</comment>
                    <comment id="13048280" author="thetaphi" created="Sun, 12 Jun 2011 10:49:10 +0100"  >&lt;p&gt;Reopen: The CheckIndex patch reports broken index if you have empty index without segments.&lt;/p&gt;</comment>
                    <comment id="13048281" author="thetaphi" created="Sun, 12 Jun 2011 10:49:49 +0100"  >&lt;p&gt;Fix for the CheckIndex problem with empty indexes.&lt;/p&gt;</comment>
                    <comment id="13048282" author="thetaphi" created="Sun, 12 Jun 2011 10:54:59 +0100"  >&lt;p&gt;Committed fixes in revisions: 1134895 (trunk), 1134896 (3.x)&lt;/p&gt;</comment>
                    <comment id="13048370" author="steve_rowe" created="Sun, 12 Jun 2011 17:41:21 +0100"  >&lt;p&gt;Thanks Uwe.  I didn&apos;t see the problem because I didn&apos;t run all tests before committing.&lt;/p&gt;</comment>
                    <comment id="13058928" author="rcmuir" created="Sat, 2 Jul 2011 03:40:16 +0100"  >&lt;p&gt;bulk close for 3.3&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12482047" name="IndexSplitter.java" size="5862" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 10:33:04 +0100" />
                    <attachment id="12482294" name="LUCENE-3188-fix1.patch" size="517" author="thetaphi" created="Sun, 12 Jun 2011 10:49:49 +0100" />
                    <attachment id="12482160" name="LUCENE-3188.patch" size="6513" author="steve_rowe" created="Sun, 12 Jun 2011 00:01:55 +0100" />
                    <attachment id="12482129" name="LUCENE-3188.patch" size="4350" author="steve_rowe" created="Sat, 11 Jun 2011 04:59:08 +0100" />
                    <attachment id="12482075" name="LUCENE-3188.patch" size="916" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 17:24:40 +0100" />
                    <attachment id="12482046" name="TestIndexSplitter.java" size="3208" author="ivandimitrovvasile" created="Fri, 10 Jun 2011 10:33:04 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 10 Jun 2011 12:54:51 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2099</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24509</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>