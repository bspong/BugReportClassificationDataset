<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:18:04 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2294/LUCENE-2294.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2294] Create IndexWriterConfiguration and store all of IW configuration there</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2294</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I would like to factor out of all IW configuration parameters into a single configuration class, which I propose to name IndexWriterConfiguration (or IndexWriterConfig). I want to store there almost everything besides the Directory, and to reduce all the ctors down to one: IndexWriter(Directory, IndexWriterConfiguration). What I was thinking of storing there are the following parameters:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;All of ctors parameters, except for Directory.&lt;/li&gt;
	&lt;li&gt;The different setters where it makes sense. For example I still think infoStream should be set on IW directly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m thinking that IWC should expose everything in a setter/getter methods, and defaults to whatever IW defaults today. Except for Analyzer which will need to be defined in the ctor of IWC and won&apos;t have a setter.&lt;/p&gt;

&lt;p&gt;I am not sure why MaxFieldLength is required in all IW ctors, yet IW declares a DEFAULT (which is an int and not MaxFieldLength). Do we still think that 10000 should be the default? Why not default to UNLIMITED and otherwise let the application decide what LIMITED means for it? I would like to make MFL optional on IWC and default to something, and I hope that default will be UNLIMITED. We can document that on IWC, so that if anyone chooses to move to the new API, he should be aware of that ...&lt;/p&gt;

&lt;p&gt;I plan to deprecate all the ctors and getters/setters and replace them by:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;One ctor as described above&lt;/li&gt;
	&lt;li&gt;getIndexWriterConfiguration, or simply getConfig, which can then be queried for the setting of interest.&lt;/li&gt;
	&lt;li&gt;About the setters, I think maybe we can just introduce a setConfig method which will override everything that is overridable today, except for Analyzer. So someone could do iw.getConfig().setSomething(); iw.setConfig(newConfig);
	&lt;ul&gt;
		&lt;li&gt;The setters on IWC can return an IWC to allow chaining set calls ... so the above will turn into iw.setConfig(iw.getConfig().setSomething1().setSomething2());&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;BTW, this is needed for Parallel Indexing (see &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1879&quot; title=&quot;Parallel incremental indexing&quot;&gt;LUCENE-1879&lt;/a&gt;), but I think it will greatly simplify IW&apos;s API.&lt;/p&gt;

&lt;p&gt;I&apos;ll start to work on a patch.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12458093">LUCENE-2294</key>
            <summary>Create IndexWriterConfiguration and store all of IW configuration there</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Mar 2010 09:41:08 +0000</created>
                <updated>Fri, 10 May 2013 11:43:22 +0100</updated>
                    <resolved>Sat, 13 Mar 2010 15:35:40 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12841152" author="thetaphi" created="Thu, 4 Mar 2010 09:58:57 +0000"  >&lt;p&gt;+1 for the IndexWriterConfig with chaining method calls&lt;/p&gt;

&lt;p&gt;We had a discussion about this a while ago on the mailinglist: &lt;a href=&quot;http://www.lucidimagination.com/search/document/19e1a19f4d340b8c/lucene_2_9_and_deprecated_ir_open_methods&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/19e1a19f4d340b8c/lucene_2_9_and_deprecated_ir_open_methods&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12841166" author="shaie" created="Thu, 4 Mar 2010 10:24:15 +0000"  >&lt;p&gt;Thanks Uwe for the pointer.&lt;/p&gt;

&lt;p&gt;I suppose that MaxFieldLength should now move to IndexWriterConfig, only it is public and therefore needs to be deprecated. Otherwise it will look strange that in order to set MFL on IWC you need to reference IW. So deprecate and duplicate? To IW it doesn&apos;t matter because it just takes the limit (int) from MFL ...&lt;/p&gt;</comment>
                    <comment id="12841172" author="thetaphi" created="Thu, 4 Mar 2010 10:31:06 +0000"  >&lt;p&gt;In my opinion the whole class is unneeded, so only deprecate in IW but not add it to IWConfig. For me a constant in IWConfig would be enough that defines UNLIMITED and everything else is just an integer. +1 for defaulting to &quot;static final UNLIMITED=Integer.MAX_VALUE&quot;. I am not sure why this limitation is there at all. In my opinion it should be left to the apploication to limit the number of tokens if needed, but not silently drop tokens. If somebody gets an OOM, he can adjust the value and knows that mayabe some tokens get lost.&lt;/p&gt;</comment>
                    <comment id="12841173" author="shaie" created="Thu, 4 Mar 2010 10:35:11 +0000"  >&lt;p&gt;Yeah I don&apos;t like it either (makes my code unnecessarily long). And I always use UNLIMITED, and the LIMITED=10,000 is really just a guess, and so if anyone wants to limit it, he needs to do new MaxFieldLength(otherLimit) which is unnecessarily long as well ...&lt;/p&gt;

&lt;p&gt;I like it - I&apos;ll deprecate on IW and introduce UNLIMITED on IWC.&lt;/p&gt;</comment>
                    <comment id="12841189" author="shaie" created="Thu, 4 Mar 2010 11:14:04 +0000"  >&lt;p&gt;I was wondering if perhaps instead of allowing to pass a create=true/false, we should use an enum with 3 values: CREATE, APPEND, CREATE_OR_APPEND. The current meaning of create is a bit unclear. I.e. if it is true, then overwrite. But if it is false, don&apos;t attempt to create, but just open an existing one. However if the directory is empty, it throws an exception. I think an enum would someone to pass CREATE_OR_APPEND in case he doesn&apos;t know if there is an index there ... but I don&apos;t want to complicate things unnecessarily ... what do you think?&lt;/p&gt;</comment>
                    <comment id="12841199" author="shaie" created="Thu, 4 Mar 2010 11:53:01 +0000"  >&lt;p&gt;IndexingChain is one of the things that can be set on IW, however I don&apos;t see any implementations of it besides the default, and the class itself is package-private, so no app could actually set it on IW (unless it puts its code under o.a.l.index). Therefore I&apos;m thinking of not introducing it on IWC, or turn it to a public class?&lt;br/&gt;
Is it really something we expect any application out there to set, or can we simply make DocsWriter impl one for itself internally, and don&apos;t declare this class as abstract etc.?&lt;/p&gt;</comment>
                    <comment id="12841207" author="shaie" created="Thu, 4 Mar 2010 12:23:56 +0000"  >&lt;p&gt;I&apos;m thinking to make this whole IWC a constructor only parameter to IW, without the ability to set it afterwards. I don&apos;t see any reason why would anyone change the RAM limit, Similarity etc while IW is running. What&apos;s the advantage vs. say close the current IW and open a new one with the different settings? I know the latter is more expensive, and I write it deliberately - I think those settings are really ctor-only settings. Otherwise you might get inconsistent documents (like changing the Similarity or max field length).&lt;/p&gt;

&lt;p&gt;This will also simplify IWC, because now I need to distinguish between settings that cannot be altered afterwards, like changing IndexDeletionPolicy, create, IndexCommit, Analyzer ... if IWC will be a ctor only object, I can have only the default ctor (to init to default settings) and provide the setters otherwise.&lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;</comment>
                    <comment id="12841232" author="mikemccand" created="Thu, 4 Mar 2010 13:12:18 +0000"  >&lt;p&gt;+1 &amp;#8211; this is great!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am not sure why MaxFieldLength is required in all IW ctors, yet IW declares a DEFAULT (which is an int and not MaxFieldLength). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is because it&apos;s a dangerous setting (you silently lose content&lt;br/&gt;
while indexing), a trap.  So we want to force the user to make the&lt;br/&gt;
choice, up front, so they realize the implications.&lt;/p&gt;

&lt;p&gt;But, if we change the default to UNLIMITED (which we should do under&lt;br/&gt;
Version), then I agree you should not have to specify it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In my opinion it should be left to the apploication to limit the number of tokens if needed, but not silently drop tokens&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I like that approach &amp;#8211; we could make a TokenFilter to do this?  Then&lt;br/&gt;
we don&apos;t need MFL at all in IWC (and deprecate in IW).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I was wondering if perhaps instead of allowing to pass a create=true/false, we should use an enum with 3 values: CREATE, APPEND, CREATE_OR_APPEND&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m thinking to make this whole IWC a constructor only parameter to IW, without the ability to set it afterwards.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 in general, though we should go setting by setting to confirm this is OK.  I&lt;br/&gt;
don&apos;t know of &quot;real&quot; use cases where apps eg want to change RAM buffer&lt;br/&gt;
or mergeFactor... but maybe there are some interesting usages out&lt;br/&gt;
there.&lt;/p&gt;</comment>
                    <comment id="12841239" author="shaie" created="Thu, 4 Mar 2010 13:29:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;But, if we change the default to UNLIMITED&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Today there is no DEFAULT .. IW forces you to pass MFL so whoever moves to the new API can define whatever he wants. We&apos;ll default to UNLIMITED but there won&apos;t be any back-compat issue ...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we could make a TokenFilter to do this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m afraid that will result in changing all Analyzers to work properly? Or you mean DW (or somewhere) will wrap whatever TS an Analyzer returns w/ this filter? That could work, but as soon as that becomes a filter, people may use it, and wrapping their TS w/ that filter will be unnecessary (and slow &apos;em down?). Also, if I&apos;d use such a filter myself, I wouldn&apos;t put it last in the chain, so that I can avoid doing any processing on a term that is not going to end up in the index. Although that&apos;s not too critical because I&apos;ll be doing this for just one term ...&lt;/p&gt;

&lt;p&gt;I guess I&apos;d like to keep it as it is now, not turning the issue into a bigger thing ... and a filter alone won&apos;t solve it - we&apos;d still need to provide a way to configure it, or otherwise everyone will need to wrap their Analyzers with such filter?&lt;/p&gt;</comment>
                    <comment id="12841249" author="markrmiller@gmail.com" created="Thu, 4 Mar 2010 13:39:10 +0000"  >&lt;p&gt;I can see the value in this - there are a bunch of IW constructors - but personally I still think I prefer them.&lt;/p&gt;

&lt;p&gt;Creating config classes to init another class is its own pain in the butt. Reminds me of windows C programming and structs. When I&apos;m just coding away, its so much easier to just enter the params in the cnstr. And it seems like it would be more difficult to know whats &lt;b&gt;required&lt;/b&gt; to set on the config class - without the same cstr business ...&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Though I suppose the chaining &lt;b&gt;does&lt;/b&gt; makes this more swallowable...&lt;/p&gt;

&lt;p&gt;new IW(new IWConfig(Analyzer).set().set().set()) isn&apos;t really so bad ...&lt;/p&gt;</comment>
                    <comment id="12841262" author="shaie" created="Thu, 4 Mar 2010 13:50:46 +0000"  >&lt;p&gt;I wouldn&apos;t worry about what&apos;s required - Directory will be left out, MFL is useless and a pain anyway, so what&apos;s left is Analyzer. I can put Analyzer on IWC&apos;s ctor, but I personally think we can default to a simple one (such as Whitespace) encouraging the people to set their own. I find it very annoying today when I want to test something about IW and I need to pass all these things to IW ...&lt;/p&gt;

&lt;p&gt;The way I see it, those who want to rely on Lucene&apos;s latest and greatest can just do: IndexWriter writer = new IndexWriter(dir, new IWC()); Well maybe except for the Analyzer, but I really don&apos;t think it matters that much. And like you wrote, someone can chain the setters. So win-win? If you don&apos;t care about anything, just wants to open a writer, index something and that&apos;s it, you don&apos;t need to specify anything .. otherwise you just chain calls?&lt;/p&gt;

&lt;p&gt;One thing I should add to IWC so far (I hope to post a patch even today) is a Version parameter. For now it will be ignored, but as a placeholder to change settings in the future.&lt;/p&gt;</comment>
                    <comment id="12841339" author="mikemccand" created="Thu, 4 Mar 2010 15:39:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Today there is no DEFAULT .. IW forces you to pass MFL so whoever moves to the new API can define whatever he wants. We&apos;ll default to UNLIMITED but there won&apos;t be any back-compat issue ..&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahh sorry right.  In the &quot;olden days&quot;, 10000 was the default.&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;we could make a TokenFilter to do this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m afraid that will result in changing all Analyzers to work properly? Or you mean DW (or somewhere) will wrap whatever TS an Analyzer returns w/ this filter? That could work, but as soon as that becomes a filter, people may use it, and wrapping their TS w/ that filter will be unnecessary (and slow &apos;em down?). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm yeah quite a hassle to fix all analyzers.  Hmmm.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I guess I&apos;d like to keep it as it is now, not turning the issue into a bigger thing ... and a filter alone won&apos;t solve it - we&apos;d still need to provide a way to configure it, or otherwise everyone will need to wrap their Analyzers with such filter?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe one solution is to wrap any other analyzer?  Ie, create a StopAfterNTokensAnalyzer,  taking another analyzer that it delegates to, and then sticking on this StopAfterNTokensFilter to each token stream.&lt;/p&gt;

&lt;p&gt;But yeah maybe break this out as a separate issue...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, if I&apos;d use such a filter myself, I wouldn&apos;t put it last in the chain, so that I can avoid doing any processing on a term that is not going to end up in the index. Although that&apos;s not too critical because I&apos;ll be doing this for just one term ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually it ought to be 0 terms wasted, with the filter @ the end &amp;#8211; with this StopAfterNTokensFilter, it&apos;ll immediately return false w/o asking for the 10001th token.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One thing I should add to IWC so far (I hope to post a patch even today) is a Version parameter. For now it will be ignored, but as a placeholder to change settings in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="12841535" author="shaie" created="Thu, 4 Mar 2010 21:28:18 +0000"  >&lt;p&gt;There are some settings on IW that go directly to the MergePolicy used (well ... only if it&apos;s LogMergePolicy). At first I wanted to move them, together w/ MP, to IWC, but this isn&apos;t possible, because MP requires IW to be passed to its ctor, and when IWC is created, there is no IW ... So there are couple of options I can think of:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Add all to IWC, and expose on MP a final setIndexWriter, package-private, as well as an empty ctor. IW will later set MP&apos;s IW. It will also allow applications to pass their  own MP after IW has been created (like they can do today). IWC will delegate all set/get to MP, like IW does today. The only downside is that the IW member of MP won&apos;t be final anymore ...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Keep the get/set on IW, like it is today. It will split the configuration of IW to two places ... I prefer to keep it all in one place.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Remove all the set/get from IW and let applications interface directly with MP. It will remove the bizarre situation where someone could pass a non LogMergePolicy to IW, however when he&apos;ll try to set anything on it from IW, it will fail ... If we remove the get/set from IW and let folks interface w/ their MP directly, we won&apos;t have this problem:
	&lt;ul&gt;
		&lt;li&gt;They&apos;ll need to declare the MP of type LogMP, or otherwise the API won&apos;t be there.&lt;/li&gt;
		&lt;li&gt;if they use their own MP, with special API, they&apos;ll interface w/ MP&apos;s configuration from one place ...&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Between the three, I like (3) the best as it will get rid of the inconsistency in IW today (expecting only LogMP, but requiring MP). But if those set/get are important to keep together with the other configuration, I prefer (1). What do you think?&lt;/p&gt;</comment>
                    <comment id="12841574" author="earwin" created="Thu, 4 Mar 2010 22:35:46 +0000"  >&lt;p&gt;I voted for killing these delegating methods some time ago. It ended in nothing, so I vote again, #3 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12841595" author="yseeley@gmail.com" created="Thu, 4 Mar 2010 23:09:08 +0000"  >&lt;p&gt;Yay, we&apos;ll be able to remove SolrIndexConfig and use this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12841694" author="shaie" created="Fri, 5 Mar 2010 04:05:24 +0000"  >&lt;p&gt;Ok, then I&apos;ll proceed w/ #3.&lt;/p&gt;</comment>
                    <comment id="12841810" author="mikemccand" created="Fri, 5 Mar 2010 10:46:01 +0000"  >&lt;p&gt;So this will affect these methods in IW, right:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
get/setMergeFactor(...)
get/setUseCompoundFile(...)
get/setMaxMergeDocs(...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ie, we&apos;d deprecate them.  Instead you&apos;d have to interact /w the MergePolicy.  IW will still default its merge policy, so with this change, instead of:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
writer.setMergeFactor(7);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You&apos;d have to do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
((LogMergePolicy) writer.getMergePolicy()).setMergeFactor(7));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(And take the risk of runtime cast yourself/explicitly, which IW was already doing under the hood anyway).&lt;/p&gt;</comment>
                    <comment id="12841820" author="shaie" created="Fri, 5 Mar 2010 11:22:52 +0000"  >&lt;p&gt;Exactly !&lt;/p&gt;

&lt;p&gt;Only I hope that if people will interact w/ their MP to set stuff on it, they would interact with it to query its settings. Calling IW.getMergePolicy will become redundant, or at least will be avoidable. Maybe only when you rely on the default MP, you&apos;ll perform the last code example you gave above. Actually, I&apos;ve already done 98% of the change. I need to finish some stuff on IW and then I&apos;ll post the patch.&lt;/p&gt;

&lt;p&gt;On the MFL/Analyzer - I like the approach of wrapping an Analyzer with a MFLAnalyzer. The beauty is that if I don&apos;t want to limit anything, I don&apos;t need to do anything and the code won&apos;t need to keep track of how many tokens were indexed for that field ... I still think it should be done in a separate issue, as it involves introducing some code in the lower levels to wrap any Analyzer with it, for back-compat. If we do it, let&apos;s do it before 3.1 is out, so we can remove it from IWC right away w/o deprecating anything ...&lt;/p&gt;

&lt;p&gt;I&apos;ll open an issue for it.&lt;/p&gt;</comment>
                    <comment id="12841865" author="shaie" created="Fri, 5 Mar 2010 14:01:56 +0000"  >&lt;p&gt;Patch includes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IndexWriterConfig + Test&lt;/li&gt;
	&lt;li&gt;Changes to IndexWriter to use IWC&lt;/li&gt;
	&lt;li&gt;Changes to DocumentsWriter - removed IndexingChain from its ctor and always use default.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;IndexingChain is package-private and so was the ctor on IndexWriter which allowed to set it. If that&apos;s important (e.g. used by SOLR maybe?), then I can add a package-private setting to IndexWriterConfig which will allow setting this. But since I haven&apos;t found any calls in Lucene (tests nor java), and no implementations of this class besides the default that is in DW, I thought this can be removed.&lt;/p&gt;

&lt;p&gt;I would like to have this patched reviewed, before I go about changing all the code to use the new IWC (tests + java). If we agree on the details and how it looks and used, I&apos;ll do it - should be straightforward.&lt;/p&gt;</comment>
                    <comment id="12842015" author="mikemccand" created="Fri, 5 Mar 2010 20:42:56 +0000"  >&lt;p&gt;Ha, I see TODO 4.0 comments now.  Sheesh &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Patch looks great Shai!&lt;/p&gt;

&lt;p&gt;A few comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Hmm... I think we should still allow package private specification&lt;br/&gt;
    of the indexing chain?  Not long ago Michael B. explicitly opened&lt;br/&gt;
    this up (while keeping it package private).  I think for&lt;br/&gt;
    way-expert users we should keep it extensible?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;For IWC.setAnalyzer(null), instead of silently swapping in&lt;br/&gt;
    WhitespaceAnalyzer, can we throw IllegalArgE?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Should we disallow all setters on IWC after it&apos;s been consumed by&lt;br/&gt;
    an IW?  (Though one may want to re-use to make another IW).&lt;br/&gt;
    Or... make it very clear that IW fully consumes the IWC on&lt;br/&gt;
    creation and never again looks at it...?  (OK, I do see this in&lt;br/&gt;
    IW.getConfig and IWC).  Should IW just clone the IWC and reference&lt;br/&gt;
    it internally, instead of copying to private fields?  Or... IW&lt;br/&gt;
    marks the IWC readOnly (and setters on it then fail), and you must&lt;br/&gt;
    clone it if you will re-use?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In IWC we call it &quot;scheduler&quot; but seems like we should keep the&lt;br/&gt;
    name &quot;mergeScheduler&quot;?  (And in toString, too).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Why can&apos;t MergePolicy also live in IWC?  Seems odd to move&lt;br/&gt;
    MergeScheduler to it but not MP.  (And deprecate set/getMP in IW)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Nit-picky, but, IW.messageState will have a space before each of&lt;br/&gt;
    its entries but then IWC&apos;s entries have no space &amp;#8211; looks not so&lt;br/&gt;
    nice on enabling infoStream?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Need small jdoc for the new IW ctor&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12842176" author="shaie" created="Sat, 6 Mar 2010 04:03:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hmm... I think we should still allow package private specification of the indexing chain?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, I&apos;ll add it back.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For IWC.setAnalyzer(null)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I preferred not to (it&apos;s not just setAnalyzer, but also MS, Similarity and IndexDeletionPolicy). I specifically documented on each what happens if one passes null. I think it&apos;s better service - you&apos;re not expected to pass null, and so if you do, instead of throwing an exception, we revert to default. I thought at some point to add a restoreDefaults() method, but then realized that doing new IWC() is not that expensive ...&lt;br/&gt;
I think - if someone uses IWC but receives any of those settings from the outside, instead of asking him to always check for null, we tell him &quot;pass null, we revert to default&quot; ...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In IWC we call it &quot;scheduler&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Woops, fixed that !&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why can&apos;t MergePolicy also live in IWC?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve commented on it in this issue - MP requires an IW instance to be passed to its ctor.(see my comment from 04/Mar/10 09:28 PM).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IW.messageState will have a space before each of its entries &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;IWC.toString() includes &apos;\n&apos; between settings. I thought it&apos;d be more readable that way because otherwise it&apos;d be a long line. The output for me looks like that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
IW 0 [main]: dir=org.apache.lucene.store.RAMDirectory@2ca22ca2 mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@6ca06ca index= version=3.1-dev config=matchVersion=LUCENE_31
analyzer=org.apache.lucene.analysis.WhitespaceAnalyzer
delPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy
commit=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
openMode=CREATE_OR_APPEND
maxFieldLength=2147483647
similarity=org.apache.lucene.search.DefaultSimilarity
termIndexInterval=128
mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler
&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; WRITE_LOCK_TIMEOUT=1000
writeLockTimeout=1000
maxBufferedDeleteTerms=-1
ramBufferSizeMB=16.0
maxBufferedDocs=-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Perhaps I&apos;ll print &quot;config=\n&quot; so that all config parameters start on the new line, and not all but the first. Is that acceptable, or you still prefer all to be on one line, space separated?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Need small jdoc for the new IW ctor&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll add that. That one slipped &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should we disallow all setters on IWC after it&apos;s been consumed by an IW?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve thought about all the options that you raise, and decided to keep the situation as-is, to let others also comment on that. So I&apos;m glad you commented &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I&apos;ve documented on IW.getConfig() that setting anything on the returned object has no effect on IW instance, and if one needs to do it, one should re-instantiate IW.&lt;/li&gt;
	&lt;li&gt;I also thought to turn off setters (setting IWC to read-only by IW), but then someone won&apos;t be able to reuse an IWC&lt;/li&gt;
	&lt;li&gt;Removing the fields from IW is not good, because then someone could really call getConfig().setMaxBufferedDocs and that will affect IW, unlike what the comment says. If we want to really keep everything in IWC, we need to clone on ctor and getConfig() time. Seems a waste to me.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think I&apos;ll just clone the incoming IWC on IW and leave the rest as-is?&lt;/p&gt;</comment>
                    <comment id="12842182" author="shaie" created="Sat, 6 Mar 2010 04:40:58 +0000"  >&lt;p&gt;Patch with applied comments. I&apos;ll start moving the code to use the new ctor, class etc.&lt;/p&gt;</comment>
                    <comment id="12842241" author="mikemccand" created="Sat, 6 Mar 2010 10:44:51 +0000"  >&lt;p&gt;OK let&apos;s keep the semantics of &quot;if you pass null that means restore to default&quot;.&lt;/p&gt;

&lt;p&gt;Should we rename UNLIMITED_FIELD_LENGTH -&amp;gt; DEFAULT_MAX_FIELD_LENGTH?  (Though w/ the new issue this should be going away from IWC anyway).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IWC.toString() includes &apos;\n&apos; between settings&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahh, I misread it (I thought IW was doing \n followed by single space).  I agree multiple lines is much better.  How about making IW also do multiple lines for its non-IWC settings that are messaged?  And then removing the config= from the output?  Ie all I see is a bunch of settings.  I don&apos;t think &lt;span class=&quot;error&quot;&gt;&amp;#91;in this debug printout&amp;#93;&lt;/span&gt; that we need to message which setting was on IW and which was from the IWC.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve commented on it in this issue - MP requires an IW instance to be passed to its ctor.(see my comment from 04/Mar/10 09:28 PM).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahh, sorry, right.  Annoying we moved IW as required into MP &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Hrmph.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think I&apos;ll just clone the incoming IWC on IW and leave the rest as-is?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, I think this is fine, for starters.  The API semantics are clearly defined, so, if at a later date we harden the enforcement (say throw IllegalStateEx if you try to change anything after IWC has been consumed by IW, that&apos;s fair game).&lt;/p&gt;

&lt;p&gt;Maybe clearly state in the jdocs that presently no settings are version dependent, so it&apos;s just a placeholder?  (Basically, elevate the code comment that already says this, into the jdocs).  Whenever a class in Lucene takes a Version, we should strongly document how Version alters settings, even if it&apos;s a no-op placeholder.   (And I agree we should have it here as placeholder).&lt;/p&gt;

&lt;p&gt;Patch looks good Shai, thanks!&lt;/p&gt;</comment>
                    <comment id="12842261" author="shaie" created="Sat, 6 Mar 2010 13:49:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;UNLIMITED_FIELD_LENGTH&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I deliberately named it like that. There is currently IW.DEFAULT_MAX_FIELD_LENGTH which is set to 10,000. I didn&apos;t want to keep the same name so as to not confuse. The default, UNLIMITED, is documented on setMaxFieldLength.&lt;/p&gt;

&lt;p&gt;But like you said, it may go entirely away in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2295&quot; title=&quot;Create a MaxFieldLengthAnalyzer to wrap any other Analyzer and provide the same functionality as MaxFieldLength provided on IndexWriter&quot;&gt;&lt;del&gt;LUCENE-2295&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Annoying we moved IW as required into MP&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think I&apos;m to blame for this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How about making IW also do multiple lines for its non-IWC setting&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;p&gt;Thanks for the comments. Continuing with converting the code. I&apos;m flying to the US tonight, so I may not finish it before I leave. And then I&apos;ll be gone for ~30 hours before I can ping again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                    <comment id="12842478" author="shaie" created="Sun, 7 Mar 2010 20:19:18 +0000"  >&lt;p&gt;While I&apos;m converting the tests to use the new IWC, and getting rid of deprecated methods, I think it&apos;ll be useful to add a MergePolicyConfig. But since most of the setters used today assume a LogMergePolicy, and since it&apos;s also unrelated to IW, I prefer to leave it for a separate issue. Doing that, w/ the methods chaining approach, will simplify usage even more.&lt;/p&gt;</comment>
                    <comment id="12842801" author="shaie" created="Mon, 8 Mar 2010 20:10:50 +0000"  >&lt;p&gt;Patch with all tests and code converted to not use the deprecated API, and move to use IWC. All except CreateIndexTask in benchmark, which looks a bit more complicated to change, I left it out for now.&lt;/p&gt;

&lt;p&gt;Another thing - I deprecated *QueryParserWrapperTest and did not convert them to use the new IWC API, as those tests will be removed when *QueryParserWrapper will be removed.&lt;/p&gt;

&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                    <comment id="12842824" author="mikemccand" created="Mon, 8 Mar 2010 21:48:58 +0000"  >&lt;p&gt;Patch looks good &amp;#8211; thanks Shai!&lt;/p&gt;

&lt;p&gt;I&apos;ll commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12843664" author="mikemccand" created="Wed, 10 Mar 2010 17:56:41 +0000"  >&lt;p&gt;Phew!  Thanks Shai...&lt;/p&gt;</comment>
                    <comment id="12843688" author="mikemccand" created="Wed, 10 Mar 2010 18:37:49 +0000"  >&lt;p&gt;Robert raised a concern on java-dev: maybe we should not have a default analyzer....?  Ie force the user to make an explicit choice.&lt;/p&gt;</comment>
                    <comment id="12843690" author="rcmuir" created="Wed, 10 Mar 2010 18:42:43 +0000"  >&lt;p&gt;Here&apos;s my elaboration a bit:&lt;/p&gt;

&lt;p&gt;I like the concept of good, versioned defaults, but i think this is just a decision point that&lt;br/&gt;
a user should have to make, like it is now.&lt;/p&gt;

&lt;p&gt;A practical concern that I have: Whitespace really sucks, we will get lots of questions&lt;br/&gt;
on java-user because &quot;lucene doesnt search upper/lowercase by default&quot;. This is because&lt;br/&gt;
beginner users will only do what work is necessary for their application to compile.&lt;/p&gt;</comment>
                    <comment id="12843712" author="shaie" created="Wed, 10 Mar 2010 19:20:19 +0000"  >&lt;p&gt;I disagree, but obviously I&apos;m on the minority side. It is clearly documented what&apos;s the default Analyzer used is, and that you should change it if you want to get more meaningful analysis. When I created IWC I really wanted to simplify how IW is created. If we force IWC to accept both a Version AND an Analyzer, instantiating IW will look like this: new IndexWriter(dir, new IndexWriterConfig(matchVersion, analyzer));&lt;/p&gt;

&lt;p&gt;We don&apos;t accomplish anything with it, took away the MFL argument and replace it w/ IWC ... Remember - those that used to set all kind of parameters, using the other ctors, anyway care about how their IW is instantiated. The others that used IW(dir, analyzer, MFL) don&apos;t care about all other attributes. MFL is just annoyance, so we removed it. I just don&apos;t feel that a default Analyzer, which is Whitespace, is bad. It&apos;s easy to understand what your analysis looks like, and since it&apos;s well documented, nobody can say &quot;hey, what didn&apos;t you warn me&quot;. IW defaults to all other bunch of settings, so why is Analyzer different?&lt;/p&gt;

&lt;p&gt;If we say Analyzer is mandatory, what will stop us tomorrow from saying IndexDeletionPolicy is mandatory? And then we&apos;ll get into whole bunch of ctors, only now on IWC? If we&apos;re documenting things clearly, and IWC documents clearly all its defaults, I see no reason why to require an Analyzer to be specified up front. At least to me, that will make this entire change useless. When I create my IW for serious indexing, I take care of all its settings. Otherwise I just instantiate it to check something completely not related to its defaults. If I test those, I define them (otherwise I cannot test them).&lt;/p&gt;</comment>
                    <comment id="12843717" author="markrmiller@gmail.com" created="Wed, 10 Mar 2010 19:23:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we say Analyzer is mandatory, what will stop us tomorrow from saying IndexDeletionPolicy is mandatory?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nothing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But I think Analyzer should be mandatory and that IndexDeletionPolicy should not be mandatory, looking at them case by case.&lt;/p&gt;</comment>
                    <comment id="12843721" author="shaie" created="Wed, 10 Mar 2010 19:26:58 +0000"  >&lt;p&gt;This doesn&apos;t help much Mark &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Question - does SOLR requires everyone to specify an Analyzer, or does it come w/ a default one?&lt;/p&gt;</comment>
                    <comment id="12843723" author="mikemccand" created="Wed, 10 Mar 2010 19:27:35 +0000"  >&lt;p&gt;I&apos;ll revert the commit while we discuss...&lt;/p&gt;</comment>
                    <comment id="12843726" author="rcmuir" created="Wed, 10 Mar 2010 19:28:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;IW defaults to all other bunch of settings, so why is Analyzer different?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just my opinion, but what makes it different is that breaking text into tokens&lt;br/&gt;
and indexing them is what search is all about.&lt;/p&gt;

&lt;p&gt;Deletions is an optional feature, and if someone got rid of it alltogether, I wouldn&apos;t&lt;br/&gt;
even comment on the issue, I could care less.&lt;/p&gt;</comment>
                    <comment id="12843729" author="markrmiller@gmail.com" created="Wed, 10 Mar 2010 19:38:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Question - does SOLR requires everyone to specify an Analyzer, or does it come w/ a default one?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm... SOLR doesn&apos;t really use Lucene analyzers.&lt;/p&gt;

&lt;p&gt;It comes with a default Schema.xml that defines FieldTypes. Then field names can be assigned to FieldTypes. So technically speaking, no, Solr does not - but because most&lt;br/&gt;
people build off the example, you could say that it does have defaults for example FieldTypes and defaults of what field names map to those. But it also only accepts certain example fields with the example Schema - you really&lt;br/&gt;
have to go in and customize it to your needs - its setup to basically show off what options are available and work with some demo stuff.&lt;/p&gt;

&lt;p&gt;Solr comes with almost no defaults in a way - but it does ship with an example setup that is meant to show you how to set things up, and what is available. You could consider those defaults since most will build off it.&lt;/p&gt;

&lt;p&gt;example of Solr analyzer declaration:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &amp;lt;!-- A general unstemmed text field - good &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; one does not know the language of the field --&amp;gt;
    &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;textgen&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StopFilterFactory&quot;&lt;/span&gt; ignoreCase=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; words=&lt;span class=&quot;code-quote&quot;&gt;&quot;stopwords.txt&quot;&lt;/span&gt; enablePositionIncrements=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/analyzer&amp;gt;
      &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.SynonymFilterFactory&quot;&lt;/span&gt; synonyms=&lt;span class=&quot;code-quote&quot;&gt;&quot;synonyms.txt&quot;&lt;/span&gt; ignoreCase=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; expand=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StopFilterFactory&quot;&lt;/span&gt;
                ignoreCase=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
                words=&lt;span class=&quot;code-quote&quot;&gt;&quot;stopwords.txt&quot;&lt;/span&gt;
                enablePositionIncrements=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
                /&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/analyzer&amp;gt;
    &amp;lt;/fieldType&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12843733" author="mikemccand" created="Wed, 10 Mar 2010 19:42:54 +0000"  >&lt;p&gt;Really, eventually, I&apos;d like a stronger separation of analysis and&lt;br/&gt;
indexing, so that IndexWriter never even gets an analyzer.&lt;/p&gt;

&lt;p&gt;Ie, the fields in the doc that need to be indexed should only present&lt;br/&gt;
an attr source, and IW pulls from that.&lt;/p&gt;

&lt;p&gt;IW is then fully agnostic to how that attr source was created &amp;#8211; one&lt;br/&gt;
need not even use analyzers/tokenizer/tokenfilter approach&lt;br/&gt;
at all (create something custom).&lt;/p&gt;

&lt;p&gt;IW now has a lot of embedded logic to figure out how to get the attr&lt;br/&gt;
source &amp;#8211; not analyzed fields, analyzed but it&apos;s a Reader vs a String&lt;br/&gt;
vs pre-analyzed, etc.&lt;/p&gt;

&lt;p&gt;But until then I agree it&apos;s dangerous to default the analyzer &amp;#8211; user&lt;br/&gt;
should be explicit.  It&apos;s similar to how we promoted field truncation&lt;br/&gt;
(max field length) to be an explicit choice, because it&apos;s a dangerous&lt;br/&gt;
default (because it silently alters what makes it into your index).&lt;/p&gt;</comment>
                    <comment id="12843746" author="shaie" created="Wed, 10 Mar 2010 20:07:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;what makes it different is that breaking text into tokens and indexing them is what search is all about.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, and Whitespace is easy to explain and understand. Who said that Standard or Simple is better, for example (I know you don&apos;t say it)? I just don&apos;t understand why we should force everyone to select an Analyzer even when they don&apos;t want to, or care.&lt;/p&gt;

&lt;p&gt;Remember that all the people out there today already set an Analyzer, so when they port to the new API they&apos;ll continue setting it (unless they didn&apos;t care but were forced to do it). New users ... well I hope they read jdocs.&lt;/p&gt;

&lt;p&gt;It&apos;s good that SOLR doesn&apos;t force people to specify the Analyzer ... smart decision, for play/example purposes.&lt;/p&gt;</comment>
                    <comment id="12843750" author="shaie" created="Wed, 10 Mar 2010 20:12:11 +0000"  >&lt;p&gt;Mike - regarding getting rid of Analyzer on IW. Today it&apos;s very convenient that I can specify my default Analyzer for all ANALYZED fields, for all documents. I don&apos;t understand how a Field can introduce an Analyzer - do I now set an Analyzer on every field I add to a Document? Wouldn&apos;t that be extremely inconvenient?&lt;/p&gt;

&lt;p&gt;If you want to get rid of Analyzer on IW I&apos;m fine. We can throw away the addDocument(Doc) method and always force a user to pass an Analyzer. Much better than requiring him to pass it on every field he adds to a document ...&lt;/p&gt;</comment>
                    <comment id="12843756" author="markrmiller@gmail.com" created="Wed, 10 Mar 2010 20:26:35 +0000"  >&lt;p&gt;I&apos;m assuming you would set an Analyzer for the document - and then you could override per field - or something along those lines.&lt;/p&gt;</comment>
                    <comment id="12843761" author="mikemccand" created="Wed, 10 Mar 2010 20:37:08 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2309&quot; title=&quot;Fully decouple IndexWriter from analyzers&quot;&gt;&lt;del&gt;LUCENE-2309&lt;/del&gt;&lt;/a&gt; for decoupling IW from analysis.  IW would only need to know about attr source.&lt;/p&gt;</comment>
                    <comment id="12843762" author="mikemccand" created="Wed, 10 Mar 2010 20:37:36 +0000"  >&lt;p&gt;If we did &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2309&quot; title=&quot;Fully decouple IndexWriter from analyzers&quot;&gt;&lt;del&gt;LUCENE-2309&lt;/del&gt;&lt;/a&gt; then IWC wouldn&apos;t need an Analyzer, default or otherwise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12843784" author="shaie" created="Wed, 10 Mar 2010 21:37:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m assuming you would set an Analyzer for the document - and then you could override per field - or something along those lines.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Isn&apos;t that like calling IW.addDocument(Doc, Analyzer) where some of the fields have pre-defined TokenStream? What&apos;s the difference then? Why change the current API (besides getting rid of the addDoc(Doc) method)?&lt;/p&gt;</comment>
                    <comment id="12843793" author="mikemccand" created="Wed, 10 Mar 2010 22:05:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Isn&apos;t that like calling IW.addDocument(Doc, Analyzer) where some of the fields have pre-defined TokenStream?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, where all of the fields have pre-defined TokenStream, or, can produce it on demand with no other args (ie that field instance knows its analyzer).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What&apos;s the difference then? Why change the current API (besides getting rid of the addDoc(Doc) method)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well it&apos;d simplify your work here, for one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But it&apos;d also put distance between IW and analysis, which I think is useful for others to use Lucene with their own &quot;means&quot; of producing tokens.  Tying IW to less concrete impls also increases our independence which makes cross-version compatibility easier, over time.  The more independent the various parts of Lucene are the more we can factor things out...&lt;/p&gt;</comment>
                    <comment id="12843823" author="shaie" created="Wed, 10 Mar 2010 23:21:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Well it&apos;d simplify your work here, for one&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m afraid that&apos;s too late no? I&apos;ve already completed that work ... it&apos;s that late realization that forces me to re-do it again ... &lt;/p&gt;

&lt;p&gt;I don&apos;t mind if IW does not know about Analyzers, I&apos;m perfectly fine w/ it (and even like it).&lt;/p&gt;

&lt;p&gt;Suggestion: since re-doing all that work, meaning adding Whitespace to the instantiation in all the places that really don&apos;t care, is very expensive and time consuming on my part, if &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2309&quot; title=&quot;Fully decouple IndexWriter from analyzers&quot;&gt;&lt;del&gt;LUCENE-2309&lt;/del&gt;&lt;/a&gt; is resolved before 3.1, can we keep IWC as-is, and as part of 2309 remove setAnalyzer from IWC? It will keep the ctor&apos;s signature as it is now, and we won&apos;t need to change all of these classes again in 2309. Only those that explicitly call setAnalyzer.&lt;/p&gt;

&lt;p&gt;Is that acceptable?&lt;/p&gt;</comment>
                    <comment id="12843963" author="shaie" created="Thu, 11 Mar 2010 08:34:56 +0000"  >&lt;p&gt;Patch w/ IWC requiring an Analyzer in its ctor. All tests pass&lt;/p&gt;</comment>
                    <comment id="12843995" author="mikemccand" created="Thu, 11 Mar 2010 10:15:27 +0000"  >&lt;p&gt;Thanks Shai!  I&apos;ll look through it...&lt;/p&gt;</comment>
                    <comment id="12844201" author="mikemccand" created="Thu, 11 Mar 2010 19:48:41 +0000"  >&lt;p&gt;Patch looks good Shai &amp;#8211; that was fast adding back in the analyzers &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;A few things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Should we also move MergedSegmentWarmer to IWC?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;This adds more Version.LUCENE_CURRENTs in contrib... but I don&apos;t&lt;br/&gt;
    see any way around that (and it&apos;s good to add the placeholder to&lt;br/&gt;
    IWC).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;There were some tests that previously passed null as analyzers,&lt;br/&gt;
    that you changed to WhitespaceAnalyzer, which seems OK.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I see you cleaned some stuff up in the process (fixed &quot;extends&lt;br/&gt;
    TestCase&quot; -&amp;gt; extends &quot;LuceneTestCase&quot;, use TEST_VERSION_CURRENT&lt;br/&gt;
    consistently instead using class member, added Version to ctor for&lt;br/&gt;
    analyzers that now require them, noting that test is deprecated&lt;br/&gt;
    since it only tests deprecated class, fixed places where tests&lt;br/&gt;
    passed null as analyzer) &amp;#8211; good!&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;There are a number of tests where the analyzers were changed, eg&lt;br/&gt;
    Simple -&amp;gt; Whitespace or Standard -&amp;gt; Whitespace &amp;#8211; I attached&lt;br/&gt;
    check.py (run it w/ 1 arg which is path to the patch file).  Note&lt;br/&gt;
    that not all things it finds are actually changed (ie it has some&lt;br/&gt;
    false pos&apos;s, but I think not too many).  Tests still pass... but&lt;br/&gt;
    it makes me a bit nervous.  Shouldn&apos;t we just keep the same&lt;br/&gt;
    analyzer?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12844213" author="shaie" created="Thu, 11 Mar 2010 20:05:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should we also move MergedSegmentWarmer to IWC?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I guess it could ... wonder how I missed it ...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This adds more Version.LUCENE_CURRENTs in contrib... &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I added it on purpose, so we know to convert these places when we remove LUCENE_CURRENT. We can also do this gradually in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2305&quot; title=&quot;Introduce Version in more places long before 4.0&quot;&gt;&lt;del&gt;LUCENE-2305&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There were some tests that previously passed null as analyzers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Those were exactly the cases I wanted to move Analyzer out of the mandatory list. Whatever you pass will work for those tests, because they obviously don&apos;t rely on analysis ... otherwise they&apos;d had been hit by NPE.&lt;br/&gt;
Hmm ... I wonder if I can still pass &apos;null&apos; for them. I used eclipse search/replace tool to add the Analyzer to IWC calls. The null argument disappeared completely because they used the default, so the search/replace tool replaced that w/ Whitespace. I prefer to keep it that way, to avoid re-changing them again.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are a number of tests where the analyzers were changed ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought that that&apos;s ok, because those tests don&apos;t rely on the output of analysis, or otherwise they should have tested/asserted it. Since they don&apos;t, it shouldn&apos;t matter to them. But I&apos;ll revert that change.&lt;/p&gt;

&lt;p&gt;So two things I need to do:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;revert the changes to those tests&lt;/li&gt;
	&lt;li&gt;add warmer to&lt;/li&gt;
&lt;/ol&gt;
</comment>
                    <comment id="12844380" author="shaie" created="Fri, 12 Mar 2010 06:11:13 +0000"  >&lt;p&gt;Patch updated w/:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Move setMergedSegmentWarmer to IWC.&lt;/li&gt;
	&lt;li&gt;Revert the changes reported by check.py&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Note, check.py still alerts on some changes, though I don&apos;t see any relevant change in the patch file. Should I ignore them?&lt;/p&gt;</comment>
                    <comment id="12844455" author="mikemccand" created="Fri, 12 Mar 2010 10:59:18 +0000"  >&lt;p&gt;Thanks Shai, I&apos;ll look...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Note, check.py still alerts on some changes, though I don&apos;t see any relevant change in the patch file. Should I ignore them?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes if they are indeed false positives...&lt;/p&gt;</comment>
                    <comment id="12844461" author="mikemccand" created="Fri, 12 Mar 2010 11:21:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Note, check.py still alerts on some changes, though I don&apos;t see any relevant change in the patch file. Should I ignore them?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm some of these (at least TestAtomicUpdate was changed from Simple -&amp;gt; Whitespace) were in fact real changes.... I&apos;ll fix &amp;amp; post a new patch.&lt;/p&gt;</comment>
                    <comment id="12844465" author="mikemccand" created="Fri, 12 Mar 2010 11:44:20 +0000"  >&lt;p&gt;Attached new patch, just fixing a couple tests where analyzer had changed.&lt;/p&gt;

&lt;p&gt;I it&apos;s ready to commit (take 2)!  I&apos;ll wait a day or two...&lt;/p&gt;</comment>
                    <comment id="12844511" author="shaie" created="Fri, 12 Mar 2010 14:26:16 +0000"  >&lt;p&gt;Thanks Mike. I ran the tool once, fix all that it complained. Then 2nd time it found some more (probably some I missed in the 1st pass), only this time really few more. So I fixed them as well. But I didn&apos;t run it 3rd time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ...&lt;/p&gt;

&lt;p&gt;I can&apos;t wait for this to be in ... an exhausting issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                    <comment id="12844895" author="rcmuir" created="Sat, 13 Mar 2010 15:09:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can&apos;t wait for this to be in ... an exhausting issue&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Shai, thanks for taking the time to redo this massive patch. I&apos;m sorry &lt;br/&gt;
again I dropped the ball and didn&apos;t notice till the commit, forcing you &lt;br/&gt;
to redo a lot of work.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="12844899" author="shaie" created="Sat, 13 Mar 2010 15:18:54 +0000"  >&lt;p&gt;Thanks a lot Robert for reviewing this. No harm done ... I&apos;ve had the chance to exercise some of Eclipse tricks in the process or re-doing. Unfortunately it introduced some changes, but luckily we have Mike and his mighty-python-scripting-ability to protect us &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Now I have a bunch of other issues I need to open, that were waiting for this guy to go in. Stay tuned&lt;/p&gt;</comment>
                    <comment id="12844904" author="mikemccand" created="Sat, 13 Mar 2010 15:35:40 +0000"  >&lt;p&gt;Take 2!  Thanks Shai.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12458038">LUCENE-2293</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12458250">LUCENE-2297</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12438532" name="check.py" size="1100" author="mikemccand" created="Thu, 11 Mar 2010 19:48:41 +0000" />
                    <attachment id="12438607" name="LUCENE-2294.patch" size="582236" author="mikemccand" created="Fri, 12 Mar 2010 11:44:20 +0000" />
                    <attachment id="12438580" name="LUCENE-2294.patch" size="584004" author="shaie" created="Fri, 12 Mar 2010 06:11:12 +0000" />
                    <attachment id="12438490" name="LUCENE-2294.patch" size="586106" author="shaie" created="Thu, 11 Mar 2010 08:34:56 +0000" />
                    <attachment id="12438228" name="LUCENE-2294.patch" size="569684" author="shaie" created="Mon, 8 Mar 2010 20:10:50 +0000" />
                    <attachment id="12438081" name="LUCENE-2294.patch" size="63430" author="shaie" created="Sat, 6 Mar 2010 04:40:58 +0000" />
                    <attachment id="12438012" name="LUCENE-2294.patch" size="61079" author="shaie" created="Fri, 5 Mar 2010 14:01:56 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>7.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 4 Mar 2010 09:58:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11499</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25431</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>