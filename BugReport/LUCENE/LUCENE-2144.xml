<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 12:57:30 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2144/LUCENE-2144.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2144] InstantiatedIndexReader does not handle #termDocs(null) correct (AllTermDocs)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2144</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;This patch contains core changes so someone else needs to commit it.&lt;/p&gt;

&lt;p&gt;Due to the incompatible #termDocs(null) behaviour at least MatchAllDocsQuery, FieldCacheRangeFilter and ValueSourceQuery fails using II since 2.9.&lt;/p&gt;

&lt;p&gt;AllTermDocs now has a superclass, AbstractAllTermDocs that also InstantiatedAllTermDocs extend.&lt;/p&gt;

&lt;p&gt;Also:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;II-tests made less plausable to pass on future incompatible changes to TermDocs and TermEnum&lt;/li&gt;
	&lt;li&gt;IITermDocs#skipTo and #next mimics the behaviour of document posisioning from SegmentTermDocs#dito when returning false&lt;/li&gt;
	&lt;li&gt;II now uses BitVector rather than sets for deleted documents&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12443022">LUCENE-2144</key>
            <summary>InstantiatedIndexReader does not handle #termDocs(null) correct (AllTermDocs)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="karl.wettin">Karl Wettin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Dec 2009 20:12:30 +0000</created>
                <updated>Thu, 25 Feb 2010 10:18:04 +0000</updated>
                    <resolved>Fri, 11 Dec 2009 16:31:57 +0000</resolved>
                            <version>2.9</version>
                <version>2.9.1</version>
                <version>3.0</version>
                                <fixVersion>2.9.2</fixVersion>
                <fixVersion>3.0.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12788899" author="karl.wettin" created="Thu, 10 Dec 2009 20:28:17 +0000"  >&lt;p&gt;BUILD SUCCESSFUL&lt;br/&gt;
Total time: 36 minutes 4 seconds&lt;/p&gt;</comment>
                    <comment id="12788943" author="mikemccand" created="Thu, 10 Dec 2009 21:33:28 +0000"  >&lt;p&gt;Patch looks good; tests pass.  I&apos;ll commit shortly.&lt;/p&gt;

&lt;p&gt;The core change is to just make it possible to override isDeleted logic in AllTermDocs.&lt;/p&gt;

&lt;p&gt;The flex API makes this easier &amp;#8211; you must provided a Bits (new interface),  specifying the docs you want to skip, when you request the DocsEnum.&lt;/p&gt;

&lt;p&gt;We should fix this on at least 3.0 as well right?&lt;/p&gt;</comment>
                    <comment id="12788950" author="karl.wettin" created="Thu, 10 Dec 2009 21:46:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should fix this on at least 3.0 as well right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Would be great if you had the bandwidth to fix that.&lt;/p&gt;</comment>
                    <comment id="12788957" author="mikemccand" created="Thu, 10 Dec 2009 21:58:11 +0000"  >&lt;p&gt;Hmm &amp;#8211; I did the svn merge back to 3.0, but I hit these test failures:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] Testcase: testLoadIndexReader(org.apache.lucene.store.instantiated.TestIndicesEquals):	FAILED
    [junit] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    [junit] junit.framework.AssertionFailedError
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testTermDocsSomeMore(TestIndicesEquals.java:226)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testEquals(TestIndicesEquals.java:363)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testEqualBehaviour(TestIndicesEquals.java:306)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testLoadIndexReader(TestIndicesEquals.java:77)
    [junit] 
    [junit] 
    [junit] Testcase: testInstantiatedIndexWriter(org.apache.lucene.store.instantiated.TestIndicesEquals):	FAILED
    [junit] &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    [junit] junit.framework.AssertionFailedError
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testTermDocsSomeMore(TestIndicesEquals.java:226)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testEquals(TestIndicesEquals.java:363)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testEqualBehaviour(TestIndicesEquals.java:306)
    [junit] 	at org.apache.lucene.store.instantiated.TestIndicesEquals.testInstantiatedIndexWriter(TestIndicesEquals.java:106)
    [junit] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any ideas?&lt;/p&gt;</comment>
                    <comment id="12788966" author="karl.wettin" created="Thu, 10 Dec 2009 22:08:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;at org.apache.lucene.store.instantiated.TestIndicesEquals.testTermDocsSomeMore(TestIndicesEquals.java:226)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have no idea. How do I merge back locally so I can debug it?&lt;/p&gt;

</comment>
                    <comment id="12788968" author="mikemccand" created="Thu, 10 Dec 2009 22:13:02 +0000"  >&lt;p&gt;Attached diffs from my merge back onto 3.0.&lt;/p&gt;</comment>
                    <comment id="12789021" author="karl.wettin" created="Thu, 10 Dec 2009 23:28:24 +0000"  >&lt;p&gt;Committed change to trunk.&lt;/p&gt;

&lt;p&gt;In 3.0 comment out ~line 227 in TestIndicesEquals&lt;/p&gt;

&lt;p&gt;    // this is invalid use of the API,&lt;br/&gt;
    // but if the response differs then it&apos;s an indication that something might have changed.&lt;br/&gt;
    // in 2.9 and 3.0 the two TermDocs-implementations returned different values at this point.&lt;br/&gt;
    assertEquals(&quot;Descripency during invalid use of the TermDocs API, see comments in test code for details.&quot;,&lt;br/&gt;
        aprioriTermDocs.next(), testTermDocs.next());&lt;/p&gt;</comment>
                    <comment id="12789051" author="mikemccand" created="Fri, 11 Dec 2009 00:28:12 +0000"  >&lt;p&gt;I think we shouldn&apos;t test the invalid case?  EG trunk could change &lt;span class=&quot;error&quot;&gt;&amp;#91;again&amp;#93;&lt;/span&gt; sometime, which&apos;d cause a false failure here?  Ie, we should just remove the test of the un-seek&apos;d TermDocs.next() calls?&lt;/p&gt;</comment>
                    <comment id="12789248" author="karl.wettin" created="Fri, 11 Dec 2009 11:26:02 +0000"  >&lt;p&gt;I don&apos;t have any strong feelings about this line of code, but let me at least explain it.&lt;/p&gt;

&lt;p&gt;I like the idea that IIFoo behaves the same way a SegementFoo, even during incorrect/undocumented use of the API. &lt;/p&gt;

&lt;p&gt;There are no real use cases for this in the Lucene distribution, there are however effects people might use even though caused by invalid use of the API and not recommened. E.g. a skipTo to a target greater than the greatest document associated with that term will position the enum at the greatest document number for that term. Even though I wouldn&apos;t do something like this others might. &lt;/p&gt;

&lt;p&gt;In this case, where an immediate #next() on IR#termDocs() is called, it&apos;s might look silly to compare the behaviour of II and Segment as it&apos;s such blatantly erroneous use of the API, but even I have been known to come up with some rather strange solution now and then when nobody else is looking.&lt;/p&gt;

&lt;p&gt;One alternative is that  #next would produce an InvalidStateException or something instead of just accepting the call, but then there is of course the small extra cost associated with checking if the enum has been seeked yet and #next is a rather commonly used method.&lt;/p&gt;</comment>
                    <comment id="12789355" author="mikemccand" created="Fri, 11 Dec 2009 15:56:15 +0000"  >&lt;p&gt;Thanks Karl &amp;#8211; I&apos;ll back port to 3.0 &amp;amp; commit.&lt;/p&gt;</comment>
                    <comment id="12789375" author="mikemccand" created="Fri, 11 Dec 2009 16:31:57 +0000"  >&lt;p&gt;Thanks Karl!&lt;/p&gt;</comment>
                    <comment id="12833387" author="thetaphi" created="Sat, 13 Feb 2010 12:52:03 +0000"  >&lt;p&gt;merge back also to 2.9.2&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12427642" name="LUCENE-2144-30.patch" size="27779" author="mikemccand" created="Thu, 10 Dec 2009 22:13:02 +0000" />
                    <attachment id="12427629" name="LUCENE-2144.txt" size="28587" author="karl.wettin" created="Thu, 10 Dec 2009 20:28:17 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 10 Dec 2009 21:33:28 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11638</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25581</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>