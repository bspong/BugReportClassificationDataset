<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:12:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2667/LUCENE-2667.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2667] Fix FuzzyQuery&apos;s defaults, so its fast.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2667</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We worked a lot on FuzzyQuery, but you need to be a rocket scientist to ensure good results.&lt;/p&gt;

&lt;p&gt;The main problem is that the default distance is 0.5f, which doesn&apos;t take into account the length of the string.&lt;br/&gt;
To add insult to injury, the default number of expansions is 1024 (traditionally from BooleanQuery maxClauseCount)&lt;/p&gt;

&lt;p&gt;I propose:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The syntax of FuzzyQuery is enhanced, so that you can specify raw edits too: such as foobar~2 (all terms within 2 levenshtein edits of foobar). Previously if you specified any amount &amp;gt;=1, you got IllegalArgumentException, so this won&apos;t break anyone. You can still use foobar~0.5, and it works just as before&lt;/li&gt;
	&lt;li&gt;The default for minimumSimilarity then becomes LevenshteinAutomata.MAXIMUM_SUPPORTED_DISTANCE, which is 2. This way if you just do foobar~, its always fast.&lt;/li&gt;
	&lt;li&gt;The size of the priority queue is reduced by default from 1024 to a much more reasonable value: 50. This is what FuzzyLikeThis uses.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think its best to just change the defaults for this query, since it was so aweful before. We can add notes in migrate.txt that if you care about using the old values, then you should provide them explicitly, and you will get the same results!&lt;/p&gt;</description>
                <environment></environment>
            <key id="12475088">LUCENE-2667</key>
            <summary>Fix FuzzyQuery&apos;s defaults, so its fast.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Sep 2010 00:45:02 +0100</created>
                <updated>Fri, 10 May 2013 11:43:36 +0100</updated>
                    <resolved>Wed, 20 Oct 2010 03:14:06 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12914787" author="simonw" created="Sat, 25 Sep 2010 09:45:25 +0100"  >
&lt;blockquote&gt;&lt;p&gt;I think its best to just change the defaults for this query, since it was so aweful before. We can add notes in migrate.txt that if you care about using the old values, then you should provide them explicitly, and you will get the same results!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;Thanks robert for bringing this up. Changes to the queryparsers look good to me I only have one comment about the harmony code, could you put the svn path and revision into a comment so we can track possible changes later more easily? I personally think moving to 1.6 is far away &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;I propose:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to all the proposals &lt;/p&gt;</comment>
                    <comment id="12914798" author="mikemccand" created="Sat, 25 Sep 2010 11:01:13 +0100"  >&lt;p&gt;This looks great!  I&apos;m always confused by the fuzzy distance measure (when it&apos;s ~X where X &amp;lt; 1).&lt;/p&gt;

&lt;p&gt;You needed that nextAfter method to ensure that the truncation used when computing initialMaxDistance always &quot;inverts&quot; correctly, for the X &amp;gt;= 1.0 case?&lt;/p&gt;</comment>
                    <comment id="12914800" author="rcmuir" created="Sat, 25 Sep 2010 11:09:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;could you put the svn path and revision into a comment so we can track possible changes later more easily?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;great idea... i didnt mean to forget it: i put it in my local.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/harmony/enhanced/java/branches/java6/classlib/modules/luni/src/main/java/java/lang/StrictMath.java&quot; class=&quot;external-link&quot;&gt;http://svn.apache.org/viewvc/harmony/enhanced/java/branches/java6/classlib/modules/luni/src/main/java/java/lang/StrictMath.java&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You needed that nextAfter method to ensure that the truncation used when computing initialMaxDistance always &quot;inverts&quot; correctly, for the X &amp;gt;= 1.0 case?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;right, our fuzzy&apos;s scaling is wierd. and it compares with &apos;&amp;gt;&apos;. so if ed=2 computes to 0.5, we have to nudge the float a bit, because minSimilarity is non-inclusive.&lt;/p&gt;</comment>
                    <comment id="12915748" author="rcmuir" created="Tue, 28 Sep 2010 14:50:30 +0100"  >&lt;p&gt;here&apos;s an updated patch, i think this is ready to commit.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;use integer calculations internally to avoid the tricky float stuff&lt;/li&gt;
	&lt;li&gt;i added tests for the case where the edit distance is greater than the word.&lt;br/&gt;
  previously, it was not possible to issue these type of queries, as noted in the enum
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      // this will return less than 0.0 when the edit distance is
      // greater than the number of characters in the shorter word.
      // but this was the formula that was previously used in FuzzyTermEnum,
      // so it has not been changed (even though minimumSimilarity must be
      // greater than 0.0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;i removed a TODO, so the linear enum gets an optimization from the priority queue,&lt;br/&gt;
  in that it uses the updated maxEdits to quickly reject too long/too short terms.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12915757" author="mikemccand" created="Tue, 28 Sep 2010 15:29:13 +0100"  >&lt;p&gt;Patch looks great Robert!&lt;/p&gt;</comment>
                    <comment id="12915779" author="rcmuir" created="Tue, 28 Sep 2010 16:12:02 +0100"  >&lt;p&gt;Committed revision 1002214&lt;/p&gt;</comment>
                    <comment id="12922822" author="rcmuir" created="Wed, 20 Oct 2010 02:53:12 +0100"  >&lt;p&gt;i missed some things in the contrib/queryparser when doing this.&lt;/p&gt;</comment>
                    <comment id="12922827" author="rcmuir" created="Wed, 20 Oct 2010 03:14:06 +0100"  >&lt;p&gt;Committed revision 1024498 for the contrib parsers... hopefully I don&apos;t find any more I missed!&lt;/p&gt;</comment>
                    <comment id="13454753" author="fjalvarezs" created="Thu, 13 Sep 2012 10:02:39 +0100"  >&lt;p&gt;The Fuzzy Search functionality has been dramatically limited with this new implementation.&lt;/p&gt;

&lt;p&gt;Before it was possible to search with edit distances higher than 2, which is really necessary in many situations.&lt;/p&gt;

&lt;p&gt;We have tried to increase the MAXIMUM_SUPPORTED_DISTANCE value but got the following error:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
     at org.apache.lucene.util.automaton.UTF32ToUTF8.convert(UTF32ToUTF8.java:259)&lt;br/&gt;
     at org.apache.lucene.util.automaton.CompiledAutomaton.&amp;lt;init&amp;gt;(CompiledAutomaton.java:163)&lt;br/&gt;
     at org.apache.lucene.search.FuzzyTermsEnum.initAutomata(FuzzyTermsEnum.java:182)&lt;br/&gt;
     at org.apache.lucene.search.FuzzyTermsEnum.getAutomatonEnum(FuzzyTermsEnum.java:153)&lt;br/&gt;
     at org.apache.lucene.search.FuzzyTermsEnum.maxEditDistanceChanged(FuzzyTermsEnum.java:217)&lt;/p&gt;

&lt;p&gt;We need a solution for fuzzy searches higher than 2 edit distances to keep consistent behaviour with Lucene 3.x&lt;/p&gt;
</comment>
                    <comment id="13454759" author="thetaphi" created="Thu, 13 Sep 2012 10:17:05 +0100"  >&lt;p&gt;Hi Francisco: The core FuzzyQuery does not support edit distances &amp;gt; 2, because the automatons used for this would be too big and slow. If you really want distances &amp;gt; 2, use &lt;a href=&quot;http://lucene.apache.org/core/4_0_0-BETA/sandbox/org/apache/lucene/sandbox/queries/SlowFuzzyQuery.html&quot; class=&quot;external-link&quot;&gt;http://lucene.apache.org/core/4_0_0-BETA/sandbox/org/apache/lucene/sandbox/queries/SlowFuzzyQuery.html&lt;/a&gt; from the sandbox module (lucene-sandbox.jar). This one is the same algorithm as the old 3.x FuzzyQuery (and is as slow).&lt;/p&gt;</comment>
                    <comment id="13454781" author="fjalvarezs" created="Thu, 13 Sep 2012 11:02:18 +0100"  >&lt;p&gt;I see, thanks for your quick reply!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12457631" name="LUCENE-2667_contrib.patch" size="9417" author="rcmuir" created="Wed, 20 Oct 2010 02:53:39 +0100" />
                    <attachment id="12455830" name="LUCENE-2667.patch" size="36929" author="rcmuir" created="Tue, 28 Sep 2010 14:50:30 +0100" />
                    <attachment id="12455533" name="LUCENE-2667.patch" size="36206" author="rcmuir" created="Sat, 25 Sep 2010 00:45:29 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 25 Sep 2010 08:45:25 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11174</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25025</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>