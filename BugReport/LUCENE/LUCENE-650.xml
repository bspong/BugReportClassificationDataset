<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-650/LUCENE-650.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-650] NPE doing local sensitive sorting when sort field is missing</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-650</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;If you do a local sensitive sort against a field that is missing from some documents in the index an NPE will get thrown.&lt;/p&gt;

&lt;p&gt;Attached is a patch which resolved the issue and updates the sort test case to give coverage to this issue.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12347874">LUCENE-650</key>
            <summary>NPE doing local sensitive sorting when sort field is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="hossman">Hoss Man</assignee>
                                <reporter username="ohutchison">Oliver Hutchison</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Aug 2006 00:39:51 +0100</created>
                <updated>Sun, 20 Aug 2006 22:16:54 +0100</updated>
                    <resolved>Sun, 20 Aug 2006 22:16:54 +0100</resolved>
                            <version>2.0.0</version>
                                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12428955" author="doronc" created="Fri, 18 Aug 2006 10:45:23 +0100"  >&lt;p&gt;I reviewed this patch and think that it is valid.&lt;/p&gt;

&lt;p&gt;This seems like a real bug:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In FieldSortedHitQueue, when no locale is specified, a comparator is based on getStringsIndex() - because the natural terms order can be used for comparison.&lt;/li&gt;
	&lt;li&gt;Notice that getStringsIndex() has a special care for docs with no values - their index is set to 0 (default index array initialization) and all terms are placed from index 1 and up.&lt;/li&gt;
	&lt;li&gt;But when a locale is specified, the natural terms cannot be used, and hence getStrings() is used (instead of getStringsIndex()). Here there is no special care for &quot;no values&quot;, and hence the result strings array can contain nulls.&lt;/li&gt;
	&lt;li&gt;These null values are later passed to the  locale comparator, and e get wa NPE.&lt;/li&gt;
	&lt;li&gt;The Javadocs for java.text.Collator do not specify behavior for null argument, so this can not be regarded as an issue of a certain JDK implementation - we should avoid passing null to the comparator.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I see two ways to solve this: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;one is to assign &quot;&quot; (empty string) in the comparator for all the null values. But this would modify the semantics of the FieldCache, that stores this array of strings. It would be wrong to do so, and it would also take more time.&lt;/li&gt;
	&lt;li&gt;the other way - that seems the right way - is that of this patch, which handles null values just before passing them to the collator compare method. (The 3 if statements added may have performance implications - I did not test performance.)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I ran the TestSort (from the patch) without applying the patch fix to FieldSortedHitQueue, and the test failed. After applying the fix to FieldSortedHitQueue the test passed.  All &quot;ant test&quot; tests pass as well.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Doron&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12429298" author="hossman" created="Sun, 20 Aug 2006 22:16:54 +0100"  >&lt;p&gt;Attached patch: demonstrates bug with test, provides fix, applies cleanly, breaks no other existing tests.&lt;/p&gt;

&lt;p&gt;Applied and commited.&lt;/p&gt;


&lt;p&gt;Thanx Oliver&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12338767" name="ASF.LICENSE.NOT.GRANTED--sortNpeFix.patch" size="1644" author="ohutchison" created="Mon, 14 Aug 2006 00:39:51 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 18 Aug 2006 09:45:23 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13102</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27080</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>