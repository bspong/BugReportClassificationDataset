<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2891/LUCENE-2891.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2891] IndexWriterConfig does not allow readerTermsIndexDivisor to be -1, while the latest indicates the terms index should not be loaded</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2891</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;While you can pass -1 to IR.open(), and it&apos;s documented, you cannot do the same for IndexWriter&apos;s readers (b/c IWC blocks it). Need to allow this setting as well as add support for it in our tests, e.g. we should randomly set it to -1. Robert also suggested RandomIW use -1 randomly when it opens readers.&lt;/p&gt;

&lt;p&gt;I&apos;ll work on a patch&lt;/p&gt;</description>
                <environment></environment>
            <key id="12496811">LUCENE-2891</key>
            <summary>IndexWriterConfig does not allow readerTermsIndexDivisor to be -1, while the latest indicates the terms index should not be loaded</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="shaie">Shai Erera</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jan 2011 14:24:55 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:15 +0100</updated>
                    <resolved>Thu, 27 Jan 2011 20:10:32 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12987043" author="shaie" created="Wed, 26 Jan 2011 15:14:57 +0000"  >&lt;p&gt;Patch supports -1 passed to IWC.setReaderTermIndexDivisor and randomly sets it in LuceneTestCase.newIndexWriterConfig() and RandomIndexWriter.&lt;/p&gt;

&lt;p&gt;Many tests fail with exceptions like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] java.lang.IllegalStateException: terms index was not loaded when this reader was createde=29178856,total=88990720
    [junit]     at org.apache.lucene.index.TermInfosReader.ensureIndexIsRead(TermInfosReader.java:309)
    [junit]     at org.apache.lucene.index.TermInfosReader.get(TermInfosReader.java:215)
    [junit]     at org.apache.lucene.index.TermInfosReader.get(TermInfosReader.java:208)
    [junit]     at org.apache.lucene.index.SegmentTermDocs.seek(SegmentTermDocs.java:57)        Caused an ERROR
    [junit]     at org.apache.lucene.index.BufferedDeletes.applyDeletes(BufferedDeletes.java:301)
    [junit]     at org.apache.lucene.index.BufferedDeletes.applyDeletes(BufferedDeletes.java:289)ted
    [junit]     at org.apache.lucene.index.BufferedDeletes.applyDeletes(BufferedDeletes.java:191):309)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So maybe IWC not supporting -1 is not a bug? I didn&apos;t see anywhere, even in IR.open() what are the consequences of not loading the terms index. Thought it just means slower term seeks, but apparently it&apos;s not supported?&lt;/p&gt;

&lt;p&gt;If so, I think we should mention IR.open() what does it mean to not load the terms index.&lt;/p&gt;</comment>
                    <comment id="12987058" author="mikemccand" created="Wed, 26 Jan 2011 15:39:18 +0000"  >&lt;p&gt;-1 means &quot;don&apos;t load terms index because I will never, ever seek-by-Term&quot;.  As far as I know, it&apos;s only segment merging that does this...&lt;/p&gt;

&lt;p&gt;Maybe we shouldn&apos;t allow it for IR.open?  Though, eg if you want to pass the reader to addIndexes (say), opening with -1 should work...&lt;/p&gt;</comment>
                    <comment id="12987074" author="shaie" created="Wed, 26 Jan 2011 16:00:58 +0000"  >&lt;p&gt;Removed the random setting in tests and added a test TestIndexWriterReader.testNoTermsIndex() which ensure IR.open(IW) and seek-by-term throws an exception when the setting is set to -1 on IWC.&lt;/p&gt;</comment>
                    <comment id="12987124" author="rcmuir" created="Wed, 26 Jan 2011 18:03:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;-1 means &quot;don&apos;t load terms index because I will never, ever seek-by-Term&quot;. As far as I know, it&apos;s only segment merging that does this...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;but it allows next()&apos;ing through all the terms only?&lt;/p&gt;

&lt;p&gt;I suggested the testing because I had seen some code for -1 but I didn&apos;t know how tested it is,&lt;br/&gt;
its a tad confusing in the javadoc which just says &quot;Set this to -1 to skip loading the terms index entirely.&quot;&lt;/p&gt;

&lt;p&gt;This makes me think (based on the language &quot;skip loading&quot;), that if you do this everything will still work, &lt;br/&gt;
but seek() will just be brute-force or something aweful...&lt;/p&gt;</comment>
                    <comment id="12987254" author="mikemccand" created="Wed, 26 Jan 2011 22:05:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;but it allows next()&apos;ing through all the terms only?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I suggested the testing because I had seen some code for -1 but I didn&apos;t know how tested it is,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s tested inside IW &amp;#8211; for merging, it opens all SRs w/ -1.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;its a tad confusing in the javadoc which just says &quot;Set this to -1 to skip loading the terms index entirely.&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree &amp;#8211; I think we should sharpen the jdocs to state that this is only useful in very narrow situations, ie when you are certain you just need to next() through all terms.  (And probably mark this value as @lucene.experimental... maybe internal?).&lt;/p&gt;</comment>
                    <comment id="12987408" author="shaie" created="Thu, 27 Jan 2011 07:00:34 +0000"  >&lt;p&gt;Did you guys review my latest patch, which includes a clarification in the jdocs?&lt;/p&gt;</comment>
                    <comment id="12987586" author="shaie" created="Thu, 27 Jan 2011 14:39:43 +0000"  >&lt;p&gt;Patch fixes javadocs and renames term infos to terms index. I plan to commit this later today or tomorrow morning.&lt;/p&gt;</comment>
                    <comment id="12987708" author="shaie" created="Thu, 27 Jan 2011 19:03:29 +0000"  >&lt;p&gt;Fixed issue subject (replaced termInfos with terms index)&lt;/p&gt;</comment>
                    <comment id="12987731" author="shaie" created="Thu, 27 Jan 2011 20:10:32 +0000"  >&lt;p&gt;Committed revision 1064255 (3x).&lt;br/&gt;
Committed revision 1064285 (trunk).&lt;/p&gt;

&lt;p&gt;Merge to trunk was not so easy. testNoTermsIndex had to use different API than in 3x (which is ok), but the it turns out few Codecs don&apos;t honor the -1 setting, like PreFlex and SimpleText. Surprisingly, MockRandom also fails. I put all of them into an illegalCodecs Set and if that&apos;s what the test draws, the test does not continue and succeeds.&lt;/p&gt;

&lt;p&gt;I&apos;ll open a separate issue to check why MockRandomCodec fails the test (i.e., why doesn&apos;t it honor the -1 setting).&lt;/p&gt;</comment>
                    <comment id="13013416" author="gsingers" created="Wed, 30 Mar 2011 16:50:15 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12469552" name="LUCENE-2891.patch" size="4880" author="shaie" created="Thu, 27 Jan 2011 14:39:42 +0000" />
                    <attachment id="12469431" name="LUCENE-2891.patch" size="4702" author="shaie" created="Wed, 26 Jan 2011 16:00:58 +0000" />
                    <attachment id="12469426" name="LUCENE-2891.patch" size="4176" author="shaie" created="Wed, 26 Jan 2011 15:14:57 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 26 Jan 2011 15:39:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10977</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24801</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>