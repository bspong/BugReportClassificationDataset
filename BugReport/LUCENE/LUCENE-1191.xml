<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:00 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1191/LUCENE-1191.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1191] If IndexWriter hits OutOfMemoryError it should not commit</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1191</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;While progress has been made making IndexWriter robust to OOME, I&lt;br/&gt;
think there is still a real risk that an OOME at a bad time could put&lt;br/&gt;
IndexWriter into a bad state such that if close() is called and&lt;br/&gt;
somehow it succeeds without hitting another OOME, it risks&lt;br/&gt;
introducing messing up the index.&lt;/p&gt;

&lt;p&gt;I&apos;d like to detect if OOME has been hit in any of the methods that&lt;br/&gt;
alter IW&apos;s state, and if so, do not commit changes to the index.  If&lt;br/&gt;
close is called after hitting OOME, I think writer should instead&lt;br/&gt;
abort.&lt;/p&gt;

&lt;p&gt;Attached patch just adds try/catch clauses to catch OOME, note that&lt;br/&gt;
it was hit, and re-throw it.  Then, sync() refuses to commit a new&lt;br/&gt;
segments_N if OOME was hit, and close instead calls abort when OOME&lt;br/&gt;
was hit.  All tests pass.  I plan to commit in a day or two.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12389529">LUCENE-1191</key>
            <summary>If IndexWriter hits OutOfMemoryError it should not commit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Feb 2008 21:25:16 +0000</created>
                <updated>Thu, 8 May 2008 20:47:58 +0100</updated>
                    <resolved>Thu, 28 Feb 2008 21:35:45 +0000</resolved>
                            <version>1.9</version>
                <version>2.0.0</version>
                <version>2.1</version>
                <version>2.2</version>
                <version>2.3</version>
                <version>2.3.1</version>
                <version>2.4</version>
                                <fixVersion>2.3.2</fixVersion>
                <fixVersion>2.4</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12572265" author="karl.wettin" created="Mon, 25 Feb 2008 22:04:27 +0000"  >&lt;p&gt;I think I hit that problem this weekend. One of my writer threads died due to an OOME, but the other threads kept going as memory was released from the dying thread. I then hit this SegmentMerger#appendPostings exception each flush: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (doc &amp;lt; 0 || (df &amp;gt; 0 &amp;amp;&amp;amp; doc &amp;lt;= lastDoc))
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CorruptIndexException(&lt;span class=&quot;code-quote&quot;&gt;&quot;docs out of order (&quot;&lt;/span&gt; + doc +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; &amp;lt;= &quot;&lt;/span&gt; + lastDoc + &lt;span class=&quot;code-quote&quot;&gt;&quot; )&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12572270" author="mikemccand" created="Mon, 25 Feb 2008 22:13:32 +0000"  >&lt;p&gt;Karl, was that with trunk, 2.3.0 or 2.3.1?&lt;/p&gt;</comment>
                    <comment id="12572273" author="karl.wettin" created="Mon, 25 Feb 2008 22:17:05 +0000"  >&lt;p&gt;2.3.0&lt;/p&gt;</comment>
                    <comment id="12572277" author="mikemccand" created="Mon, 25 Feb 2008 22:24:59 +0000"  >&lt;p&gt;OK.  &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1171&quot; title=&quot;Make DocumentsWriter more robust on hitting OOM&quot;&gt;&lt;del&gt;LUCENE-1171&lt;/del&gt;&lt;/a&gt; fixed certain OOM cases after 2.3.0, and was backported to 2.3.1, and it may have fixed this although I didn&apos;t think there were cases that would lead to corruption of the posting lists.  If you also see this happen on 2.3.1 please report back!&lt;/p&gt;</comment>
                    <comment id="12577570" author="hossman" created="Tue, 11 Mar 2008 19:27:21 +0000"  >&lt;p&gt;targeted for 2.3.2 bug fix release&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12376444" name="LUCENE-1191.patch" size="26865" author="mikemccand" created="Mon, 25 Feb 2008 21:26:04 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 25 Feb 2008 22:04:27 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12554</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26538</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>