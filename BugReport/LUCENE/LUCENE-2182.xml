<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:35:17 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2182/LUCENE-2182.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2182] DEFAULT_ATTRIBUTE_FACTORY faills to load implementation class when iterface comes from different classloader</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2182</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;This is a followup for &lt;a href=&quot;http://www.lucidimagination.com/search/document/1724fcb3712bafba/using_the_new_tokenizer_api_from_a_jar_file&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/1724fcb3712bafba/using_the_new_tokenizer_api_from_a_jar_file&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;The DEFAULT_ATTRIBUTE_FACTORY should load the implementation class for a given attribute interface from the same classloader like the attribute interface. The current code loads it from the classloader of the lucene-core.jar file. In solr this fails when the interface is in a JAR file coming from the plugins folder. &lt;/p&gt;

&lt;p&gt;The interface is loaded correctly, because the addAttribute(FooAttribute.class) loads the FooAttribute.class from the plugin code and this with success. But as addAttribute tries to load the class from its local lucene-core.jar classloader it will not find the attribute.&lt;/p&gt;

&lt;p&gt;The fix is to tell Class.forName to use the classloader of the corresponding interface, which is the correct way to handle it, as the impl and the attribute should always be in the same classloader and file.&lt;/p&gt;

&lt;p&gt;I hope I can somehow add a test for that.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12444241">LUCENE-2182</key>
            <summary>DEFAULT_ATTRIBUTE_FACTORY faills to load implementation class when iterface comes from different classloader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Dec 2009 09:58:10 +0000</created>
                <updated>Thu, 25 Feb 2010 10:18:04 +0000</updated>
                    <resolved>Tue, 29 Dec 2009 11:15:25 +0000</resolved>
                            <version>2.9.1</version>
                <version>3.0</version>
                                <fixVersion>2.9.2</fixVersion>
                <fixVersion>3.0.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12794791" author="thetaphi" created="Mon, 28 Dec 2009 09:59:12 +0000"  >&lt;p&gt;The patch.&lt;/p&gt;

&lt;p&gt;Hello Solr committers: Should we backport this to 2.9 and 3.0 (which is easy)?&lt;/p&gt;</comment>
                    <comment id="12794797" author="shalinmangar" created="Mon, 28 Dec 2009 10:36:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;In solr this fails when the interface is in a JAR file coming from the plugins folder&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Which interface are we talking about?&lt;/p&gt;</comment>
                    <comment id="12794799" author="thetaphi" created="Mon, 28 Dec 2009 10:51:24 +0000"  >&lt;p&gt;Shalin:&lt;/p&gt;

&lt;p&gt;If you use the new AttributeSource API for TokenStreams and define an own attribute (like the person did), you have to define two classes, see:&lt;br/&gt;
&lt;a href=&quot;http://lucene.apache.org/java/3_0_0/api/core/org/apache/lucene/analysis/package-summary.html&quot; class=&quot;external-link&quot;&gt;http://lucene.apache.org/java/3_0_0/api/core/org/apache/lucene/analysis/package-summary.html&lt;/a&gt; -&amp;gt; New TokenStream API -&amp;gt; defining own attribute.&lt;/p&gt;

&lt;p&gt;You define an interface for your attribute and also define an implementation class. The TokenStream will call addAttribute(CustomAttribute.class) and the default attribute factory inside Lucene will then load the &quot;default&quot; implementation class &quot;CustomAttributeImpl&quot;. This is done via reflection and Class.forName.&lt;/p&gt;

&lt;p&gt;If the interface is defined in an own Classloader (like the interface and impl is put into the solr plugins folder), the interface itsself is loaded correctly (because instantiated by the plugin&apos;s tokenstream code). But the code inside AttributeSource then tries to load the Impl class with forName(attributeClassName + &quot;Impl&quot;). As forName per default uses the classloader from the calling class, this fails, because th classloader lucene was loaded with does not know the plugins folder.&lt;/p&gt;

&lt;p&gt;Therefore, the implementation class must be loaded with the same classloader as the interface Class&amp;lt;? extends Attribute&amp;gt; object passed into addAttribute().&lt;/p&gt;

&lt;p&gt;Thats not a failure of Solr, but it the mechanism prevents putting own attribute impls into plugins of solr. They must be in the lib folder where lucene-core.jar is. By this patch it is more consistent and enforces, that the impl class comes from the same source as the base attribute.&lt;/p&gt;</comment>
                    <comment id="12794800" author="shalinmangar" created="Mon, 28 Dec 2009 10:59:15 +0000"  >&lt;p&gt;I see, thanks for the explanation!&lt;/p&gt;

&lt;p&gt;I agree, it would be nice if we can back port this to 2.9 if you have some spare cycles.&lt;/p&gt;</comment>
                    <comment id="12794830" author="michaelbusch" created="Mon, 28 Dec 2009 15:51:36 +0000"  >&lt;p&gt;Looks like a good solution!&lt;/p&gt;

&lt;p&gt;Thanks for taking care of this, Uwe!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Should we backport this to 2.9 and 3.0 (which is easy)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="12794949" author="thetaphi" created="Mon, 28 Dec 2009 22:21:05 +0000"  >&lt;p&gt;I will commit and backport tomorrow!&lt;/p&gt;</comment>
                    <comment id="12795037" author="thetaphi" created="Tue, 29 Dec 2009 11:15:25 +0000"  >&lt;p&gt;Committed trunk revision: 894348&lt;br/&gt;
Committed Lucene 3.0 revision: 894351&lt;br/&gt;
Committed Lucene 2.9 revision: 894352&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12429010" name="LUCENE-2182.patch" size="954" author="thetaphi" created="Mon, 28 Dec 2009 09:59:12 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 28 Dec 2009 10:36:52 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11604</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25543</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>