<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:21:18 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2972/LUCENE-2972.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2972] Intermittent failure in TestFieldCacheTermsFilter.testMissingTerms</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2972</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Running tests in while(1) I hit this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
NOTE: reproduce with: ant test -Dtestcase=TestFieldCacheTermsFilter -Dtestmethod=testMissingTerms -Dtests.seed=-1046382732738729184:5855929314778232889

1) testMissingTerms(org.apache.lucene.search.TestFieldCacheTermsFilter)
java.lang.AssertionError: Must match 1 expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
	at org.junit.Assert.fail(Assert.java:91)
	at org.junit.Assert.failNotEquals(Assert.java:645)
	at org.junit.Assert.assertEquals(Assert.java:126)
	at org.junit.Assert.assertEquals(Assert.java:470)
	at org.apache.lucene.search.TestFieldCacheTermsFilter.testMissingTerms(TestFieldCacheTermsFilter.java:63)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1214)
	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1146)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:24)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:136)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:117)
	at org.junit.runner.JUnitCore.runMain(JUnitCore.java:98)
	at org.junit.runner.JUnitCore.runMainAndExit(JUnitCore.java:53)
	at org.junit.runner.JUnitCore.main(JUnitCore.java:45)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately the seed doesn&apos;t &lt;span class=&quot;error&quot;&gt;&amp;#91;consistently&amp;#93;&lt;/span&gt; repro for me...&lt;/p&gt;</description>
                <environment></environment>
            <key id="12501731">LUCENE-2972</key>
            <summary>Intermittent failure in TestFieldCacheTermsFilter.testMissingTerms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2011 20:36:03 +0000</created>
                <updated>Fri, 3 Jun 2011 17:37:16 +0100</updated>
                    <resolved>Tue, 24 May 2011 18:32:54 +0100</resolved>
                                            <fixVersion>3.2</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13037069" author="simonw" created="Fri, 20 May 2011 21:37:18 +0100"  >&lt;p&gt;mike this does not reproduce for me.. can you still trigger this one?&lt;/p&gt;</comment>
                    <comment id="13037569" author="mikemccand" created="Sun, 22 May 2011 11:59:52 +0100"  >&lt;p&gt;I can&apos;t repro it either... and the while(1) tester (w/ no seed) also cannot so far...&lt;/p&gt;</comment>
                    <comment id="13037570" author="simonw" created="Sun, 22 May 2011 12:03:23 +0100"  >&lt;p&gt;I think we should close - can&apos;t reproduce - we can still reopen...&lt;/p&gt;</comment>
                    <comment id="13037581" author="mikemccand" created="Sun, 22 May 2011 12:51:32 +0100"  >&lt;p&gt;Woops, the while(true) tester just hit it... took 136 iterations @ -Dtests.iter=100.  It got this seed:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;NOTE: reproduce with: ant test -Dtestcase=TestFieldCacheTermsFilter -Dtestmethod=testMissingTerms -Dtests.seed=3673074264729476620:7782176163702481120
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But, that does not repro for me...&lt;/p&gt;</comment>
                    <comment id="13037583" author="rcmuir" created="Sun, 22 May 2011 12:54:30 +0100"  >&lt;p&gt;would really like to know if the one that failed is using an ExecutorService.&lt;/p&gt;

&lt;p&gt;Remember in that case we are trading reproducability for more coverage at the moment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13037592" author="mikemccand" created="Sun, 22 May 2011 13:35:55 +0100"  >&lt;p&gt;Yes, we are... lesser evil I think, but still does not make one happy when that lesser evil attacks you!&lt;/p&gt;

&lt;p&gt;I&apos;ll re-run w/ verbose... could cause but not to happen though.&lt;/p&gt;</comment>
                    <comment id="13037600" author="mikemccand" created="Sun, 22 May 2011 14:34:51 +0100"  >&lt;p&gt;The test still fails if I force LTC to never use an ES in newSearcher...&lt;/p&gt;</comment>
                    <comment id="13037629" author="mikemccand" created="Sun, 22 May 2011 18:08:31 +0100"  >&lt;p&gt;I just committed the fix:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/java/org/apache/lucene/search/FieldCacheTermsFilter.java
===================================================================
--- src/java/org/apache/lucene/search/FieldCacheTermsFilter.java	(revision 1125975)
+++ src/java/org/apache/lucene/search/FieldCacheTermsFilter.java	(working copy)
@@ -127,7 +127,7 @@
 
     public FieldCacheTermsFilterDocIdSet(FieldCache.DocTermsIndex fcsi) {
       this.fcsi = fcsi;
-      openBitSet = new OpenBitSet(this.fcsi.size());
+      openBitSet = new OpenBitSet(this.fcsi.numOrd());
       final BytesRef spare = new BytesRef();
       for (int i=0;i&amp;lt;terms.length;i++) {
         int termNumber = this.fcsi.binarySearchLookup(terms[i], spare);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;We were using number-of-docs instead of number-of-ords to allocate the&lt;br/&gt;
OBS.  This only causes a problem if 1) every doc has a unique term&lt;br/&gt;
(thus number-of-ords is 1 + number-of-docs since 0 is reserved to mean&lt;br/&gt;
unset), and 2) the number of docs is 0 mod 64, because this would then&lt;br/&gt;
cause an AIOOBE coming out of the OBS (not the fcsi.getOrd!), which&lt;br/&gt;
the disi impl interprets as no-more-docs.  Phew!&lt;/p&gt;

&lt;p&gt;I think likely we couldn&apos;t repro because ConccurrentMergeScheduler was&lt;br/&gt;
involved... this was able to repro for me:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test-core -Dtestcase=TestFieldCacheTermsFilter -Dtestmethod=testMissingTerms -Dtests.seed=-7172644887386150665:-4028247385708880228a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It uses SMS.&lt;/p&gt;

&lt;p&gt;I&apos;d like to add assertions to OBS to better catch bugs like this in&lt;br/&gt;
the future... I&apos;ll work up a patch.&lt;/p&gt;</comment>
                    <comment id="13037630" author="mikemccand" created="Sun, 22 May 2011 18:10:38 +0100"  >&lt;p&gt;Note that 3.x doesn&apos;t have the bug; it was already correctly using numOrd...&lt;/p&gt;</comment>
                    <comment id="13037657" author="mikemccand" created="Sun, 22 May 2011 21:18:20 +0100"  >&lt;p&gt;Patch, tracking numBits and adding asserts on all methods where the &quot;index&quot; param is supposed to be within bounds.&lt;/p&gt;

&lt;p&gt;With this patch and without the core fix I committed the test case quickly fails (trips the new asserts...).&lt;/p&gt;</comment>
                    <comment id="13038722" author="yseeley@gmail.com" created="Tue, 24 May 2011 19:59:36 +0100"  >&lt;p&gt;To avoid slowing anything down, can we also maintain numBits in an assert?&lt;br/&gt;
Perhaps something like&lt;br/&gt;
assert (numBits = Math.max(other.numBits, numBits)) &amp;gt; 0;&lt;/p&gt;</comment>
                    <comment id="13038755" author="mikemccand" created="Tue, 24 May 2011 20:58:42 +0100"  >&lt;p&gt;Good idea Yonik, I&apos;ll do that...&lt;/p&gt;</comment>
                    <comment id="13043503" author="rcmuir" created="Fri, 3 Jun 2011 17:37:16 +0100"  >&lt;p&gt;Bulk closing for 3.2&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12480055" name="LUCENE-2972.patch" size="5364" author="mikemccand" created="Sun, 22 May 2011 21:18:19 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 20 May 2011 20:37:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10906</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24720</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>