<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:00:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-430/LUCENE-430.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-430] Reducing buffer sizes for TermDocs.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-430</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;From java-dev: &lt;/p&gt;

&lt;p&gt;On Friday 09 September 2005 00:34, Doug Cutting wrote: &lt;br/&gt;
&amp;gt; Paul Elschot wrote: &lt;br/&gt;
&amp;gt; &amp;gt; I suppose one of these cases are when many terms are used in a query.  &lt;br/&gt;
&amp;gt; &amp;gt; Would it be easily possible to make the buffer size for a term iterator &lt;br/&gt;
&amp;gt; &amp;gt; depend on the numbers of documents to be iterated? &lt;br/&gt;
&amp;gt; &amp;gt; Many terms only occur in a few documents, so this could be a  &lt;br/&gt;
&amp;gt; &amp;gt; nice win on total buffer size for the many terms case. &lt;br/&gt;
&amp;gt;  &lt;br/&gt;
&amp;gt; This would not be too difficult. &lt;br/&gt;
&amp;gt;  &lt;br/&gt;
&amp;gt; Look in SegmentTermDocs.java. &#160;The buffer may be allocated when the  &lt;br/&gt;
&amp;gt; parent&apos;s stream is first cloned, but clone() won&apos;t allocate a buffer if  &lt;br/&gt;
&amp;gt; the source hasn&apos;t had a buffer allocated yet, and nothing should perform  &lt;br/&gt;
&amp;gt; i/o directly on the parent&apos;s freqStream, so in practice a buffer should  &lt;br/&gt;
&amp;gt; not be allocated until the first read is performed on the clone. &lt;/p&gt;

&lt;p&gt;I tried delaying the buffer allocation in BufferedIndexInput by &lt;br/&gt;
using this clone() method: &lt;/p&gt;

&lt;p&gt;&#160; public Object clone() &lt;/p&gt;
{ 
&#160; &#160; BufferedIndexInput clone = (BufferedIndexInput)super.clone(); 
&#160; &#160; clone.buffer = null; 
&#160; &#160; clone.bufferLength = 0; 
&#160; &#160; clone.bufferPosition = 0; 
&#160; &#160; clone.bufferStart = getFilePointer();  
&#160; &#160; return clone; 
&#160; }
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;With this all term document iterators seem to be empty, no &lt;br/&gt;
query in the test cases gives any results, for example TestDemo &lt;br/&gt;
and TestBoolean2. &lt;br/&gt;
As far as I can see, this delaying should work, but it doesn&apos;t and &lt;br/&gt;
I have no idea why. &lt;/p&gt;

&lt;p&gt;End of quote from java-dev. &lt;/p&gt;

&lt;p&gt;Doug replied that at a glance this clone method looks good. &lt;br/&gt;
Without this delayed buffer allocation, a reduced buffer size &lt;br/&gt;
for TermDocs cannot be implemented easily.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
            <key id="12315271">LUCENE-430</key>
            <summary>Reducing buffer sizes for TermDocs.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="paul.elschot@xs4all.nl">Paul Elschot</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Sep 2005 04:39:17 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:21 +0100</updated>
                    <resolved>Wed, 26 Jan 2011 13:59:51 +0000</resolved>
                                                            <component>core/store</component>
                        <due></due>
                    <votes>2</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12498447" author="michaelbusch" created="Thu, 24 May 2007 02:16:39 +0100"  >&lt;p&gt;I&apos;m attaching a patch that is slightly different from the patch Paul submitted. In refill() it calls seekInternal(bufferStart) in case the buffer is null. The reason is that after a clone the value of bufferStart might be different from the actual file pointer. This causes some test cases to fail with the original patch because refill() reads the data to buffer from the wrong position.&lt;/p&gt;

&lt;p&gt;With this version all test cases pass.&lt;/p&gt;</comment>
                    <comment id="12498523" author="paul.elschot@xs4all.nl" created="Thu, 24 May 2007 08:32:30 +0100"  >&lt;p&gt;Are you also going to try and make the buffer size dependent on the number of docs that contain the term?&lt;/p&gt;

&lt;p&gt;The current patch still uses BUFFERSIZE only.&lt;/p&gt;</comment>
                    <comment id="12498659" author="michaelbusch" created="Thu, 24 May 2007 15:31:47 +0100"  >&lt;p&gt;Paul,&lt;/p&gt;

&lt;p&gt;you are right, the patch I submitted just avoids copying the buffer. I was thinking about adding a method setBufferSize() to BufferedIndexInput. Please see my comment about this in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-888&quot; title=&quot;Improve indexing performance by increasing internal buffer sizes&quot;&gt;&lt;del&gt;LUCENE-888&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="12498792" author="michaelbusch" created="Thu, 24 May 2007 20:43:44 +0100"  >&lt;p&gt;OK, I committed this patch that delays the allocation of the buffer after a clone. I&apos;ll leave this issue open. After &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-888&quot; title=&quot;Improve indexing performance by increasing internal buffer sizes&quot;&gt;&lt;del&gt;LUCENE-888&lt;/del&gt;&lt;/a&gt; is committed I will attach a patch here that adjusts the buffer size of the freq stream in SegmentTermDocs according to the document frequency.&lt;/p&gt;</comment>
                    <comment id="12599500" author="michaelbusch" created="Fri, 23 May 2008 21:41:41 +0100"  >&lt;p&gt;Paul, have you experimented with changing the buffer sizes and how it affects search&lt;br/&gt;
performance? &lt;/p&gt;</comment>
                    <comment id="12599516" author="paul.elschot@xs4all.nl" created="Fri, 23 May 2008 22:48:12 +0100"  >&lt;p&gt;I wish I could have done that, sorry. I left this one after I failed to change to buffer size and reported it. Time flies, fortunately.&lt;/p&gt;</comment>
                    <comment id="12599535" author="michaelbusch" created="Sat, 24 May 2008 00:02:35 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I left this one after I failed to change to buffer size and reported it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This change was committed a while ago, so if you have some time maybe&lt;br/&gt;
you could run some performance experiments? I somehow doubt that this&lt;br/&gt;
will improve performance significantly, but maybe I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;I&apos;m going to unassign this for now, because I probably won&apos;t have time to&lt;br/&gt;
run the performance experiments anytime soon. Maybe after I finished &lt;br/&gt;
working on the other issues assigned to me I&apos;ll get back to this one.&lt;/p&gt;</comment>
                    <comment id="12987009" author="shaie" created="Wed, 26 Jan 2011 13:59:51 +0000"  >&lt;p&gt;Michael B. committed the patch long time ago and the issue remained open for benchmark results. I doubt if they&apos;d matter now.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12358050" name="lucene-430.patch" size="1041" author="michaelbusch" created="Thu, 24 May 2007 02:16:39 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>36622</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 24 May 2007 01:16:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13319</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27301</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>