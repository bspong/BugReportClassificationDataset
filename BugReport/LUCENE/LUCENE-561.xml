<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:29 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-561/LUCENE-561.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-561] ParallelReader fails on deletes and on seeks of previously unused fields</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-561</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In using ParallelReader I&apos;ve hit two bugs:&lt;/p&gt;

&lt;p&gt;1.  ParallelReader.doDelete() and doUndeleteAll() call doDelete() and doUndeleteAll() on the subreaders, but these methods do not set hasChanges.  Thus the changes are lost when the readers are closed.  The fix is to call deleteDocument() and undeleteAll() on the subreaders instead.&lt;/p&gt;

&lt;p&gt;2.  ParallelReader discovers the fields in each subindex by using IndexReader.getFieldNames() which only finds fields that have occurred on at least one document.  In general a parallel index is designed with assignments of fields to sub-indexes and term seeks (including searches) may be done on any of those fields, even if no documents in a particular state of the index have yet had an assigned field.  Seeks/searches on fields that have not yet been indexed generated an NPE in ParallelReader&apos;s various inner class seek() and next() methods because fieldToReader.get() returns null on the unseen field.  The fix is to extend the add() methods to supply the correct list of fields for each subindex.&lt;/p&gt;

&lt;p&gt;Patch that corrects both of these issues attached.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
            <key id="12332976">LUCENE-561</key>
            <summary>ParallelReader fails on deletes and on seeks of previously unused fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="manawiz">Chuck Williams</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 May 2006 06:08:34 +0100</created>
                <updated>Tue, 20 Jun 2006 02:11:54 +0100</updated>
                    <resolved>Sat, 20 May 2006 00:40:52 +0100</resolved>
                            <version>2.0.0</version>
                                <fixVersion>2.0.0</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12377339" author="manawiz" created="Tue, 2 May 2006 15:10:44 +0100"  >&lt;p&gt;This new version of the patch provides a more general solution for the unknown field NPE problem (the solution for the delete problem is the same and is included in the new patch file).&lt;/p&gt;

&lt;p&gt;For the NPE problem, the new patch handles the case of an unknown field explicitly in all ParallelReader API&apos;s for which it is relevant.  This is quite a few of them, but I think I got them all.&lt;/p&gt;

&lt;p&gt;The first solution of specifying the field list for each reader was expedient in my applicaiton since all fields are pre-configured and validated on index operations.  However, for Lucene in general such field processing is not required.  E.g., with ParallelReader as it is in Lucene now and with the first version of the patch, a user-entered misspelled field name passed in a Query to search() generates an NPE instead of zero results.  With the new version of the patch, zero resutls are returned properly.&lt;/p&gt;</comment>
                    <comment id="12412459" author="yseeley@gmail.com" created="Fri, 19 May 2006 08:40:00 +0100"  >&lt;p&gt;Chuck, I took a very quick scan, most of it looks fine.&lt;br/&gt;
What about seek() calls though... if the reader is null, shouldn&apos;t termDocs be set to null?&lt;/p&gt;

&lt;p&gt;     public void seek(Term term) throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;termDocs = ((IndexReader)fieldToReader.get(term.field())).termDocs(term);&lt;br/&gt;
+      IndexReader reader = ((IndexReader)fieldToReader.get(term.field()));&lt;br/&gt;
+      termDocs = reader!=null ? reader.termDocs(term) : null;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12412460" author="manawiz" created="Fri, 19 May 2006 08:58:49 +0100"  >&lt;p&gt;Yonik, thanks for looking at this, and good catch!  If there are multiple seeks on the termDocs, one is performed on a known field and not iterated to exahaustion, and then a seek is performed on an unknown field, then without your fix I believe the unknown field would erroneously report remaining documents on the prior known field.&lt;/p&gt;

&lt;p&gt;It appears nothing I&apos;ve done hit this pariticular case!  Sorry I missed it...&lt;/p&gt;</comment>
                    <comment id="12412532" author="yseeley@gmail.com" created="Fri, 19 May 2006 23:58:06 +0100"  >&lt;p&gt;This patch also fixes another little bug... the previous behavior bypassed synchronization of deleteDocument in subreaders.&lt;/p&gt;</comment>
                    <comment id="12412535" author="yseeley@gmail.com" created="Sat, 20 May 2006 00:40:52 +0100"  >&lt;p&gt;Patch applied,  thanks Chuck!&lt;/p&gt;</comment>
                    <comment id="12416738" author="kohlschuetter" created="Mon, 19 Jun 2006 18:37:56 +0100"  >&lt;p&gt;Chuck: Unfortunately, the NPE in seek/next can still be triggered.&lt;br/&gt;
See &lt;a href=&quot;#LUCENE-398&quot;&gt;LUCENE-398&lt;/a&gt; for Testcase and a suggested patch.&lt;/p&gt;</comment>
                    <comment id="12416790" author="manawiz" created="Tue, 20 Jun 2006 02:11:54 +0100"  >&lt;p&gt;Christian,&lt;/p&gt;

&lt;p&gt;That is a different bug than this one.  This bug has been fixed.&lt;/p&gt;

&lt;p&gt;Chuck&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12326133" name="ParallelReaderBugs.patch" size="5770" author="manawiz" created="Tue, 2 May 2006 15:10:44 +0100" />
                    <attachment id="12326114" name="ParallelReaderBugs.patch" size="2956" author="manawiz" created="Tue, 2 May 2006 06:09:49 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 19 May 2006 07:40:00 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13189</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27166</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>