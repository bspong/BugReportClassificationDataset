<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:00:55 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-651/LUCENE-651.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-651] Poor performance race condition in FieldCacheImpl</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-651</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;A race condition exists in FieldCacheImpl that causes a significant performance degradation if multiple threads concurrently request a value that is not yet cached. The degradation is particularly noticable in large indexes and when there a many concurent requests for the cached value.&lt;/p&gt;

&lt;p&gt;For the full discussion see the mailing list thread &apos;Poor performance &quot;race condition&quot; in FieldSortedHitQueue&apos; (&lt;a href=&quot;http://www.gossamer-threads.com/lists/lucene/java-user/38717&quot; class=&quot;external-link&quot;&gt;http://www.gossamer-threads.com/lists/lucene/java-user/38717&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
            <key id="12347875">LUCENE-651</key>
            <summary>Poor performance race condition in FieldCacheImpl</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="otis">Otis Gospodnetic</assignee>
                                <reporter username="ohutchison">Oliver Hutchison</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Aug 2006 02:30:44 +0100</created>
                <updated>Wed, 20 Dec 2006 03:56:33 +0000</updated>
                    <resolved>Mon, 20 Nov 2006 07:11:30 +0000</resolved>
                            <version>2.0.0</version>
                                                <component>core/search</component>
                        <due></due>
                    <votes>1</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12427789" author="ohutchison" created="Mon, 14 Aug 2006 02:36:15 +0100"  >&lt;p&gt;The attached patch resolves this issue by forcing multiple concurrent requests to block and wait for a single thread to do the cached value generation.&lt;/p&gt;</comment>
                    <comment id="12448882" author="otis" created="Fri, 10 Nov 2006 22:43:09 +0000"  >&lt;p&gt;FieldCache bit us in the ass recently, so I&apos;m looking at other FieldCache issues.&lt;br/&gt;
This one looks good to me&lt;br/&gt;
(discussion that led to the patch is at &lt;a href=&quot;http://www.gossamer-threads.com/lists/lucene/java-user/38717&quot; class=&quot;external-link&quot;&gt;http://www.gossamer-threads.com/lists/lucene/java-user/38717&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;Question about this snippet:&lt;br/&gt;
+        synchronized (value) {&lt;br/&gt;
+          CreationPlaceholder progress = (CreationPlaceholder) value;&lt;br/&gt;
+          if (progress.value == null) {&lt;br/&gt;
+            progress.value = createValue(reader, key);&lt;br/&gt;
+            synchronized (readerCache) &lt;/p&gt;
{
+              innerCache.put(key, progress.value);
+            }
&lt;p&gt;+          }&lt;/p&gt;

&lt;p&gt;Is that synchronization on value really needed here?  Wouldn&apos;t synchronizing on readerCache be sufficient here?  Something like:&lt;/p&gt;

&lt;p&gt;+        synchronized (readerCache) {&lt;br/&gt;
+          CreationPlaceholder progress = (CreationPlaceholder) value;&lt;br/&gt;
+          if (progress.value == null) &lt;/p&gt;
{
+            progress.value = createValue(reader, key);
+             innerCache.put(key, progress.value);
+          }

&lt;p&gt;Or would that be too coarse?  Maybe, I see createValue does a fair bit of work.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                    <comment id="12449037" author="yseeley@gmail.com" created="Sat, 11 Nov 2006 21:49:31 +0000"  >&lt;p&gt;&amp;gt; Wouldn&apos;t synchronizing on readerCache be sufficient here?&lt;/p&gt;

&lt;p&gt;That would be deadly, esp to something like Solr.  It would kill any ability to warm in the background as &lt;b&gt;any&lt;/b&gt; index reader filling an entry would block all other readers from using the cache.&lt;/p&gt;</comment>
                    <comment id="12449085" author="otis" created="Sun, 12 Nov 2006 04:33:40 +0000"  >&lt;p&gt;Ah, yes, you mentioned that in that email thread, too.  Ignore my comment.&lt;/p&gt;</comment>
                    <comment id="12451237" author="otis" created="Mon, 20 Nov 2006 07:11:30 +0000"  >&lt;p&gt;Committed, thanks Oliver!&lt;/p&gt;</comment>
                    <comment id="12459816" author="otis" created="Wed, 20 Dec 2006 03:56:33 +0000"  >&lt;p&gt;For the record, this patch had a small mistake in it, causing memory leakage.  The fix is in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-754&quot; title=&quot;FieldCache keeps hard references to readers, doesn&amp;#39;t prevent multiple threads from creating same instance&quot;&gt;&lt;del&gt;LUCENE-754&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12338769" name="LUCENE-651.patch" size="14812" author="ohutchison" created="Mon, 14 Aug 2006 02:36:15 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 10 Nov 2006 22:43:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13101</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27079</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>