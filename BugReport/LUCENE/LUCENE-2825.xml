<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:32:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2825/LUCENE-2825.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2825] FSDirectory.open should return MMap on 64-bit Solaris</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2825</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;MMap is ~ 30% faster than NIOFS on this platform.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12493669">LUCENE-2825</key>
            <summary>FSDirectory.open should return MMap on 64-bit Solaris</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Dec 2010 11:58:11 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:27 +0100</updated>
                    <resolved>Sun, 26 Dec 2010 22:59:24 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/store</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12973176" author="rcmuir" created="Mon, 20 Dec 2010 12:00:37 +0000"  >&lt;p&gt;Here&apos;s the patch, and luceneutil 10M doc results:&lt;/p&gt;

&lt;p&gt;(solaris 9, ultra60 2GB ram, 1.6u23 jre with -d64)&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Query&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;QPS trunk&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;QPS patch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Pct diff&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;spanFirst(unit, 5)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.68&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.71&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;3.7%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;unit, state&amp;#93;&lt;/span&gt;, 10, true)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.14&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.15&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;7.3%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&quot;unit state&quot;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.34&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;9.1%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;unit state&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.45&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;21.7%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;unit*&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.12&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.40&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;25.4%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;uni*&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.61&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.79&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;30.2%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+unit +state&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.52&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.69&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;33.1%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;unit~1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.28&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.38&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;34.9%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;unit~2.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.27&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;36.2%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;state&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.52&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;38.0%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;united~1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.42&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.60&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;42.7%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;united~2.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.15&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;46.8%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;un*d&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.97&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.09&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;56.5%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;u*d&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.52&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.85&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;61.3%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+nebraska +state&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.51&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.73&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;font color=&quot;green&quot;&gt;91.6%&lt;/font&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12973181" author="thetaphi" created="Mon, 20 Dec 2010 12:43:07 +0000"  >&lt;p&gt;Is it slower on Linux-64 because you only enable for windows-64 and solaris-64?&lt;/p&gt;

&lt;p&gt;In general I expected that it is faster on all all 64 bit systems.&lt;/p&gt;</comment>
                    <comment id="12973183" author="rcmuir" created="Mon, 20 Dec 2010 12:47:32 +0000"  >&lt;p&gt;In the case of Linux-64 and Mac OS X, Mike was testing these, but it looked&lt;br/&gt;
like some queries were actually faster with NIOFS on these platforms.&lt;/p&gt;

&lt;p&gt;(This makes no sense to me, but i figured we could set it for Solaris where its obviously faster always)&lt;/p&gt;</comment>
                    <comment id="12973210" author="jasonrutherglen" created="Mon, 20 Dec 2010 14:28:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;some queries were actually faster with NIOFS on these platforms&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that&apos;s to be expected.  MMap should be faster than NIOFS in all cases, if it&apos;s not then the JVM could be to blame (on 64-bit).  There&apos;s notes at: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-753&quot; title=&quot;Use NIO positional read to avoid synchronization in FSIndexInput&quot;&gt;&lt;del&gt;LUCENE-753&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Doesn&apos;t MMap automatically consume a lot more memory?&lt;/p&gt;</comment>
                    <comment id="12973212" author="rcmuir" created="Mon, 20 Dec 2010 14:34:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Doesn&apos;t MMap automatically consume a lot more memory?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.&lt;/p&gt;</comment>
                    <comment id="12973213" author="thetaphi" created="Mon, 20 Dec 2010 14:35:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Doesn&apos;t MMap automatically consume a lot more memory?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, it consumes &lt;b&gt;address space&lt;/b&gt;, this is why it only works without problems on 64 bit. The index files are mapped into address space, so handled like a SWAP file, that&apos;s the trick. They only consume as much memory from cache space as the operating system decides. Especially it does not consume memory from java heap!&lt;/p&gt;</comment>
                    <comment id="12973260" author="yseeley@gmail.com" created="Mon, 20 Dec 2010 17:14:15 +0000"  >&lt;p&gt;There could be a number of things that could make this very OS dependent:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;kernel read-ahead can differ between mmap and traditional IO, and differ between operating systems&lt;br/&gt;
   (think about reading 10 bytes from position 4094... if mmap doesn&apos;t read-ahead at least one page then you will suffer a double page fault).&lt;/li&gt;
	&lt;li&gt;CPU cache / TLB effects?  Using more address space isn&apos;t completely free.&lt;/li&gt;
	&lt;li&gt;Java mmap overhead - you don&apos;t get access to a raw byte[]&lt;/li&gt;
	&lt;li&gt;userspace-kernel transition times (i.e. for a read system call) differ between operating systems.  Linux is very good here, probably leading to less of a penalty for read vs mmap.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12973264" author="rcmuir" created="Mon, 20 Dec 2010 17:29:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;There could be a number of things that could make this very OS dependent:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, we should test any OS before changing any defaults.&lt;/p&gt;

&lt;p&gt;In the Solaris case its clear that mmap is better for our purposes though (as to exactly why, no idea)&lt;/p&gt;</comment>
                    <comment id="12975180" author="rcmuir" created="Sun, 26 Dec 2010 22:53:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;CPU cache / TLB effects? Using more address space isn&apos;t completely free.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the case of Solaris I think there is much less of a chance of TLB effects? &lt;br/&gt;
For example on Solaris java automatically uses large pages (unlike Linux, Windows etc).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/tech/largememory-jsp-137182.html&quot; class=&quot;external-link&quot;&gt;http://www.oracle.com/technetwork/java/javase/tech/largememory-jsp-137182.html&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12975181" author="rcmuir" created="Sun, 26 Dec 2010 22:59:24 +0000"  >&lt;p&gt;Committed revision 1052980, 1052981 (3x)&lt;/p&gt;</comment>
                    <comment id="12975212" author="earwin" created="Mon, 27 Dec 2010 07:45:31 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;CPU cache / TLB effects? Using more address space isn&apos;t completely free.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the case of Solaris I think there is much less of a chance of TLB effects?&lt;br/&gt;
For example on Solaris java automatically uses large pages (unlike Linux, Windows etc).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For, like, 13Gb of memory-mapped index, I&apos;ve seen no noticeable difference between having large pages on and off under Linux. That&apos;s some anecdotal evidence, as I&apos;ven&apos;t done any extensive research, but still.&lt;/p&gt;</comment>
                    <comment id="13013488" author="gsingers" created="Wed, 30 Mar 2011 16:50:27 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12466624" name="LUCENE-2825.patch" size="2086" author="rcmuir" created="Mon, 20 Dec 2010 12:00:37 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 20 Dec 2010 12:43:07 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11035</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24867</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>