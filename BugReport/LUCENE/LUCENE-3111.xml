<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:29:11 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3111/LUCENE-3111.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3111] TestFSTs.testRandomWords failure</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3111</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Was running some while(1) tests on the docvalues branch (r1103705) and the following test failed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] Testsuite: org.apache.lucene.util.automaton.fst.TestFSTs
    [junit] Testcase: testRandomWords(org.apache.lucene.util.automaton.fst.TestFSTs):	FAILED
    [junit] expected:&amp;lt;771&amp;gt; but was:&amp;lt;TwoLongs:771,771&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;771&amp;gt; but was:&amp;lt;TwoLongs:771,771&amp;gt;
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs$FSTTester.verifyUnPruned(TestFSTs.java:540)
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs$FSTTester.doTest(TestFSTs.java:496)
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs$FSTTester.doTest(TestFSTs.java:359)
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs.doTest(TestFSTs.java:319)
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs.testRandomWords(TestFSTs.java:940)
    [junit] 	at org.apache.lucene.util.automaton.fst.TestFSTs.testRandomWords(TestFSTs.java:915)
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1282)
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1211)
    [junit] 
    [junit] 
    [junit] Tests run: 7, Failures: 1, Errors: 0, Time elapsed: 7.628 sec
    [junit] 
    [junit] ------------- Standard Error -----------------
    [junit] NOTE: Ignoring nightly-only test method &apos;testBigSet&apos;
    [junit] NOTE: reproduce with: ant test -Dtestcase=TestFSTs -Dtestmethod=testRandomWords -Dtests.seed=-269475578956012681:0
    [junit] NOTE: test params are: codec=PreFlex, locale=ar, timezone=America/Blanc-Sablon
    [junit] NOTE: all tests run in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; JVM:
    [junit] [TestToken, TestCodecs, TestIndexReaderReopen, TestIndexWriterMerging, TestNoDeletionPolicy, TestParallelReaderEmptyIndex, TestParallelTermEnum, TestPerSegmentDeletes, TestSegmentReader, TestSegmentTermDocs, TestStressAdvance, TestTermVectorsReader, TestSurrogates, TestMultiFieldQueryParser, TestAutomatonQuery, TestBooleanScorer, TestFuzzyQuery, TestMultiTermConstantScore, TestNumericRangeQuery64, TestPositiveScoresOnlyCollector, TestPrefixFilter, TestQueryTermVector, TestScorerPerf, TestSloppyPhraseQuery, TestSpansAdvanced, TestWindowsMMap, TestRamUsageEstimator, TestSmallFloat, TestUnicodeUtil, TestFSTs]
    [junit] NOTE: Linux 2.6.37-gentoo amd64/Sun Microsystems Inc. 1.6.0_25 (64-bit)/cpus=8,threads=1,free=137329960,total=208207872
    [junit] ------------- ---------------- ---------------
    [junit] TEST org.apache.lucene.util.automaton.fst.TestFSTs FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not able to reproduce&lt;/p&gt;</description>
                <environment></environment>
            <key id="12507460">LUCENE-3111</key>
            <summary>TestFSTs.testRandomWords failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="selckin">selckin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2011 09:53:06 +0100</created>
                <updated>Fri, 10 May 2013 11:44:50 +0100</updated>
                    <resolved>Tue, 17 May 2011 19:37:08 +0100</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="13034868" author="mikemccand" created="Tue, 17 May 2011 17:38:42 +0100"  >&lt;p&gt;I&apos;m also not able to reproduce...&lt;/p&gt;</comment>
                    <comment id="13034876" author="rcmuir" created="Tue, 17 May 2011 17:50:31 +0100"  >&lt;p&gt;This sounds like a bug in either the test or test-infra.&lt;/p&gt;

&lt;p&gt;I&apos;m not able to reproduce but if I run this test with -Dtests.iter=100, i&apos;m able to produce a similar failure (again not reproducible).&lt;/p&gt;

&lt;p&gt;So first I&apos;d like to see if we can find the &quot;reproducibility bug&quot;. This is the most important to me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13034880" author="rcmuir" created="Tue, 17 May 2011 17:54:33 +0100"  >&lt;p&gt;ok, the problem is the test overrides setup() but doesnt call super.setup(), and it does the same with tearDown()&lt;/p&gt;

&lt;p&gt;Currently the way LuceneTestCase checks this is very &quot;crude&quot;, in other words if you make this mistake with one, or the other, but not both, it will catch it!&lt;/p&gt;

&lt;p&gt;The only workaround i know of to find test bugs like this is to install findbugs. it has a specific check for this exact test bug! we could run it on all of our tests.&lt;/p&gt;</comment>
                    <comment id="13034895" author="mikemccand" created="Tue, 17 May 2011 18:14:06 +0100"  >&lt;p&gt;Doh!&lt;/p&gt;

&lt;p&gt;+1 for findbugs.&lt;/p&gt;</comment>
                    <comment id="13034899" author="mikemccand" created="Tue, 17 May 2011 18:18:54 +0100"  >&lt;p&gt;OK this reproduces the bug, once you add the missing calls to super.setUp/tearDown:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test -Dtestcase=TestFSTs -Dtestmethod=testRandomWords -Dtests.seed=6166279653770643480:6589011488658196383
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13034900" author="rcmuir" created="Tue, 17 May 2011 18:22:12 +0100"  >&lt;p&gt;I have an idea how i think i can make LuceneTestCase fail if a test does this... i&apos;ll see if i can improve the setup/tearDown checking this way so we don&apos;t have this issue again.&lt;/p&gt;</comment>
                    <comment id="13034949" author="rcmuir" created="Tue, 17 May 2011 19:33:22 +0100"  >&lt;p&gt;See revision 1104452, 5 tests had this problem... I think LuceneTestCase can catch it always now.&lt;/p&gt;</comment>
                    <comment id="13034950" author="mikemccand" created="Tue, 17 May 2011 19:35:46 +0100"  >&lt;p&gt;OK I found this &amp;#8211; if you try to add the same output, twice, for the empty string, then the builder fails to realize this is a TwoInts and makes a single int output!&lt;/p&gt;

&lt;p&gt;Thank you random testing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll commit shortly...&lt;/p&gt;</comment>
                    <comment id="13038160" author="simpatico" created="Mon, 23 May 2011 20:36:44 +0100"  >&lt;p&gt;@rmuir: Why was this committed to the 3_X branch, and not only to the trunk, as r 1104527?&lt;/p&gt;

&lt;p&gt;Also, sorry for my ignorance, but why is it needed? Isn&apos;t there an &apos;inheritance/abstract/template method pattern&apos; way to achive the same?  &lt;br/&gt;
All I know is that it now breaks my Solr tests&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2537?focusedCommentId=13038085&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13038085&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/browse/SOLR-2537?focusedCommentId=13038085&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13038085&lt;/a&gt;&lt;br/&gt;
Steps to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
svn co -r 1126620 http:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf/lucene/dev/branches/branch_3x/
&lt;/span&gt;cd branch_3x; ant get-maven-poms; mvn -N -Pbootstrap install; mvn -DskipTests install
wget http:&lt;span class=&quot;code-comment&quot;&gt;//dp4j.sf.net/debug/embeddedServerTest.zip
&lt;/span&gt;unzip embeddedServerTest.zip
cd embeddedServerTest; mvn test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13038183" author="rcmuir" created="Mon, 23 May 2011 21:12:42 +0100"  >&lt;blockquote&gt;
&lt;p&gt;@rmuir: Why was this committed to the 3_X branch, and not only to the trunk, as r 1104527?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In general, when it comes to improving tests I try to backport all improvements.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Also, sorry for my ignorance, but why is it needed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Its a bug to override setup()/teardown() and not call super.setup()/super.tearDown(). You can detect this bug with findbugs, but its far better for the tests to just check this.&lt;/p&gt;

&lt;p&gt;Otherwise, the test-framework (LuceneTestCase) won&apos;t work correctly, such as in this case where you don&apos;t have a reproducible random seed.&lt;/p&gt;

&lt;p&gt;I&apos;m sorry if it breaks your tests, you just need to make sure your setup() calls super.setup() and your tearDown() calls super.tearDown()&lt;/p&gt;</comment>
                    <comment id="13038243" author="simpatico" created="Mon, 23 May 2011 22:29:25 +0100"  >&lt;blockquote&gt;&lt;p&gt;you just need to make sure your setup() calls super.setup() and your tearDown() calls super.tearDown()&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {quoute}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;But I am! Follows the code in the zipped project. Also, if I don&apos;t override those methods I shouldn&apos;t get this problem, but I do.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;public class SolrConfigTest extends AbstractSolrTestCase {&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    public String getSolrHome() {&lt;br/&gt;
        final String SOLR_HOME = System.getenv(&quot;SOLR_HOME&quot;);&lt;br/&gt;
        if (SOLR_HOME == null) &lt;/p&gt;
{
            throw new RuntimeException(&quot;Set $SOLR_HOME env var to execute.&quot;);
        }
&lt;p&gt;        return new File(SOLR_HOME).getAbsolutePath();&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    public String getSchemaFile() &lt;/p&gt;
{
        return getSolrHome() + &quot;/conf/schema.xml&quot;;
    }

&lt;p&gt;    public String getSolrConfigFile() &lt;/p&gt;
{
        return getSolrHome() + &quot;/conf/solrconfig.xml&quot;;
    }
&lt;p&gt;    private SolrServer server;&lt;/p&gt;

&lt;p&gt;    @Before&lt;br/&gt;
    @Override&lt;br/&gt;
    public void setUp() throws Exception &lt;/p&gt;
{
        super.setUp();
        new EmbeddedSolrServer(h.getCoreContainer(), h.getCore().getName());
    }

&lt;p&gt;    @Test&lt;br/&gt;
    public void test() &lt;/p&gt;
{
        //just a dummy to have setUp() called
    }
&lt;p&gt;}&lt;/p&gt;
&lt;blockquote&gt;&lt;/blockquote&gt;</comment>
                    <comment id="13038269" author="steve_rowe" created="Mon, 23 May 2011 23:08:12 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;you just need to make sure your setup() calls super.setup() and your tearDown() calls super.tearDown()&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But I am! Follows the code in the zipped project. Also, if I don&apos;t override those methods I shouldn&apos;t get this problem, but I do.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can reproduce - Gabriele&apos;s test class&apos;s setUp() method calls super.setUp(), but when I run the test the error message about needing to call super.setUp() is emitted, and the test fails.  I don&apos;t know how to diagnose this problem, though.&lt;/p&gt;</comment>
                    <comment id="13046522" author="rcmuir" created="Thu, 9 Jun 2011 14:13:14 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I can reproduce - Gabriele&apos;s test class&apos;s setUp() method calls super.setUp(), but when I run the test the error message about needing to call super.setUp() is emitted, and the test fails. I don&apos;t know how to diagnose this problem, though.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You must use junit 4.7 (not 4.8).&lt;br/&gt;
In junit 4.8 TestWatchMan.starting() is fired before the @Befores, but not in 4.7 (This behavior annoyed me in 4.7 by the way).&lt;/p&gt;

&lt;p&gt;I definitely don&apos;t mind opening a new issue to switch to 4.8 as a minimum requirement.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12479488" name="LUCENE-3111.patch" size="2532" author="mikemccand" created="Tue, 17 May 2011 19:35:46 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 17 May 2011 16:38:42 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10818</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24583</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>