<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3452/LUCENE-3452.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3452] The native FS lock used in test-framework&apos;s o.a.l.util.LuceneJUnitResultFormatter prohibits testing on a multi-user system</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3452</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;&lt;tt&gt;LuceneJUnitResultFormatter&lt;/tt&gt; uses a lock to buffer test suites&apos; output, so that when run in parallel, they don&apos;t interrupt each other when they are displayed on the console.&lt;/p&gt;

&lt;p&gt;The current implementation uses a fixed directory (&lt;tt&gt;lucene_junit_lock/&lt;/tt&gt; in &lt;tt&gt;java.io.tmpdir&lt;/tt&gt; (by default &lt;tt&gt;/tmp/&lt;/tt&gt; on Unix/Linux systems) as the location of this lock.  This functionality was introduced on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1835&quot; title=&quot;speed up and improve tests&quot;&gt;SOLR-1835&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As Shawn Heisey reported on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2739&quot; title=&quot;TestSqlEntityProcessorDelta.testNonWritablePersistFile failures on some systems&quot;&gt;&lt;del&gt;SOLR-2739&lt;/del&gt;&lt;/a&gt;, some tests fail when run as root, but succeed when run as a non-root user.  &lt;/p&gt;

&lt;p&gt;On #lucene IRC today, Shawn wrote:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;(2:06:07 PM) elyograg: Now that I know I can&apos;t run the tests as root, I have discovered /tmp/lucene_junit_lock.  Once you run the tests as user A, you cannot run them again as user B until that directory is deleted, and only root or the original user can do so.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
            <key id="12524463">LUCENE-3452</key>
            <summary>The native FS lock used in test-framework&apos;s o.a.l.util.LuceneJUnitResultFormatter prohibits testing on a multi-user system</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2011 20:32:36 +0100</created>
                <updated>Fri, 10 May 2013 11:44:47 +0100</updated>
                    <resolved>Fri, 2 Dec 2011 03:15:44 +0000</resolved>
                            <version>3.4</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.5</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>general/test</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13113697" author="dweiss" created="Fri, 23 Sep 2011 20:50:13 +0100"  >&lt;p&gt;Would a quickfix of prepending or postfixing with the user name work here?&lt;/p&gt;</comment>
                    <comment id="13113700" author="steve_rowe" created="Fri, 23 Sep 2011 20:50:54 +0100"  >&lt;p&gt;From #lucene IRC:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;sarowe: line #69 of lucene/test-framework/o/a/l/util/LuceneJUnitResultFormatter/:
            File lockDir = new File(System.getProperty(&quot;java.io.tmpdir&quot;),
                &quot;lucene_junit_lock&quot;);
  hoss: right ... i saw that ... i suspect it&apos;s for using random factories and stuff
        not clera if the goal is to have a dir that all the parallel JVMs agree on or what
        even if it is: should be able to put it in the build dir ... right?
sarowe: I think so - the only question in my mind is whether it&apos;s used in both lucene and solr
        if so, then &quot;the build dir&quot; is not fixed
  hoss: hmmm... good question
        in which case somethine like: &quot;dir = tmp + user.name + md5(path to common-build.xml)&quot; would be better, and probably solve the same problem
sarowe: I don&apos;t understand the last component
        why md5(c-b.xml path)?
        I mean, why anything at all other than tmp + user.name?
  hoss: think rmuir and his beast box ... multiple copies of lucene checked out into diff dirs where he&apos;s testing diff patches
sarowe: a (maybe simpler) option would be to always use lucene/build/?
        even when running solr tests, I mean
  hoss: sure .. maybe ... can you opne an issue and we&apos;ll figure it out there? 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13113712" author="steve_rowe" created="Fri, 23 Sep 2011 21:02:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;Would a quickfix of prepending or postfixing with the user name work here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Dawid, as Hoss mentioned (quoted above), it would be even better to additionally include (a hash of a filename from) the source directory in which the tests are being run, to handle the case of simultaneous test runs by the same user.&lt;/p&gt;

&lt;p&gt;However, I think an even quick(er)fix would be to just use &lt;tt&gt;lucene/build/&lt;/tt&gt; as the location of the lock, instead of the value of the &lt;tt&gt;${java.io.tmpdir&lt;/tt&gt;} system property.&lt;/p&gt;</comment>
                    <comment id="13113721" author="dweiss" created="Fri, 23 Sep 2011 21:07:55 +0100"  >&lt;p&gt;Yep, I was seconds ahead of your post, so I didn&apos;t see it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13113738" author="rcmuir" created="Fri, 23 Sep 2011 21:20:24 +0100"  >&lt;blockquote&gt;
&lt;p&gt;However, I think an even quick(er)fix would be to just use lucene/build/ as the location of the lock, instead of the value of the $&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {java.io.tmpdir}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; system property.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There was some reason I didn&apos;t do this, but I think it might be obselete.&lt;/p&gt;</comment>
                    <comment id="13113751" author="rcmuir" created="Fri, 23 Sep 2011 21:34:11 +0100"  >&lt;p&gt;maybe someone can test this patch?&lt;/p&gt;</comment>
                    <comment id="13113814" author="steve_rowe" created="Fri, 23 Sep 2011 23:39:25 +0100"  >&lt;blockquote&gt;&lt;p&gt;maybe someone can test this patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I ran Lucene &amp;amp; Solr trunk tests with this patch on a 4-cpu-core Windows 7 box.&lt;/p&gt;

&lt;p&gt;On the first pass, the build hung in the middle of the lucene core tests - I killed the process after half an hour with no output.  I restarted the tests, and the build made it through the Lucene tests, but then at least one Solr core test failed.&lt;/p&gt;

&lt;p&gt;I restarted the Solr tests, and they all succeeded.  But after completing (&quot;BUILD SUCCESSFUL, Total time: ...&quot;), the Ant build hung.  I killed it after half an hour.&lt;/p&gt;

&lt;p&gt;The changes in the patch are so simple, I really doubt that the hangs I experienced had anything to do with them.&lt;/p&gt;


</comment>
                    <comment id="13113932" author="thetaphi" created="Sat, 24 Sep 2011 09:15:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;On the first pass, the build hung in the middle of the lucene core tests - I killed the process after half an hour with no output. I restarted the tests, and the build made it through the Lucene tests, but then at least one Solr core test failed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We had this several times on Jenkins, too. I killed the JVM approx 4 times the last 2 weeks.&lt;/p&gt;</comment>
                    <comment id="13135563" author="steve_rowe" created="Wed, 26 Oct 2011 00:45:05 +0100"  >&lt;p&gt;I just successfully ran all trunk Lucene/Solr tests with this patch, and everything passed.&lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;</comment>
                    <comment id="13157817" author="thetaphi" created="Sun, 27 Nov 2011 12:29:36 +0000"  >&lt;p&gt;Bulk close after release of 3.5&lt;/p&gt;</comment>
                    <comment id="13161351" author="gsingers" created="Fri, 2 Dec 2011 01:39:43 +0000"  >&lt;p&gt;I think I am still seeing this between my local user on my machine and Jenkins on the same machine.  Jenkins checks out clean every time.&lt;/p&gt;

&lt;p&gt;When I run with ant -v I do see the lockdir set to the build dir, but I also see &apos;Override ignored for property &quot;tests.lockdir&quot;&apos;&lt;/p&gt;</comment>
                    <comment id="13161354" author="rcmuir" created="Fri, 2 Dec 2011 01:42:58 +0000"  >&lt;p&gt;Somehow my commit got &apos;lost&apos; e.g. during merging.&lt;/p&gt;</comment>
                    <comment id="13161395" author="rcmuir" created="Fri, 2 Dec 2011 03:15:44 +0000"  >&lt;p&gt;Fortunately i only screwed this up on trunk... its been fine in 3.x all along.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12496324" name="LUCENE-3452.patch" size="1860" author="rcmuir" created="Fri, 23 Sep 2011 21:34:10 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 23 Sep 2011 19:50:13 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4095</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24244</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>