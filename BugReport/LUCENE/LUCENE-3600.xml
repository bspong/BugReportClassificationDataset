<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:12:01 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3600/LUCENE-3600.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3600] BlockJoinQuery advance fails on an assert in case of a single parent with child segment</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3600</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The BlockJoinQuery will fail on an assert when advance in called on a segment with a single parent with a child. The call to parentBits.prevSetBit(parentTarget - 1) will cause -1 to be returned, and the assert will fail, though its valid. Just removing the assert fixes the problem, since nextDoc will handle it properly.&lt;/p&gt;

&lt;p&gt;Also, I don&apos;t understand the &quot;assert parentTarget != 0;&quot;, with a comment of each parent must have one child. There isn&apos;t really a reason to add this constraint, as far as I can tell..., just call nextDoc in this case, no?&lt;/p&gt;</description>
                <environment></environment>
            <key id="12532826">LUCENE-3600</key>
            <summary>BlockJoinQuery advance fails on an assert in case of a single parent with child segment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="kimchy">Shay Banon</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Nov 2011 10:55:04 +0000</created>
                <updated>Fri, 10 May 2013 11:43:09 +0100</updated>
                    <resolved>Sun, 27 Nov 2011 19:52:58 +0000</resolved>
                            <version>3.5</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/join</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="13157735" author="simonw" created="Sun, 27 Nov 2011 12:19:18 +0000"  >&lt;p&gt;added fixVersion 3.6 &amp;amp; 4.0&lt;/p&gt;</comment>
                    <comment id="13157972" author="mikemccand" created="Sun, 27 Nov 2011 19:25:09 +0000"  >&lt;p&gt;Hmm, the docID passed to BJQ&apos;s advance should be from the parent docID space (ie, obtained from a parent-level query you&apos;re ANDing with).&lt;/p&gt;

&lt;p&gt;I can&apos;t get a test case to fail, if indeed the parent has a child doc...&lt;/p&gt;

&lt;p&gt;Do you have a case (Query) where a non-parent docID is passed to BJQ.advance?&lt;/p&gt;

&lt;p&gt;Separately, I think you&apos;re right: if we change that &quot;assert parentTarget != 0&quot; instead to &quot;if (parentDoc == 0) return nextDoc();&quot;, then BJQ can support parents w/ no children (which can never match, since BJQ does effectively an inner join).&lt;/p&gt;</comment>
                    <comment id="13158285" author="kimchy" created="Mon, 28 Nov 2011 08:37:59 +0000"  >&lt;p&gt;Thanks for fixing the parent with no children!. I think there is still a problem with the assert on a single segment with one parent and child. I just took your test case: testAdvanceSingleParentSingleChild and it fails for me with asserts enabled on the &quot;assert prevParentDoc &amp;gt;= parentDoc;&quot; (I copied over the code, having problems with Lucene IDEA project config now...).&lt;/p&gt;

&lt;p&gt;Imagine there is a single parent and single child. Child is docId 0, and parent is docId 1. A filter for the parent is used in conjunction with the child query. The parent filter is used first, and returns docId 1, which then the BlockJoinQuery advance is called. But, because its the first parent, this call: &quot;final int prevParentDoc = parentBits.prevSetBit(parentTarget - 1);&quot; will cause -1 to be returned, which will cause this assert: &quot;assert prevParentDoc &amp;gt;= parentDoc;&quot; to fail (parentDoc is 0). Just removing the assert fixes the problem.&lt;/p&gt;</comment>
                    <comment id="13158698" author="mikemccand" created="Mon, 28 Nov 2011 19:59:38 +0000"  >&lt;p&gt;Shay, maybe you missed copying over init&apos;ing parentDoc to -1?  (I don&apos;t see this assert failing &amp;#8211; &quot;ant test&quot; runs w/ asserts).&lt;/p&gt;</comment>
                    <comment id="13158803" author="kimchy" created="Mon, 28 Nov 2011 21:31:17 +0000"  >&lt;p&gt;Ahh, I see, missed the change of setting it to -1 for calling nextDoc on parentId 0, cool.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 27 Nov 2011 12:19:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>218560</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24097</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>