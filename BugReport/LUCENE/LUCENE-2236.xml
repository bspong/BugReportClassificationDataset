<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:07:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2236/LUCENE-2236.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2236] Similarity can only be set per index, but I may want to adjust scoring behaviour at a field level</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2236</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Similarity can only be set per index, but I may want to adjust scoring behaviour at a field level, to faciliate this could we pass make field name available to all score methods.&lt;br/&gt;
Currently it is only passed to some such as lengthNorm() but not others such as tf()&lt;/p&gt;</description>
                <environment></environment>
            <key id="12446552">LUCENE-2236</key>
            <summary>Similarity can only be set per index, but I may want to adjust scoring behaviour at a field level</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="ijabz">Paul taylor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jan 2010 15:27:40 +0000</created>
                <updated>Fri, 10 May 2013 11:43:47 +0100</updated>
                    <resolved>Mon, 24 Jan 2011 19:18:48 +0000</resolved>
                            <version>3.0</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/query/scoring</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12982251" author="rcmuir" created="Sun, 16 Jan 2011 08:35:49 +0000"  >&lt;p&gt;attached is a patch to enable per-field similarity.&lt;/p&gt;

&lt;p&gt;it includes the prerequisite patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2869&quot; title=&quot;remove Query.getSimilarity()&quot;&gt;&lt;del&gt;LUCENE-2869&lt;/del&gt;&lt;/a&gt;, which i separately plan to commit soon (then update my local).&lt;/p&gt;

&lt;p&gt;the patch creates two new classes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SimilarityProvider: contains the field-independent methods like coord(). also has a get(String field) that returns a FieldSimilarity&lt;/li&gt;
	&lt;li&gt;FieldSimilarity: all the field-specific stuff like tf, etc.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;the old Similarity is deprecated, it is a FieldSimilarity and also a SimilarityProvider, that always returns itself.&lt;br/&gt;
Maybe it could be removed since i tried to cutover all code, I didnt check.&lt;br/&gt;
Removing it would allow us to remove the redundant field arguments from the FieldSimilarity methods easily.&lt;/p&gt;

&lt;p&gt;Additionally Scorer&apos;s &quot;Similarity&quot; is removed. This is useless and most scorers ignored it or populated it with garbage.&lt;br/&gt;
Scorers themselves, know if they need a sim or not (e.g. BooleanScorer uses only the top-level SimilarityProvider for coord).&lt;/p&gt;

&lt;p&gt;all lucene/contrib/solr tests pass, i also added a simple unit test.&lt;/p&gt;</comment>
                    <comment id="12982254" author="rcmuir" created="Sun, 16 Jan 2011 08:37:19 +0000"  >&lt;p&gt;also, i removed Similarity.get/setDefault in this patch.&lt;/p&gt;

&lt;p&gt;Instead we have a private @lucene.internal method (in IndexSearcher, for lack of a better place). &lt;br/&gt;
This is only needed for things like Instantiated, MemoryIndex, etc.&lt;/p&gt;

&lt;p&gt;In general things shouldn&apos;t rely upon some global static if we want to make scoring more flexible.&lt;/p&gt;</comment>
                    <comment id="12982279" author="simonw" created="Sun, 16 Jan 2011 10:59:46 +0000"  >&lt;p&gt;Nice work robert, while I only looked briefly at this patch but I wonder why SimilarityProvider is an interface while it could be an abstract class. Adding methods later to an abstract class is much easier than to an interface though. I hope I can have a closer look at this patch soon!&lt;/p&gt;
</comment>
                    <comment id="12982299" author="rcmuir" created="Sun, 16 Jan 2011 13:31:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;I wonder why SimilarityProvider is an interface while it could be an abstract class&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is an expert API and we already agreed we can &quot;use interfaces without fear&quot;.&lt;/p&gt;</comment>
                    <comment id="12982623" author="doronc" created="Mon, 17 Jan 2011 13:04:54 +0000"  >&lt;p&gt;I like this flexibility - allowing different scoring parameters for different fields. &lt;/p&gt;

&lt;p&gt;Wondering though - would it be nicer to keep original name &lt;b&gt;Similarity&lt;/b&gt; and just change the way it is created and used to be field specific...?&lt;/p&gt;

&lt;p&gt;For this, should deprecate Similarity methods taking a field/name param and introduce new ones without it - hmm.. the class would then have 3 deprecated methods: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;scorePayload()&lt;/li&gt;
	&lt;li&gt;lengthNorm() (which anyway is already deprecated)&lt;/li&gt;
	&lt;li&gt;computeNorm()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Is that too bad?&lt;/p&gt;

&lt;p&gt;For FieldSimilarity (and for the new method in Similarity if deciding to keep that name after all) can we get rid of the first parameter fieldName from computeNorm() and scorePayload(), or are they used in a way I am missing even when one knows that the similarity is for certain (or all) field?&lt;/p&gt;

&lt;p&gt;In the new class FS (if kept) I think the deprecated lengthNorm() can be removed?&lt;/p&gt;

&lt;p&gt;Also, since Similarity (or FS) is becoming field aware, perhaps add a method &lt;b&gt;getFieldName()&lt;/b&gt; - it can return null or ANY in case there is no dedicated similarity for that field... Hmm... If the logic employed is this &quot;For fields F1, F2 return Sim1, for F3, F4 return Sim2, for all other fields return Sim3, then it is less simple, still, the similarity provider called with a field name can pass it to the Similarity object created and that in turn would be able to return it... just thinking out loud here... should Sim be aware of for which field it was created, so that no need to pass it as parameter in its methods in case this is ever important?&lt;/p&gt;</comment>
                    <comment id="12982635" author="rcmuir" created="Mon, 17 Jan 2011 13:42:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is that too bad?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;well my concern about the deprecated methods is we get into the hairy backwards compat situation...&lt;br/&gt;
we already had issues with this with Similarity.&lt;/p&gt;

&lt;p&gt;It might be ok to essentially fix Similarity to be the way we want for 4.0 (break it) since its an expert API anyway.&lt;br/&gt;
This patch was just a quick stab...&lt;br/&gt;
I definitely agree with you about the name though, i prefer Similarity.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;should Sim be aware of for which field it was created, so that no need to pass it as parameter in its methods in case this is ever important?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well honestly I think what you are saying is really needed for the future... but I would prefer to actually delay that until a future patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Making an optimized TermScorer is becoming more and more complicated, see the one in the bulkpostings branch for example. Because of this,&lt;br/&gt;
its extremely tricky to customize the scoring with good performance. I think the score caching etc in term scorer needs to be moved out of TermScorer,&lt;br/&gt;
instead the responsibility of calculating the score should reside in Similarity, including any caching it needs to do (which is really impl dependent).&lt;br/&gt;
Basically Similarity needs to be responsible for score(), but let TermScorer etc deal with enumerating postings etc.&lt;/p&gt;

&lt;p&gt;For example, we now have the stats totalTermFreq/totalCollectionFreq by field for a term, but you can&apos;t e.g. take these and make a &lt;br/&gt;
Language-modelling based scorer, which you should be able to do &lt;b&gt;right now&lt;/b&gt;, except for limitations in our APIs.&lt;/p&gt;

&lt;p&gt;So in a future issue I would like to propose a patch to do just this, so that TermScorer, for example is more general. Similarity would need to be able&lt;br/&gt;
to &apos;setup&apos; a query (e.g. things like IDF, building score caches for the query, whatever), and then also score an individual document.&lt;/p&gt;

&lt;p&gt;In the flexible scoring prototype this is what we did, but we went even further, where a Similarity is also responsible for &apos;setting up&apos; a searcher, too.&lt;br/&gt;
So that means, its responsible for managing norm byte[] (in that patch, you only had a byte[] norms, if you made it in your Similarity yourself).&lt;br/&gt;
I think long term that approach is definitely really interesting, but I think we can go ahead and make scoring a lot more flexible in tiny steps &lt;br/&gt;
like this without rewriting all of lucene in one enormous patch... and this is safer as we can benchmark performance each step of the way.&lt;/p&gt;</comment>
                    <comment id="12982872" author="doronc" created="Mon, 17 Jan 2011 21:17:32 +0000"  >&lt;blockquote&gt;
&lt;p&gt;well my concern about the deprecated methods is we get into the hairy backwards compat situation...&lt;br/&gt;
It might be ok to essentially fix Similarity to be the way we want for 4.0 (break it) since its an expert API anyway.&lt;br/&gt;
This patch was just a quick stab...&lt;br/&gt;
I definitely agree with you about the name though, i prefer Similarity.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So let&apos;s keep that name (Similarity) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Well honestly I think what you are saying is really needed for the future&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok one step at a time makes sense.. so it means that fieldName parameters remain, although the Similarity object is created per given field, well, ok, another day...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Similarity would need to be able to &apos;setup&apos; a query (e.g. things like IDF, building score caches for the query, whatever), and then also score an individual document.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Interesting... &lt;br/&gt;
(flexible-scoring and bulk-postings works are still unknowns to me.) &lt;br/&gt;
So Similarity is not only per field but also per query/scorer..  &lt;br/&gt;
and Query would have an abstract method getSimilarityProvider(fieldName) which would be implemented by each concrete query, neatly separating finding matches from scores computation, and allowing more extendable scoring. Nice.&lt;br/&gt;
Also, perhaps what seems to be like an inflation of Similarity objects (per query per field) is one more good reason to keep the field name params for now.&lt;/p&gt;</comment>
                    <comment id="12982888" author="rcmuir" created="Mon, 17 Jan 2011 21:47:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;So let&apos;s keep that name (Similarity) &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, I&apos;ll fix the patch, to rename FieldSimilarity-&amp;gt;Similarity&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;So Similarity is not only per field but also per query/scorer.. &lt;br/&gt;
and Query would have an abstract method getSimilarityProvider(fieldName) which would be implemented by each concrete query, neatly separating finding matches from scores computation, and allowing more extendable scoring. Nice.&lt;br/&gt;
Also, perhaps what seems to be like an inflation of Similarity objects (per query per field) is one more good reason to keep the field name params for now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well I&apos;m not totally sure how we want to do it, but definitely I think we want to split Scorer&apos;s calculations and finding matches as you say,&lt;br/&gt;
and also split Weight&apos;s calculations and &quot;resource management&quot;&lt;/p&gt;

&lt;p&gt;For example, TermWeight today has a PerReaderTermState, which contains all the information you need to calculate the &quot;setup&quot; portion&lt;br/&gt;
without doing any real I/O (e.g. docFreq, totalTermFreq, totalCollectionFreq, ...) So maybe this is the right thing to pass to Similarity&apos;s &quot;query setup&quot;.&lt;/p&gt;

&lt;p&gt;The Weight then would just be responsible for managing termstate and creating a Scorer...&lt;/p&gt;

&lt;p&gt;I think also the Similarity needs to be fully responsible for Explanations... but most users wouldn&apos;t have to interact with this I think.&lt;br/&gt;
Instead I think typically their &quot;base class&quot; (TFIDFSimilarity or whatever it is) would typically provide this, based on the methods and API&lt;br/&gt;
it exposes: tf(), idf(), but this would allow us to also have other fully-fleshed out base classes like BM25Similarity, that you can extend&lt;br/&gt;
and tune based on the parameters that make sense to it.&lt;/p&gt;

&lt;p&gt;Anyway these are just some thoughts, first I&apos;m going to adjust the patch to keep our existing name &quot;Similarity&quot;.&lt;/p&gt;</comment>
                    <comment id="12984903" author="rcmuir" created="Fri, 21 Jan 2011 20:01:11 +0000"  >&lt;p&gt;Here&apos;s an updated patch, now that some cleanup work has been committed separately, its easier to manage.&lt;/p&gt;

&lt;p&gt;I kept the original name Similarity: I definitely like this better, and tried to clean up the patch to make it committable.&lt;/p&gt;

&lt;p&gt;If this patch is ok, I would prefer to make a follow-up issue to make it easier to use per-field Similarity with a Solr schema file.&lt;br/&gt;
Currently Solr lets you specify the index-wide Similarity; with this patch, this can be customized per-field, but you have to&lt;br/&gt;
manage this in your java implementation.&lt;/p&gt;

&lt;p&gt;In my opinion, it would be better to have more declarative schema integration, especially if we get scoring going with more flexibility.&lt;/p&gt;</comment>
                    <comment id="12985349" author="doronc" created="Sun, 23 Jan 2011 15:57:44 +0000"  >&lt;p&gt;Robert, thanks for renaming back to Similarity.&lt;br/&gt;
I reviewed the patch - it looks good to me, just technical simple comments here (it may seem a long list but these are really just simple changes)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Similarity&lt;/b&gt;:
	&lt;ul&gt;
		&lt;li&gt;line 365: should be
		&lt;ul&gt;
			&lt;li&gt;{@link SimilarityProvider#coord(int, int) coord(q,d)}&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;line 565: should be:
		&lt;ul&gt;
			&lt;li&gt;@see org.apache.lucene.index.IndexWriterConfig#setSimilarityProvider(SimilarityProvider)&lt;/li&gt;
			&lt;li&gt;@see IndexSearcher#setSimilarityProvider(SimilarityProvider)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;InstantiatedIndexWriter&lt;/b&gt; &amp;amp; &lt;b&gt;MemoryIndex&lt;/b&gt; &amp;amp; &lt;b&gt;DocumentWriter&lt;/b&gt; &amp;amp; &lt;b&gt;DocState&lt;/b&gt; &amp;amp; &lt;b&gt;BooleanQuery&lt;/b&gt;
	&lt;ul&gt;
		&lt;li&gt;methods and member should be named similar to IndexSearcher:
		&lt;ul&gt;
			&lt;li&gt;similarityProvider&lt;/li&gt;
			&lt;li&gt;getSimilarityProvider()&lt;/li&gt;
			&lt;li&gt;setSimilarityProvider(SimilarityProvider similarityProvider)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;MIGRATE.txt&lt;/b&gt; - I think it should read like this:
	&lt;ul&gt;
		&lt;li&gt;DefaultSimilarity can no longer be set statically (and dangerously) for the entire JVM.&lt;br/&gt;
  Instead, IndexWriterConfig and IndexSearcher now take a SimilarityProvider. &lt;br/&gt;
  Similarity can now be configured on a per-field basis. &lt;br/&gt;
  Similarity retains only the field-specific relevance methods such as tf() and idf(). &lt;br/&gt;
  Methods that apply to the entire query such as coord() and queryNorm() exist in SimilarityProvider.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;IndexWriterConfig javadocs lines 240-241 should discuss SimilarityProvider (not Similarity)&lt;/li&gt;
	&lt;li&gt;Would it be cleaner to have a new class DefaultSimilarityProvider which would return DefaultSimilarity? not sure, but thought it&apos;s worth mentioning.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;IndexSearcher&lt;/b&gt;
	&lt;ul&gt;
		&lt;li&gt;javadoc in line 78:&lt;br/&gt;
   &quot;In general, this should not be used.&quot;&lt;br/&gt;
   Is that so? I would like to believe that in general the default is pretty good.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TestIndexReaderCloneNorms&lt;/b&gt; the &quot;TODO&quot; added there can be fixed (not too efficiently, but okay for the test I think) like this:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Document newDoc() {
  Document d = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Document();
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 10; i++) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fname = &lt;span class=&quot;code-quote&quot;&gt;&quot;f&quot;&lt;/span&gt; + i;
    Field f = newField(fname, &lt;span class=&quot;code-quote&quot;&gt;&quot;v&quot;&lt;/span&gt; + i, Store.NO, Index.NOT_ANALYZED);
    &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; boost = nextNorm(fname);
    f.setBoost(boost);
    d.add(f);
  }
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; d;
}

&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; unique norm values that are unchanged by encoding/decoding
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; nextNorm(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fname) {
  &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; norm = lastNorm + normDelta;
  &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
    Similarity sim = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultSimilarity().get(fname);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TestNorms&lt;/b&gt; - can fix the &quot;bogus&quot; TODO similar to the above code snippet.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12985361" author="doronc" created="Sun, 23 Jan 2011 16:45:06 +0000"  >&lt;p&gt;attached updated patch according to last comments.&lt;/p&gt;</comment>
                    <comment id="12985364" author="doronc" created="Sun, 23 Jan 2011 17:04:28 +0000"  >&lt;p&gt;note: with last patch both tests fail - TestNorms and TestIndexReaderCloneNorms.&lt;/p&gt;</comment>
                    <comment id="12985368" author="doronc" created="Sun, 23 Jan 2011 17:31:22 +0000"  >&lt;p&gt;Attaching fixed patch - these two tests fixed to pass again (I shouldn&apos;t have taken nextNorm() out of the loop...) - all Lucene (core) tests pass, Solr ones failed to compile as (from command line) JAVA_HOME pointed to Java 5, - will complete the run later.&lt;/p&gt;</comment>
                    <comment id="12985401" author="doronc" created="Sun, 23 Jan 2011 20:02:55 +0000"  >&lt;p&gt;OK with java 6 all tests passed.&lt;/p&gt;</comment>
                    <comment id="12985403" author="rcmuir" created="Sun, 23 Jan 2011 20:34:37 +0000"  >&lt;p&gt;Hi Doron, thanks for the cleanups here!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would it be cleaner to have a new class DefaultSimilarityProvider which would return DefaultSimilarity? not sure, but thought it&apos;s worth mentioning.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I went back and forth on this one... it could go either way? But since the default does the same thing for every field, I thought&lt;br/&gt;
it made sense... what do you think? We could always revisit it too later, if we later prefer these to be separate.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;javadoc in line 78:&lt;br/&gt;
&quot;In general, this should not be used.&quot;&lt;br/&gt;
Is that so? I would like to believe that in general the default is pretty good.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In this case, I should have been more verbose... what I meant here is that &apos;in general, code should not call this static method, instead it should &lt;br/&gt;
respect the SimilarityProvider set on IndexSearcher &lt;span class=&quot;error&quot;&gt;&amp;#91;getSimilarityProvider()&amp;#93;&lt;/span&gt;...&apos;. This is just the default exposed for internal purposes: just to&lt;br/&gt;
have a single immutable default instance for MemoryIndex, InstantiatedIndex, IndexWriterConfig, IndexSearcher... but if someone writes&lt;br/&gt;
a custom Query for example, they should be using IndexSearcher.getSimilarityProvider(), and not this static.&lt;/p&gt;

&lt;p&gt;I can update the javadocs to be a little bit more verbose for this method, as I would like to discourage its use... its essentially just like&lt;br/&gt;
using Similarity.getDefault() before, which I tried to cleanup across lucene.&lt;/p&gt;</comment>
                    <comment id="12985415" author="doronc" created="Sun, 23 Jan 2011 21:09:20 +0000"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I can update the javadocs to be a little bit more verbose for this method, as I would like to discourage its use... its essentially just like&lt;br/&gt;
using Similarity.getDefault() before, which I tried to cleanup across lucene&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes I was confused by this, it is really an accessor method for the constant, and indeed with this change it is no more possible for users to modify the default behavior regarding similarity JVM wide - as they can still do for e.g. BQ.setMaxClauseCount(). &lt;/p&gt;

&lt;p&gt;I read it wrongly, as if it said &quot;in general, this setting should not remain... &quot; maybe it is just me. &lt;br/&gt;
I agree something as you propose like this would be probably clear on first reading: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
  * Expert: returns a &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; SimilarityProvider instance.
  * In general, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method is only called to initialize searchers and writers.
  * User code and query implementations should respect e.g.
  * {@link ..... IndexSearcher#getSimilarityProvider()}.
  * @lucene.internal
  */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or something similar (I am sure you&apos;ll write it better...&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                    <comment id="12985498" author="rcmuir" created="Mon, 24 Jan 2011 03:06:45 +0000"  >&lt;p&gt;Updated patch, with Doron&apos;s suggested wording for IndexSearcher.getDefaultSimilarityProvider&lt;/p&gt;

&lt;p&gt;I also corrected a javadocs warning in Weight (bad reference to queryNorm).&lt;/p&gt;

&lt;p&gt;I think we are ready to commit unless there are any objections.&lt;/p&gt;</comment>
                    <comment id="12985914" author="rcmuir" created="Mon, 24 Jan 2011 19:18:48 +0000"  >&lt;p&gt;Committed revision 1062927.&lt;/p&gt;

&lt;p&gt;Thanks Doron!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12469112" name="LUCENE-2236.patch" size="107732" author="rcmuir" created="Mon, 24 Jan 2011 03:06:45 +0000" />
                    <attachment id="12469089" name="LUCENE-2236.patch" size="106357" author="doronc" created="Sun, 23 Jan 2011 17:31:22 +0000" />
                    <attachment id="12469086" name="LUCENE-2236.patch" size="106386" author="doronc" created="Sun, 23 Jan 2011 16:45:06 +0000" />
                    <attachment id="12469007" name="LUCENE-2236.patch" size="102325" author="rcmuir" created="Fri, 21 Jan 2011 20:01:11 +0000" />
                    <attachment id="12468477" name="LUCENE-2236.patch" size="181926" author="rcmuir" created="Sun, 16 Jan 2011 08:35:49 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 16 Jan 2011 08:35:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11552</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25489</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>