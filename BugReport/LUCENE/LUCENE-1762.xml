<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1762/LUCENE-1762.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1762] Slightly more readable code in Token/TermAttributeImpl</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1762</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;No big deal. &lt;/p&gt;

&lt;p&gt;growTermBuffer(int newSize) was using correct, but slightly hard to follow code. &lt;/p&gt;

&lt;p&gt;the method was returning null as a hint that the current termBuffer has enough space to the upstream code or reallocated buffer.&lt;/p&gt;

&lt;p&gt;this patch simplifies logic   making this method to only reallocate buffer, nothing more.  &lt;br/&gt;
It reduces number of if(null) checks in a few methods and reduces amount of code. &lt;br/&gt;
all tests pass.&lt;/p&gt;

&lt;p&gt;This also adds tests for the new basic attribute impls (copies of the Token tests).&lt;/p&gt;</description>
                <environment></environment>
            <key id="12431427">LUCENE-1762</key>
            <summary>Slightly more readable code in Token/TermAttributeImpl</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="eksdev">Eks Dev</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Jul 2009 14:21:25 +0100</created>
                <updated>Wed, 29 Jul 2009 20:15:38 +0100</updated>
                    <resolved>Wed, 29 Jul 2009 20:15:38 +0100</resolved>
                            <version>2.9</version>
                                <fixVersion>2.9</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12735275" author="thetaphi" created="Sat, 25 Jul 2009 14:57:39 +0100"  >&lt;p&gt;As Token is not yet deprecated, I think, this patch should also apply to Token.java?&lt;br/&gt;
Can you prepare that, too?&lt;/p&gt;

&lt;p&gt;(This is important, because if the backwards-compatibility layer is enabled with setOnlyUseNewAPI(false)), the TermAttributeImpl is never used and a Token instance is used instead - if no tests fail, this may also be the case :-] )&lt;/p&gt;</comment>
                    <comment id="12735329" author="eksdev" created="Sat, 25 Jul 2009 23:51:59 +0100"  >&lt;p&gt;made the changes in Token along the same lines, &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;had to change one constant in TokenTest as I have changed initial allocation policy of termBuffer to be consistent with Arayutils.getnextSize()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;if(termBuffer==null)&lt;/p&gt;

&lt;p&gt;NEW:&lt;br/&gt;
 termBuffer = new char&lt;span class=&quot;error&quot;&gt;&amp;#91;ArrayUtil.getNextSize(newSize &amp;lt; MIN_BUFFER_SIZE ? MIN_BUFFER_SIZE : newSize)&amp;#93;&lt;/span&gt;; &lt;/p&gt;

&lt;p&gt;OLD:&lt;br/&gt;
termBuffer = new char&lt;span class=&quot;error&quot;&gt;&amp;#91;newSize &amp;lt; MIN_BUFFER_SIZE ? MIN_BUFFER_SIZE : newSize&amp;#93;&lt;/span&gt;; &lt;/p&gt;

&lt;p&gt;not sure if this is better, but looks more consistent to me (buffer size is always determined via getNewSize())&lt;/p&gt;

&lt;p&gt;Uwe, &lt;br/&gt;
setOnlyUseNewAPI(false) does not exist, it was removed with some of the patches lately. It gets automatically detected via reflection?&lt;/p&gt;
</comment>
                    <comment id="12735332" author="eksdev" created="Sun, 26 Jul 2009 00:12:43 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;made allocation in initTermBuffer() consistent with ArrayUtil.getNextSize(int) -  this is ok not to start with MIN_BUFFER_SIZE, but rather with ArrayUtil.getNextSize(MIN_BUFFER_SIZE)... e.g. if getNextSize gets very sensitive to initial conditions one day...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;null-ed  termText on switch to termBuffer in resizeTermBuffer (as it was before!) . This was a bug in previous patch&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12735358" author="thetaphi" created="Sun, 26 Jul 2009 08:35:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;setOnlyUseNewAPI(false) does not exist, it was removed with some of the patches lately. It gets automatically detected via reflection?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, this is a static global switch in TokenStream. If you switch it on, TokenStreams and Filters use only the new API forcefully and therefore use the separate Attribute implementations from o.a.l.analysis.tokenattributes. If it is switched off, a old Token instance is used instead, see &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc/core/org/apache/lucene/analysis/TokenStream.html#setOnlyUseNewAPI(boolean)&quot; class=&quot;external-link&quot;&gt;http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc/core/org/apache/lucene/analysis/TokenStream.html#setOnlyUseNewAPI(boolean)&lt;/a&gt;. The red color bug is fixed in trunk now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;There is one problem with the 6 new single attribute instances: They are code duplicates from Token but have no Test. I also think, I should add a missing test similar to TestToken.java and do the same test with 6 Attribute instances.&lt;/p&gt;

&lt;p&gt;I will review the other changes later, I have no time today.&lt;/p&gt;</comment>
                    <comment id="12735796" author="thetaphi" created="Mon, 27 Jul 2009 22:51:29 +0100"  >&lt;p&gt;Extended patch. It adds also tests for the basic attributes (in trunk only token was tested). The new tests check every impls basic functionality and clone/copyTo. It also contains the buffer tests of Token for TermAttribute.&lt;/p&gt;

&lt;p&gt;To apply the patch you must first do a:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
svn copy src/test/org/apache/lucene/analysis/TestToken.java src/test/org/apache/lucene/analysis/tokenattributes/TestTermAttributeImpl.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It also modified the AttributeImpls default toString() to only print instance fields, not static fields.&lt;/p&gt;</comment>
                    <comment id="12735798" author="thetaphi" created="Mon, 27 Jul 2009 22:53:10 +0100"  >&lt;p&gt;Eks, the original patch looked good, I did not change anything in your code, I only added the above mentioned tests and other changes.&lt;/p&gt;

&lt;p&gt;One thing: As TestToken checks the buffer sizes, the test in the backwards-branch for Token must also be changed. I will do this before commit.&lt;/p&gt;</comment>
                    <comment id="12735809" author="eksdev" created="Mon, 27 Jul 2009 23:20:58 +0100"  >&lt;p&gt;cool, thanks for the review.   &lt;/p&gt;</comment>
                    <comment id="12735975" author="thetaphi" created="Tue, 28 Jul 2009 08:56:11 +0100"  >&lt;p&gt;Here the modified BW-test to apply on backwards-branch. It respects the new default buffer size.&lt;/p&gt;</comment>
                    <comment id="12736028" author="thetaphi" created="Tue, 28 Jul 2009 11:53:28 +0100"  >&lt;p&gt;Slightly modified patch (some small refactoring). I also fixed a bug in Token, because the Payload was not deep cloned in copyTo(), which is done by the simple attributes and needed for restoring the state in AttributeSource. Also added tests for this.&lt;/p&gt;

&lt;p&gt;I think it is ready for commit. I will do this in a day or two.&lt;/p&gt;</comment>
                    <comment id="12736764" author="thetaphi" created="Wed, 29 Jul 2009 20:15:38 +0100"  >&lt;p&gt;Committed revision: 799025&lt;br/&gt;
This is without CHANGES.txt updates, because nothing was changed that is visible to the outside &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks Eks!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12414722" name="LUCENE-1762-bw.patch" size="781" author="thetaphi" created="Tue, 28 Jul 2009 08:56:11 +0100" />
                    <attachment id="12414736" name="LUCENE-1762.patch" size="25653" author="thetaphi" created="Tue, 28 Jul 2009 11:53:28 +0100" />
                    <attachment id="12414669" name="LUCENE-1762.patch" size="23634" author="thetaphi" created="Mon, 27 Jul 2009 22:51:29 +0100" />
                    <attachment id="12414524" name="LUCENE-1762.patch" size="10980" author="eksdev" created="Sun, 26 Jul 2009 00:12:43 +0100" />
                    <attachment id="12414523" name="LUCENE-1762.patch" size="10333" author="eksdev" created="Sat, 25 Jul 2009 23:51:59 +0100" />
                    <attachment id="12414514" name="LUCENE-1762.patch" size="4588" author="eksdev" created="Sat, 25 Jul 2009 14:23:31 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 25 Jul 2009 13:57:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11999</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25964</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>