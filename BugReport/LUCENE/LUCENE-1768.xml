<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:24:46 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1768/LUCENE-1768.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1768] NumericRange support for new query parser</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1768</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;It would be good to specify some type of &quot;schema&quot; for the query parser in future, to automatically create NumericRangeQuery for different numeric types? It would then be possible to index a numeric value (double,float,long,int) using NumericField and then the query parser knows, which type of field this is and so it correctly creates a NumericRangeQuery for strings like &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;1.567..*&amp;#93;&lt;/span&gt;&quot; or &quot;(1.787..19.5]&quot;.&lt;/p&gt;

&lt;p&gt;There is currently no way to extract if a field is numeric from the index, so the user will have to configure the FieldConfig objects in the ConfigHandler. But if this is done, it will not be that difficult to implement the rest.&lt;/p&gt;

&lt;p&gt;The only difference between the current handling of RangeQuery is then the instantiation of the correct Query type and conversion of the entered numeric values (simple Number.valueOf(...) cast of the user entered numbers). Evenerything else is identical, NumericRangeQuery also supports the MTQ rewrite modes (as it is a MTQ).&lt;/p&gt;

&lt;p&gt;Another thing is a change in Date semantics. There are some strange flags in the current parser that tells it how to handle dates.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12431778">LUCENE-1768</key>
            <summary>NumericRange support for new query parser</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                        <label>contrib</label>
                        <label>gsoc</label>
                        <label>gsoc2011</label>
                        <label>lucene-gsoc-11</label>
                        <label>mentor</label>
                    </labels>
                <created>Thu, 30 Jul 2009 09:04:58 +0100</created>
                <updated>Sun, 27 Nov 2011 12:31:35 +0000</updated>
                    <resolved>Thu, 8 Sep 2011 17:50:32 +0100</resolved>
                            <version>2.9</version>
                                <fixVersion>3.4</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/queryparser</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12737669" author="lafa" created="Fri, 31 Jul 2009 20:16:59 +0100"  >&lt;p&gt;Uwe, &lt;/p&gt;

&lt;p&gt;Thanks for creating the jira issue.&lt;/p&gt;

&lt;p&gt;Can you add some simple query examples.&lt;br/&gt;
What would be the lucene Query objects for those queries, if it was produce by a QP that supported that feature.&lt;/p&gt;

&lt;p&gt;Also elaborate what is the current expect behavior for those queries.&lt;/p&gt;

&lt;p&gt;If you can write a junit with one or 2 indexed docs, &lt;br/&gt;
and a lucene Query that retrives just one of those docs and not the other&lt;br/&gt;
without using the queryparser, that would be helpful.&lt;/p&gt;</comment>
                    <comment id="12738052" author="thetaphi" created="Sun, 2 Aug 2009 13:09:10 +0100"  >&lt;p&gt;Luis,&lt;br/&gt;
I will post an example of queries and the constructed Query objects when I am back from holidays (Thursday+). In principle the syntax would be the same like for normal range queries, only that the min/max arguments may be double, float, int, long or dates. You would create instances of NumericRangeQuery from it using one of the static factories for each data type (for dates a conversion to long using Date.getTime() would be done). The datatype must be somehow predefined for the field names using some type of schema (per field).. Open ends use &quot;*&quot; and the [], (), {} would define if incl. NumericRangeQuery is a subclass of MultiTermQuery so the rewrite method also applies to this query. For NRQ there is also a config parameter precisionStep which default value is 4, but should be also configureable per-field together with the data type.&lt;/p&gt;

&lt;p&gt;Example code for creating the NRQ are in the JavaDocs and there are 2 JUnits in trunk (TestNumericRangeQuery*) showing how it is used. Also the new LIA2 contains a chapter about it.&lt;/p&gt;</comment>
                    <comment id="12740051" author="thetaphi" created="Thu, 6 Aug 2009 14:25:38 +0100"  >&lt;p&gt;I think, this should be in 2.9. Any Chance to do this. In my Opinion, it should be not so hard. I will prepare something tomorrow.&lt;/p&gt;</comment>
                    <comment id="12740222" author="yseeley@gmail.com" created="Thu, 6 Aug 2009 20:42:59 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think, this should be in 2.9.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The standard way in the past was for the app to simply override getRangeQuery() to handle different fields differently.&lt;br/&gt;
This still seems the most flexible.&lt;/p&gt;</comment>
                    <comment id="12740340" author="lafa" created="Fri, 7 Aug 2009 02:03:49 +0100"  >&lt;p&gt;You could still do something similar by simply override RangeQueryNodeBuilder.build(QueryNode queryNode), but this is not clean (it is kind of a hack).&lt;/p&gt;

&lt;p&gt;A clean implementation would allow the user to configure the field types (which the &quot;new flexible queryparser&quot; does).&lt;br/&gt;
I&apos;m new to NumericRange Queries and Rangequeries in general, but here is what I think it should look like.&lt;/p&gt;

&lt;p&gt;Here is a seudo java example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; defaultField = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; monthField = &lt;span class=&quot;code-quote&quot;&gt;&quot;month&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hourField = &lt;span class=&quot;code-quote&quot;&gt;&quot;hour&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; distanceField = &lt;span class=&quot;code-quote&quot;&gt;&quot;distance&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; moneyField = &lt;span class=&quot;code-quote&quot;&gt;&quot;money&quot;&lt;/span&gt;;

    Map&amp;lt;CharSequence, RangeTools.Type&amp;gt; rangeTypes =  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;CharSequence, RangeTools.Type&amp;gt;();
    
    &lt;span class=&quot;code-comment&quot;&gt;// set a field specific range type per field
&lt;/span&gt;    rangeTypes.put(monthField, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RangeTools.Type(RangeUtils.DATE, DateTools.Resolution.MONTH) );
    rangeTypes.put(hourField, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RangeUtils.Type(RangeUtils.DATE,  DateTools.Resolution.HOUR) );
    rangeTypes.put(distanceField, RangeUtils.getType(RangeUtils.NUMERIC,  RangeUtils.NumericType.LONG, NumericUtils.PRECISION_STEP_DEFAULT) );
    rangeTypes.put(moneyField, RangeUtils.getType(RangeUtils.NUMERIC,  RangeUtils.NumericType.Type.FLOAT, NumericUtils.PRECISION_STEP_DEFAULT) );

    StandardQueryParser qp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardQueryParser();

    &lt;span class=&quot;code-comment&quot;&gt;// set &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; range type to Int &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; precision
&lt;/span&gt;    qp.setDefaultRangeType(RangeUtils.getType(RangeUtils.NUMERIC,  RangeUtils.NumericType.INT, NumericUtils.PRECISION_STEP_DEFAULT));

    &lt;span class=&quot;code-comment&quot;&gt;// set field range types
&lt;/span&gt;    qp.setRangeTypes(rangeTypes);

   Query q = qp.parser(&lt;span class=&quot;code-quote&quot;&gt;&quot; month:[01/01/2004 TO 01/01/2005]  distance:[1000 to 2000] money: [23.50 to 50.99]&quot;&lt;/span&gt;);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12740575" author="yseeley@gmail.com" created="Fri, 7 Aug 2009 15:46:22 +0100"  >&lt;p&gt;It feels like going that route would add much code and complexity.&lt;/p&gt;

&lt;p&gt;If the user already knows how to create a range query in code, it&apos;s much more straightforward to just do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;money&quot;&lt;/span&gt;.equals(field)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NumericRangeQuery(field,...)
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getRangeQuery(field,...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12740608" author="mikemccand" created="Fri, 7 Aug 2009 17:08:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;You could still do something similar by simply override RangeQueryNodeBuilder.build(QueryNode queryNode), but this is not clean (it is kind of a hack).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What&apos;s the cleaner way to do this?  EG could I make my own ParametricRangeQueryNodeProcessor, subclassing the current one in the &quot;standard.processors&quot; package, that overrides postProcessNode to do its own conversion?&lt;/p&gt;</comment>
                    <comment id="12740643" author="lafa" created="Fri, 7 Aug 2009 18:34:47 +0100"  >&lt;p&gt;Hi Yonik,&lt;/p&gt;

&lt;p&gt;As I said before you can do that in the RangeQueryNodeBuilder.build(QueryNode queryNode),&lt;br/&gt;
but it&apos;s ugly and this is not what we intended when using the &quot;new flexible query parser&quot;.&lt;/p&gt;

&lt;p&gt;The &quot;new flexible query parser&quot; does not follow the concept of method overwriting has the old one.&lt;br/&gt;
So solutions that worked in the old queryparser, like overwriting a method, have to be implemented&lt;br/&gt;
using a programmatic way.&lt;/p&gt;

&lt;p&gt;Your approach requires creating a new class, overwrite a method.&lt;br/&gt;
you still need to create a instance of your QueryParser and is not reusable.&lt;/p&gt;

&lt;p&gt;Here is a sample of what your approach is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; YonikQueryParser &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; QueryParser{

  Query getRangeQuery(field,...) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;money&quot;&lt;/span&gt;.equals(field)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NumericRangeQuery(field,...)
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getRangeQuery(field,...)
  }
}

...
 QueryParser yqp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; YonikQueryParser(...);
yqp.parser(query);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; vs&lt;/p&gt;

&lt;p&gt;What I am proposing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    Map&amp;lt;CharSequence, RangeTools.Type&amp;gt; rangeTypes =  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;CharSequence, RangeTools.Type&amp;gt;();
    
    rangeTypes.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;money&quot;&lt;/span&gt;, RangeUtils.getType(RangeUtils.NUMERIC,  RangeUtils.NumericType.Type.FLOAT, NumericUtils.PRECISION_STEP_DEFAULT) );

    StandardQueryParser qp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardQueryParser();
    qp.setRangeTypes(rangeTypes);

    qp.parser(query);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second approach is programmatic does not require a new class, &lt;br/&gt;
or the overwrite of a method and is reusable by other users, and it&apos;s&lt;br/&gt;
backward compatible, meaning we can integrate this on the current &lt;br/&gt;
&quot;Flexible query parser&quot; and deliver this feature on 2.9 without affecting&lt;br/&gt;
any current usecase.&lt;/p&gt;

&lt;p&gt;Your approach is not compatible, it does require new class, and is not programmatic,&lt;br/&gt;
It&apos;s not reusable by other users (we can&apos;t commit your code to lucene), &lt;br/&gt;
since fields are hard-coded.&lt;/p&gt;

&lt;p&gt;Also the approach I proposing is very similar to setFieldsBoost setDateResolution,&lt;br/&gt;
already available on the old QP and the new flexible query parser.&lt;/p&gt;

&lt;p&gt;I also want to say, that extending the old QP vs extending the &quot;New flexible Query Parser&quot; approaches&lt;br/&gt;
are never going to be similar, they completely different implementations.&lt;/p&gt;
</comment>
                    <comment id="12740659" author="yseeley@gmail.com" created="Fri, 7 Aug 2009 19:04:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s not reusable by other users (we can&apos;t commit your code to lucene)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Neither is your version with rangeTypes.put(&quot;money&quot;, RangeUtils.getType(RangeUtils.NUMERIC...&lt;br/&gt;
That&apos;s the application specific configuration code and doesn&apos;t need (or want) to be committed.&lt;/p&gt;

&lt;p&gt;Directly instantiating the query you want is simple, ultimately configurable, and avoids adding a ton of unnecessary classes or methods that need to be kept in sync with everything that a user &lt;b&gt;may&lt;/b&gt; want to do.&lt;/p&gt;

&lt;p&gt;Is there a simple way to provide a custom QueryBuilder for range queries (or any other query type?)  I&apos;m sure there must be, but there are so many classes in the new QP,  I&apos;m having a little difficulty finding my way around.&lt;/p&gt;</comment>
                    <comment id="12740662" author="lafa" created="Fri, 7 Aug 2009 19:17:40 +0100"  >&lt;blockquote&gt;
&lt;p&gt;What&apos;s the cleaner way to do this? EG could I make my own ParametricRangeQueryNodeProcessor, subclassing the current one in the &quot;standard.processors&quot; package, that overrides postProcessNode to do its own conversion?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For Yonik simple requirement, you could&lt;/p&gt;

&lt;p&gt;Option 1 (more flexible):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make your own ParametricRangeQueryNodeProcessor, subclassing the current, returning NumericQueryNodes where needed&lt;/li&gt;
	&lt;li&gt;create a NumericQueryNode that extends RangeQueryNode (node extra code needed)&lt;/li&gt;
	&lt;li&gt;create a NumericQueryNodeBuilder  that handles NumericQueryNodes, and set the map in  StandardQueryTreeBuilder, ex: setBuilder(NumericQueryNode.class, new NumericQueryNodeBuilder()),. RangeQueryNodes will still be normally handled by the RangeQueryNodeBuilder.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Option 2, (less flexible):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make your own RangeQueryNodeBuilder subclassing the current(ex: NumericQueryNodeBuilder) , set the map in StandardQueryTreeBuilder, ex: setBuilder(RangeQueryNode.class, new NumericQueryNodeBuilder())&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Option 1, implements the correct usage of the APIs. It&apos;s more flexible and &quot;dirty work&quot; is done in the processors pipeline.&lt;br/&gt;
Option 2, is not the correct use case for the APIs, requires less code and it will work, but the builder will be performing the tasks the Processor should be doing.&lt;/p&gt;</comment>
                    <comment id="12740718" author="lafa" created="Fri, 7 Aug 2009 21:41:03 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Neither is your version with rangeTypes.put(&quot;money&quot;, RangeUtils.getType(RangeUtils.NUMERIC...&lt;br/&gt;
That&apos;s the application specific configuration code and doesn&apos;t need (or want) to be committed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You are correct, I was describing the use case from the user perspective. &lt;br/&gt;
That code was a example how to use the API&apos;s if we implement them in the future, those API&apos;s are not currently available.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Directly instantiating the query you want is simple, ultimately configurable, and avoids adding a ton of unnecessary classes or methods that need to be kept in sync with everything that a user may want to do.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure what to say here. So I&apos;ll point to the documentation that we currently have:&lt;br/&gt;
You can read &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12410046/QueryParser_restructure_meetup_june2009_v2.pdf&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/secure/attachment/12410046/QueryParser_restructure_meetup_june2009_v2.pdf&lt;/a&gt;&lt;br/&gt;
and the java docs  for &lt;br/&gt;
package org.apache.lucene.queryParser.core &lt;br/&gt;
class org.apache.lucene.queryParser.standard.StandardQueryParser&lt;/p&gt;

&lt;p&gt;You can also look at TestSpanQueryParserSimpleSample junit for another example how the API&apos;s can be used,&lt;br/&gt;
in a completely different way.&lt;/p&gt;

&lt;p&gt;The new QueryParser was designed to be extensible,&lt;br/&gt;
allow the implementation of languages extensions or different languages,&lt;br/&gt;
and have reusable components like the processors and builders&lt;/p&gt;

&lt;p&gt;We use SyntaxParsers, Processors and Builders, all are replaceable components at runtime.&lt;br/&gt;
Any user can build it&apos;s own pipeline and create new processors, builders, querynodes and integrate them&lt;br/&gt;
with the existing ones to create the features they require. &lt;/p&gt;

&lt;p&gt;Some of the features are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Syntax Tree optimization&lt;/li&gt;
	&lt;li&gt;Syntax Tree expansion&lt;/li&gt;
	&lt;li&gt;Syntax Tree validation and error reporting&lt;/li&gt;
	&lt;li&gt;Tokenization and normalization of the query&lt;/li&gt;
	&lt;li&gt;Makes it easy to create extensions&lt;/li&gt;
	&lt;li&gt;Support for translation of error messages&lt;/li&gt;
	&lt;li&gt;Allows users to plug and play processors and builders, without having to modify lucene code.&lt;/li&gt;
	&lt;li&gt;Allow lucene users to implement features much faster&lt;/li&gt;
	&lt;li&gt;Allow users to change default behavior in a easy way without having to modify lucene code.&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;
&lt;p&gt;Is there a simple way to provide a custom QueryBuilder for range queries (or any other query type?) I&apos;m sure there must be, but there are so many classes in the new QP, I&apos;m having a little difficulty finding my way around.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Below is the java code for option 2. It&apos;s not the recomend way to use the new queryparser,&lt;br/&gt;
but is the shortest way to do what you want.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  class NumericQueryNodeBuilder &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RangeQueryNodeBuilder {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TermRangeQuery build(QueryNode queryNode) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; QueryNodeException {
    RangeQueryNode rangeNode = (RangeQueryNode) queryNode;
      
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rangeNode.getField().toString().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;money&quot;&lt;/span&gt;)) {
      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; whatever you need here with queryNode.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NumericRangeQuery(field,...)
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.build(queryNode);
      }
    }
  }
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNewRangeQueryBuilder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {    
    StandardQueryParser qp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardQueryParser();
    QueryTreeBuilder builder = (QueryTreeBuilder)qp.getQueryBuilder();
    builder.setBuilder(RangeQueryNode.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NumericQueryNodeBuilder());
    
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; startDate = getLocalizedDate(2002, 1, 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; endDate = getLocalizedDate(2002, 1, 4, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);    
    
    StandardAnalyzer oneStopAnalyzer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardAnalyzer();
    qp.setAnalyzer(oneStopAnalyzer);
    
    Query a = qp.parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;date:[&quot;&lt;/span&gt; + startDate + &lt;span class=&quot;code-quote&quot;&gt;&quot; TO &quot;&lt;/span&gt; + endDate + &lt;span class=&quot;code-quote&quot;&gt;&quot;]&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(a);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12740728" author="thetaphi" created="Fri, 7 Aug 2009 21:56:51 +0100"  >&lt;p&gt;To go back to the idea why I opened the issue (and I think, this is also Mike&apos;s intention):&lt;/p&gt;

&lt;p&gt;From what you see on java-user, where users asking questions about how to use Lucene:&lt;br/&gt;
Most users are not aware of the fact, that they can create Query classes themselves. Most examplecode on the list is just: &quot;I have such query string and I pass it to lucene and it does not work as exspected.&quot; It is hard to explain them, that they should simply not use a query parser for their queries and just instantiate the query classes directly. For such users it is even harder to customize this query parser.&lt;/p&gt;

&lt;p&gt;My intention behind is: Make the RangeQueryNodeBuilder somehow configureable like Luis proposed, that you can set the type of a field (what we do not have in Lucene currently). If the type is undefined or explicite set to &quot;string/term&quot;, create a TermRangeQuery. If it is set to any numeric type, create a NumericRangeQuery.newXxxRange(field,....).&lt;/p&gt;

&lt;p&gt;The same can currently be done by the original Lucene query parser, but only for dates (and it is really a hack using this DateField class). I simply want to extend it that you can say: &quot;this field is of type &apos;int&apos; and create automatically the correct range query for it.&quot; Because the old query parser is now &quot;deprecated&quot;, I want to do it for the new one. This would also be an intention for new users to throw away the old parser and use the new one, because it can be configured easily to create numeric ranges in addition to term ranges.&lt;/p&gt;</comment>
                    <comment id="12740861" author="mikemccand" created="Sat, 8 Aug 2009 10:44:31 +0100"  >&lt;p&gt;Given the complexity of customizing the new QueryParser, and given&lt;br/&gt;
that numeric fields will likely be commonly used, I think this is an&lt;br/&gt;
important issue.  I think we should try to have the new QueryParser&lt;br/&gt;
cleanly produce NumericRangeQuery, in 2.9.&lt;/p&gt;

&lt;p&gt;EG expecting a user to do &quot;option 1&quot; (the &quot;clean&quot;, more flexible&lt;br/&gt;
option) is a tall order.  Simple things should be simple...&lt;/p&gt;

&lt;p&gt;The proposed RangeTools seems like a good approach, and I like how it&lt;br/&gt;
cleanly absorbs the Date precisions that the old queryParser also&lt;br/&gt;
supports.&lt;/p&gt;

&lt;p&gt;But we better get cracking here since 2.9 is real close....!&lt;/p&gt;

&lt;p&gt;Here&apos;s one side-question, about back compat promises for the new&lt;br/&gt;
QueryParser: we are suggesting the users can start from all the&lt;br/&gt;
building blocks in StandardQueryParser, and override the processors,&lt;br/&gt;
create new nodes, builders, etc. with their own.  But this is&lt;br/&gt;
potentially dangerous, in that the next version of Lucene might change&lt;br/&gt;
things up such that your custom code doesn&apos;t work anymore?  It&apos;s alot&lt;br/&gt;
like a core class being subclassed externally, and then change to the&lt;br/&gt;
core class break those external subclasses.&lt;/p&gt;

&lt;p&gt;EG say we had not handled numerics for 2.9, and users go and do&lt;br/&gt;
&quot;option 2&quot; (the quick &amp;amp; dirty, but simplest, way to get&lt;br/&gt;
NumericRangeQueries out).  Then, say in 3.1 we implement the proposed&lt;br/&gt;
fix here (&quot;option 1&quot;).  Suddenly, we&apos;ve altered what nodes come out of&lt;br/&gt;
the processor pipeline, because we&apos;ve created a new NumericRangeQuery&lt;br/&gt;
node, and so the builders that users had added, for the RangeQuery&lt;br/&gt;
node, will no loner be invoked.  How are we going to handle&lt;br/&gt;
back-compat here?&lt;/p&gt;</comment>
                    <comment id="12741432" author="markrmiller@gmail.com" created="Mon, 10 Aug 2009 18:27:33 +0100"  >&lt;p&gt;Personally, I don&apos;t think we should deprecate the standard QueryParser yet - and the new one should carry no back compat policy. It needs to be flushed out in a release before we tell users to move to it IMO. Not enough Committers have enough experience with it to promise back compat at this point I think.&lt;/p&gt;</comment>
                    <comment id="12742223" author="adriano_crestani" created="Wed, 12 Aug 2009 06:19:33 +0100"  >&lt;blockquote&gt;
&lt;p&gt;The proposed RangeTools seems like a good approach, and I like how it&lt;br/&gt;
cleanly absorbs the Date precisions that the old queryParser also&lt;br/&gt;
supports.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You meant DateTools, right?! I don&apos;t see so much difference to use this same approach over the &quot;option1&quot;. You have a map based from field name to the DateTools.Resolution used for that field. Which is the same feature we want to implement on this JIRA, something you could configure how you are going to resolve the value defined on a range query based on the field name. The only difference is that we are expanding the options the user will have to resolve the values: RangeUtils.NUMERIC, RangeUtils.DATE, RangeUtils.FLOAT, etc...let me know if I missed or missunderstood something on this part.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Here&apos;s one side-question, about back compat promises for the new&lt;br/&gt;
QueryParser: we are suggesting the users can start from all the&lt;br/&gt;
building blocks in StandardQueryParser, and override the processors,&lt;br/&gt;
create new nodes, builders, etc. with their own. But this is&lt;br/&gt;
potentially dangerous, in that the next version of Lucene might change&lt;br/&gt;
things up such that your custom code doesn&apos;t work anymore? It&apos;s alot&lt;br/&gt;
like a core class being subclassed externally, and then change to the&lt;br/&gt;
core class break those external subclasses.&lt;/p&gt;

&lt;p&gt;EG say we had not handled numerics for 2.9, and users go and do&lt;br/&gt;
&quot;option 2&quot; (the quick &amp;amp; dirty, but simplest, way to get&lt;br/&gt;
NumericRangeQueries out). Then, say in 3.1 we implement the proposed&lt;br/&gt;
fix here (&quot;option 1&quot;). Suddenly, we&apos;ve altered what nodes come out of&lt;br/&gt;
the processor pipeline, because we&apos;ve created a new NumericRangeQuery&lt;br/&gt;
node, and so the builders that users had added, for the RangeQuery&lt;br/&gt;
node, will no loner be invoked. How are we going to handle&lt;br/&gt;
back-compat here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s already happening with the &quot;old&quot; QP. It used to output RangeQuery objects and now it outputs TermRangeQuery objects. How is it going to be handled buy users expecting RangeQuery objects?&lt;/p&gt;

&lt;p&gt;The &quot;new&quot; QP builder, delegates a query node based on its class to a builder, if there is no builder that knows how to build an object from that class it keeps looking up in the class hierarchy until it finds a builder that knows how to. Query nodes are supposed to be conceptual objects, they just represent some concept X, and ideally anything that fits in this concept should inherit from it, this way the user can create their own specific query nodes with no need to change how they are built (if there is no need for that). What I&apos;m trying to say here is that if I create a node Y which extends X, I don&apos;t need to specify a new YBuilder for it, the XBuilder will be used. So, ideally, NumericRangeQueryNode should extends RangeQueryNode, the problem here is that we also need to specify a builder for the NumericRangeNode, and if the user sets a builder for RangeNode it will never be invoked for NumericRangeNode objects. Maybe it shouldn&apos;t at all, because if a new builder was specified for NumericRangeNode, it means a new kind of object should be built from it, something the user probably don&apos;t know yet, since it&apos;s a new kind of node, and his custom code needs to be updated anyway to support it.&lt;/p&gt;

&lt;p&gt;Howerver, there is a solution for this kind of back-compat problem (which I don&apos;t think it is). In a future release, if a new XRangeQueryNode is created, instead of set&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 luceneBuilderMap.setBuilder(RangeQueryNode.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RangeQueryNodeBuilder());
luceneBuilderMap.setBuilder(XRangeQueryNode.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XRangeQueryNodeBuilder());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
rangeBuilderMap.setBuilder(RangeQueryNode.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RangeQueryNodeBuilder());
rangeBuilderMap.setBuilder(XRangeQueryNode.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XRangeQueryNodeBuilder());

&lt;span class=&quot;code-comment&quot;&gt;// then
&lt;/span&gt;
luceneBuilderMap.setBuilder(RangeQueryNode.class, rangeBuilderMap);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This way, if the user reset the RangeQueryNode builder to its own builder, it will still be called for XRangeQueryNode and RangeQueryNode objects.&lt;/p&gt;

&lt;p&gt;Let me know if there is any question about what I just described. &lt;/p&gt;</comment>
                    <comment id="12742232" author="thetaphi" created="Wed, 12 Aug 2009 07:21:04 +0100"  >&lt;p&gt;I would propose to absorb the RangeTools/Utils and DateTools/Utils (ehat is the correct name???) in one configuration class (just a bigger enumeration with a good name, not &lt;b&gt;Utils/&lt;/b&gt;.Tools. e.g. RangeQueryDataType). By that you can define simply the type of a range query: term, numeric-int, numeric-float, numeric-double, date-precision-xxx,... Based on this enumeration, the upper/lower terms are parsed differently and different query objects are created. We just need to list all possible combinations of data types, the user could create: We could make this class extensible, if it is a Lucene Parameter class also supporting the parsing and building: One could simply create a new constant for his specific range type and supply methods to parse and build the query in the constant&apos;s implementation (so each constant contains also code to parse/build). I am not sure how to do this with the new parser. I think of the same like the MTQRewriteMethod (final static singletons in MTQ that do the rewrite and can be passed as parameter).&lt;/p&gt;

&lt;p&gt;Maybe we can use this also to upgrade the old query parser if it gets not deprecated.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think it&apos;s already happening with the &quot;old&quot; QP. It used to output RangeQuery objects and now it outputs TermRangeQuery objects. How is it going to be handled buy users expecting RangeQuery objects?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking about that, too. But here the API clearly defines, that getRangeQuery() returns a Query object without further specification. So the change was correct from the API/BW side. The change that another object is returned is documented in CHANGES.txt (as far as I know). We have here the same problem: You change the inner class implementations, but the abstract QueryParser&apos;s API is stable. The general contract when doing such things is, that you use instanceof checks before you try to cast some abstract return type to something specific, not documented.&lt;/p&gt;

&lt;p&gt;You have the same in various factories also in the very bw-oriented JDK: XML factories create things like SAXParser and so on. If you cast the returned objects to some special implementation class, its your problem, because you remove the abstraction and work with implementations. This happened e.g. from the change between Java 1.4 to 1.5, when the internal SAX parsers were exchanged and their class names changed. A lot of programs broke by that, because the developers casted the objects returned from factories without instanceof checks.&lt;/p&gt;</comment>
                    <comment id="12742308" author="mikemccand" created="Wed, 12 Aug 2009 13:08:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;I would propose to absorb the RangeTools/Utils and DateTools/Utils (ehat is the correct name???) in one configuration class &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Howerver, there is a solution for this kind of back-compat problem (which I don&apos;t think it is).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, on reading your explanation I agree it&apos;s not really a back compat break, since the user&apos;s custom builder for RangeQueryNode would still be invoked, and the core&apos;s builder for NumericRangeQuery would handle the newly added numeric range support.  I think this is reasonable.&lt;/p&gt;</comment>
                    <comment id="12742458" author="adriano_crestani" created="Wed, 12 Aug 2009 18:15:37 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I would propose to absorb the RangeTools/Utils and DateTools/Utils (ehat is the correct name???) in one configuration class &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 this way is easier for the user to config &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I was thinking about that, too. But here the API clearly defines, that getRangeQuery() returns a Query object without further specification. So the change was correct from the API/BW side. The change that another object is returned is documented in CHANGES.txt (as far as I know). We have here the same problem: You change the inner class implementations, but the abstract QueryParser&apos;s API is stable. The general contract when doing such things is, that you use instanceof checks before you try to cast some abstract return type to something specific, not documented.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, I also think it&apos;s fine as long as it&apos;s documented&lt;/p&gt;</comment>
                    <comment id="12743334" author="lafa" created="Fri, 14 Aug 2009 19:14:39 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I would propose to absorb the RangeTools/Utils and DateTools/Utils (ehat is the correct name???) in one configuration class &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I am not sure how to do this with the new parser. I think of the same like the MTQRewriteMethod (final static singletons in MTQ that do the rewrite and can be passed as parameter). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we probably should have TermRangeQueryNode a NumericRangeQueryNode and 2 builders classes that match that, change ParametricRangeQueryNodeProcessor to do the dirty work and create the new TermRangeQueryNode and NumericRangeQueryNode in the correct places, based on the a map with &lt;span class=&quot;error&quot;&gt;&amp;#91;field name,RangeTools.TYPE&amp;#93;&lt;/span&gt; or something similar.&lt;br/&gt;
The builders should simple and just convert each type to the correct Lucene Object.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we should rename RangeQueryNode to TermRangeQueryNode (to match lucene name)&lt;/li&gt;
	&lt;li&gt;create the new NumericRangeQueryNode that extends from TermRangeQueryNode&lt;/li&gt;
	&lt;li&gt;change the ParametricRangeQueryNodeProcessor to read the configuration passed by the user and create the correct QueryNode objects.&lt;/li&gt;
	&lt;li&gt;create a new NumericRangeQueryNodeBuilder add it to the StandardQueryTreeBuilder mapping.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I hope this helps&lt;/p&gt;</comment>
                    <comment id="12743349" author="yseeley@gmail.com" created="Fri, 14 Aug 2009 19:33:18 +0100"  >&lt;p&gt;If the existing query parser is not being deprecated, should this issue be pushed out to 3.0 or 3.1 to give it more time?  In the meantime, people can use the existing override getRangeQuery() method.  2.9 is looking really close.&lt;/p&gt;</comment>
                    <comment id="12744347" author="markrmiller@gmail.com" created="Tue, 18 Aug 2009 04:33:03 +0100"  >&lt;p&gt;Finally read through this whole issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If the existing query parser is not being deprecated, should this issue be pushed out to 3.0 or 3.1 to give it more time? In the meantime, people can use the existing override getRangeQuery() method. 2.9 is looking really close.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 on pushing this. getRangeQuery() will still be first class.&lt;/p&gt;

&lt;p&gt;It does seem like we should at least do this though:&lt;/p&gt;

&lt;p&gt;we should rename RangeQueryNode to TermRangeQueryNode (to match lucene name)&lt;/p&gt;</comment>
                    <comment id="12744374" author="lafa" created="Tue, 18 Aug 2009 06:41:27 +0100"  >&lt;blockquote&gt;
&lt;p&gt;If the existing query parser is not being deprecated, should this issue be pushed out to 3.0 or 3.1 to give it more time? In the meantime, people can use the existing override getRangeQuery() method. 2.9 is looking really close.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 &lt;/p&gt;</comment>
                    <comment id="12744383" author="thetaphi" created="Tue, 18 Aug 2009 07:14:15 +0100"  >&lt;blockquote&gt;&lt;p&gt;we should rename RangeQueryNode to TermRangeQueryNode (to match lucene name)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would not do this. RangeQueryNode is in the syntax tree and the syntax of numeric and term ranges is equal, so the query parser cannot know what type of query it is. When this issue is fixed 3.1, this node will use the configuration of data types for  field names (date, numeric, term) to create the correct range query.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+1 on pushing this. getRangeQuery() will still be first class.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As noted in my comment on java-dev: We should add a comment in Javadocs, that the old (and also new) query parser do not work automatically with NumericRangeQuery, and that you should override getRangeQuery() and do a case-switch on the field name. I will do this later this day.&lt;/p&gt;</comment>
                    <comment id="12745236" author="adriano_crestani" created="Thu, 20 Aug 2009 00:03:33 +0100"  >&lt;blockquote&gt;
&lt;p&gt;    we should rename RangeQueryNode to TermRangeQueryNode (to match lucene name)&lt;/p&gt;

&lt;p&gt;I would not do this. RangeQueryNode is in the syntax tree and the syntax of numeric and term ranges is equal, so the query parser cannot know what type of query it is. When this issue is fixed 3.1, this node will use the configuration of data types for field names (date, numeric, term) to create the correct range query.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s ok to rename, as far as I know, the standard.parser.SyntaxParser generates ParametricRangeQueryNode from a range query, which has 2 ParametricQueryNode as child. So, the range processor, will need to convert the 2 ParametricQueryNode to the respective type, based on the user config: TermRangeQueryNode (renamed from RangeQueryNode) or NumericRangeQueryNode.&lt;/p&gt;</comment>
                    <comment id="13009522" author="adriano_crestani" created="Tue, 22 Mar 2011 02:38:19 +0000"  >&lt;p&gt;I think this is also a good candidate for GSoC 2011. I will add the labels to it.&lt;/p&gt;

&lt;p&gt;Any comments?&lt;/p&gt;</comment>
                    <comment id="13011007" author="adriano_crestani" created="Thu, 24 Mar 2011 23:32:24 +0000"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;Are you willing to mentor this project on GSoC? If you are, I will keep it assigned to you, otherwise let me know so I assign it to me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13011011" author="thetaphi" created="Thu, 24 Mar 2011 23:35:51 +0000"  >&lt;p&gt;I can help!&lt;/p&gt;</comment>
                    <comment id="13011914" author="viniciusbarros" created="Mon, 28 Mar 2011 06:06:51 +0100"  >&lt;p&gt;Hi Uwe and Adriano, &lt;/p&gt;

&lt;p&gt;I read the description, javadocs about the numeric support and the new query parser and all the comments here. Let me try to summarize what needs to be done here:&lt;/p&gt;

&lt;p&gt;&lt;del&gt;figure out a way to configure in query parser which fields are numeric, and for each of these fields, the numeric type must also be defined...from the comments, it seems the best way to do this is using a map field&lt;/del&gt;&amp;gt;NumericType&lt;/p&gt;

&lt;p&gt;-create a NumericQueryNodeProcessor that converts ParametricRangeQueryNode to NumericRangeQueryNode, when its field is a numeric field. This processor should also convert the range string values to numeric values based on the NumericType&lt;/p&gt;

&lt;p&gt;-create a NumericRangeQueryNodeBuilder, which will build which will build NumericRangeQuery objects from NumericRangeQueryNode objects&lt;/p&gt;

&lt;p&gt;-rename RangeQueryNode to TermRangeQueryNode as it will only be used for string&lt;/p&gt;

&lt;p&gt;-create a NumericRangeQueryNode which will be used for any non-string range query&lt;/p&gt;

&lt;p&gt;-merge DateTools with a new NumericTools class. Does that make sense? I am not sure if I got everything correctly here.&lt;/p&gt;

&lt;p&gt;Some questions below:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Luis:&lt;br/&gt;
create the new NumericRangeQueryNode that extends from TermRangeQueryNode&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-should NumericRangeQueryNode extends TermRangeQueryNode? I don&apos;t see any reason for that, since one will hold Number values and the other String values&lt;/p&gt;

&lt;p&gt;-I remember the old date query, using strings, used to not only allow range queries, but also term queries (date:2010/10/10), is that correct? Does numeric fields also support this kind of query? I could only fine NumericRangeQuery, but no NumericQuery. If the user enters (age:19) in the query, and &quot;age&quot; is a numeric field, should the query parser throw an error saying it&apos;s not suppported?&lt;/p&gt;

&lt;p&gt;I am planning to create a GSOC proposal for this project, it looks interesting, very cool this new support to numeric in Lucene, I missed that first time I used Lucene, maybe because I was used to regular databases. Also, the query parser uses some design patterns I have been reading about lately, as builders and processors. &lt;/p&gt;</comment>
                    <comment id="13012314" author="adriano_crestani" created="Tue, 29 Mar 2011 02:50:18 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;Nice summary! There is a formatting problem, but I think people can understand it.&lt;/p&gt;

&lt;p&gt;I had to re-read all the comments, it took sometime, it seems you got all the main points in the summary.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;-should NumericRangeQueryNode extends TermRangeQueryNode? I don&apos;t see any reason for that, since one will hold Number values and the other String values&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right, it does not make sense to one extend the other. However, I think they should have a common parent (e.g. &amp;lt;interface&amp;gt; RangeQueryNode), that will have common methods like QueryNode getLowRange().&lt;/p&gt;

&lt;p&gt;I will let Uwe answer the other questions, I am curious to know the answers too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The student proposal period has started, so go ahead and start drafting it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13012352" author="thetaphi" created="Tue, 29 Mar 2011 07:41:16 +0100"  >&lt;blockquote&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I remember the old date query, using strings, used to not only allow range queries, but also term queries (date:2010/10/10), is that correct? Does numeric fields also support this kind of query? I could only fine NumericRangeQuery, but no NumericQuery. If the user enters (age:19) in the query, and &quot;age&quot; is a numeric field, should the query parser throw an error saying it&apos;s not suppported?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;To create something like a NumericQuery (age:19), the correct and most performant way is to use a NumericRangeQuery with (includeLower==includeUpper)==true and (lower==upper)==value. This query is since Lucene 2.9 always rewritten in the most optimal way (internally it uses a ConstantScore TermQuery using the prefix encoded term. This should also be noted in JavaDocs?&lt;/p&gt;

&lt;p&gt;This is also how Solr&apos;s QP works.&lt;/p&gt;</comment>
                    <comment id="13012353" author="thetaphi" created="Tue, 29 Mar 2011 07:44:28 +0100"  >&lt;blockquote&gt;
&lt;p&gt;-merge DateTools with a new NumericTools class. Does that make sense? I am not sure if I got everything correctly here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you mean Lucene&apos;Core&apos;s org.apache.lucene.document.DateTools? Because this class is somehow deprecated (not officially) but all those tool classes should not be used together with NRQ. Or does the new QP has its own tools classes?&lt;/p&gt;</comment>
                    <comment id="13015147" author="ntankovic" created="Sun, 3 Apr 2011 14:29:47 +0100"  >&lt;p&gt;Hi folks, &lt;/p&gt;

&lt;p&gt;I&apos;m PhD student from Croatia willing to participate in GSoC this year. I work in Croatian firm called Superius Ltd on software modelling based on graph database (Neo4J to be concrete). This issue here sounds like a nice addition to Lucene that would help us also make queries that are needed over our business data contained in graph (indexed by Lucene). I was wondering whether is this project still open for GSoC or already assigned to someone?&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    <comment id="13015260" author="viniciusbarros" created="Mon, 4 Apr 2011 03:54:29 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thanks Uwe and Adriano,&lt;/p&gt;

&lt;p&gt;I finally finished and submitted my proposal to this project, please, take a look and tell me if I need to change something. My linkid is viniciusbarros&lt;/p&gt;

&lt;p&gt;Sorry for taking so long to submit it, but just got a free time this weekend, college stuffs are keeping me busy.&lt;/p&gt;

&lt;p&gt;Uwe: I added to my proposal the idea of enabling the user to enter a query that searches for a single numeric value, example, age:19.&lt;/p&gt;

&lt;p&gt;About DateTools, I think this can be decided later, in the end it&apos;s just a class with some format options the user may choose. Anyway, the numeric already have a pre-defined form to format number in strings before indexing right?! Take a look to what I have defined in my proposal, where I allow the user to specify a Format object, which is used by the query parser to parse the string value entered by the user to Number. Please, let me know if I am not getting something here.&lt;/p&gt;</comment>
                    <comment id="13015712" author="adriano_crestani" created="Tue, 5 Apr 2011 02:45:12 +0100"  >&lt;p&gt;Hi Nikola,&lt;/p&gt;

&lt;p&gt;That&apos;s great you are interested in submit a proposal for gsoc this year. Proposal submissions are still open until next 8th (check GSOC timeline at the website). It means you can submit a proposal to any project or even suggest your own project (in this case the community will need to accept it as a gsoc project).&lt;/p&gt;

&lt;p&gt;There is already a proposal for this project, but feel free to submit another one. To raise your chances of getting into gsoc this year, I would suggest you to apply to a project with no candidates yet, check the Lucene projects here: &lt;a href=&quot;https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&amp;amp;jqlQuery=labels+%3D+lucene-gsoc-11&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&amp;amp;jqlQuery=labels+%3D+lucene-gsoc-11&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Good luck! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13015714" author="adriano_crestani" created="Tue, 5 Apr 2011 02:51:28 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;Your proposal looks good, details everything you intend to do and the proposed solutions looks good to me, include what the community has previously discussed.&lt;/p&gt;

&lt;p&gt;+1 for adding support for simple numeric queries as age:19 &lt;/p&gt;

&lt;p&gt;One thing I would suggest you to change is to make it clearer the query parser you are intending to change is the contrib query parser, to be more specific the standard implementation. You just mention it only once in the entire proposal!&lt;/p&gt;</comment>
                    <comment id="13016653" author="viniciusbarros" created="Thu, 7 Apr 2011 03:05:27 +0100"  >&lt;p&gt;Thanks for reviewing it Adriano. I updated the proposal to clarify it&apos;s the contrib query parser.&lt;/p&gt;</comment>
                    <comment id="13040979" author="viniciusbarros" created="Mon, 30 May 2011 03:58:16 +0100"  >&lt;p&gt;This patch includes the work I did this first week. I started with one of the project&apos;s objective: restructure RangeQueryNode and its related classes to support number and text range queries.&lt;/p&gt;

&lt;p&gt;I created some querynode interfaces, such as ValueQueryNode that abstract the value a leaf node may hold, since now, leaf nodes do not only hold text anymore, but also number values.&lt;/p&gt;

&lt;p&gt;Let me know if you have any questions or any suggestions about the code.&lt;/p&gt;

&lt;p&gt;I expect I created the patch correctly, as it&apos;s the first time I play with subversion&lt;/p&gt;</comment>
                    <comment id="13041823" author="thetaphi" created="Tue, 31 May 2011 21:51:14 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;thanks for your update! The patch looks correct, I assume it&apos;s for Lucene trunk? You should  produce them against the top-level directory (below trunk/), not the lucene sub-directory (since Lucene was merged with Solr last year).&lt;/p&gt;

&lt;p&gt;I have not closely looked at the code (came back from California recently), but your refactoring as a first step looks fine. I would only suggest to never depend on the default locale (Robert Muir will tell you the same thing), so it should respect the local given to query parser.&lt;/p&gt;

&lt;p&gt;I will report back, when I had time to look into it, but it looks really fine - also from the Generics Policeman Point of View &lt;b&gt;g&lt;/b&gt;&lt;/p&gt;</comment>
                    <comment id="13041961" author="viniciusbarros" created="Wed, 1 Jun 2011 04:27:21 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;Thanks for quickly reviewing the patch. Yes, I am using trunk&apos;s code. I will do the changes you suggested and include in the next patch.&lt;/p&gt;</comment>
                    <comment id="13044622" author="viniciusbarros" created="Sun, 5 Jun 2011 22:39:56 +0100"  >&lt;p&gt;This is the patch for my second week of work.&lt;/p&gt;</comment>
                    <comment id="13044624" author="viniciusbarros" created="Sun, 5 Jun 2011 22:46:45 +0100"  >&lt;p&gt;The second patch includes the week1 changes plus: implemented classes to support numeric configuration in query parser&lt;/p&gt;

&lt;p&gt;I was not sure what to do about the locale. The locale is required by EscapeQuerySyntax.escape, which seems to escape characters so they don&apos;t mix with query parser&apos;s operators. The code I used locale I copied from FieldQueryNode, which uses the escaper and passes the default locale, however, other nodes as RegexpQueryNode ignore the escaper and just return the plain text. I was not sure what to do, then I am forcing the locale to ENGLISH now.&lt;/p&gt;

&lt;p&gt;I also took a long time to figure out how to implement the numeric configuration, it seemed to me the best approach was to copy the way FieldBoostAttribute is configured. It&apos;s complex, but it&apos;s the only way I found without doing any ugly workaround.&lt;/p&gt;

&lt;p&gt;Please, take a look at the code and give me some suggestions in case you thing I need to change something.&lt;/p&gt;

&lt;p&gt;PS: the patch is now created from the trunk folder, as Uwe suggested&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    <comment id="13044625" author="viniciusbarros" created="Sun, 5 Jun 2011 22:47:14 +0100"  >&lt;p&gt;ah, one more thing. Uwe, what is &quot;Generics Policeman Point of View&quot;?&lt;/p&gt;</comment>
                    <comment id="13044627" author="thetaphi" created="Sun, 5 Jun 2011 22:52:38 +0100"  >&lt;blockquote&gt;&lt;p&gt;ah, one more thing. Uwe, what is &quot;Generics Policeman Point of View&quot;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s just my nickname, because I always watch correct usage of Java 5 Generics &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I just wanted to confirm, that your generification of some classes looked fine.&lt;/p&gt;

&lt;p&gt;I will revisit your patch tomorrow together with others here at BerlinBuzzword (a conference about Lucene and other NoSQL related stuff).&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                    <comment id="13044642" author="adriano_crestani" created="Sun, 5 Jun 2011 23:44:58 +0100"  >&lt;p&gt;Vinicius: you are right, contrib QP configuration is very complicated, that&apos;s why Phillip is working on another GSOC project to make it simpler. So don&apos;t worry much about the best way to use the config API, since it will change, just make it work for now using the old API &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. You have a good point when you mentioned the escaper problem with Locale. I should think more about it...&lt;/p&gt;

&lt;p&gt;Uwe: Are you intending to commit the patch only at the end of gsoc? Just wondering, since Vinicius is not selecting the ASF checkbox when submitting the patch, which means the current patches will not be able to be committed.&lt;/p&gt;</comment>
                    <comment id="13047291" author="thetaphi" created="Fri, 10 Jun 2011 18:02:39 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;if you want the code be committed later, you should check the license box (&quot;Grant license to ASF for inclusion in ASF works (as per the Apache License &#167;5)&quot;), else we will be not able to submit it to the main repository.&lt;/p&gt;

&lt;p&gt;If you want us to commit the patch only at the end of GSOC, it&apos;s enough to check this box in your final submission, but it should be noted, that we may submit minor parts of the work even before (once you are at a state where it is &apos;useable&apos; and passes existing tests). A second commit could e.g. adding sophisticated tests, and so on.&lt;/p&gt;</comment>
                    <comment id="13047315" author="thetaphi" created="Fri, 10 Jun 2011 18:41:30 +0100"  >&lt;p&gt;One small thing I have seen after applying your patch:&lt;br/&gt;
The code guidelines of Lucene require no TABS but two whitespace to indent. We have a code style available for Eclipse and IDEA in the dev-tools folder (below trunk). You only have to install it.&lt;/p&gt;

&lt;p&gt;Also you are using Java 6 interface overrides, so the code does not compile with Java 5 (unfortunately this is a bug in Java 6&apos;s javac, as it does not complain when in &quot;-source 1.5&quot; mode). In Java 5 compatible code it is not allowed to add @Override to methods implemented for interfaces:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;common.compile-core:
    [mkdir] Created dir: C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\build\contrib\queryparser\classes\java
    [javac] Compiling 175 source files to C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\build\contrib\queryparser\classes\java
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\core\nodes\FieldQueryNode.java:182: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\core\nodes\FieldQueryNode.java:187: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\config\NumericFieldConfigListener.java:21: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\AbstractRangeQueryNode.java:17: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\AbstractRangeQueryNode.java:32: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\AbstractRangeQueryNode.java:79: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\NumericQueryNode.java:20: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\NumericQueryNode.java:25: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\NumericQueryNode.java:35: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\NumericQueryNode.java:52: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\nodes\NumericQueryNode.java:57: method does not override a method from its superclass
    [javac]     @Override
    [javac]          ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\standard\parser\JavaCharStream.java:367: warning: [dep-ann] deprecated name isnt annotated with @Deprecated
    [javac]   public int getEndColumn() {
    [javac]              ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\surround\parser\CharStream.java:34: warning: [dep-ann] deprecated name isnt annotated with @Deprecated
    [javac]   int getColumn();
    [javac]       ^
    [javac] C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\lucene\contrib\queryparser\src\java\org\apache\lucene\queryParser\surround\parser\CharStream.java:41: warning: [dep-ann] deprecated name isnt annotated with @Deprecated
    [javac]   int getLine();
    [javac]       ^
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation for details.
    [javac] 11 errors
    [javac] 3 warnings
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With Java 6 the code compiles, but some tests fail to work. I assume its simply because of the work-in-progress,&lt;/p&gt;</comment>
                    <comment id="13047788" author="viniciusbarros" created="Sat, 11 Jun 2011 00:55:11 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;Thanks for reviewing the patch again. I will fix the problems you mentioned.&lt;/p&gt;

&lt;p&gt;I do not think the code is ready to be committed, I am just sending the patches so you can keep track of my progress. I hope to have something useable soon, then you can commit, probably before the end of gsoc.&lt;/p&gt;</comment>
                    <comment id="13048249" author="adriano_crestani" created="Sun, 12 Jun 2011 06:54:48 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;Assuming you are using eclipse, you can find the codestyle used to create lucene code at the bottom of this page: &lt;a href=&quot;http://wiki.apache.org/lucene-java/HowToContribute&quot; class=&quot;external-link&quot;&gt;http://wiki.apache.org/lucene-java/HowToContribute&lt;/a&gt;, it will fix the identation problem Uwe mentioned.&lt;/p&gt;

&lt;p&gt;After reviewing the code, I want to remember you that all files must have the ASF header. Take a look at the other Java classes in Lucene repository so you can have an example.&lt;/p&gt;

&lt;p&gt;The way you are organizing the code looks good to me, just make sure whenever you add a new class to contrib query parser, place it under the right package. &quot;core&quot;, if the class is generic and might be used by other queryparser implemenations; &quot;standard&quot;, if the class is specific to lucene standard query parser implementation.&lt;/p&gt;</comment>
                    <comment id="13048253" author="adriano_crestani" created="Sun, 12 Jun 2011 07:27:25 +0100"  >&lt;p&gt;One more thing I forgot to mention, when creating new QueryNodes, try to enforce the user when using the constructor to pass the required arguments. For example: NumericQueryNode does not have any constructor, I would suggest you to change it to NumericQueryNode(CharSequence field, Number number, NumberFormat format).&lt;/p&gt;

</comment>
                    <comment id="13048463" author="viniciusbarros" created="Mon, 13 Jun 2011 05:05:09 +0100"  >&lt;p&gt;This patch includes:&lt;/p&gt;

&lt;p&gt;-changes suggested by Adriano and Uwe:&lt;br/&gt;
  -remvoed @Override&lt;br/&gt;
  -applied Lucene codestyle&lt;br/&gt;
  -created constructor to NumericQueryNode&lt;br/&gt;
  -added ASF header to new classes&lt;br/&gt;
  -Implemented new NumericQueryNodeProcessor and NumericRangeQueryNodeProcessor&lt;/p&gt;</comment>
                    <comment id="13052288" author="viniciusbarros" created="Tue, 21 Jun 2011 01:22:53 +0100"  >&lt;p&gt;This patch includes the builder for numeric range queries. This week I intend to start writing junits.&lt;/p&gt;</comment>
                    <comment id="13059163" author="viniciusbarros" created="Sun, 3 Jul 2011 06:54:16 +0100"  >&lt;p&gt;This patch includes code from week 5 and 6. Sorry for taking so long to submit a new patch, but I was hitting many problems when I finally started run the junits.&lt;/p&gt;

&lt;p&gt;I updated my workspace and got the new changes which use NumericField to add numeric fields to Documents. So I adapted my junits to that and also refactored some code to use NumericField.DataType in NumericConfig, instead of using Class&amp;lt;? extends Number&amp;gt; when specifying the NumericConfig type.&lt;/p&gt;

&lt;p&gt;I added a junit class (TestNumericQueryParser). I reused some LuceneTestCase methods, mainly the ones that generate random things. I took sometime to get where I wanted, I was hitting many problems when using dates in range. In the end, I liked the way the junit is running, inputs are very random, mainly the date formats, using randomly different format styles and locale. I ran the junit in a loop 1000 times and I got no error, so I think it&apos;s pretty stable now. Uwe, please, take a look and let me know what you think about it.&lt;/p&gt;

&lt;p&gt;testInclusiveLowerRangeQuery and testInclusiveUpperRangeQuery are commented since I found that StandardQueryParser is not supporting mixed include syntaxes, such as {1 TO 2]. Shouldn&apos;t it be supported? I don&apos;t see why not.&lt;/p&gt;

&lt;p&gt;Also, the query parser is not supporting open ended range queries, such as &lt;span class=&quot;error&quot;&gt;&amp;#91;... to 3&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I am checking &quot;Grant license to ASF for inclusion in ASF works (as per the Apache License &#167;5)&quot; now, because I think the patch is finally ready to be checked in. I ran Lucene top level ant and it finished successfully.&lt;/p&gt;

&lt;p&gt;I will work on creating javadocs now.&lt;/p&gt;</comment>
                    <comment id="13059275" author="adriano_crestani" created="Sun, 3 Jul 2011 21:28:49 +0100"  >&lt;p&gt;testInclusiveLowerRangeQuery and testInclusiveUpperRangeQuery are commented since I found that StandardQueryParser is not supporting mixed include syntaxes, such as {1 TO 2]. Shouldn&apos;t it be supported? I don&apos;t see why not.&lt;/p&gt;

&lt;p&gt;I will take a look into it, thanks for reporting it, this might really be a bug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13059653" author="adriano_crestani" created="Tue, 5 Jul 2011 02:06:08 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I committed the first patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2979&quot; title=&quot;Simplify configuration API of contrib Query Parser&quot;&gt;&lt;del&gt;LUCENE-2979&lt;/del&gt;&lt;/a&gt; and it changed completely the queryparser config API. &lt;/p&gt;

&lt;p&gt;It seems Vinicius is ahead of schedule with this project, is that corret?! Is there anything else to do after documentation? If not, I would ask whether it&apos;s possible for you to change the way you use config API for numeric. I think it will not require a lot of change, the api is much simpler now. I can ask Phillipe to help you and explain how the new api works &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Otherwise, Uwe will not be able to commit your patch, since there will be many classes missing now.&lt;/p&gt;

&lt;p&gt;What do you think Uwe?&lt;/p&gt;</comment>
                    <comment id="13059707" author="thetaphi" created="Tue, 5 Jul 2011 08:54:01 +0100"  >&lt;p&gt;Hi Adriano,&lt;/p&gt;

&lt;p&gt;I will also review the patch today (using older trunk rev) and then respond.&lt;/p&gt;

&lt;p&gt;I think, Vinicius should help with updating the code to the latest config API version which was committed. This is where &quot;community&quot; in this project gets involved. Maybe the other GSoC student and Vinicius should work together to get this solved.&lt;/p&gt;

&lt;p&gt;Next week the mid-term evaluations will come, so we should have something to work on this issue except documentation for the second half.&lt;/p&gt;</comment>
                    <comment id="13060168" author="thetaphi" created="Tue, 5 Jul 2011 23:21:23 +0100"  >&lt;p&gt;I downgraded my trunk checkout to rev. 1142861 and applied the patch. All tests pass, so nice work until now. The problem is that I am no longer able to commit the patch, as rev. 1142862 was committed before, changing the QP config API, so how to proceed?&lt;/p&gt;

&lt;p&gt;Vinicius, how do you want to proceed, are you planning to rewrite the stuff related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2979&quot; title=&quot;Simplify configuration API of contrib Query Parser&quot;&gt;&lt;del&gt;LUCENE-2979&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    <comment id="13060176" author="viniciusbarros" created="Tue, 5 Jul 2011 23:41:24 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;I talked to Phillipe about the new API, it does not look complicated. I will try to do the change and submit a new patch by the end of this week, then we can finally have something checked in \o/&lt;/p&gt;

&lt;p&gt;Next things do to then:&lt;br/&gt;
-fix config&lt;br/&gt;
-write javadocs&lt;br/&gt;
-write wiki/tutorial explaining how to use query parser with numeric fields&lt;/p&gt;

&lt;p&gt;Something else you have in mind Uwe that we can add to the above list? Maybe fix the range query in contrib queryparser which I mentioned in my past comments above. (Have you verified the bug Adriano?)&lt;/p&gt;</comment>
                    <comment id="13060180" author="thetaphi" created="Tue, 5 Jul 2011 23:48:55 +0100"  >&lt;p&gt;I think the &quot;bug&quot; in Contrib QP is there because it&apos;s also a bug in Lucene&apos;s Core QP (the default impl just emulates core&apos;s QP). But in my opinion, it should have separate include/exclude for both limits, so a query like {1 TO 2] should behave as expected.&lt;/p&gt;

&lt;p&gt;The QP should in my opinion also support open-ended ranges. The syntax by NumericRangeQuery&apos;s toString() is by using stars (this is also what Solr&apos;s QP does). For numeric fields, half open ranges are important, as it supports queries like &quot;price &amp;lt; 2.00 Dollar&quot;. Wasn&apos;t there not also an issue open to support other syntax for numerics like &amp;gt; and &amp;lt; operators?&lt;/p&gt;</comment>
                    <comment id="13060186" author="thetaphi" created="Wed, 6 Jul 2011 00:08:06 +0100"  >&lt;p&gt;I have some small things (maybe I will extend this comment when i review more of the code):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in NumericRangeQueryNodeBuilder, i would use switch statement on the NumericField.DataType and throw a UnsupportedEx if an unknown type is hit. I want to do this, because there is already an issue open to extend NumericField and NumericRangeQuery by BYTE and SHORT. If we add those types, the code gets unpredictable. With a switch statement and a exception in the defalt clause, it fails predicatable. You should also add similar &quot;default&quot; statement throwing exceptions in all switch statements on this enum type (in general it is good code style to do this).&lt;/li&gt;
	&lt;li&gt;The current code always handles Date as Long (like Solr does). I am not sure, if this would always be the best idea (see e.g. Lucene In Action book). Maybe we should add a possibility to override the conversion Date &amp;lt;-&amp;gt; Number at a central place to customize? One of the reasons to &lt;b&gt;not&lt;/b&gt; support direkt DateRangeQueries was to make the representation of Dates as Numbers open to the user.&lt;/li&gt;
	&lt;li&gt;Method &quot;NumericField.DataType getNumericDataType(Number number)&quot;: I would use instanceOf checks (as all Number subclasses are final, this is fine and correct). They should be faster than this reflection code.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is all for now, more may be added tomorrow.&lt;/p&gt;</comment>
                    <comment id="13060192" author="viniciusbarros" created="Wed, 6 Jul 2011 00:23:33 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;I think the &quot;bug&quot; in Contrib QP is there because it&apos;s also a bug in Lucene&apos;s Core QP (the default impl just emulates core&apos;s QP). But in my opinion, it should have separate include/exclude for both limits, so a query like {1 TO 2] should behave as expected.&lt;/p&gt;

&lt;p&gt;I think the same way, no idea why it&apos;s not supporting {1 TO 2]. I can try to fix it, but not sure how long it will take, haven&apos;t looked at the code yet. Anyway, it shouldn&apos;t be that hard, since core QueryParser is already working the way we expect, we need somehow to copy the same behavour to contrib queryparser.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;in NumericRangeQueryNodeBuilder, i would use switch statement on the NumericField.DataType and throw a UnsupportedEx if an unknown type is hit. I want to do this, because there is already an issue open to extend NumericField and NumericRangeQuery by BYTE and SHORT. If we add those types, the code gets unpredictable. With a switch statement and a exception in the defalt clause, it fails predicatable. You should also add similar &quot;default&quot; statement throwing exceptions in all switch statements on this enum type (in general it is good code style to do this).&lt;/p&gt;

&lt;p&gt;Agreed! I will do the change.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;The current code always handles Date as Long (like Solr does). I am not sure, if this would always be the best idea (see e.g. Lucene In Action book). Maybe we should add a possibility to override the conversion Date &amp;lt;-&amp;gt; Number at a central place to customize? One of the reasons to not support direkt DateRangeQueries was to make the representation of Dates as Numbers open to the user.&lt;/p&gt;

&lt;p&gt;Do you mean that Date could return some other type other than LONG? Like INT?! I could add a new parameter to NumberDateFormat that will receive NumeridField.DataType, this way the code could parse the date to the expected number type.&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; Method &quot;NumericField.DataType getNumericDataType(Number number)&quot;: I would use instanceOf checks (as all Number subclasses are final, this is fine and correct). They should be faster than this reflection code.&lt;/p&gt;

&lt;p&gt;I will change that as well.&lt;/p&gt;</comment>
                    <comment id="13060195" author="thetaphi" created="Wed, 6 Jul 2011 00:40:37 +0100"  >&lt;blockquote&gt;
&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;The current code always handles Date as Long (like Solr does). I am not sure, if this would always be the best idea (see e.g. Lucene In Action book). Maybe we should add a possibility to override the conversion Date &amp;lt;-&amp;gt; Number at a central place to customize? One of the reasons to not support direkt DateRangeQueries was to make the representation of Dates as Numbers open to the user.&lt;/p&gt;

&lt;p&gt;Do you mean that Date could return some other type other than LONG? Like INT?! I could add a new parameter to NumberDateFormat that will receive NumeridField.DataType, this way the code could parse the date to the expected number type.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In general, the formatting of a Date to a Number should be possible to customize (e.g. if you only want to format the Date without the time and your index supports only Int dates, like number of days).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I talked to Phillipe about the new API, it does not look complicated. I will try to do the change and submit a new patch by the end of this week, then we can finally have something checked in \o/&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That communication should be done in public...&lt;/p&gt;</comment>
                    <comment id="13060196" author="viniciusbarros" created="Wed, 6 Jul 2011 00:50:31 +0100"  >&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; In general, the formatting of a Date to a Number should be possible to customize (e.g. if you only want to format the Date without the time and your index supports only Int dates, like number of days).&lt;/p&gt;

&lt;p&gt;That&apos;s possible, the user just need to provide a NumberFormat that will convert String to whatever Number object the user wants.&lt;/p&gt;</comment>
                    <comment id="13060244" author="cmale" created="Wed, 6 Jul 2011 03:50:53 +0100"  >&lt;p&gt;Hey,&lt;/p&gt;

&lt;p&gt;In the next week or so I&apos;m going to want to move this QueryParser, along with the contents of contrib/queryparser, to the new consolidated queryparser module.  Is this going to get in the way of the work here?&lt;/p&gt;</comment>
                    <comment id="13060295" author="adriano_crestani" created="Wed, 6 Jul 2011 06:20:45 +0100"  >&lt;p&gt;Hi Chris,&lt;/p&gt;

&lt;p&gt;If you are just moving code, I think it&apos;s fine, at max we will need to rename the paths in the patch to match the new file structure.&lt;/p&gt;</comment>
                    <comment id="13060707" author="adriano_crestani" created="Wed, 6 Jul 2011 18:30:16 +0100"  >&lt;blockquote&gt;
&lt;p&gt;For numeric fields, half open ranges are important, as it supports queries like &quot;price &amp;lt; 2.00 Dollar&quot;. Wasn&apos;t there not also an issue open to support other syntax for numerics like &amp;gt; and &amp;lt; operators?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, there is, just do not recall the JIRA number now. Maybe Vinicius could try to implement it as well to fill out his task list in case he finishes his tasks before schedule, since it is also related to numeric queries. I am just not sure how much complex the task would be, I know the big change for this is in the syntax parser, which will require to know how to change javacc files.&lt;/p&gt;</comment>
                    <comment id="13062596" author="viniciusbarros" created="Sat, 9 Jul 2011 19:04:28 +0100"  >&lt;p&gt;This patch includes the fix for the new config api and all changes suggested by Uwe.&lt;/p&gt;

&lt;p&gt;Uwe, you should be able to commit it now, I checked out the trunk and applied the patch myself and everything is working fine.&lt;/p&gt;</comment>
                    <comment id="13062602" author="thetaphi" created="Sat, 9 Jul 2011 19:58:24 +0100"  >&lt;p&gt;Hi Vinicius,&lt;br/&gt;
cool thanks! Patched, works - nothing to complain about.&lt;/p&gt;

&lt;p&gt;I think I will commit this soon, so your partner from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2979&quot; title=&quot;Simplify configuration API of contrib Query Parser&quot;&gt;&lt;del&gt;LUCENE-2979&lt;/del&gt;&lt;/a&gt; can also coordinate with you (which was also committed).&lt;/p&gt;</comment>
                    <comment id="13062625" author="thetaphi" created="Sat, 9 Jul 2011 22:07:32 +0100"  >&lt;p&gt;Committed to Lucene trunk revision: 1144744&lt;br/&gt;
You can now start and improve the documentation, tests,... Please use current trunk as basis.&lt;/p&gt;

&lt;p&gt;One note: I have still seen some switch statements without a default while reviewing.&lt;/p&gt;

&lt;p&gt;We should also decide together with &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2979&quot; title=&quot;Simplify configuration API of contrib Query Parser&quot;&gt;&lt;del&gt;LUCENE-2979&lt;/del&gt;&lt;/a&gt; if we should backport this stuff to 3.x (once finished). Adriano?&lt;/p&gt;</comment>
                    <comment id="13062643" author="thetaphi" created="Sat, 9 Jul 2011 22:52:58 +0100"  >&lt;p&gt;I had to fix a javadoc warning, breaking the Jenkins Builds: rev 1144755&lt;/p&gt;</comment>
                    <comment id="13062820" author="adriano_crestani" created="Mon, 11 Jul 2011 00:02:02 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;There are plans to backport &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2979&quot; title=&quot;Simplify configuration API of contrib Query Parser&quot;&gt;&lt;del&gt;LUCENE-2979&lt;/del&gt;&lt;/a&gt; to 3.x, Phillipe is already working on it, still evaluating if it will be possible.&lt;/p&gt;

&lt;p&gt;I am not sure about numeric support, Vinicius changed TermRangeQueryNode inheritance, which breaks the backwards compatibility. I am not saying the change is bad, I agree with the new structure, however Vinicius will need to find another solution before backporting it to 3.x.&lt;/p&gt;</comment>
                    <comment id="13063555" author="thetaphi" created="Mon, 11 Jul 2011 22:26:00 +0100"  >&lt;p&gt;Vinicius, do you have any plans about backporting the stuff to Lucene 3.x - it should not be that hard &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am not sure about numeric support, Vinicius changed TermRangeQueryNode inheritance, which breaks the backwards compatibility. I am not saying the change is bad, I agree with the new structure, however Vinicius will need to find another solution before backporting it to 3.x.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I am not sure if this is really a break when you change inheritance. If code still compiles, its no break, if classes were renamed its more serious. I am not sure, if implementation classes (and -names) should be covered by the backwards compatibility. In my opinion, mainly the configuration and interfaces of the QP must be covered by backwards policy.&lt;/p&gt;

&lt;p&gt;As we are now at mid-time, it would be a good idea, to maybe add some extra syntax support for numerics, like &quot;&amp;lt;&quot; and &quot;&amp;gt;&quot;? We should also add tests/support for half-open ranges, so syntax like &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO 1.0&amp;#93;&lt;/span&gt;&quot; should also be supported (I am not sure, if TermRangeQueryNode supports this, but numerics should do this in all cases) - the above syntax is also printed out on NumericRangeQuery.toString(), if one of the bounds is null. The latter could be easily implemented by checking for &quot;*&quot; as input to the range bounds and map those special &quot;values&quot; to NULL. Adding support for &quot;&amp;lt;&quot; and &quot;&amp;gt;&quot; (also &quot;&amp;lt;=&quot;, &quot;&amp;gt;=&quot;) needs knowledge of JavaCC parser language. Vinicius, have you ever worked with JavaCC, so do you think you will be able to extend the syntax?&lt;/p&gt;</comment>
                    <comment id="13063570" author="adriano_crestani" created="Mon, 11 Jul 2011 22:59:01 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I am not sure if this is really a break when you change inheritance. If code still compiles, its no break, if classes were renamed its more serious. I am not sure, if implementation classes (and -names) should be covered by the backwards compatibility. In my opinion, mainly the configuration and interfaces of the QP must be covered by backwards policy.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn&apos;t see any class renaming, I need to double check Vinicius&apos;s patches. But he did change the query node inheritance, which may affect how processors and builder (specially QueryNodeTreeBuilder) work. I am not saying it is not possible to implement his approach on 3.x, but he will need to deal differently with query nodes classes he created. As I said before, what he did is good and clean, I like the way it is, but it will break someone&apos;s code if pushed to 3.x. So if you ask me whether to push it to 3.x, I say YES, just make sure to not break the query node structure that people may be relying on.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As we are now at mid-time, it would be a good idea, to maybe add some extra syntax support for numerics, like &quot;&amp;lt;&quot; and &quot;&amp;gt;&quot;? We should also add tests/support for half-open ranges, so syntax like &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO 1.0&amp;#93;&lt;/span&gt;&quot; should also be supported (I am not sure, if TermRangeQueryNode supports this, but numerics should do this in all cases) - the above syntax is also printed out on NumericRangeQuery.toString(), if one of the bounds is null. The latter could be easily implemented by checking for &quot;*&quot; as input to the range bounds and map those special &quot;values&quot; to NULL. Adding support for &quot;&amp;lt;&quot; and &quot;&amp;gt;&quot; (also &quot;&amp;lt;=&quot;, &quot;&amp;gt;=&quot;) needs knowledge of JavaCC parser language. Vinicius, have you ever worked with JavaCC, so do you think you will be able to extend the syntax?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I still need to investigate the bugs Vinicius reported (should have been created a JIRA for that already), I never really tried open ranges in contrib QP. And if Vinicius thinks he will have time and skills to do the JAVACC change to support those new operators, go for it! And remember Vinicius, you don&apos;t need to do everything during gsoc, you are always welcome to contribute code whenever you want &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13063607" author="viniciusbarros" created="Tue, 12 Jul 2011 00:29:00 +0100"  >&lt;p&gt;Thanks for committing the patch Uwe!&lt;/p&gt;

&lt;p&gt;I will review the code again looking for switch without default case and fix it.&lt;/p&gt;

&lt;p&gt;I never did anything with javacc, I just quickly looked at the code, does not seem complicated, however, I have no idea how complex is to run javacc and regenerate the java files. Does lucene ant script do that automaticaly?&lt;/p&gt;

&lt;p&gt;I can try to fix open range queries on contrib query parser, add &quot;&amp;lt;=&quot;-like operators or backport numeric support to 3.x. Just let me know the priorities and I will work on it. My suggestion is that the bug on open range queries is the most critical now, so I could start working on that. Your call Uwe.&lt;/p&gt;</comment>
                    <comment id="13064040" author="rcmuir" created="Tue, 12 Jul 2011 18:55:45 +0100"  >&lt;p&gt;Hey guys, we had some hudson problems I wonder if you could look at:&lt;/p&gt;

&lt;p&gt;The first thing, the randomization of this test was not working correctly, because it used &apos;random&apos; from static initializers. &lt;br/&gt;
In LuceneTestCase, the random is first initialized in @beforeClass, so its not really usable before then.&lt;/p&gt;

&lt;p&gt;I committed this to fix the randomization: &lt;a href=&quot;http://svn.apache.org/viewvc/lucene/dev/trunk/lucene/contrib/queryparser/src/test/org/apache/lucene/queryParser/standard/TestNumericQueryParser.java?r1=1145452&amp;amp;r2=1145451&amp;amp;pathrev=1145452&quot; class=&quot;external-link&quot;&gt;http://svn.apache.org/viewvc/lucene/dev/trunk/lucene/contrib/queryparser/src/test/org/apache/lucene/queryParser/standard/TestNumericQueryParser.java?r1=1145452&amp;amp;r2=1145451&amp;amp;pathrev=1145452&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once I did this, then the test is working correctly (reproducible etc) but it would fail and sometimes hang.&lt;/p&gt;

&lt;p&gt;I took care of the hang, the reason was if the test got minIntegerDigits &amp;lt; 4, it would loop forever looking for a number &amp;gt;= 1000.&lt;br/&gt;
You can see the fix here: &lt;a href=&quot;http://svn.apache.org/viewvc/lucene/dev/trunk/lucene/contrib/queryparser/src/test/org/apache/lucene/queryParser/standard/TestNumericQueryParser.java?view=diff&amp;amp;r1=1145456&amp;amp;r2=1145457&amp;amp;pathrev=1145457&quot; class=&quot;external-link&quot;&gt;http://svn.apache.org/viewvc/lucene/dev/trunk/lucene/contrib/queryparser/src/test/org/apache/lucene/queryParser/standard/TestNumericQueryParser.java?view=diff&amp;amp;r1=1145456&amp;amp;r2=1145457&amp;amp;pathrev=1145457&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But one problem still remains, for some situations (e.g. certain numbers and locales) the test is failing.&lt;/p&gt;</comment>
                    <comment id="13064100" author="viniciusbarros" created="Tue, 12 Jul 2011 21:03:55 +0100"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;p&gt;Thanks for fixing the problems.&lt;/p&gt;

&lt;p&gt;About the tests failing, do you know how I can reproduce it? When I was testing, whenever I hit a failure, ant would give me some seed values so I could set in the properties when re-running the tests. Do you have the same values?&lt;/p&gt;</comment>
                    <comment id="13064107" author="rcmuir" created="Tue, 12 Jul 2011 21:10:00 +0100"  >&lt;p&gt;Here are some, from hudson: &lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/9527/testReport/junit/org.apache.lucene.queryParser.standard/TestNumericQueryParser/testSimpleNumericQuery/&quot; class=&quot;external-link&quot;&gt;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/9527/testReport/junit/org.apache.lucene.queryParser.standard/TestNumericQueryParser/testSimpleNumericQuery/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test -Dtestcase=TestNumericQueryParser -Dtestmethod=testSimpleNumericQuery -Dtests.seed=941414100019268099:-3819525649270784880 -Dtests.multiplier=3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is no guarantee this will work though, because when randomizing locales, the number available can vary from JRE to JRE, even changing in minor versions.&lt;/p&gt;</comment>
                    <comment id="13064111" author="thetaphi" created="Tue, 12 Jul 2011 21:13:08 +0100"  >&lt;p&gt;I assume the problem lies in Thai locale - as always &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13064222" author="viniciusbarros" created="Wed, 13 Jul 2011 00:00:55 +0100"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;p&gt;I updated my code to latest revision and I don&apos;t get any junit failure, I ran &lt;/p&gt;

&lt;p&gt;ant test -Dtestcase=TestNumericQueryParser -Dtestmethod=testSimpleNumericQuery -Dtests.seed=941414100019268099:-3819525649270784880 -Dtests.multiplier=3&lt;/p&gt;

&lt;p&gt;in contrib/queryparser and junit on eclipse with&lt;/p&gt;

&lt;p&gt;-Dtestcase=TestNumericQueryParser -Dtestmethod=testSimpleNumericQuery -Dtests.seed=941414100019268099:-3819525649270784880 -Dtests.multiplier=3&lt;/p&gt;

&lt;p&gt;None of them failed.&lt;/p&gt;</comment>
                    <comment id="13064223" author="rcmuir" created="Wed, 13 Jul 2011 00:07:47 +0100"  >&lt;p&gt;yeah the seed will unfortunately rely upon how many locales you have on your JRE&lt;/p&gt;

&lt;p&gt;So to get some seeds that work on your machine, can you try this script?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#!/bin/bash
x=0
while [ $x -lt 50 ]
do
  echo &quot;test iteration number $x&quot;
  (cd lucene/contrib/queryparser &amp;amp;&amp;amp; ant test -Dtestcase=TestNumericQueryParser) &amp;gt;&amp;gt; /home/rmuir/log.txt 2&amp;gt;&amp;amp;1
  x=$(( $x + 1 ))
done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13064245" author="viniciusbarros" created="Wed, 13 Jul 2011 01:01:30 +0100"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;p&gt;Thanks for the script, it helped me to find a case where it fails.&lt;/p&gt;

&lt;p&gt;On my JRE, the code below fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  SimpleDateFormat df = (SimpleDateFormat) DateFormat.getDateTimeInstance(
      DateFormat.FULL, DateFormat.LONG, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Locale(&lt;span class=&quot;code-quote&quot;&gt;&quot;de_CH&quot;&lt;/span&gt;));
  &lt;span class=&quot;code-comment&quot;&gt;// most of date pattern &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not include era, so we add it here. Also,
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// sometimes second is not available, we make sure it&apos;s present too
&lt;/span&gt;  df.applyPattern(df.toPattern() + &lt;span class=&quot;code-quote&quot;&gt;&quot; G s Z yyyy&quot;&lt;/span&gt;);
  df.setTimeZone(TimeZone.getTimeZone(&lt;span class=&quot;code-quote&quot;&gt;&quot;America/Grand_Turk&quot;&lt;/span&gt;));
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; l1 = -1881411016000l;
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; l2 = -1881411028000l;
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; d1 = df.format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(l1));
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; d2 = df.format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(l2));
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; newL1 = df.parse(d1).getTime();
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; newL2 = df.parse(d2).getTime();
  
  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(l1 + &lt;span class=&quot;code-quote&quot;&gt;&quot; =&amp;gt; &quot;&lt;/span&gt; + d1 + &lt;span class=&quot;code-quote&quot;&gt;&quot; =&amp;gt; &quot;&lt;/span&gt; + newL1);
  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(l2 + &lt;span class=&quot;code-quote&quot;&gt;&quot; =&amp;gt; &quot;&lt;/span&gt; + d2 + &lt;span class=&quot;code-quote&quot;&gt;&quot; =&amp;gt; &quot;&lt;/span&gt; + newL2);
  assertEquals(l1, newL1);
  assertEquals(l2, newL2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and it outputs: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-1881411016000 =&amp;gt; Friday, May 20, 1910 4:42:32 AM EST =&amp;gt; -1881411448000
-1881411028000 =&amp;gt; Friday, May 20, 1910 4:42:20 AM EST =&amp;gt; -1881411460000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, it seems DateFormat is not very reliable and do not convert back and forth from date(long) to string format and vice-versa.&lt;/p&gt;

&lt;p&gt;I am planning to add a sanity check when creating randomly the date format, the check will check whether the date can be converted to/from long from/to string without data loss.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                    <comment id="13064304" author="cmale" created="Wed, 13 Jul 2011 03:38:27 +0100"  >&lt;p&gt;Another trunk failure:  &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/9532/&quot; class=&quot;external-link&quot;&gt;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/9532/&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13064328" author="cmale" created="Wed, 13 Jul 2011 04:36:47 +0100"  >&lt;p&gt;Also, note in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3285&quot; title=&quot;Move QueryParsers from contrib/queryparser to queryparser module&quot;&gt;&lt;del&gt;LUCENE-3285&lt;/del&gt;&lt;/a&gt; I&apos;m about to move the flexible QP over to the new queryparser module and remove the contrib.&lt;/p&gt;</comment>
                    <comment id="13064389" author="thetaphi" created="Wed, 13 Jul 2011 07:53:42 +0100"  >&lt;blockquote&gt;&lt;p&gt;As you can see, it seems DateFormat is not very reliable and do not convert back and forth from date(long) to string format and vice-versa.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would write the test a little bit different: Use a random number as basis for the date, then convert to string and back. Throw away the orginal random number and use the &quot;normalized&quot; number and their string representation only?&lt;/p&gt;

&lt;p&gt;This should work better, as I assume SimpleDateFormat always produces same results for same numbers? But you can still add the sanity check and throw away random numbers that don&apos;t meet the requirement.&lt;/p&gt;

&lt;p&gt;Additionally, the millisecond part should always be 000, as you dont use miliseconds?&lt;/p&gt;</comment>
                    <comment id="13064392" author="thetaphi" created="Wed, 13 Jul 2011 08:01:13 +0100"  >&lt;p&gt;I disabled the test case for now: Trunk revision: 1145885&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I would write the test a little bit different: Use a random number as basis for the date, then convert to string and back. Throw away the orginal random number and use the &quot;normalized&quot; number and their string representation only?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, you already did that, so the DateFormats are not really reliabe, you are right!&lt;/p&gt;</comment>
                    <comment id="13064980" author="viniciusbarros" created="Thu, 14 Jul 2011 01:28:36 +0100"  >&lt;p&gt;This is the fix for the junit failure. I used the Robert&apos;s script and the test has not failed anymore.&lt;/p&gt;</comment>
                    <comment id="13065021" author="cmale" created="Thu, 14 Jul 2011 03:58:50 +0100"  >&lt;p&gt;Note, I&apos;ve just moved this contrib to the queryparser module and nuked the contrib.  Sorry Vinicius :/&lt;/p&gt;</comment>
                    <comment id="13065032" author="adriano_crestani" created="Thu, 14 Jul 2011 04:40:10 +0100"  >&lt;p&gt;Hey Chris,you just moved the files right?! Vinicus patch only includes a single file (the failing junit), all Uwe need to do is to apply the patch to the moved file, is that correct?!&lt;/p&gt;</comment>
                    <comment id="13065033" author="cmale" created="Thu, 14 Jul 2011 04:44:22 +0100"  >&lt;p&gt;Correct.&lt;/p&gt;

&lt;p&gt;The Flexible QueryParser can now be found at org.apache.lucene.queryparser.flexible.*&lt;/p&gt;</comment>
                    <comment id="13065087" author="thetaphi" created="Thu, 14 Jul 2011 07:59:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;This is the fix for the junit failure. I used the Robert&apos;s script and the test has not failed anymore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks Vinicius,&lt;br/&gt;
I will check the patch and apply it to the new location of the query parser. You don&apos;t need to do anything!&lt;/p&gt;

&lt;p&gt;If you have other changes or fixes in your checkout, I would recommend to create a patch first (below the queryparser folder) and then update svn and reapply the patch at the new location.&lt;/p&gt;</comment>
                    <comment id="13065430" author="thetaphi" created="Thu, 14 Jul 2011 19:09:02 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;I tested your patch (after converting it to new trunk directory/package layout (thanks Chris Male &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It still fails quite often for some locales (at least in Java 6). The problem is that some locales produce date formats that are not immune to case changes. As QueryParser seems to lowercase the range bounds, some dates cannot be parsed.&lt;/p&gt;

&lt;p&gt;This throwed with your patch a NPE, because you implemented NumberDateFormat wrong: public Number parse(String source, ParsePosition parsePosition) is allowed to return null (it must if a parse error occurs). The same applies to date formats, but if you call getTime() on a null Date it throws NPE. So the attached patch also fixes the NumberDateFormat to handle null correctly.&lt;/p&gt;

&lt;p&gt;I also changed the test initialization a bit to produce sane dates from the beginning.&lt;/p&gt;

&lt;p&gt;I then added a toLowerCase(LOCALE) to the sanity checker&lt;/p&gt;

&lt;p&gt;Now the static initializer fails for:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test -Dtestcase=TestNumericQueryParser -Dtestmethod=testInclusiveNumericRange -Dtests.seed=5825000776503943381:-1057095952794658416
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a lowercased date cannot be parsed, this fails with ParseException. The locale is &quot;es&quot;, so the spanisch translation of &quot;GMT&quot; is case sensitive:&lt;/p&gt;

&lt;p&gt;This parses:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;domingo 19 de agosto de 1973 11H31&apos; GAMT AD 34 -0900 1973
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This not:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;domingo 19 de agosto de 1973 11h31&apos; gamt ad 34 -0900 1973
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13065431" author="thetaphi" created="Thu, 14 Jul 2011 19:10:38 +0100"  >&lt;p&gt;I would suggest to not lowercase range bounds for numbers/dates in the QueryParser. This makes only sense for terms, but numbers should not change case. I think we can remove the toLowerCase() in the query builder.&lt;/p&gt;</comment>
                    <comment id="13065517" author="adriano_crestani" created="Thu, 14 Jul 2011 21:33:06 +0100"  >&lt;p&gt;I agree with Uwe. I think the format passed to NumericConfig should decide if it supports or not case.&lt;/p&gt;</comment>
                    <comment id="13065539" author="thetaphi" created="Thu, 14 Jul 2011 22:15:34 +0100"  >&lt;p&gt;Attached you find the same patch, but with the numeric nodes not lowercased. The fix was easy: As the NumericQueryNodeProcessor transforms all text nodes to numeric nodes, we can simply move the LowerCaseExpandedTerms processor after those transformations, so the nodes are no longer touched.&lt;/p&gt;

&lt;p&gt;The attached patch simply moves the LowercaseExpandedTermsQueryNodeProcessorfilter after the NumericRangeQueryNodeProcessor.&lt;/p&gt;

&lt;p&gt;Tests now pass, Vinicius &amp;amp; Adriano, what do you think?&lt;/p&gt;</comment>
                    <comment id="13065640" author="viniciusbarros" created="Fri, 15 Jul 2011 01:50:28 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;Thanks for fixing the junit, I think changing the order of those processors is OK, mainly if Numeric processors do no require lowercasing.&lt;/p&gt;</comment>
                    <comment id="13065741" author="thetaphi" created="Fri, 15 Jul 2011 07:43:29 +0100"  >&lt;p&gt;I will commit those fixes ASAP to get it again into the nightly test runs (where this test is currently disabled). I never trust the complexity of all Locales, maybe there are more glitches which can only be found with random testing.&lt;/p&gt;</comment>
                    <comment id="13065742" author="adriano_crestani" created="Fri, 15 Jul 2011 07:49:21 +0100"  >&lt;p&gt;It sounds ok for me to change when LowercaseExpandedTermsQueryNodeProcessor gets executed.&lt;/p&gt;</comment>
                    <comment id="13065745" author="thetaphi" created="Fri, 15 Jul 2011 08:07:34 +0100"  >&lt;p&gt;Here the patch I&apos;ll commit now. I changed the initialization order of beforeClass() a little bit to make it easier to undertstand. The NumberFormat is no longer initialized inside the Date loop, as its not used there.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit now.&lt;/p&gt;</comment>
                    <comment id="13066813" author="viniciusbarros" created="Mon, 18 Jul 2011 07:53:30 +0100"  >&lt;p&gt;This patch includes javadocs for the changes I did so far.&lt;/p&gt;

&lt;p&gt;I am working right now on fixing open range bug on flexible standard query parser.&lt;/p&gt;</comment>
                    <comment id="13070287" author="viniciusbarros" created="Mon, 25 Jul 2011 02:02:53 +0100"  >&lt;p&gt;Fixed open range and mixed include and exclude bugs on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3338&quot; title=&quot;Flexible query parser does not support open ranges and range queries with mixed inclusive and exclusive ranges&quot;&gt;&lt;del&gt;LUCENE-3338&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13070483" author="thetaphi" created="Mon, 25 Jul 2011 14:07:02 +0100"  >&lt;p&gt;Committed the javadocs changes in rev 1150671.&lt;/p&gt;</comment>
                    <comment id="13080357" author="viniciusbarros" created="Sat, 6 Aug 2011 06:26:23 +0100"  >&lt;p&gt;Sorry, I have been in silence for so long time, trying to get some results, but many doubts showed up, I need to guidance here.&lt;/p&gt;

&lt;p&gt;First, I started working on implementing &amp;gt;=, &amp;lt;=, &amp;lt;, &amp;gt; and = operator for standard query parser. Then I later realized someone had submitted a patch for that already and I stopped working on it.&lt;/p&gt;

&lt;p&gt;Then I decided to implement support for date resolutions for numeric queries in query parser. I started by changing NumberDateFormat to receive a resolution parameter (DAY, SECONDS, MINUTES, etc) and this new parameter is taken into account when doing the date conversion. For that, I added a new method to do the date rounding that takes TimeZone into account, since the current round methods in DateTools do not support timezone. I was able to make it work up to this part.&lt;/p&gt;

&lt;p&gt;After that, I started to work on date compression, as you suggested before Uwe. For example, if the user wants a DAY resolution, NumberDateFormat should only return the number of days for the given date since 1970, not the miliseconds. For SECOND resolution, it&apos;s easy, just divide the miliseconds by 1000. For minutes the same, divide the miliseconds by 1000 * 60 and so on. However, when I got to month, I have no easy way to compress the miliseconds, I mean, no easy way to truncate the days and only get the month count since 1970. The only good solution I found was to get the number of years since 1970 and multiply by 12 plus the current month number.&lt;/p&gt;

&lt;p&gt;I am still wondering if we can always assume that dividing the miliseconds by 1000 (sec), 60 (minute), 60 (hour) and 24 (day) will actually be precise. What about the leap second? Not sure if the miliseconds -&amp;gt; (defined_resolution) and (defined_resolution) -&amp;gt; miliseconds will always be correct. Maybe I am missing something or overcomplicating.&lt;/p&gt;</comment>
                    <comment id="13080359" author="viniciusbarros" created="Sat, 6 Aug 2011 06:32:31 +0100"  >&lt;p&gt;I also started working on applying the numeric support to 3x. However I am not sure about backwards compatibility there.&lt;/p&gt;

&lt;p&gt;The problem is that in trunk I had renamed RangeQueryNode to TermRangeQueryNode. Also, TermRangeQueryNode no longer extends ParametricRangeQueryNode, it now extends AbstractRangeQueryNode. Because of that, ParametricRangeQueryNodeProcessor returns a TermRangeQueryNode instead of RangeQueryNode. As you can see, many things the user might expect to still work the same is working completely different. I see some classes in Lucene use Version, but I don&apos;t know exactly how that works and why standard query parser do not use it. Should it?&lt;/p&gt;

&lt;p&gt;Not sure how I should proceed now. Should I ignore the backward compatibility and go ahead and change how everything behaves or try to make everything backward compatible (not sure how I could do that without the use of Version).&lt;/p&gt;

&lt;p&gt;Do you have any comments on that Uwe?&lt;/p&gt;</comment>
                    <comment id="13080360" author="thetaphi" created="Sat, 6 Aug 2011 06:56:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;I see some classes in Lucene use Version, but I don&apos;t know exactly how that works and why standard query parser do not use it. Should it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Version is inteneded to be used for behavioural changes to keep index compatibility, so people can use new Lucene versions without reindexing. It does not help for API changes (it could sometimes, but only for those cases where the API changes are something like: If versionA call method a else method b, if method a or b trigger different APIs).&lt;/p&gt;

&lt;p&gt;Typical examples for Version are changes in tokenization (so most analyzers use it): When a bugfix in the analyzer produces different tokens than before the version flag is used to be able to enable the &quot;buggy&quot; behaviour, so querying your index with the &quot;wrong&quot; tokens still works. The core queryparser also uses it to change the behaviour of creating phrase queries (the flexible query parser is, as far as I know, still missing this).&lt;/p&gt;

&lt;p&gt;I am away this weekend, I will come back to you on Monday for the other questions.&lt;/p&gt;</comment>
                    <comment id="13081404" author="adriano_crestani" created="Tue, 9 Aug 2011 04:36:20 +0100"  >&lt;p&gt;Good point, should flexible query parser be using version? The changes below might break users&apos; code.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processor pipeline configuration changes: any change on the configuration may affect the query node tree result. If the user has created it&apos;s own query builder (or somehow extended/modified the current builder), changes to what the processor pipeline outputs might break user&apos;s code.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;syntax parser changes: if the syntax parser starts outputting a different query node tree it may break any user processor or builder&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;whenever a builder is expecting XQueryNode and then in a later version is expects YQueryNode as input&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The question is: should we support versioning for the above changes or should we only document the changes and let the user be aware of such change?&lt;/p&gt;

&lt;p&gt;I think we should be very careful and only use Version when it&apos;s really required (like things that imply in index changes). So I vote for only documenting the change and also try to avoid changes that will change the code behavior.&lt;/p&gt;

&lt;p&gt;I see the classic QP only uses version to change the default value for certain instance attributes between 2.9/3.0 and 3.x versions. I think it&apos;s only there because 2.9 and 3.0 were required to be the same, except removed deprecations. I don&apos;t think 4.0 will have the same requirement, will it?&lt;/p&gt;</comment>
                    <comment id="13081412" author="adriano_crestani" created="Tue, 9 Aug 2011 04:55:22 +0100"  >&lt;p&gt;I took a look at the code and I have some suggestions to avoid doing to many changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for 3x, do not rename RangeQueryNode to TermRangeQueryNode, just deprecate it and document it saying it will change name in future (Uwe, can you confirm this is the right procedure for class renaming?!).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ParametricRangeQueryNode and AbstractRangeQueryNode have exactly the same methods, why can&apos;t they share the a new common interface? I think this will enable you to keep the same inheritance structure for RangeQueryNode, is that correct?! I would name this new interface RangeQueryNode, if there was no such class already. So I will let you pick any name for it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it&apos;s a start, I haven&apos;t tried the changes, so I will let you(Vinicius) play with it. Let us know if it helped or if you hit any new problems &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13081776" author="thetaphi" created="Tue, 9 Aug 2011 18:24:50 +0100"  >&lt;blockquote&gt;&lt;p&gt;for 3x, do not rename RangeQueryNode to TermRangeQueryNode, just deprecate it and document it saying it will change name in future (Uwe, can you confirm this is the right procedure for class renaming?!).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can confirm this, we do it generally a little bit different, there are two possibilities (depending on if the user will create instances of this class and pass it to the API or if the API returns the instance):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For the first case, you would leave the name as in trunk, but simply create an empty subclass with the old 3.x name (only copy the ctors) and deprecate this subclass.&lt;/li&gt;
	&lt;li&gt;For the second case, create the deprecated class as superclass of the new one (and deprecate it), copying all code to this deprecated class. The problem here is that deprecation inherits... To fix, you have to declare all methods and let them call super without deprecation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I agree with the rest of Adriano&apos;s comments.&lt;/p&gt;

&lt;p&gt;In general this is a contrib module and contrib modules don&apos;t have the strict backwards requirements like core classes. Because of this I would only provide minimal backwards layers (no sophisticated ones) and document all changes. Backwards compatibility sometimes get a pain, so we even document and break backwards in core (sometimes). We list all those breaks in the backwards section. Backwards breaks that can be fixed by recompilation are very minor and should only be documented (as drop-in-JAR replacements no longer work), so they are no issue at all.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I see the classic QP only uses version to change the default value for certain instance attributes between 2.9/3.0 and 3.x versions. I think it&apos;s only there because 2.9 and 3.0 were required to be the same, except removed deprecations. I don&apos;t think 4.0 will have the same requirement, will it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;4.0 breaks backwards completely with no deprecation layers. The core API of Lucene changed hard (new enum types, new structures, totally new API, change from char[] to byte[],... the list is very long). We have a MIGRATION.txt that explains all changes.&lt;/p&gt;

&lt;p&gt;We only add deprecation layers in 3.x core for cases where very high-level user classes are affected (e.g. IndexSearcher.search() methods, so transition is easy). All other places in Lucene that are more expert will change as described before.&lt;/p&gt;</comment>
                    <comment id="13082128" author="viniciusbarros" created="Wed, 10 Aug 2011 05:15:10 +0100"  >&lt;p&gt;Hi Uwe and Adriano,&lt;/p&gt;

&lt;p&gt;Thanks for the comments.&lt;/p&gt;

&lt;p&gt;I have been trying to follow Adriano&apos;s instructions to avoid major changes to API and behavior. However, ParametricRangeQueryNode and AbstractRangeQueryNode do not share the same methods (as Adriano said above). ParametricRangeQueryNode has lower and upper bound, which are ParametricQueryNodes, and these last ones hold the inclusive/exclusive information (they use CompareOperator for that). AbtractRangeQueryNode have lower and upper bounds (these ones defined by the template, so it could be a ParametricQueryNode, which is compatible with ParametricRangeQueryNode), however it holds the inclusive/exclusive information differently, through isLowerInclusive and isUpperInclusive methods.&lt;/p&gt;

&lt;p&gt;I just don&apos;t understand why ParametricQueryNode hold this CompareOperator value, I think this should be part of the ParametricRangeQueryNode and ParametricQueryNode should only be a simple value (FieldQueryNode). Any suggestions here?&lt;/p&gt;</comment>
                    <comment id="13082741" author="adriano_crestani" created="Thu, 11 Aug 2011 00:00:33 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I just don&apos;t understand why ParametricQueryNode hold this CompareOperator value, I think this should be part of the ParametricRangeQueryNode and ParametricQueryNode should only be a simple value (FieldQueryNode). Any suggestions here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s a looong story. And you are right, they are not compatible (my fault) and CompareOperator does not make much sense. Today, if you want, you can set a ParametricRangeQueryNode with CompareOperator.LE set in the two bounds :S. Lets take the opportunity and try to redesign it.&lt;/p&gt;

&lt;p&gt;I also agree that ParametricRangeQueryNode could only have FieldQueryNode as its bounds, so I think we can get rid of ParametricQueryNode (for 4.0). For now, I will suggest the following change:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;keep using ParametricQueryNode in ParametricRangeQueryNode&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;deprecate ParametricQueryNode&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make ParametricRangeQueryNode implement that RangeQueryNode interface I mentioned on my last comment. This interface will have isLowerInclusive, isUpperInclusive, setUpperInclusive and setLowerInclusive. For the template parameter, ParametricRangeQueryNode should use FieldQueryNode.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure whenever the user sets lowerInclusive and upperInclusive we replicate that to the ParametricQueryNode (upper and lower bounds) setting the equivalent CompareOperator.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think this way we can get rid of ParametricQueryNode in future. I don&apos;t know the implications of these changes, since I haven&apos;t tried it. So let me know if you find any new conflict.&lt;/p&gt;</comment>
                    <comment id="13084751" author="viniciusbarros" created="Sun, 14 Aug 2011 01:32:18 +0100"  >&lt;p&gt;This patches backports the numeric support to 3x.&lt;/p&gt;

&lt;p&gt;Uwe and Adriano, please, review it and let me know if the backports looks OK.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    <comment id="13086132" author="adriano_crestani" created="Wed, 17 Aug 2011 05:38:24 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;Good work, the patch looks good. I saw you named the new interface RangeQueryNode as well. I don&apos;t see any problem, since they are in different packages.&lt;/p&gt;</comment>
                    <comment id="13086181" author="thetaphi" created="Wed, 17 Aug 2011 08:37:02 +0100"  >&lt;p&gt;I have no problems with the patch, too. We have unfortunately no real backwards tests for contribs, but I see no major problems.&lt;/p&gt;

&lt;p&gt;I will commit this soon and record merges from trunk, so the commits are related by mergeprops. What changes are still missing from trunk that will never be backported?&lt;/p&gt;

&lt;p&gt;Adriano: Can you summarize all your changes in both issues into a changes.txt entry for both branches?&lt;/p&gt;</comment>
                    <comment id="13086283" author="thetaphi" created="Wed, 17 Aug 2011 13:59:12 +0100"  >&lt;p&gt;In 3.x we depend on Java 5, I found two interface @Override in your patch, that are not detected by Java6&apos;s javac (it&apos;s a bug there).&lt;/p&gt;</comment>
                    <comment id="13086286" author="thetaphi" created="Wed, 17 Aug 2011 14:00:35 +0100"  >&lt;p&gt;Attached a patch that fixes the interface @Override, including all merge-props needed.&lt;/p&gt;</comment>
                    <comment id="13086636" author="adriano_crestani" created="Wed, 17 Aug 2011 23:12:09 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Adriano: Can you summarize all your changes in both issues into a changes.txt entry for both branches?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hi Uwe, yes, I can do it, I will need to review the entire code again (3x and trunk). I plan to do this during the weekend. But if you want, commit Vinicius&apos;s code and I commit the changes to changes.txt later &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13086637" author="thetaphi" created="Wed, 17 Aug 2011 23:13:37 +0100"  >&lt;p&gt;OK. Of course, also Vinicius can help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13087274" author="thetaphi" created="Thu, 18 Aug 2011 21:45:36 +0100"  >&lt;p&gt;Committed 3.x revision: 1159411&lt;/p&gt;

&lt;p&gt;I keep this issue open until CHANGES.txt for trunk and 3.x is finished (including upgrade guidelines for backwards breaks).&lt;/p&gt;</comment>
                    <comment id="13087283" author="thetaphi" created="Thu, 18 Aug 2011 21:59:53 +0100"  >&lt;p&gt;Adriano: Can you take this issue, because I will fly to California on Sunday and have no time next week? Of course, I will fill out the GSoC evaluation form once it is available online.&lt;/p&gt;</comment>
                    <comment id="13087303" author="thetaphi" created="Thu, 18 Aug 2011 22:25:44 +0100"  >&lt;p&gt;I had to fix Javadoc warnings in 3.x revision: 1159420&lt;/p&gt;</comment>
                    <comment id="13087515" author="viniciusbarros" created="Fri, 19 Aug 2011 05:16:48 +0100"  >&lt;p&gt;Thanks for committing the patch Uwe.&lt;/p&gt;

&lt;p&gt;I tried to summarize everything I have changed so far for this JIRA. I hope this helps:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new query node interfaces: FieldValuePairQueryNode, ValueQueryNode&lt;/li&gt;
	&lt;li&gt;FieldQueryNode now implements FieldValuePairQueryNode&lt;/li&gt;
	&lt;li&gt;two new public methods added to StandardQueryParser: setNumericConfigMap and getNumericConfigMap&lt;/li&gt;
	&lt;li&gt;new query builders: DummyQueryNodeBuilder, NumericRangeQueryNodeBuilder, TermRangeQueryNodeBuilder&lt;/li&gt;
	&lt;li&gt;removed builders (trunk only): RangeQueryNodeBuilder&lt;/li&gt;
	&lt;li&gt;changes to StandardQueryTreeBuilder configuration: it now uses DummyQueryNodeBuilder for NumericQueryNodes and uses NumericRangeQueryNodeBuilder for NumericRangeQueryNodes&lt;/li&gt;
	&lt;li&gt;changes to StandardQueryTreeBuilder configuration (trunk only): removed builder for RangeQueryNodes, as this class was removed in trunk&lt;/li&gt;
	&lt;li&gt;added NumberDateFormat, that helps to parse/format dates into number and index it as numeric&lt;/li&gt;
	&lt;li&gt;added NumericConfig, used to set the numeric configuration of a certain field in the query parser. It contains information about its numeric type, how to parse/format from/to string and its precision step.&lt;/li&gt;
	&lt;li&gt;added NumericFieldConfigListener that sets the corresponding NumericConfig object to the FieldConfig object&lt;/li&gt;
	&lt;li&gt;added NUMERIC_CONFIG and NUMERIC_CONFIG_MAP constants to StandardQueryConfigHandler, used to set numeric configuration to StandardQueryConfigHandler&lt;/li&gt;
	&lt;li&gt;added AbstractRangeQueryNode that is the common parent of all currently available RangeQueryNodes&lt;/li&gt;
	&lt;li&gt;added RangeQueryNode interface, that should be implemented by all range query nodes, such as NumericRangeQueryNode and TermRangeQueryNode&lt;/li&gt;
	&lt;li&gt;added NumericQueryNode, which is equivalent to FieldQueryNode, but holds a Number instead of String&lt;/li&gt;
	&lt;li&gt;added NumericRangeQueryNode, which is equivalent to TermRangeQueryNode, but holds NumericQueryNodes instead of ParametricQueryNodes (3x)/FieldQueryNodes(trunk)&lt;/li&gt;
	&lt;li&gt;added NumericRangeQueryNodeProcessor, that processes RangeQueryNodes and convert them to NumericRangeQueryNodes when its field is configured as numeric&lt;/li&gt;
	&lt;li&gt;added NumericQueryNodeProcessor, which converts FieldQueryNodes into NumericRangeQueryNodes (lower bound == upper bound) when the field is configured as numeric&lt;/li&gt;
	&lt;li&gt;(trunk only) ParametricRangeQueryNodeProcessor now creates TermRangeQueryNode instead of RangeQueryNode from ParametricRangeQueryNode&lt;/li&gt;
	&lt;li&gt;changed StandardQueryNodeProcessorPipeline configuration: NumericQueryNodeProcessor followed by NumericRangeQueryNodeProcessor are executed right after LowercaseExpandedTermsQueryNodeProcessor&lt;/li&gt;
	&lt;li&gt;(3x only) deprecated RangeQueryNode, TermRangeQueryNode should be used instead&lt;/li&gt;
	&lt;li&gt;(3x only) deprecated ParametricQueryNode, FieldQueryNode should be used instead and the compare operators should be set using RangeQueryNode.setLowerBoundInclusive and RangeQueryNode.setUpperBoundInclusive methods&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="13087516" author="viniciusbarros" created="Fri, 19 Aug 2011 05:18:11 +0100"  >&lt;p&gt;Right now I am reviewing the API changes I did in 3x and trying to replicate it back to trunk (removing deprecated classes, etc). I should have a new patch soon.&lt;/p&gt;</comment>
                    <comment id="13088110" author="adriano_crestani" created="Sat, 20 Aug 2011 03:23:51 +0100"  >&lt;p&gt;Hi Vinicius,&lt;/p&gt;

&lt;p&gt;Thanks for the info, but maybe it is too much details for the changes.txt. Let me try to simplify it.&lt;/p&gt;

&lt;p&gt;(3.x)&lt;/p&gt;

&lt;p&gt;New features:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1768&quot; title=&quot;NumericRange support for new query parser&quot;&gt;&lt;del&gt;LUCENE-1768&lt;/del&gt;&lt;/a&gt;: added support for numeric ranges in contrib query parser; added support for simple numeric queries, such as &amp;lt;age:4&amp;gt;, in contrib query parser (Vinicius Barros via Uwe Schindler)&lt;/p&gt;

&lt;p&gt;Changes in runtime behavior:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1768&quot; title=&quot;NumericRange support for new query parser&quot;&gt;&lt;del&gt;LUCENE-1768&lt;/del&gt;&lt;/a&gt;: StandardQueryConfigHandler now uses NumericFieldConfigListener to set a NumericConfig to its corresponding FieldConfig; StandardQueryTreeBuilder now uses DummyQueryNodeBuilder for NumericQueryNodes and uses NumericRangeQueryNodeBuilder for NumericRangeQueryNodes; StandardQueryNodeProcessorPipeline now executes NumericQueryNodeProcessor followed by NumericRangeQueryNodeProcessor right after LowercaseExpandedTermsQueryNodeProcessor; (Vinicius Barros via Uwe Schindler)&lt;/p&gt;

&lt;p&gt;API changes: &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1768&quot; title=&quot;NumericRange support for new query parser&quot;&gt;&lt;del&gt;LUCENE-1768&lt;/del&gt;&lt;/a&gt;: setNumericConfigMap and getNumericConfigMap were added to StandardQueryParser; ParametricRangeQueryNode and oal.queryParser.standard.nodes.RangeQueryNode now implement oal.queryParser.core.nodes.RangeQueryNode; oal.queryParser.core.nodes.RangeQueryNode was deprecated and now extends TermRangeQueryNode, which extends AbstractRangeQueryNode; ParametricQueryNode was deprecated; FieldQueryNode now implements the new FieldValueQueryNode&amp;lt;CharSequence&amp;gt;, which this last one implements FieldableQueryNode and thew new ValueQueryNode; (Vinicius Barros via Uwe Schindler)&lt;/p&gt;


&lt;p&gt;(trunk)&lt;/p&gt;

&lt;p&gt;Changes in runtime behavior:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1768&quot; title=&quot;NumericRange support for new query parser&quot;&gt;&lt;del&gt;LUCENE-1768&lt;/del&gt;&lt;/a&gt;: StandardQueryTreeBuilder uses RangeQueryNodeBuilder for RangeQueryNodes, since theses two classes were removed; ParametricRangeQueryNodeProcessor now creates TermRangeQueryNode, instead of RangeQueryNode, from ParametricRangeQueryNode (Vinicius Barros via Uwe Schindler)&lt;/p&gt;

&lt;p&gt;API Changes:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1768&quot; title=&quot;NumericRange support for new query parser&quot;&gt;&lt;del&gt;LUCENE-1768&lt;/del&gt;&lt;/a&gt;: ParametricRangeQueryNode now implements RangeQueryNode&amp;lt;FieldQueryNode&amp;gt; instead of RangeQueryNode&amp;lt;ParametricQueryNode&amp;gt; (Vinicius Barros via Uwe Schindler)&lt;/p&gt;

&lt;p&gt;Vinicius, please, review the summary I wrote above, I hope I could simplify correctly what you summarized. The API Changes for trunk I am assuming you are going to remove ParametricQueryNode(deprecated) and replace by FieldQueryNode in that statement.&lt;/p&gt;

&lt;p&gt;Uwe, I hope this helps &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13088311" author="viniciusbarros" created="Sun, 21 Aug 2011 05:18:32 +0100"  >&lt;p&gt;I have changed again trunk to reflect the latest changes on 3x.&lt;/p&gt;

&lt;p&gt;I also realized that ParametricRangeQueryNode and TermRangeQueryNode are basically the same, so I decided to removed ParametricRangeQueryNode and only use TermRangeQueryNode. Everything seems to be working fine. Let me know if I should not have done that for any reason.&lt;/p&gt;

&lt;p&gt;I have some few changes on 3x to submit yet, but I was wondering: is it necessary to deprecate a class in 3x if it&apos;s ONLY going to be removed in 4.0? Not sure if I understand how these things work yet.&lt;/p&gt;</comment>
                    <comment id="13088312" author="viniciusbarros" created="Sun, 21 Aug 2011 05:20:02 +0100"  >&lt;p&gt;Thanks Adriano, your summary looks better!&lt;/p&gt;

&lt;p&gt;To trunk behavior changes, I would add that &quot;StandardSyntaxParser&quot; no longer outputs ParametricRangeQueryNodes for range queries, instead, it outputs TermRangeQueryNodes.&lt;/p&gt;</comment>
                    <comment id="13099626" author="thetaphi" created="Wed, 7 Sep 2011 23:43:11 +0100"  >&lt;p&gt;Hi Vinicius, any news for trunk? We want to release Lucene 3.4.0, just to confirm: Are we finished with the 3.x branch? I will just quickly add the changes entry as suggested by Adriano.&lt;/p&gt;</comment>
                    <comment id="13099944" author="viniciusbarros" created="Thu, 8 Sep 2011 06:04:15 +0100"  >&lt;p&gt;Sorry Uwe, college is taking my time again.&lt;/p&gt;

&lt;p&gt;Here are the latest changes, for trunk and 3x.&lt;/p&gt;

&lt;p&gt;Tests are passing for both.&lt;/p&gt;</comment>
                    <comment id="13100102" author="thetaphi" created="Thu, 8 Sep 2011 07:23:58 +0100"  >&lt;p&gt;Hi Adriano,&lt;/p&gt;

&lt;p&gt;thanks. For applying the patch you have to first do a svn rename:&lt;br/&gt;
modules/queryparser/src/java/org/apache/lucene/queryparser/flexible/standard/processors/ParametricRangeQueryNodeProcessor.java -&amp;gt; modules/queryparser/src/java/org/apache/lucene/queryparser/flexible/standard/processors/TermRangeQueryNodeProcessor.java&lt;/p&gt;

&lt;p&gt;After doing this, the patch applies. I will verify the changes and respond back later.&lt;br/&gt;
I will apply the 3.x javadoc/code changes to the 3.x and 3.4 branches.&lt;/p&gt;</comment>
                    <comment id="13100217" author="thetaphi" created="Thu, 8 Sep 2011 11:56:35 +0100"  >&lt;p&gt;The cleanups in trunk look fine, I think we can commit them. The tests did not change so I am confident that they break nothing.&lt;/p&gt;

&lt;p&gt;I think we can resolve this issue after those. Nice work!&lt;/p&gt;</comment>
                    <comment id="13100441" author="thetaphi" created="Thu, 8 Sep 2011 17:50:32 +0100"  >&lt;p&gt;Committed final changes to trunk revision: 1166789&lt;br/&gt;
Committed Javadocs/deprecation changes + changes.txt to 3.x branch revision: 1166536; 3.4 release branch revision: 1166538&lt;/p&gt;</comment>
                    <comment id="13100443" author="thetaphi" created="Thu, 8 Sep 2011 17:51:22 +0100"  >&lt;p&gt;If you have any more comments, please reopen, I think this is resolved now.&lt;/p&gt;

&lt;p&gt;Thanks Vinicius, good work!&lt;/p&gt;</comment>
                    <comment id="13100792" author="viniciusbarros" created="Fri, 9 Sep 2011 00:37:11 +0100"  >&lt;p&gt;Hi Uwe,&lt;/p&gt;

&lt;p&gt;That&apos;s it. No, I don&apos;t have any other changes in my workspace.&lt;/p&gt;

&lt;p&gt;It was nice working with you, thanks!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                                <inwardlinks description="is blocked by">
                            <issuelink>
            <issuekey id="12417241">LUCENE-1567</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12433389">LUCENE-1823</issuekey>
        </issuelink>
                    </outwardlinks>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12515205">LUCENE-3338</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12515889">LUCENE-3352</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12486556" name="TestNumericQueryParser-fix.patch" size="10426" author="thetaphi" created="Fri, 15 Jul 2011 08:07:34 +0100" />
                    <attachment id="12486508" name="TestNumericQueryParser-fix.patch" size="9143" author="thetaphi" created="Thu, 14 Jul 2011 22:15:34 +0100" />
                    <attachment id="12486482" name="TestNumericQueryParser-fix.patch" size="8336" author="thetaphi" created="Thu, 14 Jul 2011 19:09:02 +0100" />
                    <attachment id="12486391" name="TestNumericQueryParser-fix.patch" size="6350" author="viniciusbarros" created="Thu, 14 Jul 2011 01:28:36 +0100" />
                    <attachment id="12490644" name="week11-13_for_lucene_3x.patch" size="110396" author="thetaphi" created="Wed, 17 Aug 2011 14:00:35 +0100" />
                    <attachment id="12490364" name="week11-13_for_lucene_3x.patch" size="104155" author="viniciusbarros" created="Sun, 14 Aug 2011 01:32:18 +0100" />
                    <attachment id="12491078" name="week-14.patch" size="62166" author="viniciusbarros" created="Sun, 21 Aug 2011 05:18:32 +0100" />
                    <attachment id="12493547" name="week15_for_lucene_3x.patch" size="1817" author="viniciusbarros" created="Thu, 8 Sep 2011 06:04:15 +0100" />
                    <attachment id="12493546" name="week15_for_trunk.patch" size="62166" author="viniciusbarros" created="Thu, 8 Sep 2011 06:04:15 +0100" />
                    <attachment id="12480814" name="week1.patch" size="24453" author="viniciusbarros" created="Mon, 30 May 2011 03:58:16 +0100" />
                    <attachment id="12481522" name="week2.patch" size="39491" author="viniciusbarros" created="Sun, 5 Jun 2011 22:39:56 +0100" />
                    <attachment id="12482321" name="week3.patch" size="77577" author="viniciusbarros" created="Mon, 13 Jun 2011 05:05:09 +0100" />
                    <attachment id="12483223" name="week4.patch" size="84437" author="viniciusbarros" created="Tue, 21 Jun 2011 01:22:53 +0100" />
                    <attachment id="12485080" name="week5-6.patch" size="110415" author="viniciusbarros" created="Sun, 3 Jul 2011 06:54:16 +0100" />
                    <attachment id="12485963" name="week-7.patch" size="99727" author="viniciusbarros" created="Sat, 9 Jul 2011 19:04:28 +0100" />
                    <attachment id="12486797" name="week-8.patch" size="29879" author="viniciusbarros" created="Mon, 18 Jul 2011 07:53:30 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>16.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 31 Jul 2009 19:16:59 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3952</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25958</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>