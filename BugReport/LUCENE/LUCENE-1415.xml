<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:19 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1415/LUCENE-1415.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1415] MultiPhraseQuery has incorrect hashCode() implementation - Leads to Solr Cache misses</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1415</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I found this while hunting for the cause of Solr Cache misses.&lt;/p&gt;

&lt;p&gt;The MultiPhraseQuery class hashCode() implementation is non-deterministic. It uses termArrays.hashCode() in the computation. The contents of that ArrayList are actually arrays themselves, which return there reference ID as a hashCode instead of returning a hashCode which is based on the contents of the array. I would suggest an implementation involving the Arrays.hashCode() method.&lt;/p&gt;

&lt;p&gt;I will try to submit a patch soon, off for today.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12406054">LUCENE-1415</key>
            <summary>MultiPhraseQuery has incorrect hashCode() implementation - Leads to Solr Cache misses</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="tfeak">Todd Feak</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Oct 2008 00:30:09 +0100</created>
                <updated>Fri, 10 Oct 2008 20:46:18 +0100</updated>
                    <resolved>Fri, 10 Oct 2008 20:46:18 +0100</resolved>
                            <version>2.4</version>
                                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12638163" author="yseeley@gmail.com" created="Thu, 9 Oct 2008 01:59:24 +0100"  >&lt;p&gt;Good catch Todd,  this can be demonstrated in Solr with the example server and a query of&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select/?q=ccc&quot; class=&quot;external-link&quot;&gt;http://localhost:8983/solr/select/?q=ccc&lt;/a&gt;&lt;br/&gt;
(ccc has synonyms which end up creating a MultiPhraseQuery)&lt;/p&gt;</comment>
                    <comment id="12638319" author="tfeak" created="Thu, 9 Oct 2008 17:30:03 +0100"  >&lt;p&gt;I&apos;ve attached a TestCase demonstrating the broken functionality.&lt;/p&gt;

&lt;p&gt;I realize that this isn&apos;t the standard format. I&apos;m not setup for creating SVN patches from my current workstation, and I&apos;m in a bit of a crunch. I hope that this can at least provide some level of assistance in rectifying this situation.&lt;/p&gt;</comment>
                    <comment id="12638322" author="tfeak" created="Thu, 9 Oct 2008 17:34:33 +0100"  >&lt;p&gt;Attached a copy of what I did to MultiPhraseQuery to fix the issue. This was created from the 2.4.0 source code. Implementation of hashCode() and equals() uses the Java List implementation  as a base so to achieve what looks like the original intent of the comparisons, just taking into account the Term[].&lt;/p&gt;

&lt;p&gt;Again, sorry it&apos;s not in the correct format. Hope it helps.&lt;/p&gt;</comment>
                    <comment id="12638332" author="markrmiller@gmail.com" created="Thu, 9 Oct 2008 18:18:51 +0100"  >&lt;p&gt;Patch that cleans up formating and merges the unit test with the existing multiphrasequery test.&lt;/p&gt;

&lt;p&gt;Without multiphrasequery change, new test fails. With change, all tests pass.&lt;/p&gt;</comment>
                    <comment id="12638342" author="yseeley@gmail.com" created="Thu, 9 Oct 2008 18:44:36 +0100"  >&lt;p&gt;Thanks guys,&lt;br/&gt;
I believe Arrays.hashCode() is a Java 5 feature?&lt;/p&gt;</comment>
                    <comment id="12638347" author="markrmiller@gmail.com" created="Thu, 9 Oct 2008 19:00:51 +0100"  >&lt;p&gt;Hmmm...I really thought I had my environment setup to limit to 1.4 code...would appear thats not working...&lt;/p&gt;

&lt;p&gt;Here is a 1.4 patch.&lt;/p&gt;</comment>
                    <comment id="12638378" author="thetaphi" created="Thu, 9 Oct 2008 21:29:36 +0100"  >&lt;p&gt;That&apos;s clear: If you set the compilation option of Java 5/6 to limit to 1.4 features, this prevents you from using language features of 5. But the underlying class library is from the java distribution, the compiler comes from (Java5&apos;s rt.jar), which contains Arrays.hashCode(). The compiler cannot know, that Arrays.hashCode is not available in 1.4 unless it uses an old rt.jar. If you want to be sure to compile 1.4 only, you have to install Java 1.4.&lt;/p&gt;</comment>
                    <comment id="12638633" author="yseeley@gmail.com" created="Fri, 10 Oct 2008 20:46:18 +0100"  >&lt;p&gt;Thanks, I just committed this.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12406053">SOLR-805</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12391834" name="LUCENE-1415.patch" size="3514" author="markrmiller@gmail.com" created="Thu, 9 Oct 2008 19:00:51 +0100" />
                    <attachment id="12391829" name="LUCENE-1415.patch" size="3190" author="markrmiller@gmail.com" created="Thu, 9 Oct 2008 18:18:51 +0100" />
                    <attachment id="12391821" name="MultiPhraseQuery.java" size="11344" author="tfeak" created="Thu, 9 Oct 2008 17:34:33 +0100" />
                    <attachment id="12391820" name="MultiPhraseQueryTest.java" size="917" author="tfeak" created="Thu, 9 Oct 2008 17:30:03 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 9 Oct 2008 00:59:24 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12336</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26313</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>