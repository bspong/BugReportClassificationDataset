<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:21:16 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-485/LUCENE-485.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-485] IndexWriter.mergeSegments should not hold the commit lock while cleaning up.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-485</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Same happens in IndexWriter.addIndexes(IndexReader[] readers).&lt;/p&gt;

&lt;p&gt;The commit lock should be obtained whenever the Index structure/version is read or written.  It should be kept for as short a period as possible.&lt;/p&gt;

&lt;p&gt;The write lock is needed to make sure only one IndexWriter or IndexReader instance can update the index (multiple IndexReaders can of course use the index for searching).&lt;/p&gt;

&lt;p&gt;The list of files that can be deleted is stored in the file &quot;deletable&quot;.  It is only read or written by the IndexWriter instance that holds the write lock, so there&apos;s no need to have the commit lock to to update it.&lt;/p&gt;

&lt;p&gt;On my production system deleting the obsolete segment files after a mergeSegments() happens can occasionally take several seconds&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and the commit lock blocks the searcher machines from updating their IndexReader instance.&lt;br/&gt;
Even on a standalone machine, the time to update the segments file is about 3ms, the time to delete the obsolete segments about 30ms.&lt;/p&gt;</description>
                <environment>&lt;p&gt;checked in revision 367361&lt;/p&gt;</environment>
            <key id="12327438">LUCENE-485</key>
            <summary>IndexWriter.mergeSegments should not hold the commit lock while cleaning up.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="lvl">Luc Vanlerberghe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jan 2006 04:11:13 +0000</created>
                <updated>Thu, 2 Jun 2011 23:03:49 +0100</updated>
                    <resolved>Sat, 27 May 2006 02:16:45 +0100</resolved>
                                            <fixVersion>2.0.0</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12370511" author="lvl" created="Wed, 15 Mar 2006 20:53:45 +0000"  >&lt;p&gt;This patch moves the calls to deleteFiles and deleteSegments outside of the blocks protected by a COMMIT lock.&lt;br/&gt;
Since only one process can have the WRITE lock this extra locking is not necessary for those calls and the COMMIT lock is available for other processes faster.&lt;/p&gt;</comment>
                    <comment id="12370563" author="cutting" created="Thu, 16 Mar 2006 02:41:57 +0000"  >&lt;p&gt;+1 This looks reasonable to me.  What is important is that IndexReader holds the COMMIT lock while all files are opened.  But the writer does not need to be held while they&apos;re removed, only while the set of files is changing, to keep readers from reading the set, then trying to open files after they&apos;ve been deleted.  This is still blocked after your patch, since the set cannot change while files are being opened.&lt;/p&gt;</comment>
                    <comment id="12370714" author="lvl" created="Fri, 17 Mar 2006 01:05:32 +0000"  >&lt;p&gt;Creating a TestCase that would show this is a valid patch is pretty difficult, but I&apos;m 100% sure it is valid and I applied it to a production system a couple of months ago without any problem.&lt;br/&gt;
Even if the lucene index is on a local harddisk, writing the updated segments file takes less than 10ms, while deleting the obsolete segments takes anywhere between 30 and 170ms... (on a Windows system that is...)&lt;/p&gt;</comment>
                    <comment id="12413509" author="cutting" created="Sat, 27 May 2006 02:16:45 +0100"  >&lt;p&gt;I committed this.  Thanks, Luc!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12324214" name="LUCENE-485.patch" size="2333" author="lvl" created="Wed, 15 Mar 2006 20:53:45 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 16 Mar 2006 02:41:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13264</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27241</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>