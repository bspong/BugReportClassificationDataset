<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:22:35 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3720/LUCENE-3720.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3720] OOM in TestBeiderMorseFilter.testRandom</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3720</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;This has been OOM&apos;ing a lot... we should see why, its likely a real bug.&lt;/p&gt;

&lt;p&gt;ant test -Dtestcase=TestBeiderMorseFilter -Dtestmethod=testRandom -Dtests.seed=2e18f456e714be89:310bba5e8404100d:-3bd11277c22f4591 -Dtests.multiplier=3 -Dargs=&quot;-Dfile.encoding=ISO8859-1&quot;&lt;/p&gt;</description>
                <environment></environment>
            <key id="12539634">LUCENE-3720</key>
            <summary>OOM in TestBeiderMorseFilter.testRandom</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jan 2012 17:16:22 +0000</created>
                <updated>Fri, 10 May 2013 11:33:43 +0100</updated>
                    <resolved>Mon, 17 Sep 2012 16:49:15 +0100</resolved>
                            <version>3.6</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>4.0</fixVersion>
                <fixVersion>5.0</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="13193937" author="rcmuir" created="Thu, 26 Jan 2012 16:17:33 +0000"  >&lt;p&gt;I&apos;m still working on a testcase for this.&lt;/p&gt;

&lt;p&gt;I think the underlying commons-codec algorithm &quot;blows up&quot; on some inputs, especially those from randomHtmlIshString.&lt;br/&gt;
Then given multiple threads its easy for it to OOM.&lt;/p&gt;

&lt;p&gt;So far the best i have is: (ant test -Dtestcase=TestBeiderMorseFilter -Dtestmethod=testOOM -Dtests.seed=320e23c1f5dbf9c5:-766b86e7dc5e81df:148a8a4955f89b5e -Dargs=&quot;-Dfile.encoding=UTF-8&quot; -Dtests.heapsize=64M&lt;/p&gt;

&lt;p&gt;This blows up, so I just have to get it to log the string that blows up I think, and we have a start to a testcase.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testOOM() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numIter = 100000;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numTokens = 0;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; numIter; i++) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s = _TestUtil.randomHtmlishString(random, 30);
      TokenStream ts = analyzer.tokenStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;bogus&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(s));
      ts.reset();
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (ts.incrementToken()) {
        numTokens++;
      }
      ts.end();
      ts.close();
    }
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(numTokens);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13193955" author="rcmuir" created="Thu, 26 Jan 2012 16:46:11 +0000"  >&lt;p&gt;Here&apos;s an initial test:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public void testOOM2() throws Exception {
    String test = &quot;200697900&apos;--&amp;gt;&amp;amp;#1913348150;&amp;lt;/  bceaeef &amp;gt;aadaabcf\&quot;aedfbff&amp;lt;!--\&apos;--&amp;gt;?&amp;gt;cae&quot; +
        &quot;cfaaa&amp;gt;&amp;lt;?&amp;amp;#&amp;lt;!--&amp;lt;/script&amp;gt;&amp;amp;lang&amp;amp;fc;aadeaf?&amp;gt;&amp;gt;&amp;amp;bdquo&amp;lt;    cc =\&quot;abff\&quot;    /&amp;gt;&amp;lt;/   afe  &amp;gt;&quot; +
        &quot;&amp;lt;script&amp;gt;&amp;lt;!-- f(&apos;;&amp;lt;    cf aefbeef = \&quot;bfabadcf\&quot; ebbfeedd = fccabeb &amp;gt;&quot;;
    TokenStream ts = analyzer.tokenStream(&quot;bogus&quot;, new StringReader(test));
    ts.reset();
    while (ts.incrementToken()) {
      ;
    }
    ts.end();
    ts.close();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ill see if i can make it blow up with a smaller string, and then port the test to just use commons-codec apis (not lucene ones).&lt;/p&gt;</comment>
                    <comment id="13194008" author="rcmuir" created="Thu, 26 Jan 2012 17:31:46 +0000"  >&lt;p&gt;Linking this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-132&quot; title=&quot;BeiderMorseEncoder OOM issues&quot;&gt;&lt;del&gt;CODEC-132&lt;/del&gt;&lt;/a&gt;, I attached a test case to that issue.&lt;/p&gt;</comment>
                    <comment id="13194053" author="rcmuir" created="Thu, 26 Jan 2012 18:28:19 +0000"  >&lt;p&gt;For now I added a big red bold warning and disabled the test.&lt;/p&gt;</comment>
                    <comment id="13194071" author="thetaphi" created="Thu, 26 Jan 2012 18:46:29 +0000"  >&lt;p&gt;I think we should disable the whole TokenFilter for now until this is fixed. It was not yet released as far as I know. So I would suggest to temporary &quot;svn rm&quot; it and revert this once this is fixed. This makes it disappear from 3.6 Release, but it&apos;s not lost. We should keep this issue open, until the root cause is fixed.&lt;/p&gt;</comment>
                    <comment id="13194087" author="mikemccand" created="Thu, 26 Jan 2012 19:05:18 +0000"  >&lt;p&gt;I don&apos;t think we need to remove the Tokenfilter just because it has a known bug.  It could be this is rarely hit in practice / on more normal input.  All software has bugs...&lt;/p&gt;</comment>
                    <comment id="13194106" author="rcmuir" created="Thu, 26 Jan 2012 19:24:41 +0000"  >&lt;p&gt;I suspect (as noted on &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-132&quot; title=&quot;BeiderMorseEncoder OOM issues&quot;&gt;&lt;del&gt;CODEC-132&lt;/del&gt;&lt;/a&gt;) that this is caused by certain punctuation. I can dig a little, could be we apply a temporary&lt;br/&gt;
workaround sanitising the offending character (and long term/better, create a fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-132&quot; title=&quot;BeiderMorseEncoder OOM issues&quot;&gt;&lt;del&gt;CODEC-132&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                    <comment id="13224628" author="rcmuir" created="Wed, 7 Mar 2012 19:28:26 +0000"  >&lt;p&gt;There is now a patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-132&quot; title=&quot;BeiderMorseEncoder OOM issues&quot;&gt;&lt;del&gt;CODEC-132&lt;/del&gt;&lt;/a&gt; , I haven&apos;t had the time to try to apply-rebuild-test with it, but it seems like the right fix.&lt;/p&gt;</comment>
                    <comment id="13231634" author="tn" created="Fri, 16 Mar 2012 21:12:13 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I looked at the testcase and it runs through with the patched commons-codec, but I received an assertion:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testcase: testRandom(org.apache.lucene.analysis.phonetic.TestBeiderMorseFilter):	FAILED
    [junit] term 8 expected:&amp;lt;skript[Skriptsk]ript&amp;gt; but was:&amp;lt;skript[dZriptdZ]ript&amp;gt;
    [junit] junit.framework.AssertionFailedError: term 8 expected:&amp;lt;skript[Skriptsk]ript&amp;gt; but was:&amp;lt;skript[dZriptdZ]ript&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13231641" author="rcmuir" created="Fri, 16 Mar 2012 21:22:16 +0000"  >&lt;p&gt;Hmm i havent tested the patched version yet myself, but thats probably where we check that&lt;br/&gt;
the output is deterministic (we replay the same random strings again and check the output is the same as before).&lt;/p&gt;</comment>
                    <comment id="13231907" author="tn" created="Sat, 17 Mar 2012 10:31:02 +0000"  >&lt;p&gt;The test starts multiple threads for the analysis, so maybe there is a concurrency problem in the BeiderMorseCodec.&lt;br/&gt;
When doing a similar test sequentially, the result is always the same.&lt;/p&gt;

&lt;p&gt;I will look further into this.&lt;/p&gt;</comment>
                    <comment id="13232021" author="tn" created="Sat, 17 Mar 2012 17:21:16 +0000"  >&lt;p&gt;The BeiderMorseFilter uses internally a java.util.regex.Matcher which is not supposed to be thread-safe. When doing the random test, the same analyzer is used by different threads, so my first guess would be that the problems are related to this somehow.&lt;/p&gt;</comment>
                    <comment id="13232264" author="rcmuir" created="Sun, 18 Mar 2012 12:32:02 +0000"  >&lt;p&gt;Thomas: the filter is ok, it does not need to be thread safe.&lt;br/&gt;
Analyzer has as threadlocal for the tokenizer chain, each&lt;br/&gt;
thread gets its own filter.&lt;/p&gt;</comment>
                    <comment id="13232325" author="tn" created="Sun, 18 Mar 2012 18:28:48 +0000"  >&lt;p&gt;Ok, it took me some time to understand the test and filter code. In fact my original statement was wrong, the output order of phoneme tokens from the codec was not deterministic. This has been fixed in commons-codec, and the test runs through now.&lt;/p&gt;

&lt;p&gt;btw. the next release will happen quite soon afaik and will also include a new phonetic encoder called Nysiis, which should perform slightly better than Soundex (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-63&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/browse/CODEC-63&lt;/a&gt;). Any feedback is very welcome!&lt;/p&gt;</comment>
                    <comment id="13232738" author="rcmuir" created="Mon, 19 Mar 2012 17:16:35 +0000"  >&lt;p&gt;Thanks so much for digging into this Thomas!&lt;/p&gt;

&lt;p&gt;When the release comes out we can add support and tests for the new encoder too.&lt;/p&gt;</comment>
                    <comment id="13456408" author="rcmuir" created="Sat, 15 Sep 2012 14:32:20 +0100"  >&lt;p&gt;Commons-codec 1.7 has been released with fixes. I&apos;m testing them out now.&lt;/p&gt;</comment>
                    <comment id="13456410" author="rcmuir" created="Sat, 15 Sep 2012 14:43:47 +0100"  >&lt;p&gt;patch upgrading the jar, re-enabling the test, and removing the warnings.&lt;/p&gt;

&lt;p&gt;I ran the following 100 times from a shell script with no fails:&lt;/p&gt;

&lt;p&gt;ant test -Dtestcase=TestBeiderMorseFilter -Dtests.multiplier=3 -Dtests.nightly=true -Dtestmethod=testRandom&lt;/p&gt;</comment>
                    <comment id="13456411" author="rcmuir" created="Sat, 15 Sep 2012 14:47:54 +0100"  >&lt;p&gt;I looked, it seems they are still in the release process (its just that 1.7 is starting to appear on mirrors).&lt;/p&gt;

&lt;p&gt;we should wait until the official release announcement for the upgrade.&lt;/p&gt;</comment>
                    <comment id="13457075" author="rcmuir" created="Mon, 17 Sep 2012 16:17:23 +0100"  >&lt;p&gt;Release is officially out: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/www-announce/201209.mbox/%3CCACZkXPz4wOAzRVf41h6PSVDp9PV-3uj%3D8e2ZViByeX5EpmYWzw%40mail.gmail.com%3E&quot; class=&quot;external-link&quot;&gt;http://mail-archives.apache.org/mod_mbox/www-announce/201209.mbox/%3CCACZkXPz4wOAzRVf41h6PSVDp9PV-3uj%3D8e2ZViByeX5EpmYWzw%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll run tests/checks with the patch and commit shortly.&lt;/p&gt;</comment>
                    <comment id="13457102" author="rcmuir" created="Mon, 17 Sep 2012 16:49:15 +0100"  >&lt;p&gt;Thanks for fixing this Thomas!&lt;/p&gt;

&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-4400&quot; title=&quot;add support for new commons-codec encoder (nysiis)&quot;&gt;LUCENE-4400&lt;/a&gt; to add support for the new 1.7 encoder.&lt;/p&gt;</comment>
                    <comment id="13610822" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:37:53 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Robert Muir&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1386670&quot; class=&quot;external-link&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1386670&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3720&quot; title=&quot;OOM in TestBeiderMorseFilter.testRandom&quot;&gt;&lt;del&gt;LUCENE-3720&lt;/del&gt;&lt;/a&gt;: fix BeiderMorseFilter OOM issues&lt;/p&gt;</comment>
                    <comment id="13654006" author="thetaphi" created="Fri, 10 May 2013 11:33:43 +0100"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12539933">CODEC-132</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12545277" name="LUCENE-3720.patch" size="6782" author="rcmuir" created="Sat, 15 Sep 2012 14:43:47 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 26 Jan 2012 18:46:29 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>225137</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>23978</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>