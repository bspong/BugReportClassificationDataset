<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:32:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-365/LUCENE-365.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-365] [PATCH] Performance improvement to DisjunctionSumScorer</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-365</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;A recent profile of the new BooleanScorer2 showed that &lt;br/&gt;
quite a bit of CPU time is spent in the advanceAfterCurrent method &lt;br/&gt;
of DisjunctionScorer, and in the PriorityQueue of scorers that &lt;br/&gt;
is used there. &lt;/p&gt;

&lt;p&gt;This patch reduces the internal overhead of DisjunctionScorer &lt;br/&gt;
to about 70% of the current one (ie. 30% saving in cpu time). &lt;br/&gt;
It also reduces the number of calls to the subscorers, but &lt;br/&gt;
that was not measured. &lt;/p&gt;

&lt;p&gt;To get this, it was necessary to specialize the PriorityQueue &lt;br/&gt;
for a Scorer and to add move some code fragments from DisjunctionScorer &lt;br/&gt;
to this specialized queue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
            <key id="12314515">LUCENE-365</key>
            <summary>[PATCH] Performance improvement to DisjunctionSumScorer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="paul.elschot@xs4all.nl">Paul Elschot</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Mar 2005 08:24:14 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:20 +0100</updated>
                    <resolved>Wed, 18 Oct 2006 01:56:42 +0100</resolved>
                                            <fixVersion>2.1</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>2</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12322252" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:26:53 +0100"  >&lt;p&gt;Created an attachment (id=14570)&lt;br/&gt;
A priority queue specialised for use in DisjunctionSumScorer&lt;/p&gt;

&lt;p&gt;This is in the org.apache.lucene.util package. It might&lt;br/&gt;
be better in the search package, but that is a matter of taste.&lt;/p&gt;</comment>
                    <comment id="12322253" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:28:50 +0100"  >&lt;p&gt;Created an attachment (id=14571)&lt;br/&gt;
DisjunctionSumScorer.java adapted to use a new queue of scorers&lt;/p&gt;</comment>
                    <comment id="12322254" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:33:16 +0100"  >&lt;p&gt;Created an attachment (id=14572)&lt;br/&gt;
TestDisjunctionPerf1.java, some measurements on disjunctions of scorers&lt;/p&gt;

&lt;p&gt;This is probably not needed in the trunk. It was used to measure&lt;br/&gt;
the differences in CPU time spent in BooleanScorer with and without&lt;br/&gt;
skipTo and in DisjunctionScorer.&lt;br/&gt;
It also contains the results of some of the measurements done, and&lt;br/&gt;
some conclusions, all as comments.&lt;/p&gt;</comment>
                    <comment id="12322255" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:36:23 +0100"  >&lt;p&gt;The priority queue is named ScorerDocQueue.java &lt;/p&gt;

&lt;p&gt;TestDisjunctionPerf1.java depends on the BooleanScorer.java posted &lt;br/&gt;
in bug 33019 for correctly (hopefully) sorting the documents &lt;br/&gt;
to allow skipTo(). &lt;/p&gt;

</comment>
                    <comment id="12322256" author="paul.elschot@xs4all.nl" created="Wed, 30 Mar 2005 08:37:11 +0100"  >&lt;p&gt;The profile that started this was generously provided by &lt;a href=&quot;http://www.it.com&quot; class=&quot;external-link&quot;&gt;http://www.it.com&lt;/a&gt; . &lt;/p&gt;

&lt;p&gt;Regards, &lt;br/&gt;
Paul Elschot (not otherwise related to www.it.com) &lt;/p&gt;

</comment>
                    <comment id="12322257" author="paul.elschot@xs4all.nl" created="Sun, 22 May 2005 21:20:50 +0100"  >&lt;p&gt;Created an attachment (id=15117)&lt;br/&gt;
Another alternative to BooleanScorer using a Btree&lt;/p&gt;

&lt;p&gt;As posted today on java-dev by Karl Wright.&lt;/p&gt;

&lt;p&gt;The performance of the unbalanced btree could be compared&lt;br/&gt;
to the specialised priority queue.&lt;/p&gt;

&lt;p&gt;The code can also be simplified to the disjunction case,&lt;br/&gt;
which boils down to adapting from 1.4.3 to the trunk.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Paul Elschot&lt;/p&gt;</comment>
                    <comment id="12373454" author="yseeley@gmail.com" created="Thu, 6 Apr 2006 11:26:09 +0100"  >&lt;p&gt;Nice Paul!&lt;/p&gt;

&lt;p&gt;I was just doing some performance work in the last week and noticed that DisjunctionSumScorer was taking up a fair amount of time (the queries consisted of a very large number of disjunctions).  I had planned on making a specialized heap for Scorers once I reviewed the code (until I ran across this bug).&lt;/p&gt;

&lt;p&gt;I&apos;m personally only committing bug fixes for Lucene 2.0, but after that, I&apos;ll commit this.&lt;/p&gt;</comment>
                    <comment id="12373488" author="paul.elschot@xs4all.nl" created="Thu, 6 Apr 2006 16:01:23 +0100"  >&lt;p&gt;For the normal case with only one required subscorer this patch is ok., but for the case with&lt;br/&gt;
more required subscorers, a better implementation is possible.&lt;/p&gt;

&lt;p&gt;This would use an array for the required number of subscorers just like ConjunctionScorer,&lt;br/&gt;
and a scorer queue for the remaining ones.&lt;br/&gt;
This has the additional advantage that calling score() on the subscorers can be delayed until there&lt;br/&gt;
are enough matching subscorers.&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-413&quot; title=&quot;[PATCH] BooleanScorer2 ArrayIndexOutOfBoundsException + alternative NearSpans&quot;&gt;&lt;del&gt;LUCENE-413&lt;/del&gt;&lt;/a&gt; seems to be fixed, and BooleanScorer2 can easily distinguish the cases of one or&lt;br/&gt;
more required subscorers,  (there are quite a few cases already there...) I think ScorerDocQueue&lt;br/&gt;
can go ahead whenever practical.&lt;/p&gt;</comment>
                    <comment id="12373489" author="paul.elschot@xs4all.nl" created="Thu, 6 Apr 2006 16:28:48 +0100"  >&lt;p&gt;For top level disjunctions, the original BooleanScorer could well be the best performing one.&lt;br/&gt;
To have this it would be necessary to implement score(HitCollector, maxDocNr) in&lt;br/&gt;
DisjunctionSumScorer.&lt;br/&gt;
(Yet another case for BooleanScorer2 ...)&lt;/p&gt;




</comment>
                    <comment id="12402404" author="paul.elschot@xs4all.nl" created="Tue, 16 May 2006 04:12:40 +0100"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-333&quot; title=&quot;[PATCH] BooleanScorer can score documents in non increasing order&quot;&gt;&lt;del&gt;LUCENE-333&lt;/del&gt;&lt;/a&gt; for other available implementations of disjunction.&lt;/p&gt;</comment>
                    <comment id="12443056" author="yseeley@gmail.com" created="Tue, 17 Oct 2006 21:25:46 +0100"  >&lt;p&gt;Paul, would it be possible to get a version with a license granted to the ASF?&lt;br/&gt;
Also, a single patch file would be preferred (I believe there have been changes, such as &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-413&quot; title=&quot;[PATCH] BooleanScorer2 ArrayIndexOutOfBoundsException + alternative NearSpans&quot;&gt;&lt;del&gt;LUCENE-413&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                    <comment id="12443062" author="paul.elschot@xs4all.nl" created="Tue, 17 Oct 2006 21:48:54 +0100"  >&lt;p&gt;The ASF licence is in the sources, this is from before jira.&lt;br/&gt;
I&apos;ll add a patch with the ASF licence soon.&lt;/p&gt;
</comment>
                    <comment id="12443077" author="yseeley@gmail.com" created="Tue, 17 Oct 2006 22:23:28 +0100"  >&lt;p&gt;&amp;gt; The ASF licence is in the sources&lt;/p&gt;

&lt;p&gt;Yeah, I was just trying to be safe.&lt;br/&gt;
It seems like there might be a small distinction between granting a license to the ASF, and including an ASF license in the header.  Does anyone know if it matters?&lt;/p&gt;</comment>
                    <comment id="12443100" author="paul.elschot@xs4all.nl" created="Tue, 17 Oct 2006 23:23:05 +0100"  >&lt;p&gt;This patch obsoletes DisjunctionSumScorer and ScorerDocQueue as attached earlier.&lt;br/&gt;
All tests pass here.&lt;/p&gt;

&lt;p&gt;TestDisjunctionPerf1 and BooleanScorerBtree are for performance testing only.&lt;br/&gt;
BooleanScorerBtree could be faster then this version of DisjunctionSumScorer&lt;br/&gt;
for a relatively small number of subscorers.&lt;br/&gt;
I did not include these in the patch because TestDisjunctionPerf1 depends on&lt;br/&gt;
older versions of BooleanScorer with local names.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Paul Elschot&lt;/p&gt;</comment>
                    <comment id="12443135" author="yseeley@gmail.com" created="Wed, 18 Oct 2006 01:56:14 +0100"  >&lt;p&gt;Thanks Paul,&lt;br/&gt;
This patch seemed to revert the following:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12324730/DisjunctionSumScorerPatch5.txt&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/secure/attachment/12324730/DisjunctionSumScorerPatch5.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I assume it&apos;s unintentional so I&apos;ve added back that part and committed.&lt;/p&gt;</comment>
                    <comment id="12443194" author="paul.elschot@xs4all.nl" created="Wed, 18 Oct 2006 08:30:49 +0100"  >&lt;p&gt;That was indeed not intentional, thanks for adding it back.&lt;/p&gt;

&lt;p&gt;To my surprise the svn update applied cleanly on&lt;br/&gt;
DisjunctionSumScorer.java here, and these tests still pass here:&lt;/p&gt;

&lt;p&gt;ant -Dtestcase=&quot;TestBool*&quot; test&lt;br/&gt;
ant -Dtestcase=&quot;TestDis*&quot; test&lt;/p&gt;</comment>
                    <comment id="12476254" author="mikemccand" created="Tue, 27 Feb 2007 18:10:32 +0000"  >&lt;p&gt;Closing all issues that were resolved for 2.1.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312549" name="ASF.LICENSE.NOT.GRANTED--BooleanScorerBtree.java" size="12653" author="paul.elschot@xs4all.nl" created="Sun, 22 May 2005 21:20:50 +0100" />
                    <attachment id="12312547" name="ASF.LICENSE.NOT.GRANTED--DisjunctionSumScorer.java" size="8243" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:28:50 +0100" />
                    <attachment id="12312546" name="ASF.LICENSE.NOT.GRANTED--ScorerDocQueue.java" size="6153" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:26:53 +0100" />
                    <attachment id="12312548" name="ASF.LICENSE.NOT.GRANTED--TestDisjunctionPerf1.java" size="8161" author="paul.elschot@xs4all.nl" created="Sun, 27 Mar 2005 08:33:16 +0100" />
                    <attachment id="12343113" name="DisjunctionSumScorer20061017.patch" size="16627" author="paul.elschot@xs4all.nl" created="Tue, 17 Oct 2006 23:23:05 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>34193</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 6 Apr 2006 10:26:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13384</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27366</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>