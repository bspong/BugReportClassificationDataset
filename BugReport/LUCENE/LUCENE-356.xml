<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:05 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-356/LUCENE-356.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-356] ArrayIndexOutOfBoundsException when using MultiFieldQueryParser</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-356</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We get the following exception:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
        at java.util.Vector.elementAt(Vector.java:434)&lt;br/&gt;
        at org.apache.lucene.queryParser.QueryParser.addClause(QueryParser.java:181)&lt;br/&gt;
        at org.apache.lucene.queryParser.QueryParser.Query(QueryParser.java:529)&lt;br/&gt;
        at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:108)&lt;br/&gt;
        at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:87)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.lucene.queryParser.MultiFieldQueryParser.parse(MultiFieldQueryParser.java:77)&lt;br/&gt;
        at idx.Mquery.main(Mquery.java:64)&lt;/p&gt;


&lt;p&gt;We are using a query with &apos;AND&apos; like &apos;bla AND blo&apos; on 5 fields.&lt;br/&gt;
One of the fields has a Tokenizer which returns no token&lt;br/&gt;
at all on this query, and this together with the AND&lt;br/&gt;
triggers the exception.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Linux&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
            <key id="12314506">LUCENE-356</key>
            <summary>ArrayIndexOutOfBoundsException when using MultiFieldQueryParser</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="java-dev@lucene.apache.org">Lucene Developers</assignee>
                                <reporter username="pifpafpuf@gmx.de">Harald Kirsch</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Mar 2005 00:14:01 +0000</created>
                <updated>Sat, 27 May 2006 02:38:57 +0100</updated>
                    <resolved>Sat, 27 May 2006 02:38:57 +0100</resolved>
                            <version>1.4</version>
                                                <component>core/queryparser</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12322224" author="daniel.naber@t-online.de" created="Thu, 10 Mar 2005 03:35:09 +0000"  >&lt;p&gt;Could you please either check if the problem persists with the latest version &lt;br/&gt;
from subversion or submit a small test case that makes this easy to reproduce? &lt;/p&gt;</comment>
                    <comment id="12322225" author="john.wang@gmail.com" created="Mon, 16 May 2005 03:10:15 +0100"  >&lt;p&gt;Created an attachment (id=15035)&lt;br/&gt;
Added a nullcheck for Query instances before adding to the multi clause.&lt;/p&gt;

&lt;p&gt;I wrote a unit test to try to recreate this issue with the latest trunk code. I&lt;br/&gt;
see that the ArrayIndexOutofBounds issue is gone. However, I do see null&lt;br/&gt;
Queries are added to resulting Query when switching from the deprecated method&lt;br/&gt;
by using the non-static parse method. After a little investigation, I see that&lt;br/&gt;
it is missing some null checks.&lt;/p&gt;

&lt;p&gt;Here is the unit test and attached is the modified source of&lt;br/&gt;
MultiFieldQueryParser.java.&lt;/p&gt;

&lt;p&gt;public static void main(String[] args) throws Exception{&lt;/p&gt;

&lt;p&gt;		String[] fields=new String[]&lt;/p&gt;
{&quot;f1&quot;,&quot;f2&quot;,&quot;f3&quot;,&quot;f4&quot;,&quot;f5&quot;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;		MultiFieldQueryParser parser=new&lt;br/&gt;
MultiFieldQueryParser(fields,new TestAnalyzer(fields));&lt;br/&gt;
		String qString=&quot;bla AND blo&quot;;&lt;/p&gt;

&lt;p&gt;		Query q=parser.parse(qString);&lt;/p&gt;

&lt;p&gt;		System.out.println(q);&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;	static class TestAnalyzer extends Analyzer{&lt;br/&gt;
		String[] _defaultFields;&lt;br/&gt;
		StandardAnalyzer _std;&lt;br/&gt;
		public TestAnalyzer(String[] defaultFields)&lt;/p&gt;
{
			_defaultFields=defaultFields;
			_std=new StandardAnalyzer();
		}
&lt;p&gt;		public TokenStream tokenStream(String fieldName, Reader reader)&lt;br/&gt;
{&lt;br/&gt;
			if (&quot;f1&quot;.equals(fieldName))&lt;/p&gt;
{
				return new EmptyTokenStream();
			}
&lt;p&gt;			else&lt;/p&gt;
{
				return _std.tokenStream(fieldName, reader);
			}
&lt;p&gt;		}&lt;/p&gt;

&lt;p&gt;		private static class EmptyTokenStream extends TokenStream{&lt;/p&gt;

&lt;p&gt;			public Token next() throws IOException &lt;/p&gt;
{
				return null;
			}

&lt;p&gt;		}&lt;br/&gt;
	}&lt;/p&gt;</comment>
                    <comment id="12322226" author="john.wang@gmail.com" created="Mon, 16 May 2005 03:28:16 +0100"  >&lt;p&gt;Created an attachment (id=15036)&lt;br/&gt;
merged the two idential implementations of getFieldQuery methods&lt;/p&gt;

&lt;p&gt;This attachment includes the changes in the previous patch: (15035)&lt;/p&gt;

&lt;p&gt;The 2 getFieldQuery methods with different method signatures are implmented&lt;br/&gt;
with identical code in that the Analyzer parameter is ignored.&lt;/p&gt;

&lt;p&gt;This attachment cleaned this up.&lt;/p&gt;</comment>
                    <comment id="12322227" author="lucenebugs@danielnaber.de" created="Wed, 29 Jun 2005 07:46:00 +0100"  >&lt;p&gt;John, thanks for your examples. I have adapted your patch and committed it. &lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312535" name="ASF.LICENSE.NOT.GRANTED--MultiFieldQueryParser.java" size="11855" author="john.wang@gmail.com" created="Mon, 16 May 2005 03:28:16 +0100" />
                    <attachment id="12312534" name="ASF.LICENSE.NOT.GRANTED--MultiFieldQueryParser.java" size="12092" author="john.wang@gmail.com" created="Mon, 16 May 2005 03:10:15 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>33848</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 10 Mar 2005 03:35:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13393</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27375</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>