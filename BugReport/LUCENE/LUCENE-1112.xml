<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:49 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1112/LUCENE-1112.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1112] Document is partially indexed on an unhandled exception</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1112</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-843&quot; title=&quot;improve how IndexWriter uses RAM to buffer added documents&quot;&gt;&lt;del&gt;LUCENE-843&lt;/del&gt;&lt;/a&gt;, it&apos;s now possible for a subset of a document&apos;s&lt;br/&gt;
fields/terms to be indexed or stored when an exception is hit.  This&lt;br/&gt;
was not the case in the past (it was &quot;all or none&quot;).&lt;/p&gt;

&lt;p&gt;I plan to make it &quot;all or none&quot; again by immediately marking a&lt;br/&gt;
document as deleted if any exception is hit while indexing it.&lt;/p&gt;

&lt;p&gt;Discussion leading up to this:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://www.gossamer-threads.com/lists/lucene/java-dev/56103&quot; class=&quot;external-link&quot;&gt;http://www.gossamer-threads.com/lists/lucene/java-dev/56103&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
            <key id="12385368">LUCENE-1112</key>
            <summary>Document is partially indexed on an unhandled exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Dec 2007 10:47:20 +0000</created>
                <updated>Fri, 25 Jan 2008 03:24:16 +0000</updated>
                    <resolved>Thu, 3 Jan 2008 15:53:01 +0000</resolved>
                            <version>2.3</version>
                                <fixVersion>2.3</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12555085" author="doronc" created="Mon, 31 Dec 2007 12:01:02 +0000"  >&lt;p&gt;Patch demonstrating the problem: testWickedLongTerm() modified to fail when numDocs grows although addDocument() throws an exception.&lt;/p&gt;</comment>
                    <comment id="12555119" author="mikemccand" created="Mon, 31 Dec 2007 18:12:04 +0000"  >&lt;p&gt;Thanks Doron; I&apos;ll fold this in (though, I&apos;ll move it to the testExceptionFromTokenStream case since it looks like we&apos;re going to no longer throw an exception on hitting a wicked-long-term).&lt;/p&gt;</comment>
                    <comment id="12555201" author="mikemccand" created="Tue, 1 Jan 2008 14:14:34 +0000"  >&lt;p&gt;Patch attached.  All tests pass.  I plan to commit in a day or two.&lt;/p&gt;

&lt;p&gt;Here are the changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;No longer throw an exception when massive term is hit.  Instead,&lt;br/&gt;
    we now print this message to infoStream, if set:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      WARNING: document contains at least one immense term (longer than the max length 16383), all of which were skipped.  Please correct the analyzer to not produce such terms.  The prefix of the first immense term is: &apos;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...&apos;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Still increment position when we hit a massive term&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;An unhandled &quot;non-aborting&quot; exception immediately marks the&lt;br/&gt;
    document that hit the exception as deleted.  I added comments at&lt;br/&gt;
    the top of DocumentsWriter to explain aborting vs non-aborting&lt;br/&gt;
    exceptions.  This change actually adds the infrastructure for&lt;br/&gt;
    deleting by doc ID, which we&apos;ve discussed adding to IW in the&lt;br/&gt;
    past, but, I haven&apos;t exposed any public APIs for doing so.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;No longer log to infoStream how many docs were deleted on flush&lt;br/&gt;
    since that deletion count is not accurate when mixing delete by&lt;br/&gt;
    term and by docID.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12555225" author="doronc" created="Tue, 1 Jan 2008 22:27:51 +0000"  >&lt;p&gt;I skimmed at the long token part of the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In the test, why is the position increment of &apos;another&apos; 3,&lt;br/&gt;
  I think it should be 2?&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;failed document should not be in the index&quot;,2,reader.numDocs());&lt;br/&gt;
  should be &quot;document with skipped token should be in the index&quot;?&lt;/li&gt;
	&lt;li&gt;I believe that &quot;positon++&quot; in DocumentsWriter is not required because&lt;br/&gt;
  invertField() already incremented the position before calling addPosition()?&lt;br/&gt;
  (my fault, I suggested to still increment the position...)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12555226" author="mikemccand" created="Tue, 1 Jan 2008 22:47:18 +0000"  >&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;In the test, why is the position increment of &apos;another&apos; 3,&lt;br/&gt;
I think it should be 2?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not &quot;position increment&quot; that&apos;s 3, it&apos;s &quot;position&quot; that&apos;s 3?  And I think it should be 3 because this field is &quot;abc xyz &amp;lt;massive-term&amp;gt; another term&quot;, so another should have position 3 since we count &amp;lt;massive-term&amp;gt; as one position?&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;assertEquals(&quot;failed document should not be in the index&quot;,2,reader.numDocs());&lt;br/&gt;
should be &quot;document with skipped token should be in the index&quot;?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Woops, yes, I&apos;ll fix the string.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I believe that &quot;positon++&quot; in DocumentsWriter is not required because&lt;br/&gt;
invertField() already incremented the position before calling addPosition()?&lt;br/&gt;
(my fault, I suggested to still increment the position...)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Well, invertField increments by positionIncrement minus 1, then addPosition increments by 1 (this mirrors how DocumentWriter used to work).&lt;/p&gt;</comment>
                    <comment id="12555250" author="doronc" created="Wed, 2 Jan 2008 05:40:12 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It&apos;s not &quot;position increment&quot; that&apos;s 3, it&apos;s &quot;position&quot; that&apos;s 3?&lt;br/&gt;
...&lt;br/&gt;
Well, invertField increments by positionIncrement minus 1, then addPosition increments by 1 (this mirrors how DocumentWriter used to work).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right, my mistake.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12372379" name="LUCENE-1112.patch" size="20425" author="mikemccand" created="Tue, 1 Jan 2008 14:14:34 +0000" />
                    <attachment id="12372358" name="lucene-1112-test.patch" size="833" author="doronc" created="Mon, 31 Dec 2007 12:01:01 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 31 Dec 2007 12:01:02 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12633</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26617</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>