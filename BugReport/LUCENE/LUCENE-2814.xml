<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:06:27 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2814/LUCENE-2814.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2814] stop writing shared doc stores across segments</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2814</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Shared doc stores enables the files for stored fields and term vectors to be shared across multiple segments.  We&apos;ve had this optimization since 2.1 I think.&lt;/p&gt;

&lt;p&gt;It works best against a new index, where you open an IW, add lots of docs, and then close it.  In that case all of the written segments will reference slices a single shared doc store segment.&lt;/p&gt;

&lt;p&gt;This was a good optimization because it means we never need to merge these files.  But, when you open another IW on that index, it writes a new set of doc stores, and then whenever merges take place across doc stores, they must now be merged.&lt;/p&gt;

&lt;p&gt;However, since we switched to shared doc stores, there have been two optimizations for merging the stores.  First, we now bulk-copy the bytes in these files if the field name/number assignment is &quot;congruent&quot;.  Second, we now force congruent field name/number mapping in IndexWriter.  This means this optimization is much less potent than it used to be.&lt;/p&gt;

&lt;p&gt;Furthermore, the optimization adds &lt;b&gt;a lot&lt;/b&gt; of hair to IndexWriter/DocumentsWriter; this has been the source of sneaky bugs over time, and causes odd behavior like a merge possibly forcing a flush when it starts.  Finally, with DWPT (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2324&quot; title=&quot;Per thread DocumentsWriters that write their own private segments&quot;&gt;&lt;del&gt;LUCENE-2324&lt;/del&gt;&lt;/a&gt;), which gets us truly concurrent flushing, we can no longer share doc stores.&lt;/p&gt;

&lt;p&gt;So, I think we should turn off the write-side of shared doc stores to pave the path for DWPT to land on trunk and simplify IW/DW.  We still must support reading them (until 5.0), but the read side is far less hairy.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12493098">LUCENE-2814</key>
            <summary>stop writing shared doc stores across segments</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Dec 2010 18:28:45 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:10 +0100</updated>
                    <resolved>Wed, 5 Jan 2011 17:34:38 +0000</resolved>
                            <version>3.1</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12971057" author="earwin" created="Mon, 13 Dec 2010 22:30:17 +0000"  >&lt;p&gt;I&apos;ll take this. I think.&lt;/p&gt;</comment>
                    <comment id="12971155" author="shaie" created="Tue, 14 Dec 2010 04:12:15 +0000"  >&lt;p&gt;This is great Mike. Does this mean we will be able to merge non consecutive segments?&lt;/p&gt;</comment>
                    <comment id="12971234" author="mikemccand" created="Tue, 14 Dec 2010 11:27:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Does this mean we will be able to merge non consecutive segments?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well... it&apos;s rather decoupled from this issue.  Meaning, we were always free to allow non-contiguous merges, and segment would simply have forced the merge of the doc stores in that case.&lt;/p&gt;

&lt;p&gt;But, yes, because of the same reasons above, such a merge policy is much lower perf hit than it used to be.  And so now it is again compelling to explore this.... we just have to go and do &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1076&quot; title=&quot;Allow MergePolicy to select non-contiguous merges&quot;&gt;&lt;del&gt;LUCENE-1076&lt;/del&gt;&lt;/a&gt;.  I think it should not be hard; we just have to relax the merge methods in IW that check that the segments are contiguous.&lt;/p&gt;

&lt;p&gt;This added freedom for the merge policy would be compelling, ie, it can then do a much better job cherry picking similarly sized segments for merging.  I think it&apos;d also simplify merge policies like BalancedSegMP, eg (I think?) no longer requiring a viterbi search to pick the best merges.&lt;/p&gt;</comment>
                    <comment id="12971239" author="mikemccand" created="Tue, 14 Dec 2010 11:54:17 +0000"  >&lt;p&gt;Thanks Earwin &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We should verify the back-compat test has at least one index w/ shared doc stores.&lt;/p&gt;

&lt;p&gt;DocumentsWriter should get simpler, ie its closeDocStores is now private, and, it should no longer need to call writer.checkpoint() since it will no longer alter the SIS (and no longer build a cfx file) on closing the doc stores.&lt;/p&gt;

&lt;p&gt;It would be nice to remove the closeDocStore methods from the full indexing chain, since now each component should do that itself, privately, on flush, but maybe we should do that as a 2nd step?&lt;/p&gt;</comment>
                    <comment id="12971248" author="earwin" created="Tue, 14 Dec 2010 12:20:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should verify the back-compat test has at least one index w/ shared doc stores.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe I&apos;ve seen some back-compat failures with my quick&apos;n&apos;dirty patch that removed both reading and writing shared docstores.&lt;br/&gt;
So it should be ok.&lt;/p&gt;</comment>
                    <comment id="12972058" author="earwin" created="Thu, 16 Dec 2010 12:15:42 +0000"  >&lt;p&gt;First iteration.&lt;/p&gt;

&lt;p&gt;Passes all tests except TestNRTThreads. Something to do with numDocsInStore and numDocsInRam merged together?&lt;br/&gt;
Lots of non-critical nocommits (just markers for places I&apos;d like to recheck).&lt;br/&gt;
DW.docStoreEnabled and *.closeDocStore() have to go, before committing&lt;/p&gt;</comment>
                    <comment id="12972141" author="mikemccand" created="Thu, 16 Dec 2010 16:53:47 +0000"  >&lt;p&gt;Same as Earwin&apos;s patch just sync&apos;d w/ current trunk.&lt;/p&gt;</comment>
                    <comment id="12972173" author="mikemccand" created="Thu, 16 Dec 2010 18:18:59 +0000"  >&lt;p&gt;OK I dug here... the reason why TestNRTThreads fails is because you moved the numDocsInRAM++ out of DW.getThreadState into WaitQueue.writeDocument.&lt;/p&gt;

&lt;p&gt;When we buffer del terms in DW.deleteTerm/Terms/Query/Queries, we grab the current numDocsInRAM as the &quot;docID upto&quot;, to record when it comes time to apply the delete which docID we must stop at.&lt;/p&gt;

&lt;p&gt;But with your change, this value is now an undercount, since numDocsInRAM is now acting like numDocsInStore.&lt;/p&gt;

&lt;p&gt;One way to fix this would be to change the delete methods to use nextDocID instead of numDocsInRAM?&lt;/p&gt;

&lt;p&gt;But I think I&apos;d prefer to put back numDocsInRAM++ in getThreadState...&lt;/p&gt;</comment>
                    <comment id="12972227" author="michaelbusch" created="Thu, 16 Dec 2010 21:52:40 +0000"  >&lt;p&gt;The shared doc stores are actually already completely removed in the realtime branch (part of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2324&quot; title=&quot;Per thread DocumentsWriters that write their own private segments&quot;&gt;&lt;del&gt;LUCENE-2324&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Does someone want to help with the merge, then we can land the realtime branch (which is pretty much only DWPT and removing doc stores) in trunk sometime soon?&lt;/p&gt;</comment>
                    <comment id="12972259" author="earwin" created="Thu, 16 Dec 2010 22:38:40 +0000"  >&lt;p&gt;Ugh.&lt;br/&gt;
On first glance @ realtime branch, my patch is not a strict subset. But most stuff, including things I&apos;m struggling with now, is definetly in.&lt;br/&gt;
So, I guess, I&apos;ll stop wasting effort.&lt;/p&gt;

&lt;p&gt;What is the state for realtime branch? Is it stable? How soon is &quot;sometime soon&quot;? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12972275" author="michaelbusch" created="Thu, 16 Dec 2010 22:54:52 +0000"  >&lt;p&gt;Well I need to merge with the recent changes in trunk (especially &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2680&quot; title=&quot;Improve how IndexWriter flushes deletes against existing segments&quot;&gt;&lt;del&gt;LUCENE-2680&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
The merge is pretty hard, but I&apos;m planning to spend most of my weekend on it. &lt;/p&gt;

&lt;p&gt;If I can get most tests to pass again (most were passing before the merge), then I think the only outstanding thing is &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2573&quot; title=&quot;Tiered flushing of DWPTs by RAM with low/high water marks&quot;&gt;&lt;del&gt;LUCENE-2573&lt;/del&gt;&lt;/a&gt; before we could land it in trunk.&lt;/p&gt;
</comment>
                    <comment id="12972286" author="mikemccand" created="Thu, 16 Dec 2010 23:22:45 +0000"  >&lt;p&gt;I think taking things one step at a time would be good here?&lt;/p&gt;

&lt;p&gt;Ie remove doc stores from trunk, let that bake on trunk for a while, then merge to RT?  So that what then remains on RT is DWPT / tiered flushing?  Else RT is a monster change?&lt;/p&gt;</comment>
                    <comment id="12972288" author="michaelbusch" created="Thu, 16 Dec 2010 23:31:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think taking things one step at a time would be good here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably still a smaller change than flex indexing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But yeah in general I agree that we should do things more incrementally.  I think that&apos;s a mistake I&apos;ve made with the RT branch so far.  In this particular case it&apos;s just a bit sad to redo all this work now, because I think I got the removal of doc stores right in RT and all related tests to pass.&lt;/p&gt;</comment>
                    <comment id="12972298" author="earwin" created="Thu, 16 Dec 2010 23:48:45 +0000"  >&lt;p&gt;So, what&apos;s the plan?&lt;/p&gt;</comment>
                    <comment id="12972302" author="michaelbusch" created="Fri, 17 Dec 2010 00:03:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;So, what&apos;s the plan?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can&apos;t really work on this much before Saturday.  But during the weekend I can work on the RT merge and maybe try to pull out the docstore removal changes and create a separate patch.  Have to see how hard that is.  If it&apos;s not too difficult I&apos;ll post a separate patch, otherwise I&apos;ll commit the merge to RT and maybe convince you guys to help a bit with getting the RT branch ready for landing in trunk? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12972316" author="earwin" created="Fri, 17 Dec 2010 00:39:08 +0000"  >&lt;p&gt;Instead of you pulling out docstore removal, I can finish that patch. But then merging&apos;s gonna be even greater bitch. Probably. But maybe not.&lt;br/&gt;
Do you do IRC? It can be faster to discuss in realtime, and you could also tell what help you need with the branch.&lt;/p&gt;</comment>
                    <comment id="12972350" author="earwin" created="Fri, 17 Dec 2010 03:28:39 +0000"  >&lt;p&gt;Patch updated to trunk, no nocommits, no *.closeDocStore(), tests pass.&lt;/p&gt;

&lt;p&gt;SegmentWriteState vs DocumentsWriter bother me.&lt;br/&gt;
We track flushed files in both, we inconsistently get current segment from both of them.&lt;/p&gt;</comment>
                    <comment id="12972417" author="mikemccand" created="Fri, 17 Dec 2010 09:45:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Probably still a smaller change than flex indexing&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, true!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But yeah in general I agree that we should do things more incrementally. I think that&apos;s a mistake I&apos;ve made with the RT branch so far.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, not a mistake... this was unavoidable given that trunk was so far from what DWPT needs.  But with per-seg deletes (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2680&quot; title=&quot;Improve how IndexWriter flushes deletes against existing segments&quot;&gt;&lt;del&gt;LUCENE-2680&lt;/del&gt;&lt;/a&gt;) done, and no more doc stores (this issue), I think we&apos;ve got DWPT down to about as bite sized as it can be (it&apos;s still gonna be big!).&lt;/p&gt;

&lt;p&gt;I can help merge too!  I think coordinating on IRC #lucene is a good idea?  It seems like &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2573&quot; title=&quot;Tiered flushing of DWPTs by RAM with low/high water marks&quot;&gt;&lt;del&gt;LUCENE-2573&lt;/del&gt;&lt;/a&gt; needs to be incorporated into IW&apos;s new FlushControl class (which is already coordinating flush-due-to-deletes and flush-due-to-added-docs-of-one-DWPT).&lt;/p&gt;</comment>
                    <comment id="12972531" author="jasonrutherglen" created="Fri, 17 Dec 2010 15:58:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we&apos;ve got DWPT down to about as bite sized as it can be (it&apos;s still gonna be big!)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think coordinating on IRC #lucene is a good idea? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;d be nice if there were a log of IRC #lucene, otherwise I prefer Jira. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems like &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2573&quot; title=&quot;Tiered flushing of DWPTs by RAM with low/high water marks&quot;&gt;&lt;del&gt;LUCENE-2573&lt;/del&gt;&lt;/a&gt; needs to be incorporated into IW&apos;s new FlushControl class &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, into the DWPT branch.&lt;/p&gt;
</comment>
                    <comment id="12972538" author="steve_rowe" created="Fri, 17 Dec 2010 16:26:37 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I think coordinating on IRC #lucene is a good idea?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;d be nice if there were a log of IRC #lucene, otherwise I prefer Jira. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;#lucene-dev is logged.&lt;/p&gt;</comment>
                    <comment id="12972541" author="jasonrutherglen" created="Fri, 17 Dec 2010 16:35:10 +0000"  >&lt;p&gt;Steven, is that on a wiki page?&lt;/p&gt;

&lt;p&gt;The usage seems a little slim?  &lt;a href=&quot;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2010-12-17;raw=on&quot; class=&quot;external-link&quot;&gt;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2010-12-17;raw=on&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12972543" author="steve_rowe" created="Fri, 17 Dec 2010 16:48:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven, is that on a wiki page?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know, I never put it anywhere, just discussed on dev@l.a.o.  Feel free to do so if you like.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The usage seems a little slim? &lt;a href=&quot;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2010-12-17;raw=on&quot; class=&quot;external-link&quot;&gt;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2010-12-17;raw=on&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, it&apos;s very rarely used.  &lt;/p&gt;

&lt;p&gt;Several Lucene people who use #lucene are strongly against logging, so I set up #lucene-dev as a place to host on-the-record Lucene conversations.  I mentioned it because this is what you want.&lt;/p&gt;</comment>
                    <comment id="12972708" author="earwin" created="Sat, 18 Dec 2010 00:27:50 +0000"  >&lt;p&gt;New patch. Now with even more lines removed!&lt;/p&gt;

&lt;p&gt;DocStore-related index chain components used to track open/closed files through DocumentsWriter.&lt;br/&gt;
Closed files list was unused, and is silently gone.&lt;br/&gt;
Open files list was used to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;prevent not-yet-flushed shared docstores from being deleted by IndexFileDeleter.
	&lt;ul&gt;
		&lt;li&gt;no shared docstores, no need + IFD no longer requires a reference to DW&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;delete already opened docstore files, when aborting.
	&lt;ul&gt;
		&lt;li&gt;index chain now handles this on its own + has cleaner error handling code.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12972767" author="mikemccand" created="Sat, 18 Dec 2010 10:13:37 +0000"  >&lt;p&gt;Patch looks great!  Nice work Earwin.  I think it&apos;s ready to commit.&lt;/p&gt;

&lt;p&gt;Except, can you resync to trunk?  I hit failures applying one hunk to&lt;br/&gt;
DW.java.&lt;/p&gt;

&lt;p&gt;Also, on the nocommit on exc in DW.addDocument, yes I think that&lt;br/&gt;
(IFD.deleteNewFiles, not checkpoint) is still needed because DW can&lt;br/&gt;
orphan the store files on abort?&lt;/p&gt;

&lt;p&gt;Or: we could fix DW.abort to directly call Dir.deleteFile (instead of&lt;br/&gt;
relying on IFD.deleteNewFiles).  Ie, w/ no shared doc stores, these&lt;br/&gt;
files should never have been registered w/ IFD so they can be&lt;br/&gt;
privately managed by DW.&lt;/p&gt;

&lt;p&gt;But, if we end up leaving the delete up above, we should put the&lt;br/&gt;
docWriter null check back so silly apps that close IW while still&lt;br/&gt;
indexing don&apos;t get NPEs.&lt;/p&gt;

&lt;p&gt;I&apos;m not looking forward to the 3.x back port!!&lt;/p&gt;</comment>
                    <comment id="12972771" author="earwin" created="Sat, 18 Dec 2010 10:51:44 +0000"  >&lt;p&gt;Synced to trunk.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, on the nocommit on exc in DW.addDocument, yes I think that (IFD.deleteNewFiles, not checkpoint) is still needed because DW can orphan the store files on abort?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Orphaned files are deleted directly in StoredFieldsWriter.abort() and TermVectorsTermsWriter.abort(). As I said - all the open files tracking is now gone.&lt;br/&gt;
Turns out checkpoint() is also no longer needed.&lt;/p&gt;

&lt;p&gt;I have no other lingering cleanup urges, this is ready to be committed. I think.&lt;/p&gt;</comment>
                    <comment id="12972842" author="mikemccand" created="Sat, 18 Dec 2010 18:05:45 +0000"  >&lt;p&gt;OK I committed to trunk.  I&apos;ll let this bake for a while on trunk before backporting to 3.x...&lt;/p&gt;

&lt;p&gt;Thanks Earwin!&lt;/p&gt;</comment>
                    <comment id="12972850" author="jasonrutherglen" created="Sat, 18 Dec 2010 18:45:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;backporting to 3.x... &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Out of curiosity, why are we backporting to 3.x or are we planning on also backporting the DWPT branch?&lt;/p&gt;</comment>
                    <comment id="12972950" author="mikemccand" created="Sun, 19 Dec 2010 10:38:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Out of curiosity, why are we backporting to 3.x or are we planning on also backporting the DWPT branch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, 3.x is eligible for any new features that don&apos;t break back&lt;br/&gt;
compat.  It&apos;s a feature branch not a bug-fix branch.&lt;/p&gt;

&lt;p&gt;I&apos;d like to see removing shared doc stores backported in particular&lt;br/&gt;
because it&apos;s a good simplification of the code, ie, it can prevent&lt;br/&gt;
sneaky bugs.&lt;/p&gt;

&lt;p&gt;And I think we should backport DWPT?  But first things first, we gotta&lt;br/&gt;
land it on trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  And let it bake some... then backport.&lt;/p&gt;</comment>
                    <comment id="12973025" author="jasonrutherglen" created="Sun, 19 Dec 2010 17:42:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;And I think we should backport DWPT?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Really?  It&apos;s a fairly large restructuring.  &lt;/p&gt;

&lt;p&gt;Also, I realized that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2312&quot; title=&quot;Search on IndexWriter&amp;#39;s RAM Buffer&quot;&gt;LUCENE-2312&lt;/a&gt; should be implementable in the single DW case, which perhaps could be backported as well.&lt;/p&gt;</comment>
                    <comment id="12973053" author="mikemccand" created="Sun, 19 Dec 2010 23:03:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Really? It&apos;s a fairly large restructuring.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is, but it&apos;s all under-the-hood.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, I realized that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2312&quot; title=&quot;Search on IndexWriter&amp;#39;s RAM Buffer&quot;&gt;LUCENE-2312&lt;/a&gt; should be implementable in the single DW case, which perhaps could be backported as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right!&lt;/p&gt;</comment>
                    <comment id="12973135" author="michaelbusch" created="Mon, 20 Dec 2010 08:07:16 +0000"  >&lt;blockquote&gt;
&lt;p&gt;OK I committed to trunk. I&apos;ll let this bake for a while on trunk before backporting to 3.x...&lt;br/&gt;
Thanks Earwin!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Man, you guys really ruined my Sunday with this commit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I got so many merge conflicts, that I decided to merge first only up to rev 1050655 (the rev before this commit) and up to HEAD in a second merge.&lt;/p&gt;

&lt;p&gt;I&apos;m down to 64 compile errors (from 800), hopefully I can finish the merge tomorrow.  Just wanted you to know that I&apos;m making progress here with the DWPTs.&lt;/p&gt;</comment>
                    <comment id="12973291" author="mikemccand" created="Mon, 20 Dec 2010 18:41:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Man, you guys really ruined my Sunday with this commit&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Is there any way I can help?&lt;/p&gt;</comment>
                    <comment id="12973306" author="michaelbusch" created="Mon, 20 Dec 2010 19:12:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sorry&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No worries - I&apos;m being overly dramatic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Is there any way I can help?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let me try to get it to compile, and then I&apos;ll commit.  I&apos;m sure a bunch of tests will fail, help would be great then.  Also a general review of my changes to IndexWriter/DocumentsWriter/DWPT would be great.  I should be able to commit my merge by end of today. &lt;/p&gt;</comment>
                    <comment id="13013385" author="gsingers" created="Wed, 30 Mar 2011 16:50:10 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12429973">LUCENE-1737</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12466526" name="LUCENE-2814.patch" size="121940" author="earwin" created="Sat, 18 Dec 2010 10:51:44 +0000" />
                    <attachment id="12466518" name="LUCENE-2814.patch" size="121735" author="earwin" created="Sat, 18 Dec 2010 00:27:50 +0000" />
                    <attachment id="12466441" name="LUCENE-2814.patch" size="101105" author="earwin" created="Fri, 17 Dec 2010 03:28:39 +0000" />
                    <attachment id="12466392" name="LUCENE-2814.patch" size="76986" author="mikemccand" created="Thu, 16 Dec 2010 16:53:47 +0000" />
                    <attachment id="12466383" name="LUCENE-2814.patch" size="78215" author="earwin" created="Thu, 16 Dec 2010 12:15:42 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 13 Dec 2010 22:30:17 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11045</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24878</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>