<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:32:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2593/LUCENE-2593.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2593] disk full can cause index corruption in certain cases</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2593</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Robert uncovered this nasty bug, in adding more randomness to&lt;br/&gt;
oal.index tests...&lt;/p&gt;

&lt;p&gt;I got a standalone test to show the issue; the corruption path is&lt;br/&gt;
as follows:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The merge hits an initial exception (eg disk full when merging the&lt;br/&gt;
    postings).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In handling this exception, IW closes all the sub-readers,&lt;br/&gt;
    suppressing any further exceptions.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;If one of these sub-readers has pending deletions, which happens&lt;br/&gt;
    if readers are pooled in IW, it will flush them.  If that flush&lt;br/&gt;
    hits a 2nd exception (eg disk full), then SegmentReader&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;incorrectly&amp;#93;&lt;/span&gt; leaves the SegmentInfo&apos;s delGen advanced by 1,&lt;br/&gt;
    referencing a corrupt file, yet the SegmentReader is still&lt;br/&gt;
    forcefully closed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;If enough disk frees up such that a later IW.commit/close&lt;br/&gt;
    succeeds, the resulting segments file will reference an invalid&lt;br/&gt;
    deletions file.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12471193">LUCENE-2593</key>
            <summary>disk full can cause index corruption in certain cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Aug 2010 15:25:12 +0100</created>
                <updated>Wed, 1 Dec 2010 14:49:57 +0000</updated>
                    <resolved>Tue, 10 Aug 2010 23:34:38 +0100</resolved>
                                            <fixVersion>2.9.4</fixVersion>
                <fixVersion>3.0.3</fixVersion>
                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12896902" author="mikemccand" created="Tue, 10 Aug 2010 15:58:27 +0100"  >&lt;p&gt;Attached patch; I ended up making a number of defensive fixes on how&lt;br/&gt;
IW/DW/SR handle exceptions:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Generally I moved the error recover down lower, eg SegmentReader&lt;br/&gt;
    now restores its SegmentInfo and deletes the partially written&lt;br/&gt;
    file, on hitting an exception writing changed norms or deletes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;IW&apos;s ReaderPool no longer forcefully drops changes if it hits an&lt;br/&gt;
    exception committing an SR.  The SR now remains pooled, holding&lt;br/&gt;
    onto its changes, in case a future commit is attempted and the SR&lt;br/&gt;
    is able to commit.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;We checkpoint with IndexFileDeleter more &quot;finely&quot; now, so that as&lt;br/&gt;
    soon as a new file is referenced (eg from writing deletes), IFD&lt;br/&gt;
    knows about it.  This prevents incorrect deletion of a file eg if&lt;br/&gt;
    a merge IncRefs and then DecRefs before we can checkpoint.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe this issues goes back to 2.9, when we added reader pooling&lt;br/&gt;
(for NRT).&lt;/p&gt;</comment>
                    <comment id="12897325" author="earwin" created="Wed, 11 Aug 2010 17:20:43 +0100"  >&lt;p&gt;Yeehaw! This looks very much like a bug I was experiencing, which we earlier attributed to me fiddling with fsync.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12451677" name="LUCENE-2593.patch" size="17119" author="mikemccand" created="Tue, 10 Aug 2010 15:58:27 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 11 Aug 2010 16:20:43 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11241</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25099</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>