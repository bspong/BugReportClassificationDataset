<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:21 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2084/LUCENE-2084.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2084] remove Byte/CharBuffer wrapping for collation key generation</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2084</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We can remove the overhead of ByteBuffer and CharBuffer wrapping in CollationKeyFilter and ICUCollationKeyFilter.&lt;/p&gt;

&lt;p&gt;this patch moves the logic in IndexableBinaryStringTools into char[],int,int and byte[],int,int based methods, with the previous Byte/CharBuffer methods delegating to these.&lt;br/&gt;
Previously, the Byte/CharBuffer methods required a backing array anyway.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12441218">LUCENE-2084</key>
            <summary>remove Byte/CharBuffer wrapping for collation key generation</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Nov 2009 19:04:07 +0000</created>
                <updated>Fri, 10 May 2013 11:43:12 +0100</updated>
                    <resolved>Sun, 3 Jan 2010 09:23:19 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12794586" author="steve_rowe" created="Sat, 26 Dec 2009 06:06:49 +0000"  >&lt;p&gt;synched to current trunk, after the &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2124&quot; title=&quot;move JDK collation to core, ICU collation to ICU contrib&quot;&gt;&lt;del&gt;LUCENE-2124&lt;/del&gt;&lt;/a&gt; move&lt;/p&gt;</comment>
                    <comment id="12794587" author="steve_rowe" created="Sat, 26 Dec 2009 06:25:26 +0000"  >&lt;p&gt;Atached collation.benchmark.tar.bz2, which contains stuff to run an analysis-only contrib benchmark for the (ICU)CollationKeyAnalyzers over 4 languages: English, French, German, and Ukrainian.&lt;/p&gt;

&lt;p&gt;Included are:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;For each language, a line-doc containing the most frequent 100K words from a corresponding Wikipedia dump from November 2009;&lt;/li&gt;
	&lt;li&gt;For each language, Java code for a no-argument analyzer callable from a benchmark alg, that specializes (ICU)CollationKeyAnalyzer and uses PerFieldAnalyzerWrapper to only run it over the line-doc body field&lt;/li&gt;
	&lt;li&gt;A script to compile and jarify the above analyzers&lt;/li&gt;
	&lt;li&gt;A benchmark alg running 5 iterations of 10 repetitions of analysis only over the line-doc for each language&lt;/li&gt;
	&lt;li&gt;A script to find the minimum elapsed time for each combination, and output the results as a JIRA table&lt;/li&gt;
	&lt;li&gt;A script to run the previous two scripts once for each of three JDK versions&lt;/li&gt;
	&lt;li&gt;A script to compare the output of the above script before and after applying the attached patch removing Char/ByteBuffer wrapping, and output the result as a JIRA table&lt;/li&gt;
&lt;/ol&gt;
</comment>
                    <comment id="12794588" author="steve_rowe" created="Sat, 26 Dec 2009 06:47:03 +0000"  >&lt;p&gt;To run the benchmark:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Unpack &lt;tt&gt;collation.benchmark.tar.bz2&lt;/tt&gt; in a full Lucene-java tree into the &lt;tt&gt;contrib/benchmark/&lt;/tt&gt; directory.  All contents will be put under a new directory named &lt;tt&gt;collation/&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Compile and jarify the localized (ICU)CollationKeyAnalyzer code: from the &lt;tt&gt;collation/&lt;/tt&gt; directory, run the script &lt;tt&gt;build.test.analyzer.jar.sh&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;From an unpatched &lt;tt&gt;java/trunk/&lt;/tt&gt;, build Lucene&apos;s jars: &lt;tt&gt;ant clean package&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;From the &lt;tt&gt;contrib/benchmark/&lt;/tt&gt; directory, run the collation benchmark: &lt;tt&gt;collation/run-benchmark.sh &amp;gt; unpatched.collation.bm.table.txt&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Apply the attached patch to the Lucene-java tree&lt;/li&gt;
	&lt;li&gt;From &lt;tt&gt;java/trunk/&lt;/tt&gt;, build Lucene&apos;s jars: &lt;tt&gt;ant clean package&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;From the &lt;tt&gt;contrib/benchmark/} directory, run the collation benchmark: {{collation/run-benchmark.sh &amp;gt; patched.collation.bm.table.txt&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Produce the comparison table:  &lt;tt&gt;collation/compare.collation.benchmark.tables.pl unpatched.collation.bm.table.txt patched.collation.bm.table.txt &amp;gt; collation.diff.bm.table.txt&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;

</comment>
                    <comment id="12794589" author="rcmuir" created="Sat, 26 Dec 2009 06:54:32 +0000"  >&lt;p&gt;Steven this looks cool. trying to coerce my little netbook into running this thing now but I took a glance already.&lt;/p&gt;

&lt;p&gt;Do you think after this issue is resolved (whether it helps or doesn&apos;t help/won&apos;t fix either way) that we should open a separate issue to work on committing the benchmark so we have collation benchmarks for the future? Seems like it would be good to have in the future.&lt;/p&gt;</comment>
                    <comment id="12794590" author="steve_rowe" created="Sat, 26 Dec 2009 07:05:51 +0000"  >&lt;p&gt;Here are the unpatched results I got - these look quite similar to the results I posted from a custom (non-contrib-benchmark) benchmark in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1719#description-open&quot; class=&quot;external-link&quot;&gt;the description of LUCENE-1719&lt;/a&gt; :&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.00s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.89s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.90s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;207%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.64s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.95s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;254%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.97s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;225%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.20s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.96s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;152%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.97s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.55s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.50s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;326%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.86s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.74s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;349%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.85s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.76s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;350%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.01s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;227%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.04s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.06s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.07s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;99%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.58s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.04s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.14s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;171%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.35s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.22s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.14s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;105%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.48s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.94s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;89%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Here are the results after applying the synced-to-trunk patch:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8.73s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.61s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.90s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;241%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.38s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.87s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.94s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;285%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.95s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.94s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.97s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;254%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.37s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.91s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.90s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;161%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.78s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.65s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.57s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;290%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.74s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.74s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.64s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;364%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.69s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.86s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;319%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.40s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.18s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.62s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;204%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.06s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.82s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;170%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.36s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.88s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.16s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;206%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.40s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.95s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.14s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;179%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.33s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.65s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;117%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;And here is a comparison of the two:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text improvement&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.1%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.8%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;12.9%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.9%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.1%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.6%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text improvement&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.6%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.4%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.7%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.0%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_15 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.3%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.7%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text improvement&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.5%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;36.1%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.4%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;25.5%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-1.7%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;33.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_13 (64-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.3%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20.6%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;It&apos;s not unequivocal, but there is a definite overall improvement in the patched version; I&apos;d say these results justify applying the patch.&lt;/p&gt;

&lt;p&gt;I won&apos;t post them here, (mostly  because I didn&apos;t save them &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) but I&apos;ve run the same benchmark (with some variation in the number of iterations) and noticed that while there are always a couple of places where the unpatched version appears to do slightly better, the place at which this occurs is not consistent, and the cases where the patched version improves throughput always dominate.&lt;/p&gt;</comment>
                    <comment id="12794591" author="steve_rowe" created="Sat, 26 Dec 2009 07:19:31 +0000"  >&lt;p&gt;TopTFWikipediaWords.tar.bz2 contains a Maven2 project to parse unpacked Wikipedia dump files, create a Lucene index from the tokens produced by the contrib WikipediaTokenizer, iterate over the indexed tokens&apos; term docs, accumulating term frequencies, store the results in a bounded priority queue, then output contrib benchmark LineDoc format, with the title field containing the collection term frequency, the date containing the date the file was generated, and the body containing the term text.&lt;/p&gt;

&lt;p&gt;This code knows how to handle English, German, French, and Ukrainian, but could be extended for other languages.&lt;/p&gt;

&lt;p&gt;I used this project to generate the line-docs for the 4 languages&apos; 100k most frequent terms, in the collation benchmark archive attachment on this issue.&lt;/p&gt;</comment>
                    <comment id="12794592" author="steve_rowe" created="Sat, 26 Dec 2009 07:27:05 +0000"  >&lt;p&gt;Fixed up version of &lt;tt&gt;collation.benchmark.tar.bz2&lt;/tt&gt; that removes printing of progress from the &lt;tt&gt;collation/run-benchmark.sh&lt;/tt&gt; script - otherwise the same as the previous version.&lt;/p&gt;</comment>
                    <comment id="12794593" author="steve_rowe" created="Sat, 26 Dec 2009 07:49:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you think after this issue is resolved (whether it helps or doesn&apos;t help/won&apos;t fix either way) that we should open a separate issue to work on committing the benchmark so we have collation benchmarks for the future? Seems like it would be good to have in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I don&apos;t know quite how to do that - the custom code wrapping ICU/CollationKeyAnalyzer is necessary because the contrib benchmark alg format can only handle zero-argument analyzer constructors (or those that take Version arguments).  I think it would be useful to have a general-purpose alg syntax to handle this case without requiring custom code, and also, more generally, to allow for the construction of aribitrary analysis pipelines without requiring custom code (a la Solr schema).  The alg parsing code is a bit dense though - I think it could be converted to a JFlex-generated grammar to simplify this kind of syntax extension.&lt;/p&gt;

&lt;p&gt;Can you think of an alternate way to package this benchmark that fits with current practice?&lt;/p&gt;</comment>
                    <comment id="12794626" author="rcmuir" created="Sat, 26 Dec 2009 15:52:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I think it would be useful to have a general-purpose alg syntax to handle this case without requiring custom code, and also, more generally, to allow for the construction of aribitrary analysis pipelines without requiring custom code (a la Solr schema). The alg parsing code is a bit dense though - I think it could be converted to a JFlex-generated grammar to simplify this kind of syntax extension.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that would be a great improvement to the benchmark package!&lt;/p&gt;

&lt;p&gt;alternatively in the short term, i wonder if we can we somehow abuse a system property for the locale, setting it with the alg file to change the locale?&lt;/p&gt;</comment>
                    <comment id="12794636" author="thetaphi" created="Sat, 26 Dec 2009 17:24:45 +0000"  >&lt;p&gt;In my opinion in the committed patch and also before there is an error in handling the ByteBuffer/CharBuffer arrayOffset() value. It calculated the length using limit()-arrayOffset() which is wrong. The length available in the buffer is simple remaining() - this is how all other encoders/decoders in the JDK work (see src). array() and arrayOffset() simply give the offset of the wrapped array, but do not say anything about the length. The starting position to decode must be also customized and is arrayOffset()+position() - The code fails, if you wrap an array with offset!=0 and some length or if you pass an not 0-positioned buffer. &lt;/p&gt;

&lt;p&gt;For correct usage of NIO Buffers see my latest improvements in the payload.IdentityEncoder (issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2157&quot; title=&quot;DelimitedPayloadTokenFilter copies the bufer over itsself. Instead it should only set the length. Also optimize logic.&quot;&gt;&lt;del&gt;LUCENE-2157&lt;/del&gt;&lt;/a&gt;). Any code getting a buffer for encoding/decoding should assume, that it should read from the buffer starting at postion(), reading remaining() items.&lt;/p&gt;</comment>
                    <comment id="12794637" author="rcmuir" created="Sat, 26 Dec 2009 17:47:03 +0000"  >&lt;p&gt;Uwe, another thing is that currently the indexablebinarystringcode requires that the buffer have a backing array, which is optional.&lt;/p&gt;

&lt;p&gt;one idea is that if we implement the code with byte[]/char[] as this patch does, perhaps we can make the buffer code (which is just helper methods around this) to remove this restriction&lt;/p&gt;

&lt;p&gt;after all, now we have a benchmark so we can measure this and make sure it does not hurt performance for the charbuffer/bytebuffer case,  although with this patch these buffer methods are not used by any collation filters.&lt;/p&gt;</comment>
                    <comment id="12794662" author="rcmuir" created="Sun, 27 Dec 2009 05:30:59 +0000"  >&lt;p&gt;Steve, I ran the benchmark, worked like a charm. here are my numbers.&lt;br/&gt;
some differences are: very slow computer, newer jvm versions, etc.&lt;/p&gt;

&lt;p&gt;Unpatched:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;31.61s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;21.34s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;96%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;34.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;34.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22.69s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.84s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;50.72s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;30.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;107%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;26.42s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.98s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;65%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28.48s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20.14s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.30s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;85%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28.41s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;21.38s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.78s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;61%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;40.55s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.70s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;64%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Patched:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;29.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.33s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;117%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;32.38s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;21.02s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.88s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;112%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;32.92s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20.58s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;124%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;49.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;27.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.77s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;138%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;24.91s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;18.28s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.72s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;77%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;26.30s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.25s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;81%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;26.70s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.23s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.48s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;85%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;38.48s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;25.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9.80s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;81%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Comparison:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text improvement&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.5%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.4%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.6%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.1%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.9%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5.0_22 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.5%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Sun JVM&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text improvement&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.8%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.7%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15.3%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;33.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6.0_16 (32-bit)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8.0%&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12794663" author="rcmuir" created="Sun, 27 Dec 2009 06:50:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;In my opinion in the committed patch and also before there is an error in handling the ByteBuffer/CharBuffer arrayOffset() value. It calculated the length using limit()-arrayOffset() which is wrong&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Uwe, I think you might be wrong here. &lt;br/&gt;
In this class, the javadocs state the buffer must have a backing array.&lt;br/&gt;
Therefore, limit - offset is a correct way to calculate length of the entire buffer, which is what this class has always used.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The length available in the buffer is simple remaining() - this is how all other encoders/decoders in the JDK work (see src).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not correct, this is the remaining relative length, as remaining() is based upon position: Returns the number of elements between the current position and the limit.&lt;br/&gt;
Unlike typical jdk code, this code always ignored relative position and instead encodes/decodes entire buffers.&lt;/p&gt;

&lt;p&gt;We should not change this under this issue... it is unrelated. I do not think we should change the semantics of this encode/decode to take any relative position into account.&lt;/p&gt;</comment>
                    <comment id="12794672" author="rcmuir" created="Sun, 27 Dec 2009 09:35:05 +0000"  >&lt;p&gt;updated patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;deprecate the now unused CharBuffer/ByteBuffer methods.&lt;/li&gt;
	&lt;li&gt;add tests to test the char[]/byte[] based methods (keep the old NIO ones, but deprecate them)&lt;/li&gt;
	&lt;li&gt;change getEncodedLength to take byte[],int,int consistent with getDecodedLength. even though it only needs to know the number of bytes, in the future if we want to modify this encoding, we will not need to break the api.&lt;/li&gt;
	&lt;li&gt;javadocs fixes&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12794675" author="thetaphi" created="Sun, 27 Dec 2009 09:57:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;Therefore, limit - offset is a correct way to calculate length of the entire buffer, which is what this class has always used.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is exactly wrong: The lengthz of the &quot;valid&quot; area inside the buffer is always limit()-position() &lt;span class=&quot;error&quot;&gt;&amp;#91;see javadocs of wrap()&amp;#93;&lt;/span&gt;. If arrayOffset()!=0, position() may still be 0 (because the arrayoffset is only used when wrapping byte arrays. The arrayOffset() defines the postion in the underlying array that defines the buffer&apos;s position()==0 (see javadocs).&lt;/p&gt;

&lt;p&gt;This error is mostly no problem for dynamical allocated array buffers (as most users use), because arrayOffset() is always 0 (I have never seen a buffer with offset != 0)&lt;/p&gt;

&lt;p&gt;A problem also occurs if you wrap an array with wrap([], offset, length). the offset there is &lt;b&gt;not&lt;/b&gt; the arrayOffset(), it is the position()! And length is after wrapping remaining(). The capacity() is the array length. Therefore it is really a bug. You deprecated it, that&apos;s good, but it should be fixed, it does not work correct.&lt;/p&gt;

&lt;p&gt;For verifying, read the source code of ByteBuffer and HeapByteBuffer from src.zip in your jdk distrib and of course the javadocs.&lt;/p&gt;

&lt;p&gt;So just to repeat, the correct code would be:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;start postion in array=arrayOffset()+position()&lt;/li&gt;
	&lt;li&gt;length=remaining()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is how the IdentityEncode for Payloads works. So deprecate &lt;b&gt;and&lt;/b&gt; fix it.&lt;br/&gt;
If we really want to work with buffers, the correct way to implement this would be that the whole class implements CharsetEncoder.&lt;/p&gt;</comment>
                    <comment id="12794680" author="thetaphi" created="Sun, 27 Dec 2009 12:36:41 +0000"  >&lt;p&gt;I found one place where the arrayOffset() bug occurs:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Create an ByteBuffer by wrapping another byte[] with offset and length.&lt;/li&gt;
	&lt;li&gt;use ByteBuffer.slice() to create an independednt buffer which position()==0 the current position of the prev ByteBuffer (which is the wrapped byte[]). This buffer will have an arrayOffset() of the original offset (which is position=0 in this buffer). The limit/cpacity of this buffer is the above length, which is remaining() on the original buffer.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The length formula is the definitely wrong, if would sometimes undeflow and give negative numbers, e.g. if the position() of the sliced buffer if e.g. 5 (so arrayoffset==5 in the slice) and the remaining bytes are e.g. 3 =&amp;gt; length in the code before/after tha patch is -2.&lt;/p&gt;

&lt;p&gt;I will provide a testcase later that shows both bugs (position() and arrayOffset() misuse).&lt;/p&gt;</comment>
                    <comment id="12794687" author="rcmuir" created="Sun, 27 Dec 2009 16:08:47 +0000"  >&lt;p&gt;Uwe, can we please do any nio bugfixes under another issue? &lt;/p&gt;

&lt;p&gt;Its not related to this one. This issue is about &lt;b&gt;not&lt;/b&gt; using NIO since it only makes collation slower.&lt;/p&gt;</comment>
                    <comment id="12794692" author="rcmuir" created="Sun, 27 Dec 2009 16:27:35 +0000"  >&lt;p&gt;in this patch, preserve the javadoc at the beginning of this class which describes in detail the previous behavior of this class: exactly how the length is calculated from arrayOffset() and limit()&lt;/p&gt;

&lt;p&gt;the only difference is i change the text from&lt;br/&gt;
&lt;b&gt;This class&apos;s operations&lt;/b&gt; are defined over CharBuffers and ByteBuffers ...&lt;br/&gt;
to&lt;br/&gt;
&lt;b&gt;Some methods in this class&lt;/b&gt; are defined over CharBuffers and ByteBuffers ..&lt;/p&gt;

&lt;p&gt;imho, this existing nio behavior is documented and now deprecated and should not be changed, and definitely not changed in this issue.&lt;/p&gt;</comment>
                    <comment id="12794701" author="rcmuir" created="Sun, 27 Dec 2009 16:59:31 +0000"  >&lt;p&gt;Hi, this is a simple, straightforward performance improvement between 10% and 20% on average it looks, with no backwards problems.&lt;/p&gt;

&lt;p&gt;What Uwe describes as a problem is not introduced here, but exists already and is documented as such in the class javadocs, and preserved for backwards compatibility.&lt;/p&gt;

&lt;p&gt;So, I think such backwards-breakage should be under a separate issue.&lt;/p&gt;

&lt;p&gt;I will commit this one in a few days if no one objects. &lt;/p&gt;</comment>
                    <comment id="12794702" author="thetaphi" created="Sun, 27 Dec 2009 17:05:23 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;And please add a note that the Char/ByteBuffer methods are completely broken. I have two test here that broke with negativeArraySize and so on. The person who wrote the orginbal CharBuffer code misunderstood the indeed complicated logic behind ByteBuffers.&lt;/p&gt;

&lt;p&gt;So the only requirement from my side is to write in the deprecated message or the docs on top:&lt;/p&gt;

&lt;p&gt;instead:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; * Note that this class calls array() and arrayOffset()
 * on the CharBuffers and ByteBuffers it uses, so only wrapped arrays may be
 * used.  This class interprets the arrayOffset() and limit() values returned by
 * its input buffers as beginning and end+1 positions on the wrapped array,
 * respectively; similarly, on the output buffer, arrayOffset() is the first
 * position written to, and limit() is set to one past the final output array
 * position.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;please:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; * The methods operating on CharBuffers and ByteBuffers are
 * deprecated in favour of methods that directly operate on byte[] and char[]
 * arrays. Note that this class calls array() and arrayOffset()
 * on the CharBuffers and ByteBuffers it uses, so only wrapped arrays may be
 * used. Furthermore, the deprecated methods are only working
 * correctly, if you simply use Buffer.wrap on an array without any offsets != 0
 * and not work on buffers that are returned by the slice() method.
 * Buffers wrapped with an offset completely ignore the offset and transform
 * limit() bytes. Buffer slices are completely broken and calculate
 * the length of the buffer sometimes as negative.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe in better english.&lt;/p&gt;</comment>
                    <comment id="12794703" author="rcmuir" created="Sun, 27 Dec 2009 17:14:35 +0000"  >&lt;p&gt;Thanks Uwe, I will incorporate some of this wording into the javadocs and upload a new patch.&lt;/p&gt;

&lt;p&gt;later, if we want we can discuss changing how the nio works, perhaps it is best to break the back compat, but i am just trying to avoid doing this within the same issue as a performance improvement that is trying to preserve all back compat &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12794706" author="thetaphi" created="Sun, 27 Dec 2009 17:28:36 +0000"  >&lt;p&gt;OK.&lt;/p&gt;

&lt;p&gt;I do not want to discuss further, the correct way for both directions according to NIO would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; inputOffset = input.arrayOffset() + input.position();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; inputLength = input.remaining();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; outputOffset = output.arrayOffset() + output.position();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; outputLength = getEncodedLength(input.array(), inputOffset, inputLength);
output.limit(outputLength + output.position());
&lt;span class=&quot;code-comment&quot;&gt;//bogus: output.position(0);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same the other way round (only with getEncodedLength()).&lt;/p&gt;

&lt;p&gt;If we want to fix this, put this into the new issue. But as the methods are deprecated, with the big warning we do not need to fix it.&lt;/p&gt;</comment>
                    <comment id="12794746" author="rcmuir" created="Sun, 27 Dec 2009 21:59:23 +0000"  >&lt;p&gt;updated patch with uwe&apos;s javadoc suggestions&lt;/p&gt;</comment>
                    <comment id="12794762" author="steve_rowe" created="Mon, 28 Dec 2009 03:40:21 +0000"  >&lt;p&gt;Hi Robert, I took a look at the patch and found a couple of minor issues:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The newly deprecated methods should get @Deprecated annotations (in addition to the @deprecated javadoc tags)&lt;/li&gt;
	&lt;li&gt;IntelliJ tells me that the &quot;final&quot; modifier on some of the public static methods is not cool - AFAICT, although static implies final, it may be useful to leave this anyway, since unlike the static modifier, the final modifier disallows hiding of the method by sublasses?  I dunno.  (Checking Lucene source, there are many &quot;static final&quot; methods, so maybe I should tell IntelliJ it&apos;s not a problem.)&lt;/li&gt;
	&lt;li&gt;Unlike getEncodedLength(byte[],int,int), getDecodedLength(char[],int,int) doesn&apos;t protect against overflow in the int multiplication by casting to long.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                    <comment id="12794763" author="rcmuir" created="Mon, 28 Dec 2009 04:32:47 +0000"  >&lt;p&gt;Steve, thanks for pointing these out.&lt;/p&gt;

&lt;p&gt;#3 concerns me somewhat, this is an existing problem in trunk (i guess only for enormous terms, though). Should we consider backporting a fix?&lt;/p&gt;

&lt;p&gt;I will upload a new patch, takes a couple tries for one this large on my internet connection...&lt;/p&gt;</comment>
                    <comment id="12794781" author="rcmuir" created="Mon, 28 Dec 2009 09:05:16 +0000"  >&lt;p&gt;updated patch, with Steven&apos;s additions.&lt;/p&gt;</comment>
                    <comment id="12794783" author="rcmuir" created="Mon, 28 Dec 2009 09:09:52 +0000"  >&lt;p&gt;for the record, i think in the future we should decide on some consistency with @Deprecated annotation in lucene. &lt;/p&gt;

&lt;p&gt;Personally, I think it is useless &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12794786" author="thetaphi" created="Mon, 28 Dec 2009 09:23:14 +0000"  >&lt;p&gt;It is somehow useless, because you always have to add a @deprecated also to javadocs with an explanation. If we want to add it, wen can use eclipse to do it automatically with the cleanup function (like I added @Override).&lt;/p&gt;</comment>
                    <comment id="12794787" author="rcmuir" created="Mon, 28 Dec 2009 09:26:29 +0000"  >&lt;p&gt;Uwe, I think if we are going to add it here, then we should add it everywhere separately in a later issue. &lt;/p&gt;

&lt;p&gt;otherwise, we should not add it here, and remove it anywhere it is found.&lt;/p&gt;

&lt;p&gt;its 100% definitely useless if we do not consistently use it for all deprecations.&lt;/p&gt;</comment>
                    <comment id="12794788" author="thetaphi" created="Mon, 28 Dec 2009 09:29:36 +0000"  >&lt;p&gt;It is now used also in new commits (not only this issue). And flex uses it very often.&lt;/p&gt;</comment>
                    <comment id="12795337" author="steve_rowe" created="Wed, 30 Dec 2009 15:47:24 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Unlike getEncodedLength(byte[],int,int), getDecodedLength(char[],int,int) doesn&apos;t protect against overflow in the int multiplication by casting to long.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;#3 concerns me somewhat, this is an existing problem in trunk (i guess only for enormous terms, though). Should we consider backporting a fix?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The current form of this calculation will correctly handle original binary content of lengths up to 136MB.  IMHO the likelihood of encoding terms this enormous with IndexableBinaryStringTools is so miniscule that it&apos;s not worth the effort to backport.&lt;/p&gt;</comment>
                    <comment id="12795961" author="rcmuir" created="Sun, 3 Jan 2010 09:23:19 +0000"  >&lt;p&gt;Committed revision 895341.&lt;/p&gt;

&lt;p&gt;Thanks Steven and Uwe&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12428974" name="collation.benchmark.tar.bz2" size="2038088" author="steve_rowe" created="Sat, 26 Dec 2009 07:27:05 +0000" />
                    <attachment id="12429008" name="LUCENE-2084.patch" size="41318" author="rcmuir" created="Mon, 28 Dec 2009 09:05:16 +0000" />
                    <attachment id="12429000" name="LUCENE-2084.patch" size="40966" author="rcmuir" created="Sun, 27 Dec 2009 21:59:23 +0000" />
                    <attachment id="12428991" name="LUCENE-2084.patch" size="39683" author="rcmuir" created="Sun, 27 Dec 2009 16:27:35 +0000" />
                    <attachment id="12428989" name="LUCENE-2084.patch" size="40059" author="rcmuir" created="Sun, 27 Dec 2009 09:35:05 +0000" />
                    <attachment id="12428971" name="LUCENE-2084.patch" size="20450" author="steve_rowe" created="Sat, 26 Dec 2009 06:06:49 +0000" />
                    <attachment id="12425508" name="LUCENE-2084.patch" size="20730" author="rcmuir" created="Thu, 19 Nov 2009 19:05:35 +0000" />
                    <attachment id="12428973" name="TopTFWikipediaWords.tar.bz2" size="8168" author="steve_rowe" created="Sat, 26 Dec 2009 07:19:31 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>8.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 26 Dec 2009 06:06:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11695</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25641</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>