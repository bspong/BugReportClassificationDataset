<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:03:14 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3661/LUCENE-3661.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3661] move deletes under codec</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3661</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3631&quot; title=&quot;Remove write access from SegmentReader and possibly move to separate class or IndexWriter/BufferedDeletes/...&quot;&gt;&lt;del&gt;LUCENE-3631&lt;/del&gt;&lt;/a&gt;, this should be easier I think.&lt;/p&gt;

&lt;p&gt;I haven&apos;t looked at it much myself but i&apos;ll play around a bit, but at a glance:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SegmentReader to have Bits liveDocs instead of BitVector&lt;/li&gt;
	&lt;li&gt;address the TODO in the IW-using ctors so that SegmentReader doesn&apos;t take a parent but just an existing core.&lt;/li&gt;
	&lt;li&gt;we need some type of minimal &quot;MutableBits&quot; or similar subinterface of bits. BitVector and maybe Fixed/OpenBitSet could implement it&lt;/li&gt;
	&lt;li&gt;BitVector becomes an impl detail and moves to codec (maybe we have a shared base class and split the 3.x/4.x up rather than the conditional backwards)&lt;/li&gt;
	&lt;li&gt;I think the invertAll should not be used by IndexWriter, instead we define the codec interface to say &quot;give me a new MutableBits, by default all are set&quot; ?&lt;/li&gt;
	&lt;li&gt;redundant internally-consistent checks in checkLiveCounts should be done in the codec impl instead of in SegmentReader.&lt;/li&gt;
	&lt;li&gt;plain text impl in SimpleText.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12535923">LUCENE-3661</key>
            <summary>move deletes under codec</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Dec 2011 23:22:13 +0000</created>
                <updated>Fri, 10 May 2013 11:45:05 +0100</updated>
                    <resolved>Sun, 29 Jan 2012 11:40:35 +0000</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13174000" author="mikemccand" created="Wed, 21 Dec 2011 10:52:31 +0000"  >&lt;p&gt;This sounds like a great plan!  So then the use of BitVector is an impl detail to the codec...&lt;/p&gt;</comment>
                    <comment id="13189208" author="rcmuir" created="Thu, 19 Jan 2012 17:14:10 +0000"  >&lt;p&gt;I started working on this some before christmas break, and just merged it up to trunk.&lt;/p&gt;

&lt;p&gt;Ill commit it to a branch (branches/lucene3661) in case anyone wants to help. &lt;/p&gt;

&lt;p&gt;I don&apos;t think I really got much done yet, but it would be nice to make our codec api &lt;br/&gt;
more complete by including representation of deletions.&lt;/p&gt;</comment>
                    <comment id="13191422" author="rcmuir" created="Mon, 23 Jan 2012 20:28:30 +0000"  >&lt;p&gt;So this is &quot;working&quot; in the branch (SimpleText deletes and stuff), but needs rounding out&lt;br/&gt;
before committing, e.g. the API should not be so horrible and some documentation and such.&lt;/p&gt;</comment>
                    <comment id="13195594" author="rcmuir" created="Sat, 28 Jan 2012 18:27:48 +0000"  >&lt;p&gt;Here&apos;s a patch showing the differences between branch and trunk.&lt;/p&gt;

&lt;p&gt;I think its ready: thanks to Mike for helping with a lot of the cleanup here.&lt;/p&gt;</comment>
                    <comment id="13195595" author="rcmuir" created="Sat, 28 Jan 2012 18:34:56 +0000"  >&lt;p&gt;and also Simon for helping track down a tricky bug involving docvalues... maybe we &lt;br/&gt;
should open an issue later to try to make it more resilient just for future refactorings? &lt;/p&gt;</comment>
                    <comment id="13195604" author="thetaphi" created="Sat, 28 Jan 2012 19:08:01 +0000"  >&lt;p&gt;One thing: Can we not split the BitVector and LiveDocs in 3.x and trunk? Just because the logic is inverse in 3.x (deletions instead of live docs). This would also make the LiveDocs in trunk always have a codec header, but not in 3.x?&lt;/p&gt;

&lt;p&gt;Otherwise, looks great!&lt;/p&gt;</comment>
                    <comment id="13195613" author="rcmuir" created="Sat, 28 Jan 2012 19:47:05 +0000"  >&lt;p&gt;We could, I think it would be mostly duplicate code at this point.&lt;/p&gt;

&lt;p&gt;But, like stored fields (which is also shared), its just another TODO we can do later.&lt;/p&gt;

&lt;p&gt;Definitely needs not block this issue (its unrelated).&lt;/p&gt;</comment>
                    <comment id="13195630" author="thetaphi" created="Sat, 28 Jan 2012 21:25:23 +0000"  >&lt;p&gt;We should open issue, otherwise coomit that so I can work on splitting composite and atomic readers again!&lt;/p&gt;</comment>
                    <comment id="13195640" author="rcmuir" created="Sat, 28 Jan 2012 23:15:45 +0000"  >&lt;p&gt;I&apos;ll open a followup issue (can be done in trunk after this is committed).&lt;/p&gt;

&lt;p&gt;Just for reference, there are 3 bitvector versions that can be read:&lt;br/&gt;
unversioned/darkages: some 3.x versions&lt;br/&gt;
codec header version 0: some 3.x versions&lt;br/&gt;
codec header version 1: trunk&lt;/p&gt;

&lt;p&gt;so trunk always writes a versioned codec header, even lucene 3.5 always writes &lt;br/&gt;
a versioned codec header, but i think the 3.x codec must at least support&lt;br/&gt;
unversioned files still for e.g. 3.0 indexes.&lt;/p&gt;

&lt;p&gt;also, under the same issue we could maybe remove bitvector completely and the &lt;br/&gt;
codecs just use FastBitSet. there is no difference now that count() is unused.&lt;/p&gt;

&lt;p&gt;This could be cleaner: just having different serialization forms for fastbitset.&lt;/p&gt;</comment>
                    <comment id="13195733" author="rcmuir" created="Sun, 29 Jan 2012 11:29:39 +0000"  >&lt;p&gt;Merging this to trunk now...&lt;/p&gt;

&lt;p&gt;We can use &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3613&quot; title=&quot;remove .codecs.DefaultXXXX and split into 3x/4x impls&quot;&gt;LUCENE-3613&lt;/a&gt; issue for any remaining splitting of 4.x/3.x codec impls (stored fields, deletes).&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12512333" name="LUCENE-3661.patch" size="161396" author="rcmuir" created="Sat, 28 Jan 2012 18:27:48 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 21 Dec 2011 10:52:31 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>221607</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24037</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>