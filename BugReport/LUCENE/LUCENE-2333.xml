<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:09:55 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2333/LUCENE-2333.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2333] Failures during contrib builds, when classes in core were changed without ant clean</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2333</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;From java-dev by Shai Erera:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;ve noticed that sometimes, after I run test-core and test-contrib, and then change core code, test-contrib fail on NoSuchMethodError and stuff like that. I&apos;ve noticed that core.jar exists under build, and I assumed it&apos;s used by test-contrib, and probably is not recreated after core code has changed.&lt;/p&gt;

&lt;p&gt;I verified it when looking in contrib-build.xml, which defines a property lucene.jar.present which is set to true if the jar is ... well, present. Which I believe is the reason for these failures. I&apos;ve been thinking how to resolve that, and I can think of two ways:&lt;/p&gt;

&lt;p&gt;(1) have test-core always delete that file, but that has two issues:&lt;br/&gt;
(1.1) It&apos;s redundant if the code hasn&apos;t changed.&lt;br/&gt;
(1.2) It forces you to either jar-core or test-core before you test-contrib, if you want to make sure you run w/ the latest jar.&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;(2) have test-contrib always call jar-core, which will first delete the file and then re-create it by compiling first. Compiling should not do anything if the code hasn&apos;t changed. So the only waste would be to create the .jar, but I think that&apos;s quite fast?&lt;/p&gt;

&lt;p&gt;Does anyone, with more Ant skills than me, know of a better way to detect from test-contrib that core code has changed and only then rebuild the jar?&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
            <key id="12459630">LUCENE-2333</key>
            <summary>Failures during contrib builds, when classes in core were changed without ant clean</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Mar 2010 10:24:27 +0000</created>
                <updated>Fri, 10 May 2013 11:44:44 +0100</updated>
                    <resolved>Fri, 26 Mar 2010 10:44:47 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>general/build</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12847307" author="thetaphi" created="Fri, 19 Mar 2010 10:32:08 +0000"  >&lt;p&gt;Here 2 patches:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The first one only changes the following:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;It now does not do any &quot;short-circuit&quot; checks for the core.jar available, instead solely uses a property that is set by the parent.&lt;/p&gt;

&lt;p&gt;This works good, now always when you compile a contrib solely (inside its folder), the core is compiled. If you run from top-level build.xml the top-level build compiles the core as dependency and passes the &quot;core.compiled&quot; property down to the contrib-crawl.&lt;/p&gt;

&lt;p&gt;In contrib are still other short-circuits like this. E.g. The benchmark contrib checks, if the jar files of other contribs it depends on are available and only if not recompiles. This leads to the same problem is you change one of the depends-on contribs source code. In this case there is no way around a top-level clean, sorry.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The second patch improves more:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;It removes the dependency to build the jar file of lucene, it simply uses the classes/java folder. It needed some more refactoring, to get rid of the $&lt;/p&gt;
{lucene.jar}
&lt;p&gt; property. In contrib-build.xml now a separate base.classpath ref is defined that can be used everywhere to extend the default classpath, also set by contrib-build.xml.&lt;/p&gt;

&lt;p&gt;The patch also contains a refactoring of contrib-ant, to use a resources-folder like other contribs. To get contrib-ant jar file compile correctly, do the folldoing svn commands inside contrib/ant:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;svn mkdir src/resources/org/apache/lucene/ant/
svn move src/java/org/apache/lucene/ant/antlib.xml \
  src/resources/org/apache/lucene/ant/antlib.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12847309" author="thetaphi" created="Fri, 19 Mar 2010 10:50:24 +0000"  >&lt;p&gt;I am working now on a third patch that also solves the dependency problems. The idea is to not only check if the dependant contrib&apos;s jar file is there, more to check if it is actual. So replace all &amp;lt;available/&amp;gt; tasks in contribs to &amp;lt;uptodate/&amp;gt;: &lt;a href=&quot;http://ant.apache.org/manual/CoreTasks/uptodate.html&quot; class=&quot;external-link&quot;&gt;http://ant.apache.org/manual/CoreTasks/uptodate.html&lt;/a&gt;, first example is the best how to do this.&lt;/p&gt;</comment>
                    <comment id="12847412" author="thetaphi" created="Fri, 19 Mar 2010 16:08:44 +0000"  >&lt;p&gt;Here the patch with the previous changes applied. It works like the shai2 one, but now also impelements the inter-contrib dependency checks. So if you update a source file in memory and then build highlighter, it will correct detect the change in memory.&lt;/p&gt;

&lt;p&gt;The central element is a macro in contrib-build.xml called &amp;lt;contrib-uptodate&amp;gt;. It tests, if the specified contrib&apos;s jar-file is newer than any source file and sets a property. It also returns a property for the jar file (to add to classpath). By this the dependencies are easy to resolve.&lt;/p&gt;

&lt;p&gt;This patch also updates benchmark to conditionally build the required contribs (before they were build on every run!). This reduced the time for &quot;ant test&quot; on my computer from 7:25 to 7:02.&lt;/p&gt;

&lt;p&gt;To apply this patch, you also have to do the svn-move command above.&lt;/p&gt;</comment>
                    <comment id="12847415" author="shaie" created="Fri, 19 Mar 2010 16:13:53 +0000"  >&lt;p&gt;This up-to-date thingy looks really  cool and useful. So I guess you&apos;d compare the .jar date and the build/classes/java date? This is sort of what javac does when it decides which classes to compile ... I guess.&lt;/p&gt;</comment>
                    <comment id="12847418" author="thetaphi" created="Fri, 19 Mar 2010 16:19:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I guess you&apos;d compare the .jar date and the build/classes/java date&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For between-contrib-relationships: The central element is a macro in contrib-build.xml called &amp;lt;contrib-uptodate&amp;gt;. It tests, if the specified contrib&apos;s jar-file is newer than any source file and sets a property.&lt;/p&gt;

&lt;p&gt;And the original change is that the contrib builds no longer use the jar file of core at all (see shai2-patch).&lt;/p&gt;</comment>
                    <comment id="12850068" author="thetaphi" created="Fri, 26 Mar 2010 10:31:37 +0000"  >&lt;p&gt;Updated patch with changes from contrib refactoring included.&lt;/p&gt;

&lt;p&gt;Before apply you need to (inside contrib/ant):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;svn mkdir --parents src/resources/org/apache/lucene/ant/
svn move src/java/org/apache/lucene/ant/antlib.xml \
  src/resources/org/apache/lucene/ant/antlib.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will commit this shortly.&lt;/p&gt;</comment>
                    <comment id="12850074" author="thetaphi" created="Fri, 26 Mar 2010 10:44:47 +0000"  >&lt;p&gt;Committed revision: 927765&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12439863" name="LUCENE-2333.patch" size="14015" author="thetaphi" created="Fri, 26 Mar 2010 10:31:37 +0000" />
                    <attachment id="12439285" name="LUCENE-2333.patch" size="15728" author="thetaphi" created="Fri, 19 Mar 2010 16:08:44 +0000" />
                    <attachment id="12439262" name="shai-compile-fix2.patch" size="7320" author="thetaphi" created="Fri, 19 Mar 2010 10:36:41 +0000" />
                    <attachment id="12439260" name="shai-compile-fix.patch" size="2657" author="thetaphi" created="Fri, 19 Mar 2010 10:32:08 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 19 Mar 2010 16:13:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11462</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25392</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>