<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:08:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2010/LUCENE-2010.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2010] Remove segments with all documents deleted in commit/flush/close of IndexWriter instead of waiting until a merge occurs.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2010</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I do not know if this is a bug in 2.9.0, but it seems that segments with all documents deleted are not automatically removed:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;4 of 14: name=_dlo docCount=5
  compound=true
  hasProx=true
  numFiles=2
  size (MB)=0.059
  diagnostics = {java.version=1.5.0_21, lucene.version=2.9.0 817268P - 2009-09-21 10:25:09, os=SunOS,
     os.arch=amd64, java.vendor=Sun Microsystems Inc., os.version=5.10, source=flush}
  has deletions [delFileName=_dlo_1.del]
  test: open reader.........OK [5 deleted docs]
  test: fields..............OK [136 fields]
  test: field norms.........OK [136 fields]
  test: terms, freq, prox...OK [1698 terms; 4236 terms/docs pairs; 0 tokens]
  test: stored fields.......OK [0 total field count; avg ? fields per doc]
  test: term vectors........OK [0 total vector count; avg ? term/freq vector fields per doc]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Shouldn&apos;t such segments not be removed automatically during the next commit/close of IndexWriter?&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Mike McCandless:&lt;/b&gt;&lt;br/&gt;
Lucene doesn&apos;t actually short-circuit this case, ie, if every single doc in a given segment has been deleted, it will still merge it &lt;span class=&quot;error&quot;&gt;&amp;#91;away&amp;#93;&lt;/span&gt; like normal, rather than simply dropping it immediately from the index, which I agree would be a simple optimization. Can you open a new issue? I would think IW can drop such a segment immediately (ie not wait for a merge or optimize) on flushing new deletes.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12439063">LUCENE-2010</key>
            <summary>Remove segments with all documents deleted in commit/flush/close of IndexWriter instead of waiting until a merge occurs.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Oct 2009 10:11:09 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:31 +0100</updated>
                    <resolved>Wed, 26 Jan 2011 21:56:23 +0000</resolved>
                            <version>2.9</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12769970" author="thetaphi" created="Mon, 26 Oct 2009 10:12:33 +0000"  >&lt;p&gt;There is one special case:&lt;br/&gt;
If you delete &lt;b&gt;all&lt;/b&gt; documents from the whole index, no segments would keep alive if automatically removed.&lt;br/&gt;
Can we handle that? It should remain an empty segments_xxx file.&lt;/p&gt;</comment>
                    <comment id="12769980" author="mikemccand" created="Mon, 26 Oct 2009 10:50:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you delete all documents from the whole index, no segments would keep alive if automatically removed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;IW now has a dedicated method to &lt;span class=&quot;error&quot;&gt;&amp;#91;efficiently&amp;#93;&lt;/span&gt; delete all docs, but yeah we should also short-circuit this, in case someone didn&apos;t use that method and instead actually deleted every doc separately.&lt;/p&gt;

&lt;p&gt;I&apos;d think that our solution here would automatically handle this case (drop all segments) as well.&lt;/p&gt;

&lt;p&gt;On materializing deletes (IndexWriter.applyDeletes) we should simply sweep the segmentInfos, and drop any fully deleted segments.  Should be a simple change.&lt;/p&gt;</comment>
                    <comment id="12770917" author="mikemccand" created="Wed, 28 Oct 2009 12:48:17 +0000"  >&lt;p&gt;Note: IndexReader must also do this.&lt;/p&gt;</comment>
                    <comment id="12986052" author="mikemccand" created="Mon, 24 Jan 2011 22:02:00 +0000"  >&lt;p&gt;Patch.&lt;/p&gt;

&lt;p&gt;The change itself is very simple &amp;#8211; I added a pruneDeletedSegments method to SegmentInfos, and I call that on commit in IW and IR.&lt;/p&gt;

&lt;p&gt;But, then, various tests assume that Lucene doesn&apos;t do this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  EG asserting maxDoc(), docFreq(), etc... so I had to fix those up...&lt;/p&gt;</comment>
                    <comment id="12986267" author="thetaphi" created="Tue, 25 Jan 2011 07:50:45 +0000"  >&lt;p&gt;Look fine to me! Its indeed quite simple. Will test this later.&lt;/p&gt;

&lt;p&gt;Do you want to fix the rest of the tests and remove the text-only keepAllSegments method? At least this method should be hidden by a package-private accessor or, if not possible, @lucene.internal.&lt;/p&gt;</comment>
                    <comment id="12986346" author="mikemccand" created="Tue, 25 Jan 2011 11:37:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you want to fix the rest of the tests and remove the text-only keepAllSegments method?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s actually only the QueryUtils test class that uses this... it makes an &quot;empty&quot; index by adding N docs and then deleting them all.  So the test-only API needs to be public (QueryUtils is in oal.search).  I&apos;ll mark it as lucene.internal...&lt;/p&gt;</comment>
                    <comment id="12986602" author="thetaphi" created="Tue, 25 Jan 2011 18:54:22 +0000"  >&lt;p&gt;Thanks for taking care!&lt;/p&gt;</comment>
                    <comment id="12987152" author="mikemccand" created="Wed, 26 Jan 2011 18:41:04 +0000"  >&lt;p&gt;Reopen until I can track down the 3.x fail this caused...&lt;/p&gt;</comment>
                    <comment id="13013513" author="gsingers" created="Wed, 30 Mar 2011 16:50:31 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12437564">LUCENE-1960</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12469209" name="LUCENE-2010.patch" size="11794" author="mikemccand" created="Mon, 24 Jan 2011 22:02:00 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 26 Oct 2009 10:50:33 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11763</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25715</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>