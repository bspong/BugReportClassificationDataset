<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:08:43 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2658/LUCENE-2658.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2658] TestIndexWriterExceptions random failure: AIOOBE in ByteBlockPool.allocSlice</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2658</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;TestIndexWriterExceptions threw this today, and its reproducable&lt;/p&gt;</description>
                <environment></environment>
            <key id="12474629">LUCENE-2658</key>
            <summary>TestIndexWriterExceptions random failure: AIOOBE in ByteBlockPool.allocSlice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Sep 2010 21:05:07 +0100</created>
                <updated>Wed, 1 Dec 2010 14:50:00 +0000</updated>
                    <resolved>Fri, 29 Oct 2010 18:07:12 +0100</resolved>
                            <version>3.1</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>2.9.4</fixVersion>
                <fixVersion>3.0.3</fixVersion>
                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12912683" author="rcmuir" created="Mon, 20 Sep 2010 21:08:14 +0100"  >&lt;p&gt;attached is my current modifications to trunk (unrelated to this failure completely)&lt;/p&gt;

&lt;p&gt;this is because, i have a &quot;single test seed&quot; that controls all behavior, so i want to make sure the random seed i give you will actually work.&lt;/p&gt;

&lt;p&gt;if you apply the patch, just run &lt;/p&gt;

&lt;p&gt;ant test-core -Dtestcase=TestIndexWriterExceptions -Dtests.seed=1285011726042&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
junit-sequential:
    [junit] Testsuite: org.apache.lucene.index.TestIndexWriterExceptions
    [junit] Testcase: testRandomExceptionsThreads(org.apache.lucene.index.TestIndexWriterExceptions):   FAILED
    [junit] thread Indexer 0: hit unexpected failure
    [junit] junit.framework.AssertionFailedError: thread Indexer 0: hit unexpected failure
    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:773)
    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:746)
    [junit]     at org.apache.lucene.index.TestIndexWriterExceptions.testRandomExceptionsThreads(TestIndexWriterExceptio
ns.java:195)
    [junit]
    [junit]
    [junit] Tests run: 2, Failures: 1, Errors: 0, Time elapsed: 1.257 sec
    [junit]
    [junit] ------------- Standard Output ---------------
    [junit] Indexer 2: unexpected exception3
    [junit] java.lang.ArrayIndexOutOfBoundsException: 483
    [junit]     at org.apache.lucene.index.ByteSliceReader.nextSlice(ByteSliceReader.java:108)
    [junit]     at org.apache.lucene.index.ByteSliceReader.writeTo(ByteSliceReader.java:90)
    [junit]     at org.apache.lucene.index.TermVectorsTermsWriterPerField.finish(TermVectorsTermsWriterPerField.java:186
)
    [junit]     at org.apache.lucene.index.TermsHashPerField.finish(TermsHashPerField.java:552)
    [junit]     at org.apache.lucene.index.TermsHashPerField.finish(TermsHashPerField.java:554)
    [junit]     at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:208)
    [junit]     at org.apache.lucene.index.DocFieldProcessorPerThread.processDocument(DocFieldProcessorPerThread.java:24
8)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:839)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:820)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2162)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2134)
    [junit]     at org.apache.lucene.index.TestIndexWriterExceptions$IndexerThread.run(TestIndexWriterExceptions.java:98
)
    [junit] Indexer 0: unexpected exception3
    [junit] java.lang.ArrayIndexOutOfBoundsException: 507
    [junit]     at org.apache.lucene.index.ByteSliceReader.nextSlice(ByteSliceReader.java:108)
    [junit]     at org.apache.lucene.index.ByteSliceReader.writeTo(ByteSliceReader.java:90)
    [junit]     at org.apache.lucene.index.TermVectorsTermsWriterPerField.finish(TermVectorsTermsWriterPerField.java:186
)
    [junit]     at org.apache.lucene.index.TermsHashPerField.finish(TermsHashPerField.java:552)
    [junit]     at org.apache.lucene.index.TermsHashPerField.finish(TermsHashPerField.java:554)
    [junit]     at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:208)
    [junit]     at org.apache.lucene.index.DocFieldProcessorPerThread.processDocument(DocFieldProcessorPerThread.java:24
8)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:839)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:820)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2162)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2134)
    [junit]     at org.apache.lucene.index.TestIndexWriterExceptions$IndexerThread.run(TestIndexWriterExceptions.java:98
)
    [junit] Indexer 1: unexpected exception3
    [junit] java.lang.ArrayIndexOutOfBoundsException: 15
    [junit]     at org.apache.lucene.index.ByteBlockPool.allocSlice(ByteBlockPool.java:122)
    [junit]     at org.apache.lucene.index.TermsHashPerField.writeByte(TermsHashPerField.java:526)
    [junit]     at org.apache.lucene.index.TermsHashPerField.writeVInt(TermsHashPerField.java:547)
    [junit]     at org.apache.lucene.index.TermVectorsTermsWriterPerField.newTerm(TermVectorsTermsWriterPerField.java:22
5)
    [junit]     at org.apache.lucene.index.TermsHashPerField.add(TermsHashPerField.java:375)
    [junit]     at org.apache.lucene.index.TermsHashPerField.add(TermsHashPerField.java:513)
    [junit]     at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:173)
    [junit]     at org.apache.lucene.index.DocFieldProcessorPerThread.processDocument(DocFieldProcessorPerThread.java:24
8)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:839)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:820)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2162)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2134)
    [junit]     at org.apache.lucene.index.TestIndexWriterExceptions$IndexerThread.run(TestIndexWriterExceptions.java:98
)
    [junit] Indexer 3: unexpected exception3
    [junit] java.lang.ArrayIndexOutOfBoundsException: 15
    [junit]     at org.apache.lucene.index.ByteBlockPool.allocSlice(ByteBlockPool.java:122)
    [junit]     at org.apache.lucene.index.TermsHashPerField.writeByte(TermsHashPerField.java:526)
    [junit]     at org.apache.lucene.index.TermsHashPerField.writeVInt(TermsHashPerField.java:547)
    [junit]     at org.apache.lucene.index.TermVectorsTermsWriterPerField.newTerm(TermVectorsTermsWriterPerField.java:22
5)
    [junit]     at org.apache.lucene.index.TermsHashPerField.add(TermsHashPerField.java:375)
    [junit]     at org.apache.lucene.index.TermsHashPerField.add(TermsHashPerField.java:513)
    [junit]     at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:173)
    [junit]     at org.apache.lucene.index.DocFieldProcessorPerThread.processDocument(DocFieldProcessorPerThread.java:24
8)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:839)
    [junit]     at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:820)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2162)
    [junit]     at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:2134)
    [junit]     at org.apache.lucene.index.TestIndexWriterExceptions$IndexerThread.run(TestIndexWriterExceptions.java:98
)
    [junit] NOTE: random codec of testcase &apos;testRandomExceptionsThreads&apos; was: MockVariableIntBlock(baseBlockSize=67)
    [junit] NOTE: random locale of testcase &apos;testRandomExceptionsThreads&apos; was: ar_AE
    [junit] NOTE: random timezone of testcase &apos;testRandomExceptionsThreads&apos; was: America/Winnipeg
    [junit] ------------- ---------------- ---------------
    [junit] Test org.apache.lucene.index.TestIndexWriterExceptions FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12912862" author="rcmuir" created="Tue, 21 Sep 2010 07:54:01 +0100"  >&lt;p&gt;i tested this on 3.x too (actually on both 3.x and trunk you do not need my patch, just use the seed)&lt;/p&gt;</comment>
                    <comment id="12913059" author="mikemccand" created="Tue, 21 Sep 2010 17:23:20 +0100"  >&lt;p&gt;This was a real issue!&lt;/p&gt;

&lt;p&gt;It happens if you hit an exception while processing term vectors, and, your docs have multiple fields with term vectors enabled.&lt;/p&gt;</comment>
                    <comment id="12913097" author="tsmith" created="Tue, 21 Sep 2010 18:23:45 +0100"  >&lt;p&gt;Is this related to/same as &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2501&quot; title=&quot;ArrayIndexOutOfBoundsException in ByteBlockPool.allocSlice&quot;&gt;&lt;del&gt;LUCENE-2501&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    <comment id="12913098" author="rcmuir" created="Tue, 21 Sep 2010 18:28:41 +0100"  >&lt;p&gt;Tim, i didnt see your problem coming from termvectorswriter... i think it might be a different bug.&lt;/p&gt;</comment>
                    <comment id="12913111" author="mikemccand" created="Tue, 21 Sep 2010 18:49:49 +0100"  >&lt;p&gt;Unfortunately, no, not directly anyway... &amp;#8211; this bug is specific to term vectors.&lt;/p&gt;

&lt;p&gt;Under the hood, term vectors and postings (doc/frq/pos) use the same class (ByteBlockPool), and in this case, after an exception, the term vectors code was failing to reset the ByteBlockPool.&lt;/p&gt;

&lt;p&gt;Though it is possible the same idea is happening on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2501&quot; title=&quot;ArrayIndexOutOfBoundsException in ByteBlockPool.allocSlice&quot;&gt;&lt;del&gt;LUCENE-2501&lt;/del&gt;&lt;/a&gt;, ie, an exception at a bad time leaving the ByteBlockPool in the same state... can you post the infoStream output on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2501&quot; title=&quot;ArrayIndexOutOfBoundsException in ByteBlockPool.allocSlice&quot;&gt;&lt;del&gt;LUCENE-2501&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    <comment id="12913140" author="tsmith" created="Tue, 21 Sep 2010 19:12:35 +0100"  >&lt;p&gt;sadly i haven&apos;t been able to gather the infostream for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2501&quot; title=&quot;ArrayIndexOutOfBoundsException in ByteBlockPool.allocSlice&quot;&gt;&lt;del&gt;LUCENE-2501&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
there&apos;s a comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2501&quot; title=&quot;ArrayIndexOutOfBoundsException in ByteBlockPool.allocSlice&quot;&gt;&lt;del&gt;LUCENE-2501&lt;/del&gt;&lt;/a&gt; that seems to indicate the exception that started it all though (CorruptIndexException: docs out of order (607 &amp;lt;= 607 ))&lt;/p&gt;</comment>
                    <comment id="12913141" author="rcmuir" created="Tue, 21 Sep 2010 19:20:10 +0100"  >&lt;p&gt;This test fails about 1% of the time currently... i applied the patch and ran it many times:&lt;/p&gt;

&lt;p&gt;junit-sequential:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testsuite: org.apache.lucene.index.TestIndexWriterExceptions&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 1800, Failures: 0, Errors: 0, Time elapsed: 1,291.131 sec&lt;/p&gt;

&lt;p&gt;+1 to commit&lt;/p&gt;</comment>
                    <comment id="12926268" author="rcmuir" created="Fri, 29 Oct 2010 14:08:31 +0100"  >&lt;p&gt;reopening for possible 2.9.4/3.0.3 backport.&lt;/p&gt;</comment>
                    <comment id="12926307" author="rcmuir" created="Fri, 29 Oct 2010 16:04:02 +0100"  >&lt;p&gt;I&apos;ll hack on the 3.0.x/2.9.x tests and see if i can make them fail (I think i can just turn on term vecs on more fields... but will see)&lt;/p&gt;</comment>
                    <comment id="12926327" author="rcmuir" created="Fri, 29 Oct 2010 16:58:59 +0100"  >&lt;p&gt;ok, here is a test that reproduces the failure on the 3.0 branch.&lt;/p&gt;

&lt;p&gt;I&apos;ll see about merging mike&apos;s fix now&lt;/p&gt;</comment>
                    <comment id="12926352" author="rcmuir" created="Fri, 29 Oct 2010 18:07:12 +0100"  >&lt;p&gt;Committed revision 1028827 (3.0.x)&lt;br/&gt;
Committed revision 1028849 (2.9.x)&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12458332" name="LUCENE-2658_30_test.patch" size="3767" author="rcmuir" created="Fri, 29 Oct 2010 16:58:59 +0100" />
                    <attachment id="12455073" name="LUCENE-2658_environment.patch" size="15414" author="rcmuir" created="Mon, 20 Sep 2010 21:08:14 +0100" />
                    <attachment id="12455154" name="LUCENE-2658.patch" size="3151" author="mikemccand" created="Tue, 21 Sep 2010 17:23:20 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 21 Sep 2010 16:23:20 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11181</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25034</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>