<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:33:16 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1695/LUCENE-1695.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1695] Update the Highlighter to use the new TokenStream API</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1695</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description></description>
                <environment></environment>
            <key id="12427999">LUCENE-1695</key>
            <summary>Update the Highlighter to use the new TokenStream API</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2009 14:14:38 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:27 +0100</updated>
                    <resolved>Thu, 30 Jul 2009 23:01:45 +0100</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>modules/highlighter</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12720114" author="markrmiller@gmail.com" created="Tue, 16 Jun 2009 14:16:50 +0100"  >&lt;p&gt;Rough, non backward compat patch.&lt;/p&gt;

&lt;p&gt;There is still an issue with testUnRewrittenQuery() - it passes in isolation, but not when run with the other tests:&lt;/p&gt;

&lt;p&gt;java.io.IOException: Stream closed&lt;br/&gt;
	at java.io.StringReader.ensureOpen(StringReader.java:56)&lt;br/&gt;
	at java.io.StringReader.read(StringReader.java:90)&lt;br/&gt;
	at org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(StandardTokenizerImpl.java:451)&lt;br/&gt;
	at org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(StandardTokenizerImpl.java:637)&lt;br/&gt;
	at org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(StandardTokenizer.java:153)&lt;br/&gt;
	at org.apache.lucene.analysis.standard.StandardFilter.incrementToken(StandardFilter.java:50)&lt;br/&gt;
	at org.apache.lucene.analysis.LowerCaseFilter.incrementToken(LowerCaseFilter.java:38)&lt;br/&gt;
	at org.apache.lucene.analysis.StopFilter.incrementToken(StopFilter.java:222)&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:242)&lt;/p&gt;

</comment>
                    <comment id="12721043" author="markrmiller@gmail.com" created="Thu, 18 Jun 2009 04:41:43 +0100"  >&lt;p&gt;Pretty much done, all tests pass. It breaks back compat, but frankly, straddling doesn&apos;t seem worth the effort here. Or even very possible. You can&apos;t really give new methods to use for the deprecated ones, and deprecating by class would be a real nuisance as we would lose class names I&apos;d rather keep. We have no back compat policy, and I think its worth just pushing this to the new API.&lt;/p&gt;

&lt;p&gt;I was also thinking about breaking back compat with changing the Highlighter to use the SpanScorer, so doing it all in one shot would be nice. The overall migration should be fairly simple once you understand the new TokenFilter API. I&apos;ll handle it for Solr.&lt;/p&gt;

&lt;p&gt;Still needs either its own changes file to explain or could go in the contrib common changes file.&lt;/p&gt;

&lt;p&gt;There is a change to the MemoryIndex to get around issues with the new/old API and CachingTokenFilters.&lt;/p&gt;

&lt;p&gt;Ill have to see how the new TokenFilter API improvements issue works out before doing a final patch for this.&lt;/p&gt;</comment>
                    <comment id="12735216" author="markrmiller@gmail.com" created="Sat, 25 Jul 2009 01:16:06 +0100"  >&lt;p&gt;to trunk&lt;/p&gt;</comment>
                    <comment id="12735225" author="markrmiller@gmail.com" created="Sat, 25 Jul 2009 02:13:05 +0100"  >&lt;p&gt;Turns out, if Token is not deprecated, we don&apos;t really have to change those Highlighter plugin API&apos;s after all. I&apos;ll revert them.&lt;/p&gt;</comment>
                    <comment id="12736097" author="markrmiller@gmail.com" created="Tue, 28 Jul 2009 16:00:55 +0100"  >&lt;p&gt;Actually, I guess I would rather still change the API&apos;s - otherwise there will have to be a lot of needless Token object creation. Anyone else have an opinion? If not, I&apos;m going to completely break back compat with the Highlighter here.&lt;/p&gt;</comment>
                    <comment id="12736100" author="rcmuir" created="Tue, 28 Jul 2009 16:09:10 +0100"  >&lt;p&gt;Mark there is a related issue in some of the other contribs.&lt;/p&gt;

&lt;p&gt;ShingleMatrix and Compound expose a token api in a similar way... I&apos;m kinda not sure what to do with these.&lt;/p&gt;</comment>
                    <comment id="12736106" author="thetaphi" created="Tue, 28 Jul 2009 16:34:28 +0100"  >&lt;p&gt;We had the same problem in core with Tee/sinkTokenizer. Both classes exported API using Token instances without any real use (I think it was because of tests). We deprecated the whole calss and created a new TeeSinkTokenFilter using States and do not export thier internal implementation (which is not needed for Tee/Sink usage).&lt;/p&gt;</comment>
                    <comment id="12736111" author="rcmuir" created="Tue, 28 Jul 2009 16:43:58 +0100"  >&lt;p&gt;not to hijack this issue (sorry) but Uwe, this reminds me that there are things that extend SinkTokenizer in contrib (analysis/sinks) as well, so it would be great to have a migration plan for those also.&lt;/p&gt;</comment>
                    <comment id="12736112" author="markrmiller@gmail.com" created="Tue, 28 Jul 2009 16:46:01 +0100"  >&lt;p&gt;Here we would need to deprecate the whole Highlighter or add some pretty nasty code to the current one to support both. Because the Highlighter has no back compat promise, I&apos;d almost rather just jump to the new API. I think there are a couple other breaks that should be made (to make using the SpanScorer more rational when we make it the default), so doing everything at once with 2.9 seems somewhat reasonable to me. Updating code to work with the new API should be as straightforward as updating a TokenFilter/TokenStream. I think you could probably continue using the 2.4 Highlighter jar as well? All of the classes should be intact and compatible I think.&lt;/p&gt;</comment>
                    <comment id="12736113" author="thetaphi" created="Tue, 28 Jul 2009 16:49:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think you could probably continue using the 2.4 Highlighter jar as well? All of the classes should be intact and compatible I think. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Should be (from the TokenStream changes perspective). Are there any non-bw changes in query processing that may affect highlighter?&lt;/p&gt;</comment>
                    <comment id="12736114" author="thetaphi" created="Tue, 28 Jul 2009 16:51:53 +0100"  >&lt;blockquote&gt;&lt;p&gt;not to hijack this issue (sorry) but Uwe, this reminds me that there are things that extend SinkTokenizer in contrib (analysis/sinks) as well, so it would be great to have a migration plan for those also&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Extend!? Very bad, all TokenStreams should be final &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &amp;#8211; &lt;b&gt;should be&lt;/b&gt; but may not. I think these classes should stay as they are and use Tee/Sink and we should deprecate them. But TeeSinkTokenStream is final (and this is important) and the corresponding Sinks are somehow abstract (without &quot;known&quot; implementation).&lt;/p&gt;</comment>
                    <comment id="12736646" author="markrmiller@gmail.com" created="Wed, 29 Jul 2009 15:29:07 +0100"  >&lt;p&gt;So without further objection, I&apos;m going to commit this so that I can finish the &apos;make spanscorer the default&apos; issue.&lt;/p&gt;</comment>
                    <comment id="12736957" author="markrmiller@gmail.com" created="Thu, 30 Jul 2009 03:02:13 +0100"  >&lt;p&gt;To trunk&lt;/p&gt;</comment>
                    <comment id="12737129" author="markrmiller@gmail.com" created="Thu, 30 Jul 2009 16:11:18 +0100"  >&lt;p&gt;Alright - this is no idle threat. I&apos;m gonna commit this. And break everyone&apos;s custom Highlighter plugin classes everywhere. Smash them. Obliterate them. Make them rewrite them. Or use the old Highlighter jar. Any moment now ...&lt;/p&gt;</comment>
                    <comment id="12737322" author="markrmiller@gmail.com" created="Thu, 30 Jul 2009 23:01:45 +0100"  >&lt;p&gt;I&apos;ve committed this. We can reopen if someone brings up a new argument. Putting it in will help me finish up making the SpanScorer the default Scorer.&lt;/p&gt;</comment>
                    <comment id="12737885" author="koji" created="Sat, 1 Aug 2009 15:11:13 +0100"  >&lt;p&gt;Mark, can you remove System.out from TokenSources? I got a lot of &quot;inc token&quot; log messages when running highlight-profile.alg...&lt;/p&gt;</comment>
                    <comment id="12737887" author="markrmiller@gmail.com" created="Sat, 1 Aug 2009 15:19:09 +0100"  >&lt;p&gt;Sorry about that Koji - just updated it.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                                <inwardlinks description="is part of">
                            <issuelink>
            <issuekey id="12408785">LUCENE-1460</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12427984">LUCENE-1693</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12414974" name="LUCENE-1695.patch" size="54849" author="markrmiller@gmail.com" created="Thu, 30 Jul 2009 03:02:13 +0100" />
                    <attachment id="12414485" name="LUCENE-1695.patch" size="56907" author="markrmiller@gmail.com" created="Sat, 25 Jul 2009 01:16:06 +0100" />
                    <attachment id="12411583" name="LUCENE-1695.patch" size="62783" author="markrmiller@gmail.com" created="Wed, 24 Jun 2009 00:03:33 +0100" />
                    <attachment id="12411024" name="LUCENE-1695.patch" size="52623" author="markrmiller@gmail.com" created="Thu, 18 Jun 2009 04:41:43 +0100" />
                    <attachment id="12410800" name="LUCENE-1695.patch" size="48734" author="markrmiller@gmail.com" created="Tue, 16 Jun 2009 14:16:50 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 28 Jul 2009 15:09:10 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12063</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26031</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>