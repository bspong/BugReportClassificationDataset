<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2478/LUCENE-2478.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2478] CachingWrapperFilter throws NPE when Filter.getDocIdSet() returns null</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2478</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Followup for &lt;a href=&quot;http://www.lucidimagination.com/search/document/1014ea92f15677bd/filter_getdocidset_returning_null_and_what_this_means_for_cachingwrapperfilter&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/1014ea92f15677bd/filter_getdocidset_returning_null_and_what_this_means_for_cachingwrapperfilter&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Daniel Noll is seeing an exception like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
    at org.apache.lucene.search.CachingWrapperFilter.docIdSetToCache(CachingWrapperFilter.java:84)
    at org.apache.lucene.search.CachingWrapperFilter.getDocIdSet(CachingWrapperFilter.java:112)
    at com.nuix.storage.search.LazyConstantScoreQuery$LazyFilterWrapper.getDocIdSet(SourceFile:91)
    at org.apache.lucene.search.ConstantScoreQuery$ConstantScorer.&amp;lt;init&amp;gt;(ConstantScoreQuery.java:116)
    at org.apache.lucene.search.ConstantScoreQuery$ConstantWeight.scorer(ConstantScoreQuery.java:81)
    at org.apache.lucene.search.BooleanQuery$BooleanWeight.scorer(BooleanQuery.java:297)
    at org.apache.lucene.search.BooleanQuery$BooleanWeight.scorer(BooleanQuery.java:297)
    at org.apache.lucene.search.QueryWrapperFilter$2.iterator(QueryWrapperFilter.java:75)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The class of our own is just an intermediary which delays creating the Filter object...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DocIdSet getDocIdSet(IndexReader reader) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (delegate == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                delegate = factory.createFilter();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; delegate.getDocIdSet(reader);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tracing through the code in CachingWrapperFilter, I can see that this NPE would occur if getDocIdSet() were to return null.&lt;/p&gt;

&lt;p&gt;The Javadoc on Filter says that null will be returned if no documents will be accepted by the filter, but it doesn&apos;t seem that Lucene itself is handling null return values correctly, so which is correct?  The code or the Javadoc?  Supposing that null really is OK, does this cause any problems with how CachingWrapperFilter is implementing the caching?  I notice it&apos;s calling get() and then comparing against null so it wouldn&apos;t appear that it can distinguish &quot;the entry isn&apos;t in the cache&quot; from &quot;the entry is in the cache but it&apos;s null&quot;.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12465456">LUCENE-2478</key>
            <summary>CachingWrapperFilter throws NPE when Filter.getDocIdSet() returns null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 May 2010 14:29:23 +0100</created>
                <updated>Fri, 18 Jun 2010 09:04:09 +0100</updated>
                    <resolved>Wed, 26 May 2010 15:27:46 +0100</resolved>
                            <version>2.9.1</version>
                <version>2.9.2</version>
                <version>3.0</version>
                <version>3.0.1</version>
                                <fixVersion>2.9.3</fixVersion>
                <fixVersion>3.0.2</fixVersion>
                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12871741" author="thetaphi" created="Wed, 26 May 2010 14:32:11 +0100"  >&lt;p&gt;This fixes this bug, will commit soon.&lt;/p&gt;

&lt;p&gt;The behaviour is now identical and null is handled equally to DocIdSet.EMPTY_DOCIDSET. DocIdSet.EMPTY_DOCIDSET is used in both cases to denote the empty set even when the filter returned null. By this also the null value is correctly cached without additional containsKey() checks.&lt;/p&gt;</comment>
                    <comment id="12871751" author="thetaphi" created="Wed, 26 May 2010 15:27:19 +0100"  >&lt;p&gt;Patch with additional tests from trunk.&lt;/p&gt;</comment>
                    <comment id="12871752" author="thetaphi" created="Wed, 26 May 2010 15:27:46 +0100"  >&lt;p&gt;Committed revisions: 948429 (trunk), 948430 (3.x), 948432 (3.0), 948450 (2.9)&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12445550" name="LUCENE-2478.patch" size="3429" author="thetaphi" created="Wed, 26 May 2010 15:27:19 +0100" />
                    <attachment id="12445548" name="LUCENE-2478.patch" size="780" author="thetaphi" created="Wed, 26 May 2010 14:32:11 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11342</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25214</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>