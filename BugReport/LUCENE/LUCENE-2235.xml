<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:09:30 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2235/LUCENE-2235.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2235] implement PerFieldAnalyzerWrapper.getOffsetGap</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2235</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;PerFieldAnalyzerWrapper does not delegates calls to getOffsetGap(Fieldable), instead it returns the default values from the implementation of Analyzer. (Similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-659&quot; title=&quot;[PATCH] PerFieldAnalyzerWrapper fails to implement getPositionIncrementGap()&quot;&gt;&lt;del&gt;LUCENE-659&lt;/del&gt;&lt;/a&gt; &quot;PerFieldAnalyzerWrapper fails to implement getPositionIncrementGap&quot;)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
            <key id="12446515">LUCENE-2235</key>
            <summary>implement PerFieldAnalyzerWrapper.getOffsetGap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="rjgodoy">Javier Godoy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jan 2010 09:49:44 +0000</created>
                <updated>Mon, 6 Dec 2010 10:49:14 +0000</updated>
                    <resolved>Fri, 29 Oct 2010 22:45:29 +0100</resolved>
                            <version>3.0</version>
                                <fixVersion>2.9.4</fixVersion>
                <fixVersion>3.0.3</fixVersion>
                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12804472" author="rjgodoy" created="Mon, 25 Jan 2010 09:50:59 +0000"  >&lt;p&gt;Patch&lt;/p&gt;</comment>
                    <comment id="12804474" author="thetaphi" created="Mon, 25 Jan 2010 09:58:34 +0000"  >&lt;p&gt;Looks good! Will commit this in a day or two.&lt;/p&gt;</comment>
                    <comment id="12804477" author="thetaphi" created="Mon, 25 Jan 2010 10:13:29 +0000"  >&lt;p&gt;Updates patch, please create the svn diff against the trunk (root of checkout) directory next time!&lt;/p&gt;

&lt;p&gt;Also added missing import statement and changes.txt entry.&lt;/p&gt;</comment>
                    <comment id="12805140" author="thetaphi" created="Tue, 26 Jan 2010 19:01:18 +0000"  >&lt;p&gt;Committed revision: 903368&lt;/p&gt;

&lt;p&gt;Thanks Javier!&lt;/p&gt;</comment>
                    <comment id="12926253" author="rcmuir" created="Fri, 29 Oct 2010 13:58:43 +0100"  >&lt;p&gt;reopening for possible 2.9.4/3.0.3 backport.&lt;/p&gt;</comment>
                    <comment id="12926473" author="thetaphi" created="Fri, 29 Oct 2010 22:45:29 +0100"  >&lt;p&gt;Committed 3.0 branch revision: 1028915&lt;br/&gt;
Committed 2.9 branch revision: 1028918&lt;/p&gt;</comment>
                    <comment id="12967057" author="npellow" created="Mon, 6 Dec 2010 01:01:04 +0000"  >&lt;p&gt;I just upgraded to 3.0.3 and we started getting NullPointerExceptions coming from PerFieldAnalyzerWrapper.&lt;br/&gt;
We have a  PerFieldAnalyzerWrapper that has a null defaultAnalyzer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PerFieldAnalyzerWrapper analyzer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PerFieldAnalyzerWrapper(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We add analyzers to all fields that are analyzed. ie: field.isAnalyzed() == true.&lt;br/&gt;
getOffsetGap on  PerFieldAnalyzerWrapper is being called, even for these non-analyzed fields. Is this expected behaviour?&lt;/p&gt;

&lt;p&gt;Lines 200-203 of DocInverterPerField are: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (anyToken)
          fieldState.offset += docState.analyzer.getOffsetGap(field);
        fieldState.boost *= field.getBoost();
      }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should this be checking that a field is indeed analyzed before calling getOffsetGap ?&lt;/p&gt;</comment>
                    <comment id="12967115" author="thetaphi" created="Mon, 6 Dec 2010 07:34:21 +0000"  >&lt;p&gt;Hi Nick,&lt;br/&gt;
thanks for reporting this. Your problem only occurs since the missing method was added (before PFAW only returned some default, now it throws NPE) in that case.&lt;/p&gt;

&lt;p&gt;In general, Lucene does not support &lt;b&gt;null&lt;/b&gt; analyzers anywhere (not as ctor argument in IW/IWC) or e.g. here. You should always add a &quot;simple&quot; analyzer to IndexWriter (WhitespaceAnalyzer, SimpleAnalyzer, KeywordAnalyzer) or other methods taking Analyzer.&lt;/p&gt;

&lt;p&gt;To really fix this, we have to review all places that don&apos;t need to call Analyzers. There are e.g. other places, like when you directly pass the TokenStream to the Field with &quot;new Field(name, TokenStream), it also calls the analyzer, so you have to implement it.&lt;/p&gt;</comment>
                    <comment id="12967121" author="thetaphi" created="Mon, 6 Dec 2010 08:27:36 +0000"  >&lt;p&gt;To come back to the original issue:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should this be checking that a field is indeed analyzed before calling getOffsetGap ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my opinion this should be done (and so this issue would disappear). Can you open another issue requesting this check and link it to this one?&lt;/p&gt;

&lt;p&gt;One problem coming from not checking for &quot;analyzed&quot; is this:&lt;br/&gt;
You add a field indexed and it gets analyzed by PFAW - After that you add the same field name stored-only (which is perfectly legal and often used, e.g. when the stored value is binary or in some other format and does not correspond to the indexed text), the positionIncrement is increased. After that you again add another instance of the same field as indexed-only, which also increases posIncr. So you have 2 times the gap between both indexed sub-fields. This is definitely wrong.&lt;/p&gt;</comment>
                    <comment id="12967148" author="npellow" created="Mon, 6 Dec 2010 10:36:03 +0000"  >&lt;p&gt;Thanks for the clarification, Uwe. I wasn&apos;t sure if null Analyzers were meant to be accepted or not. I was upgrading some existing code from 3.0.2 to 3.0.3 and stumbled across that, so its good to know.&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2801&quot; title=&quot;getOffsetGap should not be called for non-anaylyzed fields&quot;&gt;LUCENE-2801&lt;/a&gt; to track the real reason the check should be done too!&lt;/p&gt;</comment>
                    <comment id="12967151" author="thetaphi" created="Mon, 6 Dec 2010 10:49:14 +0000"  >&lt;p&gt;Thanks, Nick!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12492142">LUCENE-2801</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12431300" name="LUCENE-2235.patch" size="1405" author="thetaphi" created="Mon, 25 Jan 2010 10:13:29 +0000" />
                    <attachment id="12431297" name="PerFieldAnalyzerWrapper.patch" size="666" author="rjgodoy" created="Mon, 25 Jan 2010 09:50:59 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 25 Jan 2010 09:58:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11553</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25490</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>