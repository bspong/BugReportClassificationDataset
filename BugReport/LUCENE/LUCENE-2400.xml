<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:21:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2400/LUCENE-2400.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2400] ShingleFilter: don&apos;t output all-filler shingles/unigrams; also, convert from TermAttribute to CharTermAttribute</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2400</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;When the input token stream to ShingleFilter has position increments greater than one, filler tokens are inserted for each position for which there is no token in the input token stream.  As a result, unigrams (if configured) and shingles can be filler-only.  Filler-only output tokens make no sense - these should be removed.&lt;/p&gt;

&lt;p&gt;Also, because TermAttribute has been deprecated in favor of CharTermAttribute, the patch will also convert TermAttribute usages to CharTermAttribute in ShingleFilter.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12462358">LUCENE-2400</key>
            <summary>ShingleFilter: don&apos;t output all-filler shingles/unigrams; also, convert from TermAttribute to CharTermAttribute</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 Apr 2010 16:29:37 +0100</created>
                <updated>Mon, 16 May 2011 19:15:47 +0100</updated>
                    <resolved>Mon, 3 May 2010 14:30:10 +0100</resolved>
                            <version>3.0.1</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12858304" author="steve_rowe" created="Sun, 18 Apr 2010 16:37:56 +0100"  >&lt;p&gt;Patch implementing the above-described changes, along with tests confirming that all-filler shingles/unigrams are no longer output.  A new term attribute called FillerAttribute is defined to mark whether enqueued terms are filler terms.&lt;/p&gt;

&lt;p&gt;Unfortunately, these changes cause a roughly 22% slowdown - contrib/benchmark numbers for the shingle alg (I got similar numbers for Java 1.5):&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.04s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.33s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-22.6%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.23s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.49s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-18.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.00s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.56s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-22.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.13s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.72s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-22.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12858306" author="rcmuir" created="Sun, 18 Apr 2010 17:09:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;Unfortunately, these changes cause a roughly 22% slowdown - contrib/benchmark numbers for the shingle alg (I got similar numbers for Java 1.5):&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Steven, i wonder if this is because of a stupid thing, I noticed this in your patch:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-      shingleBuilder.append(termAtt.termBuffer(), 0, termAtt.termLength());
+      gramBuilder.append(charTermAtt.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i would recommend gramBuilder.append(termAtt.buffer(), 0, termAtt.length()) like before, maybe its just the extra gc cost of creating useless strings?&lt;/p&gt;</comment>
                    <comment id="12858307" author="thetaphi" created="Sun, 18 Apr 2010 17:15:16 +0100"  >&lt;p&gt;Alternatively you can directly pass it to StringBuilder, as CharTermAttribute implements CharSequence: &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/java/lang/StringBuilder.html#append(java.lang.CharSequence)&quot; class=&quot;external-link&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/java/lang/StringBuilder.html#append(java.lang.CharSequence)&lt;/a&gt;. But copying the buffer as Robert suggested should be faster.&lt;/p&gt;

&lt;p&gt;Both variant are faster than creating a new String.&lt;/p&gt;</comment>
                    <comment id="12858312" author="steve_rowe" created="Sun, 18 Apr 2010 18:06:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;i would recommend gramBuilder.append(termAtt.buffer(), 0, termAtt.length()) like before, maybe its just the extra gc cost of creating useless strings?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll give this a try.&lt;/p&gt;
</comment>
                    <comment id="12858320" author="steve_rowe" created="Sun, 18 Apr 2010 18:46:24 +0100"  >&lt;p&gt;Robert&apos;s change cut the performance penalty in half:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.15s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.25s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.08s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-8.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.29s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.42s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.08s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-9.6%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.07s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.39s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.08s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-13.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.54s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.08s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-17.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12858322" author="steve_rowe" created="Sun, 18 Apr 2010 19:34:45 +0100"  >&lt;p&gt;This patch implements Uwe&apos;s suggestion (on #lucene-dev) of switching term attribute setting to use the simpler termAtt.append(gramBuilder).  However, this seems to slow things down:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.36s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-18.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.28s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.54s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-17.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.00s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.61s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-24.1%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.14s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.72s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.09s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-22.0%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12858326" author="steve_rowe" created="Sun, 18 Apr 2010 20:02:51 +0100"  >&lt;p&gt;I tried adding specialized versions of CharTermAttribute.append(StringBuilder,...):&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CharTermAttribute append(StringBuilder builder) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; append(builder, 0, builder.length());
}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CharTermAttribute append(StringBuilder builder, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end) {
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; newTermLength = termLength + end - start;
  resizeBuffer(newTermLength);
  builder.getChars(start, end, termBuffer, termLength);
  termLength = newTermLength;
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This helped a little bit, but it&apos;s still slower than the fully-spelled-out CharTermAttribute setting code that was previously in place:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.08s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.26s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-15.6%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.26s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.41s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-11.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.49s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-18.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.17s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.64s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-18.5%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12858343" author="thetaphi" created="Sun, 18 Apr 2010 22:23:39 +0100"  >&lt;p&gt;The improvements are in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2401&quot; title=&quot;Improve performance of CharTermAttribute(Impl) and also fully implement Appendable&quot;&gt;&lt;del&gt;LUCENE-2401&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    <comment id="12858344" author="thetaphi" created="Sun, 18 Apr 2010 22:27:48 +0100"  >&lt;blockquote&gt;&lt;p&gt;I tried adding specialized versions of CharTermAttribute.append(StringBuilder,...): &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did you also add this to the interface, else your code would not use this method. &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2401&quot; title=&quot;Improve performance of CharTermAttribute(Impl) and also fully implement Appendable&quot;&gt;&lt;del&gt;LUCENE-2401&lt;/del&gt;&lt;/a&gt; does not have the start,end methods, as this is not even in StringBuilder.&lt;/p&gt;</comment>
                    <comment id="12858353" author="steve_rowe" created="Sun, 18 Apr 2010 23:03:03 +0100"  >&lt;p&gt;Uwe told me on #lucene-dev that without adding the specialized CharTermAttribute methods to the interface, they wouldn&apos;t get invoked, and so since I didn&apos;t, the numbers in the previous post are meaningless.&lt;/p&gt;

&lt;p&gt;So, I applied &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2401&quot; title=&quot;Improve performance of CharTermAttribute(Impl) and also fully implement Appendable&quot;&gt;&lt;del&gt;LUCENE-2401&lt;/del&gt;&lt;/a&gt; to add the correct form of the specializations, then re-ran the shingle alg, and it looks like there is no longer a penalty for using the shorthand form Uwe suggested.  Here are the numbers:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.31s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-8.3%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.40s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.54s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-9.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.17s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.57s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-16.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.33s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.75s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.12s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-15.9%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12860795" author="steve_rowe" created="Mon, 26 Apr 2010 05:06:57 +0100"  >&lt;p&gt;New patch.  Removed FillerAttribute.  Switched inputWindow from LinkedList&amp;lt;State&amp;gt; to LinkedList&amp;lt;InputWindowToken&amp;gt;, where InputWindowToken holds an AttributeSource, references to Attributes of interest, and a boolean isFiller.  InputWindowToken instances are recycled when shifting the input window.  These changes result in faster performance:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Max Shingle Size&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unigrams?&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Unpatched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Patched&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;StandardAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.26s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.05s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;24.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.37s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.20s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16.8%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.84s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.46s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.11s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;18.2%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12861670" author="steve_rowe" created="Wed, 28 Apr 2010 05:06:26 +0100"  >&lt;p&gt;Tests all pass.  I think this is ready to go.&lt;/p&gt;</comment>
                    <comment id="12862917" author="thetaphi" created="Fri, 30 Apr 2010 23:39:56 +0100"  >&lt;p&gt;Hi Steven,&lt;/p&gt;

&lt;p&gt;I take this one.I will review the patch soon!&lt;/p&gt;</comment>
                    <comment id="12863330" author="thetaphi" created="Mon, 3 May 2010 14:03:07 +0100"  >&lt;p&gt;This patch looks good. You also removed the incorrect usage of LinkedList and now use it in its correct pattern: Only adding/removing items to/from one end. The old filter sometimes used get(index) on the list, which is slow.&lt;/p&gt;

&lt;p&gt;Will commit shortly.&lt;/p&gt;</comment>
                    <comment id="12863343" author="thetaphi" created="Mon, 3 May 2010 14:30:10 +0100"  >&lt;p&gt;Committed revision: 940451&lt;/p&gt;</comment>
                    <comment id="12863378" author="steve_rowe" created="Mon, 3 May 2010 16:28:58 +0100"  >&lt;p&gt;Thanks Uwe!&lt;/p&gt;</comment>
                    <comment id="13013281" author="gsingers" created="Wed, 30 Mar 2011 16:49:52 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12442112" name="ASF.LICENSE.NOT.GRANTED--LUCENE-2400.patch" size="21308" author="steve_rowe" created="Sun, 18 Apr 2010 16:37:56 +0100" />
                    <attachment id="12442812" name="LUCENE-2400.patch" size="25679" author="steve_rowe" created="Mon, 26 Apr 2010 05:06:57 +0100" />
                    <attachment id="12442122" name="LUCENE-2400.patch" size="21110" author="steve_rowe" created="Sun, 18 Apr 2010 19:34:45 +0100" />
                    <attachment id="12442121" name="LUCENE-2400.patch" size="21331" author="steve_rowe" created="Sun, 18 Apr 2010 18:46:24 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 18 Apr 2010 16:09:05 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11402</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25291</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>