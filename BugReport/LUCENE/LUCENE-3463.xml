<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:16:24 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3463/LUCENE-3463.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3463] Jenkins trunk tests (nightly only) fail quite often with OOM in Automaton/FST tests</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3463</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The nightly Job Lucene-trunk quite often fails with OOM (in several methods, not always in the same test):&lt;/p&gt;

&lt;p&gt;Example from last night (this time a huge Automaton):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] java.lang.OutOfMemoryError: Java heap space
[junit] Dumping heap to /home/hudson/hudson-slave/workspace/Lucene-trunk/heapdumps/java_pid38855.hprof ...
[junit] Heap dump file created [86965954 bytes in 1.186 secs]
[junit] Testsuite: org.apache.lucene.index.TestTermsEnum
[junit] Testcase: testIntersectRandom(org.apache.lucene.index.TestTermsEnum):	Caused an ERROR
[junit] Java heap space
[junit] java.lang.OutOfMemoryError: Java heap space
[junit] 	at org.apache.lucene.util.automaton.RunAutomaton.&amp;lt;init&amp;gt;(RunAutomaton.java:128)
[junit] 	at org.apache.lucene.util.automaton.ByteRunAutomaton.&amp;lt;init&amp;gt;(ByteRunAutomaton.java:28)
[junit] 	at org.apache.lucene.util.automaton.CompiledAutomaton.&amp;lt;init&amp;gt;(CompiledAutomaton.java:134)
[junit] 	at org.apache.lucene.index.TestTermsEnum.testIntersectRandom(TestTermsEnum.java:266)
[junit] 	at org.apache.lucene.util.LuceneTestCase$2$1.evaluate(LuceneTestCase.java:611)
[junit] 	at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:148)
[junit] 	at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)
[junit] 
[junit] 
[junit] Tests run: 6, Failures: 0, Errors: 1, Time elapsed: 11.699 sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Other traces:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testsuite: org.apache.lucene.util.fst.TestFSTs
[junit] Testcase: testRealTerms(org.apache.lucene.util.fst.TestFSTs):	Caused an ERROR
[junit] Java heap space
[junit] java.lang.OutOfMemoryError: Java heap space
[junit] 	at org.apache.lucene.util.ArrayUtil.grow(ArrayUtil.java:338)
[junit] 	at org.apache.lucene.util.fst.FST$BytesWriter.writeBytes(FST.java:927)
[junit] 	at org.apache.lucene.util.fst.ByteSequenceOutputs.write(ByteSequenceOutputs.java:113)
[junit] 	at org.apache.lucene.util.fst.ByteSequenceOutputs.write(ByteSequenceOutputs.java:32)
[junit] 	at org.apache.lucene.util.fst.FST.addNode(FST.java:451)
[junit] 	at org.apache.lucene.util.fst.NodeHash.add(NodeHash.java:122)
[junit] 	at org.apache.lucene.util.fst.Builder.compileNode(Builder.java:180)
[junit] 	at org.apache.lucene.util.fst.Builder.finish(Builder.java:495)
[junit] 	at org.apache.lucene.index.codecs.memory.MemoryCodec$TermsWriter.finish(MemoryCodec.java:232)
[junit] 	at org.apache.lucene.index.FreqProxTermsWriterPerField.flush(FreqProxTermsWriterPerField.java:414)
[junit] 	at org.apache.lucene.index.FreqProxTermsWriter.flush(FreqProxTermsWriter.java:92)
[junit] 	at org.apache.lucene.index.TermsHash.flush(TermsHash.java:117)
[junit] 	at org.apache.lucene.index.DocInverter.flush(DocInverter.java:80)
[junit] 	at org.apache.lucene.index.DocFieldProcessor.flush(DocFieldProcessor.java:78)
[junit] 	at org.apache.lucene.index.DocumentsWriterPerThread.flush(DocumentsWriterPerThread.java:472)
[junit] 	at org.apache.lucene.index.DocumentsWriter.doFlush(DocumentsWriter.java:420)
[junit] 	at org.apache.lucene.index.DocumentsWriter.flushAllThreads(DocumentsWriter.java:568)
[junit] 	at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:366)
[junit] 	at org.apache.lucene.index.IndexReader.open(IndexReader.java:317)
[junit] 	at org.apache.lucene.util.fst.TestFSTs.testRealTerms(TestFSTs.java:1034)
[junit] 	at org.apache.lucene.util.LuceneTestCase$2$1.evaluate(LuceneTestCase.java:611)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testsuite: org.apache.lucene.util.automaton.TestCompiledAutomaton
[junit] Testcase: testRandom(org.apache.lucene.util.automaton.TestCompiledAutomaton):	Caused an ERROR
[junit] Java heap space
[junit] java.lang.OutOfMemoryError: Java heap space
[junit] 	at org.apache.lucene.util.automaton.RunAutomaton.&amp;lt;init&amp;gt;(RunAutomaton.java:128)
[junit] 	at org.apache.lucene.util.automaton.ByteRunAutomaton.&amp;lt;init&amp;gt;(ByteRunAutomaton.java:28)
[junit] 	at org.apache.lucene.util.automaton.CompiledAutomaton.&amp;lt;init&amp;gt;(CompiledAutomaton.java:134)
[junit] 	at org.apache.lucene.util.automaton.TestCompiledAutomaton.build(TestCompiledAutomaton.java:39)
[junit] 	at org.apache.lucene.util.automaton.TestCompiledAutomaton.testTerms(TestCompiledAutomaton.java:55)
[junit] 	at org.apache.lucene.util.automaton.TestCompiledAutomaton.testRandom(TestCompiledAutomaton.java:101)
[junit] 	at org.apache.lucene.util.LuceneTestCase$2$1.evaluate(LuceneTestCase.java:611)
[junit] 	at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:148)
[junit] 	at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Almost every nightly test fails, history: &lt;a href=&quot;https://builds.apache.org/job/Lucene-trunk&quot; class=&quot;external-link&quot;&gt;https://builds.apache.org/job/Lucene-trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We should maybe raise the max heap space or reduce doc counts/...&lt;/p&gt;</description>
                <environment></environment>
            <key id="12524570">LUCENE-3463</key>
            <summary>Jenkins trunk tests (nightly only) fail quite often with OOM in Automaton/FST tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Sep 2011 18:14:37 +0100</created>
                <updated>Fri, 10 May 2013 11:43:02 +0100</updated>
                    <resolved>Wed, 5 Oct 2011 14:17:03 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13115539" author="mikemccand" created="Tue, 27 Sep 2011 15:37:18 +0100"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestFSTs.testRealTerms -seed 4857a4f3c937e12e:15e316518d8ee33:-4b9de2133ce6125c -mult 3 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;ll hit OOME.  The problem is that the test gets RandomCodecProvider which then assigns MemoryCodec to a bad field.&lt;/p&gt;

&lt;p&gt;I think we need a clean way to annotate that a given test cannot handle Memory/SimpleText codecs and then mark the above tests as such?&lt;/p&gt;</comment>
                    <comment id="13115540" author="mikemccand" created="Tue, 27 Sep 2011 15:37:19 +0100"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestFSTs.testRealTerms -seed 4857a4f3c937e12e:15e316518d8ee33:-4b9de2133ce6125c -mult 3 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;ll hit OOME.  The problem is that the test gets RandomCodecProvider which then assigns MemoryCodec to a bad field.&lt;/p&gt;

&lt;p&gt;I think we need a clean way to annotate that a given test cannot handle Memory/SimpleText codecs and then mark the above tests as such?&lt;/p&gt;</comment>
                    <comment id="13115542" author="mikemccand" created="Tue, 27 Sep 2011 15:39:51 +0100"  >&lt;p&gt;Here is a comment that I will only add once.&lt;/p&gt;</comment>
                    <comment id="13115544" author="thetaphi" created="Tue, 27 Sep 2011 15:42:37 +0100"  >&lt;p&gt;LOL. I just wondered about it, because this was the second time today a comment was posted twice. I was thinking about a problem with JIRA.&lt;/p&gt;</comment>
                    <comment id="13118257" author="mikemccand" created="Fri, 30 Sep 2011 19:24:17 +0100"  >&lt;p&gt;Here was my first stab at just fixing these tests to avoid Memory/SimpleTextCodec themselves.&lt;/p&gt;

&lt;p&gt;But it&apos;s not committable!  Because it alters the RCP instance that other tests may share (ie each test would have to put back the 2 codecs I think).&lt;/p&gt;

&lt;p&gt;Would really be nice to have a test annotation and then LTC just magically avoids the codecs.&lt;/p&gt;</comment>
                    <comment id="13118268" author="thetaphi" created="Fri, 30 Sep 2011 19:39:19 +0100"  >&lt;p&gt;Should be easy. Unfortunatley, I am currently Lucene-disabled &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13118272" author="dweiss" created="Fri, 30 Sep 2011 19:43:03 +0100"  >&lt;p&gt;I&apos;m fairly busy too, but I need to put together a presentation about randomized testing for Barcelona... this would be a good opportunity for a clean-up refactoring integrating several ideas that have been discussed so far on this list (and others that I&apos;ve been carrying in my head for some time).&lt;/p&gt;

&lt;p&gt;I&apos;ll share once I have something concrete.&lt;/p&gt;</comment>
                    <comment id="13118485" author="thetaphi" created="Fri, 30 Sep 2011 22:43:45 +0100"  >&lt;p&gt;Here a patch that implements this annotation (@UseNoMemoryExpensiveCodec). I am not so happy with it, as it also moves this codec selection shit into the LuceneTestRunner). Maybe somebody has a better idea how to pass the flag down to LTC. Unfortunately LTC creates the RandomCodecProvider per class not per test method, so removing and readding the codecs from it is the only solution to handle this per test method.&lt;/p&gt;

&lt;p&gt;Mike, can you test if this fixes the problems. I had no time to check this, I only implemented it.&lt;/p&gt;</comment>
                    <comment id="13118509" author="thetaphi" created="Fri, 30 Sep 2011 23:19:31 +0100"  >&lt;p&gt;Moved the codec handling back to LTC and made the test runner more abstract. There are still some issues with tests that create the index in BeforeClass but cannot read it later when @UseNoMemoryExpensiveCodec is selected for one test method. Also similar issues may occur if the test explicitely selects such a codec (Mike found some failing tests, still investigating).&lt;/p&gt;</comment>
                    <comment id="13118516" author="thetaphi" created="Fri, 30 Sep 2011 23:25:43 +0100"  >&lt;p&gt;We could generalize the whole thing a little bit more:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add 2 methods to LTC: beforeTestMethod(FrameworkMethod m) and afterTestMethod(FrameWorkMethod m)&lt;/li&gt;
	&lt;li&gt;Do the wohle annotation checking inside there. this would it make easier to extend in the future&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="13118533" author="thetaphi" created="Fri, 30 Sep 2011 23:37:01 +0100"  >&lt;p&gt;Patch with full flexibility&lt;/p&gt;</comment>
                    <comment id="13118573" author="hossman" created="Sat, 1 Oct 2011 00:37:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;There are still some issues with tests that create the index in BeforeClass but cannot read it later when @UseNoMemoryExpensiveCodec is selected for one test method. Also similar issues may occur if the test explicitely selects such a codec (Mike found some failing tests, still investigating).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...i haven&apos;t really been following this issue (or looked at the patches) but wouldn&apos;t the most straight forward way to deal with this sort of thing be to support specifying the annotation that indicate certain codecs are required/prohibited on either the individual test methods or on the entire test class &amp;#8211; so if a class wants to build the index in an @BeforeClass method, it has to put the @UseNoMemoryExpensiveCodec or @MustUseCodec(&quot;PulsingCodec&quot;) on the entire class and not the individual methods?&lt;/p&gt;

&lt;p&gt;(where by &quot;most straight forward&quot; i mean for the test writer, not neccessarily for how it&apos;s implemented in LTC)&lt;/p&gt;

&lt;p&gt;In the case where classes are building the indexes in @Before or @Test methods, the codec anotations could be placed on both the class and the test methods - with the method annotations overwritting the class annotations...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/** Most of these tests create indexes too bug &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; in memory codecs */
@UseNoMemoryExpensiveCodec &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class CoolFeatureTest {
  @Before buildIndex() { ... }
  @Test testFooIntensively() { ... }
  @Test testBarIntensively { ... }
  /* &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test should work with any codec */
  @Test @UseRandomCodec testSimpleStuff() { ... }
  /* &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; tests specific to pulsing codec, so it must also use that one */
  @Test @UseCodec(&lt;span class=&quot;code-quote&quot;&gt;&quot;PulsingCodec&quot;&lt;/span&gt;) testPulsingCodec() { ... }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                    <comment id="13118582" author="rcmuir" created="Sat, 1 Oct 2011 01:02:52 +0100"  >&lt;p&gt;I think its dangerous to do this per-test method (problems with random seed reproducibility and such).&lt;/p&gt;

&lt;p&gt;Can we just do this per-class? why is it necessary for the annotation to work at methods?&lt;/p&gt;</comment>
                    <comment id="13118605" author="rcmuir" created="Sat, 1 Oct 2011 01:48:24 +0100"  >&lt;p&gt;Hoss asked me some questions about my comment, so some more explanations of what I meant:&lt;/p&gt;

&lt;p&gt;First I think it would be great to add this annotation: its bogus how we assume() so much (and annoying from your ide when you randomly get a green light sometimes and think you fixed your problem but you didnt).&lt;/p&gt;

&lt;p&gt;But the configuration of Codec (and i think other things, Locale, Similarity, ...) is currently across the whole class for consistency, which means its pulling from a per-class random seed. Because of this I think it would be &quot;tricky&quot; for the annotation to properly work at the test method level if we want the random seeds to always reproduce failures... I&apos;m not saying its impossible...&lt;/p&gt;

&lt;p&gt;So my idea of the simplest solution would be for the annotation to only work at the whole class level... I think for practical purposes this is all we need to fix these problems and remove these assume()s.&lt;/p&gt;</comment>
                    <comment id="13118717" author="thetaphi" created="Sat, 1 Oct 2011 11:22:08 +0100"  >&lt;p&gt;Robert: Its indeed strange, but I solved the problem reproducible. The CodecProvider is always the same, so it uses only one time the random seeds per class. Inside the annotated test methods, LTC simply tells RandomCodecProvider, that it should temporarily not return several codecs. This consumes no randomness and is reproducible, as it is done before/after each test. &lt;/p&gt;

&lt;p&gt;This was implemented by a callback from the testrunner to a static LTC method (beforeTestMethod/afterTestMethod), that gets the FrameworkMethod instance of the running test and will change the codec provider accordingly, if it detects the annotation on the FrameworkMethod. On shutdown it reverses the change (the callback is called from within a finalization block, so ensured to do the cleanup).&lt;/p&gt;

&lt;p&gt;This approach is somehow a duplicate of the standard @Before and @After, but those aleady available ones miss the FrameworkMethod parameter passed to the method, so it&apos;s hard to detect the currently running test.&lt;/p&gt;</comment>
                    <comment id="13118723" author="thetaphi" created="Sat, 1 Oct 2011 12:27:30 +0100"  >&lt;p&gt;Some further issue hunting showed the followinbg problems with the current patch, that make it almost impossible to implement correctly without redesigning RandomCodecProvider in LTC:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mike have seen problems with running all tests and suddenly got errors about missing &quot;SimpleText&quot; or &quot;Memory&quot; codec. The reason is simple: once a field uses a codec this is preserved to infinity in the previousMappings map. This problem could be solved by clearing the map before each test class/test method. The field-&amp;gt;codec mappings are not random, they are based on a a final per codec-provider instance seed and the field&apos;s hashcode and modulo the size of codecs.&lt;/li&gt;
	&lt;li&gt;My patch violates the reproducibility, as unregistering and readding a codec from the RandomCodecProvider changes the order in the list and modifies the selection of codecs based on field name. Theoretically, RandomCodecProvider should not allow any modifications to its registered codecs after creating (and the swapCodecs operations in LTC).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A possible solution might be to have two RCPs created by LTC and only exchanging them based on annotation. Problem is that both still have separate mappings from field name to codec -&amp;gt; does not work if you reuse indexes across test methods. Another possible solution might be to enable a lowMemory mode for RCP (via a setter, I already implemented that somehow), so it just never returns memory/simpletext (maybe replace by standard codec). Problem here again, the mapping from field name to codec is preserved for all codecs, but if a mapping to a simpletext/memory codec already exists for field name, it cannot be used (so the fieldname is &quot;dead&quot; for this test. This is also a no-go.&lt;/p&gt;

&lt;p&gt;I think we should move the annotation, as Robert suggests, up to the class, so all methods in a class will get the reduced set of codecs. Before each class (beforeClass) we cleanup the codec provider and recreate a new one according to the annotation. The easy way is then (as we did for some other tests, too), to move the tests that should not run on simpletext/memory to separate classes - this is the easiest way to go.&lt;/p&gt;</comment>
                    <comment id="13118835" author="mikemccand" created="Sat, 1 Oct 2011 16:36:46 +0100"  >&lt;p&gt;+1 to making the annotation per class &amp;#8211; it&apos;s too hairy to do it per method.&lt;/p&gt;

&lt;p&gt;We just have to remember to move &quot;hog tests&quot; to their own classes so we don&apos;t lose coverage of any non-hog test methods sharing the same class.&lt;/p&gt;</comment>
                    <comment id="13120417" author="thetaphi" created="Tue, 4 Oct 2011 20:45:42 +0100"  >&lt;p&gt;Here patch for the per-class annotation (it also got the right annotation target).&lt;/p&gt;

&lt;p&gt;The test methods are not yet moved to separate classes, I just moved the annotation up.&lt;/p&gt;

&lt;p&gt;Mike can you check that it is better now?&lt;/p&gt;</comment>
                    <comment id="13120429" author="thetaphi" created="Tue, 4 Oct 2011 21:12:04 +0100"  >&lt;p&gt;Minor cleanups.&lt;/p&gt;</comment>
                    <comment id="13120433" author="mikemccand" created="Tue, 4 Oct 2011 21:17:34 +0100"  >&lt;p&gt;Thanks Uwe!  I&apos;ll beast it.&lt;/p&gt;</comment>
                    <comment id="13120486" author="mikemccand" created="Tue, 4 Oct 2011 22:24:08 +0100"  >&lt;p&gt;Patch looks good!  The seed no longer fails, and beast beasted lucene core+contrib tests 95 times w/ no failure!  Thanks Uwe &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13120492" author="thetaphi" created="Tue, 4 Oct 2011 22:32:50 +0100"  >&lt;p&gt;Thanks, Mike!&lt;/p&gt;

&lt;p&gt;I will work on extracting the methods annotated before from all test classes that have assumes. We can also commit this for now before refactoring?&lt;/p&gt;

&lt;p&gt;What is with the TestCompiledAutomaton test? It has commented-out code, looks like a temporary fix.&lt;/p&gt;</comment>
                    <comment id="13120508" author="mikemccand" created="Tue, 4 Oct 2011 22:54:07 +0100"  >&lt;p&gt;Yes we can commit now and refactor the tests after....&lt;/p&gt;

&lt;p&gt;Oh you can remove that commented out code in TestCompiledAutomaton; the new fix is better (big reduction on RAM/CPU so hopefully no more OOME from it).&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    <comment id="13120516" author="thetaphi" created="Tue, 4 Oct 2011 23:03:58 +0100"  >&lt;p&gt;Updated patch, I will commit that tomorrow.&lt;/p&gt;

&lt;p&gt;Some small things that might be changed: We could remove the assumes if we add another check in the TestCaseRunner: If the annotation is present and the current codec uses SimpleText or Memory (in the case the use has explicitely given it using -Dtests.codec...), it should remove all test methods from this test (like @Nightly on the class). I think that would be the cleanest solution to prevent bad behaviour with wrong codecs?&lt;/p&gt;</comment>
                    <comment id="13120641" author="rcmuir" created="Wed, 5 Oct 2011 02:33:11 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="13120771" author="thetaphi" created="Wed, 5 Oct 2011 10:15:59 +0100"  >&lt;p&gt;New patch that adds a check to setUp() and disables the test method if the current default codec is memory expensive (using assume(), I had to fight against JUnit... krrrrrrrr).&lt;/p&gt;</comment>
                    <comment id="13120939" author="thetaphi" created="Wed, 5 Oct 2011 14:17:03 +0100"  >&lt;p&gt;Committed trunk revision: 1179210&lt;/p&gt;

&lt;p&gt;I will open a new issue for refactoring tests.&lt;/p&gt;</comment>
                    <comment id="13121009" author="mikemccand" created="Wed, 5 Oct 2011 15:32:52 +0100"  >&lt;p&gt;Thanks Uwe!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12525818">LUCENE-3489</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12497769" name="LUCENE-3463.patch" size="10841" author="thetaphi" created="Wed, 5 Oct 2011 10:15:59 +0100" />
                    <attachment id="12497715" name="LUCENE-3463.patch" size="8767" author="thetaphi" created="Tue, 4 Oct 2011 23:03:58 +0100" />
                    <attachment id="12497692" name="LUCENE-3463.patch" size="8846" author="thetaphi" created="Tue, 4 Oct 2011 21:12:04 +0100" />
                    <attachment id="12497687" name="LUCENE-3463.patch" size="8394" author="thetaphi" created="Tue, 4 Oct 2011 20:45:42 +0100" />
                    <attachment id="12497234" name="LUCENE-3463.patch" size="7858" author="thetaphi" created="Fri, 30 Sep 2011 23:37:01 +0100" />
                    <attachment id="12497232" name="LUCENE-3463.patch" size="8019" author="thetaphi" created="Fri, 30 Sep 2011 23:19:31 +0100" />
                    <attachment id="12497225" name="LUCENE-3463.patch" size="7974" author="thetaphi" created="Fri, 30 Sep 2011 22:43:45 +0100" />
                    <attachment id="12497195" name="LUCENE-3463.patch" size="5453" author="mikemccand" created="Fri, 30 Sep 2011 19:24:17 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>8.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 27 Sep 2011 14:37:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3456</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24233</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>