<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:25:52 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3023/LUCENE-3023.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3023] Land DWPT on trunk</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3023</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2956&quot; title=&quot;Support updateDocument() with DWPTs&quot;&gt;&lt;del&gt;LUCENE-2956&lt;/del&gt;&lt;/a&gt; we have resolved the last remaining issue for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2324&quot; title=&quot;Per thread DocumentsWriters that write their own private segments&quot;&gt;&lt;del&gt;LUCENE-2324&lt;/del&gt;&lt;/a&gt; so we can proceed landing the DWPT development on trunk soon. I think one of the bigger issues here is to make sure that all JavaDocs for IW etc. are still correct though. I will start going through that first.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12504046">LUCENE-3023</key>
            <summary>Land DWPT on trunk</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Apr 2011 14:04:09 +0100</created>
                <updated>Fri, 10 May 2013 11:43:30 +0100</updated>
                    <resolved>Mon, 2 May 2011 15:23:03 +0100</resolved>
                            <version>4.0-ALPHA</version>
                <version>CSF branch</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="13019801" author="simonw" created="Thu, 14 Apr 2011 13:18:36 +0100"  >&lt;p&gt;I added a &lt;a href=&quot;https://builds.apache.org/hudson/job/Lucene-Solr-tests-only-realtime_search-branch/&quot; class=&quot;external-link&quot;&gt;jenkins build&lt;/a&gt; that runs every 4 hours to give the RT branch some exercise. I added my email address and buschmi to the recipients if the build fails.... if you wanna be added let me know. &lt;br/&gt;
From now on we should only commit bugfixes, documentation and merges with trunk to this branch. From my point of view there is only one blocker left here (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3028&quot; title=&quot;IW.getReader() returns inconsistent reader on RT Branch&quot;&gt;&lt;del&gt;LUCENE-3028&lt;/del&gt;&lt;/a&gt;) so the remaining work is mainly reviewing the current state and polishing the javadocs. I will go over IW, IR and DW java docs as a start.&lt;/p&gt;</comment>
                    <comment id="13019814" author="mikemccand" created="Thu, 14 Apr 2011 14:01:37 +0100"  >&lt;p&gt;Why not just email dev@ when it fails?  Since it will soon land I think all should feel pain when it fails &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13019852" author="simonw" created="Thu, 14 Apr 2011 15:42:53 +0100"  >&lt;blockquote&gt;&lt;p&gt;Why not just email dev@ when it fails? Since it will soon land I think all should feel pain when it fails &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;true, done!&lt;/p&gt;</comment>
                    <comment id="13020241" author="simonw" created="Fri, 15 Apr 2011 09:55:40 +0100"  >&lt;p&gt;selckin thanks for reporting those failures... I fixed the TestIndexWriterException ones in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3031&quot; title=&quot;setFlushPending fails if we concurrently hit a aborting exception&quot;&gt;&lt;del&gt;LUCENE-3031&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3032&quot; title=&quot;TestIndexWriterException fails with NPE on realtime&quot;&gt;&lt;del&gt;LUCENE-3032&lt;/del&gt;&lt;/a&gt;. The TestOmitTf failure caused by a recently fixed bug on trunk (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3027&quot; title=&quot;TestOmitTf.testMixedMerge random seed failure&quot;&gt;&lt;del&gt;LUCENE-3027&lt;/del&gt;&lt;/a&gt;) which I haven&apos;t merged into RT branch yet. I just did the merge and that fixes that issue too. I will commit the merge in a minute&lt;/p&gt;

&lt;p&gt;The issues you are reporting with addIndexes I can not reproduce though... I will spin off issues for them.&lt;/p&gt;</comment>
                    <comment id="13020263" author="mikemccand" created="Fri, 15 Apr 2011 11:37:47 +0100"  >&lt;p&gt;Attached patch.&lt;/p&gt;

&lt;p&gt;I made a pass through the diffs of RT vs trunk, and made a bunch of small fixes (eg whitespace, typos) but there were places I had real questions so I put // nocommits in...&lt;/p&gt;

&lt;p&gt;Can we rename Healthiness -&amp;gt; DocumentsWriterStallControl (or something like that)?&lt;/p&gt;

&lt;p&gt;I think we lost this infoStream output from trunk?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
        message(&quot;  ramUsed=&quot; + nf.format(startMBUsed) + &quot; MB&quot; +
                &quot; newFlushedSize=&quot; + nf.format(newSegmentSize) + &quot; MB&quot; +
                &quot; (&quot; + nf.format(newSegmentSizeNoStore) + &quot; MB w/o doc stores)&quot; +
                &quot; docs/MB=&quot; + nf.format(numDocs / newSegmentSize) +
                &quot; new/old=&quot; + nf.format(100.0 * newSegmentSizeNoStore / startMBUsed) + &quot;%&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s looking good!&lt;/p&gt;</comment>
                    <comment id="13020359" author="simonw" created="Fri, 15 Apr 2011 18:11:02 +0100"  >&lt;blockquote&gt;&lt;p&gt;Attached patch.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;awesome mike, I think you should commit that patch and we iterate once we are back from vacation?&lt;br/&gt;
The RT hudson build tolerates //nocommit &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we lost this infoStream output from trunk?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;do you recall where it was?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we rename Healthiness -&amp;gt; DocumentsWriterStallControl (or something like that)?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;sure go ahead can you rename the test to testStalled instead of testHealthiness&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s looking good!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we are reasonably close!&lt;/p&gt;</comment>
                    <comment id="13020579" author="selckin" created="Sat, 16 Apr 2011 10:18:21 +0100"  >&lt;p&gt;fyi, since last night&apos;s trunk merge (r1092636) not a single test has failed in my &apos;while true; ant clean test&apos;  (addIndexes &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3033&quot; title=&quot;TestAddIndexes#testAddIndexesWithThreads fails on Realtime&quot;&gt;&lt;del&gt;LUCENE-3033&lt;/del&gt;&lt;/a&gt; has not failed since either)&lt;/p&gt;</comment>
                    <comment id="13021455" author="simonw" created="Tue, 19 Apr 2011 08:52:53 +0100"  >&lt;blockquote&gt;&lt;p&gt;fyi, since last night&apos;s trunk merge (r1092636) not a single test has failed in my &apos;while true; ant clean test&apos; (addIndexes &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3033&quot; title=&quot;TestAddIndexes#testAddIndexesWithThreads fails on Realtime&quot;&gt;&lt;del&gt;LUCENE-3033&lt;/del&gt;&lt;/a&gt; has not failed since either)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;awesome... thanks for reporting back!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Attached patch.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;mike I committed your patch to the branch so we can iterate!&lt;/p&gt;</comment>
                    <comment id="13025185" author="simonw" created="Tue, 26 Apr 2011 12:42:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;mike I committed your patch to the branch so we can iterate!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I just committed some fixes and added javadoc to several classes. We are down to 0 nocommits!! Yay!&lt;/p&gt;</comment>
                    <comment id="13025961" author="rcmuir" created="Wed, 27 Apr 2011 20:18:33 +0100"  >&lt;p&gt;I was helping Simon look at reintegrating this branch (produce a patch for easy review, etc), but I found some problems.&lt;/p&gt;

&lt;p&gt;1. it looks like some commits were marked as merged from trunk, but not actually merged. so if we reintegrate into trunk we will lose some changes.&lt;br/&gt;
2. some files have lost their svn:eol-style, which makes the comparison.... difficult.&lt;/p&gt;

&lt;p&gt;I&apos;m looking at these issues now.&lt;/p&gt;</comment>
                    <comment id="13026040" author="rcmuir" created="Thu, 28 Apr 2011 00:12:53 +0100"  >&lt;p&gt;ok, i think these issues are resolved. I&apos;m attaching the script Mike wrote that I used for checking that we don&apos;t lose any changes (I think its the same script we used for the flex branch).&lt;/p&gt;

&lt;p&gt;the way I did it is to checkout a/ and b/, reintegrate the branch into b/, and run the script to produce a huge patch. if some things look suspicious like they are &quot;lost&quot; changes, then i reverse apply the huge patch to the branch with eclipse and only selectively apply those lost changes and then commit.&lt;/p&gt;</comment>
                    <comment id="13026064" author="rcmuir" created="Thu, 28 Apr 2011 02:44:55 +0100"  >&lt;p&gt;Attached is the DWPT branch in patch format against trunk (for easier reviewing).&lt;/p&gt;</comment>
                    <comment id="13026069" author="rcmuir" created="Thu, 28 Apr 2011 02:58:32 +0100"  >&lt;p&gt;What about TestIndexWriter.testIndexingThenDeleting?&lt;/p&gt;

&lt;p&gt;I noticed in the branch the test method is changed to _testIndexingThenDeleting (disabled).&lt;/p&gt;

&lt;p&gt;However, if i re-enable it (rename it back) it never seems to finish...&lt;/p&gt;</comment>
                    <comment id="13026144" author="simonw" created="Thu, 28 Apr 2011 07:23:46 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I noticed in the branch the test method is changed to _testIndexingThenDeleting (disabled).&lt;/p&gt;

&lt;p&gt;However, if i re-enable it (rename it back) it never seems to finish...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just reenabled, fixed and committed that testcase on branch.&lt;/p&gt;</comment>
                    <comment id="13026145" author="simonw" created="Thu, 28 Apr 2011 07:27:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;Attached is the DWPT branch in patch format against trunk (for easier reviewing).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Awesome, Thanks Robert!!!&lt;/p&gt;</comment>
                    <comment id="13026200" author="simonw" created="Thu, 28 Apr 2011 09:26:13 +0100"  >&lt;p&gt;I went through IW and IWC jdocs to bring them uptodate. here is a patch against the branch... Review from a native speaker would be very much welcome &lt;/p&gt;</comment>
                    <comment id="13026223" author="simonw" created="Thu, 28 Apr 2011 10:26:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;Can we rename Healthiness -&amp;gt; DocumentsWriterStallControl (or something like that)?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I added a TODO for this - lets do that on trunk&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we lost this infoStream output from trunk?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;just committed a fix for this to reenable it on branch.. kind of tricky since we now flush concurrently NumberFormat must be accessed single threaded. So I added it to DWPT#flush()&lt;/p&gt;</comment>
                    <comment id="13026229" author="simonw" created="Thu, 28 Apr 2011 10:38:45 +0100"  >&lt;p&gt;FYI - I committed the javadoc changes to branch after mikes +1 on IRC. I also marked IWC#setIndexerThreadPool as expert API&lt;/p&gt;</comment>
                    <comment id="13026260" author="rcmuir" created="Thu, 28 Apr 2011 12:19:45 +0100"  >&lt;p&gt;attached (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3023&quot; title=&quot;Land DWPT on trunk&quot;&gt;&lt;del&gt;LUCENE-3023&lt;/del&gt;&lt;/a&gt;_svndiff.patch) is just the output from &apos;svn diff&apos; after merging, for reviewing property changes and similar police work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13026274" author="simonw" created="Thu, 28 Apr 2011 13:19:20 +0100"  >&lt;p&gt;here is my first review round. I manually ported some missed merges from trunk and fixed some really minor things.&lt;/p&gt;

&lt;p&gt;I will commit shortly to branch if nobody objects&lt;/p&gt;</comment>
                    <comment id="13026295" author="simonw" created="Thu, 28 Apr 2011 13:57:36 +0100"  >&lt;blockquote&gt;&lt;p&gt;I will commit shortly to branch if nobody objects&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;committed... robert is running a new reintegration round now&lt;/p&gt;</comment>
                    <comment id="13026386" author="rcmuir" created="Thu, 28 Apr 2011 18:34:58 +0100"  >&lt;p&gt;I resynced up to r1097442 and here are the latest patches (the full patch and the svn diff)&lt;/p&gt;</comment>
                    <comment id="13026393" author="mikemccand" created="Thu, 28 Apr 2011 19:05:14 +0100"  >&lt;p&gt;Modified the Python script a bit to do a recursive diff b/w two dirs to make an applyable patch &amp;#8211; added a usage, and a -skipWhitespace option.&lt;/p&gt;

&lt;p&gt;I put it under a new &apos;dev-tools/scripts&apos; dir...&lt;/p&gt;</comment>
                    <comment id="13026894" author="simonw" created="Fri, 29 Apr 2011 08:33:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;I put it under a new &apos;dev-tools/scripts&apos; dir...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;br/&gt;
mike can you add a little doc string to the script explaining what it does and how to use it? I think we should also have a wiki page that explains how to reintegrate a branch just like we have one for merging changes into a branch.&lt;/p&gt;</comment>
                    <comment id="13026915" author="simonw" created="Fri, 29 Apr 2011 10:21:27 +0100"  >&lt;p&gt;here is my first cut at CHANGES.TXT for landing on trunk. Review would be much appreciated.&lt;/p&gt;</comment>
                    <comment id="13026920" author="mikemccand" created="Fri, 29 Apr 2011 10:38:55 +0100"  >&lt;p&gt;Iteration on diffSources.py &amp;#8211; adds usage line, copyright header.  I think it&apos;s ready to be committed!&lt;/p&gt;</comment>
                    <comment id="13026924" author="mikemccand" created="Fri, 29 Apr 2011 10:56:00 +0100"  >&lt;p&gt;Small edits to Simon&apos;s CHANGES entry.&lt;/p&gt;</comment>
                    <comment id="13026932" author="simonw" created="Fri, 29 Apr 2011 11:21:35 +0100"  >&lt;p&gt;I committed the CHANGES.TXT patch to branch. I think we should freeze the branch now so robert can create a last final patch. We should let that patch linger around for a while, yet I plan to commit this to trunk on monday. Good work everybody! &lt;/p&gt;</comment>
                    <comment id="13026967" author="thetaphi" created="Fri, 29 Apr 2011 14:17:11 +0100"  >&lt;p&gt;I merged the freezed branch again.&lt;/p&gt;

&lt;p&gt;Attached is a first patch for reviewing code changes (not SVN diff), created by the following command between 2 fresh checkouts, one of them &quot;svn merge --reintegrate&quot;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff -urNb --strip-trailing-cr trunk-lusolr1 trunk-lusolr2 | filterdiff -x &quot;*.svn*&quot; --strip 1 --clean &amp;gt; LUCENE-3023.patch
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This patch is not intended to be applied, its more to verify the changes (therefore all whitespace changes created by merging were excluded). &lt;/p&gt;</comment>
                    <comment id="13026982" author="thetaphi" created="Fri, 29 Apr 2011 15:15:34 +0100"  >&lt;p&gt;Here is the final SVN diff. To work around some itches with SVN, the following was done:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reverted everything outside lucene sub folder&lt;/li&gt;
	&lt;li&gt;used the previously created manual diff to get a list of all changed files (using patchutils command lsdiff)&lt;/li&gt;
	&lt;li&gt;used &quot;svn -q status | sed &apos;s/^........//&apos; &amp;gt; ../svn-files.txt&quot; to get all files affected after merge&lt;/li&gt;
	&lt;li&gt;intersect both files (lsdiff and svn status one) to find all files that are in reality unchanged, but still affected by SVN (these are all files that were added after branching - this is a known limitation of SVN. Files added after branching are &quot;replaced&quot; by merge reintegrate, loosing all history). Store those files in unchanged.txt&lt;/li&gt;
	&lt;li&gt;use the intersected filelist and revert everything: cat ../unchanged.txt | xargs svn revert&lt;/li&gt;
	&lt;li&gt;finally do a record-only merge again to fix mergeprops reverted by the previous revert&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My checkout is now ready to commit.&lt;/p&gt;

&lt;p&gt;If we have some minor problems with the patch, please wait with fixing after commit. If there are serious problems, we can fix them in realtime branch and merge manuall (I can do that later).&lt;/p&gt;</comment>
                    <comment id="13026989" author="thetaphi" created="Fri, 29 Apr 2011 15:31:36 +0100"  >&lt;p&gt;Here finally all whitespace changes in one patch. They will be committed, but are not included in the main patch.&lt;/p&gt;</comment>
                    <comment id="13027058" author="michaelbusch" created="Fri, 29 Apr 2011 17:14:25 +0100"  >&lt;p&gt;Just wanted to say: you guys totally rock! Great teamwork here with all the work involved of getting the branch merged back. I&apos;m sorry I couldn&apos;t help much in the last few weeks.&lt;/p&gt;</comment>
                    <comment id="13027135" author="yseeley@gmail.com" created="Fri, 29 Apr 2011 19:49:20 +0100"  >&lt;p&gt;This looks awesome guys!&lt;/p&gt;

&lt;p&gt;I&apos;ve started some ad-hoc testing via Solr.&lt;br/&gt;
A single threaded CSV upload (bulk indexing... no real-time reopens)&lt;br/&gt;
looks pretty much the same, and doing 2 CSV uploads at once was&lt;br/&gt;
36% faster (a bit apples-to-oranges since the number of resulting&lt;br/&gt;
segments was also higher... but even still, looks like a good improvement!)&lt;/p&gt;</comment>
                    <comment id="13027207" author="mikemccand" created="Fri, 29 Apr 2011 22:55:40 +0100"  >&lt;p&gt;+1 to commit!  Great work everyone &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13027354" author="simonw" created="Sat, 30 Apr 2011 18:57:51 +0100"  >&lt;p&gt;+1 to commit... I reviewed one more time - looks good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13027385" author="yseeley@gmail.com" created="Sat, 30 Apr 2011 22:52:28 +0100"  >&lt;p&gt;+1! (after a not-so-thorough review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13027428" author="michaelbusch" created="Sun, 1 May 2011 06:28:24 +0100"  >&lt;p&gt;Just a few minor comments, otherwise +1 to commit! (I&apos;m super excited this is finally happening after the branch was created a year ago or so!)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In DocumentsWriterPerThreadPool:&lt;br/&gt;
remove: 
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; void clearThreadBindings(ThreadState perThread);
&lt;/span&gt;+
+  &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; void clearAllThreadBindings();
&lt;/span&gt;+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In ThreadAffinityDocumentsWriterThreadPool#getAndLock() we had talked about switching from a per-threadstate queue (safeway model) to a single queue (whole foods). I&apos;m wondering if we should do that before we commit or change that later as a separate patch?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;remove some commented out code in TestFlushByRamOrCountsPolicy#testHealthyness&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="13027439" author="simonw" created="Sun, 1 May 2011 09:21:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;In ThreadAffinityDocumentsWriterThreadPool#getAndLock() we had talked about switching from a per-threadstate queue (safeway model) to a single queue (whole foods). I&apos;m wondering if we should do that before we commit or change that later as a separate patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will create a new issue for this I don&apos;t think this should block the commit merge!&lt;/p&gt;

&lt;p&gt;all other minor stuff can be done after committing. I will take care of these issues.&lt;/p&gt;</comment>
                    <comment id="13027447" author="thetaphi" created="Sun, 1 May 2011 11:08:42 +0100"  >&lt;p&gt;Thanks Simon!&lt;/p&gt;

&lt;p&gt;As noted before, this is minor and should be done after the merge was committed, else it would produce lot of useless work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I will commit this tomorrow morning MEST.&lt;/p&gt;

&lt;p&gt;After committing, I will move the branch as a new SVN tag (realtime_DWPT_latest or like that) and if somebody wants to start again with more realtime work, we should branch again (according to the SVN book: a reintegrated branch cannot be used for development anymore and should be removed).&lt;/p&gt;</comment>
                    <comment id="13027504" author="thetaphi" created="Sun, 1 May 2011 23:41:29 +0100"  >&lt;p&gt;Committed merged branch to trunk revision: 1098427&lt;br/&gt;
Moved branch away as tag in revision: 1098428&lt;/p&gt;</comment>
                    <comment id="13027583" author="simonw" created="Mon, 2 May 2011 09:20:52 +0100"  >&lt;blockquote&gt;&lt;p&gt;In ThreadAffinityDocumentsWriterThreadPool#getAndLock() we had talked about switching from a per-threadstate queue (safeway model) to a single queue (whole foods). I&apos;m wondering if we should do that before we commit or change that later as a separate patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3060&quot; title=&quot;Revise ThreadAffinityDocumentsWriterThreadPool queue handling&quot;&gt;LUCENE-3060&lt;/a&gt; for this. @buschmi maybe you can add some more info to that issue if you recall the discussion?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Committed merged branch to trunk revision: 1098427&lt;br/&gt;
Moved branch away as tag in revision: 1098428&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;AWESOME! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13027587" author="thetaphi" created="Mon, 2 May 2011 09:37:35 +0100"  >&lt;p&gt;The first full Jenkins Build also succeeded. When reviewing the first Clover Build report, I noticed 2 new final classes, that have no code coverage at all (see &lt;a href=&quot;https://builds.apache.org/hudson/job/Lucene-trunk/1549/clover-report/org/apache/lucene/index/pkg-summary.html&quot; class=&quot;external-link&quot;&gt;https://builds.apache.org/hudson/job/Lucene-trunk/1549/clover-report/org/apache/lucene/index/pkg-summary.html&lt;/a&gt;):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DocFieldConsumers&lt;/li&gt;
	&lt;li&gt;DocFieldConsumersPerField&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I am not sure if those are old relicts (dead code) or newly added ones, but not yet used.&lt;/p&gt;</comment>
                    <comment id="13027665" author="thetaphi" created="Mon, 2 May 2011 15:19:16 +0100"  >&lt;p&gt;I reopen this one, as the merge added a reincarnation of quicksort in DocFieldProcessor (which was previously removed in the corresponding *PerThread class, but lost during the merge).&lt;/p&gt;

&lt;p&gt;I will fix soon.&lt;/p&gt;</comment>
                    <comment id="13027667" author="thetaphi" created="Mon, 2 May 2011 15:19:48 +0100"  >&lt;p&gt;Here the patch. Will commit soon.&lt;/p&gt;</comment>
                    <comment id="13027668" author="thetaphi" created="Mon, 2 May 2011 15:23:03 +0100"  >&lt;p&gt;Removed quicksort in revision 1098592&lt;/p&gt;</comment>
                    <comment id="13028327" author="mikemccand" created="Tue, 3 May 2011 18:24:29 +0100"  >&lt;p&gt;This cutover to concurrent flushing (DWPT) produces astounding&lt;br/&gt;
increases in indexing throughput:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://people.apache.org/~mikemccand/lucenebench/indexing.html&quot; class=&quot;external-link&quot;&gt;http://people.apache.org/~mikemccand/lucenebench/indexing.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;186 GB plain text per hour (from 101 GB/hour the day before)!!!&lt;/p&gt;

&lt;p&gt;It&apos;s not every day you see an 84% jump in indexing throughput!  Wow.&lt;/p&gt;

&lt;p&gt;This is on a machine that has substantial CPU+IO concurrency, ie, it&lt;br/&gt;
was bottlenecked by our non-concurrent flush.&lt;/p&gt;

&lt;p&gt;Also, I can now tune up the IW settings I use in those nightly&lt;br/&gt;
benchmarks; it&apos;s now 6 threads and &quot;only&quot; 512 MB RAM buffer.  I&apos;ll&lt;br/&gt;
wait a few days and then do that.&lt;/p&gt;

&lt;p&gt;Looks like a few queries got a bit slower... I suspect this is because&lt;br/&gt;
the index segment count has changed.  Before concurrent flushing it&lt;br/&gt;
was this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;36(4.0):C4977400 _69(4.0):C4977400 _9c(4.0):C4977400 _cf(4.0):C4977400 _fi(4.0):C4977400 _fq(4.0):C497740 _g1(4.0):C497740 _gc(4.0):C497740 _gn(4.0):C497740 _gy(4.0):C497740 _gx(4.0):C49774 _gz(4.0):C49774 _h0(4.0):C49774 _h1(4.0):C49774 _h2(4.0):C49774 _h3(4.0):C468
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After concurrent flushing:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;_3d(4.0):C4977400 _6h(4.0):C4977400 _9j(4.0):C4977400 _cn(4.0):C4977400 _fq(4.0):C4977400 _fu(4.0):C497740 _g6(4.0):C497740 _gh(4.0):C497740 _gs(4.0):C497740 _h2(4.0):C497740 _gy(4.0):C49774 _gz(4.0):C49774 _h0(4.0):C49774 _h5(4.0):C4105 _1(4.0):C2627 _h4(4.0):C16331 _h3(4.0):C28728 _h1(4.0):C48225
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we have 2 extra segments... it&apos;s interesting how this affects some&lt;br/&gt;
queries but not others.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                                <inwardlinks description="is blocked by">
                            <issuelink>
            <issuekey id="12504343">LUCENE-3031</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12504345">LUCENE-3032</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12504352">LUCENE-3033</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12504523">LUCENE-3035</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12505213">LUCENE-3046</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12477587" name="diffMccand.py" size="828" author="rcmuir" created="Thu, 28 Apr 2011 00:12:53 +0100" />
                    <attachment id="12477741" name="diffSources.patch" size="2728" author="mikemccand" created="Fri, 29 Apr 2011 10:38:55 +0100" />
                    <attachment id="12477676" name="diffSources.patch" size="1602" author="mikemccand" created="Thu, 28 Apr 2011 19:05:14 +0100" />
                    <attachment id="12477743" name="LUCENE-3023_CHANGES.patch" size="4499" author="mikemccand" created="Fri, 29 Apr 2011 10:55:59 +0100" />
                    <attachment id="12477739" name="LUCENE-3023_CHANGES.patch" size="4333" author="simonw" created="Fri, 29 Apr 2011 10:21:27 +0100" />
                    <attachment id="12477628" name="LUCENE-3023_iw_iwc_jdoc.patch" size="8956" author="simonw" created="Thu, 28 Apr 2011 09:26:13 +0100" />
                    <attachment id="12477753" name="LUCENE-3023.patch" size="376402" author="thetaphi" created="Fri, 29 Apr 2011 14:17:10 +0100" />
                    <attachment id="12477672" name="LUCENE-3023.patch" size="543054" author="rcmuir" created="Thu, 28 Apr 2011 18:34:58 +0100" />
                    <attachment id="12477597" name="LUCENE-3023.patch" size="545014" author="rcmuir" created="Thu, 28 Apr 2011 02:44:55 +0100" />
                    <attachment id="12476445" name="LUCENE-3023.patch" size="45848" author="mikemccand" created="Fri, 15 Apr 2011 11:37:47 +0100" />
                    <attachment id="12477956" name="LUCENE-3023-quicksort-reincarnation.patch" size="3115" author="thetaphi" created="Mon, 2 May 2011 15:19:48 +0100" />
                    <attachment id="12477649" name="LUCENE-3023_simonw_review.patch" size="20402" author="simonw" created="Thu, 28 Apr 2011 13:19:19 +0100" />
                    <attachment id="12477673" name="LUCENE-3023_svndiff.patch" size="401037" author="rcmuir" created="Thu, 28 Apr 2011 18:34:58 +0100" />
                    <attachment id="12477647" name="LUCENE-3023_svndiff.patch" size="407964" author="rcmuir" created="Thu, 28 Apr 2011 12:19:45 +0100" />
                    <attachment id="12477755" name="LUCENE-3023-svn-diff.patch" size="359091" author="thetaphi" created="Fri, 29 Apr 2011 15:15:34 +0100" />
                    <attachment id="12477763" name="LUCENE-3023-ws-changes.patch" size="54166" author="thetaphi" created="Fri, 29 Apr 2011 15:31:36 +0100" />
                    <attachment id="12476428" name="realtime-TestAddIndexes-3.txt" size="47001" author="selckin" created="Fri, 15 Apr 2011 08:46:41 +0100" />
                    <attachment id="12476429" name="realtime-TestAddIndexes-5.txt" size="47955" author="selckin" created="Fri, 15 Apr 2011 08:46:59 +0100" />
                    <attachment id="12476430" name="realtime-TestIndexWriterExceptions-assert-6.txt" size="48363" author="selckin" created="Fri, 15 Apr 2011 08:47:07 +0100" />
                    <attachment id="12476433" name="realtime-TestIndexWriterExceptions-npe-1.txt" size="47519" author="selckin" created="Fri, 15 Apr 2011 08:47:37 +0100" />
                    <attachment id="12476431" name="realtime-TestIndexWriterExceptions-npe-2.txt" size="47944" author="selckin" created="Fri, 15 Apr 2011 08:47:15 +0100" />
                    <attachment id="12476432" name="realtime-TestIndexWriterExceptions-npe-4.txt" size="47958" author="selckin" created="Fri, 15 Apr 2011 08:47:25 +0100" />
                    <attachment id="12476427" name="realtime-TestOmitTf-corrupt-0.txt" size="54371" author="selckin" created="Fri, 15 Apr 2011 08:46:28 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>23.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 14 Apr 2011 13:01:37 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10875</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24669</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>