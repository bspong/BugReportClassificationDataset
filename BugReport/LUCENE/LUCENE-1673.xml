<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:06:18 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1673/LUCENE-1673.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1673] Move TrieRange to core</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1673</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;TrieRange was iterated many times and seems stable now (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1470&quot; title=&quot;Add TrieRangeFilter to contrib&quot;&gt;&lt;del&gt;LUCENE-1470&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1582&quot; title=&quot;Make TrieRange completely independent from Document/Field with TokenStream of prefix encoded values&quot;&gt;&lt;del&gt;LUCENE-1582&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1602&quot; title=&quot;Rewrite TrieRange to use MultiTermQuery&quot;&gt;&lt;del&gt;LUCENE-1602&lt;/del&gt;&lt;/a&gt;). There is lots of user interest, Solr added it to its default FieldTypes (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-940&quot; title=&quot;TrieRange support&quot;&gt;&lt;del&gt;SOLR-940&lt;/del&gt;&lt;/a&gt;) and if possible I want to move it to core before release of 2.9.&lt;br/&gt;
Before this can be done, there are some things to think about:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;There are now classes called LongTrieRangeQuery, IntTrieRangeQuery, how should they be called in core? I would suggest to leave it as it is. On the other hand, if this keeps our only numeric query implementation, we could call it LongRangeQuery, IntRangeQuery or NumericRangeQuery (see below, here are problems). Same for the TokenStreams and Filters.&lt;/li&gt;
	&lt;li&gt;Maybe the pairs of classes for indexing and searching should be moved into one class: NumericTokenStream, NumericRangeQuery, NumericRangeFilter. The problem here: ctors must be able to pass int, long, double, float as range parameters. For the end user, mixing these 4 types in one class is hard to handle. If somebody forgets to add a L to a long, it suddenly instantiates a int version of range query, hitting no results and so on. Same with other types. Maybe accept java.lang.Number as parameter (because nullable for half-open bounds) and one enum for the type.&lt;/li&gt;
	&lt;li&gt;TrieUtils move into o.a.l.util? or document or?&lt;/li&gt;
	&lt;li&gt;Move TokenStreams into o.a.l.analysis, ShiftAttribute into o.a.l.analysis.tokenattributes? Somewhere else?&lt;/li&gt;
	&lt;li&gt;If we rename the classes, should Solr stay with Trie (because there are different impls)?&lt;/li&gt;
	&lt;li&gt;Maybe add a subclass of AbstractField, that automatically creates these TokenStreams and omits norms/tf per default for easier addition to Document instances?&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
            <key id="12426825">LUCENE-1673</key>
            <summary>Move TrieRange to core</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Jun 2009 15:32:41 +0100</created>
                <updated>Fri, 19 Jun 2009 14:34:00 +0100</updated>
                    <resolved>Fri, 19 Jun 2009 13:17:38 +0100</resolved>
                            <version>2.9</version>
                                <fixVersion>2.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>1</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12715144" author="earwin" created="Mon, 1 Jun 2009 17:30:35 +0100"  >&lt;p&gt;Sudden thought. Leave it in contribs, you won&apos;t be bound by any other back-compat policies besides common sense. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12715219" author="paul.elschot@xs4all.nl" created="Mon, 1 Jun 2009 20:38:46 +0100"  >&lt;p&gt;From a bit of a distance:&lt;/p&gt;

&lt;p&gt;You could consider putting everything in o.a.l.trie .&lt;/p&gt;

&lt;p&gt;I&apos;d prefer to have explicit class names containing Long, Int etc, and also containing Trie.&lt;/p&gt;

&lt;p&gt;I don&apos;t know the details of the tokenizing, but AbstractTrieField sounds just right.&lt;/p&gt;
</comment>
                    <comment id="12715512" author="mikemccand" created="Tue, 2 Jun 2009 13:59:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;I want to move it to core before release of 2.9&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are now classes called LongTrieRangeQuery, IntTrieRangeQuery, how should they be called in core?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I prefer to not use &quot;trie&quot; in the names (package and classes)... that&lt;br/&gt;
term very much describes what&apos;s under-the-hood in these classes (how&lt;br/&gt;
they are implemented), whereas I think &lt;span class=&quot;error&quot;&gt;&amp;#91;generally&amp;#93;&lt;/span&gt; names should&lt;br/&gt;
describe how the class is intended to be used.  So I prefer&lt;br/&gt;
&quot;Long&lt;span class=&quot;error&quot;&gt;&amp;#91;Numeric&amp;#93;&lt;/span&gt;RangeQuery&quot; over &quot;LongTrieRangeQuery&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;d also like to rename RangeQuery to something else, with this&lt;br/&gt;
change.  EG TermRangeQuery... to emphasize that you use it for&lt;br/&gt;
non-numbers.  The javadocs of TermRangeQuery should point to&lt;br/&gt;
Int/LongRangeQuery as strongly preferred for numeric ranges.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe the pairs of classes for indexing and searching should be moved into one class&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think separate classes for int, long, float, double is better.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;TrieUtils move into o.a.l.util? or document or?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe document?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Move TokenStreams into o.a.l.analysis, ShiftAttribute into o.a.l.analysis.tokenattributes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds good?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we rename the classes, should Solr stay with Trie (because there are different impls)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, Solr should decide &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But: why are there different impls for Solr?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe add a subclass of AbstractField, that automatically creates these TokenStreams and omits norms/tf per default for easier addition to Document instances?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;For a numeric field where one will sort or do range filtering, Trie*&lt;br/&gt;
ought to be the default.  But, unfortunately, the steps needed to make&lt;br/&gt;
use of Trie* are numerous:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Add your field to your doc with the LongTrieTokenStream&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;When you want to sort, pass the TrieUtils.FIELD_CACHE_LONG_PARSER&lt;br/&gt;
    to your SortField&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;When you want to filter by range, instantiate&lt;br/&gt;
    LongTrieRangeFilter.  You&apos;ll have to subclass QueryParser to do&lt;br/&gt;
    this for the right fields.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;When you want to display values, you must also pass the trie parser&lt;br/&gt;
     when populating the FieldCache&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ideally, one would simply use, say, LongNumericField (subclass of&lt;br/&gt;
AbstractField) at indexing time, Lucene would &quot;remember&quot; this&lt;br/&gt;
in the index (this is obviously missing today), and then when you&lt;br/&gt;
sort, retrieve value, and create queries from QueryParser, all these&lt;br/&gt;
places would &quot;know&quot; that this is a trie field and simply do the right&lt;br/&gt;
thing, by default.&lt;/p&gt;

&lt;p&gt;(Aside: I just noticed the code fragment in the javadocs for&lt;br/&gt;
LongTrieTokenStream won&apos;t compile, because the setValue method is not&lt;br/&gt;
available for TokenStream; the stream should be defined as&lt;br/&gt;
LongTrieTokenStream, I think?; same with IntTrieTokenStream)&lt;/p&gt;</comment>
                    <comment id="12715529" author="thetaphi" created="Tue, 2 Jun 2009 14:39:27 +0100"  >&lt;blockquote&gt;
&lt;p&gt;(Aside: I just noticed the code fragment in the javadocs for&lt;br/&gt;
LongTrieTokenStream won&apos;t compile, because the setValue method is not&lt;br/&gt;
available for TokenStream; the stream should be defined as&lt;br/&gt;
LongTrieTokenStream, I think?; same with IntTrieTokenStream)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I fixed this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks!&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;If we rename the classes, should Solr stay with Trie (because there are different impls)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, Solr should decide &lt;/p&gt;

&lt;p&gt;But: why are there different impls for Solr?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I only added this here, to know, that Solr already started to implement this. In Solr there are three different impls:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Trie (of course)&lt;/li&gt;
	&lt;li&gt;Text-only numbers (do not work with range queries, but can be used for sorting etc.)&lt;/li&gt;
	&lt;li&gt;A binary encoding (also used by LocalLucene at the moment), that is sortable. This can be used for RangeQueries, but sorting is slow (because they have no parser, and at the time it was implemented, SortField had no parser support)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The problem, because of backwards compatibility they need to be preserved (possibility to read old indexes).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think separate classes for int, long, float, double is better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Two more... The problem, all these classes have exact the same impl internally and this is code duplication and hard to maintain. Maybe we use a static factory instead of same Ctor. By this the name is different, but it just creates the correct instance of always the same class: NumericRangeQuery.newFloatRange(Float a, Float b, precisionStep) and so on. Same for the TokenStreams (and the Field?)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Ideally, one would simply use, say, LongNumericField (subclass of&lt;br/&gt;
AbstractField) at indexing time, Lucene would &quot;remember&quot; this&lt;br/&gt;
in the index (this is obviously missing today), and then when you&lt;br/&gt;
sort, retrieve value, and create queries from QueryParser, all these&lt;br/&gt;
places would &quot;know&quot; that this is a trie field and simply do the right&lt;br/&gt;
thing, by default.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For that we need the type information in the index and for that the new Field/Document classes. Hopefully Michael will get this working soonly.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;When you want to sort, pass the TrieUtils.FIELD_CACHE_LONG_PARSER&lt;br/&gt;
to your SortField &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or add new SortField types.&lt;/p&gt;

&lt;p&gt;The problem with all this: For old indexes, we need some backwards compatibility. Ideally we would just create numeric fields in the new way and reuse e.g. SortField.INT for this. But this cannot be done. Or even, replace the FieldCache parsers by the trie ones. But this cannot be done at the moment.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;d also like to rename RangeQuery to something else, with this&lt;br/&gt;
change. EG TermRangeQuery... to emphasize that you use it for&lt;br/&gt;
non-numbers. The javadocs of TermRangeQuery should point to&lt;br/&gt;
Int/LongRangeQuery as strongly preferred for numeric ranges.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Cool. For the others, too (FieldCacheRangeQuery).&lt;/p&gt;

&lt;p&gt;There is a lot more to decide, I will keep this issue open a little bit before starting to work to collect ideas!&lt;/p&gt;</comment>
                    <comment id="12717754" author="mikemccand" created="Tue, 9 Jun 2009 18:14:10 +0100"  >&lt;blockquote&gt;
&lt;p&gt;In Solr there are three different impls:&lt;/p&gt;

&lt;p&gt;Trie (of course)&lt;br/&gt;
Text-only numbers (do not work with range queries, but can be used for sorting etc.)&lt;br/&gt;
A binary encoding (also used by LocalLucene at the moment), that is sortable. This can be used for RangeQueries, but sorting is slow (because they have no parser, and at the time it was implemented, SortField had no parser support)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahh OK, this is just Solr&apos;s pre-existing numeric field support.  (I&lt;br/&gt;
had thought you meant Solr had a different impl for Trie).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The problem, because of backwards compatibility they need to be preserved (possibility to read old indexes).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is indeed quite a challenge.  Actually is there anything in Trie&lt;br/&gt;
that encodes which version of the format is indexed in a given&lt;br/&gt;
segment?  (So that if we do every change the indexed format, we can&lt;br/&gt;
bump a version somewhere to keep back compat).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe we use a static factory instead of same Ctor. By this the name is different, but it just creates the correct instance of always the same class: NumericRangeQuery.newFloatRange(Float a, Float b, precisionStep) and so on. Same for the TokenStreams (and the Field?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds like a good approach?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;gt; When you want to sort, pass the TrieUtils.FIELD_CACHE_LONG_PARSER&lt;br/&gt;
&amp;gt; to your SortField&lt;/p&gt;

&lt;p&gt;Or add new SortField types.&lt;/p&gt;

&lt;p&gt;The problem with all this: For old indexes, we need some backwards compatibility. Ideally we would just create numeric fields in the new way and reuse e.g. SortField.INT for this. But this cannot be done. Or even, replace the FieldCache parsers by the trie ones. But this cannot be done at the moment.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wonder if we could handle this by adding a setting in FieldInfo?&lt;br/&gt;
Ie, to record that &quot;this numeric field was indexed as a trie&quot;.  Then,&lt;br/&gt;
when we need to get the parser for SortField.INT, we&apos;d check the&lt;br/&gt;
FieldInfo to see which parser to use.  This could also handle&lt;br/&gt;
back-compat, ie if we change the trie format being written we&apos;d change&lt;br/&gt;
the setting and segment merging would gradually uprade previously&lt;br/&gt;
indexed fields.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;gt; I&apos;d also like to rename RangeQuery to something else, with this&lt;br/&gt;
&amp;gt; change. EG TermRangeQuery... to emphasize that you use it for&lt;br/&gt;
&amp;gt; non-numbers. The javadocs of TermRangeQuery should point to&lt;br/&gt;
&amp;gt; Int/LongRangeQuery as strongly preferred for numeric ranges.&lt;/p&gt;

&lt;p&gt;Cool. For the others, too (FieldCacheRangeQuery).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;</comment>
                    <comment id="12718209" author="mikemccand" created="Wed, 10 Jun 2009 22:40:12 +0100"  >&lt;blockquote&gt;&lt;p&gt;NumericRangeQuery.newFloatRange(Float a, Float b, precisionStep) and so on.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could we also do this for a &quot;term range&quot;?  Then, we could have a single RangeQuery that rewrites to the right impl based on what kind of range you are doing?&lt;/p&gt;

&lt;p&gt;(And in fact it could fold in FieldCacheRangeFilter too).&lt;/p&gt;</comment>
                    <comment id="12719242" author="thetaphi" created="Sun, 14 Jun 2009 11:22:27 +0100"  >&lt;p&gt;I am currently preparing a first patch for NumericRangeQuery-to-core.&lt;/p&gt;

&lt;p&gt;The class NumericUtils (former TrieUtils) should be in o.a.l.util or o.a.l.document? At the moment, the public part of this class is only interesting to retrieve Parsers or SortField instances. But the latter can be refactored, to SortField.TRIE_XXX (not good name, as TRIE no longer used) and the parser instances can be added to FieldCache.&lt;/p&gt;

&lt;p&gt;For indexing or querying it is not required for end users, one can use NumericTokenStream and NumericRangeQuery for all his needs.&lt;/p&gt;

&lt;p&gt;So NumberUtils is more internal than before.&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                    <comment id="12719246" author="thetaphi" created="Sun, 14 Jun 2009 11:42:01 +0100"  >&lt;p&gt;Here my own thoughts:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But the latter can be refactored, to SortField.TRIE_XXX (not good name, as TRIE no longer used) and the parser instances can be added to FieldCache.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From the API of FieldCache and sorting, in my opinion, it was always not a good idea, to link the encoding in index, to the impl everywhere.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;deprecate SortField.INT and use SortField.PLAIN_TEXT_INT instead and so on&lt;/li&gt;
	&lt;li&gt;use SortField.PREFIX_ENCODED_INT for the trie ones (better name, this is the internal encoding name from TrieUtils)&lt;/li&gt;
	&lt;li&gt;the default parsers (private) in FieldCache renaming to also PlainText* (but accessible)&lt;/li&gt;
	&lt;li&gt;add TrieUtils.XxxParser to FieldCache (but accessible)&lt;/li&gt;
	&lt;li&gt;re-use INT  (and so on) in Sort and cache code, where the data type is meant (we already have this in lots of code around), but where the encoding is meant use PLAIN_TEXT_* vs. PREFIX_ENCODED_*.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I know these are hard changes, but we had a lot of productivity in the past here (thanks Shai, Jason, Michael), so there are a lot of new APIs that are very much decoupled from the underlying encoding. This would again rename a lot of internal parts. But because of deprecation, this could be done in-line with Shai&apos;s and Michael&apos;s and Jason&apos;s changes here.&lt;/p&gt;

&lt;p&gt;(sorry for lots of edits in the mailing list, this is much productive thoughts)&lt;/p&gt;</comment>
                    <comment id="12719266" author="yseeley@gmail.com" created="Sun, 14 Jun 2009 15:02:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;use SortField.PREFIX_ENCODED_INT for the trie ones&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This needlessly couples the Trie stuff strongly to the SortField stuff.  Something along the lines of the current TrieUtils.getIntSortField(fname, reverse) seems preferable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;add TrieUtils.XxxParser to FieldCache (but accessible)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The Trie parsers belong in the Trie class.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;re-use INT (and so on) in Sort and cache code, where the data type is meant (we already have this in lots of code around), but where the encoding is meant use PLAIN_TEXT_* vs. PREFIX_ENCODED_*.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn&apos;t understand that sentence.&lt;/p&gt;

&lt;p&gt;As far as what package it makes sense to go in... what about an analysis.numeric package?&lt;/p&gt;

&lt;p&gt;As a general comment, moving TrieRange to core should be moving it to the core and perhaps renaming the classes if we can think of a better name.  Some of the other stuff belongs in a different issue.&lt;/p&gt;</comment>
                    <comment id="12719270" author="thetaphi" created="Sun, 14 Jun 2009 15:17:51 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;use SortField.PREFIX_ENCODED_INT for the trie ones&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This needlessly couples the Trie stuff strongly to the SortField stuff. Something along the lines of the current TrieUtils.getIntSortField(fname, reverse) seems preferable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;add TrieUtils.XxxParser to FieldCache (but accessible)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The Trie parsers belong in the Trie class.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;re-use INT (and so on) in Sort and cache code, where the data type is meant (we already have this in lots of code around), but where the encoding is meant use PLAIN_TEXT_* vs. PREFIX_ENCODED_*.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn&apos;t understand that sentence.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But on the other hand SortField.INT is also strongly linked to the plain text encoding of these tokens. My proposal was to unlink the index encoding of numeric data types from the sorting/field cache code and its constants. So it should not make a difference if you encoded the long using Integer.toString() or TrieUtils, in both cases, sorting code is identical, only the parser is different.&lt;/p&gt;

&lt;p&gt;Because of this, if we stay with SortField.INT and so on, I would tend to make the according Parser/FieldCache a required arg of SortField, defaulting to the current parsers for the deprecated backwards-compatibility.&lt;/p&gt;

&lt;p&gt;So one using new code must always specify the parser when using SortField.INT (SortField.AUTO is already deprectaed so no problem). The same with FieldCache: always specify the parser when getting an instance. For that the current default parsers should be made public accessible.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As far as what package it makes sense to go in... what about an analysis.numeric package&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;TrieUtils is used in analysis and searching, this is why I tend to util. The NumericTokenStream is in analysis (in my not-yet-realeased patch), ShiftAttribute in analysis.tokenattributes and TrieRangeQuery/Filter in search.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As a general comment, moving TrieRange to core should be moving it to the core and perhaps renaming the classes if we can think of a better name. Some of the other stuff belongs in a different issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is correct. I will post a patch soon, that leaves TrieUtils alive.&lt;/p&gt;</comment>
                    <comment id="12719273" author="yseeley@gmail.com" created="Sun, 14 Jun 2009 15:40:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;But on the other hand SortField.INT is also strongly linked to the plain text encoding of these tokens. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right - I agree that&apos;s not good, and SortField.INT can be misleading.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Because of this, if we stay with SortField.INT and so on, I would tend to make the according Parser/FieldCache a required arg of SortField, defaulting to the current parsers for the deprecated backwards-compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That makes sense.  I think it also makes sense (in addition) to keep the factory-like method like TrieUtils.getSortField() that instantiates the right SortField for the user based on the trie params given (like precisionStep and friends).&lt;/p&gt;</comment>
                    <comment id="12719292" author="thetaphi" created="Sun, 14 Jun 2009 17:13:34 +0100"  >&lt;p&gt;Here is a first patch, just for initial review of the API.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Only 5 new classes in core (NumericRangeQuery, NumericRangeFilter &lt;span class=&quot;error&quot;&gt;&amp;#91;each with factory for data types&amp;#93;&lt;/span&gt;, NumericTokenStream &lt;span class=&quot;error&quot;&gt;&amp;#91;with one ctor using precStep, various setValue() methods&amp;#93;&lt;/span&gt;, ShiftAttribute, TrieUtils)&lt;/li&gt;
	&lt;li&gt;TrieUtils still by that name, because a new name is not yet thought about (and how to deprecate NumberUtils from solr in contrib/spatial, deprecate o.a.l.document.NumberTools)&lt;/li&gt;
	&lt;li&gt;All tests rewritten &amp;amp; pass&lt;/li&gt;
	&lt;li&gt;Javadocs still incomplete and need to be rewritten (add package.html from contrib to search&apos;s/analysis&apos; package.html and so on)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You may ask, why I added these static factories to NumericRangeQuery/Filter, one could directly instantiate the class using any subclass of java.lang.Number? Because type safety to prevent people from doing things like new NumericRangeQuery(field,precStep,new Long(val1),new Float(val2)) which may lead to undefined behaviour. The second problem is missing type safety with auto-boxing in Java 5.&lt;/p&gt;</comment>
                    <comment id="12719680" author="thetaphi" created="Mon, 15 Jun 2009 19:12:19 +0100"  >&lt;p&gt;Updated patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;now with extended JavaDocs&lt;/li&gt;
	&lt;li&gt;additional tests for float/doubles&lt;/li&gt;
	&lt;li&gt;additional tests for equals/hashcode&lt;/li&gt;
	&lt;li&gt;changes.txt&lt;/li&gt;
	&lt;li&gt;lot of reformatting&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The only open point is the name of TrieUtils, any idea for package and/or name?&lt;/p&gt;

&lt;p&gt;Changes to FieldCache and SortField to always require a parser (see discussion with Yonik), which is a new case to be openend after this.&lt;/p&gt;</comment>
                    <comment id="12719689" author="mikemccand" created="Mon, 15 Jun 2009 19:30:26 +0100"  >&lt;blockquote&gt;&lt;p&gt;So one using new code must always specify the parser when using SortField.INT (SortField.AUTO is already deprectaed so no problem). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This will apply to int/long/float/double as well right?  How would you&lt;br/&gt;
do this (require a parser for only numeric sorts) back-compatibly?  EG,&lt;br/&gt;
the others (String, DOC, etc.) don&apos;t require a parser.&lt;/p&gt;

&lt;p&gt;We could alternatively make NumericSortField (subclassing SortField),&lt;br/&gt;
that just uses the right parser?&lt;/p&gt;

&lt;p&gt;Did you think about / decide against making a NumericField (that&apos;d set&lt;br/&gt;
the right tokenStream itself)?&lt;/p&gt;

&lt;p&gt;Other questions/comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Could we change ShiftAttribute -&amp;gt; NumericShiftAttribute?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;How about oal.util.NumericUtils instead of TrieUtils?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Can we rename RangeQuery -&amp;gt; TextRangeQuery (TermRangeQuery), to&lt;br/&gt;
    make it clear that its range checking is by Term sort order.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Should we support byte/short for trie indexed fields as well?&lt;br/&gt;
    (Since SortField, FieldCache support these numeric types too...).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12719692" author="mikemccand" created="Mon, 15 Jun 2009 19:35:43 +0100"  >&lt;blockquote&gt;&lt;p&gt;The only open point is the name of TrieUtils, any idea for package and/or name?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think NumericUtils?  (I&apos;d like the naming to be consistent w/&lt;br/&gt;
NumericRangeQuery, NumericTokenStream, since it&apos;s very much a public&lt;br/&gt;
API, ie users must interact directly with it to get their SortField&lt;br/&gt;
(maybe) and FieldCache parser).&lt;/p&gt;

&lt;p&gt;Leaving it util seems OK, since it&apos;s used by analysis &amp;amp; searching.&lt;/p&gt;</comment>
                    <comment id="12719699" author="yseeley@gmail.com" created="Mon, 15 Jun 2009 19:42:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;This will apply to int/long/float/double as well right? How would you do this (require a parser for only numeric sorts) back-compatibly? EG, the others (String, DOC, etc.) don&apos;t require a parser.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Allow passing parser==null to get the default?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We could alternatively make NumericSortField (subclassing SortField), that just uses the right parser?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A factory method TrieUtils.getSortField() could also return the right SortField.&lt;/p&gt;
</comment>
                    <comment id="12719726" author="thetaphi" created="Mon, 15 Jun 2009 20:22:52 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This will apply to int/long/float/double as well right? How would you do this (require a parser for only numeric sorts) back-compatibly? EG, the others (String, DOC, etc.) don&apos;t require a parser.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Mike: This will apply to int/long/float/double as well right? How would you&lt;br/&gt;
do this (require a parser for only numeric sorts) back-compatibly? EG,&lt;br/&gt;
the others (String, DOC, etc.) don&apos;t require a parser.&lt;/p&gt;

&lt;p&gt;Yonik: Allow passing parser==null to get the default?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We could alternatively make NumericSortField (subclassing SortField), that just uses the right parser?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A factory method TrieUtils.getSortField() could also return the right SortField.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I want to move this into a new issue after, I will open one.&lt;/p&gt;

&lt;p&gt;Nevertheless, I would like to remove emphasis from NumericUtils (which is in realyity a helper class). So I want to make the current human-readable numeric parsers public and also add the trie parsers to FieldCache.&lt;/p&gt;

&lt;p&gt;The SortField factory is then the only parts really needed in NumericUtils, but not really. The parser is a singleton, works for all trie fields and could also live somewhere else or nowhere at all, if the Parsers all stay in FieldCache.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should we support byte/short for trie indexed fields as well? (Since SortField, FieldCache support these numeric types too...). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For bytes, TrieRange is not very interesting, for shorts, maybe, but I would subsume them during indexing as simple integers. You could not speedup searching, but limit index size a little bit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Could we change ShiftAttribute -&amp;gt; NumericShiftAttribute?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No problem, I do this. There is also missing the link from the TokenStream in the javadocs to this, see also my reply in java-dev to Grants mail.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we rename RangeQuery -&amp;gt; TextRangeQuery (TermRangeQuery), to make it clear that its range checking is by Term sort order.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can do this and deprecate the old one, but I added a note to Javadocs (see patch). I would do this outside of this issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How about oal.util.NumericUtils instead of TrieUtils?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was my first idea, too. What to do with o.a.l.doc.NumberTools (deprecate?). And also update contrib/spatial to use NumericUtils instead of the copied and not really goo NumberUtils from Solr (Yonik said, it was written at a very early stage, and is not effective with UTF-8 encoding and the TermEnum posioning with the term prefixes). It would be a index-format change for spatial, but as the code was not yet released (in Lucene), the Lucene version should not use NumberUtils at all.&lt;/p&gt;</comment>
                    <comment id="12719729" author="thetaphi" created="Mon, 15 Jun 2009 20:28:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;Did you think about / decide against making a NumericField (that&apos;d set the right tokenStream itself)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem currently is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Field is final and so I must extend AbstractField. But some methods of Document return Field and not AbstractField.&lt;/li&gt;
	&lt;li&gt;NumericField would only work for indexing, but when retrieving from index (stored fields), it would change to Field.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe we should move this after the index-specific schemas and so on. Or document, that it can be only used for indexing.&lt;/p&gt;

&lt;p&gt;By the way: How do you like the factories in NumericRangeQuery and the setValue methods, working like StringBuffer.append() in NumericTokenStream? This makes it really easy to index.&lt;/p&gt;

&lt;p&gt;The only good thing of NumericField would be the possibility to automatically disable TF and Norms per default when indexing.&lt;/p&gt;</comment>
                    <comment id="12719738" author="thetaphi" created="Mon, 15 Jun 2009 20:53:27 +0100"  >&lt;p&gt;I think, I remove the ShiftAttribute in complete, its really useless. Maybe, I add a getShift() method to NumericUtils, that returns the shift value of a Token/String. See java-dev mailing with Yonik.&lt;/p&gt;</comment>
                    <comment id="12719761" author="mikemccand" created="Mon, 15 Jun 2009 21:37:35 +0100"  >&lt;p&gt;OK let&apos;s open a new issue for how to best integrate/default SortField&lt;br/&gt;
and FieldCache.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nevertheless, I would like to remove emphasis from NumericUtils (which is in realyity a helper class).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For bytes, TrieRange is not very interesting, for shorts, maybe, but I would subsume them during indexing as simple integers. You could not speedup searching, but limit index size a little bit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, a RangeQuery on a &quot;plain text&quot; byte or short field requires&lt;br/&gt;
sneakiness (knowing that you must zero-pad; keeping&lt;br/&gt;
document.NumberUtils around); I think it&apos;s best if NumericXXX in&lt;br/&gt;
Lucene handles all of java&apos;s native numeric types.  And you want a&lt;br/&gt;
byte[] or short[] out of FieldCache (to not waste RAM having to&lt;br/&gt;
upgrade to an int[]).&lt;/p&gt;

&lt;p&gt;We can do this under the (a?) new issue too...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The SortField factory is then the only parts really needed in NumericUtils, but not really. The parser is a singleton, works for all trie fields and could also live somewhere else or nowhere at all, if the Parsers all stay in FieldCache.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;(Under a new issue, but...) I&apos;m not really a fan of leaving the parser&lt;br/&gt;
in FieldCache and expecting a user to &quot;know&quot; to create the SortField&lt;br/&gt;
with that parser.  NumericSortField would make it much more consumable&lt;br/&gt;
to &quot;direct&quot; Lucene users.&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Can we rename RangeQuery -&amp;gt; TextRangeQuery (TermRangeQuery), to make it clear that its range checking is by Term sort order.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can do this and deprecate the old one, but I added a note to Javadocs (see patch). I would do this outside of this issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK.&lt;/p&gt;

&lt;p&gt;One benefit of a rename is it&apos;s a reminder to users on upgrading to&lt;br/&gt;
consider whether they should in fact switch to NumericRangeQuery.&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about oal.util.NumericUtils instead of TrieUtils?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was my first idea, too. What to do with o.a.l.doc.NumberTools (deprecate?). And also update contrib/spatial to use NumericUtils instead of the copied and not really goo NumberUtils from Solr (Yonik said, it was written at a very early stage, and is not effective with UTF-8 encoding and the TermEnum posioning with the term prefixes). It would be a index-format change for spatial, but as the code was not yet released (in Lucene), the Lucene version should not use NumberUtils at all.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 on both (if we can add byte/short to trie*); we should do this&lt;br/&gt;
before 2.9 since we can still change locallucene&apos;s format.  Maybe open&lt;br/&gt;
a new issue for that, too?  We&apos;re forking off new 2.9 issues left and&lt;br/&gt;
right here!!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think, I remove the ShiftAttribute in complete, its really useless. Maybe, I add a getShift() method to NumericUtils, that returns the shift value of a Token/String. See java-dev mailing with Yonik.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Did you think about / decide against making a NumericField (that&apos;d set the right tokenStream itself)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Field is final and so I must extend AbstractField. But some methods of Document return Field and not AbstractField.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can we just un-final Field?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;NumericField would only work for indexing, but when retrieving from index (stored fields), it would change to Field.&lt;/p&gt;

&lt;p&gt;Maybe we should move this after the index-specific schemas and so on. Or document, that it can be only used for indexing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;True, but we already have such &quot;challenges&quot; between index vs search&lt;br/&gt;
time Document; documenting it it seems fine.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;By the way: How do you like the factories in NumericRangeQuery and the setValue methods, working like StringBuffer.append() in NumericTokenStream? This makes it really easy to index.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is great!  I like that you return NumericTokenStream &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The only good thing of NumericField would be the possibility to automatically disable TF and Norms per default when indexing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Consumability (good defaults)!  (And also not having to know that you&lt;br/&gt;
must go and get a tokenStream from NumericUtils).&lt;/p&gt;</comment>
                    <comment id="12719815" author="thetaphi" created="Mon, 15 Jun 2009 23:18:29 +0100"  >&lt;p&gt;Updated patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Remove ShiftAttribute&lt;/li&gt;
	&lt;li&gt;Rename TrieUtils and corresponding test to NumericUtils&lt;/li&gt;
	&lt;li&gt;Deprecate NumberTools (and added TODO hint to NumberUtils in spatial)&lt;/li&gt;
	&lt;li&gt;I was so free to also deprecate DateTools. maybe we keep this, but add a hint to better index the date as a unix timestamp. Any ideas?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Still missing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;NumericField, I sleep one night more about it&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;unneeded SortField factory, parsers&amp;#93;&lt;/span&gt; -&amp;gt; extra issue, maybe after 3.0&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12719888" author="yseeley@gmail.com" created="Tue, 16 Jun 2009 02:19:30 +0100"  >&lt;p&gt;re: NumericField - it wouldn&apos;t have back-compat issues, so it could be added any time - no need to link it to this issue or to rush it.&lt;/p&gt;</comment>
                    <comment id="12719940" author="thetaphi" created="Tue, 16 Jun 2009 07:07:23 +0100"  >&lt;blockquote&gt;&lt;p&gt;re: NumericField - it wouldn&apos;t have back-compat issues, so it could be added any time - no need to link it to this issue or to rush it. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the same, I should first resolve this and open some more issues &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12720054" author="mikemccand" created="Tue, 16 Jun 2009 11:44:26 +0100"  >&lt;p&gt;Patch looks good Uwe!  The only thing I think is missing is a single&lt;br/&gt;
javadoc that shows the full usage of Numeric*, with code fragments.&lt;br/&gt;
But, I think that should wait until we resolve the followon issues,&lt;br/&gt;
here.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think the same, I should first resolve this and open some more issues&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, though I think some of these (NumericField, NumericSortField)&lt;br/&gt;
are important to do for 2.9.  Maybe others (adding support for the&lt;br/&gt;
missing numeric types (byte &amp;amp; short)) can wait.&lt;/p&gt;

&lt;p&gt;Let&apos;s wrap this one up and move onto the next ones &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12720056" author="thetaphi" created="Tue, 16 Jun 2009 11:50:15 +0100"  >&lt;p&gt;What do you think about deprecating DateTools? I am not really sure. Maybe we should leave it (in contrast to NumberTools), but let the notice there, that it may be better to use NumericRangeQuery with the unix timestamp.&lt;/p&gt;

&lt;p&gt;The Javadocs are almost central, the entry point (linked from everywhere) is NumericRangeQuery. I only wanted to add a short note to package.html in analysis and search.&lt;/p&gt;</comment>
                    <comment id="12720082" author="mikemccand" created="Tue, 16 Jun 2009 12:55:44 +0100"  >&lt;p&gt;I think deprecating DateTools makes sense, though, we should add simple code fragments showing the migration.&lt;/p&gt;

&lt;p&gt;NumericRangeQuery&apos;s javadocs are great, but I&apos;d like to crispen it up, by decoupling &quot;how you use it&quot; from &quot;how it&apos;s implemented&quot;.  EG lead right off with a &quot;for the impatient, this is how it&apos;s used&quot;, and then a separate section detailing how it works, what precisionStep means  (and tradeoffs of high/low values for it), the reference to the full paper, etc.&lt;/p&gt;

&lt;p&gt;But we can iterate on the javadocs in the separate issue, too.&lt;/p&gt;</comment>
                    <comment id="12720084" author="mikemccand" created="Tue, 16 Jun 2009 12:59:50 +0100"  >&lt;blockquote&gt;&lt;p&gt;NumericField would only work for indexing, but when retrieving from index (stored fields), it would change to Field.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, this need not be a limitation; FieldsWriter already writes bits recording details for each stored field (binary, tokenized, compressed (deprecated)).  We could easily add &quot;numeric&quot;; then FieldsReader would return a NumericField.&lt;/p&gt;</comment>
                    <comment id="12720089" author="thetaphi" created="Tue, 16 Jun 2009 13:17:08 +0100"  >&lt;blockquote&gt;&lt;p&gt;Actually, this need not be a limitation; FieldsWriter already writes bits recording details for each stored field (binary, tokenized, compressed (deprecated)). We could easily add &quot;numeric&quot;; then FieldsReader would return a NumericField&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With all problems in FieldsReader like need to have a LazyNumericField and so on... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I cam around this two month ago when fixing this omitTf things there... But it may be an idea.&lt;/p&gt;

&lt;p&gt;I will do some changes to the current patch and fix javadocs and add these package.html parts. The SortField and FieldCache parts are done directly after this issue.&lt;/p&gt;

&lt;p&gt;I only wanted to hear one more voice about DateTools, because for index size and so on, it may still be good to only index dates in date-granularity. With this, you can use a simple TermQuery to retrieve all docs for that day, with NumericRangeQuery you must create a NumericRangeQuery.newLongRange() on the unix ts from 0:00 on the day to 0:00 on the following day exclusive.&lt;/p&gt;</comment>
                    <comment id="12720143" author="mikemccand" created="Tue, 16 Jun 2009 15:15:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;I only wanted to hear one more voice about DateTools, because for index size and so on, it may still be good to only index dates in date-granularity. With this, you can use a simple TermQuery to retrieve all docs for that day, with NumericRangeQuery you must create a NumericRangeQuery.newLongRange() on the unix ts from 0:00 on the day to 0:00 on the following day exclusive.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Couldn&apos;t we have a NumericTermQuery for such cases?  You have the full precision term in the index...&lt;/p&gt;</comment>
                    <comment id="12720152" author="thetaphi" created="Tue, 16 Jun 2009 15:30:10 +0100"  >&lt;p&gt;With a NumericTermQuery you would only hit the document exactly on the same millisecond.&lt;/p&gt;

&lt;p&gt;The good thing behind DateTools is, that you can index the date value as a term with some fixed precision, like months. Because of this, you can simply find specific month using one TermQuery. For Ranges, NumericRangeQuery is in most cases better (not with month resolution).&lt;/p&gt;

&lt;p&gt;With NumericRangeQuery it is hard to hit exactly one month using only one term, because the month boundaries in epoch milliseconds is not exactly a 2^n value. In my opinion:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DateTools is good to index very coarse dates, months, years out of a java.util.Date/Calendar. E.g. days where a room (document) is free in hotel. Users then can use term queries and ask is there any free room on a specific date, for a date range, it is not bad to use a conventional RangeQuery (only few terms affected).&lt;/li&gt;
	&lt;li&gt;Use NumericRangeQuery if you want to query any date range (even downto the millisecond). The important thing is: the lower precision terms are not at common date boundaries.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Because of this different use cases, in my opinion, DateTools has its usage.&lt;/p&gt;</comment>
                    <comment id="12720163" author="yseeley@gmail.com" created="Tue, 16 Jun 2009 15:49:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;We could easily add &quot;numeric&quot;; then FieldsReader would return a NumericField.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is that baking in a specific implementation into the index format that I don&apos;t like.&lt;br/&gt;
There will be changes to Trie*, there will be other implementations of numerics by both us and other users.  We don&apos;t need to strongly couple core indexing and the types of fields... they aren&apos;t coupled now except when the generic format of the index changes (like omitNorms, omitTf, indexed, etc).&lt;/p&gt;</comment>
                    <comment id="12720187" author="mikemccand" created="Tue, 16 Jun 2009 16:23:36 +0100"  >&lt;blockquote&gt;&lt;p&gt;With a NumericTermQuery you would only hit the document exactly on the same millisecond.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Couldn&apos;t I quantize my times (say, by day), then index using&lt;br/&gt;
NumericField, then use NumericRangeQuery for certain cases and&lt;br/&gt;
NumericTermQuery if I want to precisely match one day?&lt;/p&gt;

&lt;p&gt;Or for non-Date fields it might be apply too... maybe I&apos;m searching&lt;br/&gt;
for a hard drive, so I drill down by range (size &amp;gt;= 1.0 TB) and then&lt;br/&gt;
when there&apos;s only a few sizes in the set we offer up the exact choices&lt;br/&gt;
(1.0, 1.5, 2.0 TB) and when user clicks on one of those we use a&lt;br/&gt;
NumericTermQuery.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Because of this different use cases, in my opinion, DateTools has its usage.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK I agree, we should leave DateTools un-deprecated.  If/when we offer&lt;br/&gt;
easier integration for Dates w/ Numeric*, we can reconsider&lt;br/&gt;
deprecation at that point.&lt;/p&gt;</comment>
                    <comment id="12720191" author="mikemccand" created="Tue, 16 Jun 2009 16:38:13 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;We could easily add &quot;numeric&quot;; then FieldsReader would return a NumericField.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is that baking in a specific implementation into the index format that I don&apos;t like.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But we are already &quot;baking in&quot; the trie indexing format?  That&apos;s what&lt;br/&gt;
&quot;moving trie to core&quot; implies.  Lucene can now index numbers, well,&lt;br/&gt;
and has committed to a certain approach (trie).&lt;/p&gt;

&lt;p&gt;The term dict of a numeric field is trie encoded, each doc field is&lt;br/&gt;
indexed under a series of trie encoded tokens (w/ different&lt;br/&gt;
precisions), etc.&lt;/p&gt;

&lt;p&gt;Sure, in the future we may find improvements to how Lucene indexes&lt;br/&gt;
numbers, by why choose to be buggy today (&quot;hey how come I didn&apos;t get a&lt;br/&gt;
NumericField back on my doc?&quot;) for this possible future that may or&lt;br/&gt;
may not come?  If/when that future arrives, we can improve the index&lt;br/&gt;
format at that point rather than intentionally create buggy code&lt;br/&gt;
today?&lt;/p&gt;

&lt;p&gt;I do agree that retrieving a doc is already &quot;buggy&quot;, in that various&lt;br/&gt;
things are lost from your index time doc (a well known issue at this&lt;br/&gt;
point!), but I don&apos;t think we should intentionally make that behavior&lt;br/&gt;
even more buggy, if we can help it...&lt;/p&gt;</comment>
                    <comment id="12720223" author="yseeley@gmail.com" created="Tue, 16 Jun 2009 17:29:49 +0100"  >&lt;blockquote&gt;&lt;p&gt;But we are already &quot;baking in&quot; the trie indexing format? That&apos;s what &quot;moving trie to core&quot; implies. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nah - no more than the porter stemmer or any other type of analysis is &quot;baked in&quot;.&lt;br/&gt;
I thought &quot;move&quot; meant &quot;rename&quot; (package and class name).  Upgrading it&apos;s stability and how &quot;core&quot; it was.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&quot;hey how come I didn&apos;t get a NumericField back on my doc?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Perhaps a good reason to not add a NumericField.  It doesn&apos;t currently exist and is not necessary for Trie.&lt;br/&gt;
Want a convenience method for the user?  TrieUtils.createDocumentField(...) , same as the sortField currently works.&lt;/p&gt;

&lt;p&gt;The current Trie behavior works the same way everything else does in Lucene... changing that and encoding types into the index deserves it&apos;s own issue and discussion (and something big like that doesn&apos;t seem to belong in 2.9 which is winding down).&lt;/p&gt;</comment>
                    <comment id="12720231" author="earwin" created="Tue, 16 Jun 2009 17:40:42 +0100"  >&lt;blockquote&gt;&lt;p&gt;This is that baking in a specific implementation into the index format that I don&apos;t like.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+many&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I do agree that retrieving a doc is already &quot;buggy&quot;, in that various things are lost from your index time doc (a well known issue at this point!)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;How on earth is it buggy? You&apos;re working with an inverted index, you aren&apos;t supposed to get original document from it in the first place. It&apos;s like saying a hash function is buggy because it is not reversible.&lt;/p&gt;

&lt;p&gt;The less coupling various lucene components have on each other - the better. If you&apos;d like to have end-to-end experience for numeric fields, build something schema-like and put it in contribs. If it&apos;s hard to build - Lucene core is to blame, it&apos;s not extensible enough. From my experience, for that purporse it&apos;s okay as it is.&lt;/p&gt;</comment>
                    <comment id="12720574" author="mikemccand" created="Wed, 17 Jun 2009 10:06:33 +0100"  >&lt;p&gt;Note that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1505&quot; title=&quot;Change contrib/spatial to use trie&amp;#39;s NumericUtils, and remove NumberUtils&quot;&gt;&lt;del&gt;LUCENE-1505&lt;/del&gt;&lt;/a&gt; is open for cutting over contrib/spacial to NumericUtils....&lt;/p&gt;</comment>
                    <comment id="12720593" author="mikemccand" created="Wed, 17 Jun 2009 10:51:17 +0100"  >&lt;blockquote&gt;&lt;p&gt;Want a convenience method for the user? TrieUtils.createDocumentField(...) , same as the sortField currently works.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think this is &quot;convenient&quot; enough.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you&apos;d like to have end-to-end experience for numeric fields, build something schema-like and put it in contribs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Long (medium?) term I&apos;d love to get to this point; I think it&apos;d make&lt;br/&gt;
Lucene quite a bit more consumable.  But we shouldn&apos;t sacrifice&lt;br/&gt;
consumability today on the hope for that future nirvana.&lt;/p&gt;

&lt;p&gt;You already have a nice starting point here... is that something you&lt;br/&gt;
could donate?&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I do agree that retrieving a doc is already &quot;buggy&quot;, in that various things are lost from your index time doc (a well known issue at this point!)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How on earth is it buggy?  You&apos;re working with an inverted index, you aren&apos;t supposed to get original document from it in the first place. It&apos;s like saying a hash function is buggy because it is not reversible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I completely agree: you&apos;re not supposed to get the original doc back.&lt;br/&gt;
And the fact that Lucene&apos;s API now &quot;pretends&quot; you do, is wrong.  We all&lt;br/&gt;
agree to that, and that we need to fix Lucene.&lt;/p&gt;

&lt;p&gt;But, as things now stand, it&apos;s not yet fixed, so until it&apos;s fixed, I&lt;br/&gt;
don&apos;t like intentionally making it worse.&lt;/p&gt;

&lt;p&gt;It&apos;d be great to simply stop returning Document from IndexReader.&lt;br/&gt;
Wanna make a patch?  I don&apos;t think the new sheriff&apos;d hold 2.9 for this&lt;br/&gt;
though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;hey how come I didn&apos;t get a NumericField back on my doc?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Perhaps a good reason to not add a NumericField.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think NumericField (when building your doc) is still valuable, even&lt;br/&gt;
if we can&apos;t return NumericField when you retrieve the doc.&lt;/p&gt;

&lt;p&gt;OK... since adding the bit to the stored fields is controversial, I&lt;br/&gt;
think for 2.9, we should only add NumericField at indexing (document&lt;br/&gt;
creation) time.  So, we don&apos;t store a new bit in stored fields file&lt;br/&gt;
and the index format is unchanged.&lt;/p&gt;</comment>
                    <comment id="12720681" author="thetaphi" created="Wed, 17 Jun 2009 15:16:32 +0100"  >&lt;p&gt;Here some intermediate update...&lt;/p&gt;</comment>
                    <comment id="12721145" author="thetaphi" created="Thu, 18 Jun 2009 10:44:22 +0100"  >&lt;p&gt;Final patch version with updated javadocs. I will commit in a day or two &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
When committing, I will also remove TrieRange from contrib/search (not included in patch).&lt;/p&gt;

&lt;p&gt;If you want to make javadocs updates, feel free to post an updated patch or do it after I committed.&lt;/p&gt;

&lt;p&gt;After that I will do some work for NumericField and NumericSortField as well as moving the parsers to FieldCache and make the plain-text-number parsers public there, too.&lt;/p&gt;</comment>
                    <comment id="12721326" author="mikemccand" created="Thu, 18 Jun 2009 17:13:59 +0100"  >&lt;p&gt;Latest patch looks good Uwe!  We can separately tweak the javadocs...&lt;/p&gt;</comment>
                    <comment id="12721759" author="thetaphi" created="Fri, 19 Jun 2009 13:17:38 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Committed addition to core in revision 786470&lt;/li&gt;
	&lt;li&gt;Committed remove from contrib in revision 786474&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks for all your help! I will now open another issue for the remaining (optional) tasks&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12411485">LUCENE-1505</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12428360">LUCENE-1701</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12411367">SOLR-940</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12411050" name="LUCENE-1673.patch" size="130301" author="thetaphi" created="Thu, 18 Jun 2009 10:44:22 +0100" />
                    <attachment id="12410937" name="LUCENE-1673.patch" size="121974" author="thetaphi" created="Wed, 17 Jun 2009 15:16:32 +0100" />
                    <attachment id="12410720" name="LUCENE-1673.patch" size="121951" author="thetaphi" created="Mon, 15 Jun 2009 23:18:29 +0100" />
                    <attachment id="12410691" name="LUCENE-1673.patch" size="118855" author="thetaphi" created="Mon, 15 Jun 2009 19:12:19 +0100" />
                    <attachment id="12410581" name="LUCENE-1673.patch" size="105873" author="thetaphi" created="Sun, 14 Jun 2009 17:13:34 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 1 Jun 2009 16:30:35 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12085</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26054</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>