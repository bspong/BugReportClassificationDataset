<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:24 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1257/LUCENE-1257.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1257] Port to Java5</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1257</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;For my needs I&apos;ve updated Lucene so that it uses Java 5 constructs. I know Java 5 migration had been planned for 2.1 someday in the past, but don&apos;t know when it is planned now. This patch against the trunk includes :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;most obvious generics usage (there are tons of usages of sets, ... Those which are commonly used have been generified)&lt;/li&gt;
	&lt;li&gt;PriorityQueue generification&lt;/li&gt;
	&lt;li&gt;replacement of indexed for loops with for each constructs&lt;/li&gt;
	&lt;li&gt;removal of unnececessary unboxing&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The code is to my opinion much more readable with those features (you actually &lt;b&gt;know&lt;/b&gt; what is stored in collections reading the code, without the need to lookup for field definitions everytime) and it simplifies many algorithms.&lt;/p&gt;

&lt;p&gt;Note that this patch also includes an interface for the Query class. This has been done for my company&apos;s needs for building custom Query classes which add some behaviour to the base Lucene queries. It prevents multiple unnnecessary casts. I know this introduction is not wanted by the team, but it really makes our developments easier to maintain. If you don&apos;t want to use this, replace all /Queriable/ calls with standard /Query/.&lt;/p&gt;
</description>
                <environment></environment>
            <key id="12392905">LUCENE-1257</key>
            <summary>Port to Java5</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="melix">C&#233;dric Champeau</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Apr 2008 09:29:05 +0100</created>
                <updated>Wed, 25 Nov 2009 16:47:49 +0000</updated>
                    <resolved>Fri, 13 Nov 2009 11:39:29 +0000</resolved>
                            <version>3.0</version>
                                <fixVersion>3.0</fixVersion>
                                <component>core/index</component>
                <component>core/other</component>
                <component>core/query/scoring</component>
                <component>core/queryparser</component>
                <component>core/search</component>
                <component>core/store</component>
                <component>core/termvectors</component>
                <component>modules/analysis</component>
                <component>modules/examples</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12584456" author="melix" created="Wed, 2 Apr 2008 09:29:43 +0100"  >&lt;p&gt;Patch against the trunk&lt;/p&gt;</comment>
                    <comment id="12761212" author="thetaphi" created="Thu, 1 Oct 2009 14:29:21 +0100"  >&lt;p&gt;This patch is bit outdated.&lt;/p&gt;

&lt;p&gt;I will try to fix a lot of these things. Simple are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove new NumberSubType(value) and replace by value (autoboxing), which is faster, because allocation overhead removed&lt;/li&gt;
	&lt;li&gt;replace StringBuffer by StringBuilder globally (it is never used in more than one thread)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Addition of generics is little more work, I started in other issues (NumericRangeQuery, AttributeSource).&lt;/p&gt;</comment>
                    <comment id="12761370" author="thetaphi" created="Thu, 1 Oct 2009 23:22:57 +0100"  >&lt;p&gt;A first patch that replaces StringBuffer -&amp;gt; StringBuilder almost everywhere (created using find/grep/sed). Some classes were left out (auto-generated classes by JavaCC).&lt;/p&gt;

&lt;p&gt;There are still some special cases in contrib: some public/protected methods use StringBuffer as param/return type. These should be reverted - or break backwards in 3.0? Any comments?&lt;/p&gt;</comment>
                    <comment id="12761737" author="thetaphi" created="Fri, 2 Oct 2009 22:46:11 +0100"  >&lt;p&gt;Updated patch. It removes some replacements in snowball and other contribs, where StringBuffer appears in public API.&lt;/p&gt;

&lt;p&gt;All other occurences should be correctly replaced (mostly toString() impls).&lt;/p&gt;

&lt;p&gt;I will commit this soon, too, as the patch may get outdated very fast.&lt;/p&gt;</comment>
                    <comment id="12761745" author="thetaphi" created="Fri, 2 Oct 2009 23:06:08 +0100"  >&lt;p&gt;Small fix in highlighter public API.&lt;/p&gt;</comment>
                    <comment id="12761747" author="thetaphi" created="Fri, 2 Oct 2009 23:11:52 +0100"  >&lt;p&gt;StringBuffer changes committed revision: 821185&lt;/p&gt;

&lt;p&gt;I hope nobody has merge problems now... I keep this issue open as umbrella for further Java 1.5 changes.&lt;/p&gt;</comment>
                    <comment id="12761748" author="markrmiller@gmail.com" created="Fri, 2 Oct 2009 23:15:59 +0100"  >&lt;blockquote&gt;&lt;p&gt;There are still some special cases in contrib: some public/protected methods use StringBuffer as param/return type. These should be reverted - or break backwards in 3.0? Any comments?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I vote to move to StringBuilder anyway if its in Contrib. Though probably not with Snowball, since we don&apos;t really write/maintain that code.&lt;/p&gt;</comment>
                    <comment id="12761754" author="thetaphi" created="Fri, 2 Oct 2009 23:22:43 +0100"  >&lt;p&gt;I already committed tha non-public-API changes. Maybe we add the other StringBuilders in contrib on separate issues. For highlighter I modified the public API of TextFragment to use CharSequence and deprecated the StringBuffer ctor. Maybe we can do this like this elsewhere, too.&lt;/p&gt;</comment>
                    <comment id="12761755" author="karl.wettin" created="Fri, 2 Oct 2009 23:23:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;I vote to move to StringBuilder anyway if its in Contrib. Though probably not with Snowball, since we don&apos;t really write/maintain that code.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually I patched the Snowball stemmer code to get ridth of the use of reflection. So what we use is an altered version of their code. I tried to get Dr Porter to commit those changes for years but it&apos;s still the same. Based on this I think we could just keep going with our own stuff in there as long we keep a record of what we have done in case we want to merge with their trunk. &lt;/p&gt;</comment>
                    <comment id="12761774" author="thetaphi" created="Sat, 3 Oct 2009 00:21:41 +0100"  >&lt;p&gt;Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List&amp;lt;Fieldable&amp;gt;.&lt;/p&gt;</comment>
                    <comment id="12761785" author="markrmiller@gmail.com" created="Sat, 3 Oct 2009 01:27:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;Actually I patched the Snowball stemmer code to get ridth of the use of reflection. So what we use is an altered version of their code. I tried to get Dr Porter to commit those changes for years but it&apos;s still the same. Based on this I think we could just keep going with our own stuff in there as long we keep a record of what we have done in case we want to merge with their trunk. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay - lets do it then. Testing the English version, its actually almost twice as fast with a StringBuilder.&lt;/p&gt;

&lt;p&gt;I bet it would be almost twice as fast or better again if we could get rid of that nasty reflection ...&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Wait ... do you mean you got rid of some of the reflection or did we lose your changes? I&apos;m seeing some nasty slow reflection in there still ...&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;err... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I&apos;m sure you can clear it up ...&lt;/p&gt;</comment>
                    <comment id="12761836" author="thetaphi" created="Sat, 3 Oct 2009 10:17:37 +0100"  >&lt;blockquote&gt;&lt;p&gt;Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List&amp;lt;Fieldable&amp;gt;. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Committed revision: 821277&lt;/p&gt;</comment>
                    <comment id="12761839" author="tcn" created="Sat, 3 Oct 2009 10:34:34 +0100"  >&lt;p&gt;Somewhat off-topic but in the course of porting to Java 5 I would suggest IndexWriter etc. to implement java.io.Closeable.&lt;/p&gt;</comment>
                    <comment id="12761841" author="thetaphi" created="Sat, 3 Oct 2009 10:42:54 +0100"  >&lt;p&gt;Good idea!&lt;/p&gt;</comment>
                    <comment id="12761843" author="paul.elschot@xs4all.nl" created="Sat, 3 Oct 2009 10:52:25 +0100"  >&lt;p&gt;For the record, there is still some usage of StringBuffer in contrib/surround. Fortunately not in public API, only internal, and in some protected method parameters.&lt;/p&gt;</comment>
                    <comment id="12761852" author="thetaphi" created="Sat, 3 Oct 2009 11:26:31 +0100"  >&lt;p&gt;I know, protected is also public from the API side (one could subclass and use one of the protected methods), because of that I left it out for the beginning. This is why you should always think about making as most as possible (package-)private.&lt;/p&gt;</comment>
                    <comment id="12761855" author="paul.elschot@xs4all.nl" created="Sat, 3 Oct 2009 12:08:28 +0100"  >&lt;p&gt;StringBuffer to StringBuilder patch for conrib/surround&lt;/p&gt;</comment>
                    <comment id="12761856" author="paul.elschot@xs4all.nl" created="Sat, 3 Oct 2009 12:13:56 +0100"  >&lt;p&gt;I would not expect that the protected methods in contrib/surround that are affected by this patch are actually overridden by other code. So formally this is an API change, but I don&apos;t think it is worth mentioning in other places than here.&lt;/p&gt;</comment>
                    <comment id="12761859" author="thetaphi" created="Sat, 3 Oct 2009 12:26:36 +0100"  >&lt;p&gt;Lets add a changes.txt entry in contrib about a BW break.&lt;/p&gt;</comment>
                    <comment id="12761860" author="thetaphi" created="Sat, 3 Oct 2009 12:33:56 +0100"  >&lt;p&gt;patch with changes.txt&lt;/p&gt;</comment>
                    <comment id="12761862" author="karl.wettin" created="Sat, 3 Oct 2009 12:46:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;Wait ... do you mean you got rid of some of the reflection or did we lose your changes? I&apos;m seeing some nasty slow reflection in there still ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;My changes was to the abstract Snowball stemmer class. I simply added an abstract method and got rid of the reflection in the Lucene filter. &lt;/p&gt;

&lt;p&gt;One could argue that we should update the Snowball compiler rather than updating the Java code it renders. But honestly I think we should just update the rendered code and then report any improvement found to the Snowball ml and keep track of it in the package readme.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;err... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I&apos;m sure you can clear it up ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It could still be rather expensive per stem at query time. I vote for getting rid of it if we can. I&apos;ll throw an eye at it.&lt;/p&gt;</comment>
                    <comment id="12761870" author="karl.wettin" created="Sat, 3 Oct 2009 14:09:32 +0100"  >&lt;blockquote&gt;&lt;p&gt;Generification of Document. It makes now clear what getFields() returns really. This was very bad documented. Now its a List&amp;lt;Fieldable&amp;gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This broke InstantiatedIndex in the trunk. Patch and commit is on the way.&lt;/p&gt;</comment>
                    <comment id="12761872" author="thetaphi" created="Sat, 3 Oct 2009 14:13:35 +0100"  >&lt;p&gt;how that?&lt;/p&gt;</comment>
                    <comment id="12761873" author="karl.wettin" created="Sat, 3 Oct 2009 14:14:03 +0100"  >&lt;p&gt;Generified ShingleMatrixFilter&lt;/p&gt;</comment>
                    <comment id="12761874" author="karl.wettin" created="Sat, 3 Oct 2009 14:17:59 +0100"  >&lt;blockquote&gt;&lt;p&gt;Generified ShingleMatrixFilter&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Committed in rev 821311&lt;/p&gt;</comment>
                    <comment id="12761875" author="karl.wettin" created="Sat, 3 Oct 2009 14:19:54 +0100"  >&lt;blockquote&gt;&lt;p&gt;how that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It asserted that a Document contained a List&amp;lt;Field&amp;gt; rather than List&amp;lt;Fieldable&amp;gt; in ctor(IndexReader) , which I actually think is true at that point using that code.&lt;/p&gt;</comment>
                    <comment id="12761876" author="karl.wettin" created="Sat, 3 Oct 2009 14:21:38 +0100"  >&lt;p&gt;Fix for InstantiadexIndex compile error caused by code committed in revision 821277&lt;br/&gt;
List&amp;lt;Fieldable&amp;gt; rather than List&amp;lt;Field&amp;gt;&lt;/p&gt;</comment>
                    <comment id="12761877" author="karl.wettin" created="Sat, 3 Oct 2009 14:24:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;Fix for InstantiadexIndex compile error caused by code committed in revision 821277&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Committed in rev 821315&lt;/p&gt;</comment>
                    <comment id="12761878" author="thetaphi" created="Sat, 3 Oct 2009 14:24:13 +0100"  >&lt;p&gt;Ah ok, the list is Fieldable. That was exactly the problem with Document, it was not documented, what was inside &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Just commit it.&lt;/p&gt;</comment>
                    <comment id="12761899" author="rcmuir" created="Sat, 3 Oct 2009 16:14:22 +0100"  >&lt;p&gt;changes o.a.l.messages (back) to varargs syntax to match the java 5 MessageFormat and removes ugly Object[] {} wrappers.&lt;/p&gt;</comment>
                    <comment id="12761970" author="thetaphi" created="Sun, 4 Oct 2009 00:12:57 +0100"  >&lt;p&gt;Committed Revision: 821443 (Change some occurrences of StringBuffer in public/protected APIs of contrib/surround to StringBuilder)&lt;/p&gt;</comment>
                    <comment id="12761975" author="thetaphi" created="Sun, 4 Oct 2009 00:37:13 +0100"  >&lt;p&gt;Committed revision: 821447 (o.a.l.messages vararg conversion)&lt;/p&gt;</comment>
                    <comment id="12762012" author="paul.elschot@xs4all.nl" created="Sun, 4 Oct 2009 10:53:47 +0100"  >&lt;p&gt;Uwe, thanks for adding the changes.txt entry and committing the contrib/surround StringBuffer to StringBuilder patch.&lt;/p&gt;</comment>
                    <comment id="12762131" author="karl.wettin" created="Mon, 5 Oct 2009 10:58:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;err... looks like perhaps its only hit once though and then reused.. maybe not so nasty. My first time looking at this code, so I&apos;m sure you can clear it up ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Mark, are you referring to the reflection in Among? Those are pretty tough to get rid of.&lt;/p&gt;

&lt;p&gt;I think we should replace the StringBuffers in the stemmers if nobody else minds. But I think we should do that in another issue. I also found a bit of ASL headers in some of the classes. Suppose they have been added automatically at some point. These classes are all BSD.&lt;/p&gt;</comment>
                    <comment id="12763083" author="earwin" created="Wed, 7 Oct 2009 15:58:20 +0100"  >&lt;p&gt;Not sure if that&apos;s the right issue, but still.&lt;/p&gt;

&lt;p&gt;Amongst other stuff Java5 introduced for-each loops, which can replace lots of for/while constructs with more readable ones.&lt;br/&gt;
Should I post the patch with all such loops converted?&lt;/p&gt;</comment>
                    <comment id="12763087" author="earwin" created="Wed, 7 Oct 2009 16:02:14 +0100"  >&lt;p&gt;Also, we can remove tons of boxing/unboxing, auto(&lt;del&gt;un&lt;/del&gt;)boxing calls the very same valueOf(), nnnValue() methods for us.&lt;/p&gt;</comment>
                    <comment id="12764315" author="tcn" created="Sat, 10 Oct 2009 08:56:15 +0100"  >&lt;p&gt;eclipse has a code cleanup tool that can easily do all this automatically. It can also make all possible fields/variables final, something I would like to recommend as well.&lt;/p&gt;</comment>
                    <comment id="12766649" author="kaykay.unique" created="Fri, 16 Oct 2009 19:42:26 +0100"  >&lt;ul&gt;
	&lt;li&gt;DisjunctionMaxQuery.java - some of the casts are not necessary now that the members are made type-safe.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12766657" author="thetaphi" created="Fri, 16 Oct 2009 19:54:24 +0100"  >&lt;p&gt;Committed revision: 826035&lt;/p&gt;</comment>
                    <comment id="12766842" author="kaykay.unique" created="Sat, 17 Oct 2009 07:52:08 +0100"  >&lt;ul&gt;
	&lt;li&gt;BooleanFilter ( internal data structures conformed to generics )&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12766848" author="kaykay.unique" created="Sat, 17 Oct 2009 08:11:22 +0100"  >&lt;p&gt;Generify signatures. &lt;/p&gt;</comment>
                    <comment id="12766858" author="thetaphi" created="Sat, 17 Oct 2009 09:07:56 +0100"  >&lt;p&gt;I am working on it, I already fixed the missing SegmentInfo clone cast. Was there any other change in the SegmentInfo patch?&lt;/p&gt;</comment>
                    <comment id="12766861" author="thetaphi" created="Sat, 17 Oct 2009 09:38:22 +0100"  >&lt;p&gt;again we have the date sorting bug in JIRA because of am/pm. Can someone change JIRA to use ISO 8601 datstamps in its filelist and everywhere? krrrrrrrrrr.&lt;/p&gt;

&lt;p&gt;Kay kay: please wait one hour with posting more patches, otherwise I will loose track.&lt;/p&gt;</comment>
                    <comment id="12766869" author="thetaphi" created="Sat, 17 Oct 2009 10:54:46 +0100"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-SegmentInfos.patch 2009-10-17 12:59 AM Kay Kay 6 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-BufferedDeletes_DocumentsWriter.patch 2009-10-17 12:44 AM Kay Kay 5 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-NormalizeCharMap.patch 2009-10-17 12:15 AM Kay Kay 1 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-WordListLoader.patch 2009-10-17 12:11 AM Kay Kay 3 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-BooleanScorer_2.patch 2009-10-17 01:39 AM Kay Kay 4 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-BooleanQuery.patch 2009-10-17 01:31 AM Kay Kay 5 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_BooleanFilter_Generics.patch 2009-10-16 11:52 PM Kay Kay 4 kB &lt;/p&gt;

&lt;p&gt;I also made BooleanQuery Iterable&amp;lt;BooleanClause&amp;gt; for easy usage in advanced for loops. Also added some @Override there.&lt;/p&gt;

&lt;p&gt;Revision: 826213 - Thanks Kay Kay!&lt;/p&gt;</comment>
                    <comment id="12766931" author="kaykay.unique" created="Sat, 17 Oct 2009 16:39:15 +0100"  >&lt;p&gt;Thanks Uwe for helping with the patches. &lt;/p&gt;</comment>
                    <comment id="12766948" author="thetaphi" created="Sat, 17 Oct 2009 20:15:37 +0100"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-DocFieldProcessorPerThread.patch 2009-10-17 09:40 AM Kay Kay 4 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-DirectoryReader.patch 2009-10-17 09:12 AM Kay Kay 8 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-ConcurrentMergeScheduler.patch 2009-10-17 08:56 AM Kay Kay 2 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-CompoundFileReaderWriter.patch 2009-10-17 08:52 AM Kay Kay 3 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-CheckIndex.patch 2009-10-17 08:48 AM Kay Kay 6 kB &lt;/p&gt;

&lt;p&gt;I also added some more generics to FilterIndexReader, MultiReader, ParallelReader (commitUserData, getFieldNames).&lt;/p&gt;

&lt;p&gt;Revision: 826290 - Thanks Kay Kay.&lt;/p&gt;</comment>
                    <comment id="12766949" author="thetaphi" created="Sat, 17 Oct 2009 20:16:13 +0100"  >&lt;p&gt;Kay Kay: You can also provide only one combined patch instead of separate ones.&lt;/p&gt;</comment>
                    <comment id="12767011" author="kaykay.unique" created="Sun, 18 Oct 2009 06:04:38 +0100"  >&lt;p&gt;Patch across a good number of files in org.apache.lucene.index ( generify ) &lt;/p&gt;</comment>
                    <comment id="12767029" author="thetaphi" created="Sun, 18 Oct 2009 10:28:11 +0100"  >&lt;p&gt;Whitespace-cleanup of your patch. See also &lt;a href=&quot;http://www.lucidimagination.com/search/document/62fe00098351dbe3/whitespace_inside_generics_parameters&quot; class=&quot;external-link&quot;&gt;http://www.lucidimagination.com/search/document/62fe00098351dbe3/whitespace_inside_generics_parameters&lt;/a&gt; for how Lucene should format generics parameters.&lt;/p&gt;

&lt;p&gt;I will apply when all tests are run. Thank you for the hard work, that not really fun to convert all this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12767033" author="thetaphi" created="Sun, 18 Oct 2009 10:51:54 +0100"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_org_apache_lucene_index.patch&lt;br/&gt;
At revision: 826389&lt;/p&gt;</comment>
                    <comment id="12767070" author="kaykay.unique" created="Sun, 18 Oct 2009 15:55:32 +0100"  >&lt;p&gt;More set of patches in org.apache.lucene.document . &lt;/p&gt;</comment>
                    <comment id="12767072" author="thetaphi" created="Sun, 18 Oct 2009 16:13:57 +0100"  >&lt;blockquote&gt;&lt;p&gt;More set of patches in org.apache.lucene.document&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You mean not only document?&lt;/p&gt;

&lt;p&gt;I looked through it: The o.a.l.util.cache is not ideal: The whole classes should take a &amp;lt;K,V&amp;gt; parameter for the cache and not be fixed to &amp;lt;Object,Object&amp;gt;. This was on my list to fix, so I would leave out the whole cache package in this patch and fix it myself.&lt;/p&gt;</comment>
                    <comment id="12767082" author="kaykay.unique" created="Sun, 18 Oct 2009 16:49:50 +0100"  >&lt;ul&gt;
	&lt;li&gt;Mostly with IndexWriter&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12767086" author="thetaphi" created="Sun, 18 Oct 2009 17:19:43 +0100"  >&lt;p&gt;Attached is a new patch with a correct generified o.a.l.util.cache package. Now only the usage of this SimpleLRUCache should also be generified.&lt;/p&gt;

&lt;p&gt;Kay Kay: Do you want to do this or should I do it?&lt;/p&gt;</comment>
                    <comment id="12767087" author="kaykay.unique" created="Sun, 18 Oct 2009 17:21:00 +0100"  >&lt;p&gt;Uwe: Please feel free to go ahead and do it and commit it, that I can pick up the diff. &lt;/p&gt;</comment>
                    <comment id="12767088" author="kaykay.unique" created="Sun, 18 Oct 2009 17:21:53 +0100"  >&lt;p&gt;IndexDelete (Policy) and stuff&lt;/p&gt;</comment>
                    <comment id="12767097" author="kaykay.unique" created="Sun, 18 Oct 2009 18:39:05 +0100"  >&lt;p&gt;o.a.l.search package - generified&lt;/p&gt;</comment>
                    <comment id="12767102" author="kaykay.unique" created="Sun, 18 Oct 2009 18:52:28 +0100"  >&lt;p&gt;o.a.l.search.spans - generics added&lt;/p&gt;</comment>
                    <comment id="12767116" author="kaykay.unique" created="Sun, 18 Oct 2009 20:42:13 +0100"  >&lt;blockquote&gt;&lt;p&gt; Attached is a new patch with a correct generified o.a.l.util.cache package. Now only the usage of this SimpleLRUCache should also be generified.&lt;/p&gt;

&lt;p&gt;Kay Kay: Do you want to do this or should I do it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Revised patch attached that address issue with SimpleLRUCache as well &lt;/p&gt;</comment>
                    <comment id="12767123" author="kaykay.unique" created="Sun, 18 Oct 2009 21:15:28 +0100"  >&lt;ul&gt;
	&lt;li&gt;MapOfSets&lt;/li&gt;
	&lt;li&gt;FieldCacheSanityChecker&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12767131" author="thetaphi" created="Sun, 18 Oct 2009 22:11:45 +0100"  >&lt;p&gt;Looks good!&lt;/p&gt;

&lt;p&gt;Committed (with some modifications and additions from my last patch):&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-o.a.l.util.patch 2009-10-18 01:15 PM Kay Kay 10 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-org_apache_lucene_document.patch 2009-10-18 12:42 PM Kay Kay 29 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o.a.l.store.patch 2009-10-18 11:04 AM Kay Kay 12 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o_a_l_search_spans.patch 2009-10-18 10:52 AM Kay Kay 16 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o_a_l_search.patch 2009-10-18 10:39 AM Kay Kay 28 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-IndexDeleter.patch 2009-10-18 09:21 AM Kay Kay 13 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-iw.patch 2009-10-18 08:49 AM Kay Kay 19 kB &lt;/p&gt;

&lt;p&gt;Thanks Kay Kay!&lt;/p&gt;

&lt;p&gt;At revision: 826527&lt;/p&gt;</comment>
                    <comment id="12767132" author="kaykay.unique" created="Sun, 18 Oct 2009 22:19:08 +0100"  >&lt;p&gt;o.a.lucene.index in src/test &lt;/p&gt;</comment>
                    <comment id="12767133" author="kaykay.unique" created="Sun, 18 Oct 2009 22:22:46 +0100"  >&lt;p&gt;Patch resubmitted confirming to generics code guidelines &lt;/p&gt;</comment>
                    <comment id="12767136" author="thetaphi" created="Sun, 18 Oct 2009 22:36:04 +0100"  >&lt;p&gt;I think test code rewrite is not so important now. I think first I have to remove the rest of the deprecations and fix the test bug (see java-dev mail).&lt;/p&gt;

&lt;p&gt;I ran the compilation with unchecked warnings turned on, only 38 warnings for core. I think the rest in core should be doable now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; JUHU!&lt;/p&gt;</comment>
                    <comment id="12767137" author="kaykay.unique" created="Sun, 18 Oct 2009 22:37:30 +0100"  >&lt;p&gt;IndexFileDeleter&lt;br/&gt;
IndexDeletePolicy &lt;/p&gt;
</comment>
                    <comment id="12767138" author="kaykay.unique" created="Sun, 18 Oct 2009 22:38:46 +0100"  >&lt;blockquote&gt;&lt;p&gt; I think test code rewrite is not so important now. I think first I have to remove the rest of the deprecations and fix the test bug (see java-dev mail).&lt;/p&gt;

&lt;p&gt;I ran the compilation with unchecked warnings turned on, only 38 warnings for core. I think the rest in core should be doable now JUHU!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Ok - Makes sense. It would be nice to get it down to 0 soon..&lt;/p&gt;</comment>
                    <comment id="12767140" author="thetaphi" created="Sun, 18 Oct 2009 22:54:38 +0100"  >&lt;blockquote&gt;&lt;p&gt;IndexFileDeleter, IndexDeletePolicy &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Last patch makes sense, its better to use abstract base class! Committed.&lt;/p&gt;

&lt;p&gt;With generified ThreadLocal I get now 73 warnings, some more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12767141" author="kaykay.unique" created="Sun, 18 Oct 2009 22:57:54 +0100"  >&lt;p&gt;o.a.l.queryParser &lt;/p&gt;</comment>
                    <comment id="12767145" author="kaykay.unique" created="Sun, 18 Oct 2009 23:21:51 +0100"  >&lt;p&gt;Analyzer  (generified ) &lt;/p&gt;

&lt;p&gt;Other Analyzers. &lt;/p&gt;

&lt;p&gt;First cut version of the patch. If Analyzer&amp;lt;T&amp;gt; is ok - then other analyzers can be ported soon to this as well. &lt;/p&gt;</comment>
                    <comment id="12767149" author="thetaphi" created="Sun, 18 Oct 2009 23:28:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;First cut version of the patch. If Analyzer&amp;lt;T&amp;gt; is ok - then other analyzers can be ported soon to this as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s unneeded. Analyzer always return a TokenStream and Tokenizer is a subclass of TokenStream. This makes no sense.&lt;/p&gt;

&lt;p&gt;From your patch, it seems that you want to generify the setPreviousTokenStream method. This shoudl not take Object, it should take TokenStream as param. But this has nothing to do with Java 5.&lt;/p&gt;

&lt;p&gt;Robert Muir knows more, he implemented this caching.&lt;/p&gt;</comment>
                    <comment id="12767152" author="thetaphi" created="Mon, 19 Oct 2009 00:00:45 +0100"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o.a.l.queryParser.patch&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is hard to generify, because parts of the API are provided by javacc. You can only patch the .jj file but only parts not automatically generated by javacc.&lt;/p&gt;

&lt;p&gt;I would keep this classes as they are and maybe update javacc&apos;s param to generate 1.5 code. I will look into this.&lt;/p&gt;</comment>
                    <comment id="12767155" author="thetaphi" created="Mon, 19 Oct 2009 00:23:28 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o.a.l.queryParser.patch&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is hard to generify, because parts of the API are provided by javacc. You can only patch the .jj file but only parts not automatically generated by javacc.&lt;/p&gt;

&lt;p&gt;I would keep this classes as they are and maybe update javacc&apos;s param to generate 1.5 code. I will look into this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I updated the parser generator task to use Java 1.5. If you want to generify the other parts of QueryParser, update the .jj file and regenerate the java files. I will do this tomorrow. Will go to bed now.&lt;/p&gt;</comment>
                    <comment id="12767156" author="rcmuir" created="Mon, 19 Oct 2009 00:23:29 +0100"  >&lt;blockquote&gt;
&lt;p&gt;From your patch, it seems that you want to generify the setPreviousTokenStream method. This shoudl not take Object, it should take TokenStream as param. But this has nothing to do with Java 5.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;check out &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1794&quot; title=&quot;implement reusableTokenStream for all contrib analyzers&quot;&gt;&lt;del&gt;LUCENE-1794&lt;/del&gt;&lt;/a&gt; for some related discussion.&lt;/p&gt;

&lt;p&gt;There are a few things that come to mind:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;for reusable token streams, an analyzer needs to reset the chain: .reset(), but it also needs to call reset(Reader) which is only applicable to Tokenizer. This is why you see private classes like SavedStreams being used.&lt;/li&gt;
	&lt;li&gt;because .tokenStream() takes a fieldname as an argument, some analyzers have special field-specific behavior. To reuse for these analyzers can be more complex, for example QueryAutoStopWordAnalyzer sets/gets a map.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12767157" author="thetaphi" created="Mon, 19 Oct 2009 00:27:20 +0100"  >&lt;p&gt;Robert: Thanks!&lt;/p&gt;

&lt;p&gt;But we should not generify the wole analyzer class just because we have some internal helper API that may be generified. We are OK with casts from Object downto the actual type here. A type param in Analyzer is strange and confusing for outstanding developers.&lt;/p&gt;</comment>
                    <comment id="12767158" author="rcmuir" created="Mon, 19 Oct 2009 00:30:06 +0100"  >&lt;p&gt;Uwe, I agree. I think if we want to improve this reusability in the future, we should look at doing something similar to what Shai Erera proposed, a subclass of Analyzer that does the common SavedStreams behavior.&lt;/p&gt;

&lt;p&gt;But I think Analyzer should still have Object, so the special cases like QueryAutoStopWord can be implemented.&lt;/p&gt;</comment>
                    <comment id="12767160" author="thetaphi" created="Mon, 19 Oct 2009 00:33:35 +0100"  >&lt;p&gt;So we just generify the ThreadLocal to &amp;lt;Object&amp;gt; or &amp;lt;?&amp;gt; and finito. I had that in mind.&lt;/p&gt;

&lt;p&gt;As noted before: the generic type param Kay Kay added has nothing to do with the Analyzer itsself, only with its internal impl. So do not make it public! The Object returning save/get method is just a very special helper. And this down-cast is not &quot;unsafe&quot; as long as you do not reuse the method from somewhere outside of Analyzer.&lt;/p&gt;</comment>
                    <comment id="12767177" author="rcmuir" created="Mon, 19 Oct 2009 01:41:38 +0100"  >&lt;p&gt;updated analysis patch. &lt;br/&gt;
I did not touch StopFilter or StopAnalyzer due to some mixed CharArraySet / Set&amp;lt;String&amp;gt; usage... any ideas on this one Uwe?&lt;/p&gt;</comment>
                    <comment id="12767188" author="kaykay.unique" created="Mon, 19 Oct 2009 02:31:51 +0100"  >&lt;p&gt;Classes affected: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;TermInfosReader&lt;/li&gt;
	&lt;li&gt;SegmentReader&lt;/li&gt;
	&lt;li&gt;FieldsReader&lt;/li&gt;
&lt;/ul&gt;

</comment>
                    <comment id="12767225" author="thetaphi" created="Mon, 19 Oct 2009 07:33:54 +0100"  >&lt;blockquote&gt;&lt;p&gt;I did not touch StopFilter or StopAnalyzer due to some mixed CharArraySet / Set&amp;lt;String&amp;gt; usage... any ideas on this one Uwe? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I am hanging on that, too. See also &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1987&quot; title=&quot;Remove rest of analysis deprecations (Token, CharacterCache)&quot;&gt;&lt;del&gt;LUCENE-1987&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1989&quot; title=&quot;CharArraySet cannot be made generic, because it violates the Set&amp;lt;char[]&amp;gt; interface&quot;&gt;&lt;del&gt;LUCENE-1989&lt;/del&gt;&lt;/a&gt;. As this set needs no type safety (when it is implemented by CharArraySet) it does not matter if the contains methods uses char[] or String or even Object. It always compares the string representation of the tested value. As CharArraySet is defined as Set&amp;lt;Object&amp;gt;, we should define all these as Set&amp;lt;Object&amp;gt; in StopFilter. Or declare them as CharArraySet and convert the anonyous Set&amp;lt;?&amp;gt; to CharArraySet in the ctor (I would prefer this).&lt;/p&gt;</comment>
                    <comment id="12767240" author="thetaphi" created="Mon, 19 Oct 2009 09:08:00 +0100"  >&lt;p&gt;I removed some unneeded patches.&lt;/p&gt;</comment>
                    <comment id="12767241" author="thetaphi" created="Mon, 19 Oct 2009 09:14:59 +0100"  >&lt;p&gt;Comitted:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-CloseableThreadLocal.patch 2009-10-18 06:31 PM Kay Kay 4 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_analysis.patch 2009-10-18 05:41 PM Robert Muir 8 kB &lt;/p&gt;

&lt;p&gt;At revision: 826601&lt;/p&gt;</comment>
                    <comment id="12767242" author="thetaphi" created="Mon, 19 Oct 2009 09:20:54 +0100"  >&lt;p&gt;One note: I do not want to apply any test-related generics patches, as it makes it harder to port patches to the backwards branch currently.&lt;br/&gt;
As soon as all deprecations are removed, we could start with fixing the tests. Before removing all deprecations it may often be needed to also apply changes to the backwards branch, which is Java 1.4 for backwards testing with 2.9.&lt;/p&gt;</comment>
                    <comment id="12767533" author="kaykay.unique" created="Mon, 19 Oct 2009 21:47:13 +0100"  >&lt;ul&gt;
	&lt;li&gt;FieldValueHitQueue&lt;/li&gt;
	&lt;li&gt;TopDocsCollector&lt;/li&gt;
	&lt;li&gt;TopScoreDocsCollector&lt;/li&gt;
	&lt;li&gt;TopFieldHitsCollector&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12767599" author="thetaphi" created="Mon, 19 Oct 2009 23:55:42 +0100"  >&lt;p&gt;better generification of MultiTermQueryWrapperFilter (no more casts in sub-classes).&lt;/p&gt;</comment>
                    <comment id="12767603" author="thetaphi" created="Mon, 19 Oct 2009 23:59:21 +0100"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-MTQWF.patch 2009-10-19 10:55 PM Uwe Schindler 5 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-TopDocsCollector.patch 2009-10-19 08:47 PM Kay Kay 8 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;-FieldCacheImpl.patch 2009-10-19 08:23 PM Kay Kay 8 kB &lt;/p&gt;

&lt;p&gt;(with some modifications in FieldCacheImpl, where Class was not generified to Class&amp;lt;?&amp;gt;).&lt;/p&gt;

&lt;p&gt;At revision: 826857&lt;/p&gt;</comment>
                    <comment id="12767611" author="kaykay.unique" created="Tue, 20 Oct 2009 00:27:06 +0100"  >&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; I updated the parser generator task to use Java 1.5. If you want to generify the other parts of QueryParser, update the .jj file and regenerate the java files. I will do this tomorrow. Will go to bed now.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;What&apos;s the version of javacc being used/suggested currently ( the latest release seems to be 5.0 ) .&lt;/p&gt;</comment>
                    <comment id="12767615" author="thetaphi" created="Tue, 20 Oct 2009 00:41:32 +0100"  >&lt;p&gt;FieldCacheRangeFilter generified + type safe accessor methods.&lt;/p&gt;

&lt;p&gt;Committed revision: 826883&lt;/p&gt;</comment>
                    <comment id="12767617" author="thetaphi" created="Tue, 20 Oct 2009 00:43:44 +0100"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s the version of javacc being used/suggested currently ( the latest release seems to be 5.0 ) .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;From BUILD.txt&lt;/b&gt; (I suggest to use this version 4.1, e.g. 4.2 has a bug that corrupts the parser somehow):&lt;/p&gt;

&lt;p&gt;Step 3) Install JavaCC&lt;/p&gt;

&lt;p&gt;Building the Lucene distribution from the source does not require the JavaCC&lt;br/&gt;
parser generator, but if you wish to regenerate any of the pre-generated&lt;br/&gt;
parser pieces, you will need to install JavaCC. Version 4.1 is tested to&lt;br/&gt;
work correctly.&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://javacc.dev.java.net&quot; class=&quot;external-link&quot;&gt;http://javacc.dev.java.net&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Follow the download links and download the zip file to a temporary&lt;br/&gt;
location on your file system.&lt;/p&gt;

&lt;p&gt;After JavaCC is installed, create a build.properties file&lt;br/&gt;
(as in step 2), and add the line&lt;/p&gt;

&lt;p&gt;  javacc.home=/javacc&lt;/p&gt;

&lt;p&gt;where this points to the root directory of your javacc installation&lt;br/&gt;
(the directory that contains bin/lib/javacc.jar).&lt;/p&gt;</comment>
                    <comment id="12767618" author="kaykay.unique" created="Tue, 20 Oct 2009 00:45:32 +0100"  >&lt;p&gt;QueryParser.jj patch separately for generics &lt;/p&gt;</comment>
                    <comment id="12767621" author="kaykay.unique" created="Tue, 20 Oct 2009 00:50:30 +0100"  >&lt;p&gt;MultiFieldQueryParser &lt;/p&gt;</comment>
                    <comment id="12767630" author="kaykay.unique" created="Tue, 20 Oct 2009 01:06:20 +0100"  >&lt;p&gt;common-build.xml , build comments match those in build.txt &lt;/p&gt;</comment>
                    <comment id="12767852" author="thetaphi" created="Tue, 20 Oct 2009 17:07:19 +0100"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_javacc_upgrade.patch 2009-10-20 12:06 AM Kay Kay 0.8 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_MultiFieldQueryParser.patch 2009-10-19 11:50 PM Kay Kay 3 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_queryParser_jj.patch 2009-10-19 11:45 PM Kay Kay 6 kB &lt;/p&gt;

&lt;p&gt;Also removed deprecated API from QueryParser.&lt;/p&gt;

&lt;p&gt;At revision: 827717&lt;/p&gt;</comment>
                    <comment id="12767930" author="kaykay.unique" created="Tue, 20 Oct 2009 21:34:36 +0100"  >&lt;p&gt;Remove unnecessary cast across the codebase (as a result of generification) &lt;/p&gt;</comment>
                    <comment id="12767953" author="thetaphi" created="Tue, 20 Oct 2009 22:45:30 +0100"  >&lt;p&gt;Thanks! Much cleaner code. &amp;#8211; Committed revision: 827811&lt;/p&gt;</comment>
                    <comment id="12767965" author="dmsmith" created="Tue, 20 Oct 2009 23:02:41 +0100"  >&lt;p&gt;Migrates to Java 5 enums in core and contrib. All tests pass.&lt;br/&gt;
Deprecates o.a.l.util.Parameter. It probably can be removed.&lt;/p&gt;</comment>
                    <comment id="12767977" author="thetaphi" created="Tue, 20 Oct 2009 23:17:15 +0100"  >&lt;p&gt;DM Smith: Can you open a new issue. This is more complicated because of backwards compatibility, so a separate issue would be great.&lt;/p&gt;

&lt;p&gt;I like your code rewrite (it could even be done with Parameter in the same way). By the way: Java5&apos;s Enum is also Serializable, so no problem.&lt;/p&gt;</comment>
                    <comment id="12767986" author="dmsmith" created="Tue, 20 Oct 2009 23:31:25 +0100"  >&lt;p&gt;I&apos;ve moved the patch for Java 5 enums to its own issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1998&quot; title=&quot;Use Java 5 enums&quot;&gt;&lt;del&gt;LUCENE-1998&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12768136" author="thetaphi" created="Wed, 21 Oct 2009 09:48:54 +0100"  >&lt;p&gt;Created a new issue out of clone invariance patch: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2000&quot; title=&quot;Use covariant clone() return types&quot;&gt;&lt;del&gt;LUCENE-2000&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12768234" author="thetaphi" created="Wed, 21 Oct 2009 14:39:47 +0100"  >&lt;p&gt;Committed:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_more_unnecessary_casts.patch&lt;/li&gt;
	&lt;li&gt;Remove the rest of unchecked warnings. I added a TODO, where I do not understand the code and not for sure know, whats inside the collections. This could be fixed some time later. But the core code now compiles without any unchecked warning.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Revision: 828011&lt;/p&gt;</comment>
                    <comment id="12769186" author="thetaphi" created="Fri, 23 Oct 2009 12:54:36 +0100"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_benchmark.patch 2009-10-22 05:53 PM Kay Kay 56 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_unnnecessary_casts_2.patch 2009-10-22 08:16 PM Kay Kay 22 kB &lt;/p&gt;

&lt;p&gt;Revision: 829013&lt;/p&gt;

&lt;p&gt;With the highlighter patch I will wait until &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2003&quot; title=&quot;Highlighter has problems when you use StandardAnalyzer with LUCENE_29 or simplier StopFilter with stopWordsPosIncr mode switched on&quot;&gt;&lt;del&gt;LUCENE-2003&lt;/del&gt;&lt;/a&gt; is done to not break the patch of Mark.&lt;/p&gt;</comment>
                    <comment id="12769778" author="thetaphi" created="Sun, 25 Oct 2009 10:16:50 +0000"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_benchmark_2.patch 2009-10-23 03:36 PM Kay Kay 22 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_highlighting.patch &lt;/p&gt;

&lt;p&gt;Kay Kay, if you want usage of Class.forName() correct generics without casts, you have to do it that way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
MyClass instance = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(nameOfClassToInstantiate).asSubclass(MyClass.class).newInstance()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same applies to other usages of Class&amp;lt;?&amp;gt;. I modified your benchmark changes to do this pattern.&lt;/p&gt;

&lt;p&gt;Revision: 829524&lt;/p&gt;</comment>
                    <comment id="12769827" author="kaykay.unique" created="Sun, 25 Oct 2009 14:25:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I modified your benchmark changes to do this pattern.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the heads up. Future patches take care of the same. &lt;/p&gt;</comment>
                    <comment id="12771194" author="thetaphi" created="Wed, 28 Oct 2009 23:24:00 +0000"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_precendence_parser.patch 2009-10-25 02:35 PM Kay Kay 9 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_misc.patch 2009-10-25 02:24 PM Kay Kay 18 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_memory.patch 2009-10-25 02:02 PM Kay Kay 26 kB &lt;/p&gt;

&lt;p&gt;I had to fix some small things (one extended for-loop removed, because loop variable had to be global). Also moved the AnalyzerUtil/SynonyMap to wordnet contrib (see &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1904&quot; title=&quot;move wordnet based synonym code out of contrib/memory and into contrib/wordnet (or somewhere else)&quot;&gt;&lt;del&gt;LUCENE-1904&lt;/del&gt;&lt;/a&gt;). Also converted the stop words in PatternAnalyzer to CharArraySet/Set&amp;lt;?&amp;gt; like in other analyzers.&lt;/p&gt;

&lt;p&gt;At revision: 830790&lt;/p&gt;</comment>
                    <comment id="12771454" author="rcmuir" created="Thu, 29 Oct 2009 15:51:14 +0000"  >&lt;p&gt;generics patch for smartcn. &lt;/p&gt;

&lt;p&gt;type safety is useful here, it found a problem in the javadocs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12771642" author="thetaphi" created="Thu, 29 Oct 2009 21:50:44 +0000"  >&lt;p&gt;Robert: I think you can commit it yourself, I am away now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Looks good on a diagonal view... Even you have the stopwords set with &amp;lt;?&amp;gt; - like everywhere else. I trust you!&lt;/p&gt;</comment>
                    <comment id="12771643" author="rcmuir" created="Thu, 29 Oct 2009 21:55:01 +0000"  >&lt;p&gt;Uwe, thanks for taking a look. i think theres some complex hashmaps mapping Integer to ArrayList where i could have used ? extends List instead of ArrayList, but its internally used anyway, so I didn&apos;t bother.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit the patch shortly.&lt;/p&gt;</comment>
                    <comment id="12771662" author="rcmuir" created="Thu, 29 Oct 2009 22:30:49 +0000"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_smartcn.patch, revision 831121.&lt;/p&gt;</comment>
                    <comment id="12775073" author="kaykay.unique" created="Mon, 9 Nov 2009 18:57:29 +0000"  >&lt;p&gt;generics patch for a couple of files &lt;/p&gt;</comment>
                    <comment id="12775251" author="rcmuir" created="Tue, 10 Nov 2009 02:11:26 +0000"  >&lt;p&gt;contrib/swing,contrib/wikipedia,contrib/wordnet,contrib/xml-query-parser&lt;/p&gt;</comment>
                    <comment id="12775366" author="thetaphi" created="Tue, 10 Nov 2009 10:18:41 +0000"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_swing_wikipedia_wordnet_xmlqp.patch 2009-11-10 02:11 AM Robert Muir 24 kB &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_o_a_l_demo.patch 2009-11-09 06:57 PM Kay Kay 1 kB &lt;/p&gt;

&lt;p&gt;At revision: 834414&lt;/p&gt;</comment>
                    <comment id="12776125" author="kaykay.unique" created="Tue, 10 Nov 2009 22:33:17 +0000"  >&lt;p&gt;lucli  generics &lt;/p&gt;</comment>
                    <comment id="12776143" author="simonw" created="Tue, 10 Nov 2009 23:09:29 +0000"  >&lt;p&gt;I revised this patch and did some minor cleanups in lucil. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Changed while(iterator.hasNext()) to java 5 loops.&lt;/li&gt;
	&lt;li&gt;added suppress warnings&lt;/li&gt;
	&lt;li&gt;changed some sysouts to messag()&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12776155" author="rcmuir" created="Tue, 10 Nov 2009 23:17:59 +0000"  >&lt;p&gt;simon, cool, I think it would be good if we were consistent with generics formatting tho:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public static &amp;lt;K, V extends Comparable&amp;lt;V&amp;gt;&amp;gt; Map.Entry&amp;lt;K,V&amp;gt;[]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it should be K,V with no space?&lt;/p&gt;</comment>
                    <comment id="12776157" author="thetaphi" created="Tue, 10 Nov 2009 23:23:15 +0000"  >&lt;p&gt;I think for such complex thing, sometimes spaces may be good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But for the typical &amp;lt;K,V&amp;gt;, &amp;lt;String,String&amp;gt; and so on it is hard. There are already some in AttributeSource like this.&lt;/p&gt;

&lt;p&gt;By the way, I uploaded a new Eclipse code style during ApacheCon to wiki.&lt;/p&gt;</comment>
                    <comment id="12776161" author="thetaphi" created="Tue, 10 Nov 2009 23:25:27 +0000"  >&lt;p&gt;Oh god:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;K, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Comparable&amp;lt;V&amp;gt;&amp;gt; Map.Entry&amp;lt;K,V&amp;gt;[]
+    getSortedMapEntries(Map&amp;lt;K,V&amp;gt; m) {
+    Set&amp;lt;Map.Entry&amp;lt;K, V&amp;gt;&amp;gt; set = m.entrySet();
+    Map.Entry&amp;lt;K,V&amp;gt;[] entries =
+       set.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Map.Entry[set.size()]);
+    Arrays.sort(entries, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Comparator&amp;lt;Map.Entry&amp;lt;K,V&amp;gt;&amp;gt;() {
+      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare(Map.Entry&amp;lt;K, V&amp;gt; o1, Map.Entry&amp;lt;K, V&amp;gt; o2) {
+        V v1 = o1.getValue();
+        V v2 = o2.getValue();
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; v2.compareTo(v1); &lt;span class=&quot;code-comment&quot;&gt;//descending order&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What&apos;s that &lt;b&gt;g&lt;/b&gt;. It needs suppress warnings because of the array creation?&lt;/p&gt;</comment>
                    <comment id="12776166" author="rcmuir" created="Tue, 10 Nov 2009 23:27:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think for such complex thing, sometimes spaces may be good But for the typical &amp;lt;K,V&amp;gt;, &amp;lt;String,String&amp;gt; and so on it is hard. There are already some in AttributeSource like this. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Simon/Uwe I wasn&apos;t trying to be picky, more for my own knowledge.&lt;br/&gt;
Contrib formatting is insanity anyway, so I don&apos;t object to any patch that introduces type safety &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12776180" author="kaykay.unique" created="Wed, 11 Nov 2009 00:02:16 +0000"  >&lt;p&gt;I am not sure what the consensus w.r.t warnings are - but as much as possible leaving out SuppressWarnings would be better so that it is transparent in the future to address should the dependent library change. &lt;/p&gt;
</comment>
                    <comment id="12776183" author="thetaphi" created="Wed, 11 Nov 2009 00:05:58 +0000"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_lucil.patch 2009-11-10 11:09 PM Simon Willnauer 11 kB &lt;/p&gt;

&lt;p&gt;At revision: 834720 - Thanks Simon &amp;amp; Kay&lt;/p&gt;</comment>
                    <comment id="12776184" author="thetaphi" created="Wed, 11 Nov 2009 00:08:21 +0000"  >&lt;p&gt;Kay Kay: We only have SuppressWarnings at some places in core, marked with a big TODO (will be done when flex indeixng comes). The &quot;wanted&quot; @SuppressWarnings are only at places, where generic Arrays are created. There is no way to fix this (see Sun Generics Howto).&lt;/p&gt;</comment>
                    <comment id="12776239" author="kaykay.unique" created="Wed, 11 Nov 2009 02:04:38 +0000"  >&lt;p&gt;contrib ant&lt;/p&gt;</comment>
                    <comment id="12776241" author="rcmuir" created="Wed, 11 Nov 2009 02:15:28 +0000"  >&lt;p&gt;generics in benchmark, spellcheck, spatial, snowball, and queries.&lt;br/&gt;
i didn&apos;t finish MoreLikeThis in contrib/queries so it still needs to be done.&lt;/p&gt;</comment>
                    <comment id="12776376" author="rcmuir" created="Wed, 11 Nov 2009 08:33:10 +0000"  >&lt;p&gt;I replace my previous patch with this much larger patch.&lt;/p&gt;

&lt;p&gt;some of it is autogen but I reviewed/corrected&lt;/p&gt;</comment>
                    <comment id="12776429" author="thetaphi" created="Wed, 11 Nov 2009 12:14:36 +0000"  >&lt;p&gt;I removed also the suppresswarnings and generified TermsHash code. I also added more generics to the changes you already did (because Eclipse is not able to automatically add generics inside generics, e.g. Map&amp;lt;X,Collection&amp;lt;Y&amp;gt;&amp;gt;).&lt;/p&gt;

&lt;p&gt;This patch also contains the ant task.&lt;/p&gt;

&lt;p&gt;Will commit, when all tests finished.&lt;/p&gt;</comment>
                    <comment id="12776430" author="thetaphi" created="Wed, 11 Nov 2009 12:20:01 +0000"  >&lt;p&gt;Committed:&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_heavy.patch 2009-11-11 12:14 PM Uwe Schindler 69 kB (contains &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;_contrib_ant.patch)&lt;/p&gt;

&lt;p&gt;At revision: 834847 - Thanks Robert, Kay, me&lt;/p&gt;</comment>
                    <comment id="12777419" author="thetaphi" created="Fri, 13 Nov 2009 08:24:47 +0000"  >&lt;p&gt;Robert: Is there anything else in contrib to convert? If no, I would close this issue for now.&lt;/p&gt;

&lt;p&gt;If we find further Java5 conversions after release of 3.0, we can open new issues.&lt;/p&gt;</comment>
                    <comment id="12777449" author="rcmuir" created="Fri, 13 Nov 2009 11:01:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we find further Java5 conversions after release of 3.0, we can open new issues.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Uwe, I agree, I think you should close the issue.&lt;/p&gt;</comment>
                    <comment id="12777454" author="simonw" created="Fri, 13 Nov 2009 11:12:21 +0000"  >&lt;p&gt;We gonna reopen it in 3.0 anyway so just go ahead and close for now!&lt;/p&gt;</comment>
                    <comment id="12777466" author="thetaphi" created="Fri, 13 Nov 2009 11:39:29 +0000"  >&lt;p&gt;Closed for 3.0. Further updates of tests and internal APIs may follow for 3.1 in a new issue.&lt;/p&gt;</comment>
                    <comment id="12777731" author="kaykay.unique" created="Fri, 13 Nov 2009 23:16:21 +0000"  >&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Further updates of tests and internal APIs may follow for 3.1 in a new issue&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt; 	 &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2065&quot; title=&quot;Java 5 port phase II &quot;&gt;&lt;del&gt;LUCENE-2065&lt;/del&gt;&lt;/a&gt; in place for 3.1 to address remaining changes.  &lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                <outwardlinks description="incorporates">
                            <issuelink>
            <issuekey id="12438247">LUCENE-1984</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12433624">LUCENE-1833</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12436986">LUCENE-1933</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12433987">LUCENE-1855</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12433994">LUCENE-1857</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12438632">LUCENE-1998</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12437015">LUCENE-1935</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12438673">LUCENE-2000</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12421198" name="instantiated_fieldable.patch" size="4581" author="karl.wettin" created="Sat, 3 Oct 2009 14:21:38 +0100" />
                    <attachment id="12422516" name="LUCENE-1257_analysis.patch" size="7952" author="rcmuir" created="Mon, 19 Oct 2009 01:41:38 +0100" />
                    <attachment id="12422431" name="LUCENE-1257_BooleanFilter_Generics.patch" size="3802" author="kaykay.unique" created="Sat, 17 Oct 2009 07:52:08 +0100" />
                    <attachment id="12422444" name="LUCENE-1257-BooleanQuery.patch" size="5197" author="kaykay.unique" created="Sat, 17 Oct 2009 09:31:56 +0100" />
                    <attachment id="12422445" name="LUCENE-1257-BooleanScorer_2.patch" size="4130" author="kaykay.unique" created="Sat, 17 Oct 2009 09:39:31 +0100" />
                    <attachment id="12422440" name="LUCENE-1257-BufferedDeletes_DocumentsWriter.patch" size="5593" author="kaykay.unique" created="Sat, 17 Oct 2009 08:44:34 +0100" />
                    <attachment id="12422452" name="LUCENE-1257-CheckIndex.patch" size="5924" author="kaykay.unique" created="Sat, 17 Oct 2009 16:48:38 +0100" />
                    <attachment id="12422517" name="LUCENE-1257-CloseableThreadLocal.patch" size="3927" author="kaykay.unique" created="Mon, 19 Oct 2009 02:31:51 +0100" />
                    <attachment id="12422453" name="LUCENE-1257-CompoundFileReaderWriter.patch" size="3096" author="kaykay.unique" created="Sat, 17 Oct 2009 16:52:40 +0100" />
                    <attachment id="12422454" name="LUCENE-1257-ConcurrentMergeScheduler.patch" size="1675" author="kaykay.unique" created="Sat, 17 Oct 2009 16:56:10 +0100" />
                    <attachment id="12424552" name="LUCENE-1257_contrib_ant.patch" size="2106" author="kaykay.unique" created="Wed, 11 Nov 2009 02:04:38 +0000" />
                    <attachment id="12423024" name="LUCENE-1257_contrib_benchmark_2.patch" size="22644" author="kaykay.unique" created="Fri, 23 Oct 2009 16:36:41 +0100" />
                    <attachment id="12422914" name="LUCENE-1257_contrib_benchmark.patch" size="57075" author="kaykay.unique" created="Thu, 22 Oct 2009 18:53:09 +0100" />
                    <attachment id="12422739" name="LUCENE-1257_contrib_highlighting.patch" size="26343" author="kaykay.unique" created="Tue, 20 Oct 2009 23:16:46 +0100" />
                    <attachment id="12423143" name="LUCENE-1257_contrib_memory.patch" size="26802" author="kaykay.unique" created="Sun, 25 Oct 2009 14:02:30 +0000" />
                    <attachment id="12423145" name="LUCENE-1257_contrib_misc.patch" size="17962" author="kaykay.unique" created="Sun, 25 Oct 2009 14:24:39 +0000" />
                    <attachment id="12423588" name="LUCENE-1257_contrib_smartcn.patch" size="15403" author="rcmuir" created="Thu, 29 Oct 2009 15:51:14 +0000" />
                    <attachment id="12422456" name="LUCENE-1257-DirectoryReader.patch" size="8489" author="kaykay.unique" created="Sat, 17 Oct 2009 17:12:44 +0100" />
                    <attachment id="12422388" name="LUCENE-1257-DisjunctionMaxQuery-more_type_safety.patch" size="2002" author="kaykay.unique" created="Fri, 16 Oct 2009 19:42:25 +0100" />
                    <attachment id="12422457" name="LUCENE-1257-DocFieldProcessorPerThread.patch" size="4055" author="kaykay.unique" created="Sat, 17 Oct 2009 17:40:27 +0100" />
                    <attachment id="12421174" name="LUCENE-1257-Document.patch" size="5601" author="thetaphi" created="Sat, 3 Oct 2009 00:21:41 +0100" />
                    <attachment id="12422605" name="LUCENE-1257-FieldCacheImpl.patch" size="8617" author="kaykay.unique" created="Mon, 19 Oct 2009 21:23:49 +0100" />
                    <attachment id="12422627" name="LUCENE-1257-FieldCacheRangeFilter.patch" size="16531" author="thetaphi" created="Tue, 20 Oct 2009 00:41:32 +0100" />
                    <attachment id="12424600" name="LUCENE-1257_heavy.patch" size="70524" author="thetaphi" created="Wed, 11 Nov 2009 12:14:36 +0000" />
                    <attachment id="12424583" name="LUCENE-1257_heavy.patch" size="60804" author="rcmuir" created="Wed, 11 Nov 2009 08:33:10 +0000" />
                    <attachment id="12422488" name="LUCENE-1257-IndexDeleter.patch" size="13319" author="kaykay.unique" created="Sun, 18 Oct 2009 17:21:53 +0100" />
                    <attachment id="12422505" name="LUCENE-1257-IndexDeletionPolicy_IndexFileDeleter.patch" size="4841" author="kaykay.unique" created="Sun, 18 Oct 2009 22:37:30 +0100" />
                    <attachment id="12422485" name="LUCENE-1257-iw.patch" size="19638" author="kaykay.unique" created="Sun, 18 Oct 2009 16:49:50 +0100" />
                    <attachment id="12422635" name="LUCENE-1257_javacc_upgrade.patch" size="815" author="kaykay.unique" created="Tue, 20 Oct 2009 01:06:20 +0100" />
                    <attachment id="12424528" name="LUCENE-1257_lucil.patch" size="10800" author="simonw" created="Tue, 10 Nov 2009 23:09:29 +0000" />
                    <attachment id="12424522" name="LUCENE-1257_lucli.patch" size="8567" author="kaykay.unique" created="Tue, 10 Nov 2009 22:33:17 +0000" />
                    <attachment id="12421205" name="LUCENE-1257_messages.patch" size="19525" author="rcmuir" created="Sat, 3 Oct 2009 16:14:22 +0100" />
                    <attachment id="12422723" name="LUCENE-1257_more_unnecessary_casts.patch" size="2786" author="kaykay.unique" created="Tue, 20 Oct 2009 22:30:55 +0100" />
                    <attachment id="12422624" name="LUCENE-1257-MTQWF.patch" size="5513" author="thetaphi" created="Mon, 19 Oct 2009 23:55:42 +0100" />
                    <attachment id="12422629" name="LUCENE-1257_MultiFieldQueryParser.patch" size="3393" author="kaykay.unique" created="Tue, 20 Oct 2009 00:50:30 +0100" />
                    <attachment id="12422438" name="LUCENE-1257-NormalizeCharMap.patch" size="1037" author="kaykay.unique" created="Sat, 17 Oct 2009 08:15:20 +0100" />
                    <attachment id="12424383" name="LUCENE-1257_o_a_l_demo.patch" size="1165" author="kaykay.unique" created="Mon, 9 Nov 2009 18:57:29 +0000" />
                    <attachment id="12422503" name="LUCENE-1257_o_a_l_index_test.patch" size="56097" author="kaykay.unique" created="Sun, 18 Oct 2009 22:22:46 +0100" />
                    <attachment id="12422502" name="LUCENE-1257_o_a_l_index_test.patch" size="56102" author="kaykay.unique" created="Sun, 18 Oct 2009 22:19:08 +0100" />
                    <attachment id="12422509" name="LUCENE-1257_o.a.l.queryParser.patch" size="8464" author="kaykay.unique" created="Sun, 18 Oct 2009 22:57:54 +0100" />
                    <attachment id="12422489" name="LUCENE-1257_o_a_l_search.patch" size="28495" author="kaykay.unique" created="Sun, 18 Oct 2009 18:39:05 +0100" />
                    <attachment id="12422491" name="LUCENE-1257_o_a_l_search_spans.patch" size="16766" author="kaykay.unique" created="Sun, 18 Oct 2009 18:52:28 +0100" />
                    <attachment id="12422493" name="LUCENE-1257_o.a.l.store.patch" size="11897" author="kaykay.unique" created="Sun, 18 Oct 2009 19:04:38 +0100" />
                    <attachment id="12422501" name="LUCENE-1257-o.a.l.util.patch" size="10282" author="kaykay.unique" created="Sun, 18 Oct 2009 21:15:28 +0100" />
                    <attachment id="12422500" name="LUCENE-1257-org_apache_lucene_document.patch" size="29890" author="kaykay.unique" created="Sun, 18 Oct 2009 20:42:13 +0100" />
                    <attachment id="12422487" name="LUCENE-1257-org_apache_lucene_document.patch" size="29932" author="thetaphi" created="Sun, 18 Oct 2009 17:19:43 +0100" />
                    <attachment id="12422484" name="LUCENE-1257-org_apache_lucene_document.patch" size="24884" author="kaykay.unique" created="Sun, 18 Oct 2009 15:55:32 +0100" />
                    <attachment id="12422476" name="LUCENE-1257_org_apache_lucene_index.patch" size="59978" author="thetaphi" created="Sun, 18 Oct 2009 10:28:11 +0100" />
                    <attachment id="12422472" name="LUCENE-1257_org_apache_lucene_index.patch" size="59758" author="kaykay.unique" created="Sun, 18 Oct 2009 06:04:38 +0100" />
                    <attachment id="12423146" name="LUCENE-1257_precendence_parser.patch" size="9632" author="kaykay.unique" created="Sun, 25 Oct 2009 14:35:06 +0000" />
                    <attachment id="12422628" name="LUCENE-1257_queryParser_jj.patch" size="5824" author="kaykay.unique" created="Tue, 20 Oct 2009 00:45:32 +0100" />
                    <attachment id="12422443" name="LUCENE-1257-SegmentInfos.patch" size="6437" author="kaykay.unique" created="Sat, 17 Oct 2009 08:59:44 +0100" />
                    <attachment id="12421162" name="LUCENE-1257-StringBuffer.patch" size="103215" author="thetaphi" created="Fri, 2 Oct 2009 23:06:08 +0100" />
                    <attachment id="12421158" name="LUCENE-1257-StringBuffer.patch" size="102873" author="thetaphi" created="Fri, 2 Oct 2009 22:46:11 +0100" />
                    <attachment id="12421074" name="LUCENE-1257-StringBuffer.patch" size="137004" author="thetaphi" created="Thu, 1 Oct 2009 23:22:56 +0100" />
                    <attachment id="12421193" name="lucene1257surround1.patch" size="6904" author="thetaphi" created="Sat, 3 Oct 2009 12:33:56 +0100" />
                    <attachment id="12421192" name="lucene1257surround1.patch" size="6357" author="paul.elschot@xs4all.nl" created="Sat, 3 Oct 2009 12:08:28 +0100" />
                    <attachment id="12424429" name="LUCENE-1257_swing_wikipedia_wordnet_xmlqp.patch" size="24967" author="rcmuir" created="Tue, 10 Nov 2009 02:11:26 +0000" />
                    <attachment id="12422609" name="LUCENE-1257-TopDocsCollector.patch" size="7998" author="kaykay.unique" created="Mon, 19 Oct 2009 21:47:13 +0100" />
                    <attachment id="12422713" name="LUCENE-1257_unnecessary_casts.patch" size="21156" author="kaykay.unique" created="Tue, 20 Oct 2009 21:34:36 +0100" />
                    <attachment id="12422942" name="LUCENE-1257_unnnecessary_casts_2.patch" size="22872" author="kaykay.unique" created="Thu, 22 Oct 2009 21:16:23 +0100" />
                    <attachment id="12422437" name="LUCENE-1257-WordListLoader.patch" size="2731" author="kaykay.unique" created="Sat, 17 Oct 2009 08:11:22 +0100" />
                    <attachment id="12421197" name="shinglematrixfilter_generified.patch" size="12258" author="karl.wettin" created="Sat, 3 Oct 2009 14:14:03 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>63.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 1 Oct 2009 13:29:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12491</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26471</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>