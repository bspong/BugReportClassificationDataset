<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:24:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3643/LUCENE-3643.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3643] Improve FilteredQuery to shortcut on wrapped MatchAllDocsQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3643</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Since the rewrite of Lucene trunk to delegate all Filter logic to FilteredQuery, by simply wrapping in IndexSearcher.wrapFilter(), we can do more short circuits and improve query execution. A common use case it to pass MatchAllDocsQuery as query to IndexSearcher and a filter. For the underlying hit collection this is stupid and slow, as MatchAllDocsQuery simply increments the docID and checks acceptDocs. If the filter is sparse, this is a big waste. This patch changes FilteredQuery.rewrite() to short circuit and return ConstantScoreQuery, if the query is MatchAllDocs.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12534806">LUCENE-3643</key>
            <summary>Improve FilteredQuery to shortcut on wrapped MatchAllDocsQuery</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Dec 2011 16:45:16 +0000</created>
                <updated>Fri, 10 May 2013 11:44:25 +0100</updated>
                    <resolved>Tue, 13 Dec 2011 16:33:51 +0000</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13167588" author="thetaphi" created="Mon, 12 Dec 2011 16:46:38 +0000"  >&lt;p&gt;Patch for trunk.&lt;/p&gt;

&lt;p&gt;It also adds tests that checks for correctly rewritten queries with correct boosts (it assigns random boosts and checks the resulting query&apos;s boost).&lt;/p&gt;</comment>
                    <comment id="13167595" author="thetaphi" created="Mon, 12 Dec 2011 16:49:24 +0000"  >&lt;p&gt;With this patch applied, it&apos;s now also possible to search directly on IndexSearcher with only a filter given:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TopDocs topDocs = searcher.search(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, filter, topN);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13167654" author="thetaphi" created="Mon, 12 Dec 2011 18:33:48 +0000"  >&lt;p&gt;Improved patch with more documentation in FilteredQuery.rewrite() and easier if/then/else checks (+ asserts).&lt;/p&gt;

&lt;p&gt;Also added some more javadocs.&lt;/p&gt;

&lt;p&gt;This cannot be backported to 3.x, because:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In 3.x Filters are not required to only contain non-deleted documents (in trunk, they must respect non-null acceptDocs). As ConstantScoreQuery does not enforce deleted documents the optimization may return wrong results (MatchAllDocs is required)&lt;/li&gt;
	&lt;li&gt;The API of IndexSearcher cannot be modified, so wrapFilter() is not available there. IS delegates hit collection to FilteredQuery, but it does not rewrite Filter+Query to FilteredQuery.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is ready to commit.&lt;/p&gt;</comment>
                    <comment id="13167851" author="rcmuir" created="Mon, 12 Dec 2011 22:04:44 +0000"  >&lt;p&gt;Hi Uwe, I think the patch looks great.&lt;/p&gt;

&lt;p&gt;I just have one question, should we really advertise that you can pass a null Query to IndexSearcher?&lt;/p&gt;

&lt;p&gt;I&apos;m not saying I&apos;m against it, but maybe we should think about it... because then maybe someone&lt;br/&gt;
says its strange they can&apos;t have a null query and null filter with a Sort.&lt;/p&gt;

&lt;p&gt;If FilteredQuery optimizes the MatchAllDocsCase behind the scenes anyway, what is the harm in keeping&lt;br/&gt;
the current semantics?&lt;/p&gt;</comment>
                    <comment id="13167866" author="thetaphi" created="Mon, 12 Dec 2011 22:18:29 +0000"  >&lt;p&gt;Here a more simplified rewrite. As rewrite is  running in a loop &quot;while (query != query.rewrite())&quot;, we don&apos;t need to do everything on first pass. The special cases are simply expanded only on the not rewritten inner query, otherwise a new FilteredQuery is created. The second pass may rewrite the inner query.&lt;/p&gt;</comment>
                    <comment id="13167872" author="thetaphi" created="Mon, 12 Dec 2011 22:21:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;I just have one question, should we really advertise that you can pass a null Query to IndexSearcher?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I heard this question quite often, how to execute a solely Filter without query. As the current API allows filter==null, why not the same for the query. Passing null as filter and query of course makes no real sense, so I don&apos;t expect this question.&lt;/p&gt;

&lt;p&gt;I think it is harder for people to explain them that they must a) either wrap the Filter with CSQ or b) must pass a MatchAllDocsQuery. If you tell them, just call IndexSearcher.search() and pass either filter, query or both, then it&apos;s much easier.&lt;/p&gt;</comment>
                    <comment id="13168263" author="thetaphi" created="Tue, 13 Dec 2011 09:45:13 +0000"  >&lt;p&gt;Here 2 patch variants:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;allowNullQueryFilter.patch is the same patch as before, with some rewrite() improvements for more clarity, but it allows null Query and null Filter and so does IndexSearcher.&lt;/li&gt;
	&lt;li&gt;noNullQueryFilter.patch is a simplier patch, disallowing null filters and null queries, so IndexSaercher behaves as before. The only optimization is to rewrite the MatchAllDocs+Filter combination to CSQ with combined boost.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After sleeping one night about it, I think we should start with the latter patch and maybe think about allowing a null query in IndexSearcher separately in another issue. In my opinion, the null special case should maybe done inside IS.wrapFilter. Allowing null as query or filter in FilteredQuery makes no sense and adds complexity.&lt;/p&gt;</comment>
                    <comment id="13168483" author="thetaphi" created="Tue, 13 Dec 2011 16:31:27 +0000"  >&lt;p&gt;I will commit the noBullQuerFilter.patch soon!&lt;/p&gt;</comment>
                    <comment id="13168485" author="thetaphi" created="Tue, 13 Dec 2011 16:33:51 +0000"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3643&quot; title=&quot;Improve FilteredQuery to shortcut on wrapped MatchAllDocsQuery&quot;&gt;&lt;del&gt;LUCENE-3643&lt;/del&gt;&lt;/a&gt;-noNullQueryFilter.patch to trunk revision: 1213771&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12507154" name="LUCENE-3643-allowNullQueryFilter.patch" size="17457" author="thetaphi" created="Tue, 13 Dec 2011 09:45:12 +0000" />
                    <attachment id="12507155" name="LUCENE-3643-noNullQueryFilter.patch" size="11466" author="thetaphi" created="Tue, 13 Dec 2011 09:45:12 +0000" />
                    <attachment id="12507153" name="LUCENE-3643.patch" size="29" author="thetaphi" created="Tue, 13 Dec 2011 09:45:12 +0000" />
                    <attachment id="12507075" name="LUCENE-3643.patch" size="17302" author="thetaphi" created="Mon, 12 Dec 2011 22:18:29 +0000" />
                    <attachment id="12507027" name="LUCENE-3643.patch" size="17686" author="thetaphi" created="Mon, 12 Dec 2011 18:33:48 +0000" />
                    <attachment id="12507015" name="LUCENE-3643.patch" size="14303" author="thetaphi" created="Mon, 12 Dec 2011 16:46:38 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 12 Dec 2011 22:04:44 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>220491</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24055</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>