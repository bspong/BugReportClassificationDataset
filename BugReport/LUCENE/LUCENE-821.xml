<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:02:47 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-821/LUCENE-821.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-821] single norm file still uses up descriptors</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-821</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The new index file format with a single .nrm file for all norms does not decrease file descriptor usage.&lt;br/&gt;
The .nrm file is opened once for each field with norms in the index segment.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12364031">LUCENE-821</key>
            <summary>single norm file still uses up descriptors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Mar 2007 18:19:13 +0000</created>
                <updated>Sun, 4 Mar 2007 08:21:48 +0000</updated>
                    <resolved>Sun, 4 Mar 2007 03:23:53 +0000</resolved>
                                                                    <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12477663" author="yseeley@gmail.com" created="Sat, 3 Mar 2007 18:43:48 +0000"  >&lt;p&gt;Attaching patch.&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Only open a single IndexInput for the .nrm file and reuse it for all&lt;br/&gt;
norms sharing that file in the segment.  No clone is needed since&lt;br/&gt;
only a single norm is read at any time.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;close norms when no longer needed (idea from Michael)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removed extra IndexInput clone() when reading the norms... why was this there originally?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12477676" author="yseeley@gmail.com" created="Sat, 3 Mar 2007 20:06:38 +0000"  >&lt;p&gt;&amp;gt; - removed extra IndexInput clone() when reading the norms... why was this there originally? &lt;/p&gt;

&lt;p&gt;Going back to the original SegmentReader implementation (2001), getNorms() wasn&apos;t synchronized, hence the clone of IndexInput was needed.&lt;/p&gt;</comment>
                    <comment id="12477706" author="mikemccand" created="Sat, 3 Mar 2007 23:24:00 +0000"  >&lt;p&gt;Whoa, you beat me to it: this was the next bug I was about to open!&lt;/p&gt;

&lt;p&gt;And I had worked through a patch, even setting in = null in the newly&lt;br/&gt;
added Norm.close method &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;And then also re-discovering that TestMultiSearcher closes its&lt;br/&gt;
searcher and then keeps using it...&lt;/p&gt;

&lt;p&gt;Your patch looks perfect to me.  +1&lt;/p&gt;

&lt;p&gt;I like the removal of the .clone() since norms(...) is synchronized.&lt;/p&gt;

&lt;p&gt;The one thing I was still trying to work out is if we could somehow&lt;br/&gt;
close the singleNormStream once all Norm instances that share it had&lt;br/&gt;
cached.  It seems like a nice to have, but, since norms(...) is&lt;br/&gt;
already synchronized we could have a simple refcount to track how many&lt;br/&gt;
Norm instances still required it and then close the stream when that&lt;br/&gt;
hits 0?  This way we can free up 1 more file descriptor in certain&lt;br/&gt;
cases.&lt;/p&gt;</comment>
                    <comment id="12477733" author="yseeley@gmail.com" created="Sun, 4 Mar 2007 03:04:17 +0000"  >&lt;p&gt;Yeah, I considered refcounting the input, but I&apos;m not sure that it&apos;s worth it.&lt;br/&gt;
The reason is predictability... since you don&apos;t know what queries are coming, you don&apos;t know when that descriptor will be closed, and hence need to plan for the upper bound on descriptor usage anyway.&lt;/p&gt;</comment>
                    <comment id="12477735" author="yseeley@gmail.com" created="Sun, 4 Mar 2007 03:23:53 +0000"  >&lt;p&gt;committed.  Thanks for the review Mike.&lt;/p&gt;</comment>
                    <comment id="12477759" author="mikemccand" created="Sun, 4 Mar 2007 08:01:28 +0000"  >&lt;p&gt;&amp;gt; The reason is predictability... since you don&apos;t know what queries are coming, you don&apos;t know when that descriptor will be closed, and hence need to plan for the upper bound on descriptor usage anyway.&lt;/p&gt;

&lt;p&gt;Agreed, the upper bound is what counts here, so it&apos;s not much help to reduce by one at some random later time.&lt;/p&gt;</comment>
                    <comment id="12477761" author="doronc" created="Sun, 4 Mar 2007 08:21:48 +0000"  >&lt;p&gt;wow..  I totally missed this point in 756.  Fix here seems perfect to me too. Thanks for catching and fixing this Yonik.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12352512" name="norms.patch" size="4599" author="yseeley@gmail.com" created="Sat, 3 Mar 2007 18:43:48 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 3 Mar 2007 23:24:00 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12919</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26909</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>