<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:16:14 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2181/LUCENE-2181.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2181] benchmark for collation</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2181</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Steven Rowe attached a contrib/benchmark-based benchmark for collation (both jdk and icu) under &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2084&quot; title=&quot;remove Byte/CharBuffer wrapping for collation key generation&quot;&gt;&lt;del&gt;LUCENE-2084&lt;/del&gt;&lt;/a&gt;, along with some instructions to run it... &lt;/p&gt;

&lt;p&gt;I think it would be a nice if we could turn this into a committable patch and add it to benchmark.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12444223">LUCENE-2181</key>
            <summary>benchmark for collation</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Dec 2009 17:10:36 +0000</created>
                <updated>Fri, 10 May 2013 11:44:02 +0100</updated>
                    <resolved>Tue, 12 Jan 2010 20:08:05 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/benchmark</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12795929" author="steve_rowe" created="Sat, 2 Jan 2010 23:37:24 +0000"  >&lt;p&gt;Attached .zip&apos;d patch (over 10MB because of the 4 languages&apos; LineDocs) integrated into the Ant build for the ICU contrib, rather than integrated into the Benchmark build.&lt;/p&gt;

&lt;p&gt;Invoke using &lt;tt&gt;ant benchmark&lt;/tt&gt; from the &lt;tt&gt;contrib/icu/&lt;/tt&gt; directory.&lt;/p&gt;</comment>
                    <comment id="12795959" author="rcmuir" created="Sun, 3 Jan 2010 09:13:42 +0000"  >&lt;p&gt;Hi Steven, one idea we can do here is to put the large files online (zipped) and have ant download them when we run the benchmark... &lt;/p&gt;

&lt;p&gt;I can put them on people.apache.org for this purpose, we already do the same with the huge wikipedia file... what do you think?&lt;/p&gt;</comment>
                    <comment id="12796017" author="steve_rowe" created="Sun, 3 Jan 2010 19:13:35 +0000"  >&lt;p&gt;Works for me.&lt;/p&gt;

&lt;p&gt;I do have one concern, though: the LineDocSource parser doesn&apos;t know how to handle comments, so these four files don&apos;t have Apache2 license declarations in them.  We should put a README (or something like it) with these files to indicate the license.&lt;/p&gt;

&lt;p&gt;Different subject: I&apos;m not sure where it would go, but the code I used to produce these top-TF wikipedia files may be useful to other people - where do you think it could live?  An example, maybe?&lt;/p&gt;</comment>
                    <comment id="12796066" author="rcmuir" created="Mon, 4 Jan 2010 02:43:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do have one concern, though: the LineDocSource parser doesn&apos;t know how to handle comments, so these four files don&apos;t have Apache2 license declarations in them. We should put a README (or something like it) with these files to indicate the license.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are they really apache license? or derived from wikipedia content? if these files are only being downloaded when you run &apos;ant benchmark&apos; for collation, then it is just like the enwiki task in benchmark, it downloads some huge wikipedia data and runs it. So someone please correct me if I am wrong, but I don&apos;t think we should be putting apache license headers in these files anyway, its just like the benchmark enwiki task, we are not shipping it with our source distribution.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Different subject: I&apos;m not sure where it would go, but the code I used to produce these top-TF wikipedia files may be useful to other people - where do you think it could live? An example, maybe?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;hmm I will have to think about this... anyone got ideas?  I think this would be useful too (I admit to not having yet looked at the implementation), here are two examples:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Karl could use this to evaluate his swedish stemming improvements, taking frequency into account.&lt;/li&gt;
	&lt;li&gt;the obvious use of when you need to build a stopword list, these top terms are where you want to start.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12796181" author="steve_rowe" created="Mon, 4 Jan 2010 14:09:17 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;... these four files don&apos;t have Apache2 license declarations in them. We should put a README (or something like it) with these files to indicate the license.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are they really apache license? or derived from wikipedia content?... I don&apos;t think we should be putting apache license headers in these files&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, I just assumed that since these files were not (anything even close to) verbatim copies that they were independently licensable new works, but it&apos;s definitely more complicated than that...&lt;/p&gt;

&lt;p&gt;This looks like the place to start where licensing is concerned:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Wikipedia_Copyright&quot; class=&quot;external-link&quot;&gt;http://en.wikipedia.org/wiki/Wikipedia_Copyright&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My (way non-expert) reading of this is that Wikipedia-derived works (and I&apos;m pretty sure these frequency lists qualify as such) must be licensed under the &lt;a href=&quot;http://creativecommons.org/licenses/by-sa/3.0/&quot; class=&quot;external-link&quot;&gt;Creative Commons Attribution-Share Alike 3.0 Unported license&lt;/a&gt;, which does not appear to me to be entirely compatible with the Apache2 license.&lt;/p&gt;

&lt;p&gt;So I agree with you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - with the caveat that some form of attribution and a pointer to licensing info should be included with these files.&lt;/p&gt;</comment>
                    <comment id="12798413" author="steve_rowe" created="Sat, 9 Jan 2010 22:14:51 +0000"  >&lt;p&gt;Hi Robert, &lt;/p&gt;

&lt;p&gt;In the new version of the patch, &lt;tt&gt;ant benchmark&lt;/tt&gt; from the &lt;tt&gt;contrib/icu/&lt;/tt&gt; directory attempts to download the attached &lt;tt&gt;tar.bz2&lt;/tt&gt; file from &lt;tt&gt;&lt;a href=&quot;http://people.apache.org/~rmuir/wikipedia&quot; class=&quot;external-link&quot;&gt;http://people.apache.org/~rmuir/wikipedia&lt;/a&gt;&lt;/tt&gt; (&lt;b&gt;please change this to the location where you end up putting the file&lt;/b&gt;), then unpacks the archive to the &lt;tt&gt;contrib/icu/src/benchmark/work/&lt;/tt&gt; directory, then compiles and runs the benchmark.&lt;/p&gt;

&lt;p&gt;In addition to the top 100K word lists, the &lt;tt&gt;tar.bz2&lt;/tt&gt; file contains &lt;tt&gt;LICENSE.txt&lt;/tt&gt;, which contains links to the Wikipedia dumps from which the lists were extracted, along with a link to the license that Wikipedia uses.&lt;/p&gt;</comment>
                    <comment id="12798444" author="rcmuir" created="Sun, 10 Jan 2010 04:39:56 +0000"  >&lt;p&gt;Hi Steve, thanks a lot for your work here, this is nice.&lt;/p&gt;

&lt;p&gt;I put the files in my apache directory, but modified your patch somewhat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I moved it to the benchmark package proper&lt;/li&gt;
	&lt;li&gt;I created two tasks: NewLocale and NewCollationAnalyzer&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The NewLocale task sets a Locale in the PerfRunData, in my opinion this is reusable beyond collation since it could be used for testing Localized sorting and range searching as well, it supports all Locale params (lang,country,variant)&lt;/p&gt;

&lt;p&gt;The NewCollationAnalyzer creates a &lt;span class=&quot;error&quot;&gt;&amp;#91;ICU&amp;#93;&lt;/span&gt;CollationKeyAnalyzer with the collator defaults depending upon this Locale, right now i only added options to specify impl (impl:jdk or impl:icu), but in the future we can add strength, decomposition, etc.&lt;/p&gt;

&lt;p&gt;Take a look and let me know what you think, surely I made some mistakes but it appears to work fine.&lt;/p&gt;</comment>
                    <comment id="12798508" author="steve_rowe" created="Sun, 10 Jan 2010 17:11:30 +0000"  >&lt;p&gt;Looks good.  I like the way you&apos;ve integrated it into the benchmark suite, and as you say the NewLocaleTask should prove useful elsewhere.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I put the files in my apache directory, but modified your patch somewhat&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;One major thing you changed but didn&apos;t mention above is that rather than applying the collation key transform only to the LineDoc body field, it&apos;s now applied also to the title and date fields.  Given the nature of the top 100k words files &amp;#8211; the title is an integer representing term frequency, and the date is essentially meaningless (the date on which I created the file) &amp;#8211; I don&apos;t think this makes sense (and that&apos;s why I made analyzers that only applied collation to the body field).&lt;/p&gt;</comment>
                    <comment id="12798510" author="rcmuir" created="Sun, 10 Jan 2010 17:24:06 +0000"  >&lt;p&gt;Steve ahh i was wondering about the per-field analyzer wrapper (sorry i neglected to mention this, i just forgot about it)... there are likely other problems too, and the new stuff needs tests.&lt;/p&gt;

&lt;p&gt;What about this per-field thing, what if in the data files, title and date were simply blank?&lt;/p&gt;

&lt;p&gt;Or should we worry, I agree its stupid, does it skew the results though?&lt;br/&gt;
One way to look at it is that its also fairly realistic (even though its meaningless, you see numbers and dates everywhere).&lt;/p&gt;

&lt;p&gt;The downside to doing per-analyzer wrapper is that it introduces some complexity, in all honesty this is not really specific to this collation task, right? (i.e. the existing analysis/tokenization benchmarks have this same problem)&lt;/p&gt;</comment>
                    <comment id="12798514" author="rcmuir" created="Sun, 10 Jan 2010 17:34:00 +0000"  >&lt;p&gt;Steven, another idea: what if we simply added the options to DocMaker so we could turn off the tokenization of title and date fields?&lt;/p&gt;

&lt;p&gt;right now you can only control this stuff for the body fields. imo this would be the best solution.&lt;/p&gt;

&lt;p&gt;edit: ok this is already there, just a little strange. we can use doc.tokenized to turn it off for these other fields, and doc.body.tokenized turned on so that we are only analyzing the field we want.&lt;/p&gt;

&lt;p&gt;i&apos;ll update the alg file and produce a new patch&lt;/p&gt;</comment>
                    <comment id="12798519" author="steve_rowe" created="Sun, 10 Jan 2010 17:54:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;What about this per-field thing, what if in the data files, title and date were simply blank?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, although the date field value is meaningless, I like the TF-in-title-field thing.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Or should we worry, I agree its stupid, does it skew the results though?&lt;br/&gt;
One way to look at it is that its also fairly realistic (even though its meaningless, you see numbers and dates everywhere).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking that it would, and that it&apos;s not really a meaningful test of collation - who&apos;s going to bother running collation over integers and dates? - but since the comparison here is between two implementations of collation, I think you&apos;re right that there is no skew in doing this comparison:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;icu(kiwi) + icu(apple) + icu(orange) : jdk(kiwi) + jdk(apple) + jdk(orange)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of this one:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;keyword(kiwi) + keyword(apple) + icu(orange) : keyword(kiwi) + keyword(apple) + jdk(orange)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(where the icu(X) transform = keyword(X) + icu-collation(X), and similarly for the jdk(X) transform)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The downside to doing per-analyzer wrapper is that it introduces some complexity, in all honesty this is not really specific to this collation task, right? (i.e. the existing analysis/tokenization benchmarks have this same problem)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup, you&apos;re right.  A general facility to do this will end up looking (modulo syntax) like Solr&apos;s per-field analysis specification.&lt;/p&gt;</comment>
                    <comment id="12798520" author="steve_rowe" created="Sun, 10 Jan 2010 17:58:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven, another idea: what if we simply added the options to DocMaker so we could turn off the tokenization of title and date fields?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good idea!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;i&apos;ll update the alg file and produce a new patch&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Excellent, thanks!&lt;/p&gt;</comment>
                    <comment id="12798527" author="rcmuir" created="Sun, 10 Jan 2010 18:38:34 +0000"  >&lt;p&gt;Steven I also havent forgotten about your other contribution, the thing that creates the benchmark corpus in the first place from wikipedia.&lt;/p&gt;

&lt;p&gt;One idea I had would be that such a thing wouldn&apos;t be too out of place in the open relevance project... (munging corpora etc)&lt;/p&gt;</comment>
                    <comment id="12798553" author="rcmuir" created="Sun, 10 Jan 2010 23:13:47 +0000"  >&lt;p&gt;ok i think we might be close to something committable now:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;wrote tests for NewLocaleTask and NewCollationAnalyzerTask&lt;/li&gt;
	&lt;li&gt;set doc.stored=false, doc.tokenized=false, doc.body.tokenized=true in the collation.alg file&lt;/li&gt;
	&lt;li&gt;i moved the two scripts into a &apos;scripts&apos; directory, i thought this made more sense?&lt;/li&gt;
	&lt;li&gt;I also renamed the bm2jira.pl script to collation.bm2jira.pl&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;here is the output from &apos;ant collation&apos; from the benchmark package:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10.78s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.32s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.58s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;60%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.48s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.52s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.59s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;67%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.52s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.61s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;62%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13.03s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8.68s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.66s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;62%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;i think its more accurate relative to KeywordAnalyzer now that we aren&apos;t storing the body text in a stored field and things like that, but of course you can change the .alg file to see if the differences matter in the context of overall indexing by turning these back on.&lt;/p&gt;</comment>
                    <comment id="12798555" author="rcmuir" created="Sun, 10 Jan 2010 23:22:15 +0000"  >&lt;p&gt;fix a bug in testCollator/assertEqualCollation, so its actually testing correct behavior rather than being a no-op &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12798560" author="rcmuir" created="Mon, 11 Jan 2010 00:20:21 +0000"  >&lt;p&gt;ok, somehow it completely bypassed my brain you are using ReadTokens task &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;so this is a problem, because ReadTokens does not respect the DocMaker configuration. In my opinion it should not tokenize fields unless they are configured to be tokenized. &lt;/p&gt;

&lt;p&gt;So I added the following in this patch to fix this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     for(final Fieldable field : fields) {
+      if (!field.isTokenized()) continue;
+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;now we get the results we expect:&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.43s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.15s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;115%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.78s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.37s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.17s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;117%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.84s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.42s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.18s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;115%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.81s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.67s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.24s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;88%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;if you comment out the doc.tokenized=false, then you get the other results i just posted instead, as it will analyze the other fields too.&lt;/p&gt;</comment>
                    <comment id="12798584" author="steve_rowe" created="Mon, 11 Jan 2010 06:11:03 +0000"  >&lt;p&gt;Works for me:&lt;/p&gt;

&lt;p&gt;JAVA:&lt;br/&gt;
java version &quot;1.5.0_15&quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_15-b04)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 1.5.0_15-b04, mixed mode)&lt;/p&gt;

&lt;p&gt;OS:&lt;br/&gt;
cygwin&lt;br/&gt;
WinVistaService Pack 2&lt;br/&gt;
Service Pack 26060022202561&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Language&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;java.text&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;KeywordAnalyzer&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ICU4J Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;English&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.53s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.03s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.20s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;422%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;French&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.41s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.13s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;455%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;German&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.36s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.19s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.22s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;430%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Ukrainian&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8.92s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.62s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.21s&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;220%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12798588" author="steve_rowe" created="Mon, 11 Jan 2010 06:39:10 +0000"  >&lt;p&gt;I just ran the contrib/benchmark tests, and I got one test failure:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testcase: testReadTokens(org.apache.lucene.benchmark.byTask.TestPerfTasksLogic):    FAILED
    [junit] expected:&amp;lt;3108&amp;gt; but was:&amp;lt;3128&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;3108&amp;gt; but was:&amp;lt;3128&amp;gt;
    [junit]     at org.apache.lucene.benchmark.byTask.TestPerfTasksLogic.testReadTokens(TestPerfTasksLogic.java:480)
    [junit]     at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:212)
    [junit] 
    [junit] 
    [junit] Test org.apache.lucene.benchmark.byTask.TestPerfTasksLogic FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12798589" author="steve_rowe" created="Mon, 11 Jan 2010 06:44:37 +0000"  >&lt;p&gt;I think NewCollationAnalyzerTask should be a little more careful about parsing its parameters - here&apos;s a slightly modified version of your setParams() that understands &quot;impl:jdk&quot; and complains about unrecognized params:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setParams(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; params) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setParams(params);
    
    StringTokenizer st = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringTokenizer(params, &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (st.hasMoreTokens()) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; param = st.nextToken();
      StringTokenizer expr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringTokenizer(param, &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key = expr.nextToken();
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = expr.nextToken();
      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now we only support the &lt;span class=&quot;code-quote&quot;&gt;&quot;impl&quot;&lt;/span&gt; parameter.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// TODO: add strength, decomposition, etc
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;impl&quot;&lt;/span&gt;)) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.equalsIgnoreCase(&lt;span class=&quot;code-quote&quot;&gt;&quot;icu&quot;&lt;/span&gt;))
          impl = Implementation.ICU;
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.equalsIgnoreCase(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdk&quot;&lt;/span&gt;))
          impl = Implementation.JDK;
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown parameter &quot;&lt;/span&gt; + param);
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown parameter &quot;&lt;/span&gt; + param);
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12798590" author="steve_rowe" created="Mon, 11 Jan 2010 06:46:08 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Steven I also havent forgotten about your other contribution, the thing that creates the benchmark corpus in the first place from wikipedia.&lt;/p&gt;

&lt;p&gt;One idea I had would be that such a thing wouldn&apos;t be too out of place in the open relevance project... (munging corpora etc)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Interesting idea, thanks - I&apos;ll take a look at what&apos;s there now and see how my stuff would fit in.&lt;/p&gt;</comment>
                    <comment id="12798655" author="rcmuir" created="Mon, 11 Jan 2010 12:55:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;I just ran the contrib/benchmark tests, and I got one test failure: &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, I think this is from adjusting the ReadTokensTask...&lt;/p&gt;

&lt;p&gt;I looked at the test and i think it .... should be improved.... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12798662" author="rcmuir" created="Mon, 11 Jan 2010 13:14:11 +0000"  >&lt;p&gt;corrected this testReadTokens(), it tests by adding up token freq across the index and comparing it to the number of tokens read, but there is a non-tokenized, but indexed field (DocMaker.ID_FIELD), the keywords from this should not add to the expected count.&lt;/p&gt;

&lt;p&gt;added your addt&apos;l parameter checking for NewCollationAnalyzerTask&lt;/p&gt;</comment>
                    <comment id="12798679" author="steve_rowe" created="Mon, 11 Jan 2010 14:49:17 +0000"  >&lt;p&gt;+1, tests all pass, and &quot;ant collation&quot; produced expected output.&lt;/p&gt;

&lt;p&gt;One minor detail, though - shouldn&apos;t the output files be renamed to identify their purpose, similarly to how you renamed bm2jira.pl?  Here&apos;s the relevant section in &lt;tt&gt;contrib/benchmark/build.txt&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;collation.output.file&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${working.dir}/benchmark.output.txt&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;collation.jira.output.file&quot;&lt;/span&gt;  value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${working.dir}/bm2jira.output.txt&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12798774" author="rcmuir" created="Mon, 11 Jan 2010 18:43:39 +0000"  >&lt;p&gt;Steven thanks, in addition to your comments I also changed the config to download the top100k files to the temp directory, and expand to work/top100k-out, consistent with the other benchmark datasets.&lt;/p&gt;

&lt;p&gt;I think this one is ready. If there is no objection I will commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12799056" author="steve_rowe" created="Tue, 12 Jan 2010 03:38:02 +0000"  >&lt;p&gt;+1, once again, tests all pass, and &quot;ant collation&quot; produced expected output. &lt;/p&gt;</comment>
                    <comment id="12799361" author="rcmuir" created="Tue, 12 Jan 2010 20:08:04 +0000"  >&lt;p&gt;Committed revision 898491.&lt;/p&gt;

&lt;p&gt;Thanks Steven!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12429918" name="LUCENE-2181.patch" size="32391" author="rcmuir" created="Mon, 11 Jan 2010 18:43:39 +0000" />
                    <attachment id="12429889" name="LUCENE-2181.patch" size="31555" author="rcmuir" created="Mon, 11 Jan 2010 13:14:11 +0000" />
                    <attachment id="12429866" name="LUCENE-2181.patch" size="30543" author="rcmuir" created="Mon, 11 Jan 2010 00:20:21 +0000" />
                    <attachment id="12429865" name="LUCENE-2181.patch" size="29887" author="rcmuir" created="Sun, 10 Jan 2010 23:22:15 +0000" />
                    <attachment id="12429864" name="LUCENE-2181.patch" size="29729" author="rcmuir" created="Sun, 10 Jan 2010 23:13:47 +0000" />
                    <attachment id="12429844" name="LUCENE-2181.patch" size="23796" author="rcmuir" created="Sun, 10 Jan 2010 04:39:56 +0000" />
                    <attachment id="12429834" name="LUCENE-2181.patch" size="38244" author="steve_rowe" created="Sat, 9 Jan 2010 22:14:51 +0000" />
                    <attachment id="12429835" name="top.100k.words.de.en.fr.uk.wikipedia.2009-11.tar.bz2" size="2033147" author="steve_rowe" created="Sat, 9 Jan 2010 22:14:51 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>8.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 2 Jan 2010 23:37:24 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11605</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25544</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>