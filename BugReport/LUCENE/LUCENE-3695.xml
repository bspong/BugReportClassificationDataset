<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:26:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3695/LUCENE-3695.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3695] FST Builder methods need fixing,documentation,or improved type safety</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3695</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Its confusing the way an FST Builder has 4 add() methods, and you get assertion errors (what happens if assertions are disabled?) if you use the wrong one:&lt;/p&gt;

&lt;p&gt;For reference we have 3 FST input types:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;BYTE1 (byte)&lt;/li&gt;
	&lt;li&gt;BYTE2 (char)&lt;/li&gt;
	&lt;li&gt;BYTE4 (int)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For the builder add() method signatures we have:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;add(BytesRef)&lt;/li&gt;
	&lt;li&gt;add(char[], int offset, int len)&lt;/li&gt;
	&lt;li&gt;add(CharSequence)&lt;/li&gt;
	&lt;li&gt;add(IntsRef)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But certain methods only work with certain FST input types, and these mappings are not the ones you think. &lt;/p&gt;

&lt;p&gt;For example, you would think that if you have a char-based FST you should use add(char[]) or add(CharSequence), but this is not the case: those add methods actually only work with int-based FST (they use codePointAt() to extract codepoints). Instead, you have to use add(IntsRef) for the char-based one.&lt;/p&gt;

&lt;p&gt;The worst is if you use the wrong one, you get an assertion error, but i&apos;m not sure what happens if assertions are disabled.&lt;/p&gt;

&lt;p&gt;Maybe the ultimate solution is to parameterize FST&apos;s generics on input too (FST&amp;lt;input,output&amp;gt;) and just require BytesRef/CharsRef/IntsRef as the parameter? Then you could just have add(), and this might clean up FSTEnum too (it would no longer need that InputOutput class but maybe could use Map.Entry&amp;lt;input,output&amp;gt; or something?&lt;/p&gt;

&lt;p&gt;I think the documentation is improving but i still notice add(BytesRef) has no javadoc at all, and it only works with BYTE1, so I think we still have some work to do even if we want to just pursue a documentation fix.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12538302">LUCENE-3695</key>
            <summary>FST Builder methods need fixing,documentation,or improved type safety</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jan 2012 10:05:01 +0000</created>
                <updated>Fri, 10 May 2013 11:43:51 +0100</updated>
                    <resolved>Tue, 6 Mar 2012 02:38:07 +0000</resolved>
                                            <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13185707" author="mikemccand" created="Fri, 13 Jan 2012 17:59:54 +0000"  >&lt;p&gt;+1 to doing something here!  It&apos;s very confusing now.&lt;/p&gt;

&lt;p&gt;The Builder today only operates on IntsRef inputs; the other add methods taking char[]/CharSequence, BytesRef are sugar, translating to IntsRef.  Maybe... we should move these elsewhere (eg Util.XXX) and rename them to reflect that they are just converting XXX to IntsRef?  Then Builder would only have add(IntsRef[]).&lt;/p&gt;

&lt;p&gt;The &quot;INPUT_TYPE&quot; really describes the allowed range of the input int labels...&lt;/p&gt;

&lt;p&gt;I&apos;d love to parameterize by input type as well, but I think it&apos;s tricky (Uwe!?)?  Ideally Builder, FST, and the FSTEnums would take &amp;lt;K,V&amp;gt;; FST is just like a SortedMap.&lt;/p&gt;</comment>
                    <comment id="13185726" author="dweiss" created="Fri, 13 Jan 2012 18:14:56 +0000"  >&lt;p&gt;Just a note. Ideally it would be &amp;lt;&amp;lt;K extends Comparable&amp;gt;, &amp;lt;V extends ByteArraySerializable&amp;gt;, AlgebraOperations&amp;lt;V&amp;gt;&amp;gt;; K is Comparable for binary lookups inside array-expanded nodes, V is arbitrary as long as it can be serialized into bytes and we need certain algebraic operations defined for V... eh, this would be close to perfection &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                    <comment id="13186015" author="mikemccand" created="Sat, 14 Jan 2012 00:26:00 +0000"  >&lt;p&gt;Patch, just moving the confusing sugar out of FST into Util... this makes it explicit that the Builder only takes IntsRef, and you have to pre-convert other things to IntsRef first...&lt;/p&gt;</comment>
                    <comment id="13186037" author="mikemccand" created="Sat, 14 Jan 2012 00:48:22 +0000"  >&lt;p&gt;Another iteration, removing confusing sugar from Util, and removing an iffy assert.&lt;/p&gt;</comment>
                    <comment id="13186620" author="mikemccand" created="Sun, 15 Jan 2012 23:42:23 +0000"  >&lt;p&gt;OK I committed de-sugaring... but we can leave this open for any more improvements.&lt;/p&gt;</comment>
                    <comment id="13222943" author="rcmuir" created="Tue, 6 Mar 2012 02:37:54 +0000"  >&lt;p&gt;Lets resolve this for now? we made progress. We know we can further improve the FST APIs, &lt;br/&gt;
but this fix solves the worst of the confusion in my opinion.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12510552" name="LUCENE-3695.patch" size="24393" author="mikemccand" created="Sat, 14 Jan 2012 00:48:22 +0000" />
                    <attachment id="12510549" name="LUCENE-3695.patch" size="20683" author="mikemccand" created="Sat, 14 Jan 2012 00:26:00 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 13 Jan 2012 17:59:54 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>223809</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24003</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>