<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:16:41 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3435/LUCENE-3435.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3435] Create a Size Estimator model for Lucene and Solr</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3435</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;It is often handy to be able to estimate the amount of memory and disk space that both Lucene and Solr use, given certain assumptions.  I intend to check in an Excel spreadsheet that allows people to estimate memory and disk usage for trunk.  I propose to put it under dev-tools, as I don&apos;t think it should be official documentation just yet and like the IDE stuff, we&apos;ll see how well it gets maintained.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12523050">LUCENE-3435</key>
            <summary>Create a Size Estimator model for Lucene and Solr</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="gsingers">Grant Ingersoll</assignee>
                                <reporter username="gsingers">Grant Ingersoll</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Sep 2011 14:14:40 +0100</created>
                <updated>Fri, 10 May 2013 11:43:15 +0100</updated>
                    <resolved>Tue, 6 Dec 2011 15:57:35 +0000</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="13104574" author="otis" created="Wed, 14 Sep 2011 16:35:41 +0100"  >&lt;p&gt;Grant - what is your experience with this estimator (the one you just committed)?  That is, how often is it right or close (how close?) to what you see in reality, assuming you give it correct input?&lt;/p&gt;</comment>
                    <comment id="13104622" author="gsingers" created="Wed, 14 Sep 2011 17:24:55 +0100"  >&lt;p&gt;A good deal of it Mike and I worked out yesterday on IRC (well, mostly Mike explained and I took copious notes).  The disk storage stuff is based on LIA2.  It is a theoretical model and not an empirical one other than the bytes/term calculation was based off of indexing wikipedia.  &lt;/p&gt;

&lt;p&gt;I would deem it a gross approximation of the state of trunk at this point in time.  My gut says the Lucene estimation is a little low, while Solr is fairly close (since I suspect Solr&apos;s memory usage is dominated by caching).  I imagine there are things still unaccounted for. For instance, I haven&apos;t reverse engineered the fieldValueCache memSize() method yet and I don&apos;t have a good sense of how much memory would be consumed in a highly concurrent system by the sheer number of Query objects instantiated or when one has really large Queries (say 5K terms).  It also is not meant to be one size fits all.  Lucene/Solr have a ton of tuning options that could change things significantly.&lt;/p&gt;

&lt;p&gt;I did a few sanity checks against things I&apos;ve seen in the past, and thought it was reasonable.  There is, of course, no substitute for good testing.  In other words, caveat emptor.&lt;/p&gt;</comment>
                    <comment id="13113611" author="christopherball" created="Fri, 23 Sep 2011 18:55:02 +0100"  >&lt;p&gt;Grant - Great start =)&lt;/p&gt;

&lt;p&gt;Below is some initial feedback (happy to help further if you want to chat in real-time) &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Quickly Groking&lt;/b&gt; - To make it easier to quickly comprehend, the cells that are to be updated in the spreadsheet should be color coded (as opposed to those that are calculated)  &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Bytes or Entries&lt;/b&gt; - You list Max Size for filterCache, queryResultCache, and documentCache as 512 which subtle implies the size is based on bytes when the units of the cache are actually the number of entries. I would clarify the unit of measure (I&apos;ve seen numerous blogs and emails confuse this).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Approach to Cache Sizing&lt;/b&gt; - Given memory requirements are heavily contingent on caching I would suggest including at least one approach for how to determine cache size&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Query Result Cache
	&lt;ul&gt;
		&lt;li&gt;Estimation: should be greater than &apos;number of commonly reoccurring unique queries&apos; x &apos;number of sort parameters&apos; x &apos;number of possible sort orders&apos;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Document Cache
	&lt;ul&gt;
		&lt;li&gt;Estimation: should be greater than &apos;maximum number of documents per query&apos; x &apos;maximum number of concurrent queries&apos;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Filter Cache
	&lt;ul&gt;
		&lt;li&gt;Estimation: should be number of unique filter queries (should clarify what constitutes &apos;unique&apos;)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Field Value Cache
	&lt;ul&gt;
		&lt;li&gt;Estimation: should be ?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Custom Caches
	&lt;ul&gt;
		&lt;li&gt;Estimation: should be ? - A common use case?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Faceting&lt;/b&gt; - Surprised there is no reference to use of faceting which is both increasingly common default query functionality and further increases memory requirements for effective use&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Obscure Metrics&lt;/b&gt; - To really give this spreadsheet some teeth, there really should be pointers for at least one approach on how to estimate each input metric (could be on another tab). &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Some are fairly easy:
	&lt;ul&gt;
		&lt;li&gt;Number of Unique Terms / field&lt;/li&gt;
		&lt;li&gt;Number of documents&lt;/li&gt;
		&lt;li&gt;Number of indexed fields (no norms)&lt;/li&gt;
		&lt;li&gt;Number of fields w/ norms&lt;/li&gt;
		&lt;li&gt;Number of non-String Sort Fields other than score&lt;/li&gt;
		&lt;li&gt;Number of String Sort Fields&lt;/li&gt;
		&lt;li&gt;Number of deleted docs on avg&lt;/li&gt;
		&lt;li&gt;Avg. number of terms per query&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Some are quite obscure (and guidance on how to estimate is essential):
	&lt;ul&gt;
		&lt;li&gt;Numberof RAM-based Column Stride Fields (DocValues)&lt;/li&gt;
		&lt;li&gt;ramBufferSizeMB&lt;/li&gt;
		&lt;li&gt;Transient Factor (MB)&lt;/li&gt;
		&lt;li&gt;fieldValueCache Max Size&lt;/li&gt;
		&lt;li&gt;Custom Cache Size (MB)&lt;/li&gt;
		&lt;li&gt;Avg. Number of Bytes per Term&lt;/li&gt;
		&lt;li&gt;Bytes/Term&lt;/li&gt;
		&lt;li&gt;Field Cache bits/term&lt;/li&gt;
		&lt;li&gt;Cache Key Avg. Size (Bytes)&lt;/li&gt;
		&lt;li&gt;Avg QueryResultKey size (in bytes)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="13113695" author="epugh" created="Fri, 23 Sep 2011 20:49:31 +0100"  >&lt;p&gt;A pretty small change, but shouldn&apos;t the fieldValueCache Max Size be 10000?  If you don&apos;t specify a size for fieldValueCache, then Solr on startup generates one that is 100000 max size.&lt;/p&gt;</comment>
                    <comment id="13113967" author="gsingers" created="Sat, 24 Sep 2011 14:09:37 +0100"  >&lt;p&gt;A patch would be great for all of these things.  Thanks!&lt;/p&gt;</comment>
                    <comment id="13163664" author="gsingers" created="Tue, 6 Dec 2011 15:57:35 +0000"  >&lt;p&gt;Still has work needed, but the bones are there and new issues can be opened as necessary.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 14 Sep 2011 15:35:41 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4099</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24261</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>