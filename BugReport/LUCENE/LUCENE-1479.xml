<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:28:18 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1479/LUCENE-1479.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1479] TrecDocMaker skips over documents when &quot;Date&quot; is missing from documents</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1479</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;TrecDocMaker skips over Trec documents if they do not have a &quot;Date&quot; line. When such a document is encountered, the code may skip over several documents until the next tag that is searched for is found.&lt;br/&gt;
The result is, instead of reading ~25M documents from the GOV2 collection, the code reads only ~23M (don&apos;t remember the actual numbers).&lt;/p&gt;

&lt;p&gt;The fix adds a terminatingTag to read() such that the code looks for prefix, but only until terminatingTag is found. Appropriate changes were made in getNextDocData().&lt;/p&gt;

&lt;p&gt;Patch to follow&lt;/p&gt;</description>
                <environment></environment>
            <key id="12410080">LUCENE-1479</key>
            <summary>TrecDocMaker skips over documents when &quot;Date&quot; is missing from documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Dec 2008 14:33:00 +0000</created>
                <updated>Fri, 25 Sep 2009 17:23:14 +0100</updated>
                    <resolved>Mon, 12 Jan 2009 11:37:38 +0000</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>modules/benchmark</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12653802" author="shaie" created="Fri, 5 Dec 2008 14:41:04 +0000"  >&lt;p&gt;Patch to fix the bug&lt;/p&gt;</comment>
                    <comment id="12654051" author="mikemccand" created="Sat, 6 Dec 2008 10:34:20 +0000"  >&lt;p&gt;Please remember to include the trunk release (2.9, in this case) in the fix version when you set fix version to a point release on a branch (2.4.1, in this case).&lt;/p&gt;</comment>
                    <comment id="12662073" author="mikemccand" created="Thu, 8 Jan 2009 19:21:38 +0000"  >&lt;p&gt;Shai, it seems like a doc that has no &quot;Date: XXX&quot; would leave dateStr as null and would then cause an NPE when parseDate is later called?  Or am I missing something?&lt;/p&gt;

&lt;p&gt;Also I&apos;m getting a compilation error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[javac] Compiling 1 source file to /tango/mike/src/lucene.trecdocmaker/build/contrib/benchmark/classes/java
[javac] /tango/mike/src/lucene.trecdocmaker/contrib/benchmark/src/java/org/apache/lucene/benchmark/byTask/feeds/TrecDocMaker.java:190: variable name might not have been initialized
[javac]     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = sb.substring(DOCNO.length(), name.indexOf(TERM_DOCNO, DOCNO.length()));
[javac]                                                ^
[javac] 1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12662259" author="shaie" created="Fri, 9 Jan 2009 07:11:01 +0000"  >&lt;p&gt;Thanks Mike, you&apos;re right. The compilation error is a result of a refactoring I did to that line, by using a single substring call instead of two. I forgot to use &apos;sb&apos; in the second indexOf call, and hence the compilation error.&lt;/p&gt;

&lt;p&gt;Regarding dateStr - I fixed that. Thanks for noticing it&lt;/p&gt;</comment>
                    <comment id="12662338" author="mikemccand" created="Fri, 9 Jan 2009 11:49:18 +0000"  >&lt;p&gt;Ahh the last minute &quot;trivial&quot; code fix... gets you every time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;With the new patch, a document missing a date is assigned the current Date, right?  Can we instead leave it as unset (null)?  (Does DocData allow a null Date)?&lt;/p&gt;

&lt;p&gt;Can you add a test case exposing the bug &amp;amp; showing the fix?&lt;/p&gt;</comment>
                    <comment id="12662452" author="shaie" created="Fri, 9 Jan 2009 18:02:50 +0000"  >&lt;p&gt;The reason why this patch does not include a test case is because it requires the TREC data set. Is it valid to add a test case which will fail if the TREC data is missing? If not, can you suggest how can I simulate it?&lt;br/&gt;
I can create several documents in the TREC format and feed the TrecDocMaker with those files.&lt;br/&gt;
Or ... I&apos;ll look into extending TrecDocMaker and instead of feeding it with File(s), I&apos;ll feed it with some mock documents (String), which simulate the bug. Not sure if that&apos;s doable right-away - might need to change a method to protected.&lt;/p&gt;

&lt;p&gt;Also, I&apos;m not near the code now, so I can&apos;t tell if DocData allows for a null Date. But I guess it&apos;s just easier to assign the current date, for simplicity (you never know if at some point date becomes a &lt;b&gt;must&lt;/b&gt; ...).&lt;br/&gt;
I kept that logic from TrecDocMaker w/o the patch ...&lt;/p&gt;

&lt;p&gt;Shai&lt;/p&gt;</comment>
                    <comment id="12662464" author="mikemccand" created="Fri, 9 Jan 2009 18:38:34 +0000"  >&lt;blockquote&gt;
&lt;p&gt;&amp;gt; I&apos;ll feed it with some mock documents (String), which simulate the bug.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right, either that or make a mocked set of docs in a .gz file and just use TrecDocMaker directly.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;gt; Also, I&apos;m not near the code now, so I can&apos;t tell if DocData allows for a null Date. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think DocData ought to be able to handle a null Date, especially since the real data (GOV2 in your OP) has real documents lacking a Date.&lt;/p&gt;

&lt;p&gt;To pretend the document did have a Date that happens to be today&apos;s date doesn&apos;t seem good (I don&apos;t know of anything in contrib/benchmark that depends on accurate dates now, but we may have something in the future where shifting dates could confuse things).&lt;/p&gt;</comment>
                    <comment id="12662744" author="shaie" created="Sun, 11 Jan 2009 08:38:59 +0000"  >&lt;p&gt;This patch includes TrecDocMakerTest as well as removing the assignment of new Date() in case &quot;Date:&quot; is missing.&lt;br/&gt;
The test includes several test cases, including the missing date one.&lt;br/&gt;
I checked and null date is considered when building a Document object, and therefore it&apos;s safe to assign a null date.&lt;/p&gt;</comment>
                    <comment id="12662941" author="mikemccand" created="Mon, 12 Jan 2009 11:35:48 +0000"  >&lt;p&gt;Patch looks great Shai!  I&apos;ll commit shortly.&lt;/p&gt;</comment>
                    <comment id="12662942" author="mikemccand" created="Mon, 12 Jan 2009 11:37:38 +0000"  >&lt;p&gt;Committed revision 733697.&lt;/p&gt;

&lt;p&gt;Thanks Shai!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12397641" name="LUCENE-1479-2.patch" size="18412" author="shaie" created="Sun, 11 Jan 2009 08:38:59 +0000" />
                    <attachment id="12397483" name="LUCENE-1479.patch" size="4523" author="shaie" created="Fri, 9 Jan 2009 07:11:01 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 6 Dec 2008 10:34:20 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12272</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26248</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>