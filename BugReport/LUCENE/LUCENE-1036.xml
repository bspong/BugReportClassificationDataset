<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:23 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1036/LUCENE-1036.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1036] Unreleased 2.3 version of IndexWriter.optimize()  consistly throws java.lang.IllegalArgumentException out-of-the-box</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1036</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Since the upcoming 2.3 version of Lucene has support for the setRAMBufferSizeMB() method in Index Writer,  I thought I would test its performance.   So, using my application that was built upon (and worked with) Lucene 2.2,  I downloaded the nightly build 2007-10-26_03-16-46 and rebuilt my application with new code setting setRAMBufferSizeMB() from a properties file.   My test data resides in a database table of 30 columns holding 1.25 million records.   The good news is that performance is superior to Lucene 2.2.  The indexing completes in roughly 1/3 the time.   The bad news is the Index Writer.optimize() step now throws an java.lang.IllegalArgumentException.&lt;br/&gt;
I also run tests against various other tables.  Indexing smaller amounts of data did not throw the exception.  Indexing largers amounts of data did throw the exception.  Note, I also tested nightly builds dating back to 2007-10-05.&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
INFO:  SEIndexThread.commitCheck...&lt;br/&gt;
INFO:    ----Commit point reached:  1200000&lt;br/&gt;
INFO:  SEIndexThread.commitCheck...&lt;br/&gt;
INFO:    ----Commit point reached:  1225000&lt;br/&gt;
INFO:  SEIndexThread.commitCheck...&lt;br/&gt;
INFO:    ----Commit point reached:  1250000&lt;br/&gt;
INFO:  SEIndexThread.closeIndex()...&lt;br/&gt;
INFO:    ----commit point reached:  1250659&lt;br/&gt;
INFO:    ----optimize index&lt;br/&gt;
INFO: SEIndexThread():  java.lang.IllegalArgumentException&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException&lt;br/&gt;
        at java.lang.Thread.setPriority(Thread.java(Compiled Code))&lt;br/&gt;
        at org.apache.lucene.index.ConcurrentMergeScheduler.merge(ConcurrentMerg&lt;br/&gt;
eScheduler.java(Compiled Code))&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.maybeMerge(IndexWriter.java:1750)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:1686)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:1652)&lt;br/&gt;
        at LuceneSearchEngine.optimizeIndex(LuceneSearchEngine.java:643)&lt;br/&gt;
        at LuceneSearchEngine.optimizeIndex(LuceneSearchEngine.java:636)&lt;br/&gt;
        at SEIndexThread.closeIndex(SEIndexThread.java:674)&lt;br/&gt;
        at SEIndexThread.processSearchObject(SEIndexThread.java:487)&lt;br/&gt;
        at SEIndexThread.prepareIndex(SEIndexThread.java:391)&lt;br/&gt;
        at SEIndexThread.run(SEIndexThread.java:41)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;AIX 5.3 Unix, Java 1.4,  lucene-core-2007-10-26_03-16-46.jar&lt;/p&gt;</environment>
            <key id="12381262">LUCENE-1036</key>
            <summary>Unreleased 2.3 version of IndexWriter.optimize()  consistly throws java.lang.IllegalArgumentException out-of-the-box</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rgiles">R Giles</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Oct 2007 18:08:30 +0100</created>
                <updated>Fri, 25 Jan 2008 03:24:08 +0000</updated>
                    <resolved>Wed, 7 Nov 2007 21:23:44 +0000</resolved>
                            <version>2.3</version>
                                <fixVersion>2.3</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12538024" author="rengels@ix.netcom.com" created="Fri, 26 Oct 2007 18:10:47 +0100"  >&lt;p&gt;Can you post the full stack trace?&lt;/p&gt;</comment>
                    <comment id="12538044" author="mikemccand" created="Fri, 26 Oct 2007 19:06:07 +0100"  >&lt;p&gt;Are you using one of the IndexWriter.addIndexes* methods to combine indices in the end?&lt;/p&gt;</comment>
                    <comment id="12538047" author="mikemccand" created="Fri, 26 Oct 2007 19:12:56 +0100"  >&lt;p&gt;Also, are you calling setMaxMergeDocs?&lt;/p&gt;</comment>
                    <comment id="12538054" author="mikemccand" created="Fri, 26 Oct 2007 19:54:00 +0100"  >&lt;p&gt;Excellent, thanks!  I think I see the issue.  We default the thread priority of the threads spawned by ConcurrentMergeScheduler to 1+priority of calling thread.  But, we fail to bounds check that this is &amp;lt;= MAX_PRIORITY.&lt;/p&gt;

&lt;p&gt;Are your calling threads being set to MAX_PRIORITY?&lt;/p&gt;</comment>
                    <comment id="12538091" author="mikemccand" created="Fri, 26 Oct 2007 21:15:06 +0100"  >&lt;p&gt;Attached unit test that shows the issue &amp;amp; patch that fixes it.  I also&lt;br/&gt;
catch &amp;amp; ignore SecurityException coming out of mergeThread.setPriority&lt;br/&gt;
since it&apos;s fine if we fail to set the thread&apos;s priority.&lt;/p&gt;</comment>
                    <comment id="12538432" author="mikemccand" created="Mon, 29 Oct 2007 09:02:19 +0000"  >&lt;p&gt;I just committed the above patch.  I think likely that was the issue here, but I&apos;ll leave this issue open for a while to hopefully hear confirmation back from the original poster...&lt;/p&gt;</comment>
                    <comment id="12539866" author="rgiles" created="Sat, 3 Nov 2007 05:42:41 +0000"  >&lt;p&gt;No,  I am not executing any IndexWriter.addIndex method.  Just a&lt;br/&gt;
straight &lt;br/&gt;
IndexWriter.optimize().&lt;/p&gt;

</comment>
                    <comment id="12539867" author="rgiles" created="Sat, 3 Nov 2007 05:42:42 +0000"  >&lt;p&gt;Done.   Issue has been updated with the following info:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException&lt;br/&gt;
        at java.lang.Thread.setPriority(Thread.java(Compiled Code))&lt;br/&gt;
        at&lt;br/&gt;
org.apache.lucene.index.ConcurrentMergeScheduler.merge(ConcurrentMerg&lt;br/&gt;
eScheduler.java(Compiled Code))&lt;br/&gt;
        at&lt;br/&gt;
org.apache.lucene.index.IndexWriter.maybeMerge(IndexWriter.java:1750)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:1686)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:1652)&lt;br/&gt;
        at LuceneSearchEngine.optimizeIndex(LuceneSearchEngine.java:643)&lt;br/&gt;
        at LuceneSearchEngine.optimizeIndex(LuceneSearchEngine.java:636)&lt;br/&gt;
        at SEIndexThread.closeIndex(SEIndexThread.java:674)&lt;br/&gt;
        at SEIndexThread.processSearchObject(SEIndexThread.java:487)&lt;br/&gt;
        at SEIndexThread.prepareIndex(SEIndexThread.java:391)&lt;br/&gt;
        at SEIndexThread.run(SEIndexThread.java:41)&lt;/p&gt;




</comment>
                    <comment id="12539868" author="rgiles" created="Sat, 3 Nov 2007 05:42:42 +0000"  >

&lt;p&gt;No, I am not calling setMaxMergeDocs.    &lt;/p&gt;




</comment>
                    <comment id="12539869" author="rgiles" created="Sat, 3 Nov 2007 05:42:42 +0000"  >&lt;p&gt;Yes, my calling thread is set to MAX_PRIORITY.&lt;/p&gt;


</comment>
                    <comment id="12539873" author="rgiles" created="Sat, 3 Nov 2007 05:42:43 +0000"  >&lt;p&gt;I changed the priority of my thread from MAX_PRIORITY down to&lt;br/&gt;
NORM_PRIORITY&lt;br/&gt;
and my IndexWriter.optimize() step completes successfully.  So your&lt;br/&gt;
patch&lt;br/&gt;
is probably correct.  When will your patch be included in a nightly&lt;br/&gt;
build?&lt;/p&gt;

</comment>
                    <comment id="12540891" author="rgiles" created="Wed, 7 Nov 2007 20:55:56 +0000"  >&lt;p&gt;Key: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1036&quot; title=&quot;Unreleased 2.3 version of IndexWriter.optimize()  consistly throws java.lang.IllegalArgumentException out-of-the-box&quot;&gt;&lt;del&gt;LUCENE-1036&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;I have not seen any response to my question.&lt;/p&gt;

&lt;p&gt;I changed the priority of my thread from MAX_PRIORITY down to&lt;br/&gt;
NORM_PRIORITY&lt;br/&gt;
and my IndexWriter.optimize() step completes successfully.  So your&lt;br/&gt;
patch&lt;br/&gt;
is probably correct.  When will your patch be included in a nightly&lt;br/&gt;
build?&lt;/p&gt;






</comment>
                    <comment id="12540899" author="mikemccand" created="Wed, 7 Nov 2007 21:23:31 +0000"  >&lt;p&gt;Woops, sorry, I somehow missed your posts here.&lt;/p&gt;

&lt;p&gt;OK that is good to hear that the MAX_PRIORITY was in fact the issue.&lt;/p&gt;

&lt;p&gt;I committed the fix on 10/29 so you should be able to use any nightly build since then.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12368516" name="LUCENE-1036.patch" size="4252" author="mikemccand" created="Fri, 26 Oct 2007 21:15:06 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 26 Oct 2007 17:10:47 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12709</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26693</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>