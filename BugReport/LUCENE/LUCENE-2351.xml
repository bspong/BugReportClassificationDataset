<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:24:41 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2351/LUCENE-2351.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2351] optimize automatonquery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2351</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Mike found a few cases in flex where we have some bad behavior with automatonquery.&lt;br/&gt;
The problem is similar to a database query planner, where sometimes simply doing a full table scan is faster than using an index.&lt;/p&gt;

&lt;p&gt;We can optimize automatonquery a little bit, and get better performance for fuzzy,wildcard,regex queries.&lt;/p&gt;

&lt;p&gt;Here is a list of ideas:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;create commonSuffixRef for infinite automata, not just really-bad linear scan cases&lt;/li&gt;
	&lt;li&gt;do a null check rather than populating an empty commonSuffixRef&lt;/li&gt;
	&lt;li&gt;localize the &apos;linear&apos; case to not seek, but instead scan, when ping-ponging against loops in the state machine&lt;/li&gt;
	&lt;li&gt;add a mechanism to enable/disable the terms dict cache, e.g. we can disable it for infinite cases, and maybe fuzzy N&amp;gt;1 also.&lt;/li&gt;
	&lt;li&gt;change the use of BitSet to OpenBitSet or long[] gen for path-tracking&lt;/li&gt;
	&lt;li&gt;optimize the backtracking code where it says /* String is good to go as-is */, this need not be a full run(), I think...&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12460442">LUCENE-2351</key>
            <summary>optimize automatonquery</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Mar 2010 16:03:11 +0000</created>
                <updated>Fri, 10 May 2013 11:43:42 +0100</updated>
                    <resolved>Tue, 30 Mar 2010 11:07:11 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12850542" author="mikemccand" created="Sat, 27 Mar 2010 16:15:30 +0000"  >&lt;p&gt;Patch to adress some of the optos:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Adds optional &quot;boolean useCache&quot; to TermsEnum.seek&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds protected FilteredTermsEnum.set/getUseTermsCache, so each query type can choose (defaults to false)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Switches to long[] gen in AutomatonTermsEnum.nextString&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Use commonSuffixRef = null to mean there is no suffix&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12850545" author="mikemccand" created="Sat, 27 Mar 2010 16:27:30 +0000"  >&lt;p&gt;The attached patch improves sneaky wildcard query &quot;un*t&quot; (on a 5M doc wikipedia index, matching 1058 terms --&amp;gt; 124623 docs) from 39.69 QPS -&amp;gt; 44.85 QPS (best of 5) on flex.  But trunk is at 63.19 QPS so we still have more to do...&lt;/p&gt;</comment>
                    <comment id="12850546" author="thetaphi" created="Sat, 27 Mar 2010 16:29:36 +0000"  >&lt;p&gt;This one should be final:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SeekStatus seek(BytesRef text) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; seek(text, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As codecs and other implementations should only override the other one. And it will get inlined.&lt;/p&gt;</comment>
                    <comment id="12850565" author="rcmuir" created="Sat, 27 Mar 2010 19:25:24 +0000"  >&lt;p&gt;attached is a patch to optimize &quot;infinite transitions&quot;&lt;/p&gt;

&lt;p&gt;its extremely ugly, likely incorrect in some ways too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12850705" author="rcmuir" created="Sun, 28 Mar 2010 18:54:01 +0100"  >&lt;p&gt;updated version of the previous patch. should be more correct, and faster in my benchmarks.&lt;/p&gt;</comment>
                    <comment id="12850798" author="rcmuir" created="Mon, 29 Mar 2010 07:38:57 +0100"  >&lt;p&gt;attached is a new approach:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;rids of linearmode&lt;/li&gt;
	&lt;li&gt;adds real support for infinite automata, to prevent useless seeking.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;when any loop is encountered in the state machine, a portion of the term dictionary&lt;br/&gt;
is calculated based on its transition ranges, and for this portion, the enumeration is &lt;br/&gt;
instead driven from the terms dictionary rather than the state machine.&lt;/p&gt;

&lt;p&gt;not really 100% on how i feel about this yet, but it seems right.&lt;/p&gt;</comment>
                    <comment id="12850844" author="mikemccand" created="Mon, 29 Mar 2010 09:59:17 +0100"  >&lt;p&gt;OOOH I like this approach!!  It makes the linear decision &quot;local&quot;, and bounds (by linearUpperBound) the region so that we don&apos;t have to revisit the decision on every term.  And it enables efficiently using the suffix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;And.... it&apos;s FAST!  With this fix, the hard query (un*t) on flex is 105 QPS (best of 5, on 5 M doc wikipedia index), vs 62 QPS on trunk.  Yay &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12851337" author="rcmuir" created="Tue, 30 Mar 2010 10:59:27 +0100"  >&lt;p&gt;attached is the same patch as before, except it includes a random test for Automaton.&lt;br/&gt;
I stole the code from TestStressIndexing and create random unicode terms, and random regular expressions,&lt;br/&gt;
and verify them against a brain-dead query that just brute forces every term.&lt;/p&gt;

&lt;p&gt;This found two unrelated bugs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;automaton didnt handle the &apos;empty term&apos; correctly.&lt;/li&gt;
	&lt;li&gt;there was a logic bug in UnicodeUtil.nextValidUTF16String&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;these are both also fixed in the patch... will commit soon.&lt;/p&gt;</comment>
                    <comment id="12851339" author="rcmuir" created="Tue, 30 Mar 2010 11:07:11 +0100"  >&lt;p&gt;Committed revision 929065.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12440014" name="LUCENE-2351_infinite.patch" size="3329" author="rcmuir" created="Sun, 28 Mar 2010 18:54:01 +0100" />
                    <attachment id="12439975" name="LUCENE-2351_infinite.patch" size="3251" author="rcmuir" created="Sat, 27 Mar 2010 19:25:24 +0000" />
                    <attachment id="12440196" name="LUCENE-2351.patch" size="25879" author="rcmuir" created="Tue, 30 Mar 2010 10:59:27 +0100" />
                    <attachment id="12440041" name="LUCENE-2351.patch" size="14884" author="rcmuir" created="Mon, 29 Mar 2010 07:38:57 +0100" />
                    <attachment id="12439968" name="LUCENE-2351.patch" size="11145" author="mikemccand" created="Sat, 27 Mar 2010 16:15:30 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 27 Mar 2010 16:15:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11445</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25339</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>