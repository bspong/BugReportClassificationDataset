<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:07:56 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1040/LUCENE-1040.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1040] Can&apos;t quickly create StopFilter</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1040</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Due to the use of CharArraySet by StopFilter, one can no longer efficiently pre-create a Set for use by future StopFilter instances.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12381579">LUCENE-1040</key>
            <summary>Can&apos;t quickly create StopFilter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Oct 2007 21:02:12 +0000</created>
                <updated>Tue, 16 Sep 2008 22:27:48 +0100</updated>
                    <resolved>Tue, 16 Sep 2008 22:27:48 +0100</resolved>
                                                                    <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12539188" author="yseeley@gmail.com" created="Wed, 31 Oct 2007 21:07:15 +0000"  >&lt;p&gt;Attaching patch.  Here&apos;s the approach I took:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change makeStopSet return a CharArraySet&lt;/li&gt;
	&lt;li&gt;make CharArraySet a real Set (plus many other small changes)&lt;/li&gt;
	&lt;li&gt;the Iterator returns Strings for backward compatibility with people that&lt;br/&gt;
   expect a Set&amp;lt;String&amp;gt;&lt;/li&gt;
	&lt;li&gt;StopFilter constructor to directly use Set if instanceof CharArraySet&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                    <comment id="12539273" author="hossman" created="Thu, 1 Nov 2007 02:25:33 +0000"  >&lt;p&gt;If the StopFilter constructor that takes in a Set no longer needs the &quot;boolean ignoreCase&quot; we should probably: deprecate that constructor, document that ignoreCase is ignoredand the Set must only contain lowercase items, add a new Set based constructor without that param.&lt;/p&gt;</comment>
                    <comment id="12539319" author="mikemccand" created="Thu, 1 Nov 2007 09:41:00 +0000"  >
&lt;p&gt;Woops, you&apos;re right, sorry about that, and thanks for fixing it Yonik!&lt;/p&gt;

&lt;p&gt;I made a few small changes to your patch (attached&lt;br/&gt;
CharArraySet.take2.patch): there were some problems with rehashing, so&lt;br/&gt;
I also added a new unit test (don&apos;t forget to &quot;svn add&quot; before&lt;br/&gt;
committing!).  All tests pass.&lt;/p&gt;

&lt;p&gt;I noticed that in your patch you now assume that String.hashCode() is&lt;br/&gt;
always as described in Sun&apos;s javadocs, but that makes me a little&lt;br/&gt;
nervous, eg:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;http://forum.java.sun.com/thread.jspa?threadID=762602&amp;amp;messageID=4351604&quot; class=&quot;external-link&quot;&gt;http://forum.java.sun.com/thread.jspa?threadID=762602&amp;amp;messageID=4351604&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe for the String case we should continue computing hashCode&lt;br/&gt;
ourselves?&lt;/p&gt;</comment>
                    <comment id="12539422" author="yseeley@gmail.com" created="Thu, 1 Nov 2007 17:43:15 +0000"  >&lt;p&gt;&amp;gt; I noticed that in your patch you now assume that String.hashCode() is always as described in Sun&apos;s javadocs&lt;/p&gt;

&lt;p&gt;The fact that it&apos;s in their javadocs seems to make it part of the interface though.&lt;br/&gt;
Using String.hash (for cached strings - hashCode already calculated) resulted in a 15% lookup improvement.&lt;/p&gt;

&lt;p&gt;Side note: looking up char[] was faster in any event... probably because the extra bounds checking code for every String.charAt()&lt;/p&gt;

&lt;p&gt;On the other hand... not being tied to String.hashCode() means we could select a faster method if we chose to do so.&lt;/p&gt;</comment>
                    <comment id="12539423" author="yseeley@gmail.com" created="Thu, 1 Nov 2007 17:45:23 +0000"  >&lt;p&gt;&amp;gt; If the StopFilter constructor that takes in a Set no longer needs the &quot;boolean ignoreCase&quot;&lt;/p&gt;

&lt;p&gt;But it does if the Set is not a CharArraySet.&lt;br/&gt;
Docs should be clearer though that ignoreCase is ignored if passing a CharArraySet (or is there a more sane way?)&lt;/p&gt;</comment>
                    <comment id="12539469" author="hossman" created="Thu, 1 Nov 2007 21:09:51 +0000"  >&lt;p&gt;&amp;gt; But it does if the Set is not a CharArraySet.&lt;br/&gt;
&amp;gt; Docs should be clearer though that ignoreCase is ignored if passing a CharArraySet (or is there a more sane way?)&lt;/p&gt;

&lt;p&gt;Hmmm... actually .. does making the CharArraySet capable of doing case insensitive comparisons over complicate things?  perhaps the CharArraySet should just be a set of strings that supports fast lookup lookup of strings, and StopFilter.next should be responsible for lowercasing the terms before doing the set lookup (and makeStopSet should be responsible for lowercasing hte tersm before putting them in the set).  it would probably be good to change the sigs to something like StopFilter(TokenStream s, Set stopWords, boolean lowerCaseBeforeLookup) and makeStopSet(String[] stopWords, boolean lowerCaseBeforeAdding) so it was clear what expectations StopFilter has on the set if people make one from scratch.&lt;/p&gt;

&lt;p&gt;this is kind of an orthogonal API discussion to the CharArraySet issue though ... the same arguments could be made about the 2.2 instance of StopFilter ... i just bring it up as a potential point of confusion since people could expect these two work the same way, and they wont (unless i&apos;m missing something)...&lt;/p&gt;

&lt;p&gt;   Set a = ...; // something with lots of mixed case words&lt;br/&gt;
   Set b = new CharArraySet(a, false);&lt;br/&gt;
   StopFilter aaa = new StopFilter(stream, a, true)&lt;br/&gt;
   StopFilter bbb = new StopFilter(stream, b, true)&lt;/p&gt;

</comment>
                    <comment id="12539599" author="yseeley@gmail.com" created="Fri, 2 Nov 2007 14:44:24 +0000"  >&lt;p&gt;&amp;gt; and StopFilter.next should be responsible for lowercasing the terms before doing the set lookup&lt;/p&gt;

&lt;p&gt;That would force the user (StopFilter) to make a copy since it wouldn&apos;t want to touch the original.&lt;/p&gt;</comment>
                    <comment id="12539677" author="hossman" created="Fri, 2 Nov 2007 19:23:19 +0000"  >&lt;p&gt;Hmmm... i was going to say &quot;would one String.toLowerCase() in StopFilter.next really be any worse then the Character.toLowerCase() that are currently done in CharArraySet?&quot; but i suppose it might be in the typical stopword cases where most words on stop words (so the character based approach can short circuit early (not that i&apos;ve actually benchmarked it).&lt;/p&gt;

&lt;p&gt;i suppose it&apos;s best to leave the API as it is ... but document the hell out of when/how ignoreCase is significant .. make it clear that the value passed to the StopFilter constructor must be consistent with the value passed to makeStopSet if both are used (actually: we could assert that in the StopFilter constructor if we add a CharArraySet.getIgnoreCase() method)&lt;/p&gt;</comment>
                    <comment id="12543847" author="mikemccand" created="Tue, 20 Nov 2007 10:37:33 +0000"  >&lt;p&gt;Yonik, I think you missed my proposed update to your original patch, here?&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1040#action_12539319&quot; class=&quot;external-link&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-1040#action_12539319&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;EG, there are some problems with the changes to rehash (and I added a unit-test to expose them).&lt;/p&gt;</comment>
                    <comment id="12543903" author="yseeley@gmail.com" created="Tue, 20 Nov 2007 14:29:03 +0000"  >&lt;p&gt;Indeed... thanks for catching that!&lt;/p&gt;</comment>
                    <comment id="12631559" author="gsingers" created="Tue, 16 Sep 2008 22:27:48 +0100"  >&lt;p&gt;Appears to have been committed.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12368790" name="CharArraySet.patch" size="14468" author="yseeley@gmail.com" created="Wed, 31 Oct 2007 21:07:14 +0000" />
                    <attachment id="12368807" name="CharArraySet.take2.patch" size="16476" author="mikemccand" created="Thu, 1 Nov 2007 09:41:00 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 1 Nov 2007 02:25:33 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12705</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26689</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>