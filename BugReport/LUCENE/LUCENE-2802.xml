<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:38 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2802/LUCENE-2802.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2802] DirectoryReader ignores NRT SegmentInfos in #isOptimized()</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2802</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;DirectoryReader  only takes shared (with IW) SegmentInfos into account in DirectoryReader#isOptimized(). This can return true even if the actual realtime reader sees more than one segments. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isOptimized() {
    ensureOpen();
   &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; segmentsInfos changes in IW &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; positive
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; segmentInfos.size() == 1 &amp;amp;&amp;amp; !hasDeletions();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;DirectoryReader should check if this reader has a non-nul segmentInfosStart and use that instead&lt;/p&gt;</description>
                <environment></environment>
            <key id="12492154">LUCENE-2802</key>
            <summary>DirectoryReader ignores NRT SegmentInfos in #isOptimized()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Dec 2010 13:39:44 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:21 +0100</updated>
                    <resolved>Wed, 8 Dec 2010 13:49:02 +0000</resolved>
                            <version>3.1</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12967185" author="simonw" created="Mon, 6 Dec 2010 13:41:18 +0000"  >&lt;p&gt;here is a patch&lt;/p&gt;</comment>
                    <comment id="12967213" author="mikemccand" created="Mon, 6 Dec 2010 15:15:51 +0000"  >&lt;p&gt;Nice catch Simon!  This is also a thread safety issue since IR should not touch the writer&apos;s segmentInfos outside of sync(IW).&lt;/p&gt;</comment>
                    <comment id="12967227" author="simonw" created="Mon, 6 Dec 2010 15:42:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Nice catch Simon! This is also a thread safety issue since IR should not touch the writer&apos;s segmentInfos outside of sync(IW).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;it seem like there is more about all that in DR - we should really only use the uncloned SegmentInfos if we are not in NRT mode #getVersion uses it too which is wrong.&lt;br/&gt;
I actually rely on the isOptimized in several tests and run into a NPE due to that though so we should really fix DR to use a private SegmentInfos or restrict the uncloned one for the isCurrent comparison&lt;/p&gt;
</comment>
                    <comment id="12967238" author="earwin" created="Mon, 6 Dec 2010 16:07:12 +0000"  >&lt;p&gt;Heh, I&apos;ve &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2355?focusedCommentId=12874857&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12874857&quot; class=&quot;external-link&quot;&gt;mentioned&lt;/a&gt; this earlier in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2355&quot; title=&quot;Refactor Directory/Multi/SegmentReader creation/reopening/cloning/closing&quot;&gt;LUCENE-2355&lt;/a&gt;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12968418" author="simonw" created="Mon, 6 Dec 2010 21:26:02 +0000"  >&lt;p&gt;I changed DirectoryReader to use the cloned version of SegmentInfos instead of two of them inconsistently. The only failure I get is on TestIndexWriterReader line 105 &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    r1.close();
    writer.close();
    assertTrue(r2.isCurrent());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where the writer is closed and afterwards it checks if the r2 reader still is the current one which failes since the writer.close() method changes the version of the SegmentInfos. In my opinion this is actually the semantics I would expect from #isCurrent(), the question is if we would want to change the semantics to return false from #isCurrent if the writer we used to obtain the reader from is closed.&lt;/p&gt;

&lt;p&gt;I think we should consider it for consistency and simplicity though. &lt;/p&gt;</comment>
                    <comment id="12968493" author="simonw" created="Mon, 6 Dec 2010 23:48:43 +0000"  >&lt;p&gt;here is a patch that removes the mutable state from DirectoryReader in the NRT case. The actual reason IMO why this has been introduced was that the RT reader returns true from #isCurrent() if the wirter was closed which is actually wrong since closing a writer changes the index and the reader should see that change.&lt;/p&gt;

&lt;p&gt;I also added a testcase for is current to check the semantics&lt;/p&gt;</comment>
                    <comment id="12968495" author="simonw" created="Mon, 6 Dec 2010 23:58:37 +0000"  >&lt;p&gt;we need to backport to 3.x too&lt;/p&gt;</comment>
                    <comment id="12968503" author="earwin" created="Tue, 7 Dec 2010 00:17:00 +0000"  >&lt;p&gt;Patch looks cool.&lt;/p&gt;</comment>
                    <comment id="12969047" author="simonw" created="Tue, 7 Dec 2010 22:29:29 +0000"  >&lt;p&gt;here is a final patch - i will commit later!&lt;/p&gt;
</comment>
                    <comment id="12969139" author="simonw" created="Wed, 8 Dec 2010 02:02:48 +0000"  >&lt;p&gt;Committed revision 1043277.&lt;/p&gt;

&lt;p&gt;I keep it open for backporting&lt;/p&gt;</comment>
                    <comment id="12969307" author="simonw" created="Wed, 8 Dec 2010 13:49:02 +0000"  >&lt;p&gt;Ported back to 3x in revision 1043418.&lt;/p&gt;</comment>
                    <comment id="13013451" author="gsingers" created="Wed, 30 Mar 2011 16:50:21 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                                <inwardlinks description="is blocked by">
                            <issuelink>
            <issuekey id="12492568">LUCENE-2805</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12460476">LUCENE-2355</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12465747" name="LUCENE-2802.patch" size="4307" author="simonw" created="Tue, 7 Dec 2010 22:29:29 +0000" />
                    <attachment id="12465635" name="LUCENE-2802.patch" size="5166" author="simonw" created="Mon, 6 Dec 2010 23:48:43 +0000" />
                    <attachment id="12465374" name="LUCENE-2802.patch" size="595" author="simonw" created="Mon, 6 Dec 2010 13:41:18 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 6 Dec 2010 15:15:51 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11055</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24890</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>