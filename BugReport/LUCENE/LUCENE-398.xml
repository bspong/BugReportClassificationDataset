<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:06:41 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-398/LUCENE-398.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-398] ParallelReader crashes when trying to merge into a new index</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-398</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;ParallelReader causes a NullPointerException in&lt;br/&gt;
org.apache.lucene.index.ParallelReader$ParallelTermPositions.seek(ParallelReader.java:318)&lt;br/&gt;
when trying to merge into a new index.&lt;/p&gt;

&lt;p&gt;See test case and sample output:&lt;/p&gt;

&lt;p&gt;$ svn diff&lt;br/&gt;
Index: src/test/org/apache/lucene/index/TestParallelReader.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/test/org/apache/lucene/index/TestParallelReader.java    (revision 179785)&lt;br/&gt;
+++ src/test/org/apache/lucene/index/TestParallelReader.java    (working copy)&lt;br/&gt;
@@ -57,6 +57,13 @@&lt;/p&gt;

&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;+  public void testMerge() throws Exception {&lt;br/&gt;
+    Directory dir = new RAMDirectory();&lt;br/&gt;
+    IndexWriter w = new IndexWriter(dir, new StandardAnalyzer(), true);&lt;br/&gt;
+    w.addIndexes(new IndexReader[] &lt;/p&gt;
{ ((IndexSearcher)
parallel).getIndexReader() }
&lt;p&gt;);&lt;br/&gt;
+    w.close();&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
   private void queryTest(Query query) throws IOException {&lt;br/&gt;
     Hits parallelHits = parallel.search(query);&lt;br/&gt;
     Hits singleHits = single.search(query);&lt;br/&gt;
$ ant -Dtestcase=TestParallelReader test&lt;br/&gt;
Buildfile: build.xml&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
test:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;mkdir&amp;#93;&lt;/span&gt; Created dir:&lt;br/&gt;
/Users/skirsch/text/lectures/da/thirdparty/lucene-trunk/build/test&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testsuite: org.apache.lucene.index.TestParallelReader&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 2, Failures: 0, Errors: 1, Time elapsed: 1.993 sec&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testcase: testMerge(org.apache.lucene.index.TestParallelReader):  &lt;br/&gt;
Caused an ERROR&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; null&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; java.lang.NullPointerException&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.ParallelReader$ParallelTermPositions.seek(ParallelReader.java:318)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.ParallelReader$ParallelTermDocs.seek(ParallelReader.java:294)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.SegmentMerger.appendPostings(SegmentMerger.java:325)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.SegmentMerger.mergeTermInfo(SegmentMerger.java:296)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.SegmentMerger.mergeTermInfos(SegmentMerger.java:270)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:234)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:96)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.IndexWriter.addIndexes(IndexWriter.java:596)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.lucene.index.TestParallelReader.testMerge(TestParallelReader.java:63)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;


&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.lucene.index.TestParallelReader FAILED&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
/Users/skirsch/text/lectures/da/thirdparty/lucene-trunk/common-build.xml:188:&lt;br/&gt;
Tests failed!&lt;/p&gt;

&lt;p&gt;Total time: 16 seconds&lt;br/&gt;
$&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
            <key id="12314548">LUCENE-398</key>
            <summary>ParallelReader crashes when trying to merge into a new index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="apache-bugzilla@sebastian-kirsch.org">Sebastian Kirsch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jun 2005 05:50:34 +0100</created>
                <updated>Fri, 10 May 2013 11:43:44 +0100</updated>
                    <resolved>Wed, 21 Jun 2006 04:43:17 +0100</resolved>
                                            <fixVersion>2.1</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12322448" author="lucenebugs@danielnaber.de" created="Wed, 22 Jun 2005 06:55:09 +0100"  >&lt;p&gt;Created an attachment (id=15503)&lt;br/&gt;
possible fix (untested)&lt;/p&gt;

&lt;p&gt;The problem might be that in ParallelReader, the &quot;readers&quot; list is never&lt;br/&gt;
actually modified. This tries to fix it (not tested at all, sorry).&lt;/p&gt;</comment>
                    <comment id="12322449" author="apache-bugzilla@sebastian-kirsch.org" created="Wed, 22 Jun 2005 19:19:55 +0100"  >&lt;p&gt;Created an attachment (id=15509)&lt;br/&gt;
Attempt to fix it, which causes an exception in TermInfosReader instead&lt;/p&gt;

&lt;p&gt;(In reply to comment #1)&lt;br/&gt;
&amp;gt; Created an attachment (id=15503) &lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt;&lt;br/&gt;
&amp;gt; possible fix (untested)&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The problem might be that in ParallelReader, the &quot;readers&quot; list is never&lt;br/&gt;
&amp;gt; actually modified. This tries to fix it (not tested at all, sorry).&lt;/p&gt;

&lt;p&gt;I tried your suggestion, but it does not change the symptoms.&lt;/p&gt;

&lt;p&gt;I also tried a different approach, passing the null argument to seek() on to&lt;br/&gt;
the individual IndexReaders and let them deal with it, but this causes a&lt;br/&gt;
NullPointerException in a different place&lt;br/&gt;
(org.apache.lucene.index.TermInfosReader.get(TermInfosReader.java:140))&lt;/p&gt;

&lt;p&gt;See attached diff and test output.&lt;/p&gt;</comment>
                    <comment id="12416734" author="kohlschuetter" created="Mon, 19 Jun 2006 18:18:59 +0100"  >&lt;p&gt;The NullPointerException is probably caused by a broken implementation of ParallelTermEnum.next().&lt;br/&gt;
The method does not find the next field properly, especially if a field was marked &quot;indexed&quot; but did not contain any terms.&lt;/p&gt;

&lt;p&gt;The attached patch (for Lucene 2.0) should help; a testcase is included.&lt;/p&gt;</comment>
                    <comment id="12416735" author="kohlschuetter" created="Mon, 19 Jun 2006 18:20:31 +0100"  >&lt;p&gt;Patches broken implementation of ParallelTermEnum.next()&lt;/p&gt;</comment>
                    <comment id="12416736" author="kohlschuetter" created="Mon, 19 Jun 2006 18:22:47 +0100"  >&lt;p&gt;JUnit Testcase that triggers the bug.&lt;/p&gt;</comment>
                    <comment id="12416782" author="kohlschuetter" created="Tue, 20 Jun 2006 00:23:21 +0100"  >&lt;p&gt;Files:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12335614/patch-next.diff&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/secure/attachment/12335614/patch-next.diff&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12335615/ParallelReaderTest1.java&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/secure/attachment/12335615/ParallelReaderTest1.java&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12416798" author="manawiz" created="Tue, 20 Jun 2006 03:28:49 +0100"  >&lt;p&gt;Christian,&lt;/p&gt;

&lt;p&gt;I think you can make this more efficient by caching the field iterator.  You only need to generate it at the first transition to a new field.&lt;/p&gt;

&lt;p&gt;Chuck&lt;/p&gt;</comment>
                    <comment id="12416837" author="manawiz" created="Tue, 20 Jun 2006 10:23:15 +0100"  >&lt;p&gt;Christian,&lt;/p&gt;

&lt;p&gt;I&apos;m going to open a new issue on this in order to rename it, post a revised patch, and hopefully get the attention of a committer.&lt;/p&gt;

&lt;p&gt;Chuck&lt;/p&gt;</comment>
                    <comment id="12416838" author="manawiz" created="Tue, 20 Jun 2006 10:46:53 +0100"  >&lt;p&gt;Revised patch posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-607&quot; title=&quot;ParallelTermEnum is BROKEN&quot;&gt;&lt;del&gt;LUCENE-607&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12416985" author="yseeley@gmail.com" created="Wed, 21 Jun 2006 04:43:17 +0100"  >&lt;p&gt;Thanks for tracking this down Christian!&lt;br/&gt;
I&apos;ve committed Chuck&apos;s version of your patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-607&quot; title=&quot;ParallelTermEnum is BROKEN&quot;&gt;&lt;del&gt;LUCENE-607&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312643" name="ASF.LICENSE.NOT.GRANTED--parallelreader.diff" size="539" author="lucenebugs@danielnaber.de" created="Wed, 22 Jun 2005 06:55:09 +0100" />
                    <attachment id="12312644" name="ASF.LICENSE.NOT.GRANTED--ParallelReader.diff" size="3344" author="apache-bugzilla@sebastian-kirsch.org" created="Wed, 22 Jun 2005 19:19:55 +0100" />
                    <attachment id="12335615" name="ParallelReaderTest1.java" size="5488" author="kohlschuetter" created="Mon, 19 Jun 2006 18:22:47 +0100" />
                    <attachment id="12335614" name="patch-next.diff" size="1254" author="kohlschuetter" created="Mon, 19 Jun 2006 18:20:31 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35454</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 22 Jun 2005 05:55:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13351</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27333</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>