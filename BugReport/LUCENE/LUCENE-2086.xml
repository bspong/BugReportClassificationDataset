<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2086/LUCENE-2086.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2086] When resolving deletes, IW should resolve in term sort order</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2086</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;See java-dev thread &quot;IndexWriter.updateDocument performance improvement&quot;.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12441299">LUCENE-2086</key>
            <summary>When resolving deletes, IW should resolve in term sort order</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Nov 2009 14:45:11 +0000</created>
                <updated>Thu, 25 Feb 2010 10:18:03 +0000</updated>
                    <resolved>Tue, 24 Nov 2009 13:48:58 +0000</resolved>
                                            <fixVersion>2.9.2</fixVersion>
                <fixVersion>3.0.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12780657" author="mikemccand" created="Fri, 20 Nov 2009 17:11:47 +0000"  >&lt;p&gt;Attached patch.&lt;/p&gt;</comment>
                    <comment id="12780670" author="yseeley@gmail.com" created="Fri, 20 Nov 2009 17:39:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;for better locality for the disk heads&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not just the disk heads, right? &lt;br/&gt;
I assumed the majority of the benefit was due to the cached TermEnum scan (instead of a seek) in TermInfosReader.get()&lt;/p&gt;

</comment>
                    <comment id="12780680" author="mikemccand" created="Fri, 20 Nov 2009 18:02:54 +0000"  >&lt;p&gt;Ahh, you&apos;re right, so long as your deletes are within the same index block (128 terms in length), we avoid the binary search through the terms index and simply scan within the block.  Though, you need relatively high density of deletions to see that.  Also, no matter what when you cross an indexed term, the binary search will be done.  I&apos;ll genericize the language in the CHANGES entry.&lt;/p&gt;

&lt;p&gt;And actually this reminds to go make sure the flex branch is doing this optimization too...&lt;/p&gt;</comment>
                    <comment id="12780682" author="mikemccand" created="Fri, 20 Nov 2009 18:07:48 +0000"  >&lt;p&gt;OK I changed changes entry to:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2086&quot; title=&quot;When resolving deletes, IW should resolve in term sort order&quot;&gt;&lt;del&gt;LUCENE-2086&lt;/del&gt;&lt;/a&gt;: When resolving deleted terms, do so in term sort order&lt;br/&gt;
  for better performance (Bogdan Ghidireac via Mike McCandless)&lt;/li&gt;
&lt;/ul&gt;

</comment>
                    <comment id="12780685" author="yseeley@gmail.com" created="Fri, 20 Nov 2009 18:13:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;Though, you need relatively high density of deletions to see that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, but re-indexing a whole bunch of documents is a common case - and that will give a very high density (often consecutive terms).&lt;br/&gt;
Also, it may be a complete index build / rebuild, where all the terms will be consecutive.  Solr, for instance, can&apos;t tell if there are any duplicates when building an index from scratch, so it must use update().  There is a way to tell Solr not to enforce duplicate overwriting (overwrite=false param) but I doubt many people do that, and it risks user error (using it when there are dups in the docs being added, or already in the index).&lt;/p&gt;</comment>
                    <comment id="12780690" author="mikemccand" created="Fri, 20 Nov 2009 18:23:50 +0000"  >&lt;p&gt;Excellent, so this is an important optimization!  I&apos;ll commit shortly...&lt;/p&gt;</comment>
                    <comment id="12780698" author="tsmith" created="Fri, 20 Nov 2009 18:30:39 +0000"  >&lt;p&gt;any chance this can go into 3.0.0 or a 3.0.1?&lt;/p&gt;</comment>
                    <comment id="12780700" author="mikemccand" created="Fri, 20 Nov 2009 18:33:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;any chance this can go into 3.0.0 or a 3.0.1?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think it should be backported (it&apos;s an optimization).  Generally we &lt;span class=&quot;error&quot;&gt;&amp;#91;should&amp;#93;&lt;/span&gt; only back port bug fixes.&lt;/p&gt;</comment>
                    <comment id="12780701" author="tsmith" created="Fri, 20 Nov 2009 18:36:26 +0000"  >&lt;p&gt;i&apos;ve seen the deletes dominating commit time quite often, so obviously it would be very useful to be able to absorb this optimization sooner than later (whats the timeframe for 3.1?)&lt;/p&gt;

&lt;p&gt;otherwise i&apos;ll have to override the classes involved and pull in this patch (never like this approach myself)&lt;/p&gt;</comment>
                    <comment id="12780703" author="jasonrutherglen" created="Fri, 20 Nov 2009 18:40:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think it should be backported (it&apos;s an optimization). Generally we &lt;span class=&quot;error&quot;&gt;&amp;#91;should&amp;#93;&lt;/span&gt; only back port bug fixes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It doesn&apos;t break backwards compatibility and it&apos;s well under the hood so it seems like something that go into a sub decimal release?&lt;/p&gt;</comment>
                    <comment id="12780706" author="mikemccand" created="Fri, 20 Nov 2009 18:48:59 +0000"  >
&lt;blockquote&gt;&lt;p&gt;i&apos;ve seen the deletes dominating commit time quite often, so obviously it would be very useful to be able to absorb this optimization sooner than later (whats the timeframe for 3.1?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure how much gain you can expect from this patch (there are&lt;br/&gt;
many factors involved) &amp;#8211; maybe try it &amp;amp; report back?&lt;/p&gt;

&lt;p&gt;Not sure what the timeframe is for 3.1 at this point...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;otherwise i&apos;ll have to override the classes involved and pull in this patch (never like this approach myself)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I understand... you could run with trunk (and report back!) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t break backwards compatibility and it&apos;s well under the hood so it seems like something that go into a sub decimal release?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I know it&apos;s tempting to do so, but I think it&apos;s important to hold the&lt;br/&gt;
line on only back-porting important bug fixes... as innocent as this&lt;br/&gt;
change looks, it&apos;s always possible I screwed something up, and so&lt;br/&gt;
why risk a point release with that?  Point releases are supposed to&lt;br/&gt;
be as stable as we can possibly make them.&lt;/p&gt;

&lt;p&gt;This way the change has plenty of time to &quot;bake&quot; on trunk and if&lt;br/&gt;
something is amiss we&apos;ll have much more time/attention to catch it.&lt;/p&gt;

&lt;p&gt;I&apos;d rather see us release a 3.1 sooner rather than later, instead.&lt;/p&gt;</comment>
                    <comment id="12780710" author="tsmith" created="Fri, 20 Nov 2009 18:51:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;maybe try it &amp;amp; report back?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;i&apos;ll see if i can find some cycles to try this against the most painful use case i have&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d rather see us release a 3.1 sooner rather than later, instead.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes please.&lt;br/&gt;
I would definitely like to see a more accelerated release cycle (even if less functionality gets into each minor release)&lt;/p&gt;</comment>
                    <comment id="12781615" author="tsmith" created="Mon, 23 Nov 2009 20:56:43 +0000"  >&lt;p&gt;Got some performance numbers:&lt;/p&gt;

&lt;p&gt;Description of test (NOTE: this is representative of actions that may occur in a running system (not a contrived test)):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;feed 4 million operations (3/4 are deletes, 1/4 are updates (single field))&lt;/li&gt;
	&lt;li&gt;commit&lt;/li&gt;
	&lt;li&gt;feed 1 million updates (about 1/3 are updates, 2/3/ deletes (randomly selected))&lt;/li&gt;
	&lt;li&gt;commit&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Numbers:&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Desc &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Old &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; New &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; feed 4 million &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 56914ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 15698ms &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; commit 4 million &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 9072ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 14291ms &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; total (4 million) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 65986ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 29989ms &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; update 1 million &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 46096ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 11340ms &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; commit 1 million &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 13501ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 9273ms &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; total (1 million) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 59597ms &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20613ms &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;This shows significant improvements with new patched data (1/3 the time for 1 million, about 1/2 the time for initial 4 million feed)&lt;/p&gt;

&lt;p&gt;This means i&apos;m gonna definitely need to incorporate this patch while i&apos;m still on 3.0 (will upgrade to 3.0 as soon as its out, then apply this fix) &lt;br/&gt;
Ideally, a 3.0.1 would be forthcoming in the next month or so with this fix so i wouldn&apos;t have to maintain this patched overlay of code&lt;/p&gt;



</comment>
                    <comment id="12781654" author="mikemccand" created="Mon, 23 Nov 2009 22:14:11 +0000"  >&lt;p&gt;Hmm these really are sizable gains!  Thanks for testing.&lt;/p&gt;

&lt;p&gt;I guess since the change is so minor and the gains so sizable we should back port for 3.0.1.  If nobody objects I&apos;ll do so in a day or two...&lt;/p&gt;</comment>
                    <comment id="12781663" author="thetaphi" created="Mon, 23 Nov 2009 22:20:44 +0000"  >&lt;p&gt;No problem, you can commit to 3.0 branch as soon as the 3 votes for the release are there and I can release the current artifacts.&lt;/p&gt;</comment>
                    <comment id="12781666" author="markrmiller@gmail.com" created="Mon, 23 Nov 2009 22:23:56 +0000"  >&lt;p&gt;No objection, but its an awkward precedent - you can see any bleeding edge user always wanting the latest optimization in the next bug fix release (considering how long you&apos;ll likely have to wait for x.n).&lt;/p&gt;

&lt;p&gt;But as I&apos;m one that was somewhat pro this for 2.9 (due to some being stuck on 1.4), I won&apos;t try and stop it here. I&apos;m a big fan of case by case in general anyway. I agree with your previous comment about trying to keep a bug fix release as stable as possible - and this being a minor change, that would seemt to go along with it - but code is a funny beast, even when dealing with the simple ...&lt;/p&gt;</comment>
                    <comment id="12781680" author="mikemccand" created="Mon, 23 Nov 2009 22:36:40 +0000"  >&lt;p&gt;Yeah there&apos;s an exception to every rule &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Fast forward a month or two, if we find out I somehow broke 3.0.1 by back-porting this fix, I&apos;ll be real grumpy!&lt;/p&gt;</comment>
                    <comment id="12781687" author="mikemccand" created="Mon, 23 Nov 2009 22:56:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;No problem, you can commit to 3.0 branch as soon as the 3 votes for the release are there and I can release the current artifacts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;BTW can&apos;t/won&apos;t you cut the tag back on the right revision, anyway?  Ie why freeze the 3.0 branch from any backports?&lt;/p&gt;</comment>
                    <comment id="12781806" author="thetaphi" created="Tue, 24 Nov 2009 07:16:12 +0000"  >&lt;p&gt;Just commit it. It is so simple, so if I respin, it can be in 3.0.0.&lt;/p&gt;

&lt;p&gt;I did&apos;nt want to have commits in 3.0, because if I respin a release, I would not be able to only take &lt;b&gt;some&lt;/b&gt; of the fixes into 3.0.0. That was the reason.&lt;/p&gt;

&lt;p&gt;Can you put this also in 2.9.2 if you remove the generics?&lt;/p&gt;</comment>
                    <comment id="12781837" author="mikemccand" created="Tue, 24 Nov 2009 09:39:36 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I did&apos;nt want to have commits in 3.0, because if I respin a release, I would not be able to only take some of the fixes into 3.0.0. That was the reason.&lt;/p&gt;

&lt;p&gt;Can you put this also in 2.9.2 if you remove the generics?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;OK I&apos;ll backport...&lt;/p&gt;</comment>
                    <comment id="12781925" author="mikemccand" created="Tue, 24 Nov 2009 13:40:25 +0000"  >&lt;p&gt;Backported to 3.0.x...&lt;/p&gt;

&lt;p&gt;2.9.x next.&lt;/p&gt;</comment>
                    <comment id="12781932" author="mikemccand" created="Tue, 24 Nov 2009 13:48:58 +0000"  >&lt;p&gt;OK backported to 2.9.x.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12425631" name="LUCENE-2086.patch" size="3771" author="mikemccand" created="Fri, 20 Nov 2009 17:11:47 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 20 Nov 2009 17:39:13 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11693</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25639</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>