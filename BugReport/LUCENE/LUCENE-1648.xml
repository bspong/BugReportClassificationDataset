<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:15:51 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1648/LUCENE-1648.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1648] when you clone or reopen an IndexReader with pending changes, the new reader doesn&apos;t commit the changes</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1648</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1647&quot; title=&quot;IndexReader.undeleteAll can mess up the deletion count stored in the segments file&quot;&gt;&lt;del&gt;LUCENE-1647&lt;/del&gt;&lt;/a&gt;, I came across this issue... we are failing to carry over hasChanges, norms/deletionsDirty, etc, when cloning the new reader.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12425944">LUCENE-1648</key>
            <summary>when you clone or reopen an IndexReader with pending changes, the new reader doesn&apos;t commit the changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 May 2009 18:54:45 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:25 +0100</updated>
                    <resolved>Sun, 7 Jun 2009 21:11:14 +0100</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12711378" author="earwin" created="Wed, 20 May 2009 22:54:31 +0100"  >&lt;p&gt;I wonder if the only two tests I still have failing for always-use-MSR patch are somehow related to this. They are:&lt;br/&gt;
testSegmentReaderDelDocsReferenceCounting(org.apache.lucene.index.TestIndexReaderClone)&lt;br/&gt;
testNormsRefCounting(org.apache.lucene.index.TestIndexReaderCloneNorms)&lt;/p&gt;

&lt;p&gt;Both die with an exception similar to&lt;br/&gt;
java.io.IOException: file &quot;_0_1.del&quot; was already written to&lt;br/&gt;
And I didn&apos;t yet have time to fully grok what&apos;s happening there. :/&lt;/p&gt;

&lt;p&gt;I do modifications through toplevel readers, assert state of their only segment reader and everything goes well until .flush() or .close() on toplevel reader.&lt;/p&gt;</comment>
                    <comment id="12711387" author="mikemccand" created="Wed, 20 May 2009 23:06:53 +0100"  >&lt;p&gt;Attached patch... I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12711388" author="mikemccand" created="Wed, 20 May 2009 23:08:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;I wonder if the only two tests I still have failing for always-use-MSR patch are somehow related to this. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Try the patch?&lt;/p&gt;

&lt;p&gt;For &quot;always use MSR&quot;, if you just fix open/reopen to never return MSR, it causes these failures?&lt;/p&gt;</comment>
                    <comment id="12711571" author="earwin" created="Thu, 21 May 2009 12:26:28 +0100"  >&lt;blockquote&gt;&lt;p&gt;Try the patch?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yup, it fixed everything.&lt;/p&gt;</comment>
                    <comment id="12711575" author="earwin" created="Thu, 21 May 2009 12:38:57 +0100"  >&lt;p&gt;Or to be more exact, it fixed the tests that were failing for me.&lt;br/&gt;
Your two new tests fail as soon as I apply &quot;always use MSR&quot;, because MSR does not carry over hasChanges/hasDeletions on clone().&lt;/p&gt;</comment>
                    <comment id="12711578" author="mikemccand" created="Thu, 21 May 2009 12:44:03 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Or to be more exact, it fixed the tests that were failing for me.&lt;br/&gt;
Your two new tests fail as soon as I apply &quot;always use MSR&quot;, because MSR does not carry over hasChanges/hasDeletions on clone().&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hmm, OK so it&apos;s a good news / bad news situation.&lt;/p&gt;

&lt;p&gt;Good news is patch resolved your original issue.  I&apos;ll commit it shortly.&lt;/p&gt;

&lt;p&gt;Bad news is something is wrong w/ your patch, because MSR needs to carry over hasChanges/deletions/norms on clone().&lt;/p&gt;</comment>
                    <comment id="12711589" author="earwin" created="Thu, 21 May 2009 13:04:15 +0100"  >&lt;blockquote&gt;&lt;p&gt;Bad news is something is wrong w/ your patch, because MSR needs to carry over hasChanges/deletions/norms on clone().&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Something is wrong with trunk.&lt;br/&gt;
Try the test in the patch. It is absolutely identical to yours, except it adds another doc to index to have two segments and consequently MSR.&lt;/p&gt;</comment>
                    <comment id="12711598" author="earwin" created="Thu, 21 May 2009 13:27:23 +0100"  >&lt;p&gt;And here&apos;s the fix.&lt;br/&gt;
The problem - it&apos;s not elegant at all. We can scrap it and I can do the fix within &quot;always use MSR&quot; patch, it looks way cleaner there.&lt;/p&gt;</comment>
                    <comment id="12711604" author="mikemccand" created="Thu, 21 May 2009 13:49:29 +0100"  >&lt;p&gt;OK &amp;#8211; good catch!  I&apos;ve reopened this (to remember this bug is present); let&apos;s fix this issue under &quot;always use MSR&quot;.&lt;/p&gt;</comment>
                    <comment id="12717089" author="earwin" created="Sun, 7 Jun 2009 21:00:50 +0100"  >&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1651&quot; title=&quot;Make IndexReader.open() always return MSR to simplify (re-)opens.&quot;&gt;&lt;del&gt;LUCENE-1651&lt;/del&gt;&lt;/a&gt; is now committed, this issue can be resolved.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10001">
                <name>dependent</name>
                                <outwardlinks description="depends upon">
                            <issuelink>
            <issuekey id="12426028">LUCENE-1651</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12408693" name="LUCENE-1648-followup.patch" size="2846" author="earwin" created="Thu, 21 May 2009 13:27:23 +0100" />
                    <attachment id="12408691" name="LUCENE-1648-followup.patch" size="1018" author="earwin" created="Thu, 21 May 2009 13:04:15 +0100" />
                    <attachment id="12408632" name="LUCENE-1648.patch" size="3350" author="mikemccand" created="Wed, 20 May 2009 23:06:53 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 20 May 2009 21:54:31 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12110</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26079</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>