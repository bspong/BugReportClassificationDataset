<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:04:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1998/LUCENE-1998.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1998] Use Java 5 enums</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1998</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Replace the use of o.a.l.util.Parameter with Java 5 enums, deprecating Parameter.&lt;/p&gt;

&lt;p&gt;Replace other custom enum patterns with Java 5 enums.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12438632">LUCENE-1998</key>
            <summary>Use Java 5 enums</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="dmsmith">DM Smith</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Oct 2009 23:25:05 +0100</created>
                <updated>Wed, 25 Nov 2009 16:47:56 +0000</updated>
                    <resolved>Wed, 21 Oct 2009 20:31:37 +0100</resolved>
                            <version>3.0</version>
                                <fixVersion>3.0</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12767981" author="dmsmith" created="Tue, 20 Oct 2009 23:27:49 +0100"  >&lt;p&gt;This issue and patch were part of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1257&quot; title=&quot;Port to Java5&quot;&gt;&lt;del&gt;LUCENE-1257&lt;/del&gt;&lt;/a&gt;, but may have backward compatibility issues. (I&apos;ll remove the patch from there.)&lt;/p&gt;</comment>
                    <comment id="12768118" author="thetaphi" created="Wed, 21 Oct 2009 08:23:36 +0100"  >&lt;p&gt;I tested it here, we have no backwards problem (at least with &quot;normal&quot; usage). The dynamic linker of Java when running old Java 1.4 code against the new enum classes has no problem with the replaced superclass: Old code compiled against Field.Store.XXX against lucene-core-2.9.jar with superclass Parameter works perfectly with the new lucene-core-3.0.jar. This works because we only use the parameter class as a type safe enumeration an did not call any methods (only maybe toString()) of it. So the linker has no problem.&lt;/p&gt;

&lt;p&gt;I would simply apply this ptach to trunk. I would also remove the Parameter class completely, as it breaks no code (only if somebody has used that class for own enums). Maybe we should deprecate Parameter in 2.9.1 and say that it will be removed in 3.0 as this version uses Java5&apos;s enum. But it also does not hurt if we keep it and mark it deprecated as in the patch.&lt;/p&gt;

&lt;p&gt;To your patch: I only added the license header back in the Version class. It must be there.&lt;/p&gt;</comment>
                    <comment id="12768119" author="thetaphi" created="Wed, 21 Oct 2009 08:24:40 +0100"  >&lt;p&gt;Patch with license header restored.&lt;/p&gt;</comment>
                    <comment id="12768128" author="thetaphi" created="Wed, 21 Oct 2009 09:29:58 +0100"  >&lt;p&gt;Some fine tuning: You defined package protected abstract methods, but made them public in the enum constant. Changed to all-public. This was also a backwards-break in contrib/queryParser.&lt;/p&gt;

&lt;p&gt;I think this is ready to commit.&lt;/p&gt;</comment>
                    <comment id="12768132" author="thetaphi" created="Wed, 21 Oct 2009 09:42:19 +0100"  >&lt;p&gt;Some samll problem that may appear in future: We had renamed some enum constants in 2.9 (TOKENIZED -&amp;gt; ANALYZED). No problems now, because deprec constants removed.&lt;/p&gt;

&lt;p&gt;If we want to do the same in future, we can do it the same way, but need to do a hack (because it is not officially supprted by Java 5):&lt;br/&gt;
&lt;a href=&quot;http://forums.sun.com/thread.jspa?threadID=5137742&quot; class=&quot;external-link&quot;&gt;http://forums.sun.com/thread.jspa?threadID=5137742&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So it works, but not with switch statements. Just as a comment. But in my opinion, renaming enum constants is a bad thing... &lt;/p&gt;</comment>
                    <comment id="12768195" author="thetaphi" created="Wed, 21 Oct 2009 13:22:29 +0100"  >&lt;p&gt;Updated patch (merged with StandardAnalyzer version constants). Also added Lucene version 3.0 for completeness to enable users to build apps and do not need to use the CURRENT constant.&lt;/p&gt;</comment>
                    <comment id="12768215" author="dmsmith" created="Wed, 21 Oct 2009 13:57:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;I only added the license header back in the Version class. It must be there.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry about wacking the license on Version. It must have been an accident. I know it needs to be there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Some fine tuning: You defined package protected abstract methods, but made them public in the enum constant. Changed to all-public. This was also a backwards-break in contrib/queryParser.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks. Inadvertently,  I was following the pattern for an Interface, where scoping does not matter.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So it works, but not with switch statements.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;IMHO: Having a switch statement (or cascading if-then-else) over the collection of values is generally indicative of a bad design (or an opportunity for an improved design &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; By adding methods to each enum that return literals, we can eliminate this and at the same time, improve performance.&lt;/p&gt;

&lt;p&gt;There is another tuning opportunity, which I didn&apos;t take. We are marshaling out the flags from the enums into member variables. I&apos;m not sure how efficient the storage of a boolean vs an enum is. If it is a wash, then having an enum value as replacement would be a good thing. It sould clearly document what controls the flag.&lt;/p&gt;

&lt;p&gt;The only complication would be the set/get for some of the flags. (E.g. AbstractField.setOmitNorms.) What&apos;s with that? Are the enum values merely a hint??? Does it make sense to allow omitNorms to be changed after an AbstractField is being used?&lt;/p&gt;
</comment>
                    <comment id="12768242" author="thetaphi" created="Wed, 21 Oct 2009 14:51:54 +0100"  >&lt;p&gt;(it&apos;s &quot;bq.&quot; not &quot;.bq&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So it works, but not with switch statements.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;IMHO: Having a switch statement (or cascading if-then-else) over the collection of values is generally indicative of a bad design (or an opportunity for an improved design  By adding methods to each enum that return literals, we can eliminate this and at the same time, improve performance.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right, my problem was more for client code of Lucene that may for example have a switch statement on Field.Index (e.g. Solr) to control some further indexing steps. If we rename the constant, the switch statement would not work (it would work in already compiled code), but not if the code is recompiled against the modified version. That was my problem. In 3.0 this will not happen as there are no deprec enum constants, but maybe later. In this case, a CHANGES.txt entry should be added.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There is another tuning opportunity, which I didn&apos;t take. We are marshaling out the flags from the enums into member variables. I&apos;m not sure how efficient the storage of a boolean vs an enum is. If it is a wash, then having an enum value as replacement would be a good thing. It sould clearly document what controls the flag.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is currently not possibible because of backwards compatibility, because the fields are protected and not deprecated in 2.9. I think with your change we are fine.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The only complication would be the set/get for some of the flags. (E.g. AbstractField.setOmitNorms.) What&apos;s with that? Are the enum values merely a hint??? Does it make sense to allow omitNorms to be changed after an AbstractField is being used?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is perfectly legal to change these constants after creating the field, so the setters must be there.&lt;/p&gt;</comment>
                    <comment id="12768270" author="dmsmith" created="Wed, 21 Oct 2009 16:02:24 +0100"  >&lt;p&gt;I just noticed that enums are comparable. For the enum Version, we could take advantage for this and not store a number for each value. It would be important to maintain order of versions in the file from earliest to latest.&lt;/p&gt;

&lt;p&gt;Should we do this?&lt;/p&gt;

&lt;p&gt;Then the current patch&apos;s (comments removed for clarity):&lt;/p&gt;

&lt;p&gt;public enum Version {&lt;br/&gt;
  LUCENE_CURRENT (0),&lt;br/&gt;
  LUCENE_20      (2000),&lt;br/&gt;
  LUCENE_21      (2100),&lt;br/&gt;
  LUCENE_22      (2200),&lt;br/&gt;
  LUCENE_23      (2300),&lt;br/&gt;
  LUCENE_24      (2400),&lt;br/&gt;
  LUCENE_29      (2900),&lt;br/&gt;
  LUCENE_30      (3000);&lt;/p&gt;

&lt;p&gt;  private Version(int v) &lt;/p&gt;
{
    this.v = v;
  }

&lt;p&gt;  public boolean onOrAfter(Version other) &lt;/p&gt;
{
    return v == 0 || v &amp;gt;= other.v;
  }

&lt;p&gt;  private final int v;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Would become (the comment on strict ordering is necessary):&lt;/p&gt;

&lt;p&gt;public enum Version {&lt;/p&gt;

&lt;p&gt;  // These have to be ordered from the oldest to the newest version&lt;br/&gt;
  LUCENE_20,&lt;br/&gt;
  LUCENE_21,&lt;br/&gt;
  LUCENE_22,&lt;br/&gt;
  LUCENE_23,&lt;br/&gt;
  LUCENE_24,&lt;br/&gt;
  LUCENE_29,&lt;br/&gt;
  LUCENE_30,&lt;br/&gt;
  // This needs to be last&lt;br/&gt;
  LUCENE_CURRENT;&lt;/p&gt;

&lt;p&gt;  /** A convienence method merely calling this.compareTo(other) &amp;gt;= 0 */&lt;br/&gt;
  public boolean onOrAfter(Version other) &lt;/p&gt;
{
    return compareTo(other) &amp;gt;= 0;
  }

&lt;p&gt;}&lt;/p&gt;</comment>
                    <comment id="12768273" author="thetaphi" created="Wed, 21 Oct 2009 16:09:36 +0100"  >&lt;p&gt;I thought about that, too: I would not do this. Especially because I want to have the 0-version (current) as first element for serialization purposes (changing the order of enum constants is bad, you should always add them at the end).&lt;/p&gt;

&lt;p&gt;Eventually we want to make the accessor to the interver v somehow public (for more specific comaprisons and so on).&lt;/p&gt;</comment>
                    <comment id="12768304" author="dmsmith" created="Wed, 21 Oct 2009 17:08:38 +0100"  >&lt;blockquote&gt;&lt;p&gt;changing the order of enum constants is bad, you should always add them at the end&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is this true?&lt;/p&gt;

&lt;p&gt;I did not know how Java serializes enums so I went looking:&lt;br/&gt;
See: &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/guide/serialization/relnotes15.html&quot; class=&quot;external-link&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/guide/serialization/relnotes15.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Turns out it serializes the text representation of the enum constant and class info. This is just like the Parameter class.&lt;/p&gt;

&lt;p&gt;If I understand it correctly, with this, an enum is resilient to changes in order. New constants can go in any place (for example, we can later add LUCENE_291 before LUCENE_30) and not break serialization compatibility.&lt;/p&gt;

&lt;p&gt;This is especially good for the future as it allows a path for deprecations. (E.g. deprecation of o.a.l.d.Field.Index.COMPRESS)&lt;/p&gt;

&lt;p&gt;So having LUCENE_CURRENT at the end is fine.&lt;/p&gt;

&lt;p&gt;If we wanted it first (or anywhere else) we could have onOrAfter to be:&lt;br/&gt;
public boolean onOrAfter(Version other) &lt;/p&gt;
{ return other == LUCENE_CURRENT || compareTo(other) &amp;gt;= 0; }

&lt;p&gt;If we wanted to expose version numbering info in the future, I&apos;d suggest the following pattern (names are unimportant):&lt;br/&gt;
LUCENE_29 {&lt;br/&gt;
   public int getMajor() &lt;/p&gt;
{ return 2; }
&lt;p&gt;   public int getMinor() &lt;/p&gt;
{ return 9; }
&lt;p&gt;   public int getFix()      &lt;/p&gt;
{ return 0; }
&lt;p&gt;}&lt;br/&gt;
because it does not require storage and unlike &quot;2900&quot; does not have positional notation meaning (PIC code), e.g. public int getMajor() &lt;/p&gt;
{ return int(2900/1000); }</comment>
                    <comment id="12768340" author="thetaphi" created="Wed, 21 Oct 2009 18:24:25 +0100"  >&lt;p&gt;I changed the Version enum. All test still pass. I also added a test for the backwards branch that tests, that the transition from Parameter -&amp;gt; enum is binary compatible and supported by Java&apos;s linker.&lt;/p&gt;

&lt;p&gt;I will commit soon.&lt;/p&gt;</comment>
                    <comment id="12768343" author="thetaphi" created="Wed, 21 Oct 2009 18:35:53 +0100"  >&lt;p&gt;Better BW test&lt;/p&gt;</comment>
                    <comment id="12768376" author="thetaphi" created="Wed, 21 Oct 2009 20:31:37 +0100"  >&lt;p&gt;Committed revision: 828156&lt;/p&gt;

&lt;p&gt;Thanks DM Smith!&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12392905">LUCENE-1257</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12422828" name="LUCENE-1998_enum_BW.patch" size="2115" author="thetaphi" created="Wed, 21 Oct 2009 18:35:53 +0100" />
                    <attachment id="12422826" name="LUCENE-1998_enum_BW.patch" size="1839" author="thetaphi" created="Wed, 21 Oct 2009 18:24:25 +0100" />
                    <attachment id="12422825" name="LUCENE-1998_enum.patch" size="43010" author="thetaphi" created="Wed, 21 Oct 2009 18:24:25 +0100" />
                    <attachment id="12422802" name="LUCENE-1998_enum.patch" size="40086" author="thetaphi" created="Wed, 21 Oct 2009 13:22:29 +0100" />
                    <attachment id="12422780" name="LUCENE-1998_enum.patch" size="39351" author="thetaphi" created="Wed, 21 Oct 2009 09:29:58 +0100" />
                    <attachment id="12422777" name="LUCENE-1998_enum.patch" size="39288" author="thetaphi" created="Wed, 21 Oct 2009 08:24:40 +0100" />
                    <attachment id="12422740" name="LUCENE-1998_enum.patch" size="40018" author="dmsmith" created="Tue, 20 Oct 2009 23:27:49 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>7.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 21 Oct 2009 07:23:36 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11774</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25727</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>