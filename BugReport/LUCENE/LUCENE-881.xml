<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:06:39 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-881/LUCENE-881.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-881] QueryParser escaping/parsin issue with strings starting/ending with ||</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-881</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;There is a problem with query parser when search string starts/ends with ||.  When string contains || in the middle like &apos;something || something&apos; everything runs without a problem.&lt;/p&gt;

&lt;p&gt;Part of code: &lt;br/&gt;
  searchText = QueryParser.escape(searchText);&lt;br/&gt;
  QueryParser parser = null;&lt;br/&gt;
  parser = new QueryParser(fieldName, new CustomAnalyser());&lt;br/&gt;
  parser.parse(searchText);&lt;/p&gt;

&lt;p&gt;CustomAnalyser class extends Analyser. Here is the only redefined method: &lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    public TokenStream tokenStream(String fieldName, Reader reader) &lt;/p&gt;
{
      return new PorterStemFilter( (new StopAnalyzer()).tokenStream(fieldName, reader));
    }

&lt;p&gt;I have tested this on Lucene 2.1 and latest source I have checked-out from SVN (Revision 538867) and in both cases parsing exception was thrown.&lt;/p&gt;

&lt;p&gt;Part of Stack Trace (Lucene - SVN checkout - Revision 538867):&lt;br/&gt;
Cannot parse &apos;someting ||&apos;: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 11.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &amp;lt;NOT&amp;gt; ...&lt;br/&gt;
    &quot;+&quot; ...&lt;br/&gt;
    &quot;-&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    &quot;*&quot; ...&lt;br/&gt;
    &amp;lt;QUOTED&amp;gt; ...&lt;br/&gt;
    &amp;lt;TERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;PREFIXTERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;WILDTERM&amp;gt; ...&lt;br/&gt;
    &quot;[&quot; ...&lt;br/&gt;
    &quot;{&quot; ...&lt;br/&gt;
    &amp;lt;NUMBER&amp;gt; ...&lt;/p&gt;

&lt;p&gt; org.apache.lucene.queryParser.ParseException: Cannot parse &apos;someting ||&apos;: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 11.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &amp;lt;NOT&amp;gt; ...&lt;br/&gt;
    &quot;+&quot; ...&lt;br/&gt;
    &quot;-&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    &quot;*&quot; ...&lt;br/&gt;
    &amp;lt;QUOTED&amp;gt; ...&lt;br/&gt;
    &amp;lt;TERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;PREFIXTERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;WILDTERM&amp;gt; ...&lt;br/&gt;
    &quot;[&quot; ...&lt;br/&gt;
    &quot;{&quot; ...&lt;br/&gt;
    &amp;lt;NUMBER&amp;gt; ...&lt;/p&gt;

&lt;p&gt;        at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:150)&lt;/p&gt;


&lt;p&gt;Part of Stack Trace (Lucene 2.1):&lt;br/&gt;
Cannot parse &apos;something ||&apos;: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 12.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &amp;lt;NOT&amp;gt; ...&lt;br/&gt;
    &quot;+&quot; ...&lt;br/&gt;
    &quot;-&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    &quot;*&quot; ...&lt;br/&gt;
    &amp;lt;QUOTED&amp;gt; ...&lt;br/&gt;
    &amp;lt;TERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;PREFIXTERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;WILDTERM&amp;gt; ...&lt;br/&gt;
    &quot;[&quot; ...&lt;br/&gt;
    &quot;{&quot; ...&lt;br/&gt;
    &amp;lt;NUMBER&amp;gt; ...&lt;/p&gt;

&lt;p&gt; org.apache.lucene.queryParser.ParseException: Cannot parse &apos;something ||&apos;: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 12.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &amp;lt;NOT&amp;gt; ...&lt;br/&gt;
    &quot;+&quot; ...&lt;br/&gt;
    &quot;-&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    &quot;*&quot; ...&lt;br/&gt;
    &amp;lt;QUOTED&amp;gt; ...&lt;br/&gt;
    &amp;lt;TERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;PREFIXTERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;WILDTERM&amp;gt; ...&lt;br/&gt;
    &quot;[&quot; ...&lt;br/&gt;
    &quot;{&quot; ...&lt;br/&gt;
    &amp;lt;NUMBER&amp;gt; ...&lt;/p&gt;

&lt;p&gt;        at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:149)&lt;/p&gt;

</description>
                <environment>&lt;p&gt;MAC OS X 10.4.7, J2SE 5.0 Release 4&lt;/p&gt;</environment>
            <key id="12369552">LUCENE-881</key>
            <summary>QueryParser escaping/parsin issue with strings starting/ending with ||</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="michaelbusch">Michael Busch</assignee>
                                <reporter username="smarjan">Slobodan Marjanovic</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 May 2007 12:19:33 +0100</created>
                <updated>Wed, 23 May 2007 05:55:46 +0100</updated>
                    <resolved>Wed, 23 May 2007 05:55:46 +0100</resolved>
                            <version>2.1</version>
                <version>2.2</version>
                                                <component>core/queryparser</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12496610" author="michaelbusch" created="Thu, 17 May 2007 17:29:57 +0100"  >&lt;p&gt;The problem here is that QueryParser.escape() does not escape | and &amp;amp;. This should be easy to fix, I&apos;ll submit a patch soon.&lt;/p&gt;</comment>
                    <comment id="12496618" author="yseeley@gmail.com" created="Thu, 17 May 2007 17:43:22 +0100"  >&lt;p&gt;Sorry, I don&apos;t quite understand the problem.  Could someone provide an actual query string that should work but doesn&apos;t?  &quot;||&quot; is reserved since it means OR, AFAIK.&lt;/p&gt;</comment>
                    <comment id="12496634" author="michaelbusch" created="Thu, 17 May 2007 18:18:04 +0100"  >&lt;p&gt;You are right Yonik, || is reserved.&lt;/p&gt;

&lt;p&gt;The QueryParser itself works correctly:&lt;/p&gt;

&lt;p&gt;&quot;|| test ||&quot; yields a ParseException, which is correct because in this case || means OR&lt;br/&gt;
&quot;&amp;#124;&amp;#124; test &amp;#124;&amp;#124;&quot; yields &quot;|| test ||&quot;, this is correct, too, because the two | are escaped&lt;/p&gt;


&lt;p&gt;The problem here is the escape() method:&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns a String where those characters that QueryParser&lt;/li&gt;
	&lt;li&gt;expects to be escaped are escaped by a preceding &amp;lt;code&amp;gt;\&amp;lt;/code&amp;gt;.&lt;br/&gt;
   */&lt;br/&gt;
  public static String escape(String s);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It escapes chars like +, -, ! and so on. Example:&lt;/p&gt;

&lt;p&gt;escape(&quot;++ test ++&quot;) yields &quot;&amp;#43;&amp;#43; test &amp;#43;&amp;#43;&quot;&lt;/p&gt;

&lt;p&gt;but&lt;/p&gt;

&lt;p&gt;escape(&quot;|| test ||&quot;) yields &quot;|| test ||&quot;.&lt;/p&gt;

&lt;p&gt;I believe to be consistent escape() should escape the two chars | and &amp;amp; as well, no?&lt;/p&gt;</comment>
                    <comment id="12496655" author="yseeley@gmail.com" created="Thu, 17 May 2007 19:10:16 +0100"  >&lt;p&gt;&amp;gt; escape() should escape the two chars | and &amp;amp; as well, no?&lt;/p&gt;

&lt;p&gt;Agree.&lt;/p&gt;</comment>
                    <comment id="12496972" author="michaelbusch" created="Fri, 18 May 2007 18:34:46 +0100"  >&lt;p&gt;Patch with additional unit tests.&lt;/p&gt;

&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                    <comment id="12498094" author="michaelbusch" created="Wed, 23 May 2007 05:55:46 +0100"  >&lt;p&gt;I just committed this patch. Thank you for finding this bug, Slobodan!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12357650" name="lucene-881.patch" size="2217" author="michaelbusch" created="Fri, 18 May 2007 18:34:46 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 17 May 2007 16:29:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12861</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26848</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>