<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:33:05 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3233/LUCENE-3233.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3233] HuperDuperSynonymsFilter&#8482;</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3233</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The current synonymsfilter uses a lot of ram and cpu, especially at build time.&lt;/p&gt;

&lt;p&gt;I think yesterday I heard about &quot;huge synonyms files&quot; three times.&lt;/p&gt;

&lt;p&gt;So, I think we should use an FST-based structure, sharing the inputs and outputs.&lt;br/&gt;
And we should be more efficient with the tokenStream api, e.g. using save/restoreState instead of cloneAttributes()&lt;/p&gt;</description>
                <environment></environment>
            <key id="12511361">LUCENE-3233</key>
            <summary>HuperDuperSynonymsFilter&#8482;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2011 15:00:49 +0100</created>
                <updated>Fri, 13 Jan 2012 19:35:46 +0000</updated>
                    <resolved>Sun, 28 Aug 2011 17:41:57 +0100</resolved>
                                            <fixVersion>3.4</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="13053869" author="rcmuir" created="Thu, 23 Jun 2011 15:04:47 +0100"  >&lt;p&gt;here&apos;s a rough start to building a datastructure that I think makes good tradeoffs between RAM and processing.&lt;/p&gt;

&lt;p&gt;No matter what, the processing on the filter-side will be hairy because of the &apos;interleaving&apos; with the tokenstream.&lt;/p&gt;

&lt;p&gt;This one is just an FST&amp;lt;CharsRef,Int[]&amp;gt;(BYTE4) where Int is an ord to a BytesRefHash, containing the output Bytes for each term.&lt;/p&gt;

&lt;p&gt;This way, at input time we can walk the FST with codePointAt()&lt;/p&gt;

&lt;p&gt;On both sides, the Chars/Bytes are actually phrases, using \u0000 as a word separator.&lt;/p&gt;</comment>
                    <comment id="13054356" author="mikemccand" created="Fri, 24 Jun 2011 11:48:02 +0100"  >&lt;p&gt;Dumping my current state on FSTSynonymFilter &amp;#8211; it compiles but it&apos;s got tons of bugs I&apos;m sure!  I added a trivial initial test.&lt;/p&gt;</comment>
                    <comment id="13059523" author="mikemccand" created="Mon, 4 Jul 2011 18:42:11 +0100"  >&lt;p&gt;New patch w/ current state.&lt;/p&gt;

&lt;p&gt;I think it&apos;s closer; the test has more cases now (but I&apos;d still like to make a random test), fewer nocommits, etc.&lt;/p&gt;</comment>
                    <comment id="13059891" author="rcmuir" created="Tue, 5 Jul 2011 14:25:30 +0100"  >&lt;p&gt;patch with a first random test, this one currently does 10 iterations where it adds random shit to the synonym map, then it analyzes 10k random strings (each time capturing the output, and replaying it back to ensure the thing is deterministic and doesn&apos;t have reuse bugs).&lt;/p&gt;

&lt;p&gt;i also added the ignoreCase support.&lt;/p&gt;

&lt;p&gt;the filter might have a reuse bug, see ant test -Dtestcase=TestFSTSynonymMapFilter -Dtestmethod=testRandom -Dtests.seed=-4122723628721952592:244824441557739968&lt;/p&gt;</comment>
                    <comment id="13060095" author="mikemccand" created="Tue, 5 Jul 2011 20:49:05 +0100"  >&lt;p&gt;New patch, folding in Robert&apos;s changes and the random stress test.  All tests pass.  I think it&apos;s now functionally correct, but I still need to compare perf vs existing syn filter, and there are still a few minor nocommits to work out.&lt;/p&gt;

&lt;p&gt;Ideally, if we get perf close enough, since RAM is much much less w/ this new syn filter, I think we should replace the old one with this new one.&lt;/p&gt;</comment>
                    <comment id="13060145" author="mikemccand" created="Tue, 5 Jul 2011 22:46:55 +0100"  >&lt;p&gt;New patch, adding dedup option to the builder, removing a couple nocommits, cutting back on iters/counts in testRandom2.&lt;/p&gt;</comment>
                    <comment id="13060296" author="rcmuir" created="Wed, 6 Jul 2011 06:25:54 +0100"  >&lt;p&gt;Updated patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;added a SolrSynonymsParser and test to the analyzers module, that parses the existing solr synonyms format.&lt;/li&gt;
	&lt;li&gt;added a Solr factory for this thing (untested!) that uses this when &quot;format=solr&quot; (the default)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This way, the idea is the factory would be more extensible, e.g. you could load syns from a database, or we could add parsers for wordnet and nuke contrib/wordnet, etc etc.&lt;/p&gt;

&lt;p&gt;Still need to do some basic benchmarking.&lt;/p&gt;</comment>
                    <comment id="13060322" author="rcmuir" created="Wed, 6 Jul 2011 07:49:59 +0100"  >&lt;p&gt;fixed some bugs, added some tests, but there is a problem, I started to add a little benchmark and I hit this on my largish synonyms file:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: max arc size is too large (445)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just run the TestFSTSynonymFilterFactory and you will see it, i enabled some prints and it doesn&apos;t appear like anything totally stupid is going on... giving up for the night &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13060323" author="rcmuir" created="Wed, 6 Jul 2011 07:51:52 +0100"  >&lt;p&gt;attaching my synonyms.txt test file that i was using: its derived from wordnet&lt;/p&gt;</comment>
                    <comment id="13060471" author="mikemccand" created="Wed, 6 Jul 2011 11:52:41 +0100"  >&lt;blockquote&gt;&lt;p&gt;java.lang.IllegalStateException: max arc size is too large (445)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahh &amp;#8211; to fix this we have to call Builder.setAllowArrayArcs(false), ie, disable the array arcs in the FST (and this binary search lookup for finding arcs!).  I had to do this also for MemoryCodec, since postings encoded as output per arc can be more than 256 bytes, in general.&lt;/p&gt;

&lt;p&gt;This will hurt perf, ie, the arc lookup cannot use a binary search; it&apos;s because of a silly limitation in the FST representation, that we use a single byte to hold the max size of all arcs, so that if any arc is &amp;gt; 256 bytes we are unable to encode it as an array.  We could fix this (eg, use vInt), however, arcs with such widely varying sizes (due to widely varying outputs on each arc) will be very wasteful in space because all arcs will use up a fixed number of bytes when represented as an array.&lt;/p&gt;

&lt;p&gt;For now I think we should just call the above method, and then test the resulting perf.&lt;/p&gt;</comment>
                    <comment id="13060578" author="mikemccand" created="Wed, 6 Jul 2011 14:45:29 +0100"  >&lt;p&gt;Actually, maybe a better general fix for FST would be for it to dynamically decide whether to make an array based on how many bytes will be wasted (in addition to the number of arcs / depth of the node).  This way we could turn on arcs always, and FST would pick the right times to use it.  If we stick to only 1 byte for the number of bytes per arc, the FST could simply not use the array when an arc is &amp;gt; 256 bytes.&lt;/p&gt;</comment>
                    <comment id="13060613" author="rcmuir" created="Wed, 6 Jul 2011 15:46:17 +0100"  >&lt;p&gt;Thanks Mike, I will set the option for now, we can address any potential perf hit in a number of different ways here (besides modifying FST itself).&lt;/p&gt;</comment>
                    <comment id="13060686" author="rcmuir" created="Wed, 6 Jul 2011 18:00:36 +0100"  >&lt;p&gt;I ran some quick numbers, using the syn file example here, just best of 3 runs:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Impl&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Build time&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;RAM usage&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;SynonymFilterFactory&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6619ms&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;207.92 mb&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FSTSynonymFilterFactory&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;463 ms&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.51 mb&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;I modified the builder slightly to build the FST more efficiently for this, will upload the updated patch.&lt;/p&gt;

&lt;p&gt;So i think the build-time and RAM consumption are really improved, the next thing is to benchmark the runtime perf.&lt;/p&gt;</comment>
                    <comment id="13060698" author="dsmiley" created="Wed, 6 Jul 2011 18:16:53 +0100"  >&lt;p&gt;Wow that&apos;s striking; nice work guys.  FSTs are definitely one of those killer pieces of technology in Lucene.&lt;/p&gt;

&lt;p&gt;The difference in build time is surprising to me.  Any theory why SynonymFilterFactory takes so much more time to build?&lt;/p&gt;</comment>
                    <comment id="13060705" author="rcmuir" created="Wed, 6 Jul 2011 18:28:07 +0100"  >&lt;blockquote&gt;
&lt;p&gt;The difference in build time is surprising to me. Any theory why SynonymFilterFactory takes so much more time to build?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, its the n^2 portion where you have a synonym entry like this: a, b, c, d&lt;br/&gt;
in reality this is creating entries like this:&lt;br/&gt;
a -&amp;gt; a&lt;br/&gt;
a -&amp;gt; b&lt;br/&gt;
a -&amp;gt; c&lt;br/&gt;
a -&amp;gt; d&lt;br/&gt;
b -&amp;gt; a&lt;br/&gt;
b -&amp;gt; b&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;in the current impl, this is done using some inefficient datastructures (like nested chararraymaps with Token),&lt;br/&gt;
as well as calling merge().&lt;/p&gt;

&lt;p&gt;In the FST impl, we don&apos;t use any nested structures (instead input and output entries are just phrases), and we explicitly &lt;br/&gt;
deduplicate both inputs and outputs during construction, the FST output is just a&lt;br/&gt;
List&amp;lt;Integer&amp;gt; basically pointing to ords in the deduplicated bytesrefhash.&lt;/p&gt;

&lt;p&gt;so during construction when you add() its just a hashmap lookup on the input phrase, a bytesrefhash get/put on the UTF16toUTF8WithHash&lt;br/&gt;
to get the output ord, and an append to an arraylist.&lt;/p&gt;

&lt;p&gt;this code isn&apos;t really optimized right now and we can definitely speed it up even more in the future. but the main thing&lt;br/&gt;
right now is to ensure the filter performance is good.&lt;/p&gt;</comment>
                    <comment id="13060749" author="rcmuir" created="Wed, 6 Jul 2011 19:35:48 +0100"  >&lt;p&gt;here is a patch with a little microbenchmark... so we have some tuning to do. &lt;/p&gt;

&lt;p&gt;the benchmark analyzes a short string a million times, that doesn&apos;t match any synonyms (actually hte solr default)&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;impl&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ms&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;SynonymsFilter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1692&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FST with array arcs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2794&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FST with no array arcs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8823&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;so, disabling the array arcs is a pretty crucial hit here. but we could do other options to speed up this common case, e.g. with daciuk we could build a charrunautomaton of the K-prefixes of the synonyms, this would be really fast to reject these terms that don&apos;t match any syns.&lt;/p&gt;

&lt;p&gt;or we could explicitly put our bytesref output in a byte[], and use long pointers as outputs.&lt;/p&gt;

&lt;p&gt;or we could speed up FST! But i think its interesting to see how important this parameter is.&lt;/p&gt;</comment>
                    <comment id="13060764" author="mikemccand" created="Wed, 6 Jul 2011 19:59:21 +0100"  >&lt;p&gt;Wow, it&apos;s very important to allow arcs to be encoded as arrays (for the binary search on lookup).  I think we should just fix FST... I&apos;ll think about it.  MemoryCodec would also get big gains here.&lt;/p&gt;</comment>
                    <comment id="13060781" author="rcmuir" created="Wed, 6 Jul 2011 20:24:40 +0100"  >&lt;p&gt;I agree, this would be the best solution. Maybe we should just open a separate issue for that? &lt;/p&gt;

&lt;p&gt;we can let this one be for now until that is resolved, can even continue working on other parts of it.&lt;/p&gt;</comment>
                    <comment id="13060848" author="mikemccand" created="Wed, 6 Jul 2011 22:18:47 +0100"  >&lt;p&gt;New patch, including some optimizing to FST (which we can commit under a separate issue): array arcs can now be any size, and I re-use the BytesReader inner class that&apos;s created for parsing arcs.&lt;/p&gt;</comment>
                    <comment id="13060905" author="rcmuir" created="Thu, 7 Jul 2011 00:09:03 +0100"  >&lt;blockquote&gt;&lt;p&gt;New patch, including some optimizing to FST (which we can commit under a separate issue)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;works! I don&apos;t think we need to open a new issue, I didn&apos;t think you would come back with a patch in just two hours!&lt;/p&gt;

&lt;p&gt;I&apos;ll play with the patch some now and see what I can do with it.&lt;/p&gt;</comment>
                    <comment id="13060973" author="rcmuir" created="Thu, 7 Jul 2011 02:13:20 +0100"  >&lt;p&gt;updated patch, this tableizes the first FST arcs for latin-1.&lt;/p&gt;

&lt;p&gt;precomputing this tiny table speeds up this filter a ton (~3000ms -&amp;gt; ~2000ms) and I think is a cheap easy win for the terms index too.&lt;/p&gt;</comment>
                    <comment id="13061001" author="rcmuir" created="Thu, 7 Jul 2011 03:17:54 +0100"  >&lt;p&gt;Benchmark with the synonyms.zip attached to this issue (so that we are actually matching synonyms):&lt;br/&gt;
in this case i only analyzed the text 100,000 times, as its a lot more output.&lt;br/&gt;
I also checked they are emitting the same stuff:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Impl&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;ms&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;SynonymsFilter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;112527&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;FST&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22872&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;So, thats 5x faster, I think probably due to avoiding the expensive cloning.&lt;/p&gt;

&lt;p&gt;I think we are fine on performance.&lt;/p&gt;</comment>
                    <comment id="13061232" author="rcmuir" created="Thu, 7 Jul 2011 12:57:02 +0100"  >&lt;p&gt;so i don&apos;t forget, lets not waste an arc bitflag marking an arc as &apos;first&apos;... &lt;/p&gt;

&lt;p&gt;I hear the secret is instead arc.target == startNode&lt;/p&gt;</comment>
                    <comment id="13061275" author="mikemccand" created="Thu, 7 Jul 2011 14:07:36 +0100"  >&lt;p&gt;New patch, moving the root arcs cache into FST, not using up our last precious arc bit.&lt;/p&gt;</comment>
                    <comment id="13061486" author="mikemccand" created="Thu, 7 Jul 2011 19:54:37 +0100"  >&lt;p&gt;Another rev of the patch: I did a hard bump the FST version (so&lt;br/&gt;
existing trunk indices must be rebuilt), and added NOTE in suggest&apos;s&lt;br/&gt;
FST impl that the file format is experimental; removed&lt;br/&gt;
maxVerticalContext; fixed false test failure.&lt;/p&gt;</comment>
                    <comment id="13062375" author="mikemccand" created="Sat, 9 Jul 2011 14:33:21 +0100"  >&lt;p&gt;I think this is ready to commit, but I&apos;d like to rename existing syn filter to SlowSynonymFilter and rename the new one to SynonymFilter.&lt;/p&gt;

&lt;p&gt;Because there are some minor diffs (deduping rules, lowercasing), for Solr to cutover I think we need some back compat logic; I&apos;ll open a separate issue for this.&lt;/p&gt;</comment>
                    <comment id="13062380" author="rcmuir" created="Sat, 9 Jul 2011 14:50:45 +0100"  >&lt;p&gt;I&apos;ll try to add some not-so-sophisticated backwards here!&lt;/p&gt;</comment>
                    <comment id="13062382" author="yseeley@gmail.com" created="Sat, 9 Jul 2011 14:58:46 +0100"  >&lt;blockquote&gt;&lt;p&gt;but I&apos;d like to rename existing syn filter to SlowSynonymFilter and rename the new one to SynonymFilter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But the lookup on the original is still faster, right?  And if someone has small synonym dicts (actually pretty common in my experience since SynonymFilter isn&apos;t necessary used to inject synonyms in the traditional sense, but for any mapping task) then build time and mem use won&apos;t be much of an issue (esp if the input to match is mostly single words).&lt;/p&gt;

&lt;p&gt;This looks great for large synonym maps, but perhaps instead of Slow* or Fast* we could name them for the implementation and either name the new one FSTSynonymFilter or rename the current one to MapSynonymFilter?  Or is the plan to actually deprecate the current SynonymFilter? &lt;/p&gt;</comment>
                    <comment id="13062383" author="mikemccand" created="Sat, 9 Jul 2011 15:09:14 +0100"  >&lt;blockquote&gt;&lt;p&gt;But the lookup on the original is still faster, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was before we optimized FST for this usage case.&lt;/p&gt;

&lt;p&gt;Now, from the testing above, it looks like we are faster when syns actually match; if no syns match the two are around the same speed.&lt;/p&gt;

&lt;p&gt;Separately: shouldn&apos;t we not have any syns in the default text_en field type?  Like we can have a synonyms.txt but comment out all the rules in there?&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should keep the old one around, ie, we should &lt;span class=&quot;error&quot;&gt;&amp;#91;eventually&amp;#93;&lt;/span&gt; replace it with the new one.&lt;/p&gt;</comment>
                    <comment id="13062384" author="rcmuir" created="Sat, 9 Jul 2011 15:12:32 +0100"  >&lt;p&gt;This one is faster for the simple reason that the TokenFilter uses captureState() and restoreState() &lt;span class=&quot;error&quot;&gt;&amp;#91;and has logic to minimize cloning in more cases&amp;#93;&lt;/span&gt; instead of AttributeSource.cloneAttributes()/copyTo()&lt;/p&gt;</comment>
                    <comment id="13062386" author="yseeley@gmail.com" created="Sat, 9 Jul 2011 15:20:26 +0100"  >&lt;blockquote&gt;&lt;p&gt;Now, from the testing above, it looks like we are faster when syns actually match; if no syns match the two are around the same speed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh cool!  I was looking at &quot;1692&quot; for the SynonymsFilter and a drop from &quot;~3000ms -&amp;gt; ~2000ms&quot; for the FST version.   I assumed Robert&apos;s last benchmark was building and not lookup (the 112527/22872).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Separately: shouldn&apos;t we not have any syns in the default text_en field type?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I dunno... it&apos;s nice for both demonstration and testing (and it&apos;s in the current tutorial).&lt;/p&gt;</comment>
                    <comment id="13062603" author="rcmuir" created="Sat, 9 Jul 2011 20:13:46 +0100"  >&lt;p&gt;Updated patch: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;renamed to SynonymFilter&lt;/li&gt;
	&lt;li&gt;added not-so-sophisticated backwards layer&lt;/li&gt;
	&lt;li&gt;added tests&lt;/li&gt;
	&lt;li&gt;added parser for format=&quot;wordnet&quot;&lt;/li&gt;
	&lt;li&gt;removed contrib/wordnet&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;but i found some bugs (well one, surely is) in the new tests, so i added nocommits here.&lt;/p&gt;</comment>
                    <comment id="13062705" author="rcmuir" created="Sun, 10 Jul 2011 09:53:10 +0100"  >&lt;p&gt;just updating patch to trunk, the nocommits remain...&lt;/p&gt;</comment>
                    <comment id="13062800" author="mikemccand" created="Sun, 10 Jul 2011 21:31:05 +0100"  >&lt;p&gt;New patch, also setting offsets in the produced tokens (the wordnet test passes), and adding adding a NOTE about the dup output words issue.&lt;/p&gt;

&lt;p&gt;I think it&apos;s finally ready to commit!&lt;/p&gt;</comment>
                    <comment id="13088540" author="gstamp" created="Mon, 22 Aug 2011 07:23:57 +0100"  >&lt;p&gt;Does this support multi word synonyms? I tried one of the 3.4 builds and I was getting odd results on multi word synonyms.&lt;/p&gt;</comment>
                    <comment id="13088666" author="mikemccand" created="Mon, 22 Aug 2011 13:48:39 +0100"  >&lt;p&gt;It does support multi-word synonyms &amp;#8211; can you give some details on the odd behavior?  Maybe email dev@lucene.apache.org, or open a new Jira issue?&lt;/p&gt;</comment>
                    <comment id="13089319" author="gstamp" created="Tue, 23 Aug 2011 08:16:05 +0100"  >&lt;p&gt;I&apos;ll try and put together a simple test case just to make sure I&apos;ve got something repeatable and post to the list. I think it might have been related to synonym fields tokenized using KeywordTokenizerFactory.&lt;/p&gt;</comment>
                    <comment id="13091834" author="yseeley@gmail.com" created="Fri, 26 Aug 2011 16:48:39 +0100"  >&lt;p&gt;Looks like that when Solr&apos;s synonym parsing was moved to the analysis module, it was also rewritten, introducing escaping bugs.&lt;/p&gt;

&lt;p&gt;Examples:&lt;br/&gt;
a\,a is no longer treated as a single token&lt;br/&gt;
a\=&amp;gt;a is no longer treated as a single token&lt;br/&gt;
a\ta is treated as &quot;ata&quot; instead of containing a tab character&lt;/p&gt;

&lt;p&gt;I didn&apos;t do a full review, so I&apos;m not sure if there are other differences in behavior.&lt;/p&gt;</comment>
                    <comment id="13091843" author="rcmuir" created="Fri, 26 Aug 2011 17:00:18 +0100"  >&lt;p&gt;Do you have a test?&lt;/p&gt;

&lt;p&gt;Because we have tests for this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    String testFile = 
      &quot;a\\=&amp;gt;a =&amp;gt; b\\=&amp;gt;b\n&quot; +
      &quot;a\\,a =&amp;gt; b\\,b&quot;;
...
    assertAnalyzesTo(analyzer, &quot;a=&amp;gt;a&quot;,
        new String[] { &quot;b=&amp;gt;b&quot; },
        new int[] { 1 });
    
    assertAnalyzesTo(analyzer, &quot;a,a&quot;,
        new String[] { &quot;b,b&quot; },
        new int[] { 1 });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13091919" author="yseeley@gmail.com" created="Fri, 26 Aug 2011 19:11:35 +0100"  >&lt;p&gt;I just tested by hand:&lt;br/&gt;
I added a line to synonyms.txt &quot;a\,a =&amp;gt; b\,b&quot;, fired up the example server and then executed the following query:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?q=a,a&amp;amp;debugQuery=true&quot; class=&quot;external-link&quot;&gt;http://localhost:8983/solr/select?q=a,a&amp;amp;debugQuery=true&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I then verified that the synonyms were in effect in general, via:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?q=fooaaa&amp;amp;debugQuery=true&quot; class=&quot;external-link&quot;&gt;http://localhost:8983/solr/select?q=fooaaa&amp;amp;debugQuery=true&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13092512" author="yseeley@gmail.com" created="Sun, 28 Aug 2011 17:41:57 +0100"  >&lt;p&gt;User error - the field type changes in the example schema tripped up the user (and me too).  The standard tokenizer does not keep &quot;a,a&quot; as a single token.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310000">
                <name>Duplicate</name>
                                                <inwardlinks description="is duplicated by">
                            <issuelink>
            <issuekey id="12512436">SOLR-2628</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12483689" name="LUCENE-3223.patch" size="29443" author="mikemccand" created="Fri, 24 Jun 2011 11:48:02 +0100" />
                    <attachment id="12486007" name="LUCENE-3233.patch" size="253714" author="mikemccand" created="Sun, 10 Jul 2011 21:31:05 +0100" />
                    <attachment id="12485989" name="LUCENE-3233.patch" size="258399" author="rcmuir" created="Sun, 10 Jul 2011 09:53:10 +0100" />
                    <attachment id="12485966" name="LUCENE-3233.patch" size="258234" author="rcmuir" created="Sat, 9 Jul 2011 20:13:46 +0100" />
                    <attachment id="12485642" name="LUCENE-3233.patch" size="95967" author="mikemccand" created="Thu, 7 Jul 2011 19:54:37 +0100" />
                    <attachment id="12485583" name="LUCENE-3233.patch" size="93652" author="mikemccand" created="Thu, 7 Jul 2011 14:07:36 +0100" />
                    <attachment id="12485522" name="LUCENE-3233.patch" size="96875" author="rcmuir" created="Thu, 7 Jul 2011 02:13:20 +0100" />
                    <attachment id="12485488" name="LUCENE-3233.patch" size="91393" author="mikemccand" created="Wed, 6 Jul 2011 22:18:47 +0100" />
                    <attachment id="12485476" name="LUCENE-3233.patch" size="84633" author="rcmuir" created="Wed, 6 Jul 2011 19:35:48 +0100" />
                    <attachment id="12485452" name="LUCENE-3233.patch" size="81415" author="rcmuir" created="Wed, 6 Jul 2011 18:02:15 +0100" />
                    <attachment id="12485377" name="LUCENE-3233.patch" size="80315" author="rcmuir" created="Wed, 6 Jul 2011 07:49:59 +0100" />
                    <attachment id="12485371" name="LUCENE-3233.patch" size="74762" author="rcmuir" created="Wed, 6 Jul 2011 06:25:54 +0100" />
                    <attachment id="12485341" name="LUCENE-3233.patch" size="54844" author="mikemccand" created="Tue, 5 Jul 2011 22:46:55 +0100" />
                    <attachment id="12485316" name="LUCENE-3233.patch" size="52754" author="mikemccand" created="Tue, 5 Jul 2011 20:49:05 +0100" />
                    <attachment id="12485276" name="LUCENE-3233.patch" size="45020" author="rcmuir" created="Tue, 5 Jul 2011 14:25:30 +0100" />
                    <attachment id="12485170" name="LUCENE-3233.patch" size="49221" author="mikemccand" created="Mon, 4 Jul 2011 18:42:11 +0100" />
                    <attachment id="12483597" name="LUCENE-3233.patch" size="16637" author="rcmuir" created="Thu, 23 Jun 2011 15:04:47 +0100" />
                    <attachment id="12485378" name="synonyms.zip" size="588364" author="rcmuir" created="Wed, 6 Jul 2011 07:51:52 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>18.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 24 Jun 2011 10:48:02 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10766</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24464</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>