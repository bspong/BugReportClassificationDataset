<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:20 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-705/LUCENE-705.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-705] CompoundFileWriter should pre-set its file length</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-705</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I&apos;ve read that if you are writing a large file, it&apos;s best to pre-set&lt;br/&gt;
the size of the file in advance before you write all of its contents.&lt;br/&gt;
This in general minimizes fragmentation and improves IO performance&lt;br/&gt;
against the file in the future.&lt;/p&gt;

&lt;p&gt;I think this makes sense (intuitively) but I haven&apos;t done any real&lt;br/&gt;
performance testing to verify.&lt;/p&gt;

&lt;p&gt;Java has the java.io.File.setLength() method (since 1.2) for this.&lt;/p&gt;

&lt;p&gt;We can easily fix CompoundFileWriter to call setLength() on the file&lt;br/&gt;
it&apos;s writing (and add setLength() method to IndexOutput).  The&lt;br/&gt;
CompoundFileWriter knows exactly how large its file will be.&lt;/p&gt;

&lt;p&gt;Another good thing is: if you are going run out of disk space, then,&lt;br/&gt;
the setLength call should fail up front instead of failing when the&lt;br/&gt;
compound file is actually written.  This has two benefits: first, you&lt;br/&gt;
find out sooner that you will run out of disk space, and, second, you&lt;br/&gt;
don&apos;t fill up the disk down to 0 bytes left (always a frustrating&lt;br/&gt;
experience!).  Instead you leave what space was available&lt;br/&gt;
and throw an IOException.&lt;/p&gt;

&lt;p&gt;My one hesitation here is: what if out there there exists a filesystem&lt;br/&gt;
that can&apos;t handle this call, and it throws an IOException on that&lt;br/&gt;
platform?  But this is balanced against possible easy-win improvement&lt;br/&gt;
in performance.&lt;/p&gt;

&lt;p&gt;Does anyone have any feedback / thoughts / experience relevant to&lt;br/&gt;
this?&lt;/p&gt;</description>
                <environment></environment>
            <key id="12354601">LUCENE-705</key>
            <summary>CompoundFileWriter should pre-set its file length</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Nov 2006 19:02:38 +0000</created>
                <updated>Sat, 11 Oct 2008 13:49:34 +0100</updated>
                    <resolved>Fri, 25 Jan 2008 09:42:48 +0000</resolved>
                            <version>2.1</version>
                                <fixVersion>2.4</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>1</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12558406" author="gsingers" created="Sun, 13 Jan 2008 15:09:54 +0000"  >&lt;p&gt;This seems reasonable, although I am not an expert in low-level file system calls like this.  I guess for me the thing would be to find out if the major filesystems support it (Windows, OSX, Linux) and then perhaps we can deal w/ others from there as they arise (i.e. those that don&apos;t support it)&lt;/p&gt;</comment>
                    <comment id="12558637" author="mikemccand" created="Mon, 14 Jan 2008 15:37:57 +0000"  >&lt;p&gt;OK I&apos;ll test on the major platforms, and take that approach.  I&apos;ll tentatively target 2.4.&lt;/p&gt;</comment>
                    <comment id="12560986" author="mikemccand" created="Mon, 21 Jan 2008 11:06:47 +0000"  >&lt;p&gt;Attached patch.  All tests pass on OS X 10.4, Linux 2.6.22, Windows&lt;br/&gt;
Server 2003.  I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12562416" author="mikemccand" created="Fri, 25 Jan 2008 09:42:48 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                    <comment id="12564314" author="otis" created="Thu, 31 Jan 2008 06:12:07 +0000"  >&lt;p&gt;Didn&apos;t find time to comment on this earlier.&lt;br/&gt;
Does this mean one will no longer be able to tell exactly how large the index really is (because some portion of some data files will actually be empty)?&lt;/p&gt;</comment>
                    <comment id="12564355" author="mikemccand" created="Thu, 31 Jan 2008 10:09:39 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Does this mean one will no longer be able to tell exactly how large the index really is (because some portion of some data files will actually be empty)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only while the CFS is being built. After it&apos;s done being built, then&lt;br/&gt;
it is &quot;fully occupied&quot; (no portion are empty).&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12373670" name="LUCENE-705.patch" size="2826" author="mikemccand" created="Mon, 21 Jan 2008 11:06:47 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 13 Jan 2008 15:09:54 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13047</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27025</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>