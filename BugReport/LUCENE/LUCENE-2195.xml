<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:08:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2195/LUCENE-2195.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2195] Speedup CharArraySet if set is empty</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2195</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;CharArraySet#contains(...) always creates a HashCode of the String, Char[] or CharSequence even if the set is empty. &lt;br/&gt;
contains should return false if set it empty&lt;/p&gt;</description>
                <environment></environment>
            <key id="12444932">LUCENE-2195</key>
            <summary>Speedup CharArraySet if set is empty</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2010 15:59:20 +0000</created>
                <updated>Fri, 10 May 2013 11:43:28 +0100</updated>
                    <resolved>Mon, 25 Jan 2010 07:49:01 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12797675" author="simonw" created="Thu, 7 Jan 2010 16:32:05 +0000"  >&lt;p&gt;here is a patch&lt;/p&gt;</comment>
                    <comment id="12797684" author="simonw" created="Thu, 7 Jan 2010 17:01:59 +0000"  >&lt;p&gt;Updated patch. This patch does not count==0 check in contains(Object) as the o.toString() could return null and the NPE would be silently swallowed if the set is empty. &lt;br/&gt;
The null check and NPE are necessary to yield consistent behavior no matter if the set is empty or not.&lt;/p&gt;</comment>
                    <comment id="12797686" author="rcmuir" created="Thu, 7 Jan 2010 17:06:21 +0000"  >&lt;p&gt;Simon I like it. this is useful for things like empty stopword sets, so we do not hash every input token unnecessarily.&lt;/p&gt;</comment>
                    <comment id="12797692" author="yseeley@gmail.com" created="Thu, 7 Jan 2010 17:22:39 +0000"  >&lt;p&gt;Seems that this patch would just slow things down (slightly) for the common case, and for correctly written code.&lt;br/&gt;
If one really wants to optimize the case of an empty set, shouldn&apos;t that be done at a higher level (i.e. don&apos;t put the stop filter in the chain, don&apos;t create a set at all, etc).&lt;/p&gt;

&lt;p&gt;So I think we should skip both the null checks and the ==0 checks and leave it as is.&lt;/p&gt;</comment>
                    <comment id="12797698" author="rcmuir" created="Thu, 7 Jan 2010 17:33:03 +0000"  >&lt;p&gt;Yonik, I disagree. I would rather see contains() comparisons against empty sets than this kind of if (set != null &amp;amp;&amp;amp; set.contains())... i see this code around a lot.&lt;/p&gt;

&lt;p&gt;it does not matter, it is the same.&lt;/p&gt;</comment>
                    <comment id="12797701" author="yseeley@gmail.com" created="Thu, 7 Jan 2010 17:37:51 +0000"  >&lt;p&gt;It&apos;s not quite the same - no method call for set != null.&lt;br/&gt;
But my point stands - this is optimization for the very uncommon case at the expense of the common case.  This specific instance isn&apos;t too big of a deal (it&apos;s a predictable branch at least), but as a matter of principle we should avoid going down those roads.&lt;/p&gt;</comment>
                    <comment id="12797710" author="rcmuir" created="Thu, 7 Jan 2010 17:56:28 +0000"  >&lt;p&gt;well then something must be decided: either we use null sets,remove use of EMPTY_SET all over the place, and have if set != null scattered all over the place, or we go this route. &lt;/p&gt;

&lt;p&gt;i do not care either way but we should not be using EMPTY_SET in various tokenstreams without this patch, else we unnecessarily hash every input token for no good reason.&lt;/p&gt;</comment>
                    <comment id="12797722" author="simonw" created="Thu, 7 Jan 2010 18:23:59 +0000"  >&lt;p&gt;I changed my patch to please Yonik who has performance concerns as well as robert who wants to use EMTPY_SET instead of set == null checks. &lt;br/&gt;
I agree with robert that I would rather have an empty set instead of null asssigned if the set is omitted or if the default set is empty. Yet, I subclassed UnmodifiableCharArraySet and added a specailized implementation for EMPTY_SET that checks for null to throw the NPE and otherwise always returns false for all contains(...) methods.&lt;br/&gt;
This class is final and the overhead for the method call should be very small.&lt;/p&gt;

</comment>
                    <comment id="12800405" author="simonw" created="Thu, 14 Jan 2010 22:54:33 +0000"  >&lt;p&gt;any comments on the latest patch?&lt;/p&gt;</comment>
                    <comment id="12801225" author="rcmuir" created="Sat, 16 Jan 2010 17:09:02 +0000"  >&lt;p&gt;Simon i made a few changes (i like the idea of simply a special EmptyCharArraySet so this does not slow down anything else and alleviates any concerns)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I do not think unmodifiableset should have a no-arg ctor, so instead i pushed this up to emptychararrayset&lt;/li&gt;
	&lt;li&gt;i do not think emptychararrayset need override and throw uoe for removeAll or retainAll, and i don&apos;t think the tests were correct in assuming it will throw uoe. it will not throw uoe for say, removeAll only because it is empty. it will just do nothing.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;now the emptychararrayset conforms with AbstractCollation.remove/retainAll:&lt;br/&gt;
Note that this implementation will throw an UnsupportedOperationException if the iterator returned by the iterator method does not implement the remove method and this collection contains one or more elements in common with/not present with the specified collection.&lt;/p&gt;</comment>
                    <comment id="12801252" author="simonw" created="Sat, 16 Jan 2010 18:38:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do not think unmodifiableset should have a no-arg ctor, so instead i pushed this up to emptychararrayset&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok I&apos;m fine with that.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;i do not think emptychararrayset need override and throw uoe for removeAll or retainAll, and i don&apos;t think the tests were correct in assuming it will throw uoe. it will not throw uoe for say, removeAll only because it is empty. it will just do nothing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right, this should only throw this exception if the set contains it and the Iterator does not implement remove()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     * Note that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; implementation &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an
     * &amp;lt;tt&amp;gt;UnsupportedOperationException&amp;lt;/tt&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the iterator returned by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
     * collection&apos;s iterator method does not implement the &amp;lt;tt&amp;gt;remove&amp;lt;/tt&amp;gt;
     * method and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; collection contains the specified object.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;same is true for AbstractSet#removeAll()  &amp;amp; retainAll()&lt;/p&gt;

&lt;p&gt;Thanks for updating it. I think this is good to go though! &lt;/p&gt;
</comment>
                    <comment id="12801528" author="rcmuir" created="Sun, 17 Jan 2010 22:09:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Thanks for updating it. I think this is good to go though! &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;me too, if no one objects I will commit in a few days.&lt;/p&gt;</comment>
                    <comment id="12804429" author="rcmuir" created="Mon, 25 Jan 2010 07:49:01 +0000"  >&lt;p&gt;Committed revision 902723.&lt;/p&gt;

&lt;p&gt;Thanks Simon!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12430514" name="LUCENE-2195.patch" size="5185" author="rcmuir" created="Sat, 16 Jan 2010 17:09:02 +0000" />
                    <attachment id="12429663" name="LUCENE-2195.patch" size="5571" author="simonw" created="Thu, 7 Jan 2010 18:23:59 +0000" />
                    <attachment id="12429654" name="LUCENE-2195.patch" size="3873" author="simonw" created="Thu, 7 Jan 2010 17:01:59 +0000" />
                    <attachment id="12429653" name="LUCENE-2195.patch" size="3800" author="simonw" created="Thu, 7 Jan 2010 16:32:05 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 7 Jan 2010 17:06:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11591</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25530</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>