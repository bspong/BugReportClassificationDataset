<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:21:28 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1397/LUCENE-1397.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1397] When BG merge hits an exception, optimize sometimes throws an IOException missing the root cause</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1397</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>
&lt;p&gt;When IndexWriter.optimize() is called, ConcurrentMergeScheduler will&lt;br/&gt;
run the requested merges with background threads and optimize() will&lt;br/&gt;
wait for these merges to complete.&lt;/p&gt;

&lt;p&gt;If a merge hits an exception, it records the root cause exception such&lt;br/&gt;
that optimize can then retrieve this root cause and throw its own&lt;br/&gt;
exception, with the root cause.&lt;/p&gt;

&lt;p&gt;But there is a bug: sometimes, the fact that an exception occurred on&lt;br/&gt;
a merge is recorded, but the root cause is missing.  In this cause,&lt;br/&gt;
optimize() still throws an exception (correctly indicating that the&lt;br/&gt;
optimize() has not finished successfully), but it&apos;s not helpful&lt;br/&gt;
because it&apos;s missing the root cause.  You must then go find the root&lt;br/&gt;
cause in the JRE&apos;s stderr logs.&lt;/p&gt;

&lt;p&gt;This has hit a few users on this lists, most recently:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://www.nabble.com/Background-merge-hit-exception-td19540409.html#a19540409&quot; class=&quot;external-link&quot;&gt;http://www.nabble.com/Background-merge-hit-exception-td19540409.html#a19540409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found the isssue, and finally got a unit test to intermittently show&lt;br/&gt;
it.  It&apos;s a simple thread safety issue: in a finally clause in&lt;br/&gt;
IndexWriter.merge we record the fact that the merge hit an exception&lt;br/&gt;
before actually setting the root cause, and then only in&lt;br/&gt;
ConcurrentMergeScheduler&apos;s exception handler do we set the root&lt;br/&gt;
cause.  If the optimize thread is scheduled in between these two, it&lt;br/&gt;
can throw an exception missing its root cause.&lt;/p&gt;

&lt;p&gt;The fix is straightforward.  I plan to commit to 2.4 &amp;amp; 2.9.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12404785">LUCENE-1397</key>
            <summary>When BG merge hits an exception, optimize sometimes throws an IOException missing the root cause</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Sep 2008 11:00:39 +0100</created>
                <updated>Sat, 11 Oct 2008 13:49:42 +0100</updated>
                    <resolved>Mon, 22 Sep 2008 23:56:12 +0100</resolved>
                            <version>2.4</version>
                                <fixVersion>2.4</fixVersion>
                <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12632930" author="mikemccand" created="Sat, 20 Sep 2008 11:02:33 +0100"  >&lt;p&gt;Attached patch.  I plan to commit in a day or so, and then roll another RC.&lt;/p&gt;</comment>
                    <comment id="12633547" author="mikemccand" created="Mon, 22 Sep 2008 23:56:12 +0100"  >&lt;p&gt;Committed revision 698025 (trunk) and 698026 (2.4)&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12390569" name="LUCENE-1397.patch" size="5207" author="mikemccand" created="Sat, 20 Sep 2008 11:02:33 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12354</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26331</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>