<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:12:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3615/LUCENE-3615.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3615] Make it easier to run Test2BTerms</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3615</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Currently, Test2BTerms has an @Ignore annotation which means that the only way to run it as a test is to edit the file.&lt;/p&gt;

&lt;p&gt;There are a couple of options to fix this:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add a main() so it can be invoked via the command line outside of the test framework&lt;/li&gt;
	&lt;li&gt;Add some new annotations that mark it as slow or weekly or something like that and have the test target ignore @slow (or whatever) by default, but can also turn it on.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
            <key id="12533667">LUCENE-3615</key>
            <summary>Make it easier to run Test2BTerms</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="gsingers">Grant Ingersoll</assignee>
                                <reporter username="gsingers">Grant Ingersoll</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2011 18:08:37 +0000</created>
                <updated>Fri, 10 May 2013 11:44:20 +0100</updated>
                    <resolved>Sun, 4 Dec 2011 00:20:56 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13161771" author="rcmuir" created="Fri, 2 Dec 2011 18:22:53 +0000"  >&lt;p&gt;we probably need to make sure the ram we give to junit in common-build.xml is parameterized too ( i think we hardcode 512MB )&lt;/p&gt;

&lt;p&gt;at least so you could say ant test -Dtests.ram=8GB -Drunreallyslowtests or whatever&lt;/p&gt;</comment>
                    <comment id="13161825" author="gsingers" created="Fri, 2 Dec 2011 20:03:15 +0000"  >&lt;p&gt;Here&apos;s a first go at this.  Added @Weekly and @Slow.  Added the corresponding properties to common-build.xml.  Added ability to control test heapsize to common-build.  Marked Test2BTerms as @Weekly and @Slow.  Also makred it to not use poor codecs.  Refactored the test runner a bit to share common code when removing annotated tests.&lt;/p&gt;

&lt;p&gt;Still testing whether this works, but thought I would put it up for feedback from those who have big machines.&lt;/p&gt;</comment>
                    <comment id="13161937" author="rcmuir" created="Fri, 2 Dec 2011 23:53:32 +0000"  >&lt;p&gt;patch looks good to me.&lt;/p&gt;

&lt;p&gt;only one question about the patch, should Test2BTerms be both weekly and slow? &lt;br/&gt;
Isn&apos;t it enough to just be slow? (then its only run if you ask for it).&lt;/p&gt;

&lt;p&gt;Separately I think weekly is useful and we can configure hudson to set this on sundays or something.&lt;/p&gt;

&lt;p&gt;the only other change i noticed was just purely cosmetic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// please don&apos;t reorganize these into a wildcard!
-import static org.apache.lucene.util.LuceneTestCase.TEST_ITER;
-import static org.apache.lucene.util.LuceneTestCase.TEST_ITER_MIN;
-import static org.apache.lucene.util.LuceneTestCase.TEST_METHOD;
-import static org.apache.lucene.util.LuceneTestCase.TEST_SEED;
-import static org.apache.lucene.util.LuceneTestCase.TEST_NIGHTLY;
-import static org.apache.lucene.util.LuceneTestCase.VERBOSE;
+import static org.apache.lucene.util.LuceneTestCase.*;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13161941" author="thetaphi" created="Sat, 3 Dec 2011 00:03:16 +0000"  >&lt;p&gt;+1, patch looks good!&lt;/p&gt;</comment>
                    <comment id="13161946" author="hossman" created="Sat, 3 Dec 2011 00:07:43 +0000"  >&lt;p&gt;This reminds me of something i kept wanting to talk to Dawid about after his random testing talk at eurocon but didn&apos;t get a chance and then promptly forgot about.&lt;/p&gt;

&lt;p&gt;rather then having &quot;@Weekly&quot; or &quot;@Slow&quot; (or even &quot;@Nightly&quot;) annotations, we should just use an &quot;@Weight(Integer)&quot; annotation indicating how &quot;heavy&quot; a test is (tests w/o an @Weight annotation would be treated as if they had an &quot;@Weight(1)&quot; annotation).  The options for running tests would then let you specify the min/max weight for the tests you want to run, and instead of a &quot;boolean isNightly()&quot; there could be an &quot;int maxTestWeight()&quot; method that would factor into methods like &quot;rarely()&quot; and &quot;usually()&quot;&lt;/p&gt;

&lt;p&gt;So most tests would have no annotation, tests that currently use @Nightly would get @Weight(10) (or 5, or 100, or whatever) and tests like 2BTerms might get @Weight(10000).&lt;/p&gt;

&lt;p&gt;while the default &quot;ant test&quot; might use &lt;tt&gt;-Dtest.weight.min=1 -Dtest.weight.max=10&lt;/tt&gt; so developers and the jenkins post-commit build would run &quot;most&quot; tests, the &quot;test only&quot; jenkins build might be run with &lt;tt&gt;-Dtest.weight.min=1 -Dtest.weight.max=1&lt;/tt&gt; to only run the really fast test in a rapid fire, and a nightly jenkins run could use &lt;tt&gt;-Dtest.weight.min=1 -Dtest.weight.max=100&lt;/tt&gt; and a weekly (or monthly, or whatever) run might use &lt;tt&gt;-Dtest.weight.min=100 -Dtest.weight.max=100000&lt;/tt&gt; (ie: skip the quick tests and just run the heavy shit)&lt;/p&gt;</comment>
                    <comment id="13162024" author="rcmuir" created="Sat, 3 Dec 2011 02:27:56 +0000"  >&lt;blockquote&gt;
&lt;p&gt;rather then having &quot;@Weekly&quot; or &quot;@Slow&quot; (or even &quot;@Nightly&quot;) annotations, we should just use an &quot;@Weight(Integer)&quot; annotation indicating how &quot;heavy&quot; a test is&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But I&apos;m not sure I agree with this. Most tests have completely different runtime based on what configurations they get. Sometimes, rarely, we apply totally crazy parameters that make them go &quot;nuts&quot;. Because of this we amortize the cost of checking expensive corner cases (like termIndexInterval=1, horrible params that cause a lot of merging, etc) across the different tests. I think this is good, it really finds corner case bugs. So if we had this weight annotation, i have no clue what we would assign it to anything.&lt;/p&gt;

&lt;p&gt;Because you take a test that does a lot of skipping/conjunctions, and if it gets memorycodec it might be take a terribly long time (since memorycodec doesn&apos;t support skipping), but otherwise it doesnt really care about termsindexinterval. On the other hand you take a test that is torturing the terms dictionary, and it doesnt care if you give it memorycodec or a shitty skipinterval, but you give it a crazy termsindexinterval and it spends a lot of time next&apos;ing thru terms, etc.&lt;/p&gt;

&lt;p&gt;Because of this, all of the tests behave in totally different ways that you cant really assign a weight to, e.g. take a look at the history of test times &lt;br/&gt;
for this test:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/G-L/view/Lucene/job/Lucene-Solr-tests-only-trunk/11631/testReport/org.apache.lucene.search/TestRegexpRandom2/history/&quot; class=&quot;external-link&quot;&gt;https://builds.apache.org/view/G-L/view/Lucene/job/Lucene-Solr-tests-only-trunk/11631/testReport/org.apache.lucene.search/TestRegexpRandom2/history/&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13162186" author="gsingers" created="Sat, 3 Dec 2011 17:53:18 +0000"  >&lt;p&gt;I think in theory the weight thing sounds good, but in practice I think it would be hard to figure out the proper weights.&lt;/p&gt;</comment>
                    <comment id="13162188" author="gsingers" created="Sat, 3 Dec 2011 17:54:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;// please don&apos;t reorganize these into a wildcard!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, I thought I disabled that in IntelliJ.&lt;/p&gt;</comment>
                    <comment id="13162190" author="gsingers" created="Sat, 3 Dec 2011 18:03:21 +0000"  >&lt;p&gt;Fixes as suggested by Robert.  I&apos;ll likely commit at some point later today or tomorrow unless Hoss wants to discuss the weight thing more, in which case I&apos;m happy to hold off.&lt;/p&gt;</comment>
                    <comment id="13162244" author="gsingers" created="Sun, 4 Dec 2011 00:19:50 +0000"  >&lt;p&gt;minor import fix, ready to go.&lt;/p&gt;</comment>
                    <comment id="13162396" author="gsingers" created="Sun, 4 Dec 2011 13:30:55 +0000"  >&lt;p&gt;Ran this last night:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Testsuite: org.apache.lucene.index.Test2BTerms&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 12,475.641 sec&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, roughly 3.5 hours.  Not at all unreasonable to run on a weekly basis.&lt;/p&gt;</comment>
                    <comment id="13162986" author="hossman" created="Mon, 5 Dec 2011 19:57:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Because of this, all of the tests behave in totally different ways that you cant really assign a weight to, e.g. take a look at the history of test times for this test:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&quot;Weight&quot; may be the wrong term... i wasn&apos;t suggesting that it would be any sort of quantitative, comparable metric of how long the test would take &amp;#8211; my point was just that having a numeric annotation where bigger means &quot;this test does more stuff&quot; would allow people to run more or less tests as they see fit with simple configuration, regardless of whether their idea of a test to be run &quot;Nightly&quot; jives directly with the @Nightly annotation (maybe i want to only run @Nightly tests on weekends?)&lt;/p&gt;

&lt;p&gt;As things stand, we have regular tests, and then we have @Nightly tests, and then we have @Slow tests ... hypothetically: if we add a new test later that&apos;s not nearly as bad as Test2BTerms, so we still want it to run as part of a &quot;full test run&quot; but is bad enough that we don&apos;t want to jenkins to do it was part of our  &quot;@Nightly&quot; run, we  have to consider some intermediate &quot;@SortOfSlow&quot; attribute ... hence my suggestion that instead of adding more special case annotations (and more build params for deciding when to exececute what), we just use an arbitrary  range of numbers and two simple &quot;min&quot; and &quot;max&quot; build params to pick the tests to run.&lt;/p&gt;

&lt;p&gt;...anyway ... it was just an idea.&lt;/p&gt;


</comment>
                </comments>
                    <attachments>
                    <attachment id="12506010" name="LUCENE-3615.patch" size="10860" author="gsingers" created="Sun, 4 Dec 2011 00:19:50 +0000" />
                    <attachment id="12506002" name="LUCENE-3615.patch" size="10560" author="gsingers" created="Sat, 3 Dec 2011 18:03:21 +0000" />
                    <attachment id="12505924" name="LUCENE-3615.patch" size="10584" author="gsingers" created="Fri, 2 Dec 2011 20:03:15 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 2 Dec 2011 18:22:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>219395</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24083</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>