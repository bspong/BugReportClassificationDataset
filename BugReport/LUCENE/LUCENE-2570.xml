<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:22:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2570/LUCENE-2570.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2570] Some improvements to _TestUtil and its usage</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2570</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I&apos;ve started this issue because I&apos;ve noticed that _TestUtil.getRandomMultiplier() is called from many loops&apos; condition check, sometimes hundreds and thousands of times. Each time it does Integer.parseInt after calling System.getProperty. This really can become a constant IMO, either in LuceneTestCase(J4) or _TestUtil, as it&apos;s not expected to change while tests are running ...&lt;/p&gt;

&lt;p&gt;I then reviewed the class and spotted some more things that I think can be fixed/improved:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;getTestCodec() can become a constant as well&lt;/li&gt;
	&lt;li&gt;arrayToString is marked deprecated. I&apos;ve checked an no one calls them, so I&apos;ll delete them. This is a 4.0 code branch + a test-only class. No need to deprecate anything.&lt;/li&gt;
	&lt;li&gt;getTempDir calls new Random(), instead of newRandom() in LuceneTestCaseJ4, which means that if something fails, we won&apos;t know the random seed used ...
	&lt;ul&gt;
		&lt;li&gt;In that regard, we might want to output all the classes that obtained a static seed in reportAdditionalFailures(), instead of just the class that ran the test.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;rmDir(String) can be removed IMO, and leave only rmDir(File)&lt;/li&gt;
	&lt;li&gt;I suggest we include some recursion in rmDir(File) to handle the deletion of nested directories.
	&lt;ul&gt;
		&lt;li&gt;Also, it does not check whether the dir deletion itself succeeds (but it does so for the files). This can bite us on Windows, if some test did not close things properly.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ll work out a patch.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12470226">LUCENE-2570</key>
            <summary>Some improvements to _TestUtil and its usage</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="shaie">Shai Erera</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Jul 2010 05:13:39 +0100</created>
                <updated>Wed, 30 Mar 2011 16:50:26 +0100</updated>
                    <resolved>Tue, 27 Jul 2010 15:28:21 +0100</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12892691" author="rcmuir" created="Tue, 27 Jul 2010 09:40:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;In that regard, we might want to output all the classes that obtained a static seed in reportAdditionalFailures(), instead of just the class that ran the test.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that one might be confusing? because one test class can&apos;t really affect another. I like all your other suggestions though!&lt;/p&gt;</comment>
                    <comment id="12892693" author="shaie" created="Tue, 27 Jul 2010 09:51:13 +0100"  >&lt;p&gt;I was thinking of the fix to getTempDir that I proposed. If _TestUtil should obtain such static random, then it (1) needs to extend LuceneTestCaseJ4 and (2) will affect all the classes that call this method.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I like having _TestUtil extending LTCJ4, and not sure that particular random can affect any test failure ... so perhaps I&apos;ll leave that fix outside?&lt;/p&gt;</comment>
                    <comment id="12892694" author="thetaphi" created="Tue, 27 Jul 2010 09:58:17 +0100"  >&lt;p&gt;We can remove the whole class and move the code to LTC(J4)?&lt;/p&gt;</comment>
                    <comment id="12892700" author="rcmuir" created="Tue, 27 Jul 2010 10:18:41 +0100"  >&lt;p&gt;Another option, is if _TestUtil has methods that need a random, make it a required argument?&lt;/p&gt;</comment>
                    <comment id="12892711" author="shaie" created="Tue, 27 Jul 2010 11:25:01 +0100"  >&lt;p&gt;I don&apos;t think that removing the class is a good idea. Some methods like rmDir can exist on the base test classes, however the class also contains large arrays blockStarts/Ends and it will just clatter the base test class, I think. What do you think?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another option, is if _TestUtil has methods that need a random, make it a required argument? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I had thought about it, but that method is called from several places in the code, and the randomness seems very insignificant. It just adds a random number to the directory name the caller requested. If it is in order to prevent collisions, then the code isn&apos;t safe because there is a chance the same number will be generated twice ...&lt;/p&gt;</comment>
                    <comment id="12892714" author="shaie" created="Tue, 27 Jul 2010 11:44:04 +0100"  >&lt;p&gt;Most of the patch is about replacing the calls to getRandomMultiplier w/ the static constant reference. All tests pass, except the one that is fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2568&quot; title=&quot;TestUTF32ToUTF8 fails on IBM&amp;#39;s JRE&quot;&gt;&lt;del&gt;LUCENE-2568&lt;/del&gt;&lt;/a&gt; (but not committed yet). Unless you have more comments, I&apos;d like to commit this shortly.&lt;/p&gt;</comment>
                    <comment id="12892716" author="rcmuir" created="Tue, 27 Jul 2010 11:49:46 +0100"  >&lt;p&gt;the only comment i have is exposing TEST_CODEC as public... can it be private? &lt;/p&gt;

&lt;p&gt;I don&apos;t think its very useful since it could be a value like &quot;random&quot; (and is by default!) which isnt actually a valid codec, its basically just internal to LuceneTestCase&lt;span class=&quot;error&quot;&gt;&amp;#91;J4&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                    <comment id="12892722" author="shaie" created="Tue, 27 Jul 2010 12:03:02 +0100"  >&lt;p&gt;I can make it private, but then I&apos;ll need to repeat the declaration line in both LTC and LTCJ4. Currently, LTC just references the one in LTCJ4. If that matters, I can make it package-private?&lt;/p&gt;</comment>
                    <comment id="12892725" author="rcmuir" created="Tue, 27 Jul 2010 12:13:20 +0100"  >&lt;p&gt;package-private works... i just wanted to prevent confusion since i don&apos;t think its very useful outside of LuceneTestCase&lt;span class=&quot;error&quot;&gt;&amp;#91;J4&amp;#93;&lt;/span&gt; &lt;/p&gt;</comment>
                    <comment id="12892729" author="shaie" created="Tue, 27 Jul 2010 12:18:42 +0100"  >&lt;p&gt;ok will do, and commit.&lt;/p&gt;</comment>
                    <comment id="12892795" author="shaie" created="Tue, 27 Jul 2010 15:28:21 +0100"  >&lt;p&gt;Committed revision 979646 (trunk).&lt;br/&gt;
Committed revision 979720 (3x).&lt;/p&gt;</comment>
                    <comment id="13013479" author="gsingers" created="Wed, 30 Mar 2011 16:50:26 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12450583" name="LUCENE-2570.patch" size="53205" author="shaie" created="Tue, 27 Jul 2010 11:44:04 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 27 Jul 2010 08:40:10 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11263</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25122</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>