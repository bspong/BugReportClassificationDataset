<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:17:16 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-689/LUCENE-689.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-689] NullPointerException thrown by equals method in SpanOrQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-689</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Part of our code utilizes the equals method in SpanOrQuery and, in certain cases (details to follow, if necessary), a NullPointerException gets thrown as a result of the String &quot;field&quot; being null.  After applying the following patch, the problem disappeared:&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/lucene/search/spans/SpanOrQuery.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (revision 465065)&lt;br/&gt;
+++ src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (working copy)&lt;br/&gt;
@@ -121,7 +121,8 @@&lt;br/&gt;
     final SpanOrQuery that = (SpanOrQuery) o;&lt;/p&gt;

&lt;p&gt;     if (!clauses.equals(that.clauses)) return false;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!field.equals(that.field)) return false;&lt;br/&gt;
+    if (field != null &amp;amp;&amp;amp; !field.equals(that.field)) return false;&lt;br/&gt;
+    if (field == null &amp;amp;&amp;amp; that.field != null) return false;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     return getBoost() == that.getBoost();&lt;br/&gt;
   }&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Java 1.5.0_09, RHEL 3 Linux, Tomcat 5.0.28&lt;/p&gt;</environment>
            <key id="12353542">LUCENE-689</key>
            <summary>NullPointerException thrown by equals method in SpanOrQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="otis">Otis Gospodnetic</assignee>
                                <reporter username="linuxologist">Michael Goddard</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Oct 2006 02:35:07 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:05 +0100</updated>
                    <resolved>Wed, 4 Mar 2009 14:19:41 +0000</resolved>
                            <version>2.1</version>
                                <fixVersion>2.9</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>1</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12443726" author="otis" created="Fri, 20 Oct 2006 08:08:49 +0100"  >&lt;p&gt;Hm, weird.  l peeked at SpanOrQuery.java and it looks like the private field instance var should be set in the ctor, using the field from the first clause, no?  How come your field is null in the first place?&lt;/p&gt;</comment>
                    <comment id="12443776" author="linuxologist" created="Fri, 20 Oct 2006 11:19:14 +0100"  >&lt;p&gt;Otis, you have an excellent point.  At the time I encountered this error, I was in a hurry to get something shipped out.  I will solve for why that happened, however perhaps coding this more defensively would be ok, too.  So, if the patch suggested above isn&apos;t the proper way to deal with it, what about the suggestion that the &quot;field&quot; instance variable be required to be non-null when it is set, so the constructor throws a NullPointerException if it is null?  That seems like the correct behavior to me.  This patch could be used to provide that behavior:&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/lucene/search/spans/SpanOrQuery.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (revision 466047)&lt;br/&gt;
+++ src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (working copy)&lt;br/&gt;
@@ -43,6 +43,9 @@&lt;br/&gt;
       SpanQuery clause = clauses&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
       if (i == 0) {                               // check field&lt;br/&gt;
         field = clause.getField();&lt;br/&gt;
+        if (field == null) &lt;/p&gt;
{
+          throw new NullPointerException(&quot;Field name can not be null.&quot;);
+        }
&lt;p&gt;       } else if (!clause.getField().equals(field)) &lt;/p&gt;
{
         throw new IllegalArgumentException(&quot;Clauses must have same field.&quot;);
       }

&lt;p&gt;On the other hand, if the field name is in fact an interned string, then the portion of the equals method dealing with it could simply compare references, via &quot;==&quot;.  That sounds simpler all around.  But ensuring the field is non-null may be a good idea, anyhow.&lt;/p&gt;</comment>
                    <comment id="12443885" author="otis" created="Fri, 20 Oct 2006 17:23:37 +0100"  >&lt;p&gt;I&apos;d personally really want to see how come that field is null to begin with.  If possible, could you try to debug this a bit and see what kind of SpanQueries with null fields you are dealing with.&lt;/p&gt;

&lt;p&gt;Even if we check for field == null and throw an exception, you won&apos;t get very far, so in the end you&apos;ll need to figure out where this null is coming from and why.  This is not to say that throwing an exception in case of null is not a good thing.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    <comment id="12446089" author="rahearn" created="Tue, 31 Oct 2006 22:17:35 +0000"  >&lt;p&gt;Otis, I&apos;ve been working with Mike on this and can explain how field can become null.  When rewrite() is called on a SpanRegexQuery that doesn&apos;t have any enumerations in the index (as returned by getEnum() in RegexQuery, called from rewrite() in MultiTermQuery) the SpanOrQuery constructor is called with an array of length 0.  Thus the for loop in the SpanOrQuery ctor is never entered and field is never initialized.  Hope this helps explain the behavior.&lt;/p&gt;</comment>
                    <comment id="12474330" author="steven_parkes" created="Tue, 20 Feb 2007 01:36:22 +0000"  >&lt;p&gt;Looks like SpanOrQuery should support an empty SpanQuery. The existing tests even call it, they just never call equals.&lt;/p&gt;

&lt;p&gt;Added a check to avoid the NPE and a test that equals on empties works.&lt;/p&gt;</comment>
                    <comment id="12648049" author="markrmiller@gmail.com" created="Sun, 16 Nov 2008 23:53:27 +0000"  >&lt;p&gt;This patch is very simple, still applies,  and the issue does need to be fixed.&lt;/p&gt;</comment>
                    <comment id="12648240" author="steven_parkes" created="Mon, 17 Nov 2008 18:41:39 +0000"  >&lt;p&gt;Thanks, Otis. Was just gonna remove myself as assignee.&lt;/p&gt;</comment>
                    <comment id="12678739" author="markrmiller@gmail.com" created="Wed, 4 Mar 2009 14:19:41 +0000"  >&lt;p&gt;thanks all&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12351551" name="LUCENE-689.txt" size="1255" author="steven_parkes" created="Tue, 20 Feb 2007 01:36:22 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 20 Oct 2006 07:08:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13063</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27041</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>