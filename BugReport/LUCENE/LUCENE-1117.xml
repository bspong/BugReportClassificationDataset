<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:39 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1117/LUCENE-1117.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1117] Intermittent thread safety issue with EnwikiDocMaker</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1117</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Intermittent thread safety issue with EnwikiDocMaker&lt;/p&gt;

&lt;p&gt;When I run the conf/wikipediaOneRound.alg, sometimes it gets started&lt;br/&gt;
OK, other times (about 1/3rd the time) I see this:&lt;/p&gt;

&lt;p&gt;     Exception in thread &quot;Thread-0&quot; java.lang.RuntimeException: java.io.IOException: Bad file descriptor&lt;br/&gt;
     	at org.apache.lucene.benchmark.byTask.feeds.EnwikiDocMaker$Parser.run(EnwikiDocMaker.java:76)&lt;br/&gt;
     	at java.lang.Thread.run(Thread.java:595)&lt;br/&gt;
     Caused by: java.io.IOException: Bad file descriptor&lt;br/&gt;
     	at java.io.FileInputStream.readBytes(Native Method)&lt;br/&gt;
     	at java.io.FileInputStream.read(FileInputStream.java:194)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLEntityManager$RewindableInputStream.read(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.io.UTF8Reader.read(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLEntityScanner.load(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLEntityScanner.scanQName(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)&lt;br/&gt;
     	at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)&lt;br/&gt;
     	at org.apache.lucene.benchmark.byTask.feeds.EnwikiDocMaker$Parser.run(EnwikiDocMaker.java:60)&lt;br/&gt;
     	... 1 more&lt;/p&gt;

&lt;p&gt;The problem is that the thread that pulls the XML docs is started as&lt;br/&gt;
soon as EnwikiDocMaker class is instantiated.  When it&apos;s started, it&lt;br/&gt;
uses the fileIS (FileInputStream) to feed the XML Parser.  But,&lt;br/&gt;
openFile is actually called twice on starting the alg, if you use any&lt;br/&gt;
task deriving from ResetInputsTask, which closes the original fileIS&lt;br/&gt;
that the XML parser may be using.&lt;/p&gt;

&lt;p&gt;I changed the thread to instead start on-demand the first time next()&lt;br/&gt;
is called.  I also removed a redundant resetInputs() call (which was&lt;br/&gt;
opening the file more frequently than needed).  Finally, I added logic&lt;br/&gt;
in the thread to detect that the input stream was closed (because&lt;br/&gt;
LineDocMaker.resetInputs() was called, eg, if we are not running the&lt;br/&gt;
doc maker to exhaustion).&lt;/p&gt;
</description>
                <environment></environment>
            <key id="12385496">LUCENE-1117</key>
            <summary>Intermittent thread safety issue with EnwikiDocMaker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Jan 2008 14:34:21 +0000</created>
                <updated>Fri, 25 Jan 2008 03:24:16 +0000</updated>
                    <resolved>Sat, 5 Jan 2008 01:52:19 +0000</resolved>
                            <version>2.2</version>
                <version>2.3</version>
                                <fixVersion>2.3</fixVersion>
                                <component>modules/benchmark</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12555581" author="mikemccand" created="Thu, 3 Jan 2008 14:35:16 +0000"  >&lt;p&gt;Attached patch.  All tests pass.  I plan to commit in a day or two.&lt;/p&gt;</comment>
                    <comment id="12556591" author="gsingers" created="Mon, 7 Jan 2008 15:38:58 +0000"  >&lt;p&gt;I am now getting:&lt;br/&gt;
Exception in thread &quot;Thread-1&quot; java.lang.RuntimeException: java.net.MalformedURLException&lt;br/&gt;
	at org.apache.lucene.benchmark.byTask.feeds.EnwikiDocMaker$Parser.run(EnwikiDocMaker.java:88)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Caused by: java.net.MalformedURLException&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:601)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)&lt;br/&gt;
	at org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.impl.XMLVersionDetector.determineDocVersion(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)&lt;br/&gt;
	at org.apache.lucene.benchmark.byTask.feeds.EnwikiDocMaker$Parser.run(EnwikiDocMaker.java:62)&lt;br/&gt;
	... 1 more&lt;/p&gt;

&lt;p&gt;Is there something new that I need to call before calling nextDocument?  I am using this outside of the benchmark framework.  It seems fileIS is not getting called for me.&lt;/p&gt;</comment>
                    <comment id="12556594" author="gsingers" created="Mon, 7 Jan 2008 15:39:55 +0000"  >&lt;p&gt;This is what I am doing:&lt;br/&gt;
EnwikiDocMaker docMaker = new EnwikiDocMaker();&lt;br/&gt;
      Properties properties = new Properties();&lt;br/&gt;
      //fileName = config.get(&quot;docs.file&quot;, null);&lt;br/&gt;
      String filePath = wikipediaXML.getAbsolutePath();&lt;br/&gt;
      properties.setProperty(&quot;docs.file&quot;, filePath);&lt;br/&gt;
      properties.setProperty(&quot;doc.maker.forever&quot;, &quot;false&quot;);&lt;br/&gt;
      docMaker.setConfig(new Config(properties));&lt;/p&gt;</comment>
                    <comment id="12556598" author="mikemccand" created="Mon, 7 Jan 2008 15:45:08 +0000"  >&lt;p&gt;I think you just need to call docMaker.resetInputs()?&lt;/p&gt;

&lt;p&gt;The contrib/benchmark framework calls that, on creating a docMaker.  That method opens the line file.&lt;/p&gt;</comment>
                    <comment id="12556602" author="gsingers" created="Mon, 7 Jan 2008 15:52:00 +0000"  >&lt;p&gt;OK, that works!  Thanks, Mike&lt;/p&gt;</comment>
                    <comment id="12556899" author="gsingers" created="Tue, 8 Jan 2008 13:55:20 +0000"  >&lt;p&gt;I&apos;ve also noticed with this that the process doesn&apos;t die if there is an exception thrown (as in the one above) b/c I think the thread doesn&apos;t stop.  &lt;/p&gt;</comment>
                    <comment id="12556938" author="mikemccand" created="Tue, 8 Jan 2008 16:44:19 +0000"  >&lt;p&gt;Yeah, I&apos;ve seen this too; it&apos;s a pre-existing issue (the exception in&lt;br/&gt;
the o.p. of this issue also would just hang).&lt;/p&gt;

&lt;p&gt;OK I worked out a patch to fix this: attached excHang.patch.  I&apos;ll&lt;br/&gt;
in a day or two!&lt;/p&gt;</comment>
                    <comment id="12557586" author="mikemccand" created="Thu, 10 Jan 2008 10:12:51 +0000"  >&lt;p&gt;OK I just committed the fix to NOT hang when the XML parsing thread hits an exception.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12372722" name="excHang.patch" size="1725" author="mikemccand" created="Tue, 8 Jan 2008 16:44:18 +0000" />
                    <attachment id="12372454" name="LUCENE-1117.patch" size="3165" author="mikemccand" created="Thu, 3 Jan 2008 14:35:15 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 7 Jan 2008 15:38:58 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12628</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26612</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>