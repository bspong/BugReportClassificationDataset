<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:16:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3668/LUCENE-3668.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3668] offsets issues with multiword synonyms</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3668</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;as reported on the list, there are some strange offsets with FSTSynonyms, in the case of multiword synonyms.&lt;/p&gt;

&lt;p&gt;as a workaround it was suggested to use the older synonym impl, but it has bugs too (just in a different way).&lt;/p&gt;</description>
                <environment></environment>
            <key id="12536396">LUCENE-3668</key>
            <summary>offsets issues with multiword synonyms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Dec 2011 20:10:53 +0000</created>
                <updated>Fri, 10 May 2013 11:43:38 +0100</updated>
                    <resolved>Sat, 7 Jan 2012 16:48:04 +0000</resolved>
                                            <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>5</watches>
                                                    <comments>
                    <comment id="13176008" author="rcmuir" created="Mon, 26 Dec 2011 20:16:30 +0000"  >&lt;p&gt;here&apos;s 2 tests, one for the old impl, one for the new one:&lt;/p&gt;

&lt;p&gt;In this case we have national hockey league = nhl.&lt;/p&gt;

&lt;p&gt;desired behavior:&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;token&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;posIncr&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;startOffset&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;endOffset&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;national&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;nhl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;b&gt;22&lt;/b&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hockey&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;league&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;current behavior (FST impl):&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;token&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;posIncr&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;startOffset&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;endOffset&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;national&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;nhl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;b&gt;8&lt;/b&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hockey&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;league&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;old impl:&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;token&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;posIncr&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;startOffset&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;endOffset&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;national&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;nhl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hockey&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;league&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;From the offsets perspective, nhl is only getting the offsets of national (endoffset=8) but it would be bettter if it got endoffset=22.&lt;/p&gt;

&lt;p&gt;Using the old impl imo is no workaround, the offsets are crazy (each individual word gets 0-22). But i think we should just leave it be and try to improve the new one.&lt;/p&gt;</comment>
                    <comment id="13176053" author="koji" created="Mon, 26 Dec 2011 23:45:14 +0000"  >&lt;p&gt;Thank you for opening this issue, Robert!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Using the old impl imo is no workaround, the offsets are crazy (each individual word gets 0-22).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point. Using old impl, if I search for national, the whole phrase of &quot;national hockey league&quot; is highlighted.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But i think we should just leave it be and try to improve the new one.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="13179506" author="mikemccand" created="Wed, 4 Jan 2012 14:19:48 +0000"  >&lt;p&gt;Patch; I think it&apos;s ready.&lt;/p&gt;

&lt;p&gt;I fixed the syn filter to set the start/end offset only when the right-hand-side of the rule has a single token; else, it does what it did before (inherit start/end offset from the single input token the output is &quot;on top of&quot;).&lt;/p&gt;</comment>
                    <comment id="13182018" author="rcmuir" created="Sat, 7 Jan 2012 16:21:10 +0000"  >&lt;p&gt;+1, I think this is the right solution.&lt;/p&gt;

&lt;p&gt;If you have &quot;a b&quot; -&amp;gt; &quot;c d e&quot; or &quot;a b c&quot; -&amp;gt; &quot;d e&quot; then what we are doing now seems good and well-defined,&lt;br/&gt;
(i have no idea what else we could even do), but with one output we &quot;know&quot; and the patch improves that case.&lt;/p&gt;</comment>
                    <comment id="13182021" author="mikemccand" created="Sat, 7 Jan 2012 16:48:04 +0000"  >&lt;p&gt;Thanks Koji!&lt;/p&gt;</comment>
                    <comment id="13258775" author="rahul290484" created="Sat, 21 Apr 2012 06:37:33 +0100"  >&lt;p&gt;I&apos;m using solr 3.6, and with luceneMatchVersion =3.6 in my solrconfig.xml I&apos;m still seeing issues with highlighting. However using luceneMatchVersion=3.3 fixes my issue.&lt;/p&gt;

&lt;p&gt;Issue Details: &lt;/p&gt;

&lt;p&gt;In my synonyms if I have:&lt;br/&gt;
nhl, national hockey league &lt;/p&gt;

&lt;p&gt;If I index &quot;Australian nhl team great&quot; and &lt;br/&gt;
search-use-case 1: search for &quot;hockey&quot; (without quotes) in my highlighted response snippets I get &quot;Australian nhl &amp;lt;em&amp;gt;team&amp;lt;/em&amp;gt; great&quot;.&lt;br/&gt;
search-use-case 2: search for &quot;league&quot; (without quotes) in my highlighted response snippets I get &quot;Australian nhl team &amp;lt;em&amp;gt;great&amp;lt;/em&amp;gt;&quot;.&lt;/p&gt;

&lt;p&gt;Here is my feildType and field definitions:&lt;br/&gt;
&amp;lt;fieldType name=&quot;text_general&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;analyzer type=&quot;index&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;charFilter class=&quot;solr.HTMLStripCharFilterFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.StandardTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.SynonymFilterFactory&quot; synonyms=&quot;synonyms.txt&quot; ignoreCase=&quot;true&quot; expand=&quot;true&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.StopFilterFactory&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords.txt&quot; enablePositionIncrements=&quot;true&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.PorterStemFilterFactory&quot;/&amp;gt;        &lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
      &amp;lt;analyzer type=&quot;query&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.StandardTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.SynonymFilterFactory&quot; synonyms=&quot;synonyms.txt&quot; ignoreCase=&quot;true&quot; expand=&quot;false&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.StopFilterFactory&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords.txt&quot; enablePositionIncrements=&quot;true&quot; /&amp;gt;&lt;br/&gt;
		&amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.PorterStemFilterFactory&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
    &amp;lt;/fieldType&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;field name=&quot;description&quot; type=&quot;text_synonym&quot; indexed=&quot;true&quot; stored=&quot;true&quot;  termVectors=&quot;true&quot; termPositions=&quot;true&quot;  termOffsets=&quot;true&quot; omitNorms=&quot;false&quot;/&amp;gt;&lt;/p&gt;
</comment>
                    <comment id="13434125" author="sturlese" created="Tue, 14 Aug 2012 14:50:29 +0100"  >&lt;p&gt;I&apos;ve tried this with solr-4-beta and seeing the same problem. I&apos;ve tried normal al fastVectorHighlighter and got success in none of them. The code of SynonymFilter.java is exactly the same in lucene 3.6.1, 4-alpha, 4-beta and trunk.&lt;br/&gt;
Should this be working? Is there any special configuration to take into account?&lt;br/&gt;
I&apos;ve seen that not only offsets have been added since the patch but lengths too. Could this somehow affect? &lt;/p&gt;</comment>
                    <comment id="13435799" author="aquaglia" created="Thu, 16 Aug 2012 07:53:36 +0100"  >&lt;p&gt;We are also facing problems including &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3390&quot; title=&quot;Highlighting issue with multi-word synonyms causes to highlight the wrong terms&quot;&gt;SOLR-3390&lt;/a&gt;&lt;br/&gt;
Is using &amp;lt;luceneMatchVersion&amp;gt;LUCENE_33&amp;lt;/luceneMatchVersion&amp;gt; with Solr 3.6.1 an officially supported solution?&lt;br/&gt;
Is that good for a production system?&lt;/p&gt;</comment>
                    <comment id="13506378" author="okkeklein" created="Thu, 29 Nov 2012 10:41:41 +0000"  >&lt;p&gt;Doesn&apos;t work for me either in Solr4. Can we revisit this issue?&lt;/p&gt;

&lt;p&gt;Perhaps this &lt;a href=&quot;http://nolanlawson.com/2012/10/31/better-synonym-handling-in-solr/&quot; class=&quot;external-link&quot;&gt;http://nolanlawson.com/2012/10/31/better-synonym-handling-in-solr/&lt;/a&gt; can give some insight/help?&lt;/p&gt;</comment>
                    <comment id="13506554" author="rcmuir" created="Thu, 29 Nov 2012 16:00:23 +0000"  >&lt;p&gt;That writeup is a little off.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Finally, and most seriously, the SynonymFilterFactory will simply not match multi-word synonyms in user queries if you do any kind of tokenization. This is because the tokenizer breaks up the input before the SynonymFilterFactory can transform it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats not correct. The bug is in QueryParser: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2605&quot; title=&quot;queryparser parses on whitespace&quot;&gt;LUCENE-2605&lt;/a&gt;.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12509405" name="LUCENE-3668.patch" size="13943" author="mikemccand" created="Wed, 4 Jan 2012 14:19:48 +0000" />
                    <attachment id="12508640" name="LUCENE-3668_test.patch" size="3874" author="rcmuir" created="Mon, 26 Dec 2011 20:16:30 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 26 Dec 2011 23:45:14 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>222080</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24030</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>