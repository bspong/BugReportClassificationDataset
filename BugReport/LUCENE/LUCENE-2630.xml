<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:32:38 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2630/LUCENE-2630.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2630] make the build more friendly to apache harmony</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2630</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;as part of improved testing, i thought it would be a good idea to make the build (ant test) more friendly&lt;br/&gt;
to working under apache harmony.&lt;/p&gt;

&lt;p&gt;i&apos;m not suggesting we de-optimize code for sun jvms or anything crazy like that, only use it as a tool.&lt;/p&gt;

&lt;p&gt;for example:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;bugs in tests/code: for example i found a test that expected ArrayIOOBE&lt;br/&gt;
  when really the javadoc contract for the method is just IOOBE... it just happens to&lt;br/&gt;
  pass always on sun jvm because thats the implementation it always throws.&lt;/li&gt;
	&lt;li&gt;better reproduction of bugs: for example &lt;a href=&quot;http://en.wikipedia.org/wiki/Unusual_software_bug#Phase_of_the_Moon_bug&quot; class=&quot;external-link&quot;&gt;2 months out of the year&lt;/a&gt;&lt;br/&gt;
  it seems TestQueryParser fails with thai locale in a difficult-to-reproduce way.&lt;br/&gt;
  but i &lt;b&gt;always&lt;/b&gt; get similar failures like this with harmony for this test class.&lt;/li&gt;
	&lt;li&gt;better stability and portability: we should try (if reasonable) to avoid depending&lt;br/&gt;
  upon internal details. the same kinds of things that fail in harmony might suddenly&lt;br/&gt;
  fail in a future sun jdk. because its such a different impl, it brings out a lot of interesting stuff.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;at the moment there are currently a lot of failures, I think a lot might be caused by this: &lt;a href=&quot;http://permalink.gmane.org/gmane.comp.java.harmony.devel/39484&quot; class=&quot;external-link&quot;&gt;http://permalink.gmane.org/gmane.comp.java.harmony.devel/39484&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
            <key id="12472986">LUCENE-2630</key>
            <summary>make the build more friendly to apache harmony</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Sep 2010 01:24:41 +0100</created>
                <updated>Wed, 30 Mar 2011 16:50:03 +0100</updated>
                    <resolved>Wed, 22 Sep 2010 06:52:35 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>general/build</component>
                <component>general/test</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12904859" author="rcmuir" created="Wed, 1 Sep 2010 02:22:03 +0100"  >&lt;p&gt;here&apos;s a patch that allows things to compile and tests to run&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;removed the sunisms from the compile task so it works with harmony in the expected way:  (-Dbuild.compiler=extJavac)&lt;/li&gt;
	&lt;li&gt;simplified MockTokenizer.SIMPLE, most tests use whitespace anyway and the humongous regexp was really unnecessary.&lt;/li&gt;
	&lt;li&gt;fixed the IOOBE thing in CharacterUtils.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;there are more things that should be fixed, but i&apos;d like to commit this so that its at least possible to compile and run test.&lt;/p&gt;</comment>
                    <comment id="12904943" author="simonw" created="Wed, 1 Sep 2010 07:14:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;fixed the IOOBE thing in CharacterUtils.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Robert, I wonder if we really still need CharacterUtils in 4.0 - we don&apos;t have to guarantee any bwcompat on the TokenFilter / Tokenizer level and we should not have any problems with different lowercase methodes etc. Maybe we should move the codepoint aware reader code out to another class or clean that one up?&lt;/p&gt;</comment>
                    <comment id="12905064" author="rcmuir" created="Wed, 1 Sep 2010 16:47:13 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Robert, I wonder if we really still need CharacterUtils in 4.0 - we don&apos;t have to guarantee any bwcompat on the TokenFilter / Tokenizer level and we should not have any problems with different lowercase methodes etc. Maybe we should move the codepoint aware reader code out to another class or clean that one up?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d rather discuss this (dropping 2.x analyzer backwards compatibility/Version) on another jira issue to keep this one simple &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12909279" author="rcmuir" created="Tue, 14 Sep 2010 16:07:51 +0100"  >&lt;p&gt;The harmony developers applied the UTF-8 fix (&lt;a href=&quot;https://issues.apache.org/jira/browse/HARMONY-6640&quot; title=&quot;UTF8 decoder doesn&amp;#39;t properly decode supplementary characters&quot;&gt;&lt;del&gt;HARMONY-6640&lt;/del&gt;&lt;/a&gt;), so&lt;br/&gt;
we don&apos;t need to hack MockTokenizer anymore.&lt;/p&gt;

&lt;p&gt;i&apos;ve updated patch, &apos;ant test-core -Dbuild.compiler=extJavac&apos; almost passes.&lt;/p&gt;

&lt;p&gt;i&apos;ll iterate with some more test improvements now that we are going somewhere.&lt;/p&gt;</comment>
                    <comment id="12909311" author="rcmuir" created="Tue, 14 Sep 2010 17:30:46 +0100"  >&lt;p&gt;Here&apos;s the patch for TestCharacterUtils.&lt;br/&gt;
it should expect generic IIOBE according to the javadocs contract.&lt;/p&gt;

&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HARMONY-6648&quot; title=&quot;Character.codePointAt exception differences&quot;&gt;&lt;del&gt;HARMONY-6648&lt;/del&gt;&lt;/a&gt; for the non-bug difference.&lt;/p&gt;</comment>
                    <comment id="12909347" author="simonw" created="Tue, 14 Sep 2010 18:24:54 +0100"  >&lt;blockquote&gt;&lt;p&gt;Here&apos;s the patch for TestCharacterUtils.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;looks good to me! go commit!&lt;/p&gt;</comment>
                    <comment id="12909390" author="rcmuir" created="Tue, 14 Sep 2010 20:08:37 +0100"  >&lt;p&gt;here&apos;s a patch for the internationalization differences, since harmony uses ICU.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the collator gives different order for Locale.US, though&lt;br/&gt;
its wierd we test the order of non-US characters under US Locale (its not defined and inherited from root locale)&lt;br/&gt;
I conditionalized this test as such:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// the sort order of &#216; versus U depends on the version of the rules being used
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the inherited root locale: &#216;&apos;s order isnt specified in Locale.US since 
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// its not used in english.
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; oStrokeFirst = Collator.getInstance(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Locale(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;)).compare(&quot;&lt;/span&gt;&#216;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;U&quot;) &amp;lt; 0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;the thai dictionary-based break iterator gives different results: I used text that both impls segment the same way.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12913409" author="rcmuir" created="Wed, 22 Sep 2010 06:52:35 +0100"  >&lt;p&gt;happy to mark this one resolved: harmony devs have quickly fixed issues we found.&lt;/p&gt;

&lt;p&gt;with r999725 of harmony, all core, contrib, modules tests pass for both trunk and 3x on harmony (with the exception of contrib/remote due to rmic problems)&lt;/p&gt;</comment>
                    <comment id="13013351" author="gsingers" created="Wed, 30 Mar 2011 16:50:03 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12454549" name="LUCENE-2630_charutils.patch" size="1371" author="rcmuir" created="Tue, 14 Sep 2010 17:31:05 +0100" />
                    <attachment id="12454570" name="LUCENE-2630_intl.patch" size="9779" author="rcmuir" created="Tue, 14 Sep 2010 20:08:37 +0100" />
                    <attachment id="12454548" name="LUCENE-2630.patch" size="619" author="rcmuir" created="Tue, 14 Sep 2010 17:30:46 +0100" />
                    <attachment id="12454543" name="LUCENE-2630.patch" size="619" author="rcmuir" created="Tue, 14 Sep 2010 16:07:51 +0100" />
                    <attachment id="12453565" name="LUCENE-2630.patch" size="8875" author="rcmuir" created="Wed, 1 Sep 2010 02:22:03 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 1 Sep 2010 06:14:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11207</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25062</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>