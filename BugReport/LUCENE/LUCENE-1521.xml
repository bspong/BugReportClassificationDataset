<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:29 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1521/LUCENE-1521.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1521] &quot;fdx size mismatch&quot; exception in StoredFieldsWriter.closeDocStore() when closing index with 500M documents</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1521</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;When closing index that contains 500,000,000 randomly generated documents, an exception is thrown:&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: after flush: fdx size mismatch: 500000000 docs vs 4000000004 length in bytes of _0.fdx&lt;br/&gt;
	at org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWriter.java:94)&lt;br/&gt;
	at org.apache.lucene.index.DocFieldConsumers.closeDocStore(DocFieldConsumers.java:83)&lt;br/&gt;
	at org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcessor.java:47)&lt;br/&gt;
	at org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.java:367)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.flushDocStores(IndexWriter.java:1688)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3518)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3442)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:1623)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1588)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1562)&lt;br/&gt;
        ...&lt;/p&gt;

&lt;p&gt;This appears to be a bug at StoredFieldsWriter.java:93:&lt;/p&gt;

&lt;p&gt;      if (4+state.numDocsInStore*8 != state.directory.fileLength(state.docStoreSegmentName + &quot;.&quot; + IndexFileNames.FIELDS_INDEX_EXTENSION))&lt;/p&gt;

&lt;p&gt;where the multiplication by 8 is causing integer overflow. The fix would be to cast state.numDocsInStore to long before multiplying.&lt;/p&gt;

&lt;p&gt;It appears that this is another instance of the mistake that caused bug &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1519&quot; title=&quot;Change Primitive Data Types from int to long in class SegmentMerger.java&quot;&gt;&lt;del&gt;LUCENE-1519&lt;/del&gt;&lt;/a&gt;. I did a cursory seach for &amp;#42;8 against the code to see if there might be yet more instances of the same mistake, but found none. &lt;/p&gt;
</description>
                <environment></environment>
            <key id="12412605">LUCENE-1521</key>
            <summary>&quot;fdx size mismatch&quot; exception in StoredFieldsWriter.closeDocStore() when closing index with 500M documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="svella">Shon Vella</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jan 2009 15:28:37 +0000</created>
                <updated>Fri, 25 Sep 2009 17:23:17 +0100</updated>
                    <resolved>Thu, 19 Feb 2009 10:10:25 +0000</resolved>
                            <version>2.4</version>
                                <fixVersion>2.4.1</fixVersion>
                <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12664544" author="mikemccand" created="Fri, 16 Jan 2009 15:59:49 +0000"  >&lt;p&gt;Ugh, right.  Plus another one (* 16) in TermVectorsTermsWriter.java.  I&apos;ll fix.&lt;/p&gt;</comment>
                    <comment id="12664550" author="mikemccand" created="Fri, 16 Jan 2009 16:19:00 +0000"  >&lt;p&gt;Committed revision 735043.  Thanks Shon!&lt;/p&gt;</comment>
                    <comment id="12674860" author="mikemccand" created="Thu, 19 Feb 2009 01:37:22 +0000"  >&lt;p&gt;Reopening for backport to 2.4.1.&lt;/p&gt;</comment>
                    <comment id="12674951" author="mikemccand" created="Thu, 19 Feb 2009 10:10:25 +0000"  >&lt;p&gt;Committed revision 745803 on 2.4 branch.&lt;/p&gt;</comment>
                    <comment id="12711538" author="mikemccand" created="Thu, 21 May 2009 10:38:22 +0100"  >&lt;p&gt;Note that this issue only hits an index with many (&amp;gt; ~268 million) docs.&lt;/p&gt;</comment>
                    <comment id="12748555" author="emetsger" created="Thu, 27 Aug 2009 21:32:45 +0100"  >&lt;p&gt;I received this on 2.4.1, not sure if it is this bug or not:&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.RuntimeException: after flush: fdx size mismatch: 10 docs vs 0 length in bytes of _sl3.fdx&lt;br/&gt;
        at org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWriter.java:94)&lt;br/&gt;
        at org.apache.lucene.index.DocFieldConsumers.closeDocStore(DocFieldConsumers.java:83)&lt;br/&gt;
        at org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcessor.java:47)&lt;br/&gt;
        at org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.java:367)&lt;br/&gt;
        at org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:567)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3540)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3450)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.prepareCommit(IndexWriter.java:3363)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.commit(IndexWriter.java:3408)&lt;br/&gt;
        at edu.jhu.library.ivoa.VOImageAccessUrlDownload.go(VOImageAccessUrlDownload.java:357)&lt;br/&gt;
        at edu.jhu.library.ivoa.VOImageAccessUrlDownload.main(VOImageAccessUrlDownload.java:103)&lt;/p&gt;

&lt;p&gt;I&apos;m working with over 500,000 docs in this particular index.&lt;/p&gt;</comment>
                    <comment id="12748558" author="emetsger" created="Thu, 27 Aug 2009 21:44:00 +0100"  >&lt;p&gt;Nevermind, it doesn&apos;t look like this is an occurrence of this bug.  Not sure what happened... underlying storage is a ZFS file system.  Anyway, this thread &lt;a href=&quot;http://www.mail-archive.com/solr-user@lucene.apache.org/msg22264.html&quot; class=&quot;external-link&quot;&gt;http://www.mail-archive.com/solr-user@lucene.apache.org/msg22264.html&lt;/a&gt; was helpful, explaining what may be happening.&lt;/p&gt;</comment>
                    <comment id="12748745" author="mikemccand" created="Fri, 28 Aug 2009 09:52:23 +0100"  >&lt;p&gt;Is there any thing in your env that might be removing index files out from under the IndexWriter?  Are you changing your Directory&apos;s default locking impl, or disabling locking?&lt;/p&gt;

&lt;p&gt;ZFS should be fine &amp;#8211; I use it in my daily development.  What a fabulous file system &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Snapshots &amp;amp; clones are very addictive...&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12412350">LUCENE-1519</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 16 Jan 2009 15:59:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12232</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26207</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>