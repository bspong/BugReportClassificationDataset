<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:35:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2668/LUCENE-2668.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2668] offset gap should be added regardless of existence of tokens in DocInverterPerField</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2668</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Problem: If a multiValued field which contains a stop word (e.g. &quot;will&quot; in the following sample) only value is analyzed by StopAnalyzer when indexing, the offsets of the subsequent tokens are not correct.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;indexing a multiValued field&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
doc.add( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Field( F, &lt;span class=&quot;code-quote&quot;&gt;&quot;Mike&quot;&lt;/span&gt;, Store.YES, Index.ANALYZED, TermVector.WITH_OFFSETS ) );
doc.add( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Field( F, &lt;span class=&quot;code-quote&quot;&gt;&quot;will&quot;&lt;/span&gt;, Store.YES, Index.ANALYZED, TermVector.WITH_OFFSETS ) );
doc.add( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Field( F, &lt;span class=&quot;code-quote&quot;&gt;&quot;use&quot;&lt;/span&gt;, Store.YES, Index.ANALYZED, TermVector.WITH_OFFSETS ) );
doc.add( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Field( F, &lt;span class=&quot;code-quote&quot;&gt;&quot;Lucene&quot;&lt;/span&gt;, Store.YES, Index.ANALYZED, TermVector.WITH_OFFSETS ) );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this program (soon to be attached), if you use WhitespaceAnalyzer, you&apos;ll get the offset(start,end) for &quot;use&quot; and &quot;Lucene&quot; will be use(10,13) and Lucene(14,20). But if you use StopAnalyzer, the offsets will be use(9,12) and lucene(13,19). When searching, since searcher cannot know what analyzer was used at indexing time, this problem causes out of alignment of FVH.&lt;/p&gt;

&lt;p&gt;Cause of the problem: StopAnalyzer filters out &quot;will&quot;, anyToken flag set to false then offset gap is not added in DocInverterPerField:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;DocInverterPerField.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (anyToken)
  fieldState.offset += docState.analyzer.getOffsetGap(field);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t understand why the condition is there... If always the gap is added, I think things are simple.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12475114">LUCENE-2668</key>
            <summary>offset gap should be added regardless of existence of tokens in DocInverterPerField</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="koji">Koji Sekiguchi</assignee>
                                <reporter username="koji">Koji Sekiguchi</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Sep 2010 19:02:52 +0100</created>
                <updated>Wed, 30 Mar 2011 16:49:56 +0100</updated>
                    <resolved>Tue, 28 Sep 2010 03:20:21 +0100</resolved>
                            <version>2.9.3</version>
                <version>3.0.2</version>
                <version>3.1</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12914850" author="koji" created="Sat, 25 Sep 2010 19:05:07 +0100"  >&lt;p&gt;The test program which can be used to see the problem.&lt;/p&gt;</comment>
                    <comment id="12914899" author="koji" created="Sun, 26 Sep 2010 02:22:47 +0100"  >&lt;p&gt;Here is my idea. It is very simple - always adds offset gap. This causes test failure in offset test of TestIndexWriter.&lt;br/&gt;
Can anyone explain why the condition (if(anyToken)) is there?&lt;/p&gt;</comment>
                    <comment id="12914901" author="yseeley@gmail.com" created="Sun, 26 Sep 2010 02:44:50 +0100"  >&lt;blockquote&gt;&lt;p&gt;always adds offset gap&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 &lt;br/&gt;
I don&apos;t know the background on this, but this seems more consistent, intuitive, and potentially useful (i.e. being able to depend that different field values are anways &amp;gt;n*gap positions apart)&lt;/p&gt;</comment>
                    <comment id="12914915" author="koji" created="Sun, 26 Sep 2010 05:21:03 +0100"  >&lt;p&gt;Thanks Yonik for the comment.&lt;/p&gt;

&lt;p&gt;Here is the final patch. I&apos;d like to commit in a few days if no one objects.&lt;/p&gt;</comment>
                    <comment id="12914969" author="mikemccand" created="Sun, 26 Sep 2010 14:05:52 +0100"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;But, what about index back compat?  Should we switch this under Version?  Or do we think apps are not relying on this quirky behavior?&lt;/p&gt;

&lt;p&gt;In the future, eg w/ write-once attr bindings in the analysis chain (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2450&quot; title=&quot;Explore write-once attr bindings in the analysis chain&quot;&gt;LUCENE-2450&lt;/a&gt;), which lets us fully decouple analysis and indexing, how pos/offset gaps are added for multi-valued fields will be fully under the analyzer&apos;s control...&lt;/p&gt;</comment>
                    <comment id="12914972" author="yseeley@gmail.com" created="Sun, 26 Sep 2010 14:19:53 +0100"  >&lt;blockquote&gt;&lt;p&gt;Or do we think apps are not relying on this quirky behavior?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d doubt there&apos;s a single one relying on the current behavior - in fact I think it&apos;s more likely that there&apos;s an app out there relying on the proposed behavior and they just haven&apos;t hit the case when no tokens were indexed for a field value.&lt;/p&gt;</comment>
                    <comment id="12914985" author="mikemccand" created="Sun, 26 Sep 2010 16:41:01 +0100"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d doubt there&apos;s a single one relying on the current behavior - in fact I think it&apos;s more likely that there&apos;s an app out there relying on the proposed behavior and they just haven&apos;t hit the case when no tokens were indexed for a field value.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK so let&apos;s just break it and advertise this in the back compat breaks...&lt;/p&gt;</comment>
                    <comment id="12914992" author="rcmuir" created="Sun, 26 Sep 2010 17:23:39 +0100"  >&lt;p&gt;Seems like we should fix &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2529&quot; title=&quot;always apply position increment gap between values&quot;&gt;&lt;del&gt;LUCENE-2529&lt;/del&gt;&lt;/a&gt; for the positions too?&lt;/p&gt;</comment>
                    <comment id="12914996" author="yseeley@gmail.com" created="Sun, 26 Sep 2010 17:34:45 +0100"  >&lt;blockquote&gt;&lt;p&gt;Seems like we should fix &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2529&quot; title=&quot;always apply position increment gap between values&quot;&gt;&lt;del&gt;LUCENE-2529&lt;/del&gt;&lt;/a&gt; for the positions too? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, really seems like almost the same issue.&lt;/p&gt;</comment>
                    <comment id="12915060" author="koji" created="Sun, 26 Sep 2010 23:33:02 +0100"  >&lt;p&gt;Ok, I&apos;ll see this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2529&quot; title=&quot;always apply position increment gap between values&quot;&gt;&lt;del&gt;LUCENE-2529&lt;/del&gt;&lt;/a&gt; all together.&lt;/p&gt;</comment>
                    <comment id="12915101" author="koji" created="Mon, 27 Sep 2010 04:04:48 +0100"  >&lt;p&gt;New patch attached. It includes &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2529&quot; title=&quot;always apply position increment gap between values&quot;&gt;&lt;del&gt;LUCENE-2529&lt;/del&gt;&lt;/a&gt; and its test case. I added setter/getter for positionIncrementGap to MockAnalyzer.&lt;/p&gt;</comment>
                    <comment id="12915592" author="koji" created="Tue, 28 Sep 2010 03:20:21 +0100"  >&lt;p&gt;trunk: Committed revision 1001796 and 1001957.&lt;br/&gt;
branch_3x: Committed revision 1001991.&lt;/p&gt;</comment>
                    <comment id="12916472" author="dsmiley" created="Thu, 30 Sep 2010 14:31:21 +0100"  >&lt;p&gt;So to anyone who&apos;s commented on this issue that has done work on this class... do you know why it &lt;em&gt;conditionally&lt;/em&gt; decrements the position and then increments it later unconditionally?  Reference lines 156 &amp;amp; 188.  The very fact that it happens sometimes but not others is thwarting my efforts to have the term positions between multiple fields coincide (special purpose use case I have).  I&apos;m using a position filter that ensures that all terms for a value have 0 position increment gap, even the first one.  But sometimes I have no value or I have a value that is a stop word.  My hacky work-around is to set the first value to each of these multi-valued fields be some dummy value that gets indexed.  This is ugly and wasteful on disk.&lt;/p&gt;</comment>
                    <comment id="12916696" author="mikemccand" created="Thu, 30 Sep 2010 22:51:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;do you know why it conditionally decrements the position and then increments it later unconditionally? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This was done in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1542&quot; title=&quot;Lucene can incorrectly set the position of tokens that start a field with positonInc 0.&quot;&gt;&lt;del&gt;LUCENE-1542&lt;/del&gt;&lt;/a&gt;, to prevent position increment from becoming negative, which messes up positions if the field has a payload.  Basically we cannot store a -1 position if the field has a payload.&lt;/p&gt;

&lt;p&gt;But I agree it&apos;s awful that we are inconsistent and it requires hacks for apps that have 0 posIncr on the first token.  Not sure how to best fix this though...&lt;/p&gt;</comment>
                    <comment id="12916997" author="dsmiley" created="Fri, 1 Oct 2010 19:44:04 +0100"  >&lt;p&gt;Apologies; I meant to post to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2529&quot; title=&quot;always apply position increment gap between values&quot;&gt;&lt;del&gt;LUCENE-2529&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="13013309" author="gsingers" created="Wed, 30 Mar 2011 16:49:56 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12468646">LUCENE-2529</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12455632" name="LUCENE-2668.patch" size="13617" author="koji" created="Mon, 27 Sep 2010 04:04:48 +0100" />
                    <attachment id="12455586" name="LUCENE-2668.patch" size="11470" author="koji" created="Sun, 26 Sep 2010 05:21:03 +0100" />
                    <attachment id="12455584" name="LUCENE-2668.patch" size="1534" author="koji" created="Sun, 26 Sep 2010 02:22:47 +0100" />
                    <attachment id="12455571" name="Test.java" size="2676" author="koji" created="Sat, 25 Sep 2010 19:05:07 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 26 Sep 2010 01:44:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11173</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25024</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>