<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:03:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-249/LUCENE-249.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-249] Demo: DeleteFiles doesn&apos;t delete files by their path names</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-249</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;It appears that delete(term) fails to delete the last document containing term, which&lt;br/&gt;
for a unique match means that you can&apos;t remove an individual document.&lt;/p&gt;

&lt;p&gt;Code attempting to remove document with specific &apos;path&apos; (slightly modified version of demo code):&lt;/p&gt;

&lt;p&gt;Directory directory = FSDirectory.getDirectory(&quot;index&quot;, false);&lt;br/&gt;
IndexReader reader = IndexReader.open(directory);&lt;br/&gt;
Term term = new Term(&quot;path&quot;, args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;);  // path passed via command line arg&lt;br/&gt;
int deleted = reader.delete(term);&lt;br/&gt;
reader.close();&lt;br/&gt;
directory.close();&lt;/p&gt;

&lt;p&gt;System.out.println(&quot;deleted &quot; + deleted + &quot; documents containing &quot; + term);&lt;/p&gt;

&lt;p&gt;Executing this always returns &quot;deleted 0 documents containing &amp;lt;path entered&amp;gt;&quot;&lt;/p&gt;

&lt;p&gt;In IndexReader.java, delete() has:&lt;/p&gt;

&lt;p&gt;public final int delete(Term term) throws IOException {&lt;br/&gt;
  TermDocs docs = termDocs(term);&lt;br/&gt;
  if (docs == null) return 0;&lt;br/&gt;
  int n = 0;&lt;br/&gt;
  try {&lt;br/&gt;
    while (docs.next()) &lt;/p&gt;
{
      delete(docs.doc());
      n++;
    }
&lt;p&gt;  } finally &lt;/p&gt;
{
    docs.close();
  }
&lt;p&gt;  return n;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It appears that docs.next() always returns false when there is only one doc, hence&lt;br/&gt;
delete() is never called and 0 is always returned.  I assume that this also means that&lt;br/&gt;
if there are multiple matches, the last doc will not be deleted either, but I have not tested&lt;br/&gt;
that.&lt;/p&gt;

&lt;p&gt;I modified the code as follows:&lt;/p&gt;

&lt;p&gt;    boolean more = true;&lt;br/&gt;
    try {&lt;br/&gt;
      docs.next();&lt;br/&gt;
      while (more) &lt;/p&gt;
{
        delete(docs.doc());
        n++;
        more = docs.next();
      }
&lt;p&gt;    } finally &lt;/p&gt;
{
      docs.close();
    }

&lt;p&gt;and then it worked as expected (at least attempts to delete a single document from the&lt;br/&gt;
index succeeded whereas previously they did not).&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
            <key id="12314399">LUCENE-249</key>
            <summary>Demo: DeleteFiles doesn&apos;t delete files by their path names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="java-dev@lucene.apache.org">Lucene Developers</assignee>
                                <reporter username="alan@collison.net">alan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Jul 2004 04:36:42 +0100</created>
                <updated>Sat, 27 May 2006 02:38:00 +0100</updated>
                    <resolved>Sat, 27 May 2006 02:38:00 +0100</resolved>
                            <version>1.4</version>
                                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12321766" author="goller@detego-software.de" created="Sat, 31 Jul 2004 00:05:04 +0100"  >&lt;p&gt;I think that you somehow break/corrupt the content of the path field either &lt;br/&gt;
while adding it into your document or while providing it for delete, so that the&lt;br/&gt;
two terms are not equal. I am quite sure that Termdocs.next() works as it should.&lt;br/&gt;
This means that the doc numbers provided by a TermDocs is only valid if next()&lt;br/&gt;
returned true. &lt;/p&gt;

&lt;p&gt;However, if you are convinced, that there is a bug in TermDocs/delete(term),&lt;br/&gt;
please provide a self-contained test case.&lt;/p&gt;</comment>
                    <comment id="12321767" author="alan@collison.net" created="Sat, 31 Jul 2004 04:39:08 +0100"  >&lt;p&gt;Created an attachment (id=12282)&lt;br/&gt;
Modification of IndexFiles.java to add single doc to index&lt;/p&gt;</comment>
                    <comment id="12321768" author="alan@collison.net" created="Sat, 31 Jul 2004 04:39:54 +0100"  >&lt;p&gt;Created an attachment (id=12283)&lt;br/&gt;
Modification of DeleteFiles.java to delete a single doc from the index&lt;/p&gt;</comment>
                    <comment id="12321769" author="alan@collison.net" created="Sat, 31 Jul 2004 04:42:59 +0100"  >&lt;p&gt;Created an attachment (id=12284)&lt;br/&gt;
Demos jar file which includes IndexFile and DeleteFile&lt;/p&gt;</comment>
                    <comment id="12321770" author="alan@collison.net" created="Sat, 31 Jul 2004 04:59:29 +0100"  >&lt;p&gt;It is quite possible that there is a problem with how I am adding and then deleting a document from the&lt;br/&gt;
index which is the source of the problem, although what I am doing is only a small variation on the &lt;br/&gt;
Demo code.  I&apos;m not a Java programmer and have only just recently started playing with Lucene.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached two class files which are small modifications to the IndexFiles.java and DeleteFiles.java &lt;br/&gt;
files included in the lucene distro.   I&apos;ve also included the jar file that includes them (although I received&lt;br/&gt;
an error when uploading and am not positive it got uploaded safely).  I&apos;m afraid&lt;br/&gt;
I don&apos;t have a publicly accessible server where you can see directly what I have, but here&apos;s a complete&lt;br/&gt;
rundown of what I did:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;created and archive of plain text/html documents (in this case in the directory /home/acolliso/&lt;br/&gt;
archive)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ran java org.apache.lucene.demo.IndexFiles /home/acolliso/archive&lt;br/&gt;
   This created an index of about 190 MB and searching on the index appears to work fine.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;then I ran the following:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt; java org.apache.lucene.demo.IndexFile /home/acolliso/archive/newdoc1.html&lt;br/&gt;
adding /home/acolliso/archive/newdoc1.html&lt;br/&gt;
244 total milliseconds&lt;/p&gt;

&lt;p&gt;  newdoc1.html is a small file with a few unique words in it so I know it will show up at the top&lt;br/&gt;
  of my search later on.  Note that IndexFile does &lt;b&gt;not&lt;/b&gt; run optimize.  don&apos;t know if that has any&lt;br/&gt;
  consequences.&lt;/p&gt;

&lt;p&gt;&amp;gt; java org.apache.lucene.demo.SearchFiles&lt;br/&gt;
Query:  +white +dwarfs +black +holes&lt;br/&gt;
Searching for: +white +dwarfs +black +holes&lt;br/&gt;
2 total matching documents&lt;br/&gt;
0. /home/acolliso/archive/newdoc.html&lt;br/&gt;
1. /home/acolliso/archive/newdoc1.html&lt;/p&gt;

&lt;p&gt;&amp;gt; java org.apache.lucene.demo.DeleteFile /home/acolliso/archive/newdoc1.html&lt;br/&gt;
Path to delete: /home/acolliso/archive/newdoc1.html&lt;br/&gt;
Term: path:/home/acolliso/archive/newdoc1.html&lt;br/&gt;
Got next doc ...false&lt;br/&gt;
Term docs: 164437&lt;br/&gt;
deleted 0 documents containing path:/home/acolliso/archive/newdoc1.html&lt;/p&gt;

&lt;p&gt;The &apos;path&apos; &lt;b&gt;seems&lt;/b&gt; to be o.k., but next() returns false and the doc is not deleted,&lt;br/&gt;
as the following search confirms:&lt;/p&gt;

&lt;p&gt;&amp;gt; java org.apache.lucene.demo.SearchFiles&lt;br/&gt;
Query: +white +dwarfs +black +holes&lt;br/&gt;
Searching for: +white +dwarfs +black +holes&lt;br/&gt;
2 total matching documents&lt;br/&gt;
0. /home/acolliso/archive/newdoc.html&lt;br/&gt;
1. /home/acolliso/archive/newdoc1.html&lt;/p&gt;

&lt;p&gt;The I modified the delete() code as noted in the original report&lt;br/&gt;
and tried delete() again:&lt;/p&gt;

&lt;p&gt;&amp;gt; java org.apache.lucene.demo.DeleteFile /home/acolliso/archive/newdoc1.html&lt;br/&gt;
Path to delete: /home/acolliso/archive/newdoc1.html&lt;br/&gt;
Term: path:/home/acolliso/archive/newdoc1.html&lt;br/&gt;
Got next doc ...false&lt;br/&gt;
Term docs: 164437&lt;br/&gt;
deleted 1 documents containing path:/home/acolliso/archive/newdoc1.html&lt;/p&gt;

&lt;p&gt;And to see if the document really was deleted, I did the search again:&lt;/p&gt;

&lt;p&gt;&amp;gt; java org.apache.lucene.demo.SearchFiles&lt;br/&gt;
Query: +white +dwarfs +black +holes&lt;br/&gt;
Searching for: +white +dwarfs +black +holes&lt;br/&gt;
1 total matching documents&lt;br/&gt;
0. /home/acolliso/archive/newdoc.html&lt;/p&gt;

&lt;p&gt;Which makes it seem that the doc was successfully deleted.&lt;/p&gt;

&lt;p&gt;If there is any other info I can provide that would help, or could provide&lt;br/&gt;
in a different format, I&apos;m happy to provide it.  Or, if this really ought to&lt;br/&gt;
go to the distro list instead, I&apos;m happy to do that as well.  Thanks!&lt;/p&gt;


</comment>
                    <comment id="12321771" author="daniel.naber@t-online.de" created="Sat, 31 Jul 2004 05:41:07 +0100"  >&lt;p&gt;The path field is tokenized, so you cannot use a TermQuery with the path name &lt;br/&gt;
to identify the document. I keep this bug open, as the demo is misleading in &lt;br/&gt;
this regard. &lt;/p&gt;</comment>
                    <comment id="12321772" author="goller@detego-software.de" created="Mon, 2 Aug 2004 00:37:04 +0100"  >&lt;p&gt;That&#194;&#180;s it. Daniel is right. Maybe the Demo code should be changed and&lt;br/&gt;
the path field should not be tokenized.&lt;/p&gt;</comment>
                    <comment id="12321773" author="otis@apache.org" created="Mon, 2 Aug 2004 21:39:31 +0100"  >&lt;p&gt;+1.  It doesn&apos;t make sense to have a tokenied path.  It just confuses people. &lt;br/&gt;
Want to change that, Daniel?&lt;/p&gt;</comment>
                    <comment id="12321774" author="daniel.naber@t-online.de" created="Wed, 4 Aug 2004 05:56:03 +0100"  >&lt;p&gt;The demo has been modified so that using it should be easier. &lt;/p&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12312365" name="ASF.LICENSE.NOT.GRANTED--DeleteFile.java" size="1869" author="alan@collison.net" created="Sat, 31 Jul 2004 04:39:54 +0100" />
                    <attachment id="12312364" name="ASF.LICENSE.NOT.GRANTED--IndexFile.java" size="2439" author="alan@collison.net" created="Sat, 31 Jul 2004 04:39:08 +0100" />
                    <attachment id="12312366" name="ASF.LICENSE.NOT.GRANTED--lucene-demos.jar" size="49235" author="alan@collison.net" created="Sat, 31 Jul 2004 04:42:59 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>30330</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 30 Jul 2004 23:05:04 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13500</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27482</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>