<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:20:30 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2481/LUCENE-2481.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2481] Enhance SnapshotDeletionPolicy to allow taking multiple snapshots</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2481</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;A spin off from here: &lt;a href=&quot;http://www.gossamer-threads.com/lists/lucene/java-dev/99161?do=post_view_threaded#99161&quot; class=&quot;external-link&quot;&gt;http://www.gossamer-threads.com/lists/lucene/java-dev/99161?do=post_view_threaded#99161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Replace snapshot() with snapshot(String), so that one can name/identify the snapshot&lt;/li&gt;
	&lt;li&gt;Add some supporting methods, like release(String), getSnapshots() etc.&lt;/li&gt;
	&lt;li&gt;Some unit tests of course.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This is mostly written already - I want to contribute it. I&apos;ve also written a PersistentSDP, which persists the snapshots on stable storage (a Lucene index in this case) to support opening an IW with existing snapshots already, so they don&apos;t get deleted. If it&apos;s interesting, I can contribute it as well.&lt;/p&gt;

&lt;p&gt;Porting my patch to the new API. Should post it soon.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12465577">LUCENE-2481</key>
            <summary>Enhance SnapshotDeletionPolicy to allow taking multiple snapshots</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="shaie">Shai Erera</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 May 2010 17:00:03 +0100</created>
                <updated>Wed, 30 Mar 2011 16:50:18 +0100</updated>
                    <resolved>Mon, 31 May 2010 15:38:03 +0100</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12872319" author="shaie" created="Thu, 27 May 2010 19:31:43 +0100"  >&lt;p&gt;Enhancements to SnapshotDeletionPolicy + tests.&lt;/p&gt;

&lt;p&gt;Also, I&apos;ve added a PersistentSDP, which persists the snapshots information in a Lucene Directory. In case the JVM crashes, the info from the Directory can be used to open an IndexWriter on the other Directory w/ already snapshotted commits (prevents their deletion).&lt;/p&gt;</comment>
                    <comment id="12872945" author="shaie" created="Fri, 28 May 2010 13:17:51 +0100"  >&lt;p&gt;If there are no comments/objections, I&apos;d like to commit this in 2-3 days.&lt;/p&gt;</comment>
                    <comment id="12873004" author="mikemccand" created="Fri, 28 May 2010 16:05:55 +0100"  >&lt;p&gt;This looks nice Shai!&lt;/p&gt;

&lt;p&gt;So now you can keep any number of outstanding snapshots, and, if you&lt;br/&gt;
use PersistentSnapshotDeletionPolicy, you can keep these snapshots&lt;br/&gt;
alive across close/open of IndexWriter, right?&lt;/p&gt;

&lt;p&gt;And, if one has some other way to persist snapshots (instead of using&lt;br/&gt;
a Lucene index as PersistentSnapshotDeletionPolicy does), one can&lt;br/&gt;
simply subclass SnapshotDeletionPolicy&lt;/p&gt;

&lt;p&gt;Can you rename &quot;String segment&quot; -&amp;gt; &quot;String segmentsFileName&quot; (or&lt;br/&gt;
segmentsFile)?  Ie, this is referring to the collection of segments&lt;br/&gt;
that make up a given commit?  It&apos;s confusing to see &quot;segment&quot; all over&lt;br/&gt;
because it makes me think you&apos;re somehow doing something&lt;br/&gt;
per-segment...&lt;/p&gt;</comment>
                    <comment id="12873271" author="shaie" created="Sat, 29 May 2010 12:12:04 +0100"  >&lt;blockquote&gt;&lt;p&gt;you can keep these snapshots alive across close/open of IndexWriter, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s right ! In fact, PSDP exists for exactly that purpose, and can also serve as an example for whoever would like to persist the snapshots elsewhere.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can you rename &quot;String segment&quot; -&amp;gt; &quot;String segmentsFileName&quot; (or segmentsFile)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve renamed it to segmentsFileName, and also segmentToIDs -&amp;gt; segmentsFileToIDs to make it clearer. Thanks for the feedback !&lt;/p&gt;

&lt;p&gt;I may commit this tomorrow.&lt;/p&gt;</comment>
                    <comment id="12873324" author="earwin" created="Sat, 29 May 2010 20:09:39 +0100"  >&lt;p&gt;Still dislike that string key you have to generate somehow. And if you just want some threads to get and release snapshots independently? You have to devise some random key generation scheme?&lt;/p&gt;</comment>
                    <comment id="12873326" author="shaie" created="Sat, 29 May 2010 20:22:21 +0100"  >&lt;blockquote&gt;&lt;p&gt;And if you just want some threads to get and release snapshots independently? You have to devise some random key generation scheme? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No - you can simply use the thread&apos;s name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;But really, the ID is important for different processes that take a snapshot of the same commit for different purposes. It makes it more clear who holds which snapshot. Also better for debugging later, if say the JVM crashed, and you use the persistency layer, you can tell which of your processes kept a snapshot (and didn&apos;t release yet).&lt;/p&gt;</comment>
                    <comment id="12873418" author="shaie" created="Sun, 30 May 2010 13:33:01 +0100"  >&lt;p&gt;Another thing about IDs - they are more user-level API than IndexCommit.&lt;/p&gt;

&lt;p&gt;So Earwin, I agree that we can have snapshot() and release(IndexCommit) to achieve the same functionality (need to be careful w/ multiple snapshots over the same IC). But for users, passing in an IndexCommit is not too friendly. Also, one customer of the API already uses the ID to encode some information that&apos;s interesting to him (e.g. name of the process + timestamp) which shows why IDs should remain. It&apos;s kind of like the commitUserData given to commits. Another reason is sharing the ID between two different code segments. It&apos;s easier to share a String-ID, than to share an IndexCommit. And what exactly is IndexCommit, and how does it translate to a key? Just the segmentsFileName? See - that&apos;s a too low level implementation detail IMO ...&lt;/p&gt;</comment>
                    <comment id="12873549" author="shaie" created="Mon, 31 May 2010 06:34:10 +0100"  >&lt;p&gt;Some javadoc updates and member renames (as Mike suggested). I plan to commit this shortly.&lt;/p&gt;</comment>
                    <comment id="12873679" author="shaie" created="Mon, 31 May 2010 15:38:03 +0100"  >&lt;p&gt;Committed revision 949730 (3x).&lt;br/&gt;
Committed revision 949756 (trunk).&lt;/p&gt;</comment>
                    <comment id="13013432" author="gsingers" created="Wed, 30 Mar 2011 16:50:18 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12445903" name="LUCENE-2481-3x.patch" size="45560" author="shaie" created="Mon, 31 May 2010 06:34:10 +0100" />
                    <attachment id="12445690" name="LUCENE-2481-3x.patch" size="44944" author="shaie" created="Thu, 27 May 2010 19:31:43 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 28 May 2010 15:05:55 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11339</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25211</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>