<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:24:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1763/LUCENE-1763.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1763] MergePolicy should require an IndexWriter upon construction</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1763</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;MergePolicy does not require an IW upon construction, but requires one to be passed as method arg to various methods. This gives the impression as if a single MP instance can be shared across various IW instances, which is not true for all MPs (if at all). In addition, LogMergePolicy uses the IW instance passed to these methods incosistently, and is currently exposed to potential NPEs.&lt;/p&gt;

&lt;p&gt;This issue will change MP to require an IW instance, however for back-compat reasons the following changes will be made:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;A new MP ctor w/ IW as arg will be introduced. Additionally, for back-compat a default ctor will also be declared which will assign null to the member IW.&lt;/li&gt;
	&lt;li&gt;Methods that require IW will be deprecated, and new ones will be declared.
	&lt;ul&gt;
		&lt;li&gt;For back-compat, the new ones will not be made abstract, but will throw UOE, with a comment that they will become abstract in 3.0.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;All current MP impls will move to use the member instance.&lt;/li&gt;
	&lt;li&gt;The code which calls MP methods will continue to use the deprecated methods, passing an IW even that it won&apos;t be necessary --&amp;gt; this is strictly for back-compat.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In 3.0, we&apos;ll remove the deprecated default ctor and methods, and change the code to not call the IW method variants anymore.&lt;/p&gt;

&lt;p&gt;I hope that I didn&apos;t leave anything out. I&apos;m sure I&apos;ll find out when I work on the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12431486">LUCENE-1763</key>
            <summary>MergePolicy should require an IndexWriter upon construction</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jul 2009 08:58:54 +0100</created>
                <updated>Fri, 25 Sep 2009 17:23:29 +0100</updated>
                    <resolved>Sat, 1 Aug 2009 10:23:08 +0100</resolved>
                                            <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12736248" author="shaie" created="Tue, 28 Jul 2009 20:58:03 +0100"  >&lt;p&gt;Hmm ... I see that MP&apos;s methods are package private, so nobody can really extend MP, but only LMP, right? I wonder why is that? I still need to come up w/ new method names because the code still needs to call the methods w/ the IndexWriter arg (for back-compat), but I wonder if we shouldn&apos;t make the methods public?&lt;/p&gt;</comment>
                    <comment id="12736614" author="mikemccand" created="Wed, 29 Jul 2009 13:40:50 +0100"  >&lt;p&gt;How about we:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Simply change the methods.  Yes it&apos;s technically a break in back-compat, but since they are package private, and so advanced (I think very few people have customized their merge policy/scheduler), a compile time error on upgrade seems fine.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Make the APIs public (perhaps add a unit test, outside of oal.index package, asserting that all that&apos;s required is in fact public)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Mark the APIs as subject to change.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12736617" author="shaie" created="Wed, 29 Jul 2009 13:46:40 +0100"  >&lt;p&gt;I don&apos;t mind doing that ... but note that LMP&apos;s methods are public (it overrides and declare them public) and so I was thinking that someone could potentially have written his own LMP (no one can write their own MP today). But if you&apos;re fine w/ me doing that, it&apos;s fine by me as well.&lt;/p&gt;

&lt;p&gt;BTW - I don&apos;t need to come up w/ new names after all, since by just adding the same method, w/o the IW arg changes its signature. But I agree that having just the right form makes more sense.&lt;/p&gt;</comment>
                    <comment id="12736643" author="mikemccand" created="Wed, 29 Jul 2009 15:24:38 +0100"  >&lt;p&gt;I think subclassing LMP is also extremely advanced, ie, it&apos;s OK to make an exception to our back-compat policy.&lt;/p&gt;</comment>
                    <comment id="12736658" author="shaie" created="Wed, 29 Jul 2009 16:14:56 +0100"  >&lt;p&gt;Adds a ctor w/ IndexWriter to MergePolicy, LogMergePolicy, and its extensions.&lt;br/&gt;
Fixed tests and IndexWriter code&lt;br/&gt;
Fixed tags&lt;/p&gt;

&lt;p&gt;All tests pass&lt;/p&gt;</comment>
                    <comment id="12737054" author="mikemccand" created="Thu, 30 Jul 2009 10:36:19 +0100"  >&lt;p&gt;Patch looks good Shai!  Only change I made was to have IndexWriter writer be final in MergePolicy.  I&apos;ll commit in a day or two...&lt;/p&gt;</comment>
                    <comment id="12737851" author="mikemccand" created="Sat, 1 Aug 2009 10:23:08 +0100"  >&lt;p&gt;Thanks Shai!&lt;/p&gt;</comment>
                    <comment id="12738692" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 01:04:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think subclassing LMP is also extremely advanced, ie, it&apos;s OK to make an exception to our back-compat policy.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t disagree, especially since MergePolicy was already marked as experimental and subject to change - but just as a history note: its not just subclasses it breaks - I&apos;m sure its rare, but Solr instantiates a MergePolicy with newInstance, which now fails because you have to pass an IndexWriter.&lt;/p&gt;</comment>
                    <comment id="12738922" author="mikemccand" created="Tue, 4 Aug 2009 11:09:22 +0100"  >&lt;blockquote&gt;&lt;p&gt;Solr instantiates a MergePolicy with newInstance, which now fails because you have to pass an IndexWriter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sigh.  Sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  How to fix?  Can Solr seek a Constructor that takes an IndexWriter instance as its single arg, instead?&lt;/p&gt;</comment>
                    <comment id="12738926" author="shaie" created="Tue, 4 Aug 2009 11:50:34 +0100"  >&lt;p&gt;Yes I had to fix CreateIndexTask for that. We can add an empty ctor, but that would be a problem, as it will set the writer member to null. That&apos;s what I originally meant when I suggested to add the new behavior but not use it yet and deprecate the other methods and ctors.&lt;/p&gt;

&lt;p&gt;Is it a problem for Solr to follow the logic as in CreateIndexTask? I&apos;m not asking from the technical perspective - that&apos;s obviously not a problem, but release-schedule wise? Maybe you can have a &quot;fixpack release&quot; which will be compliant w/ the 2.9 back-compat breaks?&lt;/p&gt;</comment>
                    <comment id="12739021" author="markrmiller@gmail.com" created="Tue, 4 Aug 2009 17:18:29 +0100"  >&lt;p&gt;Thanks guys - we can fix this in Solr no problem - the SolrIndexWriter is creating the policy, so its easy enough to pass it to the constructor. I hadn&apos;t evaluated a fix yet, was just pointing out the back compat break beyond package private stuff.&lt;/p&gt;

&lt;p&gt;Certainly an easy adjustment on Solr&apos;s end though, and it seems to me that back compat break was a fair one.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12414913" name="LUCENE-1763.patch" size="46766" author="shaie" created="Wed, 29 Jul 2009 16:14:56 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 29 Jul 2009 12:40:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11998</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25963</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>