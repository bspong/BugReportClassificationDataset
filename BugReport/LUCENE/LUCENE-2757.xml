<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:21:05 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2757/LUCENE-2757.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2757] Refactor RewriteMethods out of MultiTermQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2757</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Policeman work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - as usual&lt;/p&gt;</description>
                <environment></environment>
            <key id="12479833">LUCENE-2757</key>
            <summary>Refactor RewriteMethods out of MultiTermQuery</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Nov 2010 21:47:14 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:16 +0100</updated>
                    <resolved>Mon, 15 Nov 2010 01:39:24 +0000</resolved>
                            <version>3.1</version>
                <version>4.0-ALPHA</version>
                                <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12931540" author="thetaphi" created="Fri, 12 Nov 2010 22:01:03 +0000"  >&lt;p&gt;Here is the current state of my work. It contains the spans patch in modified form. This first step changes the class structure to have more abstract classes and generics. At the end I will move the abstract classes and their implementations to @lucene.internal classes.&lt;/p&gt;

&lt;p&gt;MTQ will still have all rewrite modes as final constants (except span), but implementations will go away.&lt;/p&gt;

&lt;p&gt;For backwards compatibility i would keep empty subclasses of the 3.0 classes that were public (like the autorewrite) like the empty TermAttributeImpl skeleton.&lt;/p&gt;</comment>
                    <comment id="12931551" author="thetaphi" created="Fri, 12 Nov 2010 22:34:23 +0000"  >&lt;p&gt;I will go to bed now, here more fixes (BQ max clause count in ParallelArraysCollector, wrong superclass for TopTermsRewrite).&lt;/p&gt;

&lt;p&gt;Will work on factoring out rewrite modes tomorrow!&lt;/p&gt;</comment>
                    <comment id="12931698" author="thetaphi" created="Sat, 13 Nov 2010 16:54:26 +0000"  >&lt;p&gt;Here the complete heavy refactoring. All tests in core and contrib pass, javadocs build fine:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Some trivial implementations of rewrite methods stay in MTQ itsself&lt;/li&gt;
	&lt;li&gt;All rewrite constants stay in MTQ&lt;/li&gt;
	&lt;li&gt;Span Rewrites are in the span wrapper class only. To be type safe, the span rewrites have a super class and the wrapper class only accepts this superclass as rewrite method. The SpanRewriteMethod also uses covariant return types to be type-safe.&lt;/li&gt;
	&lt;li&gt;SpanRewrites and wrapper class got missing equals/hashCode&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12931704" author="thetaphi" created="Sat, 13 Nov 2010 17:45:01 +0000"  >&lt;p&gt;Backporting will be funny, but doable. Because lots of code is now separated from the enum handling, we only have to really backport the two methods TopTermsRewrite and ScoringRewrite and their superclass. Spans and contrib stays unchanged and can be simply merged.&lt;/p&gt;</comment>
                    <comment id="12931903" author="rcmuir" created="Sun, 14 Nov 2010 22:04:55 +0000"  >&lt;p&gt;+1, this is really needed... its difficult to navigate MultiTermQuery and this will make a huge difference.&lt;/p&gt;</comment>
                    <comment id="12931911" author="thetaphi" created="Sun, 14 Nov 2010 22:36:07 +0000"  >&lt;p&gt;I will commit this soon and then do backporting!&lt;/p&gt;</comment>
                    <comment id="12931918" author="thetaphi" created="Sun, 14 Nov 2010 23:15:17 +0000"  >&lt;p&gt;Committed trunk revision: 1035096&lt;/p&gt;

&lt;p&gt;Now backporting...&lt;/p&gt;</comment>
                    <comment id="12931950" author="thetaphi" created="Mon, 15 Nov 2010 01:13:52 +0000"  >&lt;p&gt;Here the merge patch for 3.x&lt;/p&gt;

&lt;p&gt;The merge had a difficulty:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MTQ has no fixed field name (as in 3.x MTQ can even rewrite to a query with terms from different fields). So SpanQuery.getField() cannot simply be delegated in the wrapper. A hack was added that uses reflection to find the field name from the wrapped MTQ.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The other parts were straightforward:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;merge patch, for MTQ conflict choose &quot;overwrite with their&apos;s&quot;, keep a backup of old MTQ&lt;/li&gt;
	&lt;li&gt;copypaste all code from old MTQ rewrite modes to the new separate file with rewrite modes.&lt;/li&gt;
	&lt;li&gt;remove docFreq parameter from collect() method.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12931952" author="thetaphi" created="Mon, 15 Nov 2010 01:39:24 +0000"  >&lt;p&gt;Committed 3.x revision: 1035118&lt;/p&gt;</comment>
                    <comment id="12932014" author="thetaphi" created="Mon, 15 Nov 2010 08:21:39 +0000"  >&lt;p&gt;Here is a fix for a &quot;nocommit&quot; in trunk&apos;s code. I did not mark it as nocommit, but it was one. Now the hacky instanceof check if boolean max clauses must be checked was removed and the whole thing done like in the TopTermRewrite.&lt;/p&gt;

&lt;p&gt;There is also an optimization, that the max clause count is only checked, when an entry is really added to the BytesRefHash.&lt;/p&gt;

&lt;p&gt;Will commit now.&lt;/p&gt;</comment>
                    <comment id="12932015" author="thetaphi" created="Mon, 15 Nov 2010 08:23:42 +0000"  >&lt;p&gt;Committed cleanup in trunk revision: 1035173&lt;/p&gt;</comment>
                    <comment id="13013421" author="gsingers" created="Wed, 30 Mar 2011 16:50:16 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                <outwardlinks description="incorporates">
                            <issuelink>
            <issuekey id="12479703">LUCENE-2754</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12459576" name="LUCENE-2757-branch_3x.patch" size="78418" author="thetaphi" created="Mon, 15 Nov 2010 01:13:52 +0000" />
                    <attachment id="12459589" name="LUCENE-2757-cleanup.patch" size="3707" author="thetaphi" created="Mon, 15 Nov 2010 08:21:39 +0000" />
                    <attachment id="12459527" name="LUCENE-2757.patch" size="98682" author="thetaphi" created="Sat, 13 Nov 2010 17:13:36 +0000" />
                    <attachment id="12459490" name="LUCENE-2757-refactor1.patch" size="36260" author="thetaphi" created="Fri, 12 Nov 2010 22:34:23 +0000" />
                    <attachment id="12459486" name="LUCENE-2757-refactor1.patch" size="35200" author="thetaphi" created="Fri, 12 Nov 2010 22:01:03 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 14 Nov 2010 22:04:55 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11094</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24935</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>