<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:17:59 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2761/LUCENE-2761.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2761] specialize payload processing from of DocsAndPositionsEnum</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2761</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2760&quot; title=&quot;optimize spanfirstquery, spanpositionrangequery&quot;&gt;&lt;del&gt;LUCENE-2760&lt;/del&gt;&lt;/a&gt; i started working to try to improve the speed of a few spanqueries.&lt;br/&gt;
In general the trick there is to avoid processing positions if you dont have to.&lt;/p&gt;

&lt;p&gt;But, we can improve queries that read lots of positions further by cleaning up SegmentDocsAndPositionsEnum, &lt;br/&gt;
in nextPosition() this has no less than 3 payloads-related checks.&lt;/p&gt;

&lt;p&gt;however, a large majority of users/fields have no payloads at all.&lt;br/&gt;
I think we should specialize this case into a separate implementation and speed up the common case.&lt;/p&gt;

&lt;p&gt;edit: dyslexia with the jira issue number.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12479965">LUCENE-2761</key>
            <summary>specialize payload processing from of DocsAndPositionsEnum</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Nov 2010 15:32:17 +0000</created>
                <updated>Fri, 10 May 2013 11:42:49 +0100</updated>
                    <resolved>Mon, 15 Nov 2010 22:20:17 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12932079" author="rcmuir" created="Mon, 15 Nov 2010 15:37:39 +0000"  >&lt;p&gt;Here&apos;s my result from a crappy benchmark that just does SpanFirst query on a very common term:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    SpanQuery sq = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpanFirstQuery(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpanTermQuery(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term(&lt;span class=&quot;code-quote&quot;&gt;&quot;body&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;the&quot;&lt;/span&gt;)), 1);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(searcher.search(sq, 10).totalHits);
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ms = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 100; i++) {
      searcher.search(sq, 10);
    }
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ms2 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;time = &quot;&lt;/span&gt; + (ms2 - ms));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All times below in milliseconds.&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;setup&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run3&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run4&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run5&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run6&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;TRUNK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13055&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13054&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13061&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13068&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13070&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13058&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2760&quot; title=&quot;optimize spanfirstquery, spanpositionrangequery&quot;&gt;&lt;del&gt;LUCENE-2760&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7987&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7993&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7995&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7987&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8012&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7989&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2760&quot; title=&quot;optimize spanfirstquery, spanpositionrangequery&quot;&gt;&lt;del&gt;LUCENE-2760&lt;/del&gt;&lt;/a&gt;+&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2761&quot; title=&quot;specialize payload processing from of DocsAndPositionsEnum&quot;&gt;&lt;del&gt;LUCENE-2761&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7741&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7723&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7701&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7702&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7693&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7702&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;I think it sucks to introduce duplication, but if we can eek out a few &lt;br/&gt;
% faster phrasequeries/spanqueries for the common case, i think this is worth it for codecs&lt;/p&gt;</comment>
                    <comment id="12932086" author="mikemccand" created="Mon, 15 Nov 2010 15:43:03 +0000"  >&lt;p&gt;This looks great Robert!  I think it makes sense to manually specialize this.&lt;/p&gt;</comment>
                    <comment id="12932164" author="rcmuir" created="Mon, 15 Nov 2010 19:41:15 +0000"  >&lt;p&gt;updated patch: in the non-payloads case, when we are blasting through &quot;useless positions&quot;, we dont care about &lt;br/&gt;
the return value from readVint, just want to skip over them.&lt;/p&gt;

&lt;p&gt;this seems to help a lot, none of the shifting etc.&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;setup&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run3&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run4&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run5&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run6&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2760&quot; title=&quot;optimize spanfirstquery, spanpositionrangequery&quot;&gt;&lt;del&gt;LUCENE-2760&lt;/del&gt;&lt;/a&gt;+&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2761&quot; title=&quot;specialize payload processing from of DocsAndPositionsEnum&quot;&gt;&lt;del&gt;LUCENE-2761&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7175&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7204&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7175&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7169&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7176&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7165&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                    <comment id="12932184" author="rcmuir" created="Mon, 15 Nov 2010 20:34:18 +0000"  >&lt;p&gt;same patch with an additional optimization from Mike.&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;setup&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run3&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run4&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run5&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;run6&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2760&quot; title=&quot;optimize spanfirstquery, spanpositionrangequery&quot;&gt;&lt;del&gt;LUCENE-2760&lt;/del&gt;&lt;/a&gt;+&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2761&quot; title=&quot;specialize payload processing from of DocsAndPositionsEnum&quot;&gt;&lt;del&gt;LUCENE-2761&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6854&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6874&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6850&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6855&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6856&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6846&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;also, because we assume things about read/writeVint, i made these final in DataInput.&lt;/p&gt;

&lt;p&gt;I think we can use this same trick to speed up the terms dictionary, where it scans past lots of useless vints/vlongs&lt;/p&gt;</comment>
                    <comment id="12932226" author="rcmuir" created="Mon, 15 Nov 2010 22:20:17 +0000"  >&lt;p&gt;Committed revision 1035473.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12459632" name="LUCENE-2761.patch" size="13845" author="rcmuir" created="Mon, 15 Nov 2010 20:34:17 +0000" />
                    <attachment id="12459628" name="LUCENE-2761.patch" size="11221" author="rcmuir" created="Mon, 15 Nov 2010 19:41:15 +0000" />
                    <attachment id="12459611" name="LUCENE-2761.patch" size="11173" author="rcmuir" created="Mon, 15 Nov 2010 15:33:55 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 15 Nov 2010 15:43:03 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11090</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24931</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>