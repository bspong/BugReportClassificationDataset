<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 12:58:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-325/LUCENE-325.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-325] [PATCH] new method expungeDeleted() added to IndexWriter</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-325</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We make use the docIDs in lucene. I need a way to compact the docIDs in segments&lt;br/&gt;
to remove the &quot;holes&quot; created from doing deletes. The only way to do this is by&lt;br/&gt;
calling IndexWriter.optimize(). This is a very heavy call, for the cases where&lt;br/&gt;
the index is large but with very small number of deleted docs, calling optimize&lt;br/&gt;
is not practical.&lt;/p&gt;

&lt;p&gt;I need a new method: expungeDeleted(), which finds all the segments that have&lt;br/&gt;
delete documents and merge only those segments.&lt;/p&gt;

&lt;p&gt;I have implemented this method and have discussed with Otis about submitting a&lt;br/&gt;
patch. I don&apos;t see where I can attached the patch. I will do according to the&lt;br/&gt;
patch guidleine and email the lucene mailing list.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;-John&lt;/p&gt;

&lt;p&gt;I don&apos;t see a place where I can&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
            <key id="12314475">LUCENE-325</key>
            <summary>[PATCH] new method expungeDeleted() added to IndexWriter</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="john.wang@gmail.com">John Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Dec 2004 08:55:11 +0000</created>
                <updated>Thu, 2 Jun 2011 23:03:48 +0100</updated>
                    <resolved>Mon, 11 Feb 2008 20:35:21 +0000</resolved>
                                            <fixVersion>2.4</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12322071" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 08:57:09 +0000"  >&lt;p&gt;Created an attachment (id=13757)&lt;br/&gt;
Patched IndexWriter.java, contains a new method: expungeDeleted()&lt;/p&gt;

&lt;p&gt;I see now where to attach the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;See attached patch.&lt;/p&gt;</comment>
                    <comment id="12322072" author="otis@apache.org" created="Wed, 15 Dec 2004 12:13:42 +0000"  >&lt;p&gt;Either this Bugzilla diff is not working properly, or you&apos;ve made a number of&lt;br/&gt;
other more stylistic changes to IndexWriter.java, which make it very hard to see&lt;br/&gt;
the real change you made.  Could you provide a diff with just the real changes?  &lt;/p&gt;

&lt;p&gt;Also, if you have a unit test that excercises your addition, so we can be sure&lt;br/&gt;
it doesn&apos;t break anything, that would be great.  You&apos;d want your unit test to&lt;br/&gt;
mix and match Document additions and deletions and make sure it all still works&lt;br/&gt;
properly.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    <comment id="12322073" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 13:49:02 +0000"  >&lt;p&gt;Created an attachment (id=13759)&lt;br/&gt;
implementation of expungeDeleted method&lt;/p&gt;

&lt;p&gt;Attached is the implementation of IndexWriter.expungeDeleted method. It is self&lt;br/&gt;
contained.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;-John&lt;/p&gt;</comment>
                    <comment id="12322074" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 14:13:04 +0000"  >&lt;p&gt;Created an attachment (id=13760)&lt;br/&gt;
Unit test for the patch submited&lt;/p&gt;

&lt;p&gt;Attached please find the unit test for IndexWriter.expungeDelete() request by&lt;br/&gt;
Otis.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;-John&lt;/p&gt;</comment>
                    <comment id="12322075" author="john.wang@gmail.com" created="Sat, 18 Dec 2004 10:56:04 +0000"  >&lt;p&gt;Created an attachment (id=13776)&lt;br/&gt;
updated patch with a fixed diff version&lt;/p&gt;

&lt;p&gt;1) As request I reran cvs diff without having done a file format (which screwed&lt;br/&gt;
up cvs)&lt;/p&gt;

&lt;p&gt;2) implementation of expungeDelete was made better to handle/delete the&lt;br/&gt;
compound file after segment info update.&lt;/p&gt;</comment>
                    <comment id="12558413" author="gsingers" created="Sun, 13 Jan 2008 15:29:41 +0000"  >&lt;p&gt;This seems generally useful.  I imagine, though, that the patch is way out of date.  I wonder if the new ability to merge some segments might have an option to do this kind of thing.&lt;/p&gt;

&lt;p&gt;Any thoughts on resurrecting this? &lt;/p&gt;</comment>
                    <comment id="12558636" author="mikemccand" created="Mon, 14 Jan 2008 15:36:42 +0000"  >&lt;p&gt;I think we should resurrect this: I agree it&apos;s useful.  I&apos;ll take it &amp;amp; tentatively mark it 2.4 (hopefully I can make time by then!).&lt;/p&gt;

&lt;p&gt;The original patch would simply merge one segment &quot;in place&quot;.  I think we can improve this a bit by merging any adjacent series of segments that have deletions?  This would still preserve docID ordering, but would also accomplish some merging as a side effect (I think a good thing).&lt;/p&gt;</comment>
                    <comment id="12567328" author="mikemccand" created="Sat, 9 Feb 2008 15:20:35 +0000"  >&lt;p&gt;Attached patch.  All tests pass.  I plan to commit in a day or two.&lt;/p&gt;

&lt;p&gt;This adds two methods to IndexWriter:&lt;/p&gt;

&lt;p&gt;  expungeDeletes() &amp;#8211; defaults to doWait=true&lt;br/&gt;
  expungeDeletes(boolean doWait)&lt;/p&gt;

&lt;p&gt;If doWait is false, and you have a MergeScheduler that runs merges in&lt;br/&gt;
BG threads, then the call returns immediately.&lt;/p&gt;

&lt;p&gt;I extended MergePolicy so it decides what &quot;expunge deletes&quot; really&lt;br/&gt;
means (findMergesToExpungeDeletes).  Then, in LogMergePolicy, I&lt;br/&gt;
implemented this policy: we merge all adjacent segments (up to&lt;br/&gt;
mergeFactor at once) that have deletes.  If only 1 segment has&lt;br/&gt;
deletes, it&apos;s a singular merge.&lt;/p&gt;</comment>
                    <comment id="12567808" author="mikemccand" created="Mon, 11 Feb 2008 20:35:21 +0000"  >&lt;p&gt;I just committed this.  Thanks John!  And sorry for the looooong&lt;br/&gt;
delay.&lt;/p&gt;

&lt;p&gt;I also added an &quot;these APIs are experimental&quot; warning on top of&lt;br/&gt;
MergePolicy and MergeScheduler (which I should have done before&lt;br/&gt;
2.3 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, though I don&apos;t expect alot of usage of these).&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12312465" name="ASF.LICENSE.NOT.GRANTED--attachment.txt" size="2448" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 13:49:02 +0000" />
                    <attachment id="12312467" name="ASF.LICENSE.NOT.GRANTED--IndexWriter.patch" size="3437" author="john.wang@gmail.com" created="Sat, 18 Dec 2004 10:56:04 +0000" />
                    <attachment id="12312464" name="ASF.LICENSE.NOT.GRANTED--IndexWriter.patch" size="115064" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 08:57:09 +0000" />
                    <attachment id="12312466" name="ASF.LICENSE.NOT.GRANTED--TestExpungeDeleted.java" size="2729" author="john.wang@gmail.com" created="Wed, 15 Dec 2004 14:13:04 +0000" />
                    <attachment id="12375153" name="LUCENE-325.patch" size="13974" author="mikemccand" created="Sat, 9 Feb 2008 15:20:35 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>32712</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 15 Dec 2004 12:13:42 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13424</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27406</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>