<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:15:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2622/LUCENE-2622.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2622] Random Test Failure org.apache.lucene.TestExternalCodecs.testPerFieldCodec (from TestExternalCodecs)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2622</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Error Message&lt;/p&gt;

&lt;p&gt;state.ord=54 startOrd=0 ir.isIndexTerm=true state.docFreq=1&lt;br/&gt;
Stacktrace&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: state.ord=54 startOrd=0 ir.isIndexTerm=true state.docFreq=1&lt;br/&gt;
	at org.apache.lucene.index.codecs.standard.StandardTermsDictReader$FieldReader$SegmentTermsEnum.seek(StandardTermsDictReader.java:395)&lt;br/&gt;
	at org.apache.lucene.index.DocumentsWriter.applyDeletes(DocumentsWriter.java:1099)&lt;br/&gt;
	at org.apache.lucene.index.DocumentsWriter.applyDeletes(DocumentsWriter.java:1028)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.applyDeletes(IndexWriter.java:4213)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:3381)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3221)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3211)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2345)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2323)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2293)&lt;br/&gt;
	at org.apache.lucene.TestExternalCodecs.testPerFieldCodec(TestExternalCodecs.java:645)&lt;br/&gt;
	at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:381)&lt;br/&gt;
	at org.apache.lucene.util.LuceneTestCase.run(LuceneTestCase.java:373)&lt;br/&gt;
Standard Output&lt;/p&gt;

&lt;p&gt;NOTE: random codec of testcase &apos;testPerFieldCodec&apos; was: MockFixedIntBlock(blockSize=1327)&lt;br/&gt;
NOTE: random locale of testcase &apos;testPerFieldCodec&apos; was: lt_LT&lt;br/&gt;
NOTE: random timezone of testcase &apos;testPerFieldCodec&apos; was: Africa/Lusaka&lt;br/&gt;
NOTE: random seed of testcase &apos;testPerFieldCodec&apos; was: 812019387131615618&lt;/p&gt;</description>
                <environment></environment>
            <key id="12472537">LUCENE-2622</key>
            <summary>Random Test Failure org.apache.lucene.TestExternalCodecs.testPerFieldCodec (from TestExternalCodecs)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Aug 2010 23:31:46 +0100</created>
                <updated>Fri, 10 May 2013 11:43:15 +0100</updated>
                    <resolved>Sun, 19 Sep 2010 15:37:29 +0100</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>general/test</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12903383" author="simonw" created="Fri, 27 Aug 2010 13:20:05 +0100"  >&lt;p&gt;Got another one from testPerFieldCodec&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error Message

state.ord=54 startOrd=-1 ir.isIndexTerm=true state.docFreq=1
Stacktrace

junit.framework.AssertionFailedError: state.ord=54 startOrd=-1 ir.isIndexTerm=true state.docFreq=1
	at org.apache.lucene.util.LuceneTestCase.run(LuceneTestCase.java:373)
	at org.apache.lucene.index.codecs.standard.StandardTermsDictReader$FieldReader$SegmentTermsEnum.seek(StandardTermsDictReader.java:395)
	at org.apache.lucene.index.TermsEnum.seek(TermsEnum.java:68)
	at org.apache.lucene.index.Terms.docFreq(Terms.java:53)
	at org.apache.lucene.index.SegmentReader.docFreq(SegmentReader.java:896)
	at org.apache.lucene.index.IndexReader.docFreq(IndexReader.java:883)
	at org.apache.lucene.index.DirectoryReader.docFreq(DirectoryReader.java:687)
	at org.apache.lucene.search.IndexSearcher.docFreq(IndexSearcher.java:136)
	at org.apache.lucene.search.Similarity.idfExplain(Similarity.java:760)
	at org.apache.lucene.search.TermQuery$TermWeight.&amp;lt;init&amp;gt;(TermQuery.java:46)
	at org.apache.lucene.search.TermQuery.createWeight(TermQuery.java:171)
	at org.apache.lucene.search.Query.weight(Query.java:101)
	at org.apache.lucene.search.Searcher.createWeight(Searcher.java:147)
	at org.apache.lucene.search.Searcher.search(Searcher.java:98)
	at org.apache.lucene.search.Searcher.search(Searcher.java:108)
	at org.apache.lucene.TestExternalCodecs.testPerFieldCodec(TestExternalCodecs.java:654)
	at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:381)
Standard Output

NOTE: random codec of testcase &apos;testPerFieldCodec&apos; was: MockVariableIntBlock(baseBlockSize=67)
NOTE: random locale of testcase &apos;testPerFieldCodec&apos; was: no
NOTE: random timezone of testcase &apos;testPerFieldCodec&apos; was: Pacific/Pago_Pago
NOTE: random seed of testcase &apos;testPerFieldCodec&apos; was: 3834287108086754341
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12909686" author="simonw" created="Wed, 15 Sep 2010 11:20:51 +0100"  >&lt;p&gt;It seems that we figured out whats going on here. The problem seem to be the optimization done in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2588&quot; title=&quot;terms index should not store useless suffixes&quot;&gt;&lt;del&gt;LUCENE-2588&lt;/del&gt;&lt;/a&gt; where we strip off the non-distinguishing suffix to save RAM in the loaded terms index. The problem with this optimization is that it is not safe for all comparators. The testcase runs with a reverse unicode comparator which triggers terms to appear in reverse order during indexing. &lt;br/&gt;
Yet, this is not a problem until we have run into the situations where the the stripped suffix is required due to the nature of the comparator. In this case here we index number  from 0 - 173 and with the randomly set termIndexInterval set to 54 we run into a situation where the indexing code was wrong about the prefix. It sees the term &quot;49&quot; with prior term &quot;5&quot; and thinks it could strip of the &quot;9&quot; from the previous term and uses &quot;4&quot; as the indexed term. &lt;/p&gt;

&lt;p&gt;Once we seek on the terms dictionary the binary search in CoreFieldIndex#getIndexOffset we try to find the indexedTerm prior to term &quot;44&quot; we compare to &quot;4&quot; which returns -1 while comparing to &quot;49&quot; would have yield 1. That lets us end up with the wrong offset and the assert blows up.&lt;/p&gt;

&lt;p&gt;We somehow need to have access to the actually used comparator during building the indexed terms to fix that - I will reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2588&quot; title=&quot;terms index should not store useless suffixes&quot;&gt;&lt;del&gt;LUCENE-2588&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    <comment id="12909687" author="simonw" created="Wed, 15 Sep 2010 11:22:07 +0100"  >&lt;p&gt;these failures are triggered by the opts in  &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2588&quot; title=&quot;terms index should not store useless suffixes&quot;&gt;&lt;del&gt;LUCENE-2588&lt;/del&gt;&lt;/a&gt; - Thanks mike for helping figuring out what is going on.&lt;/p&gt;</comment>
                    <comment id="12912233" author="simonw" created="Sun, 19 Sep 2010 15:37:29 +0100"  >&lt;p&gt;Testcases pass with both reported random seeds - fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2588&quot; title=&quot;terms index should not store useless suffixes&quot;&gt;&lt;del&gt;LUCENE-2588&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12470840">LUCENE-2588</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 27 Aug 2010 12:20:05 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11215</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25070</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>