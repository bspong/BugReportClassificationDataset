<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:02:21 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1283/LUCENE-1283.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1283] Factor out ByteSliceWriter from DocumentsWriterFieldData</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1283</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;DocumentsWriter uses byte slices into shared byte[]&apos;s to hold the&lt;br/&gt;
growing postings data for many different terms in memory.  This is&lt;br/&gt;
probably the trickiest (most confusing) part of DocumentsWriter.&lt;/p&gt;

&lt;p&gt;Right now it&apos;s not cleanly factored out and not easy to separately&lt;br/&gt;
test.  In working on this issue:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200805.mbox/%3c126142c0805061426n1168421ya5594ef854fae5e4@mail.gmail.com%3e&quot; class=&quot;external-link&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200805.mbox/%3c126142c0805061426n1168421ya5594ef854fae5e4@mail.gmail.com%3e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;which eventually turned out to be a bug in Oracle JRE&apos;s JIT compiler,&lt;br/&gt;
I factored out ByteSliceWriter and created a unit test to stress test&lt;br/&gt;
the writing &amp;amp; reading of byte slices.  The test just randomly writes N&lt;br/&gt;
streams interleaved into shared byte[]&apos;s, then reads them back&lt;br/&gt;
verifying the results are correct.&lt;/p&gt;

&lt;p&gt;I created the stress test to try to find any bugs in that code.  The&lt;br/&gt;
test ran fine (no bugs were found) but I think the refactoring is&lt;br/&gt;
still very much worthwhile.&lt;/p&gt;

&lt;p&gt;I expected the changes to reduce indexing throughput, so I ran a test&lt;br/&gt;
indexing first 200K Wikipedia docs using this alg:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer
doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker

docs.file=/Volumes/External/lucene/wiki.txt
doc.stored = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.term.vector = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.add.log.step=2000

directory=FSDirectory
autocommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

ram.flush.mb=256

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;Rounds&quot;&lt;/span&gt;
  ResetSystemErase
  { &lt;span class=&quot;code-quote&quot;&gt;&quot;BuildIndex&quot;&lt;/span&gt;
    - CreateIndex
     { &lt;span class=&quot;code-quote&quot;&gt;&quot;AddDocs&quot;&lt;/span&gt; AddDoc &amp;gt; : 200000
    - CloseIndex
  }
  NewRound
} : 4

RepSumByPrefRound BuildIndex

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ok trunk it produces these results:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Operation   round   runCnt   recsPerRun        rec/s  elapsedSec    avgUsedMem    avgTotalMem
BuildIndex      0        1       200000        791.7      252.63   338,552,096  1,061,814,272
BuildIndex -  - 1 -  -   1 -  -  200000 -  -   793.1 -  - 252.18 - 605,262,080  1,061,814,272
BuildIndex      2        1       200000        794.8      251.63   601,966,528  1,061,814,272
BuildIndex -  - 3 -  -   1 -  -  200000 -  -   782.5 -  - 255.58 - 608,699,712  1,061,814,272
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and with the patch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Operation   round   runCnt   recsPerRun        rec/s  elapsedSec    avgUsedMem    avgTotalMem
BuildIndex      0        1       200000        745.0      268.47   338,318,784  1,061,814,272
BuildIndex -  - 1 -  -   1 -  -  200000 -  -   792.7 -  - 252.30 - 605,331,776  1,061,814,272
BuildIndex      2        1       200000        786.7      254.24   602,915,712  1,061,814,272
BuildIndex -  - 3 -  -   1 -  -  200000 -  -   795.3 -  - 251.48 - 602,378,624  1,061,814,272
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it looks like the performance cost of this change is negligible (in&lt;br/&gt;
the noise).&lt;/p&gt;
</description>
                <environment></environment>
            <key id="12395765">LUCENE-1283</key>
            <summary>Factor out ByteSliceWriter from DocumentsWriterFieldData</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 May 2008 11:34:34 +0100</created>
                <updated>Sat, 11 Oct 2008 13:49:37 +0100</updated>
                    <resolved>Sat, 17 May 2008 17:50:12 +0100</resolved>
                            <version>2.3</version>
                <version>2.3.1</version>
                                <fixVersion>2.4</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12595811" author="mikemccand" created="Sat, 10 May 2008 11:35:11 +0100"  >&lt;p&gt;Attached patch.  I plan to commit in a day or two.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12381820" name="LUCENE-1283.patch" size="23571" author="mikemccand" created="Sat, 10 May 2008 11:35:11 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12465</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26445</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>