<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:33:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2480/LUCENE-2480.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2480] Remove support for pre-3.0 indexes</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2480</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We should remove support for 2.x (and 1.9) indexes in 4.0. It seems that nothing can be done in 3x because there is no special code which handles 1.9, so we&apos;ll leave it there. This issue should cover:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Remove the .zip indexes&lt;/li&gt;
	&lt;li&gt;Remove the unnecessary code from SegmentInfo and SegmentInfos. Mike suggests we compare the version headers at the top of SegmentInfos, in 2.9.x vs 3.0.x, to see which ones can go.&lt;/li&gt;
	&lt;li&gt;remove FORMAT_PRE from FieldInfos&lt;/li&gt;
	&lt;li&gt;Remove old format from TermVectorsReader&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If you know of other places where code can be removed, then please post a comment here.&lt;/p&gt;

&lt;p&gt;I don&apos;t know when I&apos;ll have time to handle it, definitely not in the next few days. So if someone wants to take a stab at it, be my guest.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12465574">LUCENE-2480</key>
            <summary>Remove support for pre-3.0 indexes</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="shaie">Shai Erera</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 May 2010 16:43:28 +0100</created>
                <updated>Fri, 10 May 2013 11:43:03 +0100</updated>
                    <resolved>Sun, 18 Jul 2010 14:34:38 +0100</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12873276" author="shaie" created="Sat, 29 May 2010 13:39:31 +0100"  >&lt;p&gt;Patch removes code which supports old indexes. If there are more places in the code that you know of, please let me know.&lt;/p&gt;</comment>
                    <comment id="12873285" author="mikemccand" created="Sat, 29 May 2010 14:54:40 +0100"  >&lt;p&gt;Great work Shai!&lt;/p&gt;

&lt;p&gt;Another place we can remove is the preUTF8Strings in oal.store.DataInput, and anywhere that calls setModifiedUTF8StringsMode, and I think also FieldsWriter.FORMAT_VERSION_UTF8_LENGTH_IN_BYTES?&lt;/p&gt;</comment>
                    <comment id="12873296" author="earwin" created="Sat, 29 May 2010 16:57:13 +0100"  >&lt;p&gt;Here we go. Pre-utf8/compressed fields support removed, microcleanups/additions to previous patch.&lt;/p&gt;</comment>
                    <comment id="12873329" author="shaie" created="Sat, 29 May 2010 21:38:22 +0100"  >&lt;p&gt;Thanks Earwin ! Few comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;You didn&apos;t remove the .zip indexes?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;You removed the code from TestBackwardsCompatibilty which creates the older indexes. While this isn&apos;t needed currently for trunk - the code is commented out, and I don&apos;t think it bothers anyone - one day, after 4.0 is released, we will need to use it. So I don&apos;t think we should remove that piece of code.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;TestIndexFileDeleter failed &apos;cause of deletable file - fixed it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Attached is the merged patch, w/ the above fixes. Solr tests fail (&lt;b&gt;.dataimport.&lt;/b&gt; tests) for some reason. I don&apos;t understand this yet - so if someone more knowledgeable about Solr than me cares to take a look, I&apos;d appreciate it. I see many things like that (not sure how those tests are related to this issue):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit]
    [junit]  request was: q=id:500&amp;amp;start=0&amp;amp;qt=standard&amp;amp;version=2.2&amp;amp;rows=20
    [junit] junit.framework.AssertionFailedError: now it should query failed XPath: &lt;span class=&quot;code-comment&quot;&gt;//result[@numFound=1]
&lt;/span&gt;    [junit]  xml response was: &amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
    [junit] &amp;lt;response&amp;gt;
    [junit] &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;16&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt; numFound=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; start=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
    [junit] &amp;lt;/response&amp;gt;
    [junit]
    [junit]  request was: q=id:500&amp;amp;start=0&amp;amp;qt=standard&amp;amp;version=2.2&amp;amp;rows=20
    [junit]     at org.apache.solr.util.AbstractSolrTestCase.assertQ(AbstractSolrTestCase.java:236)
    [junit]     at org.apache.solr.update.AutoCommitTest.testMaxTime(AutoCommitTest.java:218)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12873384" author="shaie" created="Sun, 30 May 2010 08:32:53 +0100"  >&lt;ul&gt;
	&lt;li&gt;Removed the byte written by SegmentInfo (hasSingleNormsFile - redundant).&lt;/li&gt;
	&lt;li&gt;Added live migration code to SI.ctor to read that byte if pre-4.0 index&lt;/li&gt;
	&lt;li&gt;Renamed FORMAT_FLEX_POSTING to FORMAT_4_0. I think we should do this going forward in more places, so that it&apos;s clear to which version this format belongs and will make the task of removing support for old indexes in the future easier. The jdoc of the constant needs to describe what is covered by that format.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Besides the Solr tests, everything passes.&lt;/p&gt;

&lt;p&gt;BTW, I don&apos;t think we should stop writing that byte in 3.1 - not sure if hasSingleNormsFile is always true, and even if so, 3.0 indexes still need to be supported and they write the byte. And it does not add much of complexity.&lt;/p&gt;</comment>
                    <comment id="12873408" author="shaie" created="Sun, 30 May 2010 12:31:48 +0100"  >&lt;p&gt;Solr tests pass too ... dunno what happened, but they started to pass. And the dataimport tests do not seem they should be affected by this issue. So I&apos;d like to commit this soon.&lt;/p&gt;</comment>
                    <comment id="12873413" author="shaie" created="Sun, 30 May 2010 13:26:48 +0100"  >&lt;p&gt;Thanks Mike and Earwin for your help !&lt;/p&gt;

&lt;p&gt;Committed revision 949509.&lt;/p&gt;</comment>
                    <comment id="12873465" author="earwin" created="Sun, 30 May 2010 19:09:37 +0100"  >&lt;p&gt;Wow! So fast! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You didn&apos;t remove the .zip indexes?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Your patch didn&apos;t remove them for me, patch file format can&apos;t handle binary stuff.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You removed the code from TestBackwardsCompatibilty ...... So I don&apos;t think we should remove that piece of code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Several lines later there sits a piece of absolutely identical commented-out code. The only difference is that it doesn&apos;t use &quot;preLockless&quot; in method names.&lt;br/&gt;
If someone really needs it later, the code I left over suits him no less than the code I removed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;TestIndexFileDeleter failed &apos;cause of deletable file - fixed it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cool! It&apos;s very strange I missed the failure.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Renamed FORMAT_FLEX_POSTING to FORMAT_4_0&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;FORMAT_4_0_FLEX_POSTINGS? I loved the self-descriptiveness &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;And, yup. Bye-bye to the byte.&lt;/p&gt;</comment>
                    <comment id="12873466" author="shaie" created="Sun, 30 May 2010 19:18:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;Your patch didn&apos;t remove them for me, patch file format can&apos;t handle binary stuff.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Strange, there were lines in my patch file which indicated they are removed, but were absent from yours. Anyway, they&apos;re removed now.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Several lines later there sits a piece of absolutely identical commented-out code. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t see it.  All I see is a comment and two methods that are used to generate the old indexes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;FORMAT_4_0_FLEX_POSTINGS&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While I don&apos;t mind that sort of descriptiveness, it does not fit in all cases, such as this case &amp;#8211; this format is related to both flex postings, but also to that byte removed from the SegmentInfo &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. So I think we should keep the names simple, and have a useful javadoc. It&apos;s the sort of constants no one really cares about in his daily work, only when you handle file format backwards stuff &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Also, if by chance (like this case, again) you get to change the file format version twice, by two different people, with long time interval between the two, a FORMAT_4_0 should alert you that that&apos;s used for the unreleased index, and so you don&apos;t need to bump it up again (here, jumping from -9 to -11) accidentally.&lt;/p&gt;</comment>
                    <comment id="12873469" author="earwin" created="Sun, 30 May 2010 19:34:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;Strange, there were lines in my patch file which indicated they are removed, but were absent from yours.&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: lucene/src/test/org/apache/lucene/index/index.19.cfs.zip
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream
Index: lucene/src/test/org/apache/lucene/index/index.19.nocfs.zip
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream
Index: lucene/src/test/org/apache/lucene/index/index.20.cfs.zip
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These lines in your patch mean that diff noticed the differences, but failed to express them - nothing more. You could modify all these files instead of deleting, and get the same result.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t see it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ctrl+F, &quot;testCreateCFS&quot;&lt;br/&gt;
Ok, they&apos;re not completely identical. But I don&apos;t really care either way.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;.... FORMAT stuff .....&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ok.&lt;/p&gt;</comment>
                    <comment id="12889613" author="thetaphi" created="Sun, 18 Jul 2010 13:34:10 +0100"  >&lt;p&gt;I reopen this issue, as the following problem is there:&lt;br/&gt;
When somebody tries to open an pre-3.0 index, it should fail with a meaningful exception. At least e.g. FieldsReader (where I found dead code after your removal) does not check that the version is ge the minimum version. We should add a static FORMAT_MINIMUM to all places where formats are used and check it on reading.&lt;/p&gt;</comment>
                    <comment id="12889615" author="thetaphi" created="Sun, 18 Jul 2010 13:48:59 +0100"  >&lt;p&gt;Here a first patch, that handles this in FieldsReader to show how it should be done elsewhere, too. This patch also removes some &quot;dead&quot; code in FieldReader, too. I left the method in, as we may need canReadRawDocs() for later format changes, too.&lt;/p&gt;</comment>
                    <comment id="12889617" author="mikemccand" created="Sun, 18 Jul 2010 13:51:09 +0100"  >&lt;p&gt;I already opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2523&quot; title=&quot;if index is too old you should hit an exception saying so&quot;&gt;&lt;del&gt;LUCENE-2523&lt;/del&gt;&lt;/a&gt; for this, but it&apos;s OK if we do the work here and resolve that one as a dup.&lt;/p&gt;

&lt;p&gt;I think you should see an IndexTooOldException instead of CorruptIndexException (though the former could subclass the latter?)&lt;/p&gt;</comment>
                    <comment id="12889619" author="thetaphi" created="Sun, 18 Jul 2010 14:34:09 +0100"  >&lt;p&gt;Oh, I move over to this issue. I am almost finished!&lt;/p&gt;</comment>
                    <comment id="12889620" author="thetaphi" created="Sun, 18 Jul 2010 14:34:38 +0100"  >&lt;p&gt;Closing again.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12445872" name="LUCENE-2480.patch" size="98528" author="shaie" created="Sun, 30 May 2010 08:32:53 +0100" />
                    <attachment id="12445859" name="LUCENE-2480.patch" size="97849" author="shaie" created="Sat, 29 May 2010 21:38:22 +0100" />
                    <attachment id="12445847" name="LUCENE-2480.patch" size="94112" author="earwin" created="Sat, 29 May 2010 16:57:13 +0100" />
                    <attachment id="12445839" name="LUCENE-2480.patch" size="53322" author="shaie" created="Sat, 29 May 2010 13:39:31 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 29 May 2010 13:54:40 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11340</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25212</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>