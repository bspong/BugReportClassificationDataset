<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:51 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-586/LUCENE-586.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-586] Very inefficient implementation of MultiTermDocs.skipTo</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-586</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;In our application anytime the index was unoptimized/contained more than one segment there was a sharp drop in performance, which amounted to over 50ms per search on average.  We would consistently see this drop anytime an index went from an optimized state to an unoptimized state.&lt;/p&gt;

&lt;p&gt;I tracked down the issue to the implementation of MultiTermDocs.skipTo function (found in MultiReader.java).  Optimized indexes do not use this class during search but unoptimized indexes do.  The comment on this function even explicitly states &apos;As yet unoptimized implementation.&apos;  It was implemented just by calling &apos;next&apos; over and over so even if it knew it could skip ahead hundreds of thousands of hits it would not.&lt;/p&gt;

&lt;p&gt;So I re-implemented the function very similar to how the MultiTermDocs.next function was implemented and tested it out on or application for correctness and performance and it passed all our tests and the performance penalty of having multiple segments vanished.  We have already put the new jar onto our production machines.&lt;/p&gt;

&lt;p&gt;Here is my implementation of skipTo, which closely mirrors the accepted implementation of &apos;next&apos;, please feel free to test it and commit it.&lt;/p&gt;

&lt;p&gt;  /** Much more optimized implementation. Could be&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;optimized fairly easily to skip entire segments */&lt;br/&gt;
  public boolean skipTo(int target) throws IOException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    if (current != null &amp;amp;&amp;amp; current.skipTo(target-base)) {
      return true;
    } else if (pointer &amp;lt; readers.length) {
      base = starts[pointer];
      current = termDocs(pointer++);
      return skipTo(target);
    } else      return false;  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12343806">LUCENE-586</key>
            <summary>Very inefficient implementation of MultiTermDocs.skipTo</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                <reporter username="ahudson">Andrew Hudson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Jun 2006 02:44:25 +0100</created>
                <updated>Tue, 27 Feb 2007 18:10:34 +0000</updated>
                    <resolved>Fri, 2 Jun 2006 04:35:04 +0100</resolved>
                                            <fixVersion>2.1</fixVersion>
                                <component>core/index</component>
                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12414296" author="yseeley@gmail.com" created="Fri, 2 Jun 2006 04:35:04 +0100"  >&lt;p&gt;Thanks Andrew, I just committed this.&lt;/p&gt;</comment>
                    <comment id="12476262" author="mikemccand" created="Tue, 27 Feb 2007 18:10:34 +0000"  >&lt;p&gt;Closing all issues that were resolved for 2.1.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 2 Jun 2006 03:35:04 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13164</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27141</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>