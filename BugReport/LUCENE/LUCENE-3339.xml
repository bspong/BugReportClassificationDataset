<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:59 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3339/LUCENE-3339.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3339] TestNRTThreads hangs in nightly 3.x builds</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3339</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Maybe we have a problem, maybe its a bug in the test.&lt;/p&gt;

&lt;p&gt;But its strange that lately the 3.x nightlies have been hanging here.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12515211">LUCENE-3339</key>
            <summary>TestNRTThreads hangs in nightly 3.x builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jul 2011 02:45:08 +0100</created>
                <updated>Sun, 27 Nov 2011 12:31:42 +0000</updated>
                    <resolved>Wed, 9 Nov 2011 11:29:46 +0000</resolved>
                                            <fixVersion>3.4</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13070293" author="rcmuir" created="Mon, 25 Jul 2011 02:45:24 +0100"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] 2011-07-25 01:41:48
    [junit] Full thread dump OpenJDK 64-Bit Server VM (20.0-b11 mixed mode):
    [junit] 
    [junit] &quot;Thread-120&quot; daemon prio=5 tid=0x0000000801cd8800 nid=0x19492 in Object.wait() [0x00007ffffdfe2000]
    [junit]    java.lang.Thread.State: WAITING (on object monitor)
    [junit] 	at java.lang.Object.wait(Native Method)
    [junit] 	- waiting on &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at java.lang.Object.wait(Object.java:502)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.waitForWaitQueue(DocumentsWriter.java:1064)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:882)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:2164)
    [junit] 	at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2122)
    [junit] 	at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2106)
    [junit] 	at org.apache.lucene.index.TestNRTThreads$2.run(TestNRTThreads.java:205)
    [junit] 
    [junit] &quot;Thread-119&quot; daemon prio=5 tid=0x0000000801cd9000 nid=0x19410 in Object.wait() [0x00007ffffe0e3000]
    [junit]    java.lang.Thread.State: WAITING (on object monitor)
    [junit] 	at java.lang.Object.wait(Native Method)
    [junit] 	- waiting on &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at java.lang.Object.wait(Object.java:502)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.waitForWaitQueue(DocumentsWriter.java:1064)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:882)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:2164)
    [junit] 	at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2122)
    [junit] 	at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2106)
    [junit] 	at org.apache.lucene.index.TestNRTThreads$2.run(TestNRTThreads.java:205)
    [junit] 
    [junit] &quot;Low Memory Detector&quot; daemon prio=5 tid=0x0000000801cea800 nid=0x18c7a runnable [0x0000000000000000]
    [junit]    java.lang.Thread.State: RUNNABLE
    [junit] 
    [junit] &quot;C2 CompilerThread1&quot; daemon prio=5 tid=0x0000000801ceb000 nid=0x18c6d waiting on condition [0x0000000000000000]
    [junit]    java.lang.Thread.State: RUNNABLE
    [junit] 
    [junit] &quot;C2 CompilerThread0&quot; daemon prio=5 tid=0x0000000801cec000 nid=0x18c67 waiting on condition [0x0000000000000000]
    [junit]    java.lang.Thread.State: RUNNABLE
    [junit] 
    [junit] &quot;Signal Dispatcher&quot; daemon prio=5 tid=0x0000000801cec800 nid=0x18c65 waiting on condition [0x0000000000000000]
    [junit]    java.lang.Thread.State: RUNNABLE
    [junit] 
    [junit] &quot;Finalizer&quot; daemon prio=5 tid=0x0000000801ced800 nid=0x18c63 in Object.wait() [0x00007ffffebee000]
    [junit]    java.lang.Thread.State: WAITING (on object monitor)
    [junit] 	at java.lang.Object.wait(Native Method)
    [junit] 	- waiting on &amp;lt;0x000000080a3602c0&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
    [junit] 	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:133)
    [junit] 	- locked &amp;lt;0x000000080a3602c0&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
    [junit] 	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:149)
    [junit] 	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:177)
    [junit] 
    [junit] &quot;Reference Handler&quot; daemon prio=5 tid=0x0000000801cef000 nid=0x18c60 in Object.wait() [0x00007ffffecef000]
    [junit]    java.lang.Thread.State: WAITING (on object monitor)
    [junit] 	at java.lang.Object.wait(Native Method)
    [junit] 	- waiting on &amp;lt;0x000000080a360360&amp;gt; (a java.lang.ref.Reference$Lock)
    [junit] 	at java.lang.Object.wait(Object.java:502)
    [junit] 	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
    [junit] 	- locked &amp;lt;0x000000080a360360&amp;gt; (a java.lang.ref.Reference$Lock)
    [junit] 
    [junit] &quot;main&quot; prio=5 tid=0x0000000801cef800 nid=0x18bfa in Object.wait() [0x00007fffffbfd000]
    [junit]    java.lang.Thread.State: WAITING (on object monitor)
    [junit] 	at java.lang.Object.wait(Native Method)
    [junit] 	- waiting on &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at java.lang.Object.wait(Object.java:502)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.waitIdle(DocumentsWriter.java:987)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:525)
    [junit] 	- locked &amp;lt;0x000000080a5ccea8&amp;gt; (a org.apache.lucene.index.DocumentsWriter)
    [junit] 	at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3547)
    [junit] 	- locked &amp;lt;0x000000080a5ccf38&amp;gt; (a org.apache.lucene.index.IndexWriter)
    [junit] 	at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3512)
    [junit] 	at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:459)
    [junit] 	- locked &amp;lt;0x000000080a5ccf38&amp;gt; (a org.apache.lucene.index.IndexWriter)
    [junit] 	at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:408)
    [junit] 	at org.apache.lucene.index.IndexReader.open(IndexReader.java:304)
    [junit] 	at org.apache.lucene.index.TestNRTThreads.testNRTThreads(TestNRTThreads.java:339)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    [junit] 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    [junit] 	at java.lang.reflect.Method.invoke(Method.java:616)
    [junit] 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    [junit] 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    [junit] 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    [junit] 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    [junit] 	at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1316)
    [junit] 	at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1221)
    [junit] 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
    [junit] 	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
    [junit] 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
    [junit] 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
    [junit] 	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
    [junit] 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit] 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit] 	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
    [junit] 	at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)
    [junit] 	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:743)
    [junit] 
    [junit] &quot;VM Thread&quot; prio=5 tid=0x0000000801d27000 nid=0x18c52 runnable 
    [junit] 
    [junit] &quot;GC task thread#0 (ParallelGC)&quot; prio=5 tid=0x0000000801d30000 nid=0x18c0a runnable 
    [junit] 
    [junit] &quot;GC task thread#1 (ParallelGC)&quot; prio=5 tid=0x0000000801d2f000 nid=0x18c11 runnable 
    [junit] 
    [junit] &quot;GC task thread#2 (ParallelGC)&quot; prio=5 tid=0x0000000801d2e800 nid=0x18c16 runnable 
    [junit] 
    [junit] &quot;GC task thread#3 (ParallelGC)&quot; prio=5 tid=0x0000000801d2e000 nid=0x18c18 runnable 
    [junit] 
    [junit] &quot;GC task thread#4 (ParallelGC)&quot; prio=5 tid=0x0000000801d2d800 nid=0x18c19 runnable 
    [junit] 
    [junit] &quot;GC task thread#5 (ParallelGC)&quot; prio=5 tid=0x0000000801d2c800 nid=0x18c1a runnable 
    [junit] 
    [junit] &quot;GC task thread#6 (ParallelGC)&quot; prio=5 tid=0x0000000801d2c000 nid=0x18c20 runnable 
    [junit] 
    [junit] &quot;GC task thread#7 (ParallelGC)&quot; prio=5 tid=0x0000000801d2b800 nid=0x18c23 runnable 
    [junit] 
    [junit] &quot;GC task thread#8 (ParallelGC)&quot; prio=5 tid=0x0000000801d2a800 nid=0x18c25 runnable 
    [junit] 
    [junit] &quot;GC task thread#9 (ParallelGC)&quot; prio=5 tid=0x0000000801d2a000 nid=0x18c3b runnable 
    [junit] 
    [junit] &quot;GC task thread#10 (ParallelGC)&quot; prio=5 tid=0x0000000801d29800 nid=0x18c3c runnable 
    [junit] 
    [junit] &quot;GC task thread#11 (ParallelGC)&quot; prio=5 tid=0x0000000801d29000 nid=0x18c40 runnable 
    [junit] 
    [junit] &quot;GC task thread#12 (ParallelGC)&quot; prio=5 tid=0x0000000801d28000 nid=0x18c42 runnable 
    [junit] 
    [junit] &quot;VM Periodic Task Thread&quot; prio=5 tid=0x0000000801d26800 nid=0x18c81 waiting on condition 
    [junit] 
    [junit] JNI global references: 1449
    [junit] 
    [junit] Heap
    [junit]  PSYoungGen      total 163712K, used 31923K [0x000000081f8c0000, 0x000000082a2e0000, 0x000000082a360000)
    [junit]   eden space 154112K, 17% used [0x000000081f8c0000,0x00000008212d4cc8,0x0000000828f40000)
    [junit]   from space 9600K, 54% used [0x0000000828f40000,0x00000008294581b8,0x00000008298a0000)
    [junit]   to   space 9344K, 0% used [0x00000008299c0000,0x00000008299c0000,0x000000082a2e0000)
    [junit]  PSOldGen        total 70336K, used 42498K [0x000000080a360000, 0x000000080e810000, 0x000000081f8c0000)
    [junit]   object space 70336K, 60% used [0x000000080a360000,0x000000080cce0aa8,0x000000080e810000)
    [junit]  PSPermGen       total 25216K, used 12189K [0x0000000805160000, 0x0000000806a00000, 0x000000080a360000)
    [junit]   object space 25216K, 48% used [0x0000000805160000,0x0000000805d47768,0x0000000806a00000)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13070480" author="mikemccand" created="Mon, 25 Jul 2011 14:04:20 +0100"  >&lt;p&gt;Patch attached.&lt;/p&gt;

&lt;p&gt;I can&apos;t repro this locally, but I think I see the problem: the bulk-add (IW.add/updateDocuments) methods cannot pause for the wait queue until after all docs in the block are added.  Else, 2 threads could get only partway through their block and both would then pause and never resume.&lt;/p&gt;

&lt;p&gt;This does not affect trunk because w/ DWPT we no longer have the waitQueue.&lt;/p&gt;

&lt;p&gt;The fix is simple: move the pausing out of the loop.  I&apos;ll commit shortly.&lt;/p&gt;</comment>
                    <comment id="13071037" author="mikemccand" created="Tue, 26 Jul 2011 12:06:10 +0100"  >&lt;p&gt;Nightly build hung again...&lt;/p&gt;</comment>
                    <comment id="13071075" author="mikemccand" created="Tue, 26 Jul 2011 14:02:38 +0100"  >&lt;p&gt;OK last fix wasn&apos;t quite right: we have to re-check whether or not to pause after the loop ends, and it must be inside sync block.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave this open until we see that this no longer hangs in nightly build...&lt;/p&gt;</comment>
                    <comment id="13134870" author="olvesh" created="Tue, 25 Oct 2011 10:21:33 +0100"  >&lt;p&gt;I am testing Lucene for my project now, and it seems that I run into this (or something like this) in 3.3.0. I try to index three different sources concurrently and all three processes get stuck here.&lt;/p&gt;

&lt;p&gt;The indexation happens as cause of a scheduled event, and at startup time I try to debug and since my breakpoints synchronize the events, they continue in perfect sync om my four cores. &lt;br/&gt;
I do not see that issue when I startup with my breakpoints disabled.&lt;/p&gt;

&lt;p&gt;The stacktrace for my three processes are exactly the same. Is there a workaround for this issue or do I have to wait for 3.5 (that is if it is the same problem)?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
minokWorkerExecutor-1@5444, prio=5, in group &apos;main&apos;, status: &apos;waiting&apos;
  java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:-1)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:485)
	  at org.apache.lucene.index.DocumentsWriter.waitForWaitQueue(DocumentsWriter.java:1057)
	  at org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:875)
	  at org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:2163)
	  at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2121)
	  at org.apache.lucene.index.IndexWriter.addDocuments(IndexWriter.java:2105)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="13146827" author="simonw" created="Wed, 9 Nov 2011 07:30:21 +0000"  >&lt;p&gt;mike did we hang on 3.x since your last commit? can we close this?&lt;/p&gt;</comment>
                    <comment id="13146948" author="mikemccand" created="Wed, 9 Nov 2011 11:29:24 +0000"  >&lt;p&gt;Olve, which version of Lucene are you seeing deadlock in?  This was fixed in 3.4.0.&lt;/p&gt;</comment>
                    <comment id="13146949" author="mikemccand" created="Wed, 9 Nov 2011 11:29:46 +0000"  >&lt;p&gt;Simon, yes I think so; I believe this was fixed in 3.4.0.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12487696" name="LUCENE-3339.patch" size="2109" author="mikemccand" created="Mon, 25 Jul 2011 14:04:20 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 25 Jul 2011 13:04:20 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10698</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24357</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>