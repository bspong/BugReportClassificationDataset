<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1519/LUCENE-1519.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1519] Change Primitive Data Types from int to long in class SegmentMerger.java</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1519</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;We are getting an exception while optimize. We are getting this exception &quot;mergeFields produced an invalid result: docCount is 385282378 but fdx file size is 3082259028; now aborting this merge to prevent index corruption&quot;&lt;/p&gt;

&lt;p&gt;I have  checked the code for class SegmentMerger.java and found this check &lt;/p&gt;

&lt;p&gt;***********************************************************************************************************************************************************************&lt;br/&gt;
if (4+docCount*8 != fdxFileLength)&lt;br/&gt;
        // This is most likely a bug in Sun JRE 1.6.0_04/_05;&lt;br/&gt;
        // we detect that the bug has struck, here, and&lt;br/&gt;
        // throw an exception to prevent the corruption from&lt;br/&gt;
        // entering the index.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1282&quot; title=&quot;Sun hotspot compiler bug in 1.6.0_04/05 affects Lucene&quot;&gt;&lt;del&gt;LUCENE-1282&lt;/del&gt;&lt;/a&gt; for&lt;br/&gt;
        // details.&lt;br/&gt;
        throw new RuntimeException(&quot;mergeFields produced an invalid result: docCount is &quot; + docCount + &quot; but fdx file size is &quot; + fdxFileLength + &quot;; now aborting this merge to prevent index corruption&quot;);&lt;br/&gt;
}&lt;br/&gt;
***********************************************************************************************************************************************************************&lt;/p&gt;

&lt;p&gt;In our case docCount is 385282378 and fdxFileLength size is 3082259028, even though 4+385282378*8 is equal to 3082259028, the above code will not work because number 3082259028 is out of int range. So type of variable docCount needs to be changed to long&lt;/p&gt;

&lt;p&gt;I have written a small test for this &lt;/p&gt;

&lt;p&gt;************************************************************************************************************************************************************************&lt;/p&gt;

&lt;p&gt;public class SegmentMergerTest {&lt;br/&gt;
public static void main(String[] args) {&lt;br/&gt;
int docCount = 385282378; &lt;br/&gt;
long fdxFileLength = 3082259028L; &lt;br/&gt;
if(4+docCount*8 != fdxFileLength) &lt;br/&gt;
System.out.println(&quot;No Match&quot; + (4+docCount*8));&lt;br/&gt;
else &lt;br/&gt;
System.out.println(&quot;Match&quot; + (4+docCount*8));&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;************************************************************************************************************************************************************************&lt;/p&gt;

&lt;p&gt;Above test will print No Match but if you change the data type of docCount to long, it will print Match&lt;/p&gt;

&lt;p&gt;Can you please advise us if this issue will be fixed in next release?&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Deepak&lt;/p&gt;










</description>
                <environment>&lt;p&gt;lucene 2.4.0, jdk1.6.0_03/07/11&lt;/p&gt;</environment>
            <key id="12412350">LUCENE-1519</key>
            <summary>Change Primitive Data Types from int to long in class SegmentMerger.java</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="kalradeepak">Deepak</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Jan 2009 05:16:54 +0000</created>
                <updated>Fri, 25 Sep 2009 17:23:17 +0100</updated>
                    <resolved>Thu, 19 Feb 2009 10:07:09 +0000</resolved>
                            <version>2.4</version>
                                <fixVersion>2.4.1</fixVersion>
                <fixVersion>2.9</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                          <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                    <timeestimate seconds="14400">4h</timeestimate>
                                  <comments>
                    <comment id="12663633" author="otis" created="Wed, 14 Jan 2009 05:36:53 +0000"  >&lt;p&gt;Deepak - could you please bring this up on the java-user mailing list instead and close this issue?&lt;/p&gt;</comment>
                    <comment id="12663652" author="kalradeepak" created="Wed, 14 Jan 2009 08:07:03 +0000"  >&lt;p&gt;Hi Otis&lt;/p&gt;

&lt;p&gt;It is a lucene bug. Is there any other mail list for reporting  lucene java bug. then please send me the link&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Deepak&lt;/p&gt;</comment>
                    <comment id="12663702" author="mikemccand" created="Wed, 14 Jan 2009 09:59:58 +0000"  >&lt;p&gt;Grr &amp;#8211; the bug is real.  I&apos;ll fix.&lt;/p&gt;</comment>
                    <comment id="12663770" author="mikemccand" created="Wed, 14 Jan 2009 15:12:26 +0000"  >&lt;p&gt;Committed revision 734415.&lt;/p&gt;

&lt;p&gt;Thanks Deepak!&lt;/p&gt;</comment>
                    <comment id="12665302" author="kalradeepak" created="Tue, 20 Jan 2009 01:23:08 +0000"  >&lt;p&gt;No problem&lt;/p&gt;</comment>
                    <comment id="12674859" author="mikemccand" created="Thu, 19 Feb 2009 01:37:22 +0000"  >&lt;p&gt;Reopening for backport to 2.4.1.&lt;/p&gt;</comment>
                    <comment id="12674949" author="mikemccand" created="Thu, 19 Feb 2009 10:07:09 +0000"  >&lt;p&gt;Committed revision 745801 on 2.4 branch.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12412605">LUCENE-1521</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 14 Jan 2009 05:36:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12234</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26209</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>