<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:18:03 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1209/LUCENE-1209.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1209] If setConfig(Config config) is called in resetInputs(), you can turn term vectors off and on by round</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1209</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I want to be able to run one benchmark that tests things using term vectors and not using term vectors.&lt;/p&gt;

&lt;p&gt;Currently this is not easy because you cannot specify term vectors per round.&lt;/p&gt;

&lt;p&gt;While you do have to create a new index per round, this automation is preferable to me in comparison to running two separate tests.&lt;/p&gt;

&lt;p&gt;If it doesn&apos;t affect anything else, it would be great to have setConfig(Config config) called in BasicDocMaker.resetInputs(). This would keep the term vector options up to date per round if you reset.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mark&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12390517">LUCENE-1209</key>
            <summary>If setConfig(Config config) is called in resetInputs(), you can turn term vectors off and on by round</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="doronc">Doron Cohen</assignee>
                                <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Mar 2008 02:21:03 +0000</created>
                <updated>Sun, 9 Mar 2008 16:56:37 +0000</updated>
                    <resolved>Sun, 9 Mar 2008 16:56:37 +0000</resolved>
                            <version>2.4</version>
                                                <component>modules/benchmark</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12576615" author="doronc" created="Sat, 8 Mar 2008 21:16:50 +0000"  >&lt;p&gt;Config maintains properties by round, so this should do the trick: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;doc.term.vector=tvf:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It sets term-vectors to true in round 0, false in round 1, true in round 2, etc.&lt;br/&gt;
Also, a column is added to the reports with the value of this property (&apos;tvf&apos;). &lt;/p&gt;

&lt;p&gt;Unless you already tried this and it didn&apos;t work?&lt;/p&gt;</comment>
                    <comment id="12576644" author="markrmiller@gmail.com" created="Sat, 8 Mar 2008 22:57:31 +0000"  >&lt;p&gt;It seems to me that its not working right. Everything that is set in public void setConfig(Config config) is only set once for me, not per round. That is unless I apply the above patch. This means that I cannot seem to set tokenizing, storing, or termvectors per round.&lt;/p&gt;

&lt;p&gt;From what I can tell it is because setConfig is only called once, and so only the first value is every read for those properties. The patch above puts set config in the resetInputs method which does get called per round. Not sure if that is the best fix, but I know cannot currently set those per round and have anything but the first setting take effect.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mark&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12576723" author="doronc" created="Sun, 9 Mar 2008 08:01:32 +0000"  >&lt;p&gt;Mark you are right that setConfig is called just once, at start.&lt;br/&gt;
At least for setting properties by round this should be sufficient. &lt;br/&gt;
I wonder why this doesn&apos;t work for you.&lt;/p&gt;

&lt;p&gt;I tried with this one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer
directory=RamDirectory

doc.stored=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.tokenized=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.term.vector=termVec:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.add.log.step=10

doc.maker=org.apache.lucene.benchmark.byTask.feeds.SimpleDocMaker
task.max.depth.log=1

{

    { &lt;span class=&quot;code-quote&quot;&gt;&quot;Populate&quot;&lt;/span&gt;
        CreateIndex
        { AddDoc &amp;gt; : 50
        Optimize
        CloseIndex
    &amp;gt;

    ResetSystemErase
    NewRound

} : 2

RepSumByName
RepSelectByPref Populate
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And got this output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; Working Directory: work
 Running algorithm from: conf\termVecByRound.alg
 ------------&amp;gt; config properties:
 analyzer = org.apache.lucene.analysis.standard.StandardAnalyzer
 compound = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 directory = RamDirectory
 doc.add.log.step = 10
 doc.maker = org.apache.lucene.benchmark.byTask.feeds.SimpleDocMaker
 doc.stored = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 doc.term.vector = termVec:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 doc.tokenized = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 task.max.depth.log = 1
 work.dir = work
 -------------------------------
 ------------&amp;gt; algorithm:
 Seq {
     Seq_2 {
         Populate {
             CreateIndex
             Seq_50 {
                 AddDoc
             &amp;gt; * 50
             Optimize
             CloseIndex
         &amp;gt;
         ResetSystemErase
         NewRound
     } * 2
     RepSumByName
     RepSelectByPref Populate
 }
 
 ------------&amp;gt; starting task: Seq
 ------------&amp;gt; starting task: Seq_2
 --&amp;gt; 0.1 sec: main processed (add) 10 docs
 --&amp;gt; 0.1 sec: main processed (add) 20 docs
 --&amp;gt; 0.11 sec: main processed (add) 30 docs
 --&amp;gt; 0.11 sec: main processed (add) 40 docs
 --&amp;gt; 0.11 sec: main processed (add) 50 docs
 ------------&amp;gt; SimpleDocMaker statistics (0): 
 num docs added since last inputs reset:                   50
 total bytes added since last inputs reset:             42,150
 
 
 
 --&amp;gt; Round 0--&amp;gt;1:   doc.term.vector:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;--&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 
 --&amp;gt; 0 sec: main processed (add) 60 docs
 --&amp;gt; 0 sec: main processed (add) 70 docs
 --&amp;gt; 0 sec: main processed (add) 80 docs
 --&amp;gt; 0 sec: main processed (add) 90 docs
 --&amp;gt; 0 sec: main processed (add) 100 docs
 ------------&amp;gt; SimpleDocMaker statistics (1): 
 num docs added since last inputs reset:                   50
 total bytes added since last inputs reset:             42,150
 
 
 
 --&amp;gt; Round 1--&amp;gt;2:   doc.term.vector:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;--&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
 
 
 ------------&amp;gt; Report Sum By (any) Name (2 about 3 out of 4)
 Operation   round termVec   runCnt   recsPerRun        rec/s  elapsedSec    avgUsedMem    avgTotalMem
 Seq_2           0   &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;        1          106        530.0        0.20       639,912      5,177,344
 Populate        -       -        2           53        706.7        0.15       839,552      5,177,344
 
 
 ------------&amp;gt; Report Select By Prefix (Populate) (2 about 2 out of 4)
 Operation   round termVec   runCnt   recsPerRun        rec/s  elapsedSec    avgUsedMem    avgTotalMem
 Populate        0   &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;        1           53        378.6        0.14       858,080      5,177,344
 Populate -  -   1 -  &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -  -   1 -  -  -   53 -  - 5,300.0 -  -   0.01 -  -  821,024 -  - 5,177,344
 
 ####################
 ###  D O N E !!! ###
 ####################
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note in particular this line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[java] --&amp;gt; Round 0--&amp;gt;1:   doc.term.vector:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;--&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that a &lt;b&gt;NewRound&lt;/b&gt; command is required in order for the round number to change. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    NewRound
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A possible cause for error is that the property definition parsing requires a property name prefix for multi-valued properties.&lt;br/&gt;
So this would not work as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;doc.term.vector=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this will work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;doc.term.vector=termVec:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If it still doesn&apos;t work for you, can you post here the algorithm?&lt;/p&gt;</comment>
                    <comment id="12576770" author="markrmiller@gmail.com" created="Sun, 9 Mar 2008 13:43:49 +0000"  >&lt;p&gt;My algorithm is below.&lt;/p&gt;

&lt;p&gt;I see &quot;Round 0-&lt;del&gt;&amp;gt;1:   doc.term.vector:false&lt;/del&gt;-&amp;gt;true&quot; as well...however if I put a debug print on what is returned from public boolean get (String name, boolean dflt), it is only ever called once for &quot;doc.term.vector&quot; as well as the other guys in setConfig.&lt;/p&gt;

&lt;p&gt;More importantly, lets say I set it to true:false....if I look at the work/index directory on the second run, there are certainly term vectors. Thats how I noticed this to begin with...I was looking at the index and saw the term vector files on every round. Its possible I have something messed up, but every time I run through everything again and it really does not seem to be working. If I set term vectors to false:true, they are never made in any round.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Mark you are right that setConfig is called just once, at start.&lt;br/&gt;
&amp;gt;&amp;gt;At least for setting properties by round this should be sufficient.&lt;br/&gt;
&amp;gt;&amp;gt;I wonder why this doesn&apos;t work for you. &lt;/p&gt;

&lt;p&gt;I think this admits the problem right? The get property for everything in setConfig is only called once...that loads up the &quot;false:true&quot;, returns false, and sets up &quot;true&quot; to be returned on the next call...the next time you call get on Config you will get the &quot;true&quot;...but there is no next time. Its only done once...so it shows up right in the output &quot;Round 0-&lt;del&gt;&amp;gt;1:   doc.term.vector:false&lt;/del&gt;-&amp;gt;true&quot;, but its only every called once and so only loads false.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mark&lt;/li&gt;
&lt;/ul&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ram.flush.mb=flush:32:32
compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer
directory=FSDirectory

doc.stored=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.tokenized=tok:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.term.vector=vec:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
doc.term.vector.offsets=tvo:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.term.vector.positions=tvp:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
doc.add.log.step=2000

docs.dir=reuters-out

doc.maker=org.apache.lucene.benchmark.byTask.feeds.ReutersDocMaker

query.maker=org.apache.lucene.benchmark.byTask.feeds.ReutersQueryMaker

# task at &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; depth or less would print when they start
task.max.depth.log=2

log.queries=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
# -------------------------------------------------------------------------------------

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;Rounds&quot;&lt;/span&gt;
      
    ResetSystemErase

        CreateIndex
        { &lt;span class=&quot;code-quote&quot;&gt;&quot;MAddDocs&quot;&lt;/span&gt; AddDoc(60) } : 20000
        Optimize
        CloseIndex
  
    OpenReader
      { &lt;span class=&quot;code-quote&quot;&gt;&quot;SrchTrvRetNewRdr&quot;&lt;/span&gt; SearchTravRet(10) &amp;gt; : 1000
    CloseReader
    OpenReader
      { &lt;span class=&quot;code-quote&quot;&gt;&quot;SearchHlgtSameRdr&quot;&lt;/span&gt; SearchTravRetHighlight(size[20],highlight[20],mergeContiguous[&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;],maxFrags[0],fields[body]) &amp;gt; : 1000

    CloseReader

    RepSumByPref SearchHlgtSameRdr

    NewRound

} : 2

RepSumByNameRound
RepSumByName
RepSumByPrefRound MAddDocs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    <comment id="12576781" author="doronc" created="Sun, 9 Mar 2008 15:22:22 +0000"  >&lt;p&gt;Ok I can see it now, you&apos;re right. &lt;br/&gt;
So all doc maker per rounds settings were ignored - first round settings were used. &lt;br/&gt;
I am updating TestPerfTasksLogic.testIndexWriterSettings() to catch this bug.&lt;br/&gt;
Thanks for catching this,&lt;br/&gt;
Doron&lt;/p&gt;</comment>
                    <comment id="12576782" author="doronc" created="Sun, 9 Mar 2008 15:24:56 +0000"  >&lt;p&gt;same fix + test case that fails without the fix.&lt;/p&gt;</comment>
                    <comment id="12576792" author="doronc" created="Sun, 9 Mar 2008 16:31:33 +0000"  >&lt;p&gt;QualityTest fails with previous patch, exposing a related bug in ReutersDocMaker,&lt;br/&gt;
of not reseting files list at call to setConfig(), Was not required before, but now since&lt;br/&gt;
setConfig is called more than once must clear the list of collected files.&lt;br/&gt;
Attached file fixes this and all benchmark tests pass.&lt;/p&gt;</comment>
                    <comment id="12576796" author="doronc" created="Sun, 9 Mar 2008 16:56:37 +0000"  >&lt;p&gt;Committed, thanks Mark!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12377484" name="reset_config.patch" size="5740" author="doronc" created="Sun, 9 Mar 2008 16:31:33 +0000" />
                    <attachment id="12377482" name="reset_config.patch" size="4157" author="doronc" created="Sun, 9 Mar 2008 15:24:56 +0000" />
                    <attachment id="12377415" name="reset_config.patch" size="571" author="markrmiller@gmail.com" created="Sat, 8 Mar 2008 02:21:32 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 8 Mar 2008 21:16:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12537</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26520</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>