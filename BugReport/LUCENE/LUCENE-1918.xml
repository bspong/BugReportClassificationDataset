<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 12:59:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1918/LUCENE-1918.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1918] Adding empty ParallelReader indexes to an IndexWriter may cause ArrayIndexOutOfBoundsException or NoSuchElementException</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1918</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Hi,&lt;br/&gt;
I recently stumbled upon this:&lt;/p&gt;

&lt;p&gt;It is possible (and perfectly legal) to add empty indexes (IndexReaders) to an IndexWriter. However, when using ParallelReaders in this context, in two situations RuntimeExceptions may occur for no good reason.&lt;/p&gt;

&lt;p&gt;Condition 1:&lt;br/&gt;
The indexes within the ParallelReader are just empty.&lt;/p&gt;

&lt;p&gt;When adding them to the IndexWriter, we get a java.util.NoSuchElementException triggered by ParallelTermEnum&apos;s constructor. The reason for that is the TreeMap#firstKey() method which was assumed to return null if there is no entry (which is not true, apparently &amp;#8211; it only returns null if the first key in the Map is null).&lt;/p&gt;


&lt;p&gt;Condition 2 (Assuming the aforementioned bug is fixed):&lt;br/&gt;
The indexes within the ParallelReader originally contained one or more fields with TermVectors, but all documents have been marked as deleted.&lt;/p&gt;

&lt;p&gt;When adding the indexes to the IndexWriter, we get a java.lang.ArrayIndexOutOfBoundsException triggered by TermVectorsWriter#addAllDocVectors. The reason here is that TermVectorsWriter assumes that if the index is marked to have TermVectors, at least one field actually exists for that. This unfortunately is not true, either.&lt;/p&gt;

&lt;p&gt;Patches and a testcase demonstrating the two bugs are provided.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Christian&lt;/p&gt;</description>
                <environment>&lt;p&gt;any&lt;/p&gt;</environment>
            <key id="12435999">LUCENE-1918</key>
            <summary>Adding empty ParallelReader indexes to an IndexWriter may cause ArrayIndexOutOfBoundsException or NoSuchElementException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="ck@newsclub.de">Christian Kohlsch&#252;tter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Sep 2009 22:23:30 +0100</created>
                <updated>Fri, 13 May 2011 19:21:10 +0100</updated>
                    <resolved>Fri, 18 Sep 2009 13:34:06 +0100</resolved>
                            <version>2.4.1</version>
                <version>2.9</version>
                                <fixVersion>2.4.1</fixVersion>
                <fixVersion>2.9</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                          <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                    <timeestimate seconds="1800">0.5h</timeestimate>
                                  <comments>
                    <comment id="12756798" author="ck@newsclub.de" created="Thu, 17 Sep 2009 22:25:00 +0100"  >&lt;p&gt;Testcase and bugfixes for trunk (should also be applicable to 2.4.1)&lt;/p&gt;</comment>
                    <comment id="12757079" author="mikemccand" created="Fri, 18 Sep 2009 10:34:49 +0100"  >&lt;p&gt;Patch looks good!  Thanks Christian.  Good catches!&lt;/p&gt;

&lt;p&gt;I made minor changes to it &amp;#8211; added CHANGES entry, fixed indentaiton, switched the test over to MockRAMDir (and closed them) and added checkIndex calls.&lt;/p&gt;</comment>
                    <comment id="12757080" author="mikemccand" created="Fri, 18 Sep 2009 10:35:09 +0100"  >&lt;p&gt;Mark, I think we should commit this for 2.9?&lt;/p&gt;</comment>
                    <comment id="12757090" author="thetaphi" created="Fri, 18 Sep 2009 11:28:33 +0100"  >&lt;p&gt;I have no problem with this. I think we need a new RC for sure because of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1919&quot; title=&quot;Analysis back compat break&quot;&gt;&lt;del&gt;LUCENE-1919&lt;/del&gt;&lt;/a&gt;, which is very tricky and it should be tested by public, who have for sure lot of old-styled TokenStreams.&lt;/p&gt;</comment>
                    <comment id="12757125" author="markrmiller@gmail.com" created="Fri, 18 Sep 2009 12:48:21 +0100"  >&lt;p&gt;Agreed - we are now stuck with a new rc it sounds, so let&apos;s fix what we can. &lt;/p&gt;</comment>
                    <comment id="12757138" author="mikemccand" created="Fri, 18 Sep 2009 13:34:06 +0100"  >&lt;p&gt;Thanks Christian!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12419998" name="LUCENE-1918.patch" size="7747" author="mikemccand" created="Fri, 18 Sep 2009 10:34:49 +0100" />
                    <attachment id="12419935" name="ParallelReaderWithEmptyIndex.patch" size="1741" author="ck@newsclub.de" created="Thu, 17 Sep 2009 22:25:00 +0100" />
                    <attachment id="12419934" name="ParallelReaderWithEmptyIndex-testcase.patch" size="3536" author="ck@newsclub.de" created="Thu, 17 Sep 2009 22:25:00 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 18 Sep 2009 09:34:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11850</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25807</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>