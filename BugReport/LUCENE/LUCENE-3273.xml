<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:18:20 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3273/LUCENE-3273.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3273] Convert Lucene Core tests over to a simple MockQueryParser</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3273</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Most tests use Lucene Core&apos;s QueryParser for convenience.  We want to consolidate it into a QP module which we can&apos;t have as a dependency.  We should add a simple MockQueryParser which does String.split() on the query string, analyzers the terms and builds a BooleanQuery if necessary.  Any more complex Queries (such as phrases) should be done programmatically. &lt;/p&gt;</description>
                <environment></environment>
            <key id="12512423">LUCENE-3273</key>
            <summary>Convert Lucene Core tests over to a simple MockQueryParser</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                    <parent id="12512420">LUCENE-3272</parent>
                        <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="cmale">Chris Male</assignee>
                                <reporter username="cmale">Chris Male</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Jul 2011 04:16:09 +0100</created>
                <updated>Fri, 10 May 2013 11:42:57 +0100</updated>
                    <resolved>Wed, 6 Jul 2011 01:08:45 +0100</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13059358" author="cmale" created="Mon, 4 Jul 2011 09:34:19 +0100"  >&lt;p&gt;Patch with first shot at this.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MockQueryParser is introduced.  It handles a very simple syntax consisting of boolean operators and can identify Wildcard queries.  Cannot handle complex BooleanQuerys, boosts or PhraseQuerys.&lt;/li&gt;
	&lt;li&gt;QueryBuilderHelper is introduced which provides some utilities methods for building queries (currently just to create a TermQuery with a boost)&lt;/li&gt;
	&lt;li&gt;BooleanQueryBuilder and PhraseQueryBuilder are introduced to ease the process of programmatically creating complex BooleanQuerys and PhraseQuerys.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All core Lucene tests (apart from those in the queryparser package) have been moved away from relying on QueryParser.  In extremely trivial situations, TermQuerys are now directly instantiated.  In others, the MockQueryParser is used.  In complex scenarios, the Builder classes are used to programmatically create the queries.&lt;/li&gt;
	&lt;li&gt;Some tests have been split up and moved around.  Tests that did both parsing assertions and search assertions have been split so the parsing assertions go into TestQueryParser (since they are testing the QPs supported language).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Next step is to visit the contrib tests and clear those out too, so we can prevent any back dependencies on the queryparser module.&lt;/p&gt;</comment>
                    <comment id="13059531" author="hossman" created="Mon, 4 Jul 2011 19:01:11 +0100"  >&lt;p&gt;I&apos;m in favor of eliminating the QueryParser dependency, but i feel like this approach of adding things like &quot;BooleanQueryBuilder&quot; leads us down the road towards tests that are so verbose in query construction it will draw attention away from the important parts of the test &amp;#8211; doing something with those queres.&lt;/p&gt;

&lt;p&gt;a while back when i wrote TestExplanations, i added a bunch of convenience methods for constructing esoteric queries that i couldn&apos;t get cleanly from the QueryParser (mainly spans) &amp;#8211; perhaps we should move towards generalizing that approach ... either in a Utility class where they can be staticly imported, or into LuceneTestCase?  These days we could even use vargs for things like Phrase, Boolean, and SpanNear queries (we weren&apos;t using Java5 when i wrote the existing ones)&lt;/p&gt;

&lt;p&gt;That way instead of things like this...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PhraseQuery q = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PhraseQuery(); &lt;span class=&quot;code-comment&quot;&gt;// Query &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; hi &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a test is&quot;&lt;/span&gt;
&lt;/span&gt;q.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term(&lt;span class=&quot;code-quote&quot;&gt;&quot;field&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;hi&quot;&lt;/span&gt;), 1);
q.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term(&lt;span class=&quot;code-quote&quot;&gt;&quot;field&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;), 5);

assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;field:\&quot;&lt;/span&gt;? hi ? ? ? test\&quot;&quot;, q.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...we could have ...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Query q = phraseQ(&lt;span class=&quot;code-quote&quot;&gt;&quot;field&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;hi&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;);

assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;field:\&quot;&lt;/span&gt;? hi ? ? ? test\&quot;&quot;, q.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And instead of this...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testDMQ8() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
  DisjunctionMaxQuery q = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DisjunctionMaxQuery(0.5f);
  q.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BooleanQueryBuilder(FIELD)
      .addTermQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;yy&quot;&lt;/span&gt;)
      .addQuery(QueryBuilderHelper.newTermQuery(FIELD, &lt;span class=&quot;code-quote&quot;&gt;&quot;w5&quot;&lt;/span&gt;, 100))
      .get());
  q.add(QueryBuilderHelper.newTermQuery(FIELD, &lt;span class=&quot;code-quote&quot;&gt;&quot;xx&quot;&lt;/span&gt;, 100000));
  qtest(q, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] { 0,2,3 });
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...we could have...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testDMQ8() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
  DisjunctionMaxQuery q = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DisjunctionMaxQuery(0.5f);
  q.add(booleanQ(opt(termQ(FIELD, &lt;span class=&quot;code-quote&quot;&gt;&quot;yy&quot;&lt;/span&gt;)), 
                 opt(termQ(FIELD, &lt;span class=&quot;code-quote&quot;&gt;&quot;w5&quot;&lt;/span&gt;, 100))));
  q.add(termQ(FIELD, &lt;span class=&quot;code-quote&quot;&gt;&quot;xx&quot;&lt;/span&gt;, 100000));
  qtest(q, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] { 0,2,3 });
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                    <comment id="13059532" author="rcmuir" created="Mon, 4 Jul 2011 19:06:14 +0100"  >&lt;p&gt;With all due respect hoss, i&apos;d rather have the former than the latter.&lt;/p&gt;

&lt;p&gt;The latter reminds me of solr tests which use this approach, I find them extremely painful to read.&lt;/p&gt;</comment>
                    <comment id="13059533" author="hossman" created="Mon, 4 Jul 2011 19:11:15 +0100"  >&lt;p&gt;to each his own i guess.&lt;/p&gt;

&lt;p&gt;I just think it makes sense for utilities that do the banal stuff that&apos;s not central to the actually methods being tested should be as short as possible and get the hell out of the way &amp;#8211; the code you actually want to test should be verbose and catch your eye.&lt;/p&gt;
</comment>
                    <comment id="13059537" author="rcmuir" created="Mon, 4 Jul 2011 19:35:42 +0100"  >&lt;p&gt;the difference here, is that I think in general the tests should use/look like the API.&lt;/p&gt;

&lt;p&gt;this makes them readable for people (e.g. new contributors) who already know lucene&apos;s API to&lt;br/&gt;
understand what the tests do.&lt;/p&gt;

&lt;p&gt;For example in the lucene tests we added various randomization, but we tried to make it look just like the API, except deleting a space:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;new IndexWriterConfig() -&amp;gt; newIndexWriterConfig()
new Directory() -&amp;gt; newDirectory()
new Field() -&amp;gt; newField()
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in some of these tests, I think its actually &lt;b&gt;way more clear&lt;/b&gt; to explicitly build the BQs and not use any builders or parsers, especially TestBoolean2 for example.&lt;/p&gt;

&lt;p&gt;I fear sometimes, people get caught up on &quot;more lines of code&quot; == bad. I think this is wrong, sometimes more lines of code is good.&lt;/p&gt;

&lt;p&gt;parsers, builder apis, and helper methods might reduce the number of lines of code, but they add additional layers and obfuscation that makes this a terrible tradeoff.&lt;/p&gt;</comment>
                    <comment id="13059538" author="mikemccand" created="Mon, 4 Jul 2011 19:36:38 +0100"  >&lt;p&gt;I would also prefer to keep tests very straightforward, even if that makes them more verbose.  Ie just use the Lucene core API, and if the core API is insufficient we should improve it.  I don&apos;t think we should be adding very much special test-only APIs.&lt;/p&gt;

&lt;p&gt;In fact, why even add a builder here for BQ?  Can&apos;t we just make the BQ and add the clauses?&lt;/p&gt;

&lt;p&gt;In general I&apos;m not a fan of builder APIs... I think they are over-applied these days (hammer!) and I don&apos;t think we need it here for our tests.&lt;/p&gt;</comment>
                    <comment id="13059543" author="rcmuir" created="Mon, 4 Jul 2011 19:51:36 +0100"  >&lt;p&gt;here&apos;s my example, TestBoolean2.&lt;/p&gt;

&lt;p&gt;in my opinion building the queries like this makes the test much more readable.&lt;/p&gt;

&lt;p&gt;it adds 48 lines and deletes 29 lines of code... &lt;/p&gt;

&lt;p&gt;I think adding these 19 lines of code to this 343 line test case is worth every penny, because its much easier to see what any given test does, e.g. just glance real quick at testQueries06 and you see its a BQ with one MUST and two MUST_NOTS, no parsing by the brain required.&lt;/p&gt;</comment>
                    <comment id="13059576" author="hossman" created="Mon, 4 Jul 2011 20:09:53 +0100"  >&lt;blockquote&gt;&lt;p&gt;In general I&apos;m not a fan of builder APIs... I think they are over-applied these days (hammer!) &lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;I think adding these 19 lines of code to this 343 line test case is worth every penny, because its much easier to see what any given test does, e.g. just glance real quick at testQueries06 and you see its a BQ with one MUST and two MUST_NOTS, no parsing by the brain required.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;i don&apos;t disagree with either of you.  particularly in this test where the whole point is testing BooleanQueries &amp;#8211; so lets actually have the test showing the construction of a BooleanQuery.&lt;/p&gt;

&lt;p&gt;my point was more about tests where the construction of the Query object is ancillary to what the test is actually for.&lt;/p&gt;

&lt;p&gt;that said: definitely in agreement that using the core api and constructing the queries right in the test leaves no room for ambiguity &amp;#8211; my main point was that if we&apos;re going to have &quot;builders&quot; to simplify the tests, let&apos;s make them short and terse like the QP syntax that use to be in those tests.&lt;/p&gt;</comment>
                    <comment id="13059579" author="rcmuir" created="Mon, 4 Jul 2011 20:14:54 +0100"  >&lt;p&gt;after reviewing the core tests, I think there is really not that many tests using the queryparser at all.&lt;/p&gt;

&lt;p&gt;in fact it seems the only &apos;non-trivial&apos; queries being built are inside the explanations tests (e.g. more than just a term, boolean, or phrase or whatever), if these are too laborious to make manually, maybe we can just have whatever is needed in the base TestExplanations... but I think it would be good to build queries directly in most places in general.&lt;/p&gt;</comment>
                    <comment id="13059642" author="cmale" created="Tue, 5 Jul 2011 01:01:11 +0100"  >&lt;p&gt;In defence of builders, its a great design pattern and I don&apos;t agree that its over-applied.&lt;/p&gt;

&lt;p&gt;With all that said, I&apos;ll move away from them.&lt;/p&gt;</comment>
                    <comment id="13059663" author="cmale" created="Tue, 5 Jul 2011 03:30:21 +0100"  >&lt;p&gt;New patch, new ideas.&lt;/p&gt;

&lt;p&gt;I&apos;ve moved away from introducing anything new and have converted all the core tests over to instantiating Queries programmatically.  No builders / helpers are used.&lt;/p&gt;

&lt;p&gt;Everything compiles and passes again.&lt;/p&gt;</comment>
                    <comment id="13059823" author="mikemccand" created="Tue, 5 Jul 2011 11:27:23 +0100"  >&lt;p&gt;Thanks Chris!  Patch looks great.&lt;/p&gt;</comment>
                    <comment id="13060210" author="cmale" created="Wed, 6 Jul 2011 01:08:45 +0100"  >&lt;p&gt;Committed revision 1143231.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12485193" name="LUCENE-3273.patch" size="93330" author="cmale" created="Tue, 5 Jul 2011 03:30:21 +0100" />
                    <attachment id="12485122" name="LUCENE-3273.patch" size="75466" author="cmale" created="Mon, 4 Jul 2011 09:34:19 +0100" />
                    <attachment id="12485174" name="LUCENE-3273_testboolean2.patch" size="6252" author="rcmuir" created="Mon, 4 Jul 2011 19:51:35 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 4 Jul 2011 18:01:11 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10732</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24423</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>