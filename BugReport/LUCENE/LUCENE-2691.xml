<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:34:11 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2691/LUCENE-2691.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2691] Consolidate Near Real Time and Reopen API semantics</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2691</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;We should consolidate the IndexWriter.getReader and the IndexReader.reopen semantics, since most people are already using the IR.reopen() method, we should simply add::&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
IR.reopen(IndexWriter)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Initially, it could just call the IW.getReader(), but it probably should switch to just using package private methods for sharing the internals&lt;/p&gt;</description>
                <environment></environment>
            <key id="12476927">LUCENE-2691</key>
            <summary>Consolidate Near Real Time and Reopen API semantics</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="gsingers">Grant Ingersoll</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Oct 2010 15:27:32 +0100</created>
                <updated>Wed, 30 Mar 2011 16:49:58 +0100</updated>
                    <resolved>Thu, 20 Jan 2011 19:06:50 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12919498" author="mikemccand" created="Sat, 9 Oct 2010 15:48:17 +0100"  >&lt;p&gt;+1!&lt;/p&gt;</comment>
                    <comment id="12919499" author="gsingers" created="Sat, 9 Oct 2010 16:14:04 +0100"  >&lt;p&gt;What&apos;s with all of the test dependencies on IndexWriter.getReader() that seemingly don&apos;t have anything to do with NRT?  For instance, TestQueryParser.testPositionIncrements() or TestCachingSpanFilter?  &lt;/p&gt;

&lt;p&gt;If we insist on those, then it seems we&apos;ll have to add an IndexReader.open(IndexWriter) method (plus, I suppose a couple of variations).  This concerns me b/c there are already more than enough variations on that method, but what&apos;s one more?&lt;/p&gt;</comment>
                    <comment id="12919503" author="mikemccand" created="Sat, 9 Oct 2010 16:55:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s with all of the test dependencies on IndexWriter.getReader() that seemingly don&apos;t have anything to do with NRT? For instance, TestQueryParser.testPositionIncrements() or TestCachingSpanFilter?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is just because those tests need a reader having just built the index... ie, as long as there&apos;s no other reason to .commit, getting the reader from the writer is perfectly fine.&lt;/p&gt;

&lt;p&gt;Plus this only increases test coverage of NRT.&lt;/p&gt;

&lt;p&gt;RandomIndexWriter&apos;s .getReader method now randomly picks to either get the reader from the writer, or, to .commit and then open a new reader.&lt;/p&gt;</comment>
                    <comment id="12919504" author="mikemccand" created="Sat, 9 Oct 2010 16:56:03 +0100"  >&lt;blockquote&gt;&lt;p&gt;we&apos;ll have to add an IndexReader.open(IndexWriter) method (plus, I suppose a couple of variations). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I think IR.open(IW) makes sense.&lt;/p&gt;</comment>
                    <comment id="12919509" author="gsingers" created="Sat, 9 Oct 2010 17:28:36 +0100"  >&lt;p&gt;Patch that makes the change.  Adds open and reopen methods to IndexReader while making it package protected on IndexWriter.&lt;/p&gt;

&lt;p&gt;Should be good to go, but may need a few doc improvements.&lt;/p&gt;</comment>
                    <comment id="12919533" author="mikemccand" created="Sat, 9 Oct 2010 20:33:44 +0100"  >&lt;p&gt;patch looks great Grant!&lt;/p&gt;

&lt;p&gt;I think we don&apos;t need the IR.open that takes a termInfosIndexDivisor... and we also don&apos;t need the IW.getReader that takes one too.  We had added these before adding IWC.set/getReaderTermsIndexDivisor...&lt;/p&gt;</comment>
                    <comment id="12919568" author="simonw" created="Sun, 10 Oct 2010 06:01:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;Should be good to go, but may need a few doc improvements.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think docs are fine though at least what I read on IR but I wonder why we need to synchronize on the iIR here since this call only forwards to the given writer? &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; IndexReader reopen(IndexWriter writer) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CorruptIndexException, IOException {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; writer.getReader();
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would guess calling writer.getReader() in there should not block other actions like concurrent searches on this reader since a NRT getRearder call can take its time. If at all we should sync on the writer though (which is already done inside IW) or do I miss something?&lt;/p&gt;</comment>
                    <comment id="12919591" author="gsingers" created="Sun, 10 Oct 2010 12:31:42 +0100"  >&lt;p&gt;Simon, I think you are right, as the necessary sync blocks are in the underlying getReader() call on IW.  I just copied the signatures.  I will put up a new patch.&lt;/p&gt;</comment>
                    <comment id="12919596" author="gsingers" created="Sun, 10 Oct 2010 13:01:26 +0100"  >&lt;p&gt;Ready to go.&lt;/p&gt;</comment>
                    <comment id="12919620" author="simonw" created="Sun, 10 Oct 2010 17:55:24 +0100"  >&lt;blockquote&gt;&lt;p&gt;Ready to go.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 looks good to me&lt;/p&gt;</comment>
                    <comment id="12919690" author="gsingers" created="Mon, 11 Oct 2010 01:17:29 +0100"  >&lt;p&gt;Committed revision 1006280.&lt;/p&gt;</comment>
                    <comment id="12920565" author="earwin" created="Wed, 13 Oct 2010 14:58:29 +0100"  >&lt;p&gt;What&apos;s up with intentionally twisted APIs?&lt;/p&gt;

&lt;p&gt;The method you introduced makes it perfectly fine to open a reader on some directory, and then try reopening it on IW, and then on another IW. Later you&apos;re going to add a heap of guards on this method, and runtime exceptions if user does some pointless reopen sequence?&lt;/p&gt;

&lt;p&gt;What was wrong with old parameterless reopen() call?&lt;br/&gt;
If you&apos;ve got a reader over Directory, it reopens looking for new segments there, if you got a reader from IW, it reopens by asking said IW for the segments.&lt;/p&gt;</comment>
                    <comment id="12920581" author="yseeley@gmail.com" created="Wed, 13 Oct 2010 15:27:41 +0100"  >&lt;p&gt;I think I agree Earwin... it&apos;s not clear what functionality was added with this patch, just a vague notion of consolidating semantics.  Adding more ways to do the same thing in this case just seems to complicate the API.&lt;/p&gt;</comment>
                    <comment id="12920583" author="gsingers" created="Wed, 13 Oct 2010 15:36:54 +0100"  >&lt;blockquote&gt;&lt;p&gt;The method you introduced makes it perfectly fine to open a reader on some directory, and then try reopening it on IW, and then on another IW. Later you&apos;re going to add a heap of guards on this method, and runtime exceptions if user does some pointless reopen sequence?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t see that.  All we did was move the call from IW to IR where the reopen method was already located.  Nothing is preventing a user from doing exactly what you described above with the old way either.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What was wrong with old parameterless reopen() call?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nothing.  That&apos;s why it is still there.  This is about user comprehension and usability of the API, not about some functionality.  Having trained hundreds of people on this, it&apos;s confusing to people (just like it&apos;s confusing that a &quot;Reader&quot; can do deletes).  Why would a Writer object give me a Reader?  Why would a Reader do write functionality?  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if you got a reader from IW, it reopens by asking said IW for the segments.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, and if you (re)open a Reader with an IW you get a Reader based on those segments.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Adding more ways to do the same thing in this case just seems to complicate the API. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We didn&apos;t add any more ways to do this.  The exact same number of ways exist now.  All we&apos;ve done is kept Reader semantics on the Reader and Writer semantics on the Writer.  &lt;/p&gt;</comment>
                    <comment id="12920586" author="gsingers" created="Wed, 13 Oct 2010 15:38:57 +0100"  >&lt;p&gt;I guess, however, to assuage you guys, perhaps we could drop the reopen(IW) all together and just have IR.open(IW).  That satisfies my semantic/explanation need.  Although, I would suspect that over time, reopen(IW) could still make sense.&lt;/p&gt;</comment>
                    <comment id="12920592" author="earwin" created="Wed, 13 Oct 2010 16:00:18 +0100"  >&lt;p&gt;Okay, let&apos;s go at it with an example.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Directory d = Directory.open(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/somewhere&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// Nice
&lt;/span&gt;IndexReader r = IndexReader.open(d); &lt;span class=&quot;code-comment&quot;&gt;// Nice
&lt;/span&gt;
Directory d2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RAMDirectory(); &lt;span class=&quot;code-comment&quot;&gt;// Okay
&lt;/span&gt;IndexWriter w = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IndexWriter(d2); &lt;span class=&quot;code-comment&quot;&gt;// Sure
&lt;/span&gt;
r = r.reopen(w) &lt;span class=&quot;code-comment&quot;&gt;// WTF?!&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Parameterless reopen does not allow you to &quot;rebase&quot; IndexReader, an overload you introduced with this patch - allows this.&lt;br/&gt;
I&apos;m somewhat okay with IR.open(iw). Despite being questionable it is at least not frikkin&apos; broken like ir.reopen(iw).&lt;/p&gt;</comment>
                    <comment id="12920593" author="gsingers" created="Wed, 13 Oct 2010 16:03:28 +0100"  >&lt;p&gt;Again, how is that any different?  You are getting back a new Reader and assigning it to the same variable name.  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Directory d = Directory.open(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/somewhere&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// Nice
&lt;/span&gt;IndexReader r = IndexReader.open(d); &lt;span class=&quot;code-comment&quot;&gt;// Nice
&lt;/span&gt;
Directory d2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RAMDirectory(); &lt;span class=&quot;code-comment&quot;&gt;// Okay
&lt;/span&gt;IndexWriter w = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IndexWriter(d2); &lt;span class=&quot;code-comment&quot;&gt;// Sure
&lt;/span&gt;
r = w.getReader() &lt;span class=&quot;code-comment&quot;&gt;// WTF Indeed!&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                    <comment id="12920596" author="gsingers" created="Wed, 13 Oct 2010 16:09:17 +0100"  >&lt;p&gt;The semantics of reopen is you get a new Reader.  If an optimize was done between open and reopen of the IR, you are getting an all new Reader.  Should that get rid of reopen, too?&lt;/p&gt;

&lt;p&gt;As I said above, though, I&apos;m fine w/ dropping the reopen one and just keeping open(IW).  I care more about the fact that it is non-intuitive to ask a Writer for a Reader and this silly notion we have right now that if you want &quot;fast reopen&quot; you should reopen off of the IR, but if you want &quot;really fast reopen&quot; you should open off the Writer.  In fact, maybe we should just drop reopen all together and simply have all points go through the open() method, by adding:  open(IndexReader)&lt;/p&gt;
</comment>
                    <comment id="12920601" author="earwin" created="Wed, 13 Oct 2010 16:19:41 +0100"  >&lt;blockquote&gt;&lt;p&gt;As I said above, though, I&apos;m fine w/ dropping the reopen one and just keeping open(IW). &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Let&apos;s do this.&lt;/p&gt;

&lt;p&gt;In my ideal world the semantics of each method is encoded in its name.&lt;br/&gt;
So &apos;open&apos; - always gets you a brand new reader on a given target, while &apos;reopen&apos; updates the one you have.&lt;br/&gt;
Due to snapshot nature of readers, you don&apos;t do update inplace and get a new instance instead, but that doesn&apos;t make these two methods&apos; semantics the same.&lt;/p&gt;</comment>
                    <comment id="12920608" author="gsingers" created="Wed, 13 Oct 2010 16:29:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;So &apos;open&apos; - always gets you a brand new reader on a given target, while &apos;reopen&apos; updates the one you have.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It doesn&apos;t update the one you have.  You do get a new instance and you have to properly close the old one (see &lt;a href=&quot;http://lucene.apache.org/java/3_0_2/api/core/org/apache/lucene/index/IndexReader.html#reopen%28%29&quot; class=&quot;external-link&quot;&gt;http://lucene.apache.org/java/3_0_2/api/core/org/apache/lucene/index/IndexReader.html#reopen%28%29&lt;/a&gt;).  It is not just &quot;updating&quot; the internal memory of the old one, it is instead transferring that internal memory to a new instance and combining it with any changed segments.  To me, that&apos;s what the IW case feels like too.&lt;/p&gt;
</comment>
                    <comment id="12920635" author="yseeley@gmail.com" created="Wed, 13 Oct 2010 17:12:14 +0100"  >&lt;blockquote&gt;&lt;p&gt;Again, how is that any different? You are getting back a new Reader and assigning it to the same variable name. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You could defend BitSet.doSomethingFunky(IndexReader reader, IndexWriter writer) with that same logic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
It&apos;s not about functionality (this patch doesn&apos;t add any functionality), it&apos;s about API.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t update the one you have.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Earwin knows that - he even said &quot;Due to snapshot nature of readers, you don&apos;t do update inplace and get a new instance instead&quot;.&lt;/p&gt;

&lt;p&gt;I also agree with the statement: &quot;So &apos;open&apos; - always gets you a brand new reader on a given target, while &apos;reopen&apos; updates the one you have.&quot;  It&apos;s a logical update of the reader, hence the added reopen() method makes no sense.&lt;/p&gt;</comment>
                    <comment id="12925913" author="mikemccand" created="Thu, 28 Oct 2010 19:59:32 +0100"  >&lt;p&gt;Reopen until we settle the API question...&lt;/p&gt;</comment>
                    <comment id="12933803" author="mikemccand" created="Fri, 19 Nov 2010 13:38:47 +0000"  >&lt;p&gt;I also think we shouldn&apos;t add a reopen(IW) here, since you can just IR.open(IW) and then call its .reopen().  It&apos;s confusing to IR.open(Dir) and then later IR.reopen(IW) on it.&lt;/p&gt;</comment>
                    <comment id="12935347" author="gsingers" created="Wed, 24 Nov 2010 15:03:21 +0000"  >&lt;p&gt;I don&apos;t have a problem with it, but I don&apos;t see how it is any more confusing that reopening on a IndexCommit.  In my mind, the thing you are reopening is a set of segments.  Unfortunately, we don&apos;t have a access in a clean way to get  the IndexWriter&apos;s segment, so we pass in the IW.  The whole point of IR.reopen is you are getting a new reader on an index.  Presumably, the IW is on the same Directory, just like presumably the CommitPoint is on the same Directory. &lt;/p&gt;</comment>
                    <comment id="12935395" author="mikemccand" created="Wed, 24 Nov 2010 16:46:43 +0000"  >&lt;p&gt;OK, I agree &amp;#8211; the analogy to reopen on an IndexCommit makes sense: you are simply reopening the reader on a different set of segments.  So IW is just being used (abused) as a &quot;proxy&quot; for the &quot;current live segments on the index&quot;.&lt;/p&gt;</comment>
                    <comment id="12935569" author="earwin" created="Wed, 24 Nov 2010 23:29:13 +0000"  >&lt;p&gt;You&apos;re still okay with an API that allows you to reopen IRs on different directories?&lt;br/&gt;
Let us introduce then, instead of bothering with APIs, a single class with method &apos;void doStuff(Object... args)&apos; that, inside, has an elaborate logic validating and interpreting said arguments and then doing a fat switch to execute corresponding computations.&lt;/p&gt;

&lt;p&gt;I think reopen should have no parameters, and IR.reopen(IC) moved elsewhere.&lt;/p&gt;

&lt;p&gt;I&apos;d personally like to see a special subclass of DIR that is returned from IW.getReader(), that knows about specifics of being opened over an active writer.&lt;br/&gt;
Something along the lines of - &lt;a href=&quot;https://gist.github.com/d5a197a001c24fccb1b5&quot; class=&quot;external-link&quot;&gt;https://gist.github.com/d5a197a001c24fccb1b5&lt;/a&gt;&lt;br/&gt;
This also removes said specifics in form of of stupid if-checks and unnecessary fields from actual DIR. Modes should be done with subclasses, not switches, dammit! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;If we allow reopen to switch readers between modes, we&apos;re introducing yet more checking and switching around.&lt;br/&gt;
Also we&apos;ll get irreversible circular dependency between readers and writers, which is also a sign of things going wrong.&lt;/p&gt;</comment>
                    <comment id="12935767" author="mikemccand" created="Thu, 25 Nov 2010 14:13:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;You&apos;re still okay with an API that allows you to reopen IRs on different directories?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, that&apos;s no good - we can catch this and throw an exc?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think reopen should have no parameters, and IR.reopen(IC) moved elsewhere.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But where would you move IR.reopen(IC)?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d personally like to see a special subclass of DIR that is returned from IW.getReader(), that knows about specifics of being opened over an active writer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds great!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If we allow reopen to switch readers between modes, we&apos;re introducing yet more checking and switching around.&lt;br/&gt;
Also we&apos;ll get irreversible circular dependency between readers and writers, which is also a sign of things going wrong.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Really, there are two separate &quot;things&quot; open/reopen needs:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The SegmentInfos &amp;#8211; either by finding the latest &amp;amp; greatest in the&lt;br/&gt;
    Directory, latest &amp;amp; greatest via IW, or explicitly via an&lt;br/&gt;
    IndexCommit.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;A prior pool of readers so that anything needing a reader (IW&lt;br/&gt;
    doing a merge, IW applying deletes, app opening new readers, etc.)&lt;br/&gt;
    can re-use any already open sub readers.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Maybe we can split these out.&lt;/p&gt;

&lt;p&gt;EG we&apos;ve wanted for a while now to factor out the reader pool hidden&lt;br/&gt;
inside IW.  If we did this, and then allowed optionally passing a pool&lt;br/&gt;
to IR.open, I think we could do away with IR.reopen entirely?  We&apos;d&lt;br/&gt;
have variants of IR.open taking IW, Dir, IndexCommit, to say where the&lt;br/&gt;
SegmentInfos come from, and then optionally also taking the explicit&lt;br/&gt;
reader pool.&lt;/p&gt;
</comment>
                    <comment id="12935772" author="eksdev" created="Thu, 25 Nov 2010 14:44:12 +0000"  >&lt;p&gt;strictly speaking not really this issue, but somehow fits into discussion about  IR.reopen() semantics.&lt;/p&gt;

&lt;p&gt;What would be the best way to support the following case? (Imo, very often needed. )&lt;/p&gt;


&lt;p&gt;Directory d = FSDirectory.open(&quot;/path/to/somewhere&quot;); // Nice&lt;br/&gt;
d_ram = RAMDirectory(d); &lt;br/&gt;
r_ram = IndexReader.open(d_ram);  &lt;br/&gt;
r_ram.reload(); //Here we want to reload from the  FSDirecotory?&lt;/p&gt;

&lt;p&gt;Point being, reload need not only IR/IW semantics consideration, but Directory as well.&lt;/p&gt;

&lt;p&gt;Does this make sense?&lt;br/&gt;
A solution that looks doable would be to have &quot;DiskBoundRAMDirectory extends RAMDirectory&quot;, that would remain read-only and keep a reference to FSDirectory (or whatewer Directory). &lt;br/&gt;
What is missing is a &quot;signal&quot; from IR.reload() to RAMdirectory to slurp fresh information from FSDirecory? &lt;/p&gt;


</comment>
                    <comment id="12935794" author="earwin" created="Thu, 25 Nov 2010 16:58:39 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;You&apos;re still okay with an API that allows you to reopen IRs on different directories?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Well, that&apos;s no good - we can catch this and throw an exc?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t understand why should we bother with checking and throwing exceptions, when we can prevent such things from compiling at all.&lt;br/&gt;
By using an API, that doesn&apos;t support reopening on anything different from original source.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Really, there are two separate &quot;things&quot; open/reopen needs:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s not true. Take a look at my WriterBackedReader above (or DirectoryReader in trunk). It requires writer at least to call deleteUnusedFiles(), nrtIsCurrent().&lt;br/&gt;
So you can&apos;t easily reopen between Directory-backed and Writer-backed readers without much switching and checking.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;r_ram.reload(); //Here we want to reload from the FSDirecotory?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Use MMapDirectory? It&apos;s only a bit slower for searches, while not raping your GC on big indexes.&lt;br/&gt;
Also check this out - &lt;a href=&quot;https://gist.github.com/715617&quot; class=&quot;external-link&quot;&gt;https://gist.github.com/715617&lt;/a&gt; , it is a RAMDirectory offspring that wraps any other given directory and basically does what you want (if I guessed right).&lt;br/&gt;
It doesn&apos;t use blocking for files, so file size limit is 2Gb, but this can be easily fixed. On the up side - it reads file into memory only after the size is known (unlike RAMDir), which allows you to use huge precisely-sized blocks, lessening GC pressure.&lt;br/&gt;
I used it for a long time, but then my indexes grew, heaps followed, VM exploded and I switched to MMapDirectory (with minor patches).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What is missing is a &quot;signal&quot; from IR.reload() to RAMdirectory to slurp fresh information from FSDirecory? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is zero need for any such signal. If a reader requests non-existing file from RAMDirectory, it should check backing dir before throwing exception. If backing dir does have the file - it is loaded and opened.&lt;br/&gt;
Why do you people love complicating things that much? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12984282" author="mikemccand" created="Thu, 20 Jan 2011 16:58:33 +0000"  >&lt;p&gt;We should backport this to 3.1?&lt;/p&gt;</comment>
                    <comment id="12984302" author="mikemccand" created="Thu, 20 Jan 2011 17:42:23 +0000"  >&lt;p&gt;I&apos;ll backport...&lt;/p&gt;</comment>
                    <comment id="13013319" author="gsingers" created="Wed, 30 Mar 2011 16:49:58 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12456803" name="LUCENE-2691.patch" size="17769" author="gsingers" created="Sun, 10 Oct 2010 13:01:26 +0100" />
                    <attachment id="12456775" name="LUCENE-2691.patch" size="16201" author="gsingers" created="Sat, 9 Oct 2010 17:28:36 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 9 Oct 2010 14:48:17 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11153</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25001</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>