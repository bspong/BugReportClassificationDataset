<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:12:32 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1979/LUCENE-1979.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1979] Remove remaining deprecations from indexer package</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1979</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description></description>
                <environment></environment>
            <key id="12437990">LUCENE-1979</key>
            <summary>Remove remaining deprecations from indexer package</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="michaelbusch">Michael Busch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2009 17:46:24 +0100</created>
                <updated>Wed, 25 Nov 2009 16:47:55 +0000</updated>
                    <resolved>Wed, 14 Oct 2009 22:25:56 +0100</resolved>
                                            <fixVersion>3.0</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12765308" author="michaelbusch" created="Wed, 14 Oct 2009 00:45:12 +0100"  >&lt;p&gt;Removes almost all deprecations from the indexer package. The only things left are:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;IndexReader#getFieldCacheKey() - what do we do with that one?&lt;/li&gt;
	&lt;li&gt;calls to IndexInput#readChars() and #skipChars() - I think we have to keep those until 4.0?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All core &amp;amp; contrib tests pass. It&apos;d be good if someone could review this patch though.&lt;/p&gt;</comment>
                    <comment id="12765316" author="mikemccand" created="Wed, 14 Oct 2009 00:57:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;IndexReader#getFieldCacheKey() - what do we do with that one?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we should undeprecate it.  I had deprecated it thinking &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-831&quot; title=&quot;Complete overhaul of FieldCache API/Implementation&quot;&gt;LUCENE-831&lt;/a&gt; would land.&lt;/p&gt;</comment>
                    <comment id="12765320" author="michaelbusch" created="Wed, 14 Oct 2009 01:05:32 +0100"  >&lt;p&gt;OK, will do!&lt;/p&gt;</comment>
                    <comment id="12765323" author="michaelbusch" created="Wed, 14 Oct 2009 01:09:04 +0100"  >&lt;p&gt;Patch for the back-compat trunk.&lt;/p&gt;

&lt;p&gt;Hmm, everything passes, except this one:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] java.lang.NoSuchMethodError: org.apache.lucene.index.SnapshotDeletionPolicy.snapshot()Lorg/apache/lucene/index/IndexCommitPoint;
    [junit] 	at org.apache.lucene.TestSnapshotDeletionPolicy.testReuseAcrossWriters(TestSnapshotDeletionPolicy.java:82)
    [junit] 	at org.apache.lucene.util.LuceneTestCase.runBare(LuceneTestCase.java:206)
    [junit] Test org.apache.lucene.TestSnapshotDeletionPolicy FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here drop-in replacement doesn&apos;t seem to work. The method snapshot() of SnapshotDeletionPolicy was changed to return IndexCommit instead of IndexCommitPoint. IndexCommit used to implement the deprecated IndexCommitPoint, which this patch removes.&lt;/p&gt;

&lt;p&gt;So the tests are compiled against snapshot() returning IndexCommitPoint in the bw-branch, and when run against the method returning IndexCommit of trunk it fails with the exception above.&lt;/p&gt;</comment>
                    <comment id="12765330" author="michaelbusch" created="Wed, 14 Oct 2009 01:22:00 +0100"  >&lt;p&gt;Same patch as before, but with IndexReader#getFieldCacheKey() undeprecated.&lt;/p&gt;

&lt;p&gt;Is it correct that we keep IndexInput#readChars() and IndexInput#skipChars() for index format compatibility?&lt;/p&gt;</comment>
                    <comment id="12765336" author="mikemccand" created="Wed, 14 Oct 2009 01:28:59 +0100"  >&lt;blockquote&gt;&lt;p&gt;Is it correct that we keep IndexInput#readChars() and IndexInput#skipChars() for index format compatibility?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, we need to keep them.&lt;/p&gt;

&lt;p&gt;It was in 2.4 (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-510&quot; title=&quot;IndexOutput.writeString() should write length in bytes&quot;&gt;&lt;del&gt;LUCENE-510&lt;/del&gt;&lt;/a&gt;) when we switched to writing strings as UTF8, so any index created by eg 2.3 (which we must be able to read through at least 3.9) will need these methods.&lt;/p&gt;</comment>
                    <comment id="12765338" author="michaelbusch" created="Wed, 14 Oct 2009 01:33:44 +0100"  >&lt;p&gt;OK, thanks for the confirmation. Then this patch removes all deprecations in indexer now.&lt;/p&gt;

&lt;p&gt;I&apos;ll wait for comments about the back-compat patch from Uwe first. If I mess up the bw-branch again I&apos;m afraid he&apos;ll get mad at me! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12765407" author="thetaphi" created="Wed, 14 Oct 2009 06:44:40 +0100"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;I see no problem in bw patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; One other thing: Can you apply the undeprecations also to 2.9 branch? (Like I did yesterday for the Searchable one).&lt;/p&gt;</comment>
                    <comment id="12765408" author="michaelbusch" created="Wed, 14 Oct 2009 06:48:09 +0100"  >&lt;p&gt;Hi Uwe, &lt;/p&gt;

&lt;p&gt;thanks for taking a look here. However, there &lt;b&gt;is&lt;/b&gt; a problem. Please see my previous comment with the exception I&apos;m getting when running test-tag. It seems like I have to commit the change to SnapshotDeletionPolicy#snaphot() also to the bw branch.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Can you apply the undeprecations also to 2.9 branch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will do!&lt;/p&gt;</comment>
                    <comment id="12765414" author="thetaphi" created="Wed, 14 Oct 2009 06:58:58 +0100"  >&lt;p&gt;There are two possibilities:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Changing the backwards branch main code to change this method&lt;/li&gt;
	&lt;li&gt;remove this test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think both possibilities has pros and cons, I tend to the first, because: As you changed the method also in 3.0 trunk, you have to put a backwards incompatibility entry into changes.txt (because we have detected it with the test). In this case it is also valid to change the bw branch code and not only tests.&lt;/p&gt;

&lt;p&gt;(I only looked over the patch, but didn&apos;t test it, to find the same things like yesterday. Didn&apos;t read all the comments, sorry).&lt;/p&gt;</comment>
                    <comment id="12765416" author="michaelbusch" created="Wed, 14 Oct 2009 07:01:54 +0100"  >&lt;p&gt;Well IndexCommitPoint was deprecated, so I think this is an expected break - so I don&apos;t think an entry in CHANGES.txt is necessary?&lt;/p&gt;

&lt;p&gt;I&apos;m also for the first option. Will do that.&lt;/p&gt;</comment>
                    <comment id="12765417" author="thetaphi" created="Wed, 14 Oct 2009 07:06:43 +0100"  >&lt;p&gt;I would add the change in CHANGES.txt, too. Its only one line like: &quot;Changed return value of snapshot() from X to Y&quot;. Because, if you use it, you cannot do drop in replacements, what you are able to do if you remove all deprecated code from your app in 2.9.&lt;/p&gt;</comment>
                    <comment id="12765425" author="michaelbusch" created="Wed, 14 Oct 2009 07:42:13 +0100"  >&lt;p&gt;Committed revision 825022.&lt;/p&gt;</comment>
                    <comment id="12765427" author="michaelbusch" created="Wed, 14 Oct 2009 07:42:57 +0100"  >&lt;p&gt;Also added an appropriate entry to the bw breaks section of CHANGES.txt.&lt;/p&gt;</comment>
                    <comment id="12765433" author="thetaphi" created="Wed, 14 Oct 2009 07:54:54 +0100"  >&lt;p&gt;I think you missed to delete IndexComitPoint in SVN.&lt;/p&gt;</comment>
                    <comment id="12765435" author="thetaphi" created="Wed, 14 Oct 2009 08:03:42 +0100"  >&lt;p&gt;I think there are some more deprecations (hidden). A search on deprecated finds some more files. E.g.:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;allowMinus1Position in IndexWriter, DocumentsWriter, DocInverterPerField (field and methods, not correctly marked deprecated).&lt;/li&gt;
	&lt;li&gt;Also IndexReader has still lots of deprecations (e.g. doCommit())&lt;/li&gt;
	&lt;li&gt;CheckIndex#PrintStream&lt;/li&gt;
	&lt;li&gt;some MergePolicy methods&lt;/li&gt;
	&lt;li&gt;IndexWriter#DEFAULT_MERGE_FACTOR, DEFAULT_MAX_MERGE_DOCS, docCount(), abort(), addIndexes()&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    <comment id="12765454" author="michaelbusch" created="Wed, 14 Oct 2009 09:00:13 +0100"  >&lt;p&gt;For now I fixed all those that the compiler showed me as warnings.&lt;/p&gt;

&lt;p&gt;I think we should do a text search for &quot;deprecated&quot; on the entire core after the compiler warnings are removed.&lt;/p&gt;

&lt;p&gt;But not now, going to bed...&lt;/p&gt;</comment>
                    <comment id="12765459" author="thetaphi" created="Wed, 14 Oct 2009 09:07:36 +0100"  >&lt;p&gt;javac only shows a warning, if you override a deprecated method and not deprecate it or if you use a deprecated method. But it does not tell you that there are deprecated methods declared.&lt;/p&gt;

&lt;p&gt;I will post a patch with the rest removed.&lt;/p&gt;</comment>
                    <comment id="12765483" author="thetaphi" created="Wed, 14 Oct 2009 10:28:55 +0100"  >&lt;p&gt;Here the patch for the rest. It also needs a changed backwards branch. It also adds varargs to some of the addIndexes methods. We should look at other places, too, where to add varargs, too (e.g. IndexSearcher, MultiSearcher,...)&lt;/p&gt;

&lt;p&gt;I have to leave now to Zurich will be back on Friday, but may have some time to look further into it. Michael, can you check the whole patch, I am on a hurry and was not able to test everything (trunk, trunk-contrib, bw).&lt;/p&gt;</comment>
                    <comment id="12765593" author="thetaphi" created="Wed, 14 Oct 2009 16:29:49 +0100"  >&lt;p&gt;My patch has a bug in TestTermVectorAccessor in contrib/misc (rewrite from deprec TermEnum.skip). I do not know whats wrong. Maybe you can fix it, I can look after it later in the evening.&lt;/p&gt;</comment>
                    <comment id="12765610" author="michaelbusch" created="Wed, 14 Oct 2009 17:17:17 +0100"  >&lt;p&gt;I just ran all tests. test-contrib and test-tag both fail for me. I can look into it a bit later today...&lt;/p&gt;</comment>
                    <comment id="12765611" author="michaelbusch" created="Wed, 14 Oct 2009 17:19:00 +0100"  >&lt;p&gt;This one fails in the bw-branch: org.apache.lucene.index.TestThreadedOptimize&lt;/p&gt;</comment>
                    <comment id="12765671" author="michaelbusch" created="Wed, 14 Oct 2009 19:09:47 +0100"  >&lt;p&gt;Fixes the bug in TermVectorAccessor.&lt;/p&gt;</comment>
                    <comment id="12765678" author="michaelbusch" created="Wed, 14 Oct 2009 19:25:40 +0100"  >&lt;p&gt;And the fix for the bw-branch.&lt;/p&gt;

&lt;p&gt;Running all tests again now...&lt;/p&gt;</comment>
                    <comment id="12765679" author="thetaphi" created="Wed, 14 Oct 2009 19:29:04 +0100"  >&lt;p&gt;Thanks!&lt;br/&gt;
&lt;del&gt;Your patch for TermVectorAccessor is fine, only the termEnum.close() should also be inside the if-branch.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;EDIT: sorry, my fault.&lt;/p&gt;</comment>
                    <comment id="12765683" author="thetaphi" created="Wed, 14 Oct 2009 19:39:42 +0100"  >&lt;p&gt;Seems that in the bw branch one more docCount() was in the tests... Sorry. I just patched the bw branch with the trunk test patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Running tests now, too.&lt;/p&gt;</comment>
                    <comment id="12765690" author="michaelbusch" created="Wed, 14 Oct 2009 19:51:45 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Seems that in the bw branch one more docCount() was in the tests&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah I just removed the line, because the variable wasn&apos;t actually used anywhere.&lt;/p&gt;


&lt;p&gt;OK all tests passed (core, contrib, bw). &lt;br/&gt;
+1 for committing.&lt;/p&gt;</comment>
                    <comment id="12765701" author="thetaphi" created="Wed, 14 Oct 2009 20:16:15 +0100"  >&lt;p&gt;+1 all tests pass here, too!&lt;/p&gt;</comment>
                    <comment id="12765752" author="michaelbusch" created="Wed, 14 Oct 2009 22:01:04 +0100"  >&lt;p&gt;Shall I commit it or are you going to, Uwe? Just asking, so that we&apos;re not trying to do it at the same time...&lt;/p&gt;</comment>
                    <comment id="12765753" author="thetaphi" created="Wed, 14 Oct 2009 22:05:03 +0100"  >&lt;p&gt;do it!&lt;/p&gt;</comment>
                    <comment id="12765764" author="michaelbusch" created="Wed, 14 Oct 2009 22:25:56 +0100"  >&lt;p&gt;Committed revision 825288.&lt;/p&gt;

&lt;p&gt;Thanks, Uwe!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12422122" name="LUCENE-1979-2-bw.patch" size="24996" author="michaelbusch" created="Wed, 14 Oct 2009 19:25:40 +0100" />
                    <attachment id="12422078" name="LUCENE-1979-2-bw.patch" size="24843" author="thetaphi" created="Wed, 14 Oct 2009 10:28:55 +0100" />
                    <attachment id="12422120" name="LUCENE-1979-2.patch" size="48600" author="michaelbusch" created="Wed, 14 Oct 2009 19:09:47 +0100" />
                    <attachment id="12422077" name="LUCENE-1979-2.patch" size="49462" author="thetaphi" created="Wed, 14 Oct 2009 10:28:55 +0100" />
                    <attachment id="12422040" name="lucene-1979-bw.patch" size="14017" author="michaelbusch" created="Wed, 14 Oct 2009 01:09:04 +0100" />
                    <attachment id="12422044" name="lucene-1979.patch" size="32451" author="michaelbusch" created="Wed, 14 Oct 2009 01:22:00 +0100" />
                    <attachment id="12422036" name="lucene-1979.patch" size="32286" author="michaelbusch" created="Wed, 14 Oct 2009 00:45:12 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>7.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 13 Oct 2009 23:57:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11792</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25746</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>