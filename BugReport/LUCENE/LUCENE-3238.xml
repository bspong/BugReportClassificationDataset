<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:27:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3238/LUCENE-3238.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3238] SpanMultiTermQueryWrapper with Prefix Query issue</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3238</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;If we try to do a search with SpanQuery and a PrefixQuery this message is returned:&lt;/p&gt;

&lt;p&gt;&quot;You can only use SpanMultiTermQueryWrapper with a suitable SpanRewriteMethod.&quot;&lt;/p&gt;

&lt;p&gt;The problem is in the WildcardQuery rewrite function.&lt;/p&gt;

&lt;p&gt;If the wildcard query is a prefix, a new prefix query is created, the rewrite method is set with the SpanRewriteMethod and the prefix query is returned.&lt;/p&gt;

&lt;p&gt;But, that&apos;s the rewritten prefix query which should be returned:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return rewritten;&lt;br/&gt;
+      return rewritten.rewrite(reader);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will attach a patch with a unit test included.&lt;/p&gt;


</description>
                <environment>&lt;p&gt;Windows 7, JDK 1.6&lt;/p&gt;</environment>
            <key id="12511474">LUCENE-3238</key>
            <summary>SpanMultiTermQueryWrapper with Prefix Query issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rcmuir">Robert Muir</assignee>
                                <reporter username="lboutros">ludovic Boutros</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jun 2011 14:51:36 +0100</created>
                <updated>Sat, 2 Jul 2011 03:40:12 +0100</updated>
                    <resolved>Sat, 25 Jun 2011 00:42:16 +0100</resolved>
                            <version>3.3</version>
                                <fixVersion>3.3</fixVersion>
                                <component>core/search</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13054456" author="lboutros" created="Fri, 24 Jun 2011 14:55:07 +0100"  >&lt;p&gt;Here is the patch for the branch 3x.&lt;/p&gt;</comment>
                    <comment id="13054464" author="rcmuir" created="Fri, 24 Jun 2011 15:21:26 +0100"  >&lt;p&gt;Hi, definitely a bug, thank you!&lt;/p&gt;

&lt;p&gt;In my opinion, WildcardQuery should not try to override MultiTermQuery&apos;s rewrite here, it causes too many problems.&lt;/p&gt;

&lt;p&gt;Instead, in this case it should just return a PrefixTermEnum... this is the way we handle these things in trunk and I think we should fix it here the same way.&lt;/p&gt;</comment>
                    <comment id="13054465" author="thetaphi" created="Fri, 24 Jun 2011 15:22:52 +0100"  >&lt;p&gt;The fix is fine, but in my optinion the problem should be solved differently.&lt;/p&gt;

&lt;p&gt;I would like to make the rewrite method in MultiTermQuery final to prevent override. To correctly fix the issue, WildcardQuery only needs to return a PrefixTermEnum in its getEnum method. This is already fixed in Lucene 4.0.&lt;/p&gt;

&lt;p&gt;From looking at the code, SpanMultiTermQueryWrapper would not work correct in all cases, if the underlying query overwrites rewrite(), as the rewritten query would again have the wrong type.&lt;/p&gt;</comment>
                    <comment id="13054466" author="thetaphi" created="Fri, 24 Jun 2011 15:25:20 +0100"  >&lt;p&gt;Patch is fine! Funny overlap, we both responded with same answer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13054483" author="rcmuir" created="Fri, 24 Jun 2011 15:51:25 +0100"  >&lt;p&gt;Same patch: except I made MultiTermQuery&apos;s rewrite() final.&lt;/p&gt;

&lt;p&gt;In my opinion, this is a good backwards break, it will only fix bugs in someone&apos;s code if they have a custom MultiTermQuery: its very tricky to override this (e.g. you must pass along boost, rewriteMethod, ...), and when you do, still might cause problems (like this Span issue).&lt;/p&gt;

&lt;p&gt;Its also much easier to just return a simpler enum.&lt;/p&gt;</comment>
                    <comment id="13054530" author="lboutros" created="Fri, 24 Jun 2011 17:30:08 +0100"  >&lt;p&gt;I understand the patch, that&apos;s better indeed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    <comment id="13054757" author="rcmuir" created="Sat, 25 Jun 2011 00:42:16 +0100"  >&lt;p&gt;thanks Ludovic, nice catch!&lt;/p&gt;

</comment>
                    <comment id="13058906" author="rcmuir" created="Sat, 2 Jul 2011 03:40:12 +0100"  >&lt;p&gt;bulk close for 3.3&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12483715" name="LUCENE-3238.patch" size="8251" author="rcmuir" created="Fri, 24 Jun 2011 15:51:25 +0100" />
                    <attachment id="12483712" name="LUCENE-3238.patch" size="4062" author="rcmuir" created="Fri, 24 Jun 2011 15:21:26 +0100" />
                    <attachment id="12483710" name="LUCENE-3238.patch" size="1612" author="lboutros" created="Fri, 24 Jun 2011 14:55:07 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 24 Jun 2011 14:21:26 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2082</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24459</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>