<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:00:12 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1125/LUCENE-1125.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1125] Excessive Arrays.fill(0) in DocumentsWriter drastically slows down small docs (3.9X slowdown!)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1125</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I&apos;ve been doing some &quot;final&quot; performance testing of 2.3RC1 and&lt;br/&gt;
uncovered a fairly serious bug that adds a large fixed CPU cost when&lt;br/&gt;
documents have any term vector enabled fields.&lt;/p&gt;

&lt;p&gt;The bug does not affect correctness, just performance.&lt;/p&gt;

&lt;p&gt;Basically, for every document, we were calling Arrays.fill(0) on a&lt;br/&gt;
large (32 KB) byte array when in fact we only needed to zero a small&lt;br/&gt;
part of it.  This only happens if term vectors are turned on, and is&lt;br/&gt;
especially devastating for small documents.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12385968">LUCENE-1125</key>
            <summary>Excessive Arrays.fill(0) in DocumentsWriter drastically slows down small docs (3.9X slowdown!)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jan 2008 14:04:07 +0000</created>
                <updated>Fri, 25 Jan 2008 03:24:17 +0000</updated>
                    <resolved>Thu, 10 Jan 2008 18:23:56 +0000</resolved>
                            <version>2.3</version>
                                <fixVersion>2.3</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12557647" author="mikemccand" created="Thu, 10 Jan 2008 14:06:53 +0000"  >&lt;p&gt;Attached patch.  I ran a test where I index the first 6M docs from&lt;br/&gt;
Wikipedia preprocessed to 100 bytes each, using this alg:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  analyzer=org.apache.lucene.analysis.standard.StandardAnalyzer
  doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker
  work.dir=/lucene/work
  doc.stored = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  doc.term.vector = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  doc.term.vector.positions = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  doc.term.vector.offsets = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  ram.flush.mb = 64
  compound = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  autocommit = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  docs.file=/Volumes/External/lucene/wikifull100.txt
  doc.add.log.step=10000
  
  directory=FSDirectory
  
  ResetSystemErase
  { &lt;span class=&quot;code-quote&quot;&gt;&quot;BuildIndex&quot;&lt;/span&gt;
    CreateIndex
    [ { &lt;span class=&quot;code-quote&quot;&gt;&quot;AddDocs&quot;&lt;/span&gt; AddDoc &amp;gt; : 1500000 ]: 4
    CloseIndex
  }
  
  RepSumByPrefRound BuildIndex
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this fix, it takes 158.5 seconds.  Without it, it takes 621.8&lt;br/&gt;
seconds = 3.9X slower!&lt;/p&gt;

&lt;p&gt;The fix is very low risk.  All tests pass.&lt;/p&gt;

&lt;p&gt;Michael, I think we should spin 2.3 RC2 to include this fix?  Sorry to&lt;br/&gt;
only find it so late in the game &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12557723" author="michaelbusch" created="Thu, 10 Jan 2008 17:48:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The fix is very low risk. All tests pass.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, all contrib &amp;amp; core tests pass for me too. And after reading the&lt;br/&gt;
patch I agree that it looks good and is low risk.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Michael, I think we should spin 2.3 RC2 to include this fix? Sorry to&lt;br/&gt;
only find it so late in the game &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, why don&apos;t you commit this today. Meanwhile I&apos;ll look into the&lt;br/&gt;
small issues Hoss pointed out and then build RC2 end of today.&lt;/p&gt;

&lt;p&gt;Oh, and no need to be sorry! This is what the code freeze period is&lt;br/&gt;
for - finding and fixing problems! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12557735" author="mikemccand" created="Thu, 10 Jan 2008 18:09:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;OK, why don&apos;t you commit this today. Meanwhile I&apos;ll look into the&lt;br/&gt;
small issues Hoss pointed out and then build RC2 end of today.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;OK, will do, thanks!&lt;/p&gt;
</comment>
                    <comment id="12557738" author="mikemccand" created="Thu, 10 Jan 2008 18:23:56 +0000"  >&lt;p&gt;Fixed on trunk &amp;amp; 2.3 branch.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12372905" name="LUCENE-1125.patch" size="1934" author="mikemccand" created="Thu, 10 Jan 2008 14:06:53 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 10 Jan 2008 17:48:41 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12620</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26604</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>