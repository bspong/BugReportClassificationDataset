<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:34:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1600/LUCENE-1600.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1600] Reduce usage of String.intern(), performance is terrible</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1600</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I profiled a simple MatchAllDocsQuery() against ~1.5 million documents (8 fields of short text, Field.Store.YES,Field.Index.NOT_ANALYZED_NO_NORMS), then retrieved all documents via searcher.doc(i, fs). String.intern() showed up as a top hotspot (see attached screenshot), so i implemented a small optimization to not intern() for every new Field(), instead forcing the intern in the FieldInfos class and adding a optional &quot;internName&quot; constructor to Field. This reduced execution time for searching and iterating through all documents by 35%. Results were similar for -server and -client.&lt;/p&gt;


&lt;p&gt;TRUNK (2.9) w/out patch: matched 1435563 in 8884 ms/search&lt;br/&gt;
TRUNK (2.9) w/patch: matched 1435563 in 5786 ms/search&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows Server 2003 x64&lt;br/&gt;
Hotspot JDK 1.6.0_12 64-bit&lt;/p&gt;</environment>
            <key id="12422715">LUCENE-1600</key>
            <summary>Reduce usage of String.intern(), performance is terrible</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="peger@automotive.com">Patrick Eger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Apr 2009 19:49:22 +0100</created>
                <updated>Sun, 18 Jul 2010 06:26:12 +0100</updated>
                    <resolved>Mon, 13 Apr 2009 21:07:36 +0100</resolved>
                            <version>2.4</version>
                <version>2.4.1</version>
                                <fixVersion>2.9</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12698494" author="peger@automotive.com" created="Mon, 13 Apr 2009 19:49:59 +0100"  >&lt;p&gt;attaching profiler screenshot and patch&lt;/p&gt;</comment>
                    <comment id="12698495" author="peger@automotive.com" created="Mon, 13 Apr 2009 19:50:42 +0100"  >&lt;p&gt;note that there may be other opportunities to reduce interning, i fixed it only for my specific use-case&lt;/p&gt;</comment>
                    <comment id="12698534" author="mikemccand" created="Mon, 13 Apr 2009 21:04:13 +0100"  >&lt;p&gt;Thanks for the fix, P.  I&apos;ll commit this for 2.9.&lt;/p&gt;</comment>
                    <comment id="12699857" author="jasonrutherglen" created="Thu, 16 Apr 2009 21:56:49 +0100"  >&lt;p&gt;contrib/MemoryIndex has a bunch of notes about how interning is&lt;br/&gt;
slow, and using (I believe) hashmaps of strings is better.&lt;br/&gt;
Comments on this approach?&lt;/p&gt;</comment>
                    <comment id="12699864" author="peger@automotive.com" created="Thu, 16 Apr 2009 22:06:47 +0100"  >&lt;p&gt;Hashmaps would work also, but then they either need to be synchronized or kept per-thread, the former would probably kill all your performance gains and the latter would be annoying i think. A moderate usage of String.intern() is fine i think, my patch just takes it out of the hot-path (for my use-case at least). Other uses of String.intern() in the codebase may have different solutions/tradeoffs certainly.&lt;/p&gt;</comment>
                    <comment id="12699865" author="thetaphi" created="Thu, 16 Apr 2009 22:08:15 +0100"  >&lt;p&gt;In addition to Mikes fixes, there are more places in FieldsReader, where intern() is used. The best would be to add the sme ctor to AbstractField, too and use it for LayzyField and so on, too.&lt;br/&gt;
If I have time, I attach a patch similar to Patrick&apos;s.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12469549">LUCENE-2545</issuekey>
        </issuelink>
                    </outwardlinks>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12398451">LUCENE-1308</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12423227">LUCENE-1607</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12405338" name="intern_perf.patch" size="3576" author="peger@automotive.com" created="Mon, 13 Apr 2009 19:49:59 +0100" />
                    <attachment id="12405337" name="intern.png" size="50223" author="peger@automotive.com" created="Mon, 13 Apr 2009 19:49:59 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 13 Apr 2009 20:04:13 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12155</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26128</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>