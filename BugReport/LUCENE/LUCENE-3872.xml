<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:28:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3872/LUCENE-3872.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3872] Index changes are lost if you call prepareCommit() then close()</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3872</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;You are supposed to call commit() after calling prepareCommit(), but... if you forget, and call close() after prepareCommit() without calling commit(), then any changes done after the prepareCommit() are silently lost (including adding/deleting docs, but also any completed merges).&lt;/p&gt;

&lt;p&gt;Spinoff from java-user thread &quot;lots of .cfs (compound files) in the index directory&quot; from Tim Bogaert.&lt;/p&gt;

&lt;p&gt;I think to fix this, IW.close should throw an IllegalStateException if prepareCommit() was called with no matching call to commit().&lt;/p&gt;</description>
                <environment></environment>
            <key id="12546600">LUCENE-3872</key>
            <summary>Index changes are lost if you call prepareCommit() then close()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Mar 2012 15:36:06 +0000</created>
                <updated>Fri, 10 May 2013 11:44:58 +0100</updated>
                    <resolved>Thu, 15 Mar 2012 19:24:55 +0000</resolved>
                                            <fixVersion>3.6</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13230248" author="mikemccand" created="Thu, 15 Mar 2012 15:38:47 +0000"  >&lt;p&gt;Patch w/ failing test showing how we silently lose indexed docs...&lt;/p&gt;</comment>
                    <comment id="13230280" author="mikemccand" created="Thu, 15 Mar 2012 16:31:58 +0000"  >&lt;p&gt;Patch, I think it&apos;s ready.&lt;/p&gt;

&lt;p&gt;One test was failing to call the commit() matching its prepareCommit()... I fixed it.&lt;/p&gt;</comment>
                    <comment id="13230293" author="rcmuir" created="Thu, 15 Mar 2012 16:53:12 +0000"  >&lt;p&gt;I don&apos;t have a better fix, but at the same time i feel you should be able to close() at any time,&lt;br/&gt;
(such as when handling exceptions in your app), since we are a real closeable here.&lt;/p&gt;</comment>
                    <comment id="13230307" author="mikemccand" created="Thu, 15 Mar 2012 17:08:47 +0000"  >&lt;p&gt;Well, we could also easily allow skipping the call to commit... in this case IW.close would detect the missing call to commit, call commit, and call commit again to save any changes done after the prepareCommit and before close.&lt;/p&gt;</comment>
                    <comment id="13230345" author="rcmuir" created="Thu, 15 Mar 2012 17:36:33 +0000"  >&lt;blockquote&gt;
&lt;p&gt;in this case IW.close would detect the missing call to commit, call commit, and call commit again to save any changes done after the prepareCommit and before close.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that would make it even more lenient and complicated and worse. I guess i feel close() should really be rollback(). But this is likely ridiculous to change.&lt;br/&gt;
So on second thought I think patch is good... if someone is handling exceptional cases like this they should be thinking about using rollback() anyway,&lt;br/&gt;
and they have this option still.&lt;/p&gt;

&lt;p&gt;I wasn&apos;t really against the patch anyway, just whining. its definitely an improvement on the current behavior, let&apos;s do it.&lt;/p&gt;</comment>
                    <comment id="13230436" author="dweiss" created="Thu, 15 Mar 2012 19:14:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess i feel close() should really be rollback().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah... I think this feeling of unease is fairly common &amp;#8211; see JDBC&apos;s Connection javadoc on close, for example: &quot;It is strongly recommended that an application explicitly commits or rolls back an active transaction prior to calling the close method. If the close method is called and there is an active transaction, the results are implementation-defined.&quot;&lt;/p&gt;</comment>
                    <comment id="13230446" author="mikemccand" created="Thu, 15 Mar 2012 19:24:55 +0000"  >&lt;p&gt;Thanks Tim!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12518478" name="LUCENE-3872.patch" size="4217" author="mikemccand" created="Thu, 15 Mar 2012 16:31:58 +0000" />
                    <attachment id="12518472" name="LUCENE-3872.patch" size="1559" author="mikemccand" created="Thu, 15 Mar 2012 15:38:47 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 15 Mar 2012 16:53:12 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>231759</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>23829</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>