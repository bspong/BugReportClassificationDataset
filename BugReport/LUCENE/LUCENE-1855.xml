<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:31:15 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1855/LUCENE-1855.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1855] Change AttributeSource API to use generics</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1855</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The AttributeSource API will be easier to use with JDK 1.5 generics.&lt;/p&gt;

&lt;p&gt;Uwe, if you started working on a patch for this already feel free to assign this to you.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12433987">LUCENE-1855</key>
            <summary>Change AttributeSource API to use generics</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="michaelbusch">Michael Busch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Aug 2009 00:10:56 +0100</created>
                <updated>Wed, 25 Nov 2009 16:47:50 +0000</updated>
                    <resolved>Thu, 1 Oct 2009 08:58:14 +0100</resolved>
                                            <fixVersion>3.0</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12747705" author="thetaphi" created="Wed, 26 Aug 2009 00:16:21 +0100"  >&lt;p&gt;OK, will do. Most work is removing the casts from all TokenStream ctors &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Currently I just tried out with two classes.&lt;/p&gt;</comment>
                    <comment id="12749274" author="thetaphi" created="Sun, 30 Aug 2009 16:23:51 +0100"  >&lt;p&gt;Here is the patch that implements generics for the Attributes API. The test shows, how simple now usage of addAttribute() and so on is (no casts needed anymore).&lt;/p&gt;

&lt;p&gt;The code compiles without any unchecked warnings. To test this, I enabled the warnings about unchecked operations globally (emitting about 350 warnings on whole lucene). Two places inside private code needs to add @SuppressWarnings, because the compiler does not know if one AttributeImpl really implements the questioned interface.&lt;/p&gt;</comment>
                    <comment id="12749292" author="thetaphi" created="Sun, 30 Aug 2009 18:42:09 +0100"  >&lt;p&gt;As I already started to move Lucene to Java 1.5, here an idea, how to get the generics in:&lt;/p&gt;

&lt;p&gt;I would propose to switch on all &quot;unchecked&quot; warnings (as in the supplied patch) by the &amp;lt;compilerarg/&amp;gt; in ant. The problem is then, that there are hundreds of warnings printed out. I would like to then add a @SuppressWarnings(&quot;unchecked&quot;) to all classes, that are not yet rewritten to generics for collections and other generified java things (like Class&amp;lt;?&amp;gt; in AttributeSource). The warnings should then disappear. We could then start to search for SuppressWarnings annotations in the source and start the classes one-by-one and add generics. By this it is simplier, because you only get warnings for the class you are working on.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                    <comment id="12749294" author="thetaphi" created="Sun, 30 Aug 2009 18:48:15 +0100"  >&lt;p&gt;About the backwards compatibility: After adding generics, the backwards test should run all tests from 2.9 (compiled with 1.4) against the generified trunk jar. After branching I would start to manage this.&lt;/p&gt;

&lt;p&gt;Normally generics do not bring backwards incompatibility, because they are simple removed. You only have probloems at places, where the the erased generics should not be replaced by java.lang.Object. Eg in the AttributeSource.addAttribute() call, it should return a Attribute (subclass) as in 2.9 and not Object (because of this you need to generify the whole method by the generics prefix, defining &quot;A&quot; as subclass of &quot;Attribute&quot;). If you use an naive approach to add generics, it could lead to addAttribute returns Object (and so a link error would occur). To prevent this, the backwards tests against 2.9 are a good solution.&lt;/p&gt;

&lt;p&gt;By the way, the generics for AttributeSource were copied from j.l.Class and its methods to get annotations &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12749302" author="markrmiller@gmail.com" created="Sun, 30 Aug 2009 19:35:46 +0100"  >&lt;blockquote&gt;&lt;p&gt;By the way, the generics for AttributeSource were copied from j.l.Class and its methods to get annotations &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From the apache harmony project I hope &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12749305" author="michaelbusch" created="Sun, 30 Aug 2009 20:03:29 +0100"  >&lt;blockquote&gt;
&lt;p&gt;From the apache harmony project I hope &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No worries... the original patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1422&quot; title=&quot;New TokenStream API&quot;&gt;&lt;del&gt;LUCENE-1422&lt;/del&gt;&lt;/a&gt;) had the 1.5 version attached as comments all the time and wasn&apos;t copied from anywhere. I originally designed the API with 1.5 generics and ported it back to 1.4 to be able to commit it.&lt;/p&gt;

&lt;p&gt;We just removed those comments with some patch from trunk (probably &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1693&quot; title=&quot;AttributeSource/TokenStream API improvements&quot;&gt;&lt;del&gt;LUCENE-1693&lt;/del&gt;&lt;/a&gt;) and Uwe brought it back now.&lt;/p&gt;</comment>
                    <comment id="12749306" author="thetaphi" created="Sun, 30 Aug 2009 20:07:31 +0100"  >&lt;blockquote&gt;&lt;p&gt;From the apache harmony project I hope &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No problem at all, it was more only this public API line that &lt;b&gt;inspired&lt;/b&gt; me... I did not copy any code, only the public API:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;A &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Annotation&amp;gt; A getAnnotation(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;A&amp;gt; annotationClass)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;from &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#getAnnotation(java.lang.Class)&quot; class=&quot;external-link&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#getAnnotation(java.lang.Class)&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Michael: This was not in the comments (at least not in the comments from the latest Lucene code before our rewrite).&lt;/p&gt;</comment>
                    <comment id="12749307" author="markrmiller@gmail.com" created="Sun, 30 Aug 2009 20:09:58 +0100"  >&lt;p&gt;no worries here either guys - far from the copyright police here - just a wink comment. &lt;/p&gt;</comment>
                    <comment id="12749312" author="michaelbusch" created="Sun, 30 Aug 2009 20:52:14 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Michael: This was not in the comments (at least not in the comments from the latest Lucene code before our rewrite).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It was. The &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1693&quot; title=&quot;AttributeSource/TokenStream API improvements&quot;&gt;&lt;del&gt;LUCENE-1693&lt;/del&gt;&lt;/a&gt; commit removed it. And my first 1693 patch left it in, so either me or you removed it in the subsequent 1693 patches.&lt;br/&gt;
It&apos;s not really important I guess &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; As you and Mark said: it&apos;s just public API stuff that we could have gotten from the javadocs anyway.&lt;/p&gt;</comment>
                    <comment id="12749327" author="thetaphi" created="Sun, 30 Aug 2009 21:46:44 +0100"  >&lt;blockquote&gt;&lt;p&gt;It was.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK. I found it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - in the first version after checkin.&lt;/p&gt;

&lt;p&gt;Attached is a new patch, now also making TokenStream generics activated. The next step is to convert all Tokenizers (as always...). Michael: Is this patch, how you want to have it?&lt;/p&gt;</comment>
                    <comment id="12749328" author="michaelbusch" created="Sun, 30 Aug 2009 22:01:04 +0100"  >&lt;p&gt;Uwe, I&apos;m not home right now, will look tonight! Thanks for writing the patch!&lt;/p&gt;</comment>
                    <comment id="12749479" author="thetaphi" created="Mon, 31 Aug 2009 13:40:56 +0100"  >&lt;p&gt;For all developers that want to see, that the generics-enabled class AttributeSource is binary compatible (so addAttribute still return Attribute in the erasured class) to the 2.9 version, here is the de-compiled version of the class file (using JAD). This is not really full featured java code, but shows, how the erasured class looks like (and how javac generates the advanced FOR statements) and the covariant overriding of iterator&apos;s next(). Really interesting.&lt;/p&gt;

&lt;p&gt;JAD is always good, to look, how a class with generic looks like for code compiled agains 1.4.&lt;/p&gt;</comment>
                    <comment id="12749706" author="michaelbusch" created="Tue, 1 Sep 2009 01:31:25 +0100"  >&lt;p&gt;Patch looks great, Uwe! &lt;/p&gt;</comment>
                    <comment id="12760897" author="thetaphi" created="Wed, 30 Sep 2009 13:31:04 +0100"  >&lt;p&gt;As we are now on Java 1.5, I would like to go forward with this issue as the first real patch using generics.&lt;/p&gt;

&lt;p&gt;During development of generics, it is really important that you see all unchecked warnings, so this patch also adds &amp;lt;compilerarg line=&quot;-Xlint:unchecked&quot;/&amp;gt; to the javac task. The problem is now, that all non-generics classes in Lucene generate tons of warnings. I would like to proceed like the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Open a new issue that adds this compilerarg.&lt;/li&gt;
	&lt;li&gt;Add a @SuppressWarnings(&quot;unchecked&quot;) in front of each class, that (currently) produces warnings (should not be so many, hopefully).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After that the compilation should run without warnings about unchecked casts and so on. When starting to add generics to some of the classes, the developer would remove the SuppressWarnings for the class he works on and start fixing the warnngs and adding generics.&lt;/p&gt;

&lt;p&gt;What do you think? Without that, it is hard to add the generics 100% safe and consistent without be lost in tons of warnings and so on.&lt;/p&gt;

&lt;p&gt;I will also update this patch to also remove the now unneeded casts in all addAttribute calls in Lucene (low priority).&lt;/p&gt;</comment>
                    <comment id="12760945" author="thetaphi" created="Wed, 30 Sep 2009 17:13:46 +0100"  >&lt;p&gt;Here the master patch prepared in the train from Berlin to Bremen. It converts everything TokenStream related to generics.&lt;/p&gt;

&lt;p&gt;To be sure, that non-generics 2.9 tests are binary compatible, I will first create a new backwards branch and modify build.xml to compile the backwards test withs -source and -target 1.4&lt;/p&gt;

&lt;p&gt;I will commit soon and go forward with NumericRange generification. The question about the SuppressWarnings-TODO is still open!&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                    <comment id="12760953" author="thetaphi" created="Wed, 30 Sep 2009 17:49:44 +0100"  >&lt;p&gt;Sorry, last patch had an error in hasReusableNext backwards layer initialization.&lt;/p&gt;</comment>
                    <comment id="12761012" author="thetaphi" created="Wed, 30 Sep 2009 22:31:51 +0100"  >&lt;p&gt;Some Javadoc additions, also change QueryParser.jj file.&lt;/p&gt;

&lt;p&gt;Contrib and contrib queryparser was not converted. The new Queryparser would also get cleaner without the unneeded casts.&lt;/p&gt;

&lt;p&gt;I will commit this tomorrow, when JIRA hopefully works better.&lt;/p&gt;

&lt;p&gt;Robert Muir: Do you have time to remove the casts from contrib?&lt;br/&gt;
Luis Alves: You can also update the new Queryparser to not cas the return of getAttribute/addAttribute&lt;/p&gt;</comment>
                    <comment id="12761080" author="rcmuir" created="Thu, 1 Oct 2009 03:30:40 +0100"  >&lt;p&gt;patch for contrib (except for the new queryparser)&lt;/p&gt;</comment>
                    <comment id="12761105" author="adriano_crestani" created="Thu, 1 Oct 2009 07:19:01 +0100"  >&lt;p&gt;Here is the patch for contrib/queryparser&lt;/p&gt;</comment>
                    <comment id="12761107" author="thetaphi" created="Thu, 1 Oct 2009 07:22:24 +0100"  >&lt;p&gt;A small update to my core patch, it now needs no @SuppressWarnings anymore in addAttribute/getAttribute impl&lt;/p&gt;

&lt;p&gt;I will commit soon.&lt;/p&gt;

&lt;p&gt;Thanks Robert for the contrib patch. I will do the new QueryParser later. The PrecedenceParser must be fixed or removed, when the old TokenStream API gets removed.&lt;/p&gt;</comment>
                    <comment id="12761108" author="thetaphi" created="Thu, 1 Oct 2009 07:23:54 +0100"  >&lt;p&gt;Oh thanks Adriano, I haven&apos;t seen your patch! I will add it!&lt;/p&gt;

&lt;p&gt;Thank you very much!&lt;/p&gt;</comment>
                    <comment id="12761115" author="adriano_crestani" created="Thu, 1 Oct 2009 08:17:41 +0100"  >&lt;p&gt;This patch updates the PQP to use the new TokenStream API...all tests still pass.&lt;/p&gt;

&lt;p&gt;I hope this helps to keep the PQP &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12761119" author="thetaphi" created="Thu, 1 Oct 2009 08:43:17 +0100"  >&lt;p&gt;Thanks Adriano, I will open another issue about that, as it has not really something to do with this issue!&lt;/p&gt;</comment>
                    <comment id="12761125" author="thetaphi" created="Thu, 1 Oct 2009 08:58:04 +0100"  >&lt;p&gt;Added CHANGES.txt and committed revision: 820553&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12392905">LUCENE-1257</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12418140" name="AttributeSource.jad" size="12804" author="thetaphi" created="Mon, 31 Aug 2009 13:40:56 +0100" />
                    <attachment id="12420976" name="LUCENE-1855_contrib.patch" size="98869" author="rcmuir" created="Thu, 1 Oct 2009 03:30:40 +0100" />
                    <attachment id="12420985" name="LUCENE-1855_contrib_queryparser.patch" size="46119" author="adriano_crestani" created="Thu, 1 Oct 2009 07:19:01 +0100" />
                    <attachment id="12420986" name="LUCENE-1855.patch" size="78616" author="thetaphi" created="Thu, 1 Oct 2009 07:22:24 +0100" />
                    <attachment id="12420948" name="LUCENE-1855.patch" size="78843" author="thetaphi" created="Wed, 30 Sep 2009 22:31:51 +0100" />
                    <attachment id="12420924" name="LUCENE-1855.patch" size="72945" author="thetaphi" created="Wed, 30 Sep 2009 17:49:44 +0100" />
                    <attachment id="12420917" name="LUCENE-1855.patch" size="72945" author="thetaphi" created="Wed, 30 Sep 2009 17:13:46 +0100" />
                    <attachment id="12418104" name="LUCENE-1855.patch" size="22736" author="thetaphi" created="Sun, 30 Aug 2009 21:46:44 +0100" />
                    <attachment id="12418091" name="LUCENE-1855.patch" size="19890" author="thetaphi" created="Sun, 30 Aug 2009 16:23:51 +0100" />
                    <attachment id="12420987" name="LUCENE-1855_precedence_queryparser.patch" size="74679" author="adriano_crestani" created="Thu, 1 Oct 2009 08:17:41 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 25 Aug 2009 23:16:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11908</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25872</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>