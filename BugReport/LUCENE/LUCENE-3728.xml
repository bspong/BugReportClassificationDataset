<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:29 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3728/LUCENE-3728.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3728] better handling of files inside/outside CFS by codec</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3728</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Since norms and deletes were moved under Codec (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3606&quot; title=&quot;Make IndexReader really read-only in Lucene 4.0&quot;&gt;&lt;del&gt;LUCENE-3606&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3661&quot; title=&quot;move deletes under codec&quot;&gt;&lt;del&gt;LUCENE-3661&lt;/del&gt;&lt;/a&gt;),&lt;br/&gt;
we never really properly addressed the issue of how Codec.files() should work,&lt;br/&gt;
considering these files are always stored outside of CFS.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3606&quot; title=&quot;Make IndexReader really read-only in Lucene 4.0&quot;&gt;&lt;del&gt;LUCENE-3606&lt;/del&gt;&lt;/a&gt; added a hack, &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3661&quot; title=&quot;move deletes under codec&quot;&gt;&lt;del&gt;LUCENE-3661&lt;/del&gt;&lt;/a&gt; cleaned up the hack a little bit more,&lt;br/&gt;
but its still a hack.&lt;/p&gt;

&lt;p&gt;Currently the logic in SegmentInfo.files() is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
clearCache()

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compoundFile) {
  &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t call Codec.files(), hardcoded CFS extensions, etc
&lt;/span&gt;} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  Codec.files()
}

&lt;span class=&quot;code-comment&quot;&gt;// always add files stored outside CFS regardless of CFS setting
&lt;/span&gt;Codec.separateFiles()

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sharedDocStores) {
  &lt;span class=&quot;code-comment&quot;&gt;// hardcoded shared doc store extensions, etc
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also various codec methods take a Directory parameter, but its inconsistent&lt;br/&gt;
what this Directory is in the case of CFS: for some parts of the index its&lt;br/&gt;
the CFS directory, for others (deletes, separate norms) its not.&lt;/p&gt;

&lt;p&gt;I wonder if instead we could restructure this so that SegmentInfo.files() logic is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
clearCache()
Codec.files()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and so that Codec is instead responsible.&lt;/p&gt;

&lt;p&gt;instead Codec.files logic by default would do the if (compoundFile) thing, and&lt;br/&gt;
Lucene3x codec itself would only have the if (sharedDocStores) thing, and any&lt;br/&gt;
part of the codec that wants to put stuff always outside of CFS (e.g. Lucene3x separate norms, deletes) &lt;br/&gt;
could just use SegmentInfo.dir. Directory parameters in the case of CFS would always&lt;br/&gt;
consistently be the CFSDirectory.&lt;/p&gt;

&lt;p&gt;I haven&apos;t totally tested if this will work but there is definitely some cleanups &lt;br/&gt;
we can do either way, and I think it would be a good step to try to clean this up&lt;br/&gt;
and simplify it.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12540292">LUCENE-3728</key>
            <summary>better handling of files inside/outside CFS by codec</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Jan 2012 12:06:52 +0000</created>
                <updated>Fri, 10 May 2013 11:44:18 +0100</updated>
                    <resolved>Mon, 30 Jan 2012 21:14:41 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13195741" author="rcmuir" created="Sun, 29 Jan 2012 12:23:01 +0000"  >&lt;p&gt;I&apos;m gonna slowly iterate on cleaning this up on the branch for &lt;br/&gt;
lucene-3661 (branches/lucene3661: i recreated it), in case anyone &lt;br/&gt;
wants to jump in and help or test out some ideas.&lt;/p&gt;</comment>
                    <comment id="13196257" author="rcmuir" created="Mon, 30 Jan 2012 18:04:36 +0000"  >&lt;p&gt;Attached is a patch showing the differences between branch and trunk.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;separateFiles() is removed, codecs calculate all of files() themselves.&lt;/li&gt;
	&lt;li&gt;shared (compound) doc store stuff is almost totally underneath Lucene3xCodec. (with one exception, see below)&lt;/li&gt;
	&lt;li&gt;indexing code doesn&apos;t violate abstractions of the code by reaching into the different components of files(), except indexwriter.copySegmentAsIs (and only for preflex, only in the case of shared doc stores).&lt;/li&gt;
	&lt;li&gt;lucene3x/lucene4x stored fields implementation is split, so that lucene3x can handle shared docstores itself.&lt;/li&gt;
	&lt;li&gt;codec.files is consistent about directory, in fact it doesnt take directory at all, as its unnecessary.&lt;/li&gt;
	&lt;li&gt;hairy code from segmentcorereaders for compound shared docstores is removed, and only in the 3.x impls.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think this is ready to go, and a lot easier to see whats happening with files(). &lt;/p&gt;

&lt;p&gt;In my opinion a good future issue here would be to add a heuristic to TieredMP to more aggressively target 3.x segments (at least if they have shared docstores). It could do evil things like check File.length or whatever it wants as part of its heuristic, but only for preflexcodec.&lt;/p&gt;</comment>
                    <comment id="13196296" author="mikemccand" created="Mon, 30 Jan 2012 18:45:14 +0000"  >&lt;p&gt;+1, this is a nice cleanup!  SegmentInfo.files is awesome now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13196416" author="rcmuir" created="Mon, 30 Jan 2012 21:04:14 +0000"  >&lt;p&gt;I&apos;ll commit this cleanup and help merge to the uschindler branch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12512433" name="LUCENE-3728.patch" size="171192" author="rcmuir" created="Mon, 30 Jan 2012 18:04:36 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 30 Jan 2012 18:45:14 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>225706</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>23970</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>