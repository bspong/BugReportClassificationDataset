<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:23:09 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2770/LUCENE-2770.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2770] Optimize SegmentMerger to work on atomic (Segment)Readers where possible</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2770</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;This is a spin-off from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2769&quot; title=&quot;FilterIndexReader in trunk does not implement getSequentialSubReaders() correctly&quot;&gt;&lt;del&gt;LUCENE-2769&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Currently SegmentMerger has some optimizations when it merges segments that are SegmentReaders (e.g. when doing normal indexing or optimizing). But when you do IndexWriter.addIndexes(IndexReader...) the listed IndexReaders may not really be per-segment. SegmentMerger should track down all passed in reads down to the lowest level (Segment)Reader (or other atomic readers like SlowMultiReaderWrapper) and then merge. We can then remove most MultiFields usage (except term merging itsself) and clean up the code.&lt;/p&gt;

&lt;p&gt;This especially saves lots of memory for merging norms, as no longer the duplicate norms arrays are created when MultiReaders are used!&lt;/p&gt;</description>
                <environment></environment>
            <key id="12480429">LUCENE-2770</key>
            <summary>Optimize SegmentMerger to work on atomic (Segment)Readers where possible</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="thetaphi">Uwe Schindler</assignee>
                                <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Nov 2010 16:13:20 +0000</created>
                <updated>Wed, 30 Mar 2011 16:50:05 +0100</updated>
                    <resolved>Fri, 19 Nov 2010 18:31:59 +0000</resolved>
                                            <fixVersion>3.1</fixVersion>
                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12933856" author="thetaphi" created="Fri, 19 Nov 2010 16:37:30 +0000"  >&lt;p&gt;Here the patch for 3.x, really easy here!&lt;/p&gt;

&lt;p&gt;3.x was missing to return null in contrib/misc for getSequentialSubReaders. Further optimizations here could also work per segment. For now we have to keep them &quot;atomic&quot;.&lt;/p&gt;

&lt;p&gt;As a side note: Why is contrib/misc&apos;s IndexSorter missing in trunk?&lt;/p&gt;</comment>
                    <comment id="12933858" author="thetaphi" created="Fri, 19 Nov 2010 16:48:08 +0000"  >&lt;p&gt;Updated patch for trunk, else MultiPassIndexSplitter fails when source index has more then one segment.&lt;/p&gt;</comment>
                    <comment id="12933898" author="thetaphi" created="Fri, 19 Nov 2010 18:16:59 +0000"  >&lt;p&gt;Final patches, will commit soon.&lt;/p&gt;

&lt;p&gt;The changes in MultiPassIndexSplitter are not yet really needed, but this is because FilterIndexReader is broken in trunk (see related issue). But I add it here, because for consistency we need it.&lt;/p&gt;

&lt;p&gt;This patch also removes the useless closeReaders() method in SegmentMerger. This was used by tests only (incorrectly) and should never be called from production code.&lt;/p&gt;</comment>
                    <comment id="12933902" author="mikemccand" created="Fri, 19 Nov 2010 18:21:50 +0000"  >&lt;p&gt;Looks great Uwe!&lt;/p&gt;</comment>
                    <comment id="12933905" author="thetaphi" created="Fri, 19 Nov 2010 18:31:59 +0000"  >&lt;p&gt;Committed trunk revision: 1036970&lt;br/&gt;
Committed 3.x revision: 1036971&lt;/p&gt;

&lt;p&gt;Thanks Mike for the help with the stupid bug because of not-cloned TVReader!&lt;/p&gt;</comment>
                    <comment id="12934045" author="thetaphi" created="Fri, 19 Nov 2010 23:18:33 +0000"  >&lt;p&gt;After a discussion with Robert, I supply a new patch with optrimized norms merging without reallocating and ArrayUtil.oversize() (implied y BytesRef). The fix is now to simply look before starting to merge norms how big the normsBuffer must be. So there is never reallocation needed.&lt;/p&gt;

&lt;p&gt;Will heavy commit now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="12934046" author="thetaphi" created="Fri, 19 Nov 2010 23:20:47 +0000"  >&lt;p&gt;Committed optimization in trunk revision: 1037077&lt;/p&gt;</comment>
                    <comment id="12934056" author="thetaphi" created="Fri, 19 Nov 2010 23:50:39 +0000"  >&lt;p&gt;Backported optimization to 3.x revision: 1037083&lt;/p&gt;</comment>
                    <comment id="13013364" author="gsingers" created="Wed, 30 Mar 2011 16:50:05 +0100"  >&lt;p&gt;Bulk close for 3.1&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12480404">LUCENE-2769</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12460031" name="LUCENE-2770-3x.patch" size="7154" author="thetaphi" created="Fri, 19 Nov 2010 18:16:59 +0000" />
                    <attachment id="12460017" name="LUCENE-2770-3x.patch" size="3444" author="thetaphi" created="Fri, 19 Nov 2010 16:37:29 +0000" />
                    <attachment id="12460072" name="LUCENE-2770-optimizeNormsMerging.patch" size="2327" author="thetaphi" created="Fri, 19 Nov 2010 23:18:33 +0000" />
                    <attachment id="12460030" name="LUCENE-2770.patch" size="11310" author="thetaphi" created="Fri, 19 Nov 2010 18:16:59 +0000" />
                    <attachment id="12460019" name="LUCENE-2770.patch" size="8831" author="thetaphi" created="Fri, 19 Nov 2010 16:48:08 +0000" />
                    <attachment id="12460015" name="LUCENE-2770.patch" size="7931" author="thetaphi" created="Fri, 19 Nov 2010 16:14:35 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 19 Nov 2010 18:21:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11083</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24922</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>