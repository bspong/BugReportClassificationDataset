<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:06:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2282/LUCENE-2282.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2282] Expose IndexFileNames as public, and make use of its methods in the code</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2282</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;IndexFileNames is useful for applications that extend Lucene, an in particular those who extend Directory or IndexWriter. It provides useful constants and methods to query whether a certain file is a core Lucene file or not. In addition, IndexFileNames should be used by Lucene&apos;s code to generate segment file names, or query whether a certain file matches a certain extension.&lt;/p&gt;

&lt;p&gt;I&apos;ll post the patch shortly.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12457218">LUCENE-2282</key>
            <summary>Expose IndexFileNames as public, and make use of its methods in the code</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2010 20:52:30 +0000</created>
                <updated>Fri, 10 May 2013 11:44:16 +0100</updated>
                    <resolved>Fri, 26 Feb 2010 16:53:09 +0000</resolved>
                                            <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12837446" author="creamyg" created="Tue, 23 Feb 2010 21:10:49 +0000"  >&lt;p&gt;It seems to me that identifying only core index files conflicts with the idea&lt;br/&gt;
of pluggable index formats.  Presumably plugins would use their own file&lt;br/&gt;
extensions.  Would these belong to the index, according to a detector based&lt;br/&gt;
off of IndexFileNames?  Presumably not, which would either limit the&lt;br/&gt;
usefulness of such a utility, or outright encourage anti-patterns such as a&lt;br/&gt;
sweeper that zaps files created by plugins because they aren&apos;t &quot;core Lucene&quot;&lt;br/&gt;
enough.&lt;/p&gt;

&lt;p&gt;Also, are temporary files &quot;core Lucene&quot;?  Lockfiles?  Only sometimes?&lt;/p&gt;

&lt;p&gt;What are the applications that we are trying to support by exposing this API?&lt;/p&gt;</comment>
                    <comment id="12837451" author="shaie" created="Tue, 23 Feb 2010 21:20:24 +0000"  >&lt;p&gt;Patch provides:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IFN constants and methods as public&lt;/li&gt;
	&lt;li&gt;segmentFileName concatenates the name and extension w/ &apos;.&apos;, using a StringBuilder. Using SB is a minor efficiency, and since the + operator on strings allocate it anyway, I figure we&apos;d better allocate it directly, especially when two + operators are involved.&lt;/li&gt;
	&lt;li&gt;matchesExtension checks whether a filename matches an extension&lt;/li&gt;
	&lt;li&gt;fileNameFromGeneration adds the &apos;.&apos; when neccessary.&lt;/li&gt;
	&lt;li&gt;Core code does not concatenate file, &apos;.&apos; and extension on its own, but uses IFN.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All core tests pass. I have a local problem w/ contrib tests (the Analyzers data dir is locked for some reason and I cannot unlock it), but I see no reasons for them to fail.&lt;/p&gt;

&lt;p&gt;If this can go out in 3.0.2 instead of waiting for 3.1, then all the better.&lt;/p&gt;</comment>
                    <comment id="12837455" author="shaie" created="Tue, 23 Feb 2010 21:29:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;What are the applications that we are trying to support by exposing this API?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any application that extends IW, or provide its own Directory implementation, and wants to reference Lucene&apos;s file extensions properly (i.e. not by putting its code under o.a.l.index or hardcoding &quot;.del&quot; as its deletions file) will benefit from making it public.&lt;br/&gt;
The class already exists, and declares the right constants and methods. All I want is to expose it as public. This information is not &lt;b&gt;hidden&lt;/b&gt;, it&apos;s out there. We&apos;re just making it easier for apps to reference it.&lt;/p&gt;

&lt;p&gt;Like Mike mentioned on the java-dev thread &lt;a href=&quot;http://old.nabble.com/IndexFileNames-td27699103.html&quot; class=&quot;external-link&quot;&gt;http://old.nabble.com/IndexFileNames-td27699103.html&lt;/a&gt;, he exposes it (or a variant) on the flex branch as public, because classes outside the &apos;index&apos; package need to reference it. Indeed once Flex is out, that file will need to change or extend to accommodate pluggable index formats / files, but that&apos;s not the matter of this issue. This issue is just about exposing an already existing class as public instead of package-private for convenience ...&lt;/p&gt;</comment>
                    <comment id="12837456" author="shaie" created="Tue, 23 Feb 2010 21:31:03 +0000"  >&lt;p&gt;Forgot to tag IFN as @lucene.internal&lt;/p&gt;</comment>
                    <comment id="12837499" author="creamyg" created="Tue, 23 Feb 2010 23:07:16 +0000"  >&lt;p&gt;&amp;gt; Any application that extends IW, or provide its own Directory&lt;br/&gt;
&amp;gt; implementation, and wants to reference Lucene&apos;s file extensions properly&lt;br/&gt;
&amp;gt; (i.e. not by putting its code under o.a.l.index or hardcoding &quot;.del&quot; as its&lt;br/&gt;
&amp;gt; deletions file) will benefit from making it public.&lt;/p&gt;

&lt;p&gt;&amp;gt; Forgot to tag IFN as @lucene.internal &lt;/p&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;If the class is tagged as &quot;internal&quot;, then external applications like the one &lt;br/&gt;
you describe above aren&apos;t supposed to use it, right?&lt;/p&gt;

&lt;p&gt;But I don&apos;t really care about whether this goes into Lucene.  Go ahead, make&lt;br/&gt;
it fully public and omit the &quot;internal&quot; tag.  Not my problem. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The thing is, I really don&apos;t understand what kind of thing you want to do.&lt;br/&gt;
Are you writing your own deletions files?&lt;/p&gt;

&lt;p&gt;I&apos;m trying to understand because the only use cases I can think of for this&lt;br/&gt;
aren&apos;t compatible with index pluggability, which is a high priority for Lucy.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Sweep &quot;non-core-Lucene files&quot; to &quot;clean up&quot; an index.&lt;/li&gt;
	&lt;li&gt;Gather up &quot;core-Lucene files&quot; for export.&lt;/li&gt;
	&lt;li&gt;Audit &quot;core-Lucene files&quot; to determine whether the index is in a valid&lt;br/&gt;
      state.&lt;/li&gt;
	&lt;li&gt;Differentiate between &quot;core-Lucene and &quot;non-core-Lucene&quot; files when&lt;br/&gt;
      writing a compound file.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe there&apos;s something I haven&apos;t thought of, though.  Why do you want to&lt;br/&gt;
&quot;reference Lucene&apos;s file extensions properly&quot;?  Once you&apos;ve identified&lt;br/&gt;
identified which files are &quot;core Lucene&quot; and which files aren&apos;t, what are you&lt;br/&gt;
going to do with them?&lt;/p&gt;
</comment>
                    <comment id="12837624" author="shaie" created="Wed, 24 Feb 2010 04:35:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;The thing is, I really don&apos;t understand what kind of thing you want to do.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Consider a variation of FileSwitchDirectory which someone wants to write. Extensions xyz, abc go do directory 1 and def got do directory 2. That someone will want to reference Lucene extensions in order to achieve that. FSD only takes care of extensions, but someone might need to work on prefixes of files as well.&lt;br/&gt;
You can say &quot;that class itself should not care about Lucene&apos;s extensions, it should get the extensions/prefixes in a ctor&quot; ...&lt;/p&gt;

&lt;p&gt;Well ... let&apos;s take FileSwitchDirectory (which is a core Lucene class) and say I want to instantiate it. I need to pass file extensions. How do I pass the .del file as an extension? Do I hard code it to &quot;.del&quot; (or just &quot;del&quot;?) or, or do I put that code in o.a.l.store just for that?  Or ... we make IndexFileNames publc and I can happily and safely reference it.&lt;br/&gt;
BTW, I&apos;m writing this from a computer w/o the Lucene code &amp;#8211; I wonder how FSD is tested, is the test in o.a.l.index because it references IFN or in o.a.l.store because it tests FSD? If it&apos;s the former, then I (usually) think it points at a problem in the design.&lt;/p&gt;

&lt;p&gt;The @lucene.internal tag gives us exactly that freedom. Instead of me putting code in o.a.l.* (and feel like I&apos;m dong something wrong, and make my code look wrong), I can put it in my package but know I&apos;m risking the chance a certain constant or method impl will change in the future. I&apos;ve already took that risk when I chose to put my code in o.a.l.* so I prefer to take that risk and not make my code look patchy.&lt;/p&gt;

&lt;p&gt;I, personally, don&apos;t mind what Lucene&apos;s back-compat policy is. Whenever I upgrade my code to a new Lucene version, I re-compile anything. I am happy to get rid of deprecated API, I am happy to take advantage of new, more efficient API, and I wouldn&apos;t care if a @lucene.internal class changed, as long as it&apos;s documented in the &quot;Changes in back-compat&quot; section in CHANGES, as a FYI - not because it&apos;s a change in the policy, so I can read about it quickly (that&apos;s the first section I usually check).&lt;/p&gt;

&lt;p&gt;That class is just a reference to Lucene&apos;s core files. If you want to write that &apos;Sweep&apos; thing, you might benefit from knowing what is a core Lucene file and delegate the sweep task to a core Lucene instance, while sweeping the rest of the files by another instance (which created them?). If Lucene core will create files w/ other names/extensions, then I believe this class (IFN) should be changed entirely, but I don&apos;t think making it public blocks any of these changes, as long as it&apos;s tagged by @lucene.internal.&lt;/p&gt;</comment>
                    <comment id="12837652" author="shaie" created="Wed, 24 Feb 2010 06:36:37 +0000"  >&lt;p&gt;Updated TestFileSwitchDirectory to use the constants instead of hard coding &quot;fdt&quot; and &quot;fdx&quot;. It couldn&apos;t have done that because IFN was package-private, which shows the problem with it.&lt;/p&gt;</comment>
                    <comment id="12837879" author="mikemccand" created="Wed, 24 Feb 2010 16:56:24 +0000"  >&lt;p&gt;Patch looks good Shai!&lt;/p&gt;

&lt;p&gt;But I don&apos;t think we should back port to 3.0.2 &amp;#8211; it&apos;s non-trivial&lt;br/&gt;
enough that there is some risk?&lt;/p&gt;

&lt;p&gt;As the API is now marked @lucene.internal, and it&apos;ll only be very&lt;br/&gt;
expert usage, I&apos;m not as concerned as Marvin is about the risks of&lt;br/&gt;
even exposing this.  Also, even with flex, a good number of Lucene&apos;s&lt;br/&gt;
index files are not under codec control (codec only touches postings&lt;br/&gt;
files &amp;#8211; .tis, .tii, .frq, .prx for the standard codec).  But I do&lt;br/&gt;
agree it&apos;s not ideal that the knowledge of file extensions is split&lt;br/&gt;
across this class and the codec.  The IndexFileNameFilter in flex now&lt;br/&gt;
takes a Codec as input, to make up for that... but IndexFileNames just&lt;br/&gt;
has a NOTE at the top stating the limitation.&lt;/p&gt;</comment>
                    <comment id="12837880" author="shaie" created="Wed, 24 Feb 2010 17:00:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I don&apos;t think we should back port to 3.0.2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, I can live w/ 3.1, as long as it&apos;s not released at the end of 2010. I can for now put that part of my code in o.a.l.index, until 3.1 is out.&lt;/p&gt;

&lt;p&gt;As I wrote in the TestFileSwitchDirectory comment, this IMO has to go in, because otherwise it would make the code of users of FSD fragile (potentially).&lt;/p&gt;

&lt;p&gt;Thanks for looking at this !&lt;/p&gt;</comment>
                    <comment id="12837883" author="thetaphi" created="Wed, 24 Feb 2010 17:03:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I don&apos;t think we should back port to 3.0.2 - it&apos;s non-trivial enough that there is some risk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please no backport to 3.0.2, its an API change. And we are not sure if there will be ever a 3.0.2. BTW: Version 3.0.1 comes out latest on Friday, will appear on the mirrors soon!&lt;/p&gt;</comment>
                    <comment id="12837988" author="creamyg" created="Wed, 24 Feb 2010 20:08:41 +0000"  >&lt;p&gt;&amp;gt; As the API is now marked @lucene.internal, and it&apos;ll only be very&lt;br/&gt;
&amp;gt; expert usage, I&apos;m not as concerned as Marvin is about the risks of&lt;br/&gt;
&amp;gt; even exposing this. &lt;/p&gt;

&lt;p&gt;Um, the only possible concerns I could have had were regarding public exposure&lt;br/&gt;
of this API.  If it&apos;s marked as internal, it&apos;s an implementation detail.&lt;br/&gt;
Whether or not the dot is included in internal-use-only constant strings isn&apos;t&lt;br/&gt;
something I&apos;m going to waste a lot of time thinking about. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So now, not only do I really, really not care whether this goes in, I have no&lt;br/&gt;
qualms about it either.&lt;/p&gt;

&lt;p&gt;Having users like Shai who are willing to recompile and regenerate to take&lt;br/&gt;
advantage of experimental features is a big boon, as it allows us to test&lt;br/&gt;
drive features before declaring them stable.  Designing optimal APIs without&lt;br/&gt;
usability testing is difficult to impossible.&lt;/p&gt;</comment>
                    <comment id="12838931" author="mikemccand" created="Fri, 26 Feb 2010 16:53:09 +0000"  >&lt;p&gt;Thanks Shai!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12436823" name="LUCENE-2282.patch" size="42835" author="shaie" created="Wed, 24 Feb 2010 06:36:37 +0000" />
                    <attachment id="12436763" name="LUCENE-2282.patch" size="41805" author="shaie" created="Tue, 23 Feb 2010 21:31:03 +0000" />
                    <attachment id="12436762" name="LUCENE-2282.patch" size="41779" author="shaie" created="Tue, 23 Feb 2010 21:20:24 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 23 Feb 2010 21:10:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11510</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25443</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>