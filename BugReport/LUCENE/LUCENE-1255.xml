<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:05:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-1255/LUCENE-1255.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-1255] CheckIndex should allow term position = -1</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-1255</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>
&lt;p&gt;Spinoff from this discussion:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200803.mbox/%3CPine.LNX.4.62.0803292323350.16762@radix.cryptio.net%3E&quot; class=&quot;external-link&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-java-user/200803.mbox/%3CPine.LNX.4.62.0803292323350.16762@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Right now CheckIndex claims the index is corrupt if you index a Token with -1 position, which happens if your first token has positionIncrementGap set to 0.&lt;/p&gt;

&lt;p&gt;But, as far as I can tell, Lucene doesn&apos;t &quot;mind&quot; when this happens.&lt;/p&gt;

&lt;p&gt;So I plan to fix CheckIndex to allow this case.  I&apos;ll backport to 2.3.2 as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1253&quot; title=&quot;LengthFilter and other TokenFilters that skip tokens ignore relative positionIncrement&quot;&gt;&lt;del&gt;LUCENE-1253&lt;/del&gt;&lt;/a&gt; is one example where Lucene&apos;s core analyzers could do this.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12392738">LUCENE-1255</key>
            <summary>CheckIndex should allow term position = -1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Mar 2008 14:21:48 +0100</created>
                <updated>Wed, 26 Jan 2011 15:26:36 +0000</updated>
                    <resolved>Tue, 29 Apr 2008 22:48:07 +0100</resolved>
                            <version>2.4</version>
                                <fixVersion>2.3.2</fixVersion>
                <fixVersion>2.4</fixVersion>
                                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12583684" author="mikemccand" created="Mon, 31 Mar 2008 14:39:31 +0100"  >&lt;p&gt;Attached patch.  I plan to commit in a day or two.&lt;/p&gt;

&lt;p&gt;I also noticed that CheckIndex would incorrectly mark an index as corrupt if two sequential positions are the same, which of course is perfectly fine (eg if you are injecting synonyms with positionIncrementGap=0).  So I fixed that case too.&lt;/p&gt;</comment>
                    <comment id="12583794" author="hossman" created="Mon, 31 Mar 2008 19:50:07 +0100"  >&lt;p&gt;FWIW: Apparently Luke gets confused by this as well.&lt;/p&gt;

&lt;p&gt;if i&apos;m understanding correctly, the only reason position &quot;-1&quot; seems to come about is because of some internal counter that starts at &quot;-1&quot; since it assumes the first token will have an increment of &quot;1&quot; and thus: the first position used is &quot;0&quot;&lt;/p&gt;

&lt;p&gt;Changing IndexWriter/DocumentsWriter/whatever to ignore the increment of the first Token, or make it realitve to &quot;0&quot; might be a better solution in general.&lt;/p&gt;

&lt;p&gt;cases to consider: what should it mean for position info if:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;first token has increment of 0&lt;/li&gt;
	&lt;li&gt;first token has increment of 1&lt;/li&gt;
	&lt;li&gt;first token has increment of 27&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;in my opinion, the answers should probably be: 0, 1, 27 ... but i think that changes the common case of &quot;1&quot; (which would currently gets a position of &quot;0&quot; right?) ... so maybe the right behavior is 0,0,26&lt;/p&gt;
</comment>
                    <comment id="12583797" author="cutting" created="Mon, 31 Mar 2008 19:55:50 +0100"  >&lt;p&gt;Since the increment is relative to the prior token, it should make no difference when there is no prior token.  So shouldn&apos;t the first token be at position=0 no matter what its increment?&lt;/p&gt;</comment>
                    <comment id="12583802" author="hossman" created="Mon, 31 Mar 2008 20:12:52 +0100"  >&lt;blockquote&gt;&lt;p&gt;Since the increment is relative to the prior token, it should make no difference when there is no prior token. So shouldn&apos;t the first token be at position=0 no matter what its increment?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m ok with that ... but the other way to look at it is that there is a &quot;virtual token&quot; signifing the start of the Field, and the first physical tokens increment is relative that ... with things like SpanFirstQueries not allowing the &quot;first&quot; token to specify an arbitrary increment from the &apos;virtual&quot; start of the field has real consequences.&lt;/p&gt;

&lt;p&gt;(consider an Analyzer that only indexes proper names and wants to record real positions so that a SpanFirstQuery can find docs where Doug Cutting appears in the first 100 Tokens)&lt;/p&gt;</comment>
                    <comment id="12583808" author="cutting" created="Mon, 31 Mar 2008 20:30:47 +0100"  >&lt;p&gt;Hoss: you&apos;re right, the change I proposed would be incompatible and might make some applications more difficult to write, with little benefit except aesthetic.&lt;/p&gt;</comment>
                    <comment id="12583832" author="mikemccand" created="Mon, 31 Mar 2008 21:39:31 +0100"  >&lt;p&gt;OK so I&apos;ll change the patch so that the first Token&apos;s position is max(0, increment-1).&lt;/p&gt;

&lt;p&gt;This only changes the &quot;increment=0&quot; case to now set position to 0 not -1.&lt;/p&gt;

&lt;p&gt;And I&apos;ll change CheckIndex again to reject position == -1.&lt;/p&gt;</comment>
                    <comment id="12583899" author="mikemccand" created="Mon, 31 Mar 2008 23:04:11 +0100"  >&lt;p&gt;Attached new patch.&lt;/p&gt;</comment>
                    <comment id="12592898" author="michaelbusch" created="Mon, 28 Apr 2008 22:24:22 +0100"  >&lt;p&gt;I don&apos;t think this was a backwards-compatible change.&lt;/p&gt;

&lt;p&gt;With this change you can&apos;t tell anymore if the first token had a positionIncrement&lt;br/&gt;
set to 0 or 1. TermPositions.nextPosition() returns 0 in both cases. Applications&lt;br/&gt;
today might rely on getting -1 from nextPosition() in the former case.&lt;/p&gt;</comment>
                    <comment id="12592909" author="mikemccand" created="Mon, 28 Apr 2008 23:03:20 +0100"  >&lt;p&gt;Hmm, you&apos;re right.&lt;/p&gt;

&lt;p&gt;OK so I guess we should revert it entirely, on 2.4 &amp;amp; 2.3.2, and continue to accept -1 position in the index?  It doesn&apos;t seem to cause any real harm, except CheckIndex was &lt;span class=&quot;error&quot;&gt;&amp;#91;incorrectly&amp;#93;&lt;/span&gt; flagging it as corruption, and, Luke was also unhappy with it.&lt;/p&gt;</comment>
                    <comment id="12592910" author="michaelbusch" created="Mon, 28 Apr 2008 23:10:44 +0100"  >&lt;blockquote&gt;
&lt;p&gt;OK so I guess we should revert it entirely, on 2.4 &amp;amp; 2.3.2, and continue to accept -1 position in the index?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I think we should do that.&lt;/p&gt;</comment>
                    <comment id="12714039" author="markrmiller@gmail.com" created="Thu, 28 May 2009 17:17:59 +0100"  >&lt;p&gt;why should the first token have an increment of 1? I think the first token should always be 0. Increments are between tokens.&lt;/p&gt;

&lt;p&gt;and why do you want to know if the first token had an inc of 0 or 1? I think the -1 is a bug and it shows up elsewhere - eg spans,payloads, and most likely highlighting with the SpanHighlighter.&lt;/p&gt;</comment>
                    <comment id="12987052" author="thetaphi" created="Wed, 26 Jan 2011 15:26:36 +0000"  >&lt;p&gt;Fix reverted and corrected to disallow negative posIncr in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1542&quot; title=&quot;Lucene can incorrectly set the position of tokens that start a field with positonInc 0.&quot;&gt;&lt;del&gt;LUCENE-1542&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12392675">LUCENE-1253</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12415141">LUCENE-1542</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12378961" name="LUCENE-1255.patch" size="3732" author="mikemccand" created="Mon, 31 Mar 2008 14:39:31 +0100" />
                    <attachment id="12378982" name="LUCENE-1255.take2.patch" size="4624" author="mikemccand" created="Mon, 31 Mar 2008 23:04:11 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 31 Mar 2008 18:50:07 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12493</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26473</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>