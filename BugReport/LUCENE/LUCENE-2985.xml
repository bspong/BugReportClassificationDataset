<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:09:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2985/LUCENE-2985.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2985] Build SegmentCodecs incrementally for consistent codecIDs during indexing</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2985</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;currently we build the SegementCodecs during flush which is fine as long as no codec needs to know which fields it should handle. This will change with DocValues or when we expose StoredFields / TermVectors via Codec (see &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2621&quot; title=&quot;Extend Codec to handle also stored fields and term vectors&quot;&gt;&lt;del&gt;LUCENE-2621&lt;/del&gt;&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2935&quot; title=&quot;Let Codec consume entire document&quot;&gt;&lt;del&gt;LUCENE-2935&lt;/del&gt;&lt;/a&gt;). The other downside it that we don&apos;t have a consistent view of which codec belongs to which field during indexing and all FieldInfo instances are unassigned (set to -1). Instead we should build the SegmentCodecs incrementally as fields come in so no matter when a codec needs to be selected to process a document / field we have the right codec ID assigned.&lt;/p&gt;
</description>
                <environment></environment>
            <key id="12502173">LUCENE-2985</key>
            <summary>Build SegmentCodecs incrementally for consistent codecIDs during indexing</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2011 12:25:16 +0000</created>
                <updated>Fri, 10 May 2013 11:43:54 +0100</updated>
                    <resolved>Fri, 25 Mar 2011 16:24:46 +0000</resolved>
                            <version>4.0-ALPHA</version>
                <version>CSF branch</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                <fixVersion>CSF branch</fixVersion>
                                <component>core/codecs</component>
                <component>core/index</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13010098" author="simonw" created="Wed, 23 Mar 2011 12:39:24 +0000"  >&lt;p&gt;here is an initial patch that uses a SegmentCodecBuilder to assign codec IDs during indexing in DocFieldProcessorPerThread.&lt;/p&gt;</comment>
                    <comment id="13010778" author="mikemccand" created="Thu, 24 Mar 2011 17:24:09 +0000"  >&lt;p&gt;Patch looks great!&lt;/p&gt;

&lt;p&gt;I wonder if we should pass the segmentCodecsBuilder to FieldInfos?  This way, FieldInfos.add/update could set the codecID, instead of caller doing it after the fact (in DocFieldProcessorPerThread)?&lt;/p&gt;</comment>
                    <comment id="13010798" author="simonw" created="Thu, 24 Mar 2011 17:46:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I wonder if we should pass the segmentCodecsBuilder to FieldInfos? This way, FieldInfos.add/update could set the codecID, instead of caller doing it after the fact (in DocFieldProcessorPerThread)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;here is the thing, I first added it to FieldInfos since it appears to be the place for that kind of stuff. Yet, the first problem is that DocFieldProcessorPerThread is caching the FI for each DFPPerField so I would really need to add it to each FieldInfo (FI not FIs). Further having another invariant in FIs that only applies if we are writing is something I tried to prevent in the first place and eventually SegementCodecs is somewhat internal to the SegmentInfo and not to the FieldInfos and I tried to couple them only by the codec ID though. I agree this would be easier and less disturbing in the code. I&apos;d love to find a better way to do that really.... except of this part in DocFieldProcessorPerThread is smooth though :/&lt;/p&gt;</comment>
                    <comment id="13011187" author="simonw" created="Fri, 25 Mar 2011 13:20:38 +0000"  >&lt;p&gt;next iteration. This patch moves the SegmentCodecsBuilder into FieldInfos and forces DocFieldProcessorPerThread to update FieldInfo through the global FieldInfos instance. &lt;/p&gt;



&lt;p&gt;I changed the FieldInfos#add methods to FieldInfos#addOrUpdate and made SegmentCodecsBuilder package private, final and removed synchronization since it is guarded by FieldInfos during creation. This patch also fixes JavaDoc on SegmentCodecs since we build that now incrementatlly.&lt;/p&gt;

&lt;p&gt;Since we now update the FieldInfo through FieldInfos this looks much cleaner.&lt;/p&gt;

&lt;p&gt;I think this is ready to commit.&lt;/p&gt;</comment>
                    <comment id="13011245" author="simonw" created="Fri, 25 Mar 2011 15:40:22 +0000"  >&lt;p&gt;I will commit this in a bit if nobody objects&lt;/p&gt;</comment>
                    <comment id="13011259" author="simonw" created="Fri, 25 Mar 2011 16:24:36 +0000"  >&lt;p&gt;Committed revision 1085449.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12472405">LUCENE-2621</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12499259">LUCENE-2935</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12474615" name="LUCENE-2985.patch" size="34198" author="simonw" created="Fri, 25 Mar 2011 13:20:38 +0000" />
                    <attachment id="12474388" name="LUCENE-2985.patch" size="17567" author="simonw" created="Wed, 23 Mar 2011 12:39:24 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 24 Mar 2011 17:24:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10895</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24707</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>