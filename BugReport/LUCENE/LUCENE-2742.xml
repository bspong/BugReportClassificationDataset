<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 12:59:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-2742/LUCENE-2742.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-2742] Enable native per-field codec support </title>
                <link>https://issues.apache.org/jira/browse/LUCENE-2742</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Currently the codec name is stored for every segment and PerFieldCodecWrapper is used to enable codecs per fields which has recently brought up some issues (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2740&quot; title=&quot;PerFieldCodecWrapper causes crashes if not all per field codes have been used&quot;&gt;&lt;del&gt;LUCENE-2740&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2741&quot; title=&quot;Several Codecs use the same files - PerFieldCodecWrapper can not hold two codec using the same files&quot;&gt;&lt;del&gt;LUCENE-2741&lt;/del&gt;&lt;/a&gt;). When a codec name is stored lucene does not respect the actual codec used to encode a fields postings but rather the &quot;top-level&quot; Codec in such a case the name of the top-level codec is  &quot;PerField&quot; instead of &quot;Pulsing&quot; or &quot;Standard&quot; etc. The way this composite pattern works make the indexing part of codecs simpler but also limits its capabilities. By recoding the top-level codec in the segments file we rely on the user to &quot;configure&quot; the PerFieldCodecWrapper correctly to open a SegmentReader. If a fields codec has changed in the meanwhile we won&apos;t be able to open the segment.&lt;/p&gt;

&lt;p&gt;The issues &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2741&quot; title=&quot;Several Codecs use the same files - PerFieldCodecWrapper can not hold two codec using the same files&quot;&gt;&lt;del&gt;LUCENE-2741&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2740&quot; title=&quot;PerFieldCodecWrapper causes crashes if not all per field codes have been used&quot;&gt;&lt;del&gt;LUCENE-2740&lt;/del&gt;&lt;/a&gt; are actually closely related to the way PFCW is implemented right now. PFCW blindly creates codecs per field on request and at the same time doesn&apos;t have any control over the file naming nor if a two codec instances are created for two distinct fields even if the codec instance is the same. If so FieldsConsumer will throw an exception since the files it relies on are already created.&lt;/p&gt;

&lt;p&gt;Having PerFieldCodecWrapper AND a CodecProvider overcomplicates things IMO. In order to use per field codec a user should on the one hand register its custom codecs AND needs to build a PFCW which needs to be maintained in the &quot;user-land&quot; an must not change incompatible once a new IW of IR is created. What I would expect from Lucene is to enable me to register a codec in a provider and then tell the Field which codec it should use for indexing. For reading lucene should determ the codec automatically once a segment is opened. if the codec is not available in the provider that is a different story. Once we instantiate the composite codec in SegmentsReader we only have the codecs which are really used in this segment for free which in turn solves &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2740&quot; title=&quot;PerFieldCodecWrapper causes crashes if not all per field codes have been used&quot;&gt;&lt;del&gt;LUCENE-2740&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Yet, instead of relying on the user to configure PFCW I suggest to move composite codec functionality inside the core an record the distinct codecs per segment in the segments info. We only really need the distinct codecs used in that segment since the codec instance should be reused to prevent additional files to be created. Lets say we have the follwing codec mapping :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;field_a:Pulsing
field_b:Standard
field_c:Pulsing
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then we create the following mapping:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SegmentInfo:
[Pulsing, Standard]

PerField:
[field_a:0, field_b:1, field_c:0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;that way we can easily determ which codec is used for which field an build the composite - codec internally on opening SegmentsReader. This ordering has another advantage, if like in that case pulsing and standard use really the same type of files we need a way to distinguish the used files per codec within a segment. We can in turn pass the codec&apos;s ord (implicit in the SegmentInfo) to the FieldConsumer on creation to create files with segmentname_ord.ext (or something similar). This solvel &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2741&quot; title=&quot;Several Codecs use the same files - PerFieldCodecWrapper can not hold two codec using the same files&quot;&gt;&lt;del&gt;LUCENE-2741&lt;/del&gt;&lt;/a&gt;). &lt;/p&gt;</description>
                <environment></environment>
            <key id="12479196">LUCENE-2742</key>
            <summary>Enable native per-field codec support </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="simonw">Simon Willnauer</assignee>
                                <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Nov 2010 12:46:18 +0000</created>
                <updated>Fri, 10 May 2013 11:45:03 +0100</updated>
                    <resolved>Wed, 10 Nov 2010 16:40:16 +0000</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>core/index</component>
                <component>core/store</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12930025" author="simonw" created="Tue, 9 Nov 2010 09:26:07 +0000"  >&lt;p&gt;Here is a first patch - all tests pass. I changed the CodecProvider interface slightly to be able to hold perField codecs as well as a default perField codec. For simplicity users can not register their codec directly though the Fieldable interface. Internally I added a CodecInfo which handles all the ordering and registration per segment / field. For consistency I bound CodecInfo to FieldInfos since we are now operating per field. A codec can only be assigned once, at the first time we see the codec during FieldInfos creation. &lt;/p&gt;

&lt;p&gt;there is a nocommit on Fieldable since it doesn&apos;t have javadoc but lets iterate first to see if we wanna go that path - it seems close. &lt;/p&gt;</comment>
                    <comment id="12930584" author="simonw" created="Wed, 10 Nov 2010 12:40:07 +0000"  >&lt;p&gt;Updated patch which follows a slightly different approach. I build the codec ID record during segment flush since I learned the hard way that FieldInfo is maintained per IW session. I also added testcases including the ones from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2740&quot; title=&quot;PerFieldCodecWrapper causes crashes if not all per field codes have been used&quot;&gt;&lt;del&gt;LUCENE-2740&lt;/del&gt;&lt;/a&gt; an all test pass for me. &lt;/p&gt;

&lt;p&gt;Review and comments highly appreciated (marvin, mike? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;PS: I will leave the files support to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2741&quot; title=&quot;Several Codecs use the same files - PerFieldCodecWrapper can not hold two codec using the same files&quot;&gt;&lt;del&gt;LUCENE-2741&lt;/del&gt;&lt;/a&gt; but this already provide the infrastructure...&lt;/p&gt;</comment>
                    <comment id="12930603" author="simonw" created="Wed, 10 Nov 2010 14:24:43 +0000"  >&lt;p&gt;Another iteration.&lt;/p&gt;

&lt;p&gt;I fixed some code style violations (thanks mike &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, renamed CodecInfo to SegmentCodecs and made PerFieldCodecWrapper and SegmentCodecs package private. I also removed the suger from Fieldable and AbstractField. This patch also makes CodecProvider a real class (not abstract) and adds write once behavior to CodecProvider#setFieldCodec()&lt;/p&gt;

&lt;p&gt;I think this is very close now.&lt;/p&gt;</comment>
                    <comment id="12930607" author="simonw" created="Wed, 10 Nov 2010 14:32:16 +0000"  >&lt;p&gt;added JavaDoc to CodecProvider. I think we are ready to commit.&lt;/p&gt;</comment>
                    <comment id="12930609" author="simonw" created="Wed, 10 Nov 2010 14:34:05 +0000"  >&lt;p&gt;the testcases are included in this patch which fixes the problem&lt;/p&gt;</comment>
                    <comment id="12930630" author="simonw" created="Wed, 10 Nov 2010 15:51:58 +0000"  >&lt;p&gt;I added javadoc to SegmentCodecs and PerFieldCodecWrapper even they are @lucene.internal. I think it helps other devs to get into the internal and hopefully transports knowledge. I think we should make that mandatory for new classes and changes to at least document the big picture&lt;/p&gt;</comment>
                    <comment id="12930638" author="mikemccand" created="Wed, 10 Nov 2010 16:18:32 +0000"  >&lt;p&gt;+1 to commit &amp;#8211; great work Simon!&lt;/p&gt;</comment>
                    <comment id="12930645" author="simonw" created="Wed, 10 Nov 2010 16:35:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;+1 to commit - great work Simon!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I should note that this patch changes the index file format and it is not compatible with indexes build with previous TRUNK version. Indexes build with previous lucene versions will still work like a charm&lt;/p&gt;

&lt;p&gt;I will go ahead and commit&lt;/p&gt;</comment>
                    <comment id="12930647" author="simonw" created="Wed, 10 Nov 2010 16:40:16 +0000"  >&lt;p&gt;committed in revision 1033577&lt;/p&gt;

&lt;p&gt;I will send a heads up to the list due to the file format change&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                <outwardlinks description="incorporates">
                            <issuelink>
            <issuekey id="12479090">LUCENE-2740</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12479090">LUCENE-2740</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12479091">LUCENE-2741</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12459250" name="LUCENE-2742.patch" size="79775" author="simonw" created="Wed, 10 Nov 2010 15:51:58 +0000" />
                    <attachment id="12459242" name="LUCENE-2742.patch" size="77407" author="simonw" created="Wed, 10 Nov 2010 14:32:15 +0000" />
                    <attachment id="12459241" name="LUCENE-2742.patch" size="76356" author="simonw" created="Wed, 10 Nov 2010 14:24:43 +0000" />
                    <attachment id="12459238" name="LUCENE-2742.patch" size="76058" author="simonw" created="Wed, 10 Nov 2010 12:40:07 +0000" />
                    <attachment id="12459147" name="LUCENE-2742.patch" size="67206" author="simonw" created="Tue, 9 Nov 2010 09:26:07 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 10 Nov 2010 16:18:32 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>11109</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24950</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>