<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:01:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-947/LUCENE-947.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-947] Some improvements to contrib/benchmark</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-947</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;I&apos;ve made some small improvements to the contrib/benchmark, mostly&lt;br/&gt;
merging in the ad-hoc benchmarking code I&apos;ve been using in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-843&quot; title=&quot;improve how IndexWriter uses RAM to buffer added documents&quot;&gt;&lt;del&gt;LUCENE-843&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed thread safety of DirDocMaker&apos;s usage of SimpleDateFormat&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Print the props in sorted order&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added new config &quot;autocommit=true|false&quot; to CreateIndexTask&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added new config &quot;ram.flush.mb=int&quot; to AddDocTask&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added new configs &quot;doc.term.vector.positions=true|false&quot; and&lt;br/&gt;
    &quot;doc.term.vector.offsets=true|false&quot; to BasicDocMaker&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added WriteLineDocTask.java, so you can make an alg that uses this&lt;br/&gt;
    to build up a single file containing one document per line in a&lt;br/&gt;
    single file.  EG this alg converts the reuters-out tree into a&lt;br/&gt;
    single file that has ~1000 bytes per body field, saved to&lt;br/&gt;
    work/reuters.1000.txt:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      docs.dir=reuters-out&lt;br/&gt;
      doc.maker=org.apache.lucene.benchmark.byTask.feeds.DirDocMaker&lt;br/&gt;
      line.file.out=work/reuters.1000.txt&lt;br/&gt;
      doc.maker.forever=false&lt;br/&gt;
      &lt;/p&gt;
{WriteLineDoc(1000)}
&lt;p&gt;: *&lt;/p&gt;

&lt;p&gt;    Each line has tab-separted TITLE, DATE, BODY fields.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Created feeds/LineDocMaker.java that creates documents read from&lt;br/&gt;
    the file created by WriteLineDocTask.java.  EG this alg indexes&lt;br/&gt;
    all documents created above:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      analyzer=org.apache.lucene.analysis.SimpleAnalyzer&lt;br/&gt;
      directory=FSDirectory&lt;br/&gt;
      doc.add.log.step=500&lt;/p&gt;

&lt;p&gt;      docs.file=work/reuters.1000.txt&lt;br/&gt;
      doc.maker=org.apache.lucene.benchmark.byTask.feeds.LineDocMaker&lt;br/&gt;
      doc.tokenized=true&lt;br/&gt;
      doc.maker.forever=false&lt;/p&gt;

&lt;p&gt;      ResetSystemErase&lt;br/&gt;
      CreateIndex&lt;br/&gt;
      &lt;/p&gt;
{AddDoc}
&lt;p&gt;: *&lt;br/&gt;
      CloseIndex&lt;/p&gt;

&lt;p&gt;      RepSumByPref AddDoc&lt;/p&gt;

&lt;p&gt;I&apos;ll attach initial patch shortly.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12372820">LUCENE-947</key>
            <summary>Some improvements to contrib/benchmark</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jul 2007 14:41:30 +0100</created>
                <updated>Fri, 25 Jan 2008 03:23:59 +0000</updated>
                    <resolved>Wed, 25 Jul 2007 10:04:48 +0100</resolved>
                                            <fixVersion>2.3</fixVersion>
                                <component>modules/benchmark</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12509571" author="mikemccand" created="Mon, 2 Jul 2007 14:43:33 +0100"  >&lt;p&gt;First cut patch.&lt;/p&gt;</comment>
                    <comment id="12514449" author="mikemccand" created="Sun, 22 Jul 2007 02:17:06 +0100"  >&lt;p&gt;Another rev of this patch: small changes based on fixes for &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-843&quot; title=&quot;improve how IndexWriter uses RAM to buffer added documents&quot;&gt;&lt;del&gt;LUCENE-843&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-963&quot; title=&quot;Add setters to Field to allow re-use of Field instances during indexing&quot;&gt;&lt;del&gt;LUCENE-963&lt;/del&gt;&lt;/a&gt;.  I plan to commit in a day or two...&lt;/p&gt;</comment>
                    <comment id="12514494" author="doronc" created="Sun, 22 Jul 2007 19:28:22 +0100"  >&lt;p&gt;I missed that one, thanks for the reminder - just a few comments:&lt;/p&gt;

&lt;p&gt;1. TestPerfTasksParse - why do you prevent the testing of parsing of WriteLineDoc? &lt;br/&gt;
     I disabled the special handling of this and the test works as supposed.&lt;/p&gt;

&lt;p&gt;2. Documentation of new properties is missing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In CreateIndexTask: ram.flush.mb &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;,  autocommit &lt;span class=&quot;error&quot;&gt;&amp;#91;true&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;In byTask.package.html (same 2 props).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;3. run.flush &amp;amp; aotoCommit should be added &amp;amp; used &amp;amp; documented also in openIndexTask (currently only used in createIndexTask).&lt;/p&gt;

&lt;p&gt;4. AddDocTask:  flushAtRAMUsage - unused?&lt;/p&gt;

&lt;p&gt;5. buil.xml - 1024m as default for running a benchmark seems too much?&lt;br/&gt;
    I mean, one of the nice things about Lucene is that it can run for you even if you only have few MB of RAM to spare. For someone with a low level machine, say 512M only, the JVM might fail to even start, right?&lt;/p&gt;

&lt;p&gt;6. I like your change of factoring some of the field names into consts. We should probably do the same for the rest.&lt;/p&gt;

&lt;p&gt;7. I didn&apos; t try the new WriteLineDocTask and LineDocMaker feed. Partly because there was no ready to use alg for that under conf/, and also no test for that. Do you think we should add at least one of these two (preferably both)?  - I can help with this.&lt;/p&gt;</comment>
                    <comment id="12514600" author="mikemccand" created="Mon, 23 Jul 2007 11:33:05 +0100"  >&lt;p&gt;Thanks for the review Doron!&lt;/p&gt;

&lt;p&gt;&amp;gt; 1. TestPerfTasksParse - why do you prevent the testing of parsing of WriteLineDoc? &lt;br/&gt;
&amp;gt;     I disabled the special handling of this and the test works as supposed.&lt;/p&gt;

&lt;p&gt;Hmmm ... I was seeing a failure if I didn&apos;t do that because&lt;br/&gt;
WriteLineDoc requires &quot;line.file.out&quot; Config to be set and that test&lt;br/&gt;
didn&apos;t know to do so.  I&apos;ll put it back into the test but add&lt;br/&gt;
&quot;line.file.out&quot; for this task.&lt;/p&gt;

&lt;p&gt;&amp;gt; 2. Documentation of new properties is missing:&lt;br/&gt;
&amp;gt;      - In CreateIndexTask: ram.flush.mb &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;,  autocommit &lt;span class=&quot;error&quot;&gt;&amp;#91;true&amp;#93;&lt;/span&gt;&lt;br/&gt;
&amp;gt;      - In byTask.package.html (same 2 props).&lt;/p&gt;

&lt;p&gt;OK, I&apos;ll add this and also for &quot;doc.term.vector.&lt;/p&gt;
{offsets,positions}
&lt;p&gt;&quot;&lt;br/&gt;
to BasicDocMaker.&lt;/p&gt;

&lt;p&gt;&amp;gt; 3. run.flush &amp;amp; aotoCommit should be added &amp;amp; used &amp;amp; documented also in openIndexTask (currently only used in createIndexTask).&lt;/p&gt;

&lt;p&gt;OK, I&apos;ll add this.&lt;/p&gt;

&lt;p&gt;&amp;gt; 4. AddDocTask:  flushAtRAMUsage - unused?&lt;/p&gt;

&lt;p&gt;Yup, this was leftover from pre &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-843&quot; title=&quot;improve how IndexWriter uses RAM to buffer added documents&quot;&gt;&lt;del&gt;LUCENE-843&lt;/del&gt;&lt;/a&gt; where you had to check RAM&lt;br/&gt;
usage after each doc and then flush.  I&apos;ll remove it and actually just revert&lt;br/&gt;
to current AddDocTask.java (I don&apos;t need any mods here).&lt;/p&gt;

&lt;p&gt;&amp;gt; 5. buil.xml - 1024m as default for running a benchmark seems too much?&lt;br/&gt;
&amp;gt;     I mean, one of the nice things about Lucene is that it can run for you even if you only have few MB of RAM to spare. For someone with a low level machine, say 512M only, the JVM might fail to even start, right?&lt;/p&gt;

&lt;p&gt;Woops... I didn&apos;t mean to put this change in.  I&apos;ll leave it where it&lt;br/&gt;
was (140 MB) and remove the &quot;-server&quot; jvmarg as well.  I was hitting&lt;br/&gt;
OOM on some Wikipedia algs.&lt;/p&gt;

&lt;p&gt;&amp;gt; 6. I like your change of factoring some of the field names into consts. We should probably do the same for the rest.&lt;/p&gt;

&lt;p&gt;OK I&apos;ll pull out the remaining ones...&lt;/p&gt;

&lt;p&gt;&amp;gt; 7. I didn&apos; t try the new WriteLineDocTask and LineDocMaker feed. Partly because there was no ready to use alg for that under conf/, and also no test for that. Do you think we should add at least one of these two (preferably both)?  - I can help with this.&lt;/p&gt;

&lt;p&gt;OK I&apos;ll do both of these.&lt;/p&gt;</comment>
                    <comment id="12514617" author="mikemccand" created="Mon, 23 Jul 2007 13:54:46 +0100"  >&lt;p&gt;Next iteration of the patch (with Doron&apos;s suggested fixes).&lt;/p&gt;</comment>
                    <comment id="12514776" author="doronc" created="Mon, 23 Jul 2007 21:59:58 +0100"  >&lt;p&gt;Thanks for fixing this Michael, and as usual so fast! &lt;/p&gt;

&lt;p&gt;I was able to run the new alg files and the new tests.&lt;/p&gt;

&lt;p&gt;Few more comments: &lt;/p&gt;

&lt;p&gt;WriteLineDocTask has all the work done in Setup(). This is a bit wrong&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Usually only preparation is done in the Setup(), but real work (things we measure) should be in doLogic().  Mmm... would probably make more sense to move the file handling code from the constructor to setup(), and the doc creation code (except for docMaker extraction) from setup() to doLogic(). This should also prevent the error in TestPerfTasksParse (I think no changes would then be required in this test.) &lt;/p&gt;

&lt;p&gt;Unused imports and dateFormat in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LineDocMaker&lt;/li&gt;
	&lt;li&gt;WriteLineDocTask&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For LineDocMaker, I was puzzled why you chose not to implement getNextDocData() and not base on BasicDocMaker to create the next doc for you. I now understand this is for reusing the Document and Field objects that BasicDocMaker does not support. I would add a comment on that. &lt;/p&gt;

&lt;p&gt;The new consts in BasicDocMaker can now be used in few more places....&lt;/p&gt;</comment>
                    <comment id="12514777" author="doronc" created="Mon, 23 Jul 2007 22:01:44 +0100"  >&lt;p&gt;take4 has the last comments fixed...&lt;br/&gt;
(one thing I can&apos;t seem to get rid of is that my svn client started assigning &quot;executable&quot; to new files...)&lt;/p&gt;</comment>
                    <comment id="12514936" author="mikemccand" created="Tue, 24 Jul 2007 11:01:43 +0100"  >&lt;p&gt;This looks great Doron, thanks.&lt;/p&gt;

&lt;p&gt;I have one more mod, which is to prefix the log prints from AddDocTask with the net elapsed time since startup (I like to see net elapsed time as algo is running to get a sense of performance difference before full task finishes...).  I will attach a new patch.&lt;/p&gt;</comment>
                    <comment id="12514938" author="mikemccand" created="Tue, 24 Jul 2007 11:31:36 +0100"  >&lt;p&gt;New rev, I think ready to commit!  I added elapsed time print to AddDocTask and also fixed the new LineDoc unit test to work properly when run (&quot;ant test-contrib&quot;) from main Lucene directory.   I also added the comment about re-using Document &amp;amp; Field instances in LineDocMaker.&lt;/p&gt;</comment>
                    <comment id="12515087" author="doronc" created="Tue, 24 Jul 2007 21:45:21 +0100"  >&lt;p&gt;It looks good Michael! (I like the time printing.)&lt;/p&gt;

&lt;p&gt;Mmm one test issue in Windows - the reading of linFile in testLineDocFile treats the &apos;\&apos; as control char, so &quot;\temp&quot; reads as &quot;TAB est&quot; and the test fails. If you tested this in Linux you had &apos;/&apos; as separator and wouldn&apos;t see this failure. &lt;/p&gt;

&lt;p&gt;To fix this you can change twice in testLineDocFile() from&lt;br/&gt;
     &quot;line.file.out=&quot; + lineFile,&lt;br/&gt;
to&lt;br/&gt;
      &quot;line.file.out=&quot; + lineFile.getAbsolutePath().replace(&apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos;,&apos;/&apos;),&lt;/p&gt;

&lt;p&gt;This works for me in Windows, should also work in Linux and such - but I don&apos;t have one to check on...&lt;/p&gt;</comment>
                    <comment id="12515099" author="mikemccand" created="Tue, 24 Jul 2007 22:47:53 +0100"  >&lt;p&gt;&amp;gt; Mmm one test issue in Windows - the reading of linFile in&lt;br/&gt;
&amp;gt; testLineDocFile treats the &apos;\&apos; as control char, so &quot;\temp&quot; reads as&lt;br/&gt;
&amp;gt; &quot;TAB est&quot; and the test fails. If you tested this in Linux you had&lt;br/&gt;
&amp;gt; &apos;/&apos; as separator and wouldn&apos;t see this failure.&lt;/p&gt;

&lt;p&gt;Wooooops!  Thanks for catching this.&lt;/p&gt;

&lt;p&gt;&amp;gt; To fix this you can change twice in testLineDocFile() from&lt;br/&gt;
&amp;gt;      &quot;line.file.out=&quot; + lineFile,&lt;br/&gt;
&amp;gt; to&lt;br/&gt;
&amp;gt;       &quot;line.file.out=&quot; + lineFile.getAbsolutePath().replace(&apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos;,&apos;/&apos;),&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; This works for me in Windows, should also work in Linux and such - but I don&apos;t have one to check on... &lt;/p&gt;

&lt;p&gt;OK I&apos;ll make that change &amp;amp; test cross platform and then commit!&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12360938" name="LUCENE-947.patch" size="22590" author="mikemccand" created="Mon, 2 Jul 2007 14:43:33 +0100" />
                    <attachment id="12362295" name="LUCENE-947.take2.patch" size="21148" author="mikemccand" created="Sun, 22 Jul 2007 02:17:05 +0100" />
                    <attachment id="12362335" name="LUCENE-947.take3.patch" size="29632" author="mikemccand" created="Mon, 23 Jul 2007 13:54:46 +0100" />
                    <attachment id="12362370" name="LUCENE-947.take4.patch" size="30842" author="doronc" created="Mon, 23 Jul 2007 22:01:44 +0100" />
                    <attachment id="12362420" name="LUCENE-947.take5.patch" size="33281" author="mikemccand" created="Tue, 24 Jul 2007 11:31:36 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 22 Jul 2007 18:28:22 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>12795</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>26782</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>