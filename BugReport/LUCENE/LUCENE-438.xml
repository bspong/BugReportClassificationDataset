<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:15:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-438/LUCENE-438.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-438] add Token.setTermText(), remove final</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-438</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;The Token class should be more friendly to classes not in it&apos;s package:&lt;br/&gt;
  1) add setTermText()&lt;br/&gt;
  2) remove final from class and toString()&lt;br/&gt;
  3) add clone()&lt;/p&gt;

&lt;p&gt;Support for (1):&lt;br/&gt;
  TokenFilters in the same package as Token are able to do things like &lt;br/&gt;
   &quot;t.termText = t.termText.toLowerCase();&quot; which is more efficient, but more importantly less error prone.  Without the ability to change &lt;b&gt;only&lt;/b&gt; the term text, a new Token must be created, and one must remember to set all the properties correctly.  This exact issue caused this bug:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/LUCENE-437&quot; class=&quot;external-link&quot;&gt;http://issues.apache.org/jira/browse/LUCENE-437&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Support for (2):&lt;br/&gt;
  Removing final allows one to subclass Token.  I didn&apos;t see any performance impact after removing final.&lt;br/&gt;
I can go into more detail on why I want to subclass Token if anyone is interested.&lt;/p&gt;

&lt;p&gt;Support for (3):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;support for a synonym TokenFilter, where one needs to make two tokens from one (same args that support (1), and esp important if instance is a subclass of Token).&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
            <key id="12317228">LUCENE-438</key>
            <summary>add Token.setTermText(), remove final</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2005 06:46:01 +0100</created>
                <updated>Thu, 2 Jun 2011 23:03:13 +0100</updated>
                    <resolved>Fri, 2 Jun 2006 05:15:39 +0100</resolved>
                                            <fixVersion>2.1</fixVersion>
                                        <due></due>
                    <votes>3</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12330239" author="ehatcher" created="Fri, 23 Sep 2005 09:43:59 +0100"  >&lt;p&gt;Yes, please elaborate on why you need to subclass Token.&lt;/p&gt;</comment>
                    <comment id="12330250" author="yseeley@gmail.com" created="Fri, 23 Sep 2005 12:55:45 +0100"  >&lt;p&gt;Mostly to convey information across TokenFilters, and the single type string isn&apos;t sufficient.&lt;br/&gt;
For exampe, I&apos;d like to have an int or long that can be used as 32 or 64 independent flags.&lt;/p&gt;

&lt;p&gt;In general, having attributes you can dynamically attach to tokens allows to you decompose token filters to more basic functions and thus gives greater power to filter chains.&lt;/p&gt;

&lt;p&gt;Some use cases I can think of:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;conditionals... mark tokens in one filter and conditionally act on them in another.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;decouple the marking of tokens from the transformation of tokens... one could have a&lt;br/&gt;
  TokenMatcherFilter that would tag certain tokens that matched a regex, for example.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected tokens: mark certain words as &quot;do not change&quot;, &quot;do not stem&quot;, &quot;do not lowercase&quot; for instance.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mark tokens that are split from a larger token (for example when a camelCase filter splits &quot;fooBar&quot; into &quot;foo Bar&quot;) so they may be treated differently by other filters&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;performance (hey it comes for free).  You can do things like StandardTokenFilter, which checks the type of the token and doesn&apos;t have to re-parse every single token.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve already had to implement TokenFilter functionality (protected tokens, token splitting and combining)  where I&apos;ve had to stuff more functionallity than I&apos;d like into a single filter because of then inability of one filter to provide more info to another.&lt;/p&gt;

&lt;p&gt;So I think there&apos;s a strong case for being able to dynamically add attributes (set bit flags) on a token.  I planned on subclassing Token to achieve that.  But because I don&apos;t know what other people may need/want in the future, making it so one can provide extensions to Token via inheritance seems like a good thing.&lt;/p&gt;
</comment>
                    <comment id="12330260" author="markh" created="Fri, 23 Sep 2005 17:57:32 +0100"  >&lt;p&gt;&amp;gt;&amp;gt;Mostly to convey information across TokenFilters&lt;/p&gt;

&lt;p&gt;Could you not achieve this communication using ThreadLocals?&lt;/p&gt;

&lt;p&gt;Do we know what the performance cost is of making Token non-final?&lt;/p&gt;
</comment>
                    <comment id="12330276" author="yseeley@gmail.com" created="Fri, 23 Sep 2005 23:19:48 +0100"  >&lt;p&gt;&amp;gt; Could you not achieve this communication using ThreadLocals? &lt;br/&gt;
Yes, but it would make me queasy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Performance would also be less than desirable because you would have to stick every token in a HashMap in that thread local and then retrieve them again in the next TokenFilter.&lt;/p&gt;

&lt;p&gt;&amp;gt; Do we know what the performance cost is of making Token non-final?&lt;br/&gt;
That is the key question.  There is no reason not to make it non-final if there isn&apos;t a performance impact.&lt;/p&gt;

&lt;p&gt;In my general experience with recent hotspot JVMs, final on classes almost never make a difference.  &quot;final&quot; applied to variables, however, can still make a big difference.  I think the JVMs can tell if there are any loaded subclasses, and if not, treat it as final.&lt;/p&gt;

&lt;p&gt;In the context of indexing, I couldn&apos;t detect any difference in speed.  I&apos;ll try and isolate it more.&lt;/p&gt;</comment>
                    <comment id="12330290" author="markh" created="Sat, 24 Sep 2005 02:07:10 +0100"  >&lt;p&gt;Yes it is slower/uglier. I was hoping you could spare the CPU cycles and solve your specific communication problem this ThreadLocal way rather than inflicting extra CPU cycles on everyone else &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Would be interesting to know exactly what removing final is going to cost.&lt;/p&gt;</comment>
                    <comment id="12330320" author="yseeley@gmail.com" created="Sat, 24 Sep 2005 07:47:16 +0100"  >&lt;p&gt;As expected, I haven&apos;t been able to find a performance difference after applying this patch with 1.4.2 or 1.5 JVMs.&lt;/p&gt;

&lt;p&gt;java5 -server 10000000 TokCreate&lt;br/&gt;
time=10636&lt;br/&gt;
time=10636&lt;br/&gt;
time=10575&lt;br/&gt;
time=10705&lt;br/&gt;
time=10706&lt;/p&gt;

&lt;p&gt;java5 -server 10000000 TokCreate  // Token patch applied (non-final)&lt;br/&gt;
time=10595&lt;br/&gt;
time=10516&lt;br/&gt;
time=10575&lt;br/&gt;
time=10515&lt;br/&gt;
time=10525&lt;/p&gt;

&lt;p&gt;java5 -server 2000000 TokChain &lt;br/&gt;
time=9484&lt;br/&gt;
time=9473&lt;br/&gt;
time=9514&lt;br/&gt;
time=9494&lt;br/&gt;
time=9502&lt;/p&gt;

&lt;p&gt;java5 -server 2000000 TokChain  // Token patch applied (non-final)&lt;br/&gt;
time=9494&lt;br/&gt;
time=9434&lt;br/&gt;
time=9444&lt;br/&gt;
time=9443&lt;br/&gt;
time=9444&lt;/p&gt;

&lt;p&gt;java4 -server 10000000 TokCreate&lt;br/&gt;
time=9294&lt;br/&gt;
time=9323&lt;br/&gt;
time=9274&lt;br/&gt;
time=9344&lt;br/&gt;
time=9384&lt;/p&gt;

&lt;p&gt;java4 -server 10000000 TokCreate  // Token patch applied (non-final)&lt;br/&gt;
time=9254&lt;br/&gt;
time=9233&lt;br/&gt;
time=9283&lt;br/&gt;
time=9283&lt;br/&gt;
time=9224&lt;/p&gt;

&lt;p&gt;java4 -server 2000000 TokChain&lt;br/&gt;
time=7150&lt;br/&gt;
time=7171&lt;br/&gt;
time=7171&lt;br/&gt;
time=7120&lt;br/&gt;
time=7160&lt;/p&gt;

&lt;p&gt;java4 -server 2000000 TokChain // Token patch applied (non-final)&lt;br/&gt;
time=7101&lt;br/&gt;
time=7150&lt;br/&gt;
time=7140&lt;br/&gt;
time=7160&lt;br/&gt;
time=7110&lt;/p&gt;

&lt;p&gt;java5 -client 10000000 TokCreate  &lt;br/&gt;
time=23384&lt;br/&gt;
time=23253&lt;br/&gt;
time=23534&lt;/p&gt;

&lt;p&gt;java5 -client 10000000 TokCreate  // Token patch applied (non-final)&lt;br/&gt;
time=23373&lt;br/&gt;
time=23694&lt;br/&gt;
time=23384&lt;/p&gt;</comment>
                    <comment id="12330321" author="yseeley@gmail.com" created="Sat, 24 Sep 2005 07:49:19 +0100"  >&lt;p&gt;token performance tests&lt;/p&gt;</comment>
                    <comment id="12378700" author="cutting" created="Wed, 10 May 2006 03:20:21 +0100"  >&lt;p&gt;+1  This sounds like a good change.&lt;/p&gt;</comment>
                    <comment id="12414302" author="yseeley@gmail.com" created="Fri, 2 Jun 2006 05:15:39 +0100"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                    <comment id="12476255" author="mikemccand" created="Tue, 27 Feb 2007 18:10:32 +0000"  >&lt;p&gt;Closing all issues that were resolved for 2.1.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12314525" name="SpeedTest.java" size="582" author="yseeley@gmail.com" created="Sat, 24 Sep 2005 07:49:18 +0100" />
                    <attachment id="12314526" name="TokenSpeed.java" size="3568" author="yseeley@gmail.com" created="Sat, 24 Sep 2005 07:49:18 +0100" />
                    <attachment id="12314503" name="yonik_Token.txt" size="1564" author="yseeley@gmail.com" created="Fri, 23 Sep 2005 06:46:45 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 23 Sep 2005 08:43:59 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>13311</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27293</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>