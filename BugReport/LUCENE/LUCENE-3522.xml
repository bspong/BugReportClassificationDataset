<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Tue Jul 16 13:14:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-3522/LUCENE-3522.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-3522] TermsFilter.getDocIdSet(context) NPE on missing field</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-3522</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;If the context does not contain the field for a term when calling TermsFilter.getDocIdSet(AtomicReaderContext context) then a NullPointerException is thrown due to not checking for null Terms before getting iterator.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12527391">LUCENE-3522</key>
            <summary>TermsFilter.getDocIdSet(context) NPE on missing field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mikemccand">Michael McCandless</assignee>
                                <reporter username="aberdeen61">Dan Climan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Oct 2011 05:56:45 +0100</created>
                <updated>Fri, 10 May 2013 11:44:19 +0100</updated>
                    <resolved>Mon, 17 Oct 2011 13:26:39 +0100</resolved>
                            <version>4.0-ALPHA</version>
                                <fixVersion>4.0-ALPHA</fixVersion>
                                <component>modules/other</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13128667" author="aberdeen61" created="Mon, 17 Oct 2011 05:59:21 +0100"  >&lt;p&gt;Proposed patch to TermsFilter and TermsFilterTest showing problem and demonstrating fix&lt;/p&gt;</comment>
                    <comment id="13128812" author="shaie" created="Mon, 17 Oct 2011 13:23:49 +0100"  >&lt;p&gt;Good catch Dan!&lt;/p&gt;

&lt;p&gt;Patch looks good, but I have some comments about the test:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;You don&apos;t close the directories at the end of it, and the test fails due that.&lt;/li&gt;
	&lt;li&gt;I think it can be simplified to create just one Directory, with &quot;f1:content&quot; and request &quot;f2:content&quot;. I actually tried it and the test still fails (NPE reproduced without your fix).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Here is the modified, more compact, test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingField() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-comment&quot;&gt;// LUCENE-3522: &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; requested field does not exist in the index, TermsFilter threw NPE.
&lt;/span&gt;    Directory dir = newDirectory();
    RandomIndexWriter writer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomIndexWriter(random, dir);
    Document doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Document();
    doc.add(newField(&lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt;, StringField.TYPE_STORED));
    writer.addDocument(doc);
    IndexReader reader = writer.getReader();
    writer.close();
    
    TermsFilter tf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsFilter();
    tf.addTerm(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term(&lt;span class=&quot;code-quote&quot;&gt;&quot;f2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt;));
    
    FixedBitSet bits = (FixedBitSet) tf.getDocIdSet(reader.getTopReaderContext().leaves()[0]);
    assertTrue(&lt;span class=&quot;code-quote&quot;&gt;&quot;Must be &amp;gt;= 0&quot;&lt;/span&gt;, bits.cardinality() &amp;gt;= 0);      
    reader.close();
    dir.close();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would you mind changing the test case to this compact one? Or did you want to demonstrate something else with the two readers?&lt;/p&gt;</comment>
                    <comment id="13128813" author="mikemccand" created="Mon, 17 Oct 2011 13:26:39 +0100"  >&lt;p&gt;Thanks Dan!&lt;/p&gt;

&lt;p&gt;I committed to trunk and backported the test case to 3.x.  I had to add missing rd1/2.close() at the end of the test case.&lt;/p&gt;</comment>
                    <comment id="13128816" author="mikemccand" created="Mon, 17 Oct 2011 13:28:05 +0100"  >&lt;p&gt;Dan/Shai feel free to fix the test case if you want... didn&apos;t see your comments here until after I committed!&lt;/p&gt;</comment>
                    <comment id="13128817" author="shaie" created="Mon, 17 Oct 2011 13:30:09 +0100"  >&lt;p&gt;Added 3.5 as a fix version as well&lt;/p&gt;</comment>
                    <comment id="13128820" author="mikemccand" created="Mon, 17 Oct 2011 13:33:30 +0100"  >&lt;p&gt;OK that&apos;s fine but technically this bug didn&apos;t exist on 3.5... I only backported the test case.&lt;/p&gt;</comment>
                    <comment id="13129050" author="shaie" created="Mon, 17 Oct 2011 19:07:00 +0100"  >&lt;p&gt;Ah. I thought that we need the Fix Version to properly track which issues are part of a release. But you&apos;re right - if this bug didn&apos;t exist in 3.x, then we better not mark that it was fixed there.&lt;/p&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12499255" name="LUCENE-3522.patch" size="2823" author="aberdeen61" created="Mon, 17 Oct 2011 05:59:21 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 17 Oct 2011 12:23:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>87567</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24175</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>