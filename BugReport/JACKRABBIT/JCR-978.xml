<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:49:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-978/JCR-978.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-978] Remove circular dependency between VersionManagerImpl and VersionItemStateProvider</title>
                <link>https://issues.apache.org/jira/browse/JCR-978</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>From a architectural perspective the VersionManagerImpl (VMgr) is at a higher level as the VersionItemStateProvider (VISP). While the VMgr deals with Items the VISP deals with ItemState object. Nonetheless the VISP has a reference to the VMgr and also calls the method setNodeReferences(), which violates the rule of a strictly layered system. E.g. one negative effect of this was a deadlock as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-672&quot; title=&quot;Deadlock on concurrent save/checkin operations possible&quot;&gt;&lt;strike&gt;JCR-672&lt;/strike&gt;&lt;/a&gt;. It also makes it hard to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-962&quot; title=&quot;Deadlocks in ConcurrentVersioningWithTransactionsTest&quot;&gt;&lt;strike&gt;JCR-962&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
The attached patch includes the following changes:&lt;br/&gt;
&lt;br/&gt;
- Move method VersionManagerImpl.setNodeReferences() VersionItemStateManager. The method can operate on ItemStates only and does not need to be in VersionManagerImpl. As can be seen in the current method it directly calls the PeristenceManager, which indicates it should be located in a lower layer.&lt;br/&gt;
- Promote the class VersionItemStateManager to a top level class&lt;br/&gt;
- Change method VersionManagerImpl.createSharedStateManager to return a VersionItemStateManager&lt;br/&gt;
- Remove VersionManagerImpl instance variable from VersionItemStateProvider&lt;br/&gt;
- In VersionItemStateProvider.setNodeReferences() call VersionItemStateManager.setNodeReferences()&lt;br/&gt;
- Instead of using the PersistenceManager in VersionManagerImpl.getItemReferences() use the ItemStateManager. It also seems that locking is not necessary for this method.</description>
                <environment></environment>
            <key id="12372248">JCR-978</key>
            <summary>Remove circular dependency between VersionManagerImpl and VersionItemStateProvider</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jun 2007 19:29:13 +0100</created>
                <updated>Mon, 8 Oct 2007 11:47:23 +0100</updated>
                    <resolved>Mon, 25 Jun 2007 13:16:59 +0100</resolved>
                                            <fixVersion>1.3.3</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12507860" author="mreutegg" created="Mon, 25 Jun 2007 13:16:59 +0100"  >Assuming lazy consensus I committed the patch in revision: 550466</comment>
                    <comment id="12531725" author="jukkaz" created="Tue, 2 Oct 2007 10:27:46 +0100"  >Merged to the 1.3 branch in revision 581168.</comment>
                </comments>
                    <attachments>
                    <attachment id="12360379" name="JCR-978.patch" size="13262" author="mreutegg" created="Fri, 22 Jun 2007 19:30:09 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 2 Oct 2007 09:27:46 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142462</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279644</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>