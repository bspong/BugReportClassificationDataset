<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:00:01 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1168/JCR-1168.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1168] broken test in AddEventListener</title>
                <link>https://issues.apache.org/jira/browse/JCR-1168</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Here&amp;#39;s the test code, comments inline prefixed with &amp;quot;reschke&amp;quot;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Tests if {@link javax.jcr.observation.Event#NODE_ADDED} is created only&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* for the specified path if &amp;lt;code&amp;gt;isDeep&amp;lt;/code&amp;gt; is &amp;lt;code&amp;gt;false&amp;lt;/code&amp;gt;.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testIsDeepFalseNodeAdded() throws RepositoryException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;EventResult listener = new EventResult(log);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// reschke: we are listening for changes at testRoot/nodeName1, with isDeep==false &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;obsMgr.addEventListener(listener, Event.NODE_ADDED, testRoot + &amp;quot;/&amp;quot; + nodeName1, false, null, null, false);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// reschke; node at &amp;quot;testRoot/nodeName1&amp;quot; being created, the associated parent node for this event is &amp;quot;testRoot&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Node n = testRootNode.addNode(nodeName1, testNodeType);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// reschke: node at &amp;quot;testRoot/nodeName1/nodeName2&amp;quot; being created, the associated parent node for this event is &amp;quot;testRoot/nodeName1&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;n.addNode(nodeName2);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;testRootNode.save();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Event[] events = listener.getEvents(DEFAULT_WAIT_TIMEOUT);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;obsMgr.removeEventListener(listener);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// reschke: test case expects event with path &amp;quot;testRoot/nodeName1&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;checkNodeAdded(events, new String[]{nodeName1});&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
So, in plain english:&lt;br/&gt;
&lt;br/&gt;
- test case listens for events where the associated parent node equals &amp;quot;testRoot/nodeName1&amp;quot;, but&lt;br/&gt;
- it expects a single event where the Event.getPath() returns &amp;quot;testRoot/nodeName1&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
This is incorrect (IMHO), because the associated parent node for *that* event is &amp;quot;testRoot&amp;quot;. &lt;br/&gt;
&lt;br/&gt;
So the correct test would be to check for:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;checkNodeAdded(events, new String[]{nodeName1 + &amp;quot;/&amp;quot; + nodeName2});&lt;br/&gt;
&lt;br/&gt;
Making this change of course leads to a test failure reported against the RI.&lt;br/&gt;
&lt;br/&gt;
Feedback appreciated.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12379956">JCR-1168</key>
            <summary>broken test in AddEventListener</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Oct 2007 15:39:28 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:59 +0000</updated>
                    <resolved>Tue, 23 Oct 2007 13:40:58 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-jcr-tests</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12533392" author="reschke" created="Tue, 9 Oct 2007 16:34:16 +0100"  >Not surprisingly, test case testPath() has the same problem.&lt;br/&gt;
</comment>
                    <comment id="12534841" author="reschke" created="Mon, 15 Oct 2007 13:38:00 +0100"  >Proposed patch for test cases and test config (known.issues).&lt;br/&gt;
</comment>
                    <comment id="12535882" author="reschke" created="Thu, 18 Oct 2007 11:50:10 +0100"  >Updated patch.</comment>
                    <comment id="12536969" author="jukkaz" created="Tue, 23 Oct 2007 12:54:32 +0100"  >+1, it&amp;#39;s better to break Jackrabbit than the spec</comment>
                    <comment id="12536984" author="mreutegg" created="Tue, 23 Oct 2007 13:40:58 +0100"  >Applied patch (without the known.issues, because &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1179&quot; title=&quot;Event filtering by path not working as specified&quot;&gt;&lt;strike&gt;JCR-1179&lt;/strike&gt;&lt;/a&gt; has been fixed already) in revision: 587479</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12380668">JCR-1179</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12367937" name="JCR-1168-2.patch" size="1869" author="reschke" created="Thu, 18 Oct 2007 11:50:10 +0100" />
                    <attachment id="12367751" name="JCR-1168.patch" size="1845" author="reschke" created="Mon, 15 Oct 2007 13:38:00 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 23 Oct 2007 11:54:32 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78641</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190685</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>