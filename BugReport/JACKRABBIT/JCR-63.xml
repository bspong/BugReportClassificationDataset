<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:53:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-63/JCR-63.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-63] /contrib/orm-persistence/ OJBPersistenceManager</title>
                <link>https://issues.apache.org/jira/browse/JCR-63</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>OJBPersistenceManager seems to have the following problems&lt;br/&gt;
&lt;br/&gt;
1. OJBPersistenceBroker inherites from AbstractPersistenceBroker. There&amp;#39;s no &lt;br/&gt;
need of using a non transactional implementation as the feature is available in &lt;br/&gt;
jdbc. &lt;br/&gt;
&lt;br/&gt;
2. A single broker is used and It&amp;#39;s not thread-safe. This is not a problem now &lt;br/&gt;
because it inherits from AbstractPersistenceManager, and the store(ChangeLog ) &lt;br/&gt;
method is synchronized.&lt;br/&gt;
&lt;br/&gt;
3. The broker is never closed so it leaves an open connection.&lt;br/&gt;
&lt;br/&gt;
4. There&amp;#39;s no pooling with only one broker.&lt;br/&gt;
&lt;br/&gt;
5 Each write method (e.g. store(NodeState state)) starts its own transaction &lt;br/&gt;
but the transaction should start and end in store(ChangeLog log).&lt;br/&gt;
&lt;br/&gt;
6. It never rollbacks, even when an item in the changelog can&amp;#39;t be persisted.&lt;br/&gt;
&lt;br/&gt;
7. The mysql example create MyISAM tables which don&amp;#39;t support transactions. &lt;br/&gt;
Innodb tables would be more appropriate.&lt;br/&gt;
&lt;br/&gt;
8. jdbc to java type mapping is wrong for &lt;br/&gt;
class: org.apache.jackrabbit.core.state.orm.ORMBlobValue&lt;br/&gt;
field: size&lt;br/&gt;
Changed from INTEGER to BIGINT&lt;br/&gt;
&lt;br/&gt;
9. When a Blob value is loaded a ArrayStoreException is thrown because in &lt;br/&gt;
load(PropertyId id) BlobFileValues are added to internalValueList instead of &lt;br/&gt;
InternalValue instances.&lt;br/&gt;
&lt;br/&gt;
10. in store(NodeReferences). When storing a NodeReferences which have some (but not all) the references deleted the OJB persistence Manager doesn&amp;#39;t delete any one.&lt;br/&gt;
&lt;br/&gt;
Some of this problems are present in the Hibernate implementation.</description>
                <environment></environment>
            <key id="30820">JCR-63</key>
            <summary>/contrib/orm-persistence/ OJBPersistenceManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="edgarpoce">Edgar Poce</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Mar 2005 08:11:33 +0000</created>
                <updated>Fri, 18 Mar 2005 19:24:35 +0000</updated>
                    <resolved>Fri, 18 Mar 2005 19:24:35 +0000</resolved>
                                                                    <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="60702" author="edgarpoce" created="Sun, 13 Mar 2005 08:12:16 +0000"  >Patch</comment>
                    <comment id="61129" author="bhillou" created="Fri, 18 Mar 2005 01:35:22 +0000"  >Does this patch address all the issues, especially the thread safe ones ? I&amp;#39;m not the expert with OJB and I&amp;#39;m not sure if the PBFactory returns thread safe instances at all.&lt;br/&gt;
&lt;br/&gt;
Apart from that the proposed changes look good.</comment>
                    <comment id="61134" author="edgarpoce" created="Fri, 18 Mar 2005 03:08:16 +0000"  >I&amp;#39;m not an expert in OJB but I use it pretty much. AFAIK The persistence broker wraps a single connection and performs any action through it. &lt;br/&gt;
&lt;br/&gt;
Regarding transactions in multi-threaded environments, if a single broker is used it might lead to unpredictable behaviour.&lt;br/&gt;
&lt;br/&gt;
The broker must be obtained and released in the single method that handles the entire trasaction, store(ChangeLog log) in this case. And the broker instance should be passed to any private method that adds an action in the transaction, e.g. store(NodeState). I think that would be thread-safe beacuse a new broker would be obtained from the pool on each request.&lt;br/&gt;
&lt;br/&gt;
The same applies to hibernate, it&amp;#39;s not an OJB specific issue.</comment>
                    <comment id="61135" author="edgarpoce" created="Fri, 18 Mar 2005 03:10:31 +0000"  >I didn&amp;#39;t answer your question, sorry. The patch adresses all the issues.</comment>
                    <comment id="61195" author="bhillou" created="Fri, 18 Mar 2005 18:58:38 +0000"  >Ok I&amp;#39;ve tested the patch and it looks all good. Thanks.</comment>
                    <comment id="61197" author="stefan@jira" created="Fri, 18 Mar 2005 19:24:35 +0000"  >Serge Huber approved patch, &lt;br/&gt;
committed patch on behalf of Serge Huber&lt;br/&gt;
rev.158047</comment>
                </comments>
                    <attachments>
                    <attachment id="19227" name="orm-ojb.patch" size="30527" author="edgarpoce" created="Sun, 13 Mar 2005 08:12:16 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 18 Mar 2005 01:35:22 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>141884</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>192105</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>