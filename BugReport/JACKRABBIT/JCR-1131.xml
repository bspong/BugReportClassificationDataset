<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:46:52 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1131/JCR-1131.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1131] JCR2SPI NodeEntryImpl throws NPE during reorderNodes</title>
                <link>https://issues.apache.org/jira/browse/JCR-1131</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Two folder nodes are created below root. From the root node, the 2nd folder is ordered before the first node. The request is batched up correctly, but upon save, NodeEntryImpl throws a NullPointerException in the first line of the completeTransientChanges method, because revertInfo.oldParent is null.&lt;br/&gt;
&lt;br/&gt;
Test code:&lt;br/&gt;
&lt;br/&gt;
		final String FOLDER1 = &amp;quot;folder1&amp;quot;, FOLDER2 = &amp;quot;folder2&amp;quot;;&lt;br/&gt;
		&lt;br/&gt;
		// Create folder 1 on server in root&lt;br/&gt;
		Session serverSession = login(repository, creds);&lt;br/&gt;
		Node serverRootNode = serverSession.getRootNode();&lt;br/&gt;
		Node serverFolder1 = serverRootNode.addNode(FOLDER1, &amp;quot;nt:folder&amp;quot;);&lt;br/&gt;
		&lt;br/&gt;
		// Create folder 2 on server in root&lt;br/&gt;
		Node serverFolder2 = serverRootNode.addNode(FOLDER2, &amp;quot;nt:folder&amp;quot;);&lt;br/&gt;
		serverSession.save();&lt;br/&gt;
		&lt;br/&gt;
		// Validate order (TODO)&lt;br/&gt;
		&lt;br/&gt;
		// Perform reorder via client&lt;br/&gt;
		Session clientSession = login(clientRepository, creds);&lt;br/&gt;
		Node clientRootNode = clientSession.getRootNode();&lt;br/&gt;
		clientRootNode.orderBefore(FOLDER2, FOLDER1);&lt;br/&gt;
		clientSession.save(); &amp;lt;== Throws NPE&lt;br/&gt;
&lt;br/&gt;
Call Stack:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit] java.lang.NullPointerException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.hierarchy.NodeEntryImpl.completeTransientChanges(NodeEntryImpl.java:1354)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.hierarchy.NodeEntryImpl.access$1100(NodeEntryImpl.java:60)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.hierarchy.NodeEntryImpl$RevertInfo.statusChanged(NodeEntryImpl.java:1465)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.state.ItemState.setStatus(ItemState.java:257)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.state.NodeState.adjustNodeState(NodeState.java:554)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.state.NodeState.persisted(NodeState.java:276)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.state.ChangeLog.persisted(ChangeLog.java:135)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.WorkspaceManager.execute(WorkspaceManager.java:479)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.state.SessionItemStateManager.save(SessionItemStateManager.java:149)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.ItemImpl.save(ItemImpl.java:239)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at org.apache.jackrabbit.jcr2spi.SessionImpl.save(SessionImpl.java:317)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[junit]     at TestWsNodeReorder.testReorderNodes(TestWsNodeReorder.java:72)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m using an SPI I implemented, in conjunction with the jcr2spi and spi2jcr bridges, coupled with a back-end Jackrabbit in-memory filesystem. So there&amp;#39;s always the possibility that node or property SPI calls inject errors and cause this downstream problem.</description>
                <environment></environment>
            <key id="12378246">JCR-1131</key>
            <summary>JCR2SPI NodeEntryImpl throws NPE during reorderNodes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="drauschenbach">David Rauschenbach</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Sep 2007 08:10:00 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:56 +0000</updated>
                    <resolved>Mon, 17 Sep 2007 09:22:49 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-spi</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12527383" author="drauschenbach" created="Fri, 14 Sep 2007 08:29:43 +0100"  >By the way, this same problem also occurs when the test is changed to perform a same-name reorder.&lt;br/&gt;
&lt;br/&gt;
		final String NAME = &amp;quot;nodeName&amp;quot;, PROPERTY = &amp;quot;testSeq&amp;quot;;&lt;br/&gt;
		&lt;br/&gt;
		// Create folder 1 on server in root&lt;br/&gt;
		Session serverSession = login(repository, creds);&lt;br/&gt;
		Node serverRootNode = serverSession.getRootNode();&lt;br/&gt;
		Node serverFolder1 = serverRootNode.addNode(NAME, &amp;quot;nt:unstructured&amp;quot;);&lt;br/&gt;
		serverFolder1.setProperty(PROPERTY, &amp;quot;A&amp;quot;);&lt;br/&gt;
		&lt;br/&gt;
		// Create folder 2 on server in root&lt;br/&gt;
		Node serverFolder2 = serverRootNode.addNode(NAME, &amp;quot;nt:unstructured&amp;quot;);&lt;br/&gt;
		serverFolder2.setProperty(PROPERTY, &amp;quot;B&amp;quot;);&lt;br/&gt;
		serverSession.save();&lt;br/&gt;
		&lt;br/&gt;
		// Validate order&lt;br/&gt;
		assertEquals(1, serverFolder1.getIndex());&lt;br/&gt;
		assertEquals(2, serverFolder2.getIndex());&lt;br/&gt;
		&lt;br/&gt;
		// Perform reorder via client&lt;br/&gt;
		Session clientSession = login(clientRepository, creds);&lt;br/&gt;
		Node clientRootNode = clientSession.getRootNode();&lt;br/&gt;
		clientRootNode.orderBefore(NAME + &amp;quot;[2]&amp;quot;, NAME + &amp;quot;[1]&amp;quot;);&lt;br/&gt;
		clientSession.save(); &amp;lt;== Throws NPE&lt;br/&gt;
		&lt;br/&gt;
		// Verify move on server&lt;br/&gt;
		serverSession.refresh(false);&lt;br/&gt;
		Node firstServerNode = serverRootNode.getNode(NAME + &amp;quot;[1]&amp;quot;);&lt;br/&gt;
		assertEquals(&amp;quot;B&amp;quot;, firstServerNode.getProperty(PROPERTY).getString());&lt;br/&gt;
</comment>
                    <comment id="12527979" author="mreutegg" created="Mon, 17 Sep 2007 09:22:49 +0100"  >Fixed in revision: 576296&lt;br/&gt;
&lt;br/&gt;
Thanks for reporting this issue.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 17 Sep 2007 08:22:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78653</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190691</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>