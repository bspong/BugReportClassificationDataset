<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:35:41 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-632/JCR-632.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-632] VersionManager lock not released in some circumstances</title>
                <link>https://issues.apache.org/jira/browse/JCR-632</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>In some circumstances it is possible that lock is not released in VersionManager.checkin method.&lt;br/&gt;
&lt;br/&gt;
There is following block of code in checkin nethod :&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;aquireReadLock();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.....&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (IllegalStateException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;releaseReadLock();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw new RepositoryException(&amp;quot;Unable to start edit operation.&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Lock release should be in finally block to make sure that lock is released when unexpected exception is thrown.&lt;br/&gt;
In our environment we are getting NPE in mentioned block of code, it results in persisten lock. &lt;br/&gt;
No versioning operation is possible and our application server is running ot of threads (all threads are locked).&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12355256">JCR-632</key>
            <summary>VersionManager lock not released in some circumstances</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="ppakulski">Przemo Pakulski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Nov 2006 12:28:26 +0000</created>
                <updated>Thu, 2 May 2013 03:29:02 +0100</updated>
                    <resolved>Thu, 23 Nov 2006 19:20:26 +0000</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                <version>1.0.1</version>
                <version>1.1</version>
                <version>1.1.1</version>
                                <fixVersion>1.2.1</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12448722" author="ppakulski" created="Fri, 10 Nov 2006 12:32:14 +0000"  >Attached simple patch solving this issue.</comment>
                    <comment id="12450350" author="jukkaz" created="Thu, 16 Nov 2006 11:09:49 +0000"  >You&amp;#39;re right, the release should be in the finally block.</comment>
                    <comment id="12450351" author="jukkaz" created="Thu, 16 Nov 2006 11:14:57 +0000"  >Patch applied in revision 475683. Thanks for spotting this!</comment>
                    <comment id="12450356" author="jukkaz" created="Thu, 16 Nov 2006 11:26:12 +0000"  >Hmm, actually the change was incorrect. The code after the try-catch-finally block expects the read lock to still be acquired, so releasing it in the catch block before throwing an exception was OK, but not in the finally block. This of course still leaves open the question of what to do with unexpected RuntimeExceptions.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m reverting this change and hope to fix this together with &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-546&quot; title=&quot;Deadlock during checkin&quot;&gt;&lt;strike&gt;JCR-546&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12452305" author="jukkaz" created="Thu, 23 Nov 2006 19:20:26 +0000"  >Resolved in revision 478645 as a side effect of the &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-546&quot; title=&quot;Deadlock during checkin&quot;&gt;&lt;strike&gt;JCR-546&lt;/strike&gt;&lt;/a&gt; fix.&lt;br/&gt;
&lt;br/&gt;
As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-546&quot; title=&quot;Deadlock during checkin&quot;&gt;&lt;strike&gt;JCR-546&lt;/strike&gt;&lt;/a&gt;, this change will not yet be included in the 1.1.1 release.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10001">
                <name>dependent</name>
                                <outwardlinks description="depends upon">
                            <issuelink>
            <issuekey id="12348325">JCR-546</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12344746" name="JCR-632" size="504" author="ppakulski" created="Fri, 10 Nov 2006 12:32:14 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 16 Nov 2006 11:09:49 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80349</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189854</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>