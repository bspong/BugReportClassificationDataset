<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:32:16 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2962/JCR-2962.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2962] InputStream not being explicitly closed</title>
                <link>https://issues.apache.org/jira/browse/JCR-2962</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>After deploying a j2ee artifact that uses jackrabbit and org.apache.jackrabbit.core.persistence.pool.MySqlPersistenceManager, Glassfish starts complaining there are input streams without being explicitly closed.&lt;br/&gt;
The specific inputStream mey be found at org.apache.jackrabbit.core.persistence.pool.BundleDbPersistenceManager.createCheckSchemaOperation(BundleDbPersistenceManager.java:584).&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve checked the code and in BundleDbPersistenceManager:530 the run method is invoked to the object CheckSchemaOperation.&lt;br/&gt;
In run method CheckSchemaOperation:78, the finally block that calls IOUtils.closeQuietly(ddl); to close the stream is inside the condition if (!conHelper.tableExists(table)) (CheckSchemaOperation:79).&lt;br/&gt;
So, if this condition is false, the inputStream will not be explicitly closed.&lt;br/&gt;
&lt;br/&gt;
In my opinion, there are two fix alternatives:&lt;br/&gt;
The most robust should be:&lt;br/&gt;
1 - insert a finalize() method:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Override&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;protected void finalize() throws Throwable {&lt;br/&gt;
	    if (ddl!=null){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;IOUtils.closeQuietly(ddl);&lt;br/&gt;
	    }&lt;br/&gt;
		super.finalize();&lt;br/&gt;
	}&lt;br/&gt;
&lt;br/&gt;
Another alternative:&lt;br/&gt;
2 - Put the condition if (!conHelper.tableExists(table)) inside try-finally block.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
StackTrace:&lt;br/&gt;
[#|2011-05-05T11:43:28.087-0300|WARNING|glassfish3.1|javax.enterprise.system.core.classloading.com.sun.enterprise.loader|_ThreadID=1233;_ThreadName=Thread-1;|Input stream has been finalized or forced closed without being explicitly closed; stream instantiation reported in following stack trace&lt;br/&gt;
java.lang.Throwable&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.enterprise.loader.ASURLClassLoader$SentinelInputStream.&amp;lt;init&amp;gt;(ASURLClassLoader.java:1230)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.enterprise.loader.ASURLClassLoader$InternalJarURLConnection.getInputStream(ASURLClassLoader.java:1338)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.net.URL.openStream(URL.java:1010)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.ClassLoader.getResourceAsStream(ClassLoader.java:1195)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.enterprise.loader.ASURLClassLoader.getResourceAsStream(ASURLClassLoader.java:872)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Class.getResourceAsStream(Class.java:2030)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.persistence.pool.BundleDbPersistenceManager.createCheckSchemaOperation(BundleDbPersistenceManager.java:584)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.persistence.pool.BundleDbPersistenceManager.init(BundleDbPersistenceManager.java:530)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.persistence.pool.MySqlPersistenceManager.init(MySqlPersistenceManager.java:51)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.createPersistenceManager(RepositoryImpl.java:1353)</description>
                <environment>Glassfish version 3.1.&lt;br/&gt;
Jackrabbit configured to use org.apache.jackrabbit.core.persistence.pool.MySqlPersistenceManager as PersistenceManager.</environment>
            <key id="12506295">JCR-2962</key>
            <summary>InputStream not being explicitly closed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="orair">Gustavo Orair</reporter>
                        <labels>
                        <label>inputstream</label>
                    </labels>
                <created>Thu, 5 May 2011 16:21:31 +0100</created>
                <updated>Tue, 8 Nov 2011 15:47:03 +0000</updated>
                    <resolved>Fri, 6 May 2011 15:57:48 +0100</resolved>
                            <version>2.2.5</version>
                                <fixVersion>2.0.5</fixVersion>
                <fixVersion>2.1.6</fixVersion>
                <fixVersion>2.2.9</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                          <timeoriginalestimate seconds="600">10m</timeoriginalestimate>
                    <timeestimate seconds="600">10m</timeestimate>
                                  <comments>
                    <comment id="13029371" author="orair" created="Thu, 5 May 2011 16:26:34 +0100"  >Patch creating finalize() method that should certify the stream is being closed.</comment>
                    <comment id="13029969" author="stefan@jira" created="Fri, 6 May 2011 15:57:48 +0100"  >fixed in svn r1100242&lt;br/&gt;
&lt;br/&gt;
thanks for reporting this issue and providing a patch&lt;br/&gt;
&lt;br/&gt;
(i am trying to avoid finalize methods that&amp;#39;s why&lt;br/&gt;
i&amp;#39;ve just moved the scope of the try/finally block).</comment>
                    <comment id="13113457" author="jukkaz" created="Fri, 23 Sep 2011 15:08:47 +0100"  >Merged to the 2.2 branch in revision 1174778, to 2.1 in 1174780, and to 2.0 in 1174788.</comment>
                </comments>
                    <attachments>
                    <attachment id="12478283" name="patch.txt" size="641" author="orair" created="Thu, 5 May 2011 16:26:34 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 6 May 2011 14:57:48 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>59594</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>250271</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>