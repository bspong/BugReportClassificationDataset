<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:30:44 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3158/JCR-3158.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3158] Deadlock in DBCP when accessing node</title>
                <link>https://issues.apache.org/jira/browse/JCR-3158</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I found a deadlock situation using JR 2.2.10, the problem is with DBCP 1.2.2 and is fixed in DBCP 1.3, JR trunk also uses DBCP 1.2.2 and should also be updated&lt;br/&gt;
&lt;br/&gt;
The ticket in dbcp is #&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-270&quot; title=&quot;Dead lock using the evictor&quot;&gt;&lt;strike&gt;DBCP-270&lt;/strike&gt;&lt;/a&gt;, related tickets are #&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-65&quot; title=&quot;[dbcp] Deadlock when evicting dbcp objects (testWhileIdle=true)&quot;&gt;&lt;strike&gt;DBCP-65&lt;/strike&gt;&lt;/a&gt; #&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-281&quot; title=&quot;[dbcp] Deadlock when evicting dbcp objects (testWhileIdle=true) [ re-open of DBCP-65]&quot;&gt;&lt;strike&gt;DBCP-281&lt;/strike&gt;&lt;/a&gt; #&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-271&quot; title=&quot;Thread safety issues in AbandonedTrace class&quot;&gt;&lt;strike&gt;DBCP-271&lt;/strike&gt;&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Stack trace of where my call is stalled:&lt;br/&gt;
{code}&lt;br/&gt;
&lt;a href=&apos;mailto:main@1&apos;&gt;main@1&lt;/a&gt;, prio=5, in group &amp;#39;main&amp;#39;, status: &amp;#39;MONITOR&amp;#39;&lt;br/&gt;
	 blocks &lt;a href=&apos;mailto:Timer-1@2545&apos;&gt;Timer-1@2545&lt;/a&gt;&lt;br/&gt;
	 waiting for &lt;a href=&apos;mailto:Timer-1@2545&apos;&gt;Timer-1@2545&lt;/a&gt; to release lock on {1}&lt;br/&gt;
	  at org.apache.commons.pool.impl.GenericObjectPool.addObjectToPool(GenericObjectPool.java:1137)&lt;br/&gt;
	  at org.apache.commons.pool.impl.GenericObjectPool.returnObject(GenericObjectPool.java:1076)&lt;br/&gt;
	  at org.apache.commons.dbcp.PoolableConnection.close(PoolableConnection.java:87)&lt;br/&gt;
	  at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.close(PoolingDataSource.java:181)&lt;br/&gt;
	  at org.apache.jackrabbit.core.util.db.DbUtility.close(DbUtility.java:75)&lt;br/&gt;
	  at org.apache.jackrabbit.core.util.db.ResultSetWrapper.invoke(ResultSetWrapper.java:63)&lt;br/&gt;
	  at $Proxy12.close(Unknown Source:-1)&lt;br/&gt;
	  at org.apache.jackrabbit.core.persistence.pool.BundleDbPersistenceManager.loadBundle(BundleDbPersistenceManager.java:1042)&lt;br/&gt;
	  at org.apache.jackrabbit.core.persistence.bundle.AbstractBundlePersistenceManager.getBundle(AbstractBundlePersistenceManager.java:669)&lt;br/&gt;
	  at org.apache.jackrabbit.core.persistence.bundle.AbstractBundlePersistenceManager.load(AbstractBundlePersistenceManager.java:415)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.SharedItemStateManager.loadItemState(SharedItemStateManager.java:1830)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.SharedItemStateManager.getNonVirtualItemState(SharedItemStateManager.java:1750)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.SharedItemStateManager.getItemState(SharedItemStateManager.java:265)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.LocalItemStateManager.getNodeState(LocalItemStateManager.java:109)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.LocalItemStateManager.getItemState(LocalItemStateManager.java:174)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.XAItemStateManager.getItemState(XAItemStateManager.java:260)&lt;br/&gt;
	  at org.apache.jackrabbit.core.state.SessionItemStateManager.getItemState(SessionItemStateManager.java:161)&lt;br/&gt;
	  at org.apache.jackrabbit.core.ItemManager.getItemData(ItemManager.java:382)&lt;br/&gt;
	  at org.apache.jackrabbit.core.ItemManager.getNode(ItemManager.java:669)&lt;br/&gt;
	  at org.apache.jackrabbit.core.ItemManager.getNode(ItemManager.java:647)&lt;br/&gt;
	  at org.apache.jackrabbit.core.LazyItemIterator.prefetchNext(LazyItemIterator.java:120)&lt;br/&gt;
	  at org.apache.jackrabbit.core.LazyItemIterator.next(LazyItemIterator.java:257)&lt;br/&gt;
	  at info.magnolia.jcr.iterator.DelegatingNodeIterator.next(DelegatingNodeIterator.java:79)&lt;br/&gt;
{code}&lt;br/&gt;
&lt;br/&gt;
This is the offending thread:&lt;br/&gt;
{code}&lt;br/&gt;
&lt;a href=&apos;mailto:Timer-1@2545&apos;&gt;Timer-1@2545&lt;/a&gt; daemon, prio=5, in group &amp;#39;main&amp;#39;, status: &amp;#39;MONITOR&amp;#39;&lt;br/&gt;
	 blocks &lt;a href=&apos;mailto:main@1&apos;&gt;main@1&lt;/a&gt;&lt;br/&gt;
	 waiting for &lt;a href=&apos;mailto:main@1&apos;&gt;main@1&lt;/a&gt; to release lock on {1}&lt;br/&gt;
	  at org.apache.commons.dbcp.AbandonedTrace.addTrace(AbandonedTrace.java:176)&lt;br/&gt;
	  at org.apache.commons.dbcp.AbandonedTrace.init(AbandonedTrace.java:92)&lt;br/&gt;
	  at org.apache.commons.dbcp.AbandonedTrace.&amp;lt;init&amp;gt;(AbandonedTrace.java:82)&lt;br/&gt;
	  at org.apache.commons.dbcp.DelegatingStatement.&amp;lt;init&amp;gt;(DelegatingStatement.java:61)&lt;br/&gt;
	  at org.apache.commons.dbcp.DelegatingConnection.createStatement(DelegatingConnection.java:224)&lt;br/&gt;
	  at org.apache.commons.dbcp.PoolableConnectionFactory.validateConnection(PoolableConnectionFactory.java:331)&lt;br/&gt;
	  at org.apache.commons.dbcp.PoolableConnectionFactory.validateObject(PoolableConnectionFactory.java:312)&lt;br/&gt;
	  at org.apache.commons.pool.impl.GenericObjectPool.evict(GenericObjectPool.java:1217)&lt;br/&gt;
	  at org.apache.commons.pool.impl.GenericObjectPool$Evictor.run(GenericObjectPool.java:1341)&lt;br/&gt;
	  at java.util.TimerThread.mainLoop(Timer.java:512)&lt;br/&gt;
	  at java.util.TimerThread.run(Timer.java:462)&lt;br/&gt;
{code}</description>
                <environment>Java 6&lt;br/&gt;
Jackrabbit 2.2.10&lt;br/&gt;
Derby</environment>
            <key id="12532726">JCR-3158</key>
            <summary>Deadlock in DBCP when accessing node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="sigget">Tobias Mattsson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Nov 2011 14:57:55 +0000</created>
                <updated>Sun, 27 May 2012 10:52:54 +0100</updated>
                    <resolved>Fri, 2 Mar 2012 14:34:25 +0000</resolved>
                            <version>2.2.10</version>
                <version>2.3.3</version>
                <version>2.4</version>
                                <fixVersion>2.2.12</fixVersion>
                <fixVersion>2.4.1</fixVersion>
                <fixVersion>2.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="13208469" author="sigget" created="Wed, 15 Feb 2012 13:48:02 +0000"  >Added affects version 2.4 since it also uses DBCP 1.2.2.</comment>
                    <comment id="13220962" author="alex.parvulescu" created="Fri, 2 Mar 2012 14:34:25 +0000"  >this looks serious enough.&lt;br/&gt;
I&amp;#39;ve ran all the tests with DBCP 1.3 and everything passes.&lt;br/&gt;
&lt;br/&gt;
fixed in revision 1296226.</comment>
                    <comment id="13220963" author="gjoseph" created="Fri, 2 Mar 2012 14:41:37 +0000"  >Any chance of a backport to the 2.4 branch ?</comment>
                    <comment id="13236571" author="alex.parvulescu" created="Fri, 23 Mar 2012 13:12:53 +0000"  >backported to 2.4 in revision 1304328.</comment>
                    <comment id="13242438" author="jukkaz" created="Fri, 30 Mar 2012 16:30:42 +0100"  >Merged to the 2.2 branch in revision 1307473.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 2 Mar 2012 14:34:25 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>218460</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189942</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>