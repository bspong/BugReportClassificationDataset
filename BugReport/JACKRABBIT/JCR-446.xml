<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:37:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-446/JCR-446.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-446] Prevent logins during repository shutdown</title>
                <link>https://issues.apache.org/jira/browse/JCR-446</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Related to the last comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-445&quot; title=&quot;repository is locked by WorkspaceJanitor when another workspace is reindexing&quot;&gt;&lt;strike&gt;JCR-445&lt;/strike&gt;&lt;/a&gt;, should we prevent new sessions from being created during repository shutdown? It is an odd chance to run into a problem like that, but it seems like the issue could be easily solved by making getWorkspaceInfo() synchronized and adding sanityCheck() calls to the createSession() methods.</description>
                <environment></environment>
            <key id="12343716">JCR-446</key>
            <summary>Prevent logins during repository shutdown</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 May 2006 18:01:25 +0100</created>
                <updated>Fri, 13 Oct 2006 17:03:13 +0100</updated>
                    <resolved>Sun, 17 Sep 2006 22:24:24 +0100</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                <version>1.0.1</version>
                                <fixVersion>1.1</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12414020" author="tripod" created="Wed, 31 May 2006 18:09:57 +0100"  >i&amp;#39;m a bit afraid on sychronizing the repository instance. i prefer a &amp;#39;shutdown&amp;#39; lock around shutdown and login.</comment>
                    <comment id="12414024" author="jukkaz" created="Wed, 31 May 2006 18:28:00 +0100"  >Looking at the code I actually think that getWorkspaceInfo() *should* be synchronized regardless of what we do with login. The wspInfos map is not necessarily thread-safe, so invoking get() on it (or keySet() in getWorkspaceNames()) may cause a problem if a concurrent thread is invoking a synchronized createWorkspace() method. Thus I actually think that either the wspInfos map or the getWorkspaceInfo() and getWorkspaceNames() should be synchronized.&lt;br/&gt;
&lt;br/&gt;
On the other hand login() should not be synchronized, as the JAAS authentication could easily block other threads while waiting for the user to enter a password or something similar.&lt;br/&gt;
&lt;br/&gt;
In any case, the crucial part seems  to be the createSession() methods, that are currently synchronized, but do not invoke the sanityCheck() method. Thus it is possible for login() to start and invoke sanityCheck() before a shutdown is initiated, but stall waiting for user credentials during JAAS authentication. If during that time the repository is shutdown, login() will still continue to call createSession() without any more sanity checks. Adding sanityCheck() calls to the createSession() methods should solve this quite nicely.</comment>
                    <comment id="12414027" author="jukkaz" created="Wed, 31 May 2006 18:50:19 +0100"  >Sorry, I was looking at an older version of RepositoryImpl. The &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-445&quot; title=&quot;repository is locked by WorkspaceJanitor when another workspace is reindexing&quot;&gt;&lt;strike&gt;JCR-445&lt;/strike&gt;&lt;/a&gt; changes modified the synchronization in RepositoryImpl, so my point about wspInfos is already being taken care of. Thanks, Toby! :-)&lt;br/&gt;
&lt;br/&gt;
The login/shutdown issue still exists, and it looks as if a &amp;#39;shutdown&amp;#39; lock would be the best solution with the current approach to synchronization. The issue isn&amp;#39;t too urgent though, so consider this low priority for now.</comment>
                    <comment id="12435203" author="jukkaz" created="Sat, 16 Sep 2006 10:29:23 +0100"  >Attached a proposed patch that implements the shutdown lock idea. The lock is a ReadWrite lock that allows any number of concurrent readers (logins) but only one concurrent writer (shutdown).&lt;br/&gt;
&lt;br/&gt;
Passes all unit tests and seems to work fine under normal loads. I&amp;#39;ll apply the patch unless anyone objects.</comment>
                    <comment id="12435351" author="jukkaz" created="Sun, 17 Sep 2006 22:24:24 +0100"  >Proposed patch applied in revision 447148.</comment>
                </comments>
                    <attachments>
                    <attachment id="12340985" name="shutdown-lock.patch" size="6118" author="jukkaz" created="Sat, 16 Sep 2006 10:29:23 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 31 May 2006 17:09:57 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142177</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>231709</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>