<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:34:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-247/JCR-247.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-247] Child axis support for XPath predicates</title>
                <link>https://issues.apache.org/jira/browse/JCR-247</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>It seems that Jackrabbit currently only supports the attribute axis in XPath predicates. Support for the child axis would be a nice addition.</description>
                <environment></environment>
            <key id="12317734">JCR-247</key>
            <summary>Child axis support for XPath predicates</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Oct 2005 22:54:53 +0100</created>
                <updated>Mon, 11 Feb 2008 08:54:09 +0000</updated>
                    <resolved>Tue, 21 Nov 2006 10:38:31 +0000</resolved>
                                            <fixVersion>1.2.1</fixVersion>
                                <component>xpath</component>
                        <due></due>
                    <votes>5</votes>
                        <watches>7</watches>
                                                    <comments>
                    <comment id="12357410" author="jukkaz" created="Sat, 12 Nov 2005 02:40:02 +0000"  >&amp;gt; Support for the child axis would be a nice addition.&lt;br/&gt;
&lt;br/&gt;
Or better yet, support for generic XPath expressions in predicates.  As described in the JSR 170 XPath grammar:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[44] Predicates ::= ( &amp;quot;[&amp;quot; Expr &amp;quot;]&amp;quot; )*&lt;br/&gt;
</comment>
                    <comment id="12451590" author="mreutegg" created="Tue, 21 Nov 2006 10:38:31 +0000"  >Implemented support for child axis in predicates.&lt;br/&gt;
&lt;br/&gt;
E.g. you can now execute queries like:&lt;br/&gt;
&lt;br/&gt;
//*[foo/@bar = 1234]&lt;br/&gt;
//page[jcr:contains(paragraph, &amp;#39;text&amp;#39;)]&lt;br/&gt;
//page[jcr:like(fn:lower-case(paragraph/@author), &amp;#39;marcel%&amp;#39;)]&lt;br/&gt;
&lt;br/&gt;
and the famous:&lt;br/&gt;
&lt;br/&gt;
//element(*, nt:file)[jcr:contains(jcr:content, &amp;#39;text&amp;#39;)]&lt;br/&gt;
&lt;br/&gt;
you may also use * as a name test:&lt;br/&gt;
&lt;br/&gt;
//foo[bar/*/@bar &amp;gt; 1234]&lt;br/&gt;
&lt;br/&gt;
One limitation though:&lt;br/&gt;
- nested predicates are not supported (which also means that you cannot use an index within the predicate):&lt;br/&gt;
&lt;br/&gt;
E.g. the following query will fail:&lt;br/&gt;
&lt;br/&gt;
//page[jcr:contains(paragraph[3], &amp;#39;text&amp;#39;)]</comment>
                    <comment id="12451599" author="jukkaz" created="Tue, 21 Nov 2006 11:23:55 +0000"  >&amp;gt; Implemented support for child axis in predicates.&lt;br/&gt;
&lt;br/&gt;
Way to go, Marcel! This will be a killer feature for many in the 1.2 release.&lt;br/&gt;
</comment>
                    <comment id="12465471" author="jjaksic" created="Wed, 17 Jan 2007 17:57:06 +0000"  >This is a killer feature alright, but it does not yet work as expected. Namely, full-text search within linked files doesn&amp;#39;t seem to work.&lt;br/&gt;
&lt;br/&gt;
Take the following query for example:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;//element(*, nt:linkedFile)[jcr:deref(@jcr:content, &amp;#39;*&amp;#39;)/jcr:contains(., &amp;#39;search string&amp;#39;)]&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(should return all linked file nodes whose referenced resources contain the given search string)&lt;br/&gt;
&lt;br/&gt;
Running this query, an ArrayStoreException occurs in PathQueryNode, line 77:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return (LocationStepQueryNode[]) operands.toArray(new LocationStepQueryNode[operands.size()]);&lt;br/&gt;
&lt;br/&gt;
The problem is that the query operands are copied into an array of LocationStepQueryNode, while the last operand is not of that type - it is of type TextsearchQueryNode, which only extends QueryNode.&lt;br/&gt;
&lt;br/&gt;
I have no idea how complex it would be to fix this. If it would require a lot of work, then maybe for now just add some operand type checking and throw a descriptive exception if an incompatible query node is found.</comment>
                    <comment id="12465699" author="mreutegg" created="Thu, 18 Jan 2007 09:50:18 +0000"  >Jaka, thanks for reporting this issue. The reason why the query fails is acutally the jcr:deref() within the predicate which is currently not supported and not well handled. With the resolution of this issue only the use of the child axis is supported, but not jcr:deref(). I&amp;#39;ve created a separate issue report: &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-709&quot; title=&quot;ArrayStoreException is thrown when jcr:deref() is used within predicate&quot;&gt;&lt;strike&gt;JCR-709&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12471888" author="randy_simon" created="Sat, 10 Feb 2007 00:57:07 +0000"  >This feature has saved me.  However, I think there may still be some issues.&lt;br/&gt;
&lt;br/&gt;
For example,&lt;br/&gt;
I want to find the root of a node tree that contains a node with a specified id.  The child node may be n layers deep in the node tree.  In my specific case, I know how deep it is so &lt;br/&gt;
&lt;br/&gt;
//element(*, my:foo)[bar/*/*/*/*/@jcr:uuid = &amp;#39;abc&amp;#39;] &lt;br/&gt;
&lt;br/&gt;
finds the node of type my:foo that contains the child node with id &amp;#39;abc&amp;#39;.&lt;br/&gt;
&lt;br/&gt;
Now, I would like to generalize this so I thought i could simply do the following.&lt;br/&gt;
//element(*, my:foo)[bar//*/@jcr:uuid = &amp;#39;abc&amp;#39;] &lt;br/&gt;
&lt;br/&gt;
but this does not work.&lt;br/&gt;
&lt;br/&gt;
Is this supported?  Should this bug be re-opened? Thanks.</comment>
                    <comment id="12472255" author="mreutegg" created="Mon, 12 Feb 2007 11:17:51 +0000"  >No, this is not supported. Only support for the child axis was added not for the descendant-or-self axis. Please file a separate jira request for this enhancement.</comment>
                    <comment id="12567172" author="_hsp" created="Fri, 8 Feb 2008 19:41:46 +0000"  >I think that is an issue.&lt;br/&gt;
I am trying to search like:&lt;br/&gt;
&lt;br/&gt;
/jcr:root/A/B//element(*,my:type)[X/Y/3ca3f395-7ae9-4553-b0d2-401b3bdff3d2/@prop:number &amp;gt;= 1]&lt;br/&gt;
&lt;br/&gt;
if I do the search without the 3ca3f395-7ae9-4553-b0d2-401b3bdff3d2 and replace it with *, it works, but not for my use case, :-( ....&lt;br/&gt;
I am naming these nodes with a uuid of another node in workspace.&lt;br/&gt;
&lt;br/&gt;
Would it be easily fixed? Should this reopen this jira?</comment>
                    <comment id="12567551" author="mreutegg" created="Mon, 11 Feb 2008 08:54:09 +0000"  >You need to escape the initial digit of the uuid. Digits are not valid start characters for XML names.&lt;br/&gt;
&lt;br/&gt;
/jcr:root/A/B//element(*,my:type)[X/Y/_x0033_ca3f395-7ae9-4553-b0d2-401b3bdff3d2/@prop:number &amp;gt;= 1]&lt;br/&gt;
&lt;br/&gt;
Please use the mailing list if you are not sure whether you found a bug.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12372348">JCR-981</issuekey>
        </issuelink>
                    </outwardlinks>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12317733">JCR-246</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 21 Nov 2006 10:38:31 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142052</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191083</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>