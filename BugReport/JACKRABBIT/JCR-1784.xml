<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:30:27 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1784/JCR-1784.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1784] OCM:The UUID of the collection elements changes on update.</title>
                <link>https://issues.apache.org/jira/browse/JCR-1784</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>On ocm.update transaction, the  Current implementation of DefaultCollectionConverterImpl recreates the colleciton-element nodes if there is no id field specificaiton.  This is completely valid for majority of the cases.  But I came across a case where the colleciton element has a uuid field.  In this case also what is happening with the current implementation is that it drops all the elements from the old collection-elements and recreates the new ones.  The major flip side is that now I am left with brand new UUIDs.  I think we should address the uniqueness characteristics specified through UUID also while mapping colleciton elements.&lt;br/&gt;
&lt;br/&gt;
I have a patch and a TestCase to verify the same.  I have implemented it only for the digester.  If people feel the approach is right I will work out an annotation based testcase as well.  I do not think it is going to fail even with annotations.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12405736">JCR-1784</key>
            <summary>OCM:The UUID of the collection elements changes on update.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="clombart">Christophe Lombart</assignee>
                                <reporter username="bonigv">Boni Gopalan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Oct 2008 12:01:32 +0100</created>
                <updated>Mon, 8 Dec 2008 11:09:43 +0000</updated>
                    <resolved>Fri, 17 Oct 2008 09:48:15 +0100</resolved>
                            <version>1.5</version>
                                <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-ocm</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                          <timeoriginalestimate seconds="10800">3h</timeoriginalestimate>
                    <timeestimate seconds="10800">3h</timeestimate>
                                  <comments>
                    <comment id="12636848" author="bonigv" created="Sat, 4 Oct 2008 18:51:01 +0100"  >Fixed with the supplied patch</comment>
                    <comment id="12637177" author="clombart" created="Mon, 6 Oct 2008 20:01:47 +0100"  >Your patch seems good but I&amp;#39;m wondering why you have modified the class AbstractMapperImpl ( see [1]).&lt;br/&gt;
It works without this modification and we can leave the code as it is (throw an exception is there is no descriptor). &lt;br/&gt;
Are you agree if we don&amp;#39;t modify this class ?&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
[1] Index: src/main/java/org/apache/jackrabbit/ocm/mapper/impl/AbstractMapperImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
--- src/main/java/org/apache/jackrabbit/ocm/mapper/impl/AbstractMapperImpl.java	(revision 701632)&lt;br/&gt;
+++ src/main/java/org/apache/jackrabbit/ocm/mapper/impl/AbstractMapperImpl.java	(working copy)&lt;br/&gt;
@@ -200,7 +200,7 @@&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public ClassDescriptor getClassDescriptorByClass(Class clazz) {&lt;br/&gt;
&amp;nbsp;	   ClassDescriptor descriptor = mappingDescriptor.getClassDescriptorByName(clazz.getName());&lt;br/&gt;
&amp;nbsp;	   if (descriptor==null) {&lt;br/&gt;
-			throw new IncorrectPersistentClassException(&amp;quot;Class of type: &amp;quot; + clazz.getName() + &amp;quot; has no descriptor.&amp;quot;);&lt;br/&gt;
+			//throw new IncorrectPersistentClassException(&amp;quot;Class of type: &amp;quot; + clazz.getName() + &amp;quot; has no descriptor.&amp;quot;);&lt;br/&gt;
&amp;nbsp;	   }&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return descriptor ;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12637192" author="clombart" created="Mon, 6 Oct 2008 20:32:32 +0100"  >The patch has been applied. thanks and well done ! it was a nice bug :-) &lt;br/&gt;
I didn&amp;#39;t modify the class AbstractMapperImpl. For me, this modification is not necessary. &lt;br/&gt;
I also added unit tests for the annotation support. &lt;br/&gt;
&lt;br/&gt;
Let me know if something is wrong. </comment>
                    <comment id="12637396" author="bonigv" created="Tue, 7 Oct 2008 07:46:31 +0100"  >We seem to be going back and forth with this AbstractMapperImpl change I made.  I had a problem with that throws clause and unfortunately I need to spend some time to recreate the test scenario that required me to change the implementation.  If I remove the throws clause I know that a few of my application testcases will fail.  I will work out a testcase that I hope will convince you the need to remove that throws.  Till then I completely am with you on keeping AbstractMapperImpl as is.&lt;br/&gt;
&lt;br/&gt;
I came across a similar issue with update elsewhere.  Consider same name sibling nodes with UUID specified.  Though these are not part of a collection it very well act as those are collection elements.  However since the code handles the mapping from directly within ObjectConverterImpl&amp;#39;s update method we need to make that update as well intelligent enough to decipher uniqueness through UUID.  I have a patch and I will add it to this discussion.</comment>
                    <comment id="12637402" author="bonigv" created="Tue, 7 Oct 2008 08:38:24 +0100"  >I also did a bit of code cleanup to remove some repeating code.  Basically I saw the approach to update a Node to be :&lt;br/&gt;
&lt;br/&gt;
Locate the node to  update and then update it.  So I introduce a method that takes in the session, Node to Update and the Object to Update to as parameters and does the updating.  This methos is called from the other facade methods that already existed for doing the updates.  Eliminated the code duplication.&lt;br/&gt;
&lt;br/&gt;
All the tests are passing.</comment>
                    <comment id="12639948" author="clombart" created="Wed, 15 Oct 2008 21:16:39 +0100"  >Done. Thanks for your contribution.  &lt;br/&gt;
&lt;br/&gt;
Do you want to see the latest path in the branch 1.5 ? &lt;br/&gt;
I&amp;#39;m not sure that is critical for the release 1.5. &lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12640467" author="jukkaz" created="Fri, 17 Oct 2008 09:48:15 +0100"  >Both changes are now also in the 1.5 branch. I guess this is everything we need here, so resolving as Fixed.</comment>
                </comments>
                    <attachments>
                    <attachment id="12391610" name="JCR-1784.additional.bonigopalan" size="6209" author="bonigv" created="Tue, 7 Oct 2008 08:38:24 +0100" />
                    <attachment id="12391466" name="JCR-1784.bonigopalan.patch" size="19414" author="bonigv" created="Sat, 4 Oct 2008 12:24:33 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 6 Oct 2008 19:01:47 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78424</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>192463</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>