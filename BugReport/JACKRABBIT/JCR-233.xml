<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:03:15 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-233/JCR-233.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-233] repository lock file not removed without a clean shutdown</title>
                <link>https://issues.apache.org/jira/browse/JCR-233</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>actually when a repository is loaded a &amp;quot;.lock&amp;quot; file is created. This file is removed only after a clean shutdown but, if a jackrabbit instance has been killed, you have to manually delete the file in order to load the repository again, also if there was no live instance of jackrabbit that was using it.&lt;br/&gt;
&lt;br/&gt;
The problem comes from the fact that the simple presence of the .lock file is used to indicate a live instance.&lt;br/&gt;
I suggest replacing this behavior using this method (used for example by eclipse when opening workspaces):&lt;br/&gt;
- when an instance is loaded create a &amp;quot;.lock&amp;quot; file and open it with exclusive access&lt;br/&gt;
- when a new instance is started try to delete an eventual .lock file. Only if the file can&amp;#39;t be deleted because in use assume that another jackrabbit instance is running.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12317518">JCR-233</key>
            <summary>repository lock file not removed without a clean shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tripod">Tobias Bocanegra</assignee>
                                <reporter username="fgiust">fabrizio giustina</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Oct 2005 07:47:32 +0100</created>
                <updated>Tue, 11 Oct 2005 22:38:38 +0100</updated>
                    <resolved>Tue, 11 Oct 2005 22:38:38 +0100</resolved>
                                            <fixVersion>1.0</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12331101" author="edgarpoce" created="Mon, 3 Oct 2005 09:22:18 +0100"  >&amp;gt; The problem comes from the fact that the simple presence of the .lock file is used to indicate a live instance.&lt;br/&gt;
&lt;br/&gt;
Not only a live instance ... The idea was no only to prevent 2 jackrabbit instances running but also to let the user know that the repository wasn&amp;#39;t shutdown propertly. Clean shutdowns are very important, actually I turned my repository inconsistent a couple of times killing the jvm process.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I suggest replacing this behavior using this method (used for example by eclipse when opening workspaces):&lt;br/&gt;
&amp;gt; - when an instance is loaded create a &amp;quot;.lock&amp;quot; file and open it with exclusive access&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m not sure but I think this was the policy for the index lock some months ago, and I&amp;#39;m happy it changed because a few times I had to reboot XP when I killed the jvm process. I couldn&amp;#39;t remove the lock, not even from the explorer. So, I don&amp;#39;t think it&amp;#39;s a good idea to change the current behaviour.</comment>
                    <comment id="12331133" author="tripod" created="Mon, 3 Oct 2005 16:30:44 +0100"  >i also opt for an exclusive file lock mechanism. i already have a patched version running...i will provide the patch shortly&lt;br/&gt;
&lt;br/&gt;
btw: you can use process explorer (&lt;a href=&quot;http://www.sysinternals.com/Utilities/ProcessExplorer.html&quot;&gt;http://www.sysinternals.com/Utilities/ProcessExplorer.html&lt;/a&gt;) to search the process that has locked the file and terminate it (like fuser on unix). sometimes it was even explorer.exe that had the lock.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12331137" author="mreutegg" created="Mon, 3 Oct 2005 17:43:19 +0100"  >I also like the approach to use an exclusive file lock.&lt;br/&gt;
&lt;br/&gt;
As a consequence it seems that creating and removing the .lock file is of no use anymore, because it does not actually indicate whether an instance is really using the lock file. The primary indicator is the presence on an exclusive lock on a well known file.&lt;br/&gt;
&lt;br/&gt;
So, how about initially creating the lock file if it is not there and then use only file locking to prevent multiple instances running on the same repository data?</comment>
                    <comment id="12331139" author="mreutegg" created="Mon, 3 Oct 2005 17:51:22 +0100"  >Edgar wrote:&lt;br/&gt;
&amp;gt; Clean shutdowns are very important, actually I turned my repository inconsistent a couple of times killing the jvm process.&lt;br/&gt;
&lt;br/&gt;
IMO the repository should be able to handle such process kills, if it is not we should fix it. There are far too many components involved, which are not 100% reliable. JVMs will always crash, at least the ones that are available right now. So there is no way we can get around this.</comment>
                    <comment id="12331141" author="tripod" created="Mon, 3 Oct 2005 18:11:45 +0100"  >i though of creating and deleting the .lock file as before, but using an exclusive filelock for the actual locking. so if a starting repository detetcs an existing .lock file, it can issue a warning, that the repository was not shutdown properly.</comment>
                    <comment id="12331142" author="tripod" created="Mon, 3 Oct 2005 18:12:21 +0100"  >patch for exclusive locking</comment>
                    <comment id="12331789" author="tripod" created="Tue, 11 Oct 2005 22:38:38 +0100"  >fixed as proposed.&lt;br/&gt;
&lt;br/&gt;
Author: tripod&lt;br/&gt;
Date: Tue Oct 11 05:37:32 2005&lt;br/&gt;
New Revision: 312865&lt;br/&gt;
&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=312865&amp;view=rev&quot;&gt;http://svn.apache.org/viewcvs?rev=312865&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-233&quot; title=&quot;repository lock file not removed without a clean shutdown&quot;&gt;&lt;strike&gt;JCR-233&lt;/strike&gt;&lt;/a&gt; repository lock file not removed without a clean shutdown&lt;br/&gt;
&lt;br/&gt;
Modified:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;incubator/jackrabbit/trunk/src/java/org/apache/jackrabbit/core/RepositoryImpl.java&lt;br/&gt;
&lt;br/&gt;
</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12317665">JCR-245</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12314682" name="replock.293087.diff" size="3169" author="tripod" created="Mon, 3 Oct 2005 18:12:21 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 3 Oct 2005 08:22:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142040</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191078</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>