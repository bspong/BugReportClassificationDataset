<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:03:11 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1066/JCR-1066.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1066] Exclude system index for queries that restrict the result set to nodetypes not availble in the &quot;jcr:system&quot; subtree</title>
                <link>https://issues.apache.org/jira/browse/JCR-1066</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>We already have code that is able to decide whether the system index needs to be included in a search or not (see &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-967&quot; title=&quot;Only search the index for the &amp;quot;jcr:system&amp;quot; tree if needed&quot;&gt;&lt;strike&gt;JCR-967&lt;/strike&gt;&lt;/a&gt;). If I execute a query like &amp;quot;my:app//element(*, my:doc)&amp;quot; this will only search the workspace index. Unfortunately this is slower than &amp;quot;//element(*, my:doc)&amp;quot;, since the first query can not be optimized as the second. In our case both queries return the same result set because we use application specific node types. Even though the second query includes the system index it is still faster than the first one. But it could be even faster because it doesn&amp;#39;t need to search the system index because nodes with the application specific node type can&amp;#39;t be added to the &amp;quot;jcr:system&amp;quot;-tree and are therefore are added never to the system index (am I right?).</description>
                <environment></environment>
            <key id="12376168">JCR-1066</key>
            <summary>Exclude system index for queries that restrict the result set to nodetypes not availble in the &quot;jcr:system&quot; subtree</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="ckiehl">Christoph Kiehl</assignee>
                                <reporter username="ckiehl">Christoph Kiehl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Aug 2007 16:36:06 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:52 +0000</updated>
                    <resolved>Mon, 27 Aug 2007 13:56:13 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-core</component>
                <component>query</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12520274" author="ckiehl" created="Thu, 16 Aug 2007 16:38:37 +0100"  >This is an initial patch. I&amp;#39;m not fully satisfied with it because PathQueryNode shouldn&amp;#39;t know about NodeTypeQueryNode or node types. Maybe someone has a better idea how to implement this?</comment>
                    <comment id="12520294" author="ckiehl" created="Thu, 16 Aug 2007 17:32:45 +0100"  >The first patch was incomplete</comment>
                    <comment id="12520537" author="mreutegg" created="Fri, 17 Aug 2007 13:41:25 +0100"  >&amp;gt; the application specific node type can&amp;#39;t be added to the &amp;quot;jcr:system&amp;quot;-tree and are therefore are added&lt;br/&gt;
&amp;gt; never to the system index (am I right?).&lt;br/&gt;
&lt;br/&gt;
Yes, I think that&amp;#39;s correct.&lt;br/&gt;
&lt;br/&gt;
The list VALID_SYSTEM_INDEX_NODE_TYPE_NAMES is missing some values:&lt;br/&gt;
- intermediate node in the version history tree are of type: rep:versionStorage&lt;br/&gt;
- the node /jcr:system is of type: rep:system (not sure if this one needs to be added)&lt;br/&gt;
- also all supertypes of the ones already in the list need to be added. for sure nt:base and mix:referenceable. I&amp;#39;m not 100% sure if there are more.&lt;br/&gt;
- /jcr:system/jcr:nodeTypes if of type: rep:nodeTypes</comment>
                    <comment id="12520604" author="ckiehl" created="Fri, 17 Aug 2007 17:56:19 +0100"  >Added a corrected patch which incorporates the suggested changes. You were absolutely right. I used Section 6.7.22.1 of the JCR 1.0 spec to verify your additions.</comment>
                    <comment id="12521066" author="ckiehl" created="Mon, 20 Aug 2007 13:55:42 +0100"  >rep:system was still missing</comment>
                    <comment id="12521417" author="mreutegg" created="Tue, 21 Aug 2007 14:05:01 +0100"  >There&amp;#39;s another potential issue. I know of at least one implementation that customizes jackrabbit and uses more than the listed node types under /jcr:system. We should try to make the list customizable.&lt;br/&gt;
&lt;br/&gt;
We could move the list to the SearchIndex class and add a parameter to the method QueryNode.needsSystemTree(). We&amp;#39;d then have: &lt;br/&gt;
&lt;br/&gt;
public abstract boolean needsSystemTree(Set jcrSystemNodeTypes);&lt;br/&gt;
&lt;br/&gt;
where jcrSystemNodeTypes is a Set of QNames.</comment>
                    <comment id="12521634" author="ckiehl" created="Wed, 22 Aug 2007 00:23:50 +0100"  >I&amp;#39;m not really happy with all those solutions. I&amp;#39;m still not sure which part of the core should be responsible for deciding which node types are system tree node types. But I think until now the best solution was to let SearchIndex be responsible for that. What I dislike with that approach is that every QueryNode now knows about the jcr system tree node types. Maybe it would be better to have a QueryNodeFactory which could return a PathQueryNode which already knows about the jcr system tree node types?&lt;br/&gt;
Anyway - I attached a patch implementing the proposed changes.</comment>
                    <comment id="12521769" author="mreutegg" created="Wed, 22 Aug 2007 13:38:11 +0100"  >I like the idea of a QueryNodeFactory.&lt;br/&gt;
&lt;br/&gt;
What do you think about the patch?</comment>
                    <comment id="12522418" author="ckiehl" created="Fri, 24 Aug 2007 08:57:05 +0100"  >I like the patch. Just one thought: &lt;br/&gt;
&lt;br/&gt;
I would prefer removing all those methods that have no factory in their parameter list (like QueryTreeBuilder.createQueryTree() and QueryParser.parse()). Instead I would like to remove DEFAULT_QUERY_NODE_FACTORY from XPathQueryBuilder and JCRSQLQueryBuilder and instantiate QueryImpl in SearchIndex.createExecutableQuery() with the default query ... well maybe I better create a patch. A few lines of code are probably clearer than this text ;)&lt;br/&gt;
&lt;br/&gt;
The patch doesn&amp;#39;t compile because of MergingPathQueryNode not being covered by the factory. But I think if we go the QueryNodeFactory way it should create MergingPathQueryNode instances as well or MergingPathQueryNode should be removed. The functionality could probably be replaced by plain methods. Unfortunately I&amp;#39;m really busy at the moment and have no time to investigate further. Maybe next week.&lt;br/&gt;
&lt;br/&gt;
Although I&amp;#39;m not sure if you like this approach at all. Maybe you need those methods without the factory parameter for backwards compatibility?&lt;br/&gt;
&lt;br/&gt;
Another thought is that QueryNodes still have public constructors which means anyone could instance them. They should probably be package private to force the use of the factory. Ok then, enough ranting. Back to work ... ;)</comment>
                    <comment id="12522997" author="mreutegg" created="Mon, 27 Aug 2007 13:56:13 +0100"  >Applied Christoph&amp;#39;s patch with minor changes:&lt;br/&gt;
- Changed all QueryNode constructors to protected&lt;br/&gt;
- Removed unused constructors&lt;br/&gt;
&lt;br/&gt;
Committed in revision: 570095</comment>
                </comments>
                    <attachments>
                    <attachment id="12364142" name="patch.txt" size="4729" author="ckiehl" created="Mon, 20 Aug 2007 13:55:42 +0100" />
                    <attachment id="12364273" name="patch_with_extendible_system_nodetypes.txt" size="15538" author="ckiehl" created="Wed, 22 Aug 2007 00:23:50 +0100" />
                    <attachment id="12364485" name="QueryNodeFactory_2.patch" size="53104" author="ckiehl" created="Fri, 24 Aug 2007 08:57:05 +0100" />
                    <attachment id="12364310" name="QueryNodeFactory.patch" size="49312" author="mreutegg" created="Wed, 22 Aug 2007 13:38:11 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 17 Aug 2007 12:41:25 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142509</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279601</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>