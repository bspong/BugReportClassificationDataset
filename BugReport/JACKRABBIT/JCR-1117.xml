<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:44:08 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1117/JCR-1117.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1117] Bundle cache is not rolled back when the storage of a ChangeLog fails</title>
                <link>https://issues.apache.org/jira/browse/JCR-1117</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The bundle cache in the bundle persistence managers is not restored to its old state when the AbstractBundlePersistenceManager.store(ChangeLog changeLog) method throws an exception. If, for instance, the storage of references fails then the AbstractBundlePersistenceManager.putBundle(NodePropBundle bundle) method has already been called for all modified bundles. Because of the connection rollback, the bundle cache will be out-of-sync with the persistent state. As a result, the SharedItemStateManager will have an incorrect view of the persistent state.&lt;br/&gt;
Furthermore, if the blockOnConnectionLoss property is set to true, then the BundleDbPersistenceManager can be caught in an infinite loop because of invalid SQL inserts because of an incorrect bundle cache; see attached stacktrace.</description>
                <environment></environment>
            <key id="12377888">JCR-1117</key>
            <summary>Bundle cache is not rolled back when the storage of a ChangeLog fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="martijnh">Martijn Hendriks</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2007 14:38:43 +0100</created>
                <updated>Wed, 29 Apr 2009 08:50:30 +0100</updated>
                    <resolved>Mon, 2 Mar 2009 08:49:37 +0000</resolved>
                            <version>1.3</version>
                <version>1.4</version>
                <version>1.5</version>
                <version>1.5.2</version>
                <version>1.5.3</version>
                <version>1.5.4</version>
                                <fixVersion>1.5.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12526404" author="martijnh" created="Tue, 11 Sep 2007 11:18:06 +0100"  >I think that this could be fixed by extending the CachingPersistenceManager interface by a method to clear the cache(s) for a certain set of ids. The SharedItemStateManager$Update.cancel() method should then call this method first if its persistence manager is a CachingPersistenceManager.</comment>
                    <comment id="12526731" author="martijnh" created="Wed, 12 Sep 2007 10:53:53 +0100"  >Here is a patch that clears the cache(s) of a caching persistence manager from the Update.cancel() method. The AbstractBundlepersistenceManager removes all given nodeIds from its bundle and missing cache.&lt;br/&gt;
</comment>
                    <comment id="12675275" author="martijnh" created="Fri, 20 Feb 2009 07:53:49 +0000"  >The first patch clears the cache too late. Suppose that the storage of a changelog fails, and blockOnConnectionLoss is true, then storage of the ChangeLog is retried with the corrupt bundle cache until it succeeeds. If this succeeds, then possibly corrupt bundles have been flushed to the DB.</comment>
                    <comment id="12675279" author="martijnh" created="Fri, 20 Feb 2009 08:10:35 +0000"  >Linking this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1806&quot; title=&quot;Item not found exception&quot;&gt;JCR-1806&lt;/a&gt; as it might explain inconsistencies.</comment>
                    <comment id="12675360" author="mreutegg" created="Fri, 20 Feb 2009 13:21:00 +0000"  >Wouldn&amp;#39;t it make more sense to move the call to clearBundleCache to AbstractBundlePersistenceManager? In the end any implementation that throws an exception on store(ChangeLog) should ensure the bundle cache consistency, right?</comment>
                    <comment id="12675535" author="martijnh" created="Sat, 21 Feb 2009 08:24:59 +0000"  >Marcel, I think you are right. Furthermore, the &amp;quot;clearBundleCache&amp;quot; method should also clear the &amp;quot;missing&amp;quot; cache. I&amp;#39;ll create a new patch.</comment>
                    <comment id="12677347" author="martijnh" created="Fri, 27 Feb 2009 12:37:03 +0000"  >Added a new patch which addresses Marcel&amp;#39;s comment.</comment>
                    <comment id="12677355" author="mreutegg" created="Fri, 27 Feb 2009 13:17:26 +0000"  >+1&lt;br/&gt;
&lt;br/&gt;
looks good to me.</comment>
                    <comment id="12694417" author="jukkaz" created="Wed, 1 Apr 2009 09:09:01 +0100"  >Merged to the 1.5 branch in revision 760810.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12406321">JCR-1806</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12365626" name="JCR-1117.patch" size="6928" author="martijnh" created="Wed, 12 Sep 2007 10:53:53 +0100" />
                    <attachment id="12400581" name="JCR-1117-v2.patch" size="939" author="martijnh" created="Fri, 20 Feb 2009 07:53:49 +0000" />
                    <attachment id="12401111" name="JCR-1117-v3.patch" size="1257" author="martijnh" created="Fri, 27 Feb 2009 12:37:03 +0000" />
                    <attachment id="12400519" name="stacktrace.txt" size="2286" author="martijnh" created="Thu, 19 Feb 2009 14:22:43 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 20 Feb 2009 13:21:00 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78659</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>252735</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>