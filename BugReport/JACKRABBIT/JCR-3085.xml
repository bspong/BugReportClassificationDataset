<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:02:49 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3085/JCR-3085.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3085] better diagnostics when version storage is broken</title>
                <link>https://issues.apache.org/jira/browse/JCR-3085</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>In InternalVersionManagerBase, the code doesn&amp;#39;t do a null-check on the predecessors property, assuming it&amp;#39;ll always be present. When this is not the case due to a repository problem, we&amp;#39;ll see a NPE.&lt;br/&gt;
&lt;br/&gt;
Proposal: add code that generates a more meaningful error message; making it easier to debug in production.</description>
                <environment></environment>
            <key id="12525155">JCR-3085</key>
            <summary>better diagnostics when version storage is broken</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="reschke">Julian Reschke</assignee>
                                <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Sep 2011 09:37:01 +0100</created>
                <updated>Tue, 8 Nov 2011 15:44:57 +0000</updated>
                    <resolved>Thu, 29 Sep 2011 16:53:46 +0100</resolved>
                            <version>2.2.8</version>
                <version>2.4</version>
                                <fixVersion>2.2.10</fixVersion>
                <fixVersion>2.3.1</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13117138" author="reschke" created="Thu, 29 Sep 2011 09:37:36 +0100"  >Proposed change:&lt;br/&gt;
&lt;br/&gt;
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalVersionManagerBase.java	(revision 1176889)&lt;br/&gt;
+++ jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalVersionManagerBase.java	(working copy)&lt;br/&gt;
@@ -681,6 +681,13 @@&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// 1. search a predecessor, suitable for generating the new name&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;InternalValue[] values = node.getPropertyValues(NameConstants.JCR_PREDECESSORS);&lt;br/&gt;
+&lt;br/&gt;
+            if (values == null) {&lt;br/&gt;
+                String message = &amp;quot;mandatory jcr:predecessors property missing on &amp;quot; + node.getNodeId();&lt;br/&gt;
+                log.error(message);&lt;br/&gt;
+                throw new VersionException(message);&lt;br/&gt;
+            }&lt;br/&gt;
+            &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for (InternalValue value: values) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;InternalVersion pred = history.getVersion(value.getNodeId());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (best == null</comment>
                    <comment id="13117142" author="reschke" created="Thu, 29 Sep 2011 09:38:49 +0100"  >(is VersionException the right one here? Maybe create a new exception reserved for case of inconsistent persistence state?) </comment>
                    <comment id="13117223" author="reschke" created="Thu, 29 Sep 2011 12:33:54 +0100"  >fixed in trunk with r1177249</comment>
                    <comment id="13117239" author="mreutegg" created="Thu, 29 Sep 2011 13:24:03 +0100"  >Removed 2.2.9 fix version (already released).</comment>
                    <comment id="13117380" author="reschke" created="Thu, 29 Sep 2011 16:53:47 +0100"  >With r1177249 </comment>
                    <comment id="13117939" author="reschke" created="Fri, 30 Sep 2011 09:05:50 +0100"  >Fixed in 2.2 with r1177546.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 29 Sep 2011 12:24:03 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>39744</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>250236</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>