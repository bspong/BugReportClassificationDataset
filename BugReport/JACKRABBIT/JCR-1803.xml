<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:01:23 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1803/JCR-1803.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1803] Node.restore() throws java.lang.ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/JCR-1803</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I&amp;#39;m trying to upgrade to 1.5 using existing 1.3.x repository. Restore of versionable node throws ClassCastException.&lt;br/&gt;
&lt;br/&gt;
Caused by: java.lang.ClassCastException: org.apache.jackrabbit.uuid.UUID&lt;br/&gt;
	at org.apache.jackrabbit.core.value.InternalValue.getString(InternalValue.java:436)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.InternalFrozenNodeImpl.&amp;lt;init&amp;gt;(InternalFrozenNodeImpl.java:113)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.AbstractVersionManager.createInternalVersionItem(AbstractVersionManager.java:576)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.VersionManagerImpl.getItem(VersionManagerImpl.java:258)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.InternalVersionImpl.getFrozenNode(InternalVersionImpl.java:111)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.VersionImpl.getFrozenNode(VersionImpl.java:120)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.internalRestore(NodeImpl.java:4180)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.internalRestore(NodeImpl.java:4141)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.restore(NodeImpl.java:3429)&lt;br/&gt;
&lt;br/&gt;
It seems that bug has been introduced already in 1.4 as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-926&quot; title=&quot;Global data store for binaries&quot;&gt;&lt;strike&gt;JCR-926&lt;/strike&gt;&lt;/a&gt; (InternalValue cleanup).&lt;br/&gt;
&lt;br/&gt;
Index: C:/data/jackrabbit/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalFrozenNodeImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
--- C:/data/jackrabbit/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalFrozenNodeImpl.java	(revision 549117)&lt;br/&gt;
+++ C:/data/jackrabbit/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalFrozenNodeImpl.java	(working copy)&lt;br/&gt;
@@ -109,10 +109,10 @@&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PropertyState prop = props[i];&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (prop.getName().equals(QName.JCR_FROZENUUID)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// special property&lt;br/&gt;
-                frozenUUID = UUID.fromString(node.getPropertyValue(QName.JCR_FROZENUUID).internalValue().toString());&lt;br/&gt;
+                frozenUUID = UUID.fromString(node.getPropertyValue(QName.JCR_FROZENUUID).getString());&lt;br/&gt;
&lt;br/&gt;
Probably one of the assumptions made was wrong :&lt;br/&gt;
- The type of QName.JCR_FROZENUUID is STRING (Object.toString() was used before).</description>
                <environment></environment>
            <key id="12406303">JCR-1803</key>
            <summary>Node.restore() throws java.lang.ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="ppakulski">Przemo Pakulski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Oct 2008 14:08:59 +0100</created>
                <updated>Mon, 8 Dec 2008 11:08:01 +0000</updated>
                    <resolved>Mon, 13 Oct 2008 17:44:05 +0100</resolved>
                            <version>core 1.4.6</version>
                                <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12639046" author="jukkaz" created="Mon, 13 Oct 2008 14:24:10 +0100"  >Have you upgraded all the Jackrabbit jars in your classpath to 1.5? This looks more like a class version mismatch than a compatibility issue with repository content.</comment>
                    <comment id="12639070" author="ppakulski" created="Mon, 13 Oct 2008 15:49:09 +0100"  >I&amp;#39;ve examined that all the libraries are ok. &lt;br/&gt;
&lt;br/&gt;
Problem seems to be related to old issue  &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-487&quot; title=&quot;the jcr:frozenUuid property is of type REFERENCE instead of STRING&quot;&gt;&lt;strike&gt;JCR-487&lt;/strike&gt;&lt;/a&gt;, our version storage still contains frozen nodes with jcr:frozenUuid field stored as REFERENCE instead of STRING. &lt;br/&gt;
&lt;br/&gt;
Method internalValue().toString() works in both cases, whilst getString() on jcr:frozenUUID fails for such nodes :(.</comment>
                    <comment id="12639074" author="jukkaz" created="Mon, 13 Oct 2008 16:06:23 +0100"  >Ah, that would explain the issue. I&amp;#39;ll look into this.</comment>
                    <comment id="12639075" author="ppakulski" created="Mon, 13 Oct 2008 16:16:35 +0100"  >I fixed it by simply reverting this single line. Doesn&amp;#39;t like it but works :).&lt;br/&gt;
&lt;br/&gt;
Alternative solution is to fix the whole existing version storage somehow on low level (PM?), but it must be done differently depending on used persistence manager.</comment>
                    <comment id="12639102" author="jukkaz" created="Mon, 13 Oct 2008 17:44:05 +0100"  >I think it&amp;#39;s better if we just explicitly handle both STRING and REFERENCE values here.&lt;br/&gt;
&lt;br/&gt;
I committed the fix to trunk in revision 704158. Instead of using the discouraged internalValue() method, I explicitly check the type of the value and react accordingly.&lt;br/&gt;
&lt;br/&gt;
Merged to the 1.5 branch in revision 704160.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 13 Oct 2008 13:24:10 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78419</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189754</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>