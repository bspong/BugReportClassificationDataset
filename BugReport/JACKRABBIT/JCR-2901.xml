<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:41:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2901/JCR-2901.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2901] JCR-2523 break the transaction handling in container managed environment</title>
                <link>https://issues.apache.org/jira/browse/JCR-2901</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>during the cleanup (returning to the pool) of an jca managed connection,  an new internal session is created in the object JCAManagedConnection in the method cleanup, this is supposed to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2523&quot; title=&quot;StaleItemStateException during distributed transaction&quot;&gt;&lt;strike&gt;JCR-2523&lt;/strike&gt;&lt;/a&gt;, The sideeffect is, that the XA-Resource (variable-xaResource) in JCAManagedConnection is not anymore the same XASessionImpl Object like the session Object. Subsequent calls on this connection, lead that the internal session variable is not anymore informed about the current transaction context. (XAItemStateManager, variables tx and txLog are null), because only the xaResource is informed about the new transaction context. Result is that the complete transaction handling does not work anymore.&lt;br/&gt;
I attached a sample project which shows this behaviour.&lt;br/&gt;
</description>
                <environment>Container managed transactions on jboss 4.2.3  with spring-jcr-modules</environment>
            <key id="12499256">JCR-2901</key>
            <summary>JCR-2523 break the transaction handling in container managed environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="c_koell">Claus K&#246;ll</assignee>
                                <reporter username="azschorn">Andreas Zschorn</reporter>
                        <labels>
                        <label>Transaction,</label>
                        <label>container</label>
                        <label>managed</label>
                    </labels>
                <created>Mon, 21 Feb 2011 17:59:02 +0000</created>
                <updated>Tue, 24 May 2011 16:50:43 +0100</updated>
                    <resolved>Thu, 24 Feb 2011 13:39:02 +0000</resolved>
                            <version>2.1.3</version>
                <version>2.2.4</version>
                                <fixVersion>2.1.5</fixVersion>
                <fixVersion>2.2.5</fixVersion>
                                <component>jackrabbit-jca</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12997497" author="azschorn" created="Mon, 21 Feb 2011 18:02:36 +0000"  >test project which shows the wrong transaction behaviour</comment>
                    <comment id="12997797" author="c_koell" created="Tue, 22 Feb 2011 13:48:28 +0000"  >This patch assigns the the new opened Session Object to its internal XAResource. Can you test the patch ?</comment>
                    <comment id="12997923" author="azschorn" created="Tue, 22 Feb 2011 17:45:32 +0000"  >i tested it, it does not work, nevertheless we found hopefully a final solution. I will create a patch for it. The TransactionBoundXAResource may not be newly created. This objects are cached by the transaction handler from the application server. So the solution is just to set the session.getXAResource in the TracsactionBoundXAResource. After this everything works as expected.</comment>
                    <comment id="12997930" author="azschorn" created="Tue, 22 Feb 2011 17:55:45 +0000"  >Patch which is working for us, includes the first patch</comment>
                    <comment id="12997936" author="azschorn" created="Tue, 22 Feb 2011 18:12:18 +0000"  >Just some additional information, after reading javadoc and the spec for the resource adapter, this is the normal behaviour. The managed connection and the xa resource have two different purposes, but need to be in sync. Because the managed connections are cached by the pool it is not allowed just to recreate the xa resource in the managed connection. It will have no effect. Thats the reason i assigned the transactionboundxaresource the newly created xaresource from the new created session. Hope there is not an threading problem with this, but i don&amp;#39;t see any at the moment.</comment>
                    <comment id="12997975" author="azschorn" created="Tue, 22 Feb 2011 19:15:44 +0000"  >Another thing, is it possible  to merge the sample project with the jca-project, so the current testcases could be extended. The current testcases for the jca project are pretty simple and it would be great if they could be extended.</comment>
                    <comment id="12998840" author="c_koell" created="Thu, 24 Feb 2011 13:24:56 +0000"  >Thank you for the patch and the infos.&lt;br/&gt;
The Problem to test it is that we have no container running in the testscases but i will have a look at it and discuss it how we can handle this.</comment>
                    <comment id="12998843" author="c_koell" created="Thu, 24 Feb 2011 13:39:02 +0000"  >commited in rev. 1074140</comment>
                    <comment id="12998858" author="azschorn" created="Thu, 24 Feb 2011 14:16:42 +0000"  >Thanks, in the sample project we run jencks as an container, so it can be used without an application server and spring does the rest.</comment>
                    <comment id="13005658" author="jukkaz" created="Fri, 11 Mar 2011 14:49:44 +0000"  >Merged to the 2.2 branch in revision 1080584.</comment>
                </comments>
                    <attachments>
                    <attachment id="12471618" name="JCR-2901.patch" size="1190" author="c_koell" created="Tue, 22 Feb 2011 13:48:28 +0000" />
                    <attachment id="12471645" name="JCR-2901-working.patch" size="1868" author="azschorn" created="Tue, 22 Feb 2011 17:55:45 +0000" />
                    <attachment id="12471575" name="testproject.zip" size="8518" author="azschorn" created="Mon, 21 Feb 2011 18:02:36 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 22 Feb 2011 13:48:28 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78130</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189786</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>