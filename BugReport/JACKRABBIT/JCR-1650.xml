<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:30:46 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1650/JCR-1650.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1650] XPathQueryBuilder may not handle multiple jcr:deref correctly</title>
                <link>https://issues.apache.org/jira/browse/JCR-1650</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>If you have the following tree (inspired from DerefTest) :&lt;br/&gt;
+ people&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;+ carl (worksfor -&amp;gt; company/microsoft)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;+ frank (worksfor -&amp;gt; company/microsoft)&lt;br/&gt;
+ company&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ microsoft (eotm -&amp;gt; carl)&lt;br/&gt;
&lt;br/&gt;
The following queries will be translated to :&lt;br/&gt;
&lt;br/&gt;
testroot/people/frank/jcr:deref(@worksfor, &amp;#39;*&amp;#39;)/jcr:deref(@eotm, &amp;#39;*&amp;#39;)&lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}testroot Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}people Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}frank Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
=&amp;gt; Matching carl node&lt;br/&gt;
&lt;br/&gt;
testroot/people/frank/jcr:deref(@worksfor, &amp;#39;*&amp;#39;)/jcr:deref(@eotm, &amp;#39;*&amp;#39;)[@jcr:uuid]&lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}testroot Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}people Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}frank Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ RelationQueryNode: Op: NOT NULL Prop=@{&lt;a href=&quot;http://www.jcp.org/jcr/1.0&quot;&gt;http://www.jcp.org/jcr/1.0&lt;/a&gt;}uuid&lt;br/&gt;
=&amp;gt; Not matching carl node&lt;br/&gt;
&lt;br/&gt;
testroot/people/frank/jcr:deref(@worksfor, &amp;#39;*&amp;#39;)[@jcr:uuid]/jcr:deref(@eotm, &amp;#39;*&amp;#39;)[@jcr:uuid]&lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}testroot Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}people Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}frank Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ RelationQueryNode: Op: NOT NULL Prop=@{&lt;a href=&quot;http://www.jcp.org/jcr/1.0&quot;&gt;http://www.jcp.org/jcr/1.0&lt;/a&gt;}uuid&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ RelationQueryNode: Op: NOT NULL Prop=@{&lt;a href=&quot;http://www.jcp.org/jcr/1.0&quot;&gt;http://www.jcp.org/jcr/1.0&lt;/a&gt;}uuid&lt;br/&gt;
=&amp;gt; Matching carl node&lt;br/&gt;
&lt;br/&gt;
testroot/people/frank/jcr:deref(@worksfor, &amp;#39;*&amp;#39;)[@jcr:uuid]/jcr:deref(@eotm, &amp;#39;*&amp;#39;)&lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}testroot Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}people Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={}frank Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ RelationQueryNode: Op: NOT NULL Prop=@{&lt;a href=&quot;http://www.jcp.org/jcr/1.0&quot;&gt;http://www.jcp.org/jcr/1.0&lt;/a&gt;}uuid&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ DerefQueryNode:  NodeTest=* Descendants=false Index=NONE&lt;br/&gt;
=&amp;gt; Matching carl node&lt;br/&gt;
&lt;br/&gt;
This is because XPathQueryBuilder calls NAryQueryNode#removeOperand(QueryNode)&lt;br/&gt;
in order to replace current LocationStepQueryNode with a DerefQueryNode.&lt;br/&gt;
&lt;br/&gt;
NAryQueryNode#removeOperand(QueryNode) uses internally a List and thus&lt;br/&gt;
relies on Object#equals(Object) for retrieving the object to remove.&lt;br/&gt;
&lt;br/&gt;
But the equals method is redefined for every QueryNode with a different semantic.&lt;br/&gt;
&lt;br/&gt;
Then, the call to NAryQueryNode#removeOperand(QueryNode) will not remove the&lt;br/&gt;
wanted operand but the first operand returning true after calling equals in&lt;br/&gt;
ArrayList#remove(Object).</description>
                <environment></environment>
            <key id="12398304">JCR-1650</key>
            <summary>XPathQueryBuilder may not handle multiple jcr:deref correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="yabon">S&#233;bastien Launay</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jun 2008 09:34:22 +0100</created>
                <updated>Tue, 6 Jan 2009 15:57:19 +0000</updated>
                    <resolved>Mon, 16 Jun 2008 10:25:28 +0100</resolved>
                            <version>1.4</version>
                <version>core 1.4.5</version>
                                <fixVersion>core 1.4.6</fixVersion>
                                <component>jackrabbit-spi-commons</component>
                <component>xpath</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12605225" author="yabon" created="Mon, 16 Jun 2008 09:52:53 +0100"  >Patch for the 1.4 branch containing:&lt;br/&gt;
&amp;nbsp;* additional tests for reproducing this bug in DerefTest test case.&lt;br/&gt;
&amp;nbsp;* a fix by rewriting NAryQueryNode#removeOperand(QueryNode) without relying on Object#equals(Object) but on reference comparison.</comment>
                    <comment id="12605230" author="mreutegg" created="Mon, 16 Jun 2008 10:17:12 +0100"  >Affects jackrabbit-core in 1.4.x and jackrabbit-spi-commons in trunk.</comment>
                    <comment id="12605232" author="mreutegg" created="Mon, 16 Jun 2008 10:25:28 +0100"  >Fixed in trunk at revision: 668086&lt;br/&gt;
&lt;br/&gt;
Thank you for providing a patch and the detailed analysis.</comment>
                    <comment id="12605233" author="yabon" created="Mon, 16 Jun 2008 10:28:19 +0100"  >I think this is the same bug as &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1075&quot; title=&quot;Error with predicate in query with multiple jcr:deref()&quot;&gt;&lt;strike&gt;JCR-1075&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12635370" author="yabon" created="Mon, 29 Sep 2008 13:59:00 +0100"  >I would like to have this fix backported to the 1.4 branch, possibly in the next release (1.4.6) as the 1.5 is not planned to be released soon.</comment>
                    <comment id="12635397" author="jukkaz" created="Mon, 29 Sep 2008 15:53:11 +0100"  >Merged to the 1.4 branch in revision 700143. This fix will be included in jackrabbit-core 1.4.6.</comment>
                    <comment id="12635406" author="yabon" created="Mon, 29 Sep 2008 16:14:23 +0100"  >Thanks for the merge.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310000">
                <name>Duplicate</name>
                                <outwardlinks description="duplicates">
                            <issuelink>
            <issuekey id="12376594">JCR-1075</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12384040" name="jackrabbit-1.4.x-fix-multiple-jcr-deref-2008-06-16.patch" size="4047" author="yabon" created="Mon, 16 Jun 2008 09:52:53 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 16 Jun 2008 09:17:12 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78471</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191659</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>