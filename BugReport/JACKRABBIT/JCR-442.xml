<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:47:12 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-442/JCR-442.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-442] Implement a backup tool</title>
                <link>https://issues.apache.org/jira/browse/JCR-442</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Issue for tracking the progress of the Google Summer of Code project assigned to Nicolas Toper.  The original project requirements are:&lt;br/&gt;
&lt;br/&gt;
&amp;quot;Implement a tool for backing up and restoring content in an Apache Jackrabbit content repository. In addition to the basic content hierarchies, the tool should be able to efficiently manage binary content, node version histories, custom node types, and namespace mappings. Incremental or selective backups would be a nice addition, but not strictly necessary.&amp;quot;</description>
                <environment></environment>
            <key id="12343462">JCR-442</key>
            <summary>Implement a backup tool</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 May 2006 19:16:28 +0100</created>
                <updated>Thu, 13 Aug 2009 16:03:38 +0100</updated>
                    <resolved>Tue, 4 Aug 2009 18:03:39 +0100</resolved>
                                            <fixVersion>1.6</fixVersion>
                                <component>jackrabbit-core</component>
                <component>jackrabbit-standalone</component>
                        <due></due>
                    <votes>3</votes>
                        <watches>5</watches>
                                                    <comments>
                    <comment id="12417798" author="ntoper" created="Mon, 26 Jun 2006 20:17:39 +0100"  >It is my first patch ever ;) Please be indulgent. Tell me if I did it right.</comment>
                    <comment id="12417844" author="tripod" created="Tue, 27 Jun 2006 01:11:21 +0100"  >some thoughts:&lt;br/&gt;
- why needs BackupConfig.init() the repositoryimpl ? i would do a Config.getBackup(repo) instead.&lt;br/&gt;
- you don&amp;#39;t need to call super() in the Backup class, since it extends from Object.&lt;br/&gt;
- if config creates backup, why do you need to pass config to save() ? (and why not passing one to restore?)&lt;br/&gt;
- if config.getBackup() returns a Backup, why does RepositoryImpl.getBackupRepository() return a BackupRepository ?&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12417845" author="tripod" created="Tue, 27 Jun 2006 01:12:40 +0100"  >btw: patch is perfect :-) (except, that it could be relative to the jackrabbit directory)</comment>
                    <comment id="12417983" author="jukkaz" created="Tue, 27 Jun 2006 17:09:32 +0100"  >Looks good. Once you&amp;#39;re done fixing the issues mentioned here and on the ML, I&amp;#39;ll be happy to merge the changes to the svn trunk.</comment>
                    <comment id="12418812" author="ntoper" created="Sun, 2 Jul 2006 06:24:37 +0100"  >I have updated the code as seen through the mailing list. I am more available now that most of my exams are over (only one remaining on Friday - crossing fingers).&lt;br/&gt;
&lt;br/&gt;
If everybody&amp;#39;s OK with this work. I will continue working on the methods body (see methods started but commented).&lt;br/&gt;
&lt;br/&gt;
I am waiting for your feedback :)</comment>
                    <comment id="12418868" author="jukkaz" created="Mon, 3 Jul 2006 05:06:57 +0100"  >Thanks for the update, looks good. There&amp;#39;s some small issues, but I think it&amp;#39;s better to let the source evolve instead of fixing the details at this point.&lt;br/&gt;
&lt;br/&gt;
One relatively major thing though before I merge this... Could you rename also ConfigBackup to BackupConfig? The current name indicates &amp;quot;configuration backup&amp;quot; rather than the intended &amp;quot;backup configuration&amp;quot;.</comment>
                    <comment id="12418869" author="ntoper" created="Mon, 3 Jul 2006 05:19:35 +0100"  >ConfigBackup is now called BackupConfig.&lt;br/&gt;
&lt;br/&gt;
It is my first accepted patch on  Apache Jackrabbit :)</comment>
                    <comment id="12418871" author="jukkaz" created="Mon, 3 Jul 2006 06:09:58 +0100"  >Thanks, merged in revision 418655.&lt;br/&gt;
&lt;br/&gt;
You&amp;#39;ll probably get a ton of conflicts when you update, as I made some checkstyle adjustments to your code (replaced tabs with spaces, etc.). In future, use spaces for tabs and the HEADER.txt without even whitespace changes (using an exact copy allows  easy automated checking) as the license header.</comment>
                    <comment id="12419302" author="ntoper" created="Thu, 6 Jul 2006 00:06:54 +0100"  >Deleting the backup package and restoring RepositoryImpl to its previous configuration.</comment>
                    <comment id="12420441" author="ntoper" created="Wed, 12 Jul 2006 05:19:44 +0100"  >LaunchBackup tested and completed. (issue with Eclipse and SVN so please tell me if you have a problem importing the patch)</comment>
                    <comment id="12421137" author="ntoper" created="Fri, 14 Jul 2006 16:46:04 +0100"  >Jackrabbit patch with 2 classes for ConfigurationParser. I couldn&amp;#39;t test the class since Jackrabbit does not currently compile through Maven. &lt;br/&gt;
&lt;br/&gt;
In theory no problem, since I just moved some methods from one class to the other (and add super where needed).</comment>
                    <comment id="12421359" author="jukkaz" created="Sat, 15 Jul 2006 23:47:55 +0100"  >Applied the patches that removed the backup classes from core (patch.txt [12336377]) and added them to the contrib/backup subproject (patch.txt  [12336687]) .&lt;br/&gt;
&lt;br/&gt;
The latter patch required some tweaking as it didn&amp;#39;t compile out of the box (see BackupConfig.create(InputSource, String)). Please check that the project compiles before sending a patch, normally a patch that doesn&amp;#39;t compile would be rejected without further consideration.  And (as already discussed in private) please also use spaces for indentation instead of tabs.</comment>
                    <comment id="12421361" author="jukkaz" created="Sat, 15 Jul 2006 23:53:56 +0100"  >&amp;gt; Jackrabbit patch with 2 classes for ConfigurationParser.&lt;br/&gt;
&lt;br/&gt;
This patch (jackrabbit-1.patch.txt) is not valid. It seems to remove the entire ConfigurationParser class but then reference it from a partially modified RepositoryConfigurationParser class (that doesn&amp;#39;t even exist yet in svn). Please review your setup and try recreating the patch.&lt;br/&gt;
</comment>
                    <comment id="12421363" author="ntoper" created="Sun, 16 Jul 2006 00:30:04 +0100"  >- XML configuration file is correctly parsed and interpreted by the Backup tool. &lt;br/&gt;
- code compiles and is tested&lt;br/&gt;
- Indentations is composed of spaces and not anymore tabs.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12421364" author="ntoper" created="Sun, 16 Jul 2006 01:06:28 +0100"  >- The new correct patch (I don&amp;#39;t try to delete and recreate the same file within the same patch)&lt;br/&gt;
- No tabs :p&lt;br/&gt;
</comment>
                    <comment id="12421854" author="jukkaz" created="Tue, 18 Jul 2006 13:11:15 +0100"  >&amp;gt; The new correct patch (I don&amp;#39;t try to delete and recreate the same file within the same patch) &lt;br/&gt;
&lt;br/&gt;
I see what you&amp;#39;re trying to do, but the patch still tries to modify the non-existent RepositoryConfigurationParser class instead of correctly adding it. Did you start it as a copy of ConfigurationParser? I tried doing the same and was able to apply the patch without problems.&lt;br/&gt;
&lt;br/&gt;
Still, I didn&amp;#39;t yet commit the change, as there are two issues I&amp;#39;d like resolved:&lt;br/&gt;
&lt;br/&gt;
a) Make RepositoryConfigurationParser a subclass of ConfigurationParser and use inheritance to access the protected methods from ConfigurationParser.&lt;br/&gt;
b) Remove the createSubParser() method from the ConfigurationParser base class, it&amp;#39;s only needed by RepositoryConfigurationParser.&lt;br/&gt;
</comment>
                    <comment id="12421929" author="ntoper" created="Tue, 18 Jul 2006 20:31:11 +0100"  >a) Make RepositoryConfigurationParser a subclass of ConfigurationParser and use inheritance to access the protected methods from ConfigurationParser.&lt;br/&gt;
b) Remove the createSubParser() method from the ConfigurationParser base class, it&amp;#39;s only needed by RepositoryConfigurationParser.&lt;br/&gt;
c) Same issue as always for those patches: I delete and recreate the class. I don&amp;#39;t know if it&amp;#39;s solved but we won&amp;#39;t have anymore this problem anyway for the next patches.</comment>
                    <comment id="12421980" author="jukkaz" created="Tue, 18 Jul 2006 22:56:38 +0100"  >&amp;gt; Same issue as always for those patches: I delete and recreate the class. I don&amp;#39;t know if it&amp;#39;s solved but we won&amp;#39;t have anymore this problem anyway for the next patches.&lt;br/&gt;
&lt;br/&gt;
Now it&amp;#39;s even worse. This patch (patch-jackrabbit-060718.txt)  would totally remove the ConfigurationParser, and it still doesn&amp;#39;t handle the RepositoryConfigurationParser class properly. I think I got your idea though, I&amp;#39;ll recreate the changes manually to get us forward. It&amp;#39;s perhaps better to avoid using the Eclipse file copy and move operations while working via patches.</comment>
                    <comment id="12421985" author="jukkaz" created="Tue, 18 Jul 2006 23:15:09 +0100"  >Committed the ConfigurationParser changes in revision 423267.</comment>
                    <comment id="12422213" author="ntoper" created="Wed, 19 Jul 2006 19:01:29 +0100"  >Patch for the backup tool:&lt;br/&gt;
&lt;br/&gt;
1/ Parsing of the configuration file is over&lt;br/&gt;
2/ Instanciation of the backup manager&lt;br/&gt;
3/ First draft of the ZipBackupIOHandler.&lt;br/&gt;
&lt;br/&gt;
The code is still a work in progress. All your comments are greatly appreciated.</comment>
                    <comment id="12422233" author="jukkaz" created="Wed, 19 Jul 2006 20:33:36 +0100"  >Committed patch-backup-060719.txt in revision 423575.&lt;br/&gt;
&lt;br/&gt;
Some issues to consider:&lt;br/&gt;
&lt;br/&gt;
* The SizeException and RepositoryConfigBackup classes do not have the correct license headers. Please add them.&lt;br/&gt;
* What is the SizeException used for?&lt;br/&gt;
* You still have tabs in the code. Check your Java / Code Style / Formatter settings. I&amp;#39;m using the &amp;quot;Java&amp;quot; settings that has the Tab Policy of &amp;quot;Spaces only&amp;quot;.&lt;br/&gt;
* Consider renaming ManagerBackup (that backs up the manager) to BackupManager (that manages the backup). See the naming discussions we had earlier.&lt;br/&gt;
* Could you come up with a simple test case that sets up a dummy repository and launches the backup tool on it? For now it doesn&amp;#39;t need to actually do anything useful, just to check that the code runs in addition to it compiling.&lt;br/&gt;
&lt;br/&gt;
Other than that, keep up the good work! It&amp;#39;s nice to see things forming up.</comment>
                    <comment id="12423464" author="ntoper" created="Tue, 25 Jul 2006 22:30:45 +0100"  >Update to JR core in order to achieve Backup. Here are the modifications:&lt;br/&gt;
- RepositoryImpl: getNodeTypeRegistry is now public +  Properties loadRepProps() + public String[] getWorkspaceNames() public getSystemSession()&lt;br/&gt;
- added in RepositoryImpl WorkspaceConfig getWorkspaceConfig(String workspaceName)&lt;br/&gt;
- NodeTypeRegistry: added method public NodeTypeDef[] getRegisteredNodesTypesDefs()&lt;br/&gt;
- Any tabs issues? (I found some in some files I didn&amp;#39;t update so I didn&amp;#39;t dare to replaceAll &amp;quot;regexpically&amp;quot;)&lt;br/&gt;
- class SystemSession is now public&lt;br/&gt;
&lt;br/&gt;
Maybe I have put too many classes in public. Please tell me...</comment>
                    <comment id="12423465" author="ntoper" created="Tue, 25 Jul 2006 22:33:01 +0100"  >&amp;quot;first sizable patch&amp;quot;. Not everything is working yet...&lt;br/&gt;
&lt;br/&gt;
- solved tab issue &lt;br/&gt;
- renamed ManagerBackup as BackupManager&lt;br/&gt;
- no more SizeException&lt;br/&gt;
- added missing ASF license headers&lt;br/&gt;
- test case added in src/test: some path are hardcoded: how should I generify the test case? Which other ones would you want?&lt;br/&gt;
- Backup nearly over. (I am starting to work on the restore as soon as we all agree on the backup.) A lot of todo are still there :p&lt;br/&gt;
- I have seen a lot of sanityCheck in the current code. Should I put also a lot of them in mine :p?&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
A list of question is coming by email :)&lt;br/&gt;
&lt;br/&gt;
Thanks for your help&lt;br/&gt;
Nico</comment>
                    <comment id="12423466" author="ntoper" created="Tue, 25 Jul 2006 22:37:16 +0100"  >A few remarks I forgot to write: I was outside of Internet connection for a few days, this is why this patch is so &amp;quot;big&amp;quot;. You will find the current backup structure. &lt;br/&gt;
&lt;br/&gt;
Not everything is working and is final yet.&lt;br/&gt;
&lt;br/&gt;
Some code still needs refactoring and to be commented.&lt;br/&gt;
&lt;br/&gt;
Can you please tell me which test case should I write? Do you have any idea already?&lt;br/&gt;
&lt;br/&gt;
Can you please check the way I am doing the backup is fine. &lt;br/&gt;
&lt;br/&gt;
Soon, we will be able to backup things up :)</comment>
                    <comment id="12423562" author="jukkaz" created="Wed, 26 Jul 2006 08:32:11 +0100"  >Some comments:&lt;br/&gt;
&lt;br/&gt;
a) You can get the NamespaceRegistry and NodeTypeManager (and through it, the NodeTypeRegistry) instances and the list of available workspaces through Session.getWorkspace(). See the JSR-170 javadocs.&lt;br/&gt;
&lt;br/&gt;
b) It might be better to add the getWorkspaceConfig() method to WorkspaceImpl and access it through the system session for that workspace.&lt;br/&gt;
&lt;br/&gt;
c) I&amp;#39;m a bit worried about publishing the SystemSession, but this is likely required for the backup and also some other external efforts like the AccessManagers. We need to check that publishing the system sessions won&amp;#39;t cause any trouble.&lt;br/&gt;
&lt;br/&gt;
d) I think the parsePersistenceManagerConfig() method belongs in RepositoryConfigurationParser instead of the ConfigurationParser base class.&lt;br/&gt;
&lt;br/&gt;
e) Do you really need to add the getRegisteredNodesTypesDefs() method? I think it would be nicer if you could collect the registered node types using the existing methods, for example in NodeTypeManager.&lt;br/&gt;
&lt;br/&gt;
f) The patch shows an extra newline in NodeTypeWriter. Try to avoid introducing such changes when you make no other changes to the class. It just adds cruft to the patch and if I were to commit the changes as-is, it would make a new svn version of the file even though nothing really changed.&lt;br/&gt;
&lt;br/&gt;
Could you please fix issues a,b,d,e,f before I can commit these changes.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; solved tab issue&lt;br/&gt;
&lt;br/&gt;
Still seeing some tabs, for example in your getWorkspaceConfig() and getRegisteredNodesTypesDefs() methods (patch-jackrabbit-060725.txt).&lt;br/&gt;
&lt;br/&gt;
&amp;gt; renamed ManagerBackup as BackupManager&lt;br/&gt;
&amp;gt; no more SizeException&lt;br/&gt;
&amp;gt; added missing ASF license headers&lt;br/&gt;
&lt;br/&gt;
OK, thanks.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; test case added in src/test: some path are hardcoded: how should I generify the test case?&lt;br/&gt;
&amp;gt; Which other ones would you want?&lt;br/&gt;
&lt;br/&gt;
This is a good start. You might want to turn the hardcoded paths to command line options and provide reasonable relative paths as defaults. Some notes:&lt;br/&gt;
&lt;br/&gt;
* TestBackup is missing the license header&lt;br/&gt;
* Rename the class to BackupTest to comply with the naming in Jackrabbit. I suppose yuor naming issue has roots in the way the French language works, AFAIK you combine words in the opposite order than in English. :-)&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I have seen a lot of sanityCheck in the current code. Should I put also a lot of them in mine :p?&lt;br/&gt;
&lt;br/&gt;
If there&amp;#39;s a possibility that your code gets into an invalid state. The sanityChecks in Jackrabbit mostly check whether a repository or a session has already been closed. I don&amp;#39;t think a similar case appears with the backup system.&lt;br/&gt;
</comment>
                    <comment id="12423668" author="ntoper" created="Wed, 26 Jul 2006 16:33:23 +0100"  >Patch including (nearly) all corrections asked by Jukka. See comments please.</comment>
                    <comment id="12423669" author="ntoper" created="Wed, 26 Jul 2006 16:34:12 +0100"  >New patch. Implements corrections asked by Jukka. I changed a lot less methods</comment>
                    <comment id="12423670" author="ntoper" created="Wed, 26 Jul 2006 16:34:42 +0100"  >Hi Jukka,&lt;br/&gt;
&lt;br/&gt;
Here are my answers :p&lt;br/&gt;
&lt;br/&gt;
a/ Done. Maybe I should put in the constructor of Backup the session since it&amp;#39;s shared by a few classes. What do you think? I had to look for the default workspace to get a System Session. Can we assume it&amp;#39;s always there?&lt;br/&gt;
&lt;br/&gt;
b/ It&amp;#39;s actually already the case. I just needed to cast Workspace to WorkspaceImpl. I corrected the code on my side.&lt;br/&gt;
&lt;br/&gt;
c/ Maybe we should add an external tool session instead of sharing a session with JR &amp;quot;internals&amp;quot;. What do you think?&lt;br/&gt;
&lt;br/&gt;
d/ This is what I did first, but I use it in BackupConfigurationParser and it is already used in RepositoryConfigurationParser. It is why it&amp;#39;s there. (for now I don&amp;#39;t use the PM but this might change). I suggest to leave a TODO on this point and see if it&amp;#39;s still needed there at the end of the project. Do you agree?&lt;br/&gt;
&lt;br/&gt;
e/ At first I put it in my backup class and then I thought it could be useful to others. It&amp;#39;s why it&amp;#39;s there. As you can see, I can put it in my backup class if needed but this functionnality can be needed also by other application. What do you think?&lt;br/&gt;
&lt;br/&gt;
f/ Done.&lt;br/&gt;
&lt;br/&gt;
g/ The test case is renamed with the right header.&lt;br/&gt;
&lt;br/&gt;
h/ I have checked the tabs issue *also* in my Jackrabbit patch :p</comment>
                    <comment id="12423777" author="jukkaz" created="Thu, 27 Jul 2006 07:32:09 +0100"  >Thanks for the update!&lt;br/&gt;
&lt;br/&gt;
&amp;gt; c/ Maybe we should add an external tool session instead of sharing a session with JR &amp;quot;internals&amp;quot;. What do you think?&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d go for that unless there is something special in the SystemSession class that&amp;#39;s needed for the backup.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; d/ This is what I did first, but I use it in BackupConfigurationParser and it is already used in RepositoryConfigurationParser.&lt;br/&gt;
&amp;gt; It is why it&amp;#39;s there. (for now I don&amp;#39;t use the PM but this might change). I suggest to leave a TODO on this point and see if it&amp;#39;s&lt;br/&gt;
&amp;gt; still needed there at the end of the project. Do you agree?&lt;br/&gt;
&lt;br/&gt;
Not really. Code reuse should be the result of the design, not the other way around. I think it&amp;#39;s better for now if you just duplicate the parsePersistenceManagerConfig() method in BackupConfigurationParser instead of pushing it higher, especially since the method is so small.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; e/ At first I put it in my backup class and then I thought it could be useful to others. It&amp;#39;s why it&amp;#39;s there. As you can see,&lt;br/&gt;
&amp;gt; I can put it in my backup class if needed but this functionnality can be needed also by other application. What do you think?&lt;br/&gt;
&lt;br/&gt;
OK. I think it&amp;#39;s better to keep the functionality in the backup contrib for now and move it to core when we find another use case. It&amp;#39;s another case of code reuse driving the design, which I&amp;#39;m a bit worried about. I don&amp;#39;t think it&amp;#39;s worth it to expand the public interface of the class with a utility method just for a single client that can achieve the same result using the other methods.&lt;br/&gt;
&lt;br/&gt;
Could you still fix these issues (or counter my arguments :-) before I commit your changes?</comment>
                    <comment id="12423945" author="ntoper" created="Thu, 27 Jul 2006 23:08:46 +0100"  >Hi,&lt;br/&gt;
&lt;br/&gt;
The first part of the project is completed!!!&lt;br/&gt;
&lt;br/&gt;
Backup is working just fine :)&lt;br/&gt;
&lt;br/&gt;
I am posting all patches ASAP. I am waiting for your great comments. &lt;br/&gt;
&lt;br/&gt;
Next steps: the restore operation + extensive testing + some clean up (see TODO tagged items in the code)</comment>
                    <comment id="12423947" author="ntoper" created="Thu, 27 Jul 2006 23:12:41 +0100"  >Working backup operation + relevant test case.&lt;br/&gt;
&lt;br/&gt;
No new classes added.&lt;br/&gt;
&lt;br/&gt;
A lot of issues remain: mostly documentation and code cleaning. They are tagged as TODO in the source code.</comment>
                    <comment id="12423950" author="ntoper" created="Thu, 27 Jul 2006 23:17:36 +0100"  >Jackrabbit patch to support backup operations.&lt;br/&gt;
&lt;br/&gt;
- loadRepProps() in RepositoryImpl is now public&lt;br/&gt;
- A new method exportSystemView has been added. The new method has one more parameter: noJcrSystem. It filters out of the export the /jcr:system subtree. Some other classes have been slightly altered to support it. I hope this won&amp;#39;t break anything, but please double check.&lt;br/&gt;
&lt;br/&gt;
It is really a pleasure working with you on this project.</comment>
                    <comment id="12424028" author="jukkaz" created="Fri, 28 Jul 2006 09:44:40 +0100"  >Committed patch-backup-060728.txt in revision 426435 with some modifications:&lt;br/&gt;
&lt;br/&gt;
* Made the paths in BackupTest relative&lt;br/&gt;
&lt;br/&gt;
* Use Repository.getDescriptorKeys() and Repository.getDescriptor(String) to access repository properties instead of using the internal loadRepProps method. Thus, no need to modify RepositoryImpl.&lt;br/&gt;
&lt;br/&gt;
* Use a SysViewSAXEventGenerator subclass that skips /jcr:system in WorkspaceBackup. Thus, no need to modify SessionImpl and the SAXEventGenerators.&lt;br/&gt;
&lt;br/&gt;
* Depend on RepositoryConfigurationParser for the PERSISTENCE_MANAGER_ELEMENT constant in BackupConfigurationParser. It&amp;#39;s a bit ugly, but avoids the need to have the constant in ConfigurationParser. Thus, no need to modify the ConfigurationParsers.&lt;br/&gt;
&lt;br/&gt;
These modifications remove all needs to modify jackrabbit-core, so I won&amp;#39;t be applying patch-jackrabbit-060728.txt. :-)&lt;br/&gt;
&lt;br/&gt;
I ran the backup test and received a nice backup ZIP file. Looking good so far!</comment>
                    <comment id="12425611" author="ntoper" created="Thu, 3 Aug 2006 21:54:22 +0100"  >Jackrabbit patch to core to allow restore. 2 updates:&lt;br/&gt;
&lt;br/&gt;
- Added to NamespaceRegistryImpl this method public boolean isRegistered(String prefix). I need to avoid launching of an exception.&lt;br/&gt;
&lt;br/&gt;
- Added to RepositoryImpl,  public void setRepProps(Properties props) and    public void setRootNodeId(NodeId ni) to restore correctly the repository.</comment>
                    <comment id="12425612" author="ntoper" created="Thu, 3 Aug 2006 21:56:15 +0100"  >Patch to the Backup tool.&lt;br/&gt;
&lt;br/&gt;
Restore operation is starting to work: you can restore all workspaces and repository with NodeType and Namespace. &lt;br/&gt;
&lt;br/&gt;
Next step: restore Node Version Histories. If you have any idea please, tell me :)&lt;br/&gt;
&lt;br/&gt;
A lot of clean up to do and a few issues are still pending (see TODO tags).&lt;br/&gt;
&lt;br/&gt;
Nico</comment>
                    <comment id="12425690" author="jukkaz" created="Fri, 4 Aug 2006 08:36:09 +0100"  >Thanks again, great progress! Some issues until I commit your changes:&lt;br/&gt;
&lt;br/&gt;
1) I think it&amp;#39;s better for now to stick with the standard NamespaceRegistry methods for checking the existence of a namespace, even at the inconvenience of having to catch an exception. It seems like your backup tool ends up being quite general, so it might also be useful for other JCR implementations! Thus, the fewer jackrabbit-specific methods you use, the better.&lt;br/&gt;
&lt;br/&gt;
2) It&amp;#39;s better to use the namespace URI than the prefix when checking for namespace existence. The prefix is just a shorthand for the namespace URI, so it shouldn&amp;#39;t be a problem if the namespace already exists with a different prefix.&lt;br/&gt;
&lt;br/&gt;
3) I think the setRepProps() method should be named setDescriptors() to avoid introducing internal concepts at the public method layer. We might in future decide to manage the repository descriptors as something else as a properties hash, so the setDescriptors() name should better stand the test of time.&lt;br/&gt;
&lt;br/&gt;
4) The setDescriptors() method should ideally have some kind of an access check that only permits the administrator to make those changes. I&amp;#39;m not sure if the access control framework can do that yet, so you can just leave a TODO on it for now.&lt;br/&gt;
&lt;br/&gt;
5) The root node ID issue is a bit tricky. Normally it&amp;#39;s the same (cafebabe-cafe-babe-cafe-babecafebabe) in all repository instances, so there shouldn&amp;#39;t be any need to backup/restore it, but then Jackrabbit uses a file to store the root ID so it&amp;#39;s still kind of configurable. However, I think that changing the root node ID of a repository may cause some unexpected issues, so it&amp;#39;s probably better not to backup/restore it.&lt;br/&gt;
</comment>
                    <comment id="12425692" author="jukkaz" created="Fri, 4 Aug 2006 08:39:33 +0100"  >... one more thing:&lt;br/&gt;
&lt;br/&gt;
6) You should set the RepositoryImpl.repProps properties in setRepProps/setDescriptors in addition to storing the given properties. This way the restored descriptors will become active immediately and will not be overridden when the repository is shut down.</comment>
                    <comment id="12425694" author="mreutegg" created="Fri, 4 Aug 2006 08:59:08 +0100"  >Regarding repository descriptors, I&amp;#39;m not sure if it makes sense to actually try to restore them. Most of those descriptors are tightly coupled with the internals of an implementation and it&amp;#39;s capabilities and are therefore read-only. e.g. whether versioning is supported, etc.</comment>
                    <comment id="12425758" author="jukkaz" created="Fri, 4 Aug 2006 15:28:13 +0100"  >Marcel:&lt;br/&gt;
&amp;gt; Regarding repository descriptors, I&amp;#39;m not sure if it makes sense to actually try to restore them.&lt;br/&gt;
&amp;gt; Most of those descriptors are tightly coupled with the internals of an implementation and it&amp;#39;s&lt;br/&gt;
&amp;gt; capabilities and are therefore read-only. e.g. whether versioning is supported, etc.&lt;br/&gt;
&lt;br/&gt;
That&amp;#39;s true, but the descriptors can also be used to convey custom information, for example the name and contact details of the repository administrator. Jackrabbit doesn&amp;#39;t directly support this at the moment, but I think it would be a nice feature to add at some point. Then backing up and restoring that data would make a lot of sense. In fact the setDescriptors() method even effectively implements this feature, now we just need to come up with some semi-standard descriptor keys.&lt;br/&gt;
&lt;br/&gt;
Of course &amp;quot;restored&amp;quot; descriptor should never override the standard descriptors, but Nicolas&amp;#39; implementation already takes care of this by calling setDefaultRepositoryProperties().&lt;br/&gt;
</comment>
                    <comment id="12425764" author="stefan@jira" created="Fri, 4 Aug 2006 15:55:01 +0100"  >i share marcel&amp;#39;s concerns regarding restoring descriptors,&lt;br/&gt;
therefore -1 for a setDescriptors() method on Repository</comment>
                    <comment id="12426351" author="ntoper" created="Mon, 7 Aug 2006 23:29:29 +0100"  >- A few classes has been cleaned up and are ready for production (Until BackupManager not included)&lt;br/&gt;
&lt;br/&gt;
- There is still the NodeVersionHistories.restore() unfinished. Eventually, I will unprotect the NodeDef and protect them before going out of the methods (the easier for me I feel).&lt;br/&gt;
&lt;br/&gt;
- I have a bug in WorkspaceBackup.restore() but I can&amp;#39;t seem to find it: no content is restored, no error is given. Can you help me on this?</comment>
                    <comment id="12426485" author="jukkaz" created="Tue, 8 Aug 2006 08:23:27 +0100"  >Committed patch-060808-backup.txt in revision 429606. Note that I changed the Java 5 String.contains() call to String.indexOf() to make it work with 1.4.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I have a bug in WorkspaceBackup.restore() but I can&amp;#39;t seem to find it: no content is restored, no error is given. Can you help me on this?&lt;br/&gt;
&lt;br/&gt;
Seems correct based on a quick review. Perhaps some debug logging could help?</comment>
                    <comment id="12426755" author="ntoper" created="Tue, 8 Aug 2006 23:24:11 +0100"  >Hopefully, this is one of the last patches for this project :)&lt;br/&gt;
&lt;br/&gt;
Everything is working but the importXML method in the VersionManager hasn&amp;#39;t been finished yet (so not committed to core) so the node version history restore is not working (and actually raises an exception since it looks for it). If you need the tool already, please deactivate the node version history restore for now.&lt;br/&gt;
&lt;br/&gt;
The code still needs clean up and documentation but the meat of this contrib project is here.&lt;br/&gt;
&lt;br/&gt;
ETA: Monday.&lt;br/&gt;
&lt;br/&gt;
Next steps: finish the importXML method (currently), clean up (trailing spaces mostly), document (readme, wiki page),  test + bug patches and requirements for a version 2.&lt;br/&gt;
&lt;br/&gt;
Some ideas have already been put for a V2 on the wiki page. I plan to start working on it after Google SoC and when we would have gathered enough users feedback. Please feel free to already put your ideas for a v2 and of course, soon, please test the backup/restore.</comment>
                    <comment id="12428445" author="ntoper" created="Wed, 16 Aug 2006 18:35:31 +0100"  >This code contains for now the backup tool with working restore and backup. To currently, it needs a patch on Jackrabbit&amp;#39;s core.&lt;br/&gt;
&lt;br/&gt;
We are currently discussing on the ML those issues to know if I should refactor some parts.&lt;br/&gt;
&lt;br/&gt;
Please have a look at the wiki if you would like to know more about this tool.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/jackrabbit/BackupTool&quot;&gt;http://wiki.apache.org/jackrabbit/BackupTool&lt;/a&gt;</comment>
                    <comment id="12428452" author="ntoper" created="Wed, 16 Aug 2006 18:54:48 +0100"  >This is the proposed path to the core for the backup tool.&lt;br/&gt;
&lt;br/&gt;
Sorry for the 4 patches but some Gremlins have invaded my computer and created a lot of problem with SVN.&lt;br/&gt;
&lt;br/&gt;
Here are the modifications I propose:&lt;br/&gt;
&lt;br/&gt;
- Update to PropInfo. &lt;br/&gt;
Please see relevant thread on ML. &lt;br/&gt;
&lt;br/&gt;
- Update to VersionManagerImpl and to RepositoryImpl. &lt;br/&gt;
In order to restore the NodeVersionHistories, I need to gain access to the VersionManagerImpl persistence (through a getter) manager. For this, I need to put the getVersionManager() of RepositoryImpl in public  (I couldn&amp;#39;t use the one from SessionImpl since there can be a XAVersionManager and the cast to VersionManagerImpl doesn&amp;#39;t work in this case)&lt;br/&gt;
&lt;br/&gt;
- Add a NodeVersionHistoriesUpdatableStateManager&lt;br/&gt;
It is a specific UpdatableStateManager designed specifically to update the NodeVersionHistories. It is heavily based on the LocalItemStateManager.&lt;br/&gt;
&lt;br/&gt;
I have to be able to connect the imported NodeState so I had to put this class in the o.a.j.core.state package and couldn&amp;#39;t put it in the backup one. (connect is protected to state and it is *really* a bad idea to put in public).&lt;br/&gt;
&lt;br/&gt;
The idea was to be able to work with a BatchedItemOperation class so to keep as much as possible its original semantic.&lt;br/&gt;
&lt;br/&gt;
I am sure there is a better way to handle those needs instead of updating the core but I didn&amp;#39;t find any yet. &lt;br/&gt;
&lt;br/&gt;
As soon, as we all agree, I will update the relevant part of my code (in backup and in this patch) and document them properly.&lt;br/&gt;
&lt;br/&gt;
Cheers,&lt;br/&gt;
Nico&lt;br/&gt;
PS I am cleaning up my SVN so next time, I can post one patch for all.</comment>
                    <comment id="12429039" author="ntoper" created="Fri, 18 Aug 2006 15:57:56 +0100"  >The good archive.</comment>
                    <comment id="12432178" author="ntoper" created="Fri, 1 Sep 2006 17:07:29 +0100"  >Since we cannot update this issue, maybe we should close it?</comment>
                    <comment id="12442194" author="ntoper" created="Sat, 14 Oct 2006 03:45:54 +0100"  >&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;[[ Old comment, sent by email on Fri, 4 Aug 2006 17:48:34 +0200 ]]&lt;br/&gt;
&lt;br/&gt;
It seems two people out of one, want to not backup the descriptors. Is it&lt;br/&gt;
the same for the root node?&lt;br/&gt;
&lt;br/&gt;
If so, I&amp;#39;ll update the code not to backup those data.&lt;br/&gt;
&lt;br/&gt;
Nico&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
-- &lt;br/&gt;
a+&lt;br/&gt;
Nico&lt;br/&gt;
my blog! &lt;a href=&quot;http://www.deviant-abstraction.net&quot;&gt;http://www.deviant-abstraction.net&lt;/a&gt; !!&lt;br/&gt;
</comment>
                    <comment id="12710691" author="jukkaz" created="Tue, 19 May 2009 11:32:59 +0100"  >I&amp;#39;m taking over this issue to implement the repository backup and migration tool we need to have in Jackrabbit 1.6 so we can better handle upgrades to the upcoming Jackrabbit 2.0 release.</comment>
                    <comment id="12739034" author="jukkaz" created="Tue, 4 Aug 2009 18:03:39 +0100"  >The RepositoryCopier tool in jackrabbit-core and the backup options in jackrabbit-standalone now provide a simple mechanism for backing up or migrating repositories. Resolving as fixed for 1.6.0!</comment>
                </comments>
                    <attachments>
                    <attachment id="12339101" name="backup-final2.tar.gz" size="20291" author="ntoper" created="Fri, 18 Aug 2006 15:57:56 +0100" />
                    <attachment id="12338977" name="backupTool-final1.tar.gz" size="16447" author="ntoper" created="Wed, 16 Aug 2006 18:35:31 +0100" />
                    <attachment id="12336893" name="jackrabbit-1.patch.txt" size="40803" author="ntoper" created="Fri, 14 Jul 2006 16:46:04 +0100" />
                    <attachment id="12335916" name="patch" size="10100" author="ntoper" created="Mon, 26 Jun 2006 20:17:39 +0100" />
                    <attachment id="12338324" name="patch-060808-backup.txt" size="107983" author="ntoper" created="Mon, 7 Aug 2006 23:29:29 +0100" />
                    <attachment id="12336949" name="patch-backup-060716.txt" size="29446" author="ntoper" created="Sun, 16 Jul 2006 00:30:04 +0100" />
                    <attachment id="12337189" name="patch-backup-060719.txt" size="32234" author="ntoper" created="Wed, 19 Jul 2006 19:01:29 +0100" />
                    <attachment id="12337507" name="patch-backup-060725.txt" size="66625" author="ntoper" created="Tue, 25 Jul 2006 22:33:01 +0100" />
                    <attachment id="12337572" name="patch-backup-060726.txt" size="68591" author="ntoper" created="Wed, 26 Jul 2006 16:33:23 +0100" />
                    <attachment id="12337666" name="patch-backup-060728.txt" size="77093" author="ntoper" created="Thu, 27 Jul 2006 23:12:41 +0100" />
                    <attachment id="12338098" name="patch-backup-060803.txt" size="87288" author="ntoper" created="Thu, 3 Aug 2006 21:56:15 +0100" />
                    <attachment id="12338428" name="patch-backup-090806.txt" size="14849" author="ntoper" created="Tue, 8 Aug 2006 23:24:11 +0100" />
                    <attachment id="12336950" name="patch-jackrabbit-060716.txt" size="25446" author="ntoper" created="Sun, 16 Jul 2006 01:06:28 +0100" />
                    <attachment id="12337118" name="patch-jackrabbit-060718.txt" size="39798" author="ntoper" created="Tue, 18 Jul 2006 20:31:11 +0100" />
                    <attachment id="12337506" name="patch-jackrabbit-060725.txt" size="8335" author="ntoper" created="Tue, 25 Jul 2006 22:30:45 +0100" />
                    <attachment id="12337573" name="patch-jackrabbit-060726.txt" size="6388" author="ntoper" created="Wed, 26 Jul 2006 16:34:12 +0100" />
                    <attachment id="12337667" name="patch-jackrabbit-060728.txt" size="10829" author="ntoper" created="Thu, 27 Jul 2006 23:17:36 +0100" />
                    <attachment id="12338097" name="patch-jr-060803.txt" size="2449" author="ntoper" created="Thu, 3 Aug 2006 21:54:22 +0100" />
                    <attachment id="12338979" name="patch-jr-final1.tar.gz" size="4723" author="ntoper" created="Wed, 16 Aug 2006 18:54:48 +0100" />
                    <attachment id="12336687" name="patch.txt" size="20007" author="ntoper" created="Wed, 12 Jul 2006 05:19:44 +0100" />
                    <attachment id="12336377" name="patch.txt" size="14870" author="ntoper" created="Thu, 6 Jul 2006 00:06:54 +0100" />
                    <attachment id="12336251" name="patch.txt" size="12981" author="ntoper" created="Mon, 3 Jul 2006 05:19:35 +0100" />
                    <attachment id="12336239" name="patch.txt" size="12981" author="ntoper" created="Sun, 2 Jul 2006 06:24:37 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>23.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 26 Jun 2006 19:17:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142175</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191104</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>