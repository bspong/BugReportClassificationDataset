<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:52:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1096/JCR-1096.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1096] Problems with custom nodes in journal</title>
                <link>https://issues.apache.org/jira/browse/JCR-1096</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I have an application that uses custom node types and I am having problems in a clustered configuration.&lt;br/&gt;
&lt;br/&gt;
Issue 1: the following definition in a nodetype is incorrectly read from the journal:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ * (nt:hierarchyNode) version&lt;br/&gt;
&lt;br/&gt;
The * is stored in the journal as _x002a_ since it should be a QName and it gets escaped.&lt;br/&gt;
When read, the code ...core.nodetype.compact.CompactNodeTypeDefReader.doChildNodeDefinition does the following test:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (currentTokenEquals(&amp;#39;*&amp;#39;)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ndi.setName(ItemDef.ANY_NAME); &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ndi.setName(toQName(currentToken));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Since currentToken is _x002a_ and not * toQName(currentToken) is called but it fails.&lt;br/&gt;
I changed the test to:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (currentTokenEquals(&amp;#39;*&amp;#39;) || currentTokenEquals(&amp;quot;_x002a_&amp;quot;))&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;....&lt;br/&gt;
and that fixes the problem.&lt;br/&gt;
&lt;br/&gt;
Issue 2: when storing a nodeType in the journal the superclass nt:base is not store, but when reading I get an error saying the node should be a subclass of nt:base.&lt;br/&gt;
&lt;br/&gt;
The code in...core.nodetype.compact.CompactNodeTypeDefWriter.writeSupertypes skips nt:base when writing the node.&lt;br/&gt;
&lt;br/&gt;
When reading the nodetype definition from the journal the following exception is thrown:&lt;br/&gt;
&lt;br/&gt;
Unable to deliver node type operation: [{&lt;a href=&quot;http://namespace/app/repository/1.0&quot;&gt;http://namespace/app/repository/1.0&lt;/a&gt;}resource] all primary node types except nt:base itself must be (directly or indirectly) derived from nt:base&lt;br/&gt;
&lt;br/&gt;
probably because nt:base is not re-added to the nodetype definition&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;</description>
                <environment></environment>
            <key id="12377045">JCR-1096</key>
            <summary>Problems with custom nodes in journal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="dpfister">Dominique Pfister</assignee>
                                <reporter username="raff">Raffaele Sena</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Aug 2007 02:09:57 +0100</created>
                <updated>Mon, 8 Oct 2007 11:47:26 +0100</updated>
                    <resolved>Fri, 31 Aug 2007 08:52:52 +0100</resolved>
                            <version>1.2.1</version>
                <version>1.2.2</version>
                <version>1.2.3</version>
                <version>1.3</version>
                <version>1.3.1</version>
                                <fixVersion>1.3.3</fixVersion>
                                <component>clustering</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12523670" author="raff" created="Wed, 29 Aug 2007 21:45:52 +0100"  >I commented out the test for nt:base in writeSupertypes and now starting a new machine in the cluster from the journal works fine.&lt;br/&gt;
&lt;br/&gt;
Since CompactNodeTypeDefWriter is only used in the journal this shouldn&amp;#39;t generate any regression.</comment>
                    <comment id="12524027" author="dpfister" created="Fri, 31 Aug 2007 08:52:52 +0100"  >Fixed as suggested, thanks for reporting and the good analysis!&lt;br/&gt;
&lt;br/&gt;
Just one small change: instead of checking for the special name &amp;#39;*&amp;#39; and its encoded value _x002a_ when reading back the node type definition, I left &amp;#39;*&amp;#39; unencoded when writing.&lt;br/&gt;
&lt;br/&gt;
Fixed in revision 571394.</comment>
                    <comment id="12529203" author="jukkaz" created="Thu, 20 Sep 2007 19:48:22 +0100"  >Merged to the 1.3 branch in revision 577868.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 31 Aug 2007 07:52:52 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>41878</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>252740</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>