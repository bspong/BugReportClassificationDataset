<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:31:36 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1952/JCR-1952.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1952] DOMException: NAMESPACE_ERR thrown when exporting document view</title>
                <link>https://issues.apache.org/jira/browse/JCR-1952</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When I try to export some nodes with ExportDocumentView I get a DOMException with Jackrabbit 1.5.2. Version 1.4.6 works fine. Xerces version was 2.8.1.&lt;br/&gt;
&lt;br/&gt;
Code:&lt;br/&gt;
&lt;br/&gt;
Document document = documentBuilder.newDocument();&lt;br/&gt;
Element exportElement = (Element) document.appendChild(document.createElement(&amp;quot;Export&amp;quot;));&lt;br/&gt;
Result result = new DOMResult(exportElement);&lt;br/&gt;
TransformerHandler transformerHandler = saxTransformerFactory.newTransformerHandler();&lt;br/&gt;
transformerHandler.setResult(result);&lt;br/&gt;
session.exportDocumentView(workflowNode.getPath(), transformerHandler, true, false);&lt;br/&gt;
&lt;br/&gt;
Exception:&lt;br/&gt;
&lt;br/&gt;
org.w3c.dom.DOMException: NAMESPACE_ERR: An attempt is made to create or change an object in a way which is incorrect with regard to namespaces.&lt;br/&gt;
	at org.apache.xerces.dom.CoreDocumentImpl.checkDOMNSErr(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.dom.AttrNSImpl.setName(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.dom.AttrNSImpl.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.dom.CoreDocumentImpl.createAttributeNS(Unknown Source)&lt;br/&gt;
	at org.apache.xerces.dom.ElementImpl.setAttributeNS(Unknown Source)&lt;br/&gt;
	at com.sun.org.apache.xalan.internal.xsltc.trax.SAX2DOM.startElement(SAX2DOM.java:194)&lt;br/&gt;
	at com.sun.org.apache.xml.internal.serializer.ToXMLSAXHandler.closeStartTag(ToXMLSAXHandler.java:204)&lt;br/&gt;
	at com.sun.org.apache.xml.internal.serializer.ToSAXHandler.flushPending(ToSAXHandler.java:277)&lt;br/&gt;
	at com.sun.org.apache.xml.internal.serializer.ToXMLSAXHandler.startElement(ToXMLSAXHandler.java:646)&lt;br/&gt;
	at com.sun.org.apache.xalan.internal.xsltc.trax.TransformerHandlerImpl.startElement(TransformerHandlerImpl.java:263)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.Exporter.startElement(Exporter.java:438)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.DocumentViewExporter.exportNode(DocumentViewExporter.java:76)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.Exporter.exportNode(Exporter.java:298)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.Exporter.exportNodes(Exporter.java:214)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.DocumentViewExporter.exportNode(DocumentViewExporter.java:77)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.Exporter.exportNode(Exporter.java:295)&lt;br/&gt;
	at org.apache.jackrabbit.commons.xml.Exporter.export(Exporter.java:144)&lt;br/&gt;
	at org.apache.jackrabbit.commons.AbstractSession.export(AbstractSession.java:461)&lt;br/&gt;
	at org.apache.jackrabbit.commons.AbstractSession.exportDocumentView(AbstractSession.java:241)</description>
                <environment></environment>
            <key id="12413210">JCR-1952</key>
            <summary>DOMException: NAMESPACE_ERR thrown when exporting document view</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="lptr">L&#243;r&#225;nt Pint&#233;r</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jan 2009 21:41:05 +0000</created>
                <updated>Mon, 2 Mar 2009 12:00:00 +0000</updated>
                    <resolved>Sun, 22 Feb 2009 00:33:38 +0000</resolved>
                            <version>1.5.2</version>
                                <fixVersion>1.5.3</fixVersion>
                                <component>jackrabbit-jcr-commons</component>
                <component>xml</component>
                        <due></due>
                    <votes>3</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12667141" author="lptr" created="Sun, 25 Jan 2009 21:44:02 +0000"  >The issue is also present in Jackrabbit 1.5.0.</comment>
                    <comment id="12673014" author="gjoseph" created="Thu, 12 Feb 2009 17:40:27 +0000"  >We encounter a similar issue when using JR 1.5 with JBoss - namespaces are declared twice in the first node.</comment>
                    <comment id="12673042" author="gjoseph" created="Thu, 12 Feb 2009 20:20:10 +0000"  >JBoss 4.2.2 and 5.0.0 have a {{xalan.jar}} in their {{lib/endorsed}} folder. Removing it solved the problem for me.</comment>
                    <comment id="12673213" author="jukkaz" created="Fri, 13 Feb 2009 11:10:08 +0000"  >Can you find out what version of Xalan the xalan.jar library you had was?</comment>
                    <comment id="12673241" author="gjoseph" created="Fri, 13 Feb 2009 12:44:38 +0000"  >Here&amp;#39;s the manifest file. So that looks like 2.7.0. This is the one shipped with jboss 4.2.2, and the one with jboss 5.0.0 only differs by the jboss-specific entries in this.</comment>
                    <comment id="12673534" author="fgiust" created="Sat, 14 Feb 2009 16:53:22 +0000"  >I saw the same problem with duplicate namespaces when running an application under WAS 6.1 (jackrabbit 1.5.0-1.5.2).&lt;br/&gt;
The webapp was bundling xalan 2.1.0 and xerces 2.8.1. Removing xalan causes the webapp to break in this case, so I can&amp;#39;t confirm if the removal can fix the export problem. With jackrabbit 1.4.6 everything works fine.&lt;br/&gt;
</comment>
                    <comment id="12673583" author="jukkaz" created="Sun, 15 Feb 2009 09:55:27 +0000"  >This is a pretty tricky issue.&lt;br/&gt;
&lt;br/&gt;
The reason why Jackrabbit adds those extra xmlns attributes is that at least the default XML serializer in Sun Java 1.4 does not include xmlns settings in the serialized XML stream without those attributes (even if the correct startPrefixMapping() calls are made and the namespaces used in the exported elements). Unfortunately it seems like some serializers will add their own xmns attributes regardless of whether they already exist for an element, causing duplicate namespace declarations to occur.&lt;br/&gt;
&lt;br/&gt;
We could (and should) use the new SerializingContentHandler class also for the XML export methods (curiously that seems to be the only XML serialization case where we *don&amp;#39;t* yet use the new class) to automatically add the extra xmlns attributes only when they really are needed. This would solve the problem of duplicate xmlns attributes.&lt;br/&gt;
&lt;br/&gt;
However, many XML serializers that do output the needed xmlns attributes, only do so for namespaces that are actually referenced in the serialized elements. This is troublesome for JCR, where XML exports are always required to contain *all* registered namespaces even when the exported subtree doesn&amp;#39;t reference them. I consider this a flaw in the JCR spec, but we still need to honor this requirement and make sure that all the xmlns attributes are included in the serialized output.&lt;br/&gt;
&lt;br/&gt;
I guess we need to extend the SerializingContentHnalder even more to detect the case when it needs to inject xmlns attributes only for unused namespaces.</comment>
                    <comment id="12673587" author="reschke" created="Sun, 15 Feb 2009 10:21:19 +0000"  >Just one thought: we should be careful with adding these workarounds; they make things even harder to analyze, and they may negatively affect performance when the checks are run for each and every serialization&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12673591" author="jukkaz" created="Sun, 15 Feb 2009 10:29:25 +0000"  >Yeah, as an alternative I&amp;#39;m considering just implementing the XML serialization directly without having to deal with the complexities of the JAXP libraries. We could copy the serialization code from Xerces or Xalan to get existing and tested code for this while avoiding the full dependency.</comment>
                    <comment id="12673676" author="fgiust" created="Sun, 15 Feb 2009 15:57:42 +0000"  >Just a question: what has been changed in the xml serialization code after 1.4.x and why? The change was related to the problem with the java 1.4 serializer you cited above (if so, is there a jira for that)?&lt;br/&gt;
Export in 1.4 seems to work fine in these situations, maybe rollbacking to the old code can be an option...&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12673741" author="reschke" created="Sun, 15 Feb 2009 20:01:47 +0000"  >I think this was while resolving &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1767&quot; title=&quot;XML serialization in JDK 1.4 broken (mostly for WebDAV)&quot;&gt;&lt;strike&gt;JCR-1767&lt;/strike&gt;&lt;/a&gt; (an issue that only surfaced when a DOM was serialized).</comment>
                    <comment id="12674922" author="mably" created="Thu, 19 Feb 2009 08:24:11 +0000"  >What is the workaround for this annoying bug as we rely a lot in our application on content import/export ?  Thanx for your help.</comment>
                    <comment id="12674950" author="jukkaz" created="Thu, 19 Feb 2009 10:10:07 +0000"  >The workaround is to look for and remove the Xalan jar from the repository classpath. The export works fine with the built-in JAXP libraries in all JDKs we&amp;#39;ve tested, but it looks like other TransformerFactory implementations (like the one in the Xalan versions reported here) break the export.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m still not sure how to best resolve this. I&amp;#39;m inclined to either revert back to the 1.4 code (with the potential of introducing other regressions) or going with a custom XML serializer that doesn&amp;#39;t depend on any JAXP libraries (which would be a notable new block of potentially buggy code).</comment>
                    <comment id="12674989" author="mably" created="Thu, 19 Feb 2009 12:55:05 +0000"  >Thanx a lot, that did it for me.  I also had to delete some xml-apis.jar and xmlParsers.jar from the classpath.</comment>
                    <comment id="12675608" author="jukkaz" created="Sun, 22 Feb 2009 00:33:38 +0000"  >I resolved this by replacing the JAXP serialization code with a custom XML serializer over whose behaviour we have full control. The custom serializer and related classes were added in revision 746602 and in revision 746603 I modified the JCR XML exports to use this new serializer.&lt;br/&gt;
&lt;br/&gt;
Note that to keep things simple the new serializer is designed to only work with a fairly constrained stream of SAX events. This is OK for the XML exports we generate, but not necessarily for things like the DOM to SAX conversions used by the webdav component. Thus I&amp;#39;ve only modified the JCR XML exports to use the new serializer and kept other XML serializations based on the existing SerializingContentHandler class. &lt;br/&gt;
&lt;br/&gt;
Merged to the 1.5 branch in revision 746604.</comment>
                    <comment id="12675676" author="jukkaz" created="Sun, 22 Feb 2009 17:14:46 +0000"  >To summarize the effect of the selected fix:&lt;br/&gt;
&lt;br/&gt;
* The SAX event stream sent to a given ContentHandler instance remains the same as before. Most notably the events will consist of both startPrefixMapping calls for all namespaces *and* explicit xmlns attributes for those same namespaces. This behaviour is expected by the current TCK and is similar to what you&amp;#39;d get from a SAXParser with the &lt;a href=&quot;http://xml.org/sax/features/namespace-prefixes&quot;&gt;http://xml.org/sax/features/namespace-prefixes&lt;/a&gt; feature enabled.&lt;br/&gt;
&lt;br/&gt;
* The above means that code that uses a ContentHandler instead of an OutputStream to capture the XML export will need to be aware of this.&lt;br/&gt;
&lt;br/&gt;
* On the other hand, the OutputStream exports are now guaranteed *not* to produce duplicate xmlns attributes regardless of what JAXP libraries are in the classpath.</comment>
                    <comment id="12676319" author="gjoseph" created="Tue, 24 Feb 2009 16:00:57 +0000"  >Thanks, as far as I can tell, this fixed our issues ! :)</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12415236">JCR-1992</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12400181" name="MANIFEST.MF" size="1417" author="gjoseph" created="Fri, 13 Feb 2009 12:44:38 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 12 Feb 2009 17:40:27 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78375</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190270</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>