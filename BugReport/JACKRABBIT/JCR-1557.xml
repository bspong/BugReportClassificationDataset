<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:44:56 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1557/JCR-1557.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1557] Avoid exceptions during shutting repository down if several PMs/FSs use same DB</title>
                <link>https://issues.apache.org/jira/browse/JCR-1557</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>According to docs and forum discussions, it&amp;#39;s legal to use same DB for different FileSystems/Persistence Managers. Such configurations seem to work fine, but when repository is stopped, exceptions are produced like following:&lt;br/&gt;
&lt;br/&gt;
SEVERE: Error while closing Version Manager.&lt;br/&gt;
java.sql.SQLNonTransientConnectionException: No current connection.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.noCurrentConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.getMetaData(Unknown Source)&lt;br/&gt;
	at org.apache.jackrabbit.core.persistence.db.DerbyPersistenceManager.closeConnection(DerbyPersistenceManager.java:109)&lt;br/&gt;
	at org.apache.jackrabbit.core.persistence.db.DatabasePersistenceManager.close(DatabasePersistenceManager.java:261)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.VersionManagerImpl.close(VersionManagerImpl.java:201)&lt;br/&gt;
	at org.apache.jackrabbit.core.RepositoryImpl.doShutdown(RepositoryImpl.java:1000)&lt;br/&gt;
	at org.apache.jackrabbit.core.RepositoryImpl.shutdown(RepositoryImpl.java:948)&lt;br/&gt;
	at org.apache.jackrabbit.core.TransientRepository.stopRepository(TransientRepository.java:275)&lt;br/&gt;
	at org.apache.jackrabbit.core.TransientRepository.loggedOut(TransientRepository.java:427)&lt;br/&gt;
	at org.apache.jackrabbit.core.SessionImpl.notifyLoggedOut(SessionImpl.java:574)&lt;br/&gt;
	at org.apache.jackrabbit.core.SessionImpl.logout(SessionImpl.java:1247)&lt;br/&gt;
	at org.apache.jackrabbit.core.XASessionImpl.logout(XASessionImpl.java:403)&lt;br/&gt;
	at com.blandware.tooling.jcrplugin.ExportMojo.execute(ExportMojo.java:81)&lt;br/&gt;
	at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPluginManager.java:447)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(DefaultLifecycleExecutor.java:539)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeStandaloneGoal(DefaultLifecycleExecutor.java:493)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(DefaultLifecycleExecutor.java:463)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHandleFailures(DefaultLifecycleExecutor.java:311)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegments(DefaultLifecycleExecutor.java:278)&lt;br/&gt;
	at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLifecycleExecutor.java:143)&lt;br/&gt;
	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:333)&lt;br/&gt;
	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:126)&lt;br/&gt;
	at org.apache.maven.cli.MavenCli.main(MavenCli.java:282)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)&lt;br/&gt;
	at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)&lt;br/&gt;
	at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)&lt;br/&gt;
	at org.codehaus.classworlds.Launcher.main(Launcher.java:375)&lt;br/&gt;
Caused by: java.sql.SQLException: No current connection.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
	... 35 more&lt;br/&gt;
</description>
                <environment>Apache Derby / 10.3.2.1 - (599110)</environment>
            <key id="12394910">JCR-1557</key>
            <summary>Avoid exceptions during shutting repository down if several PMs/FSs use same DB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rpuch">Roman Puchkovskiy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Apr 2008 14:29:28 +0100</created>
                <updated>Thu, 7 Aug 2008 15:06:54 +0100</updated>
                    <resolved>Thu, 12 Jun 2008 20:30:41 +0100</resolved>
                            <version>core 1.4.2</version>
                                <fixVersion>core 1.4.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12592805" author="rpuch" created="Mon, 28 Apr 2008 14:30:50 +0100"  >Attaching example configuration which uses same DB (but different schema prefixes) for all FS/PM instances.</comment>
                    <comment id="12597976" author="stefan@jira" created="Mon, 19 May 2008 16:16:44 +0100"  >changed priority to &amp;#39;Minor&amp;#39; since exceptions are just logged and control flow is not affected.</comment>
                    <comment id="12598590" author="stefan@jira" created="Wed, 21 May 2008 09:46:59 +0100"  >fixed in r658583.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12601061" author="jukkaz" created="Fri, 30 May 2008 10:56:58 +0100"  >Merged to the 1.4 branch in revision 661622.</comment>
                    <comment id="12602597" author="rpuch" created="Thu, 5 Jun 2008 10:41:11 +0100"  >Sorry for late review.&lt;br/&gt;
Problem with exceptions is solved, but Jackrabbit still tries to reconnect when shutting down if using attached configuration. This slows down repository shutdown.&lt;br/&gt;
&lt;br/&gt;
Corresponding messages in the log are:&lt;br/&gt;
2008-06-05 13:37:53 &amp;lt;WARN &amp;gt; [main] DbFileSystem: execute failed, about to reconnect...</comment>
                    <comment id="12604621" author="jukkaz" created="Thu, 12 Jun 2008 20:30:41 +0100"  >See &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1648&quot; title=&quot;Database reconnect during shutdown&quot;&gt;JCR-1648&lt;/a&gt; for the above followup issue.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m re-resolving this issue as the original fix was already included in jackrabbit-core 1.4.5.</comment>
                    <comment id="12620339" author="aperepel" created="Wed, 6 Aug 2008 18:41:42 +0100"  >The issue isn&amp;#39;t really fixed in 1.4.5. It works for DB PMs, but didn&amp;#39;t change a thing for *bundle* PMs, e.g. for org.apache.jackrabbit.core.persistence.bundle.DerbyPersistenceManager the stacktrace is the same:&lt;br/&gt;
&lt;br/&gt;
[08-06 13:38:58] WARN  DbFileSystem [Shutdown]: execute failed, about to reconnect...&lt;br/&gt;
[08-06 13:39:08] ERROR RepositoryImpl [Shutdown]: Error while closing Version Manager.&lt;br/&gt;
java.sql.SQLException: No current connection.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.noCurrentConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.getMetaData(Unknown Source)&lt;br/&gt;
	at org.apache.jackrabbit.core.persistence.bundle.DerbyPersistenceManager.close(DerbyPersistenceManager.java:312)&lt;br/&gt;
	at org.apache.jackrabbit.core.version.VersionManagerImpl.close(VersionManagerImpl.java:196)&lt;br/&gt;
	at org.apache.jackrabbit.core.RepositoryImpl.doShutdown(RepositoryImpl.java:1000)&lt;br/&gt;
	at org.apache.jackrabbit.core.RepositoryImpl.shutdown(RepositoryImpl.java:948)&lt;br/&gt;
	at org.springmodules.jcr.jackrabbit.RepositoryFactoryBean.destroy(RepositoryFactoryBean.java:91)&lt;br/&gt;
	at org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:154)&lt;br/&gt;
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:397)&lt;br/&gt;
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:375)&lt;br/&gt;
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:348)&lt;br/&gt;
	at org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:861)&lt;br/&gt;
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:839)&lt;br/&gt;
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:802)&lt;br/&gt;
	at org.springframework.web.context.ContextLoader.closeWebApplicationContext(ContextLoader.java:367)&lt;br/&gt;
	at org.springframework.web.context.ContextLoaderListener.contextDestroyed(ContextLoaderListener.java:70)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.doStop(ContextHandler.java:573)&lt;br/&gt;
	at org.mortbay.jetty.webapp.WebAppContext.doStop(WebAppContext.java:484)&lt;br/&gt;
	at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:65)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.doStop(HandlerWrapper.java:129)&lt;br/&gt;
	at org.mortbay.jetty.Server.doStop(Server.java:281)&lt;br/&gt;
	at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:65)&lt;br/&gt;
	at org.mortbay.jetty.Server$ShutdownHookThread.run(Server.java:559)&lt;br/&gt;
[08-06 13:39:08] WARN  DbFileSystem [Shutdown]: execute failed, about to reconnect...&lt;br/&gt;
[08-06 13:39:18] INFO  log [Shutdown]: Shutdown hook complete&lt;br/&gt;
&lt;br/&gt;
Process finished with exit code 1&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Looking at org.apache.jackrabbit.core.persistence.bundle.DerbyPersistenceManager, the close() implementation is quite different from its db counterpart, shouldn&amp;#39;t it have the same fixes?</comment>
                    <comment id="12620348" author="aperepel" created="Wed, 6 Aug 2008 18:52:33 +0100"  >Found that &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;revision=658583&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=658583&lt;/a&gt; changed *hasn&amp;#39;t* been applied to the bundle Derby PM, only db.</comment>
                    <comment id="12620560" author="jukkaz" created="Thu, 7 Aug 2008 09:56:26 +0100"  >Andrew, is your issue related to &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1499&quot; title=&quot;Error logged when repository is shut down&quot;&gt;&lt;strike&gt;JCR-1499&lt;/strike&gt;&lt;/a&gt;? Please file a new issue if you&amp;#39;re still seeing the problem with jackrabbit-core-1.4.5.</comment>
                    <comment id="12620628" author="aperepel" created="Thu, 7 Aug 2008 15:06:54 +0100"  >Not really, &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1499&quot; title=&quot;Error logged when repository is shut down&quot;&gt;&lt;strike&gt;JCR-1499&lt;/strike&gt;&lt;/a&gt; was resolved (does not post the error code anymore). The stacktrace posted above is all it has, and this is a result of a half-fixed PM.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12398189">JCR-1648</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12381031" name="repository.xml" size="4616" author="rpuch" created="Mon, 28 Apr 2008 14:30:50 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 19 May 2008 15:16:44 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78509</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>252653</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>