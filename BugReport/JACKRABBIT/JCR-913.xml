<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:39:28 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-913/JCR-913.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-913] DatabaseJournal.checkSchema generates &quot;Cannot call commit when autocommit=true&quot; Exception</title>
                <link>https://issues.apache.org/jira/browse/JCR-913</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When I tried to activate clustering with adding the following XML to repository.xml, &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;Cluster id=&amp;quot;node_1&amp;quot; syncDelay=&amp;quot;5&amp;quot;&amp;gt;&lt;br/&gt;
		&amp;lt;Journal class=&amp;quot;org.apache.jackrabbit.core.journal.DatabaseJournal&amp;quot;&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;revision&amp;quot; value=&amp;quot;${rep.home}/revision&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;driver&amp;quot; value=&amp;quot;com.mysql.jdbc.Driver&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:&lt;a href=&quot;mysql://localhost/jcr&quot;&gt;mysql://localhost/jcr&lt;/a&gt;&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;user&amp;quot; value=&amp;quot;userX&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;password&amp;quot; value=&amp;quot;passWordC&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;schema&amp;quot; value=&amp;quot;mysql&amp;quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;param name=&amp;quot;schemaObjectPrefix&amp;quot; value=&amp;quot;J_C_&amp;quot;/&amp;gt;&lt;br/&gt;
		&amp;lt;/Journal&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/Cluster&amp;gt;&lt;br/&gt;
&lt;br/&gt;
Databse Journal threw the following exception:&lt;br/&gt;
&lt;br/&gt;
....&lt;br/&gt;
Caused by: javax.jcr.RepositoryException: Unable to initialize connection.: Unable to initialize connection.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.createClusterNode(RepositoryImpl.java:677)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.&amp;lt;init&amp;gt;(RepositoryImpl.java:276)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.create(RepositoryImpl.java:584)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.TransientRepository$2.getRepository(TransientRepository.java:245)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.TransientRepository.startRepository(TransientRepository.java:265)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.TransientRepository.login(TransientRepository.java:333)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.liferay.portal.jcr.jackrabbit.JCRFactoryImpl.createSession(JCRFactoryImpl.java:71)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.liferay.portal.jcr.JCRFactoryUtil.createSession(JCRFactoryUtil.java:53)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.liferay.portal.jcr.JCRFactoryUtil.createSession(JCRFactoryUtil.java:57)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.liferay.documentlibrary.util.IndexerImpl.reIndex(IndexerImpl.java:258)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;... 17 more&lt;br/&gt;
Caused by: org.apache.jackrabbit.core.cluster.ClusterException: Unable to initialize connection.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.init(ClusterNode.java:218)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.init(ClusterNode.java:189)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.createClusterNode(RepositoryImpl.java:674)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;... 26 more&lt;br/&gt;
Caused by: java.sql.SQLException: Can&amp;#39;t call commit when autocommit=true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.mysql.jdbc.Connection.commit(Connection.java:2161)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DatabaseJournal.checkSchema(DatabaseJournal.java:437)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DatabaseJournal.init(DatabaseJournal.java:168)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.init(ClusterNode.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;... 28 more&lt;br/&gt;
&lt;br/&gt;
When I examined the source code of the release jackrabbit 1.3, I saw that the init() method for DatabaseJournal class is:&lt;br/&gt;
&lt;br/&gt;
			...&lt;br/&gt;
			Class.forName(driver);&lt;br/&gt;
			con = DriverManager.getConnection(url, user, password);&lt;br/&gt;
			con.setAutoCommit(true);&lt;br/&gt;
&lt;br/&gt;
			checkSchema();&lt;br/&gt;
			prepareStatements();&lt;br/&gt;
			...&lt;br/&gt;
&lt;br/&gt;
and just before checkSchema() method&amp;#39;s finally block:&lt;br/&gt;
&lt;br/&gt;
			...&lt;br/&gt;
			// commit the changes&lt;br/&gt;
			con.commit();&lt;br/&gt;
			...&lt;br/&gt;
&lt;br/&gt;
So, it seemed normal to see the mentioned exception. I just commented out the commit expression and continued my development. Am I missing something?</description>
                <environment>Windows Vista/Tomcat  5.5.17/Liferay/MySql 5.0.24, + mysql connector jar coming with liferay 4.3</environment>
            <key id="12369183">JCR-913</key>
            <summary>DatabaseJournal.checkSchema generates &quot;Cannot call commit when autocommit=true&quot; Exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="tzarsmango">M.Fatih Ozceylan</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 May 2007 08:01:34 +0100</created>
                <updated>Mon, 6 Aug 2007 07:45:57 +0100</updated>
                    <resolved>Thu, 24 May 2007 04:39:47 +0100</resolved>
                            <version>1.3</version>
                                <fixVersion>1.3.1</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12495377" author="ianeboston" created="Sun, 13 May 2007 16:56:41 +0100"  >&lt;br/&gt;
I had the same problem....  but changed &lt;br/&gt;
&lt;br/&gt;
con.setAutoCommit(true); &lt;br/&gt;
&lt;br/&gt;
to&lt;br/&gt;
&lt;br/&gt;
con.setAutoCommit(false);&lt;br/&gt;
&lt;br/&gt;
So that transactions still work.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;I have other problems..... with MySQL, so I could be wrong ?</comment>
                    <comment id="12498468" author="jukkaz" created="Thu, 24 May 2007 04:39:47 +0100"  >Fixed as suggested in revisionn 541145. Thanks for reporting this!&lt;br/&gt;
&lt;br/&gt;
For the record, the problem was the same as we saw earlier with bundle persistence in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-841&quot; title=&quot;BundleDbPersistenceManager does not work with MySQL&quot;&gt;&lt;strike&gt;JCR-841&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12501384" author="jukkaz" created="Mon, 4 Jun 2007 22:54:33 +0100"  >Merged to the 1.3 branch in revision 544292.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 13 May 2007 15:56:41 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78727</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>252775</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>