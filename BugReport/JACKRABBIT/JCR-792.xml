<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:01:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-792/JCR-792.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-792] after enabling access manager, I can&apos;t createNode and setProperty without a node.save in the middle</title>
                <link>https://issues.apache.org/jira/browse/JCR-792</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I added my own access manager. after that I can&amp;#39;t get the following code working &lt;br/&gt;
&lt;br/&gt;
Node n = createNewNode(parentNode);&lt;br/&gt;
n.setProperty();&lt;br/&gt;
parentNode.save();&lt;br/&gt;
&lt;br/&gt;
It seems that setProperty will invoke access control check, but since the new node is not in the repository yet, my access manager implementation won&amp;#39;t be able to grant permission. I also tried to use hierachyManager to get the path of the new node, it also returned null. &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12364956">JCR-792</key>
            <summary>after enabling access manager, I can&apos;t createNode and setProperty without a node.save in the middle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="stefan@jira">Stefan Guggisberg</assignee>
                                <reporter username="xilu1999">Xiaohua Lu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Mar 2007 20:34:05 +0000</created>
                <updated>Wed, 25 Apr 2007 09:45:32 +0100</updated>
                    <resolved>Mon, 19 Mar 2007 16:40:26 +0000</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                <version>1.0.1</version>
                <version>1.1</version>
                <version>1.1.1</version>
                <version>1.2.1</version>
                <version>1.2.2</version>
                <version>1.2.3</version>
                                <fixVersion>1.3</fixVersion>
                                <component>security</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12481245" author="stefan@jira" created="Thu, 15 Mar 2007 17:38:39 +0000"  >i am unfortunately unable to reproduce the issue you&amp;#39;re describing.&lt;br/&gt;
&lt;br/&gt;
here&amp;#39;s what i did trying to reproduce it:&lt;br/&gt;
&lt;br/&gt;
i added the following lines at the beginning of the&lt;br/&gt;
SimpleAccessManager#isGranted(ItemId, int) method:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String path = PathFormat.format(hierMgr.getPath(id), nsResolver);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(&amp;quot;checking permission on &amp;quot; + path);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (RepositoryException re) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;re.printStackTrace(System.out);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (NameException ne) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// erm&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
when i run the following code:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Node foo = root.addNode(&amp;quot;foo&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;foo.setProperty(&amp;quot;bar&amp;quot;, &amp;quot;blah blah&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;root.save();&lt;br/&gt;
&lt;br/&gt;
i get the following console output:&lt;br/&gt;
&lt;br/&gt;
checking permission on /&lt;br/&gt;
checking permission on /foo/bar&lt;br/&gt;
checking permission on /foo/jcr:primaryType&lt;br/&gt;
&lt;br/&gt;
so everything seems to be working as expected. note that i&lt;br/&gt;
used the hierarchy manager passed in the AMContext object&lt;br/&gt;
on init() for resolving the paths. &lt;br/&gt;
&lt;br/&gt;
feel free to reopen this issue if you don&amp;#39;t agree. however, &lt;br/&gt;
you should provide detailed instructions how to reproduce&lt;br/&gt;
it, ideally by providing  a simple test case.</comment>
                    <comment id="12481672" author="xilu1999" created="Fri, 16 Mar 2007 16:22:09 +0000"  >Hi Stefan, &lt;br/&gt;
&lt;br/&gt;
I have composed a test case and hopefully it will be helpful. But conceptually, if one session has node and property set, before commit, the other session should not see it, or am I wrong? (my implemenation of access manager is using another session compared to the test code)&lt;br/&gt;
&lt;br/&gt;
step to reproduce :&lt;br/&gt;
1. copy the file to a directory &lt;br/&gt;
2. copy required jar files to lib directory &lt;br/&gt;
3. compile the code and run  JackrabbitTest &lt;br/&gt;
&lt;br/&gt;
Let me know how it goes.&lt;br/&gt;
&lt;br/&gt;
Thanks.&lt;br/&gt;
&lt;br/&gt;
Xiaohua &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12481757" author="xilu1999" created="Fri, 16 Mar 2007 20:33:52 +0000"  >please try the provided test code. </comment>
                    <comment id="12482075" author="stefan@jira" created="Mon, 19 Mar 2007 13:05:28 +0000"  >i ran your test code (against svn trunk). here&amp;#39;s the console output:&lt;br/&gt;
&lt;br/&gt;
freshDB true&lt;br/&gt;
checking permission on /&lt;br/&gt;
checking permission on /&lt;br/&gt;
checking permission on /newNode/jcr:primaryType&lt;br/&gt;
checking permission on /newNode/ext:name&lt;br/&gt;
checking permission on /newNode/jcr:uuid&lt;br/&gt;
&lt;br/&gt;
so everything seems to be working as expected....&lt;br/&gt;
&lt;br/&gt;
please note that the access manager will be invoked &lt;br/&gt;
*before* the changes are actually committed,&lt;br/&gt;
i.e. new nodes and properties are not yet visible&lt;br/&gt;
to other sessions.</comment>
                    <comment id="12482133" author="stefan@jira" created="Mon, 19 Mar 2007 15:59:18 +0000"  >reopening as i am now able to reproduce the issue</comment>
                    <comment id="12482151" author="stefan@jira" created="Mon, 19 Mar 2007 16:37:56 +0000"  >this issue is resolved as a side-effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-689&quot; title=&quot;Minimize calls to PersistenceManager&quot;&gt;&lt;strike&gt;JCR-689&lt;/strike&gt;&lt;/a&gt; (svn r518986).&lt;br/&gt;
&lt;br/&gt;
prior to r518986 the access manager was invoked to check permission&lt;br/&gt;
on non-existing items which lead to ItemNotFoundException when trying&lt;br/&gt;
to resolving the path of the specified item id.</comment>
                    <comment id="12482152" author="stefan@jira" created="Mon, 19 Mar 2007 16:40:26 +0000"  >the issue has been fixed as a side-effect of fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-689&quot; title=&quot;Minimize calls to PersistenceManager&quot;&gt;&lt;strike&gt;JCR-689&lt;/strike&gt;&lt;/a&gt;.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12359212">JCR-689</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12353517" name="ASF.LICENSE.NOT.GRANTED--jaas.config" size="70" author="xilu1999" created="Fri, 16 Mar 2007 16:22:10 +0000" />
                    <attachment id="12353515" name="ASF.LICENSE.NOT.GRANTED--JackrabbitTest.java" size="5300" author="xilu1999" created="Fri, 16 Mar 2007 16:22:10 +0000" />
                    <attachment id="12353516" name="ASF.LICENSE.NOT.GRANTED--ntExts.txt" size="445" author="xilu1999" created="Fri, 16 Mar 2007 16:22:10 +0000" />
                    <attachment id="12353514" name="ASF.LICENSE.NOT.GRANTED--TestAccessManager.java" size="4545" author="xilu1999" created="Fri, 16 Mar 2007 16:22:10 +0000" />
                    <attachment id="12353513" name="ASF.LICENSE.NOT.GRANTED--TestLoginManager.java" size="7269" author="xilu1999" created="Fri, 16 Mar 2007 16:22:09 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 15 Mar 2007 17:38:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80331</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>192693</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>