<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:37:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-967/JCR-967.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-967] Only search the index for the &quot;jcr:system&quot; tree if needed</title>
                <link>https://issues.apache.org/jira/browse/JCR-967</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Right now every time a query is executed the index of the current workspace as well as the index of the &amp;quot;jcr:system&amp;quot; tree is searched. A lot of queries are not searching in the &amp;quot;jcr:system&amp;quot; tree at all therefore it should be checked if the query contains paths that include &amp;quot;jcr:system&amp;quot;. There are two relevant nodes in the query tree to find that out:&lt;br/&gt;
&lt;br/&gt;
- what&amp;#39;s the first location step and does it include the jcr:system tree? I think that&amp;#39;s an easy one.&lt;br/&gt;
- does the query contain a jcr:deref node? If there is an intermediate result of a query may dereference into the jcr:system tree. &lt;br/&gt;
&lt;br/&gt;
This should notably speed up query execution if you are working extensively with versioning.</description>
                <environment></environment>
            <key id="12371363">JCR-967</key>
            <summary>Only search the index for the &quot;jcr:system&quot; tree if needed</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="ckiehl">Christoph Kiehl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jun 2007 10:12:49 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:43 +0000</updated>
                    <resolved>Mon, 25 Jun 2007 09:58:33 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-core</component>
                <component>query</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12503349" author="monkiki" created="Mon, 11 Jun 2007 10:24:40 +0100"  >But you can exclude jcr:system from the search query, isn&amp;#39;t it? In my application my queries start from my &amp;quot;root node&amp;quot; not from the repository root.</comment>
                    <comment id="12503354" author="ckiehl" created="Mon, 11 Jun 2007 10:36:17 +0100"  >Even if you do exclude jcr:system in your query jackrabbit currently searches the lucene index for jcr:system as well although the resultset for that index will be empty.</comment>
                    <comment id="12503359" author="monkiki" created="Mon, 11 Jun 2007 11:07:25 +0100"  >Ups, I didn&amp;#39;t notice it. So, this would be a huge performance improvement on searchs...</comment>
                    <comment id="12504797" author="ckiehl" created="Thu, 14 Jun 2007 17:09:14 +0100"  >This is an initial patch which checks the first location step for &amp;quot;jcr:system&amp;quot;. This might not be enough since &amp;quot;jcr:system&amp;quot; might be reachable through the parent operator &amp;quot;..&amp;quot;. Not sure about this though.&lt;br/&gt;
I didn&amp;#39;t implement the check deref nodes. Right any deref node should lead to an inclusion of the system tree index. I&amp;#39;m not sure if it&amp;#39;s worth the hassle because for large result sets it might lead to performance degradation because every uuid has to be checked if its item is located under jcr:system.&lt;br/&gt;
I chose to implement this check through QueryNode because I think this would be less error prone than implement the whole check in QueryImpl because then QueryImpl has to know about every implementation of QueryNode. As it is now every QueryNode implementation is responsible for itself if it needs the system tree index to be included in the search.</comment>
                    <comment id="12505084" author="ckiehl" created="Fri, 15 Jun 2007 09:10:28 +0100"  >Attached revised patch which corrects behaviour for PathQueryNode</comment>
                    <comment id="12505139" author="ckiehl" created="Fri, 15 Jun 2007 11:33:44 +0100"  >Revised patch with unit test and some bugs fixed</comment>
                    <comment id="12506531" author="mreutegg" created="Wed, 20 Jun 2007 14:39:40 +0100"  >Looks good to me. Just one minor comment. I suggest we provide a default implementation QueryNode.needsSystemTree(), which returns false. Only the sub classes that differ from this would have to overwrite the method.</comment>
                    <comment id="12506533" author="mreutegg" created="Wed, 20 Jun 2007 14:43:35 +0100"  >Oops, just found an issue with the patch.&lt;br/&gt;
&lt;br/&gt;
queryRootNode = XPathQueryBuilder.createQuery(&amp;quot;//test/*&amp;quot;, JCR_RESOLVER);&lt;br/&gt;
assertTrue(queryRootNode.needsSystemTree());&lt;br/&gt;
&lt;br/&gt;
will fail.</comment>
                    <comment id="12507330" author="ckiehl" created="Fri, 22 Jun 2007 15:04:33 +0100"  >This patch works with &amp;quot;//test/*&amp;quot; as well. I extended the test case.&lt;br/&gt;
&lt;br/&gt;
I didn&amp;#39;t provide a default implementation of needsSystemTree() on purpose because I wanted to force everyone extending QueryNode to think about if his implementation needs the system tree or not. If we provide a default implementation that returns false this might lead to unexpected behaviour if one expects the system tree to be included. We could provide a default implemenation that returns true but then we would have to override the methods anyway in almost all QueryNode implemenations to return false.</comment>
                    <comment id="12507820" author="mreutegg" created="Mon, 25 Jun 2007 09:58:33 +0100"  >&amp;gt; I didn&amp;#39;t provide a default implementation of needsSystemTree() on purpose because I wanted&lt;br/&gt;
&amp;gt; to force everyone extending QueryNode to think about if his implementation needs the system&lt;br/&gt;
&amp;gt; tree or not.&lt;br/&gt;
&lt;br/&gt;
Ok, fair enough.&lt;br/&gt;
&lt;br/&gt;
Based on your ASF license grant on the patch I added a license header to PathQueryNodeTest, which was missing. I also added JavaDoc to the new method SearchIndex.getIndexReader(boolean) and opened up the visibility to protected.&lt;br/&gt;
&lt;br/&gt;
Thanks a lot for your work!&lt;br/&gt;
&lt;br/&gt;
Committed the patch in revision: 550419</comment>
                </comments>
                    <attachments>
                    <attachment id="12360365" name="patch.txt" size="11621" author="ckiehl" created="Fri, 22 Jun 2007 15:04:33 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 11 Jun 2007 09:24:40 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142454</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190046</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>