<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:32:37 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2408/JCR-2408.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2408] Mixin removal exception</title>
                <link>https://issues.apache.org/jira/browse/JCR-2408</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When trying to remove a mixin from a non nt:unstructured node (in my case nt:resource), you get the following exception:&lt;br/&gt;
&lt;br/&gt;
Unable to alter mixin types: javax.jcr.nodetype.ConstraintViolationException: no matching property definition found for {&lt;a href=&quot;http://www.day.com/jcr/cq/1.0&quot;&gt;http://www.day.com/jcr/cq/1.0&lt;/a&gt;}lastRolledout&lt;br/&gt;
&lt;br/&gt;
lastRolledout property is defined by the mixin cq:LiveRelationship that I am trying to remove.</description>
                <environment></environment>
            <key id="12441662">JCR-2408</key>
            <summary>Mixin removal exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="acapt">Alexandre Capt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Nov 2009 12:45:18 +0000</created>
                <updated>Wed, 20 Jan 2010 17:49:58 +0000</updated>
                    <resolved>Thu, 7 Jan 2010 17:57:11 +0000</resolved>
                            <version>2.0-beta1</version>
                                <fixVersion>2.0-beta6</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12782398" author="alexander.klimetschek" created="Wed, 25 Nov 2009 12:51:13 +0000"  >nt:resource is not nt:unstructured and does not have any residual property definition, hence this exception is correct.&lt;br/&gt;
&lt;br/&gt;
To solve your issue, you can remove the specific properties before removing the mixin.</comment>
                    <comment id="12782406" author="stefan@jira" created="Wed, 25 Nov 2009 13:00:02 +0000"  >this is a legitimate issue, hence re-opening it.</comment>
                    <comment id="12782411" author="alexander.klimetschek" created="Wed, 25 Nov 2009 13:06:32 +0000"  >If the primary node type used is nt:resource, this exception is IMO right, since after removing the mixin that contains the definition for lastRolledout, there is no longer any matching property definition for that property (assuming such a property exists on the node).</comment>
                    <comment id="12782419" author="acapt" created="Wed, 25 Nov 2009 13:18:26 +0000"  >To automatically remove properties or not is a design choice. But every developer will have to write the same piece of code before the removeMixin call to remove first the properties only to avoid this exception.</comment>
                    <comment id="12782421" author="stefan@jira" created="Wed, 25 Nov 2009 13:19:11 +0000"  >This is probably a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2170&quot; title=&quot;Remove PropDefId and NodeDefId&quot;&gt;&lt;strike&gt;JCR-2170&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
here&amp;#39;s the stack trace of a quick test i ran (removing mix:title from nt:folder node):&lt;br/&gt;
&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; javax.jcr.nodetype.ConstraintViolationException: no matching property definition found for {&lt;a href=&quot;http://www.jcp.org/jcr/1.0&quot;&gt;http://www.jcp.org/jcr/1.0&lt;/a&gt;}title&lt;br/&gt;
	at org.apache.jackrabbit.core.nodetype.EffectiveNodeType.getApplicablePropertyDef(EffectiveNodeType.java:782)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.getApplicablePropertyDefinition(NodeImpl.java:762)&lt;br/&gt;
	at org.apache.jackrabbit.core.ItemManager.getDefinition(ItemManager.java:241)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.removeMixin(NodeImpl.java:1047)&lt;br/&gt;
	at org.apache.jackrabbit.core.NodeImpl.removeMixin(NodeImpl.java:2622)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[...]</comment>
                    <comment id="12782426" author="stefan@jira" created="Wed, 25 Nov 2009 13:29:41 +0000"  >you should always be able to remove a mixin which has been previously added.&lt;br/&gt;
&lt;br/&gt;
how conflicts are resolved is an implementation choice. &lt;br/&gt;
&lt;br/&gt;
when removing a mixin M declaring a property P, the current implementation first tries&lt;br/&gt;
migrate P to a definition declared by the resulting effective node type. if this fails,&lt;br/&gt;
the property is removed.</comment>
                    <comment id="12782428" author="alexander.klimetschek" created="Wed, 25 Nov 2009 13:30:11 +0000"  >Is this about (a) throwing the exception immediately or upon save() or that (b) previously, Jackrabbit automatically removed all properties defined by a mixin upon removeMixin()? Sorry if I closed the issue prematurely, but the bug description misses vital information in that case.&lt;br/&gt;
&lt;br/&gt;
(a) is left open by the 1.0 spec, while the 2.0 spec is unclear about that in the javadocs to removeMixin(). It states first that validation should happen on persist, but later it notes that implementations are free to throw the ConstraintViolationException immediately or on save().&lt;br/&gt;
(b) if true, is not defined by the spec (at least I couldn&amp;#39;t find it) and that feature was unknown to me. But I agree that is very useful. =&amp;gt; should probably documented then</comment>
                    <comment id="12782430" author="alexander.klimetschek" created="Wed, 25 Nov 2009 13:33:56 +0000"  >&amp;gt; if this fails, the property is removed.&lt;br/&gt;
&lt;br/&gt;
I see. In that case I was expecting &amp;quot;Removal of mixin no longer automatically removes invalid properties&amp;quot; or similar as bug title. *Duck and run* ;-)</comment>
                    <comment id="12782852" author="stefan@jira" created="Thu, 26 Nov 2009 11:43:15 +0000"  >fixed in trunk r884535</comment>
                    <comment id="12782920" author="stefan@jira" created="Thu, 26 Nov 2009 15:48:22 +0000"  >reopening since there are still issues/failing test cases caused by a regression of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2170&quot; title=&quot;Remove PropDefId and NodeDefId&quot;&gt;&lt;strike&gt;JCR-2170&lt;/strike&gt;&lt;/a&gt;</comment>
                    <comment id="12782926" author="stefan@jira" created="Thu, 26 Nov 2009 16:16:26 +0000"  >patch which partially resolves this issue.&lt;br/&gt;
&lt;br/&gt;
there is still another issue/failing test case caused by a regression of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2170&quot; title=&quot;Remove PropDefId and NodeDefId&quot;&gt;&lt;strike&gt;JCR-2170&lt;/strike&gt;&lt;/a&gt;:&lt;br/&gt;
&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: org.apache.jackrabbit.core.security.authorization.acl.TestAll&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 86, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 12.283 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testRemoveMixin(org.apache.jackrabbit.core.security.authorization.acl.NodeTypeTest)  Time elapsed: 0.046 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
javax.jcr.AccessDeniedException: /testroot/node2/jcr:uuid: not allowed to remove item&lt;br/&gt;
	at org.apache.jackrabbit.core.ItemImpl.validateTransientItems(ItemImpl.java:630)&lt;br/&gt;
	at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1088)&lt;br/&gt;
	at org.apache.jackrabbit.core.security.authorization.AbstractNodeTypeManagementTest.testRemoveMixin(AbstractNodeTypeManagementTest.java:95)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:456)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at org.apache.jackrabbit.test.ConcurrentTestSuite.access$001(ConcurrentTestSuite.java:29)&lt;br/&gt;
	at org.apache.jackrabbit.test.ConcurrentTestSuite$2.run(ConcurrentTestSuite.java:67)&lt;br/&gt;
	at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:637)&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12787478" author="acapt" created="Tue, 8 Dec 2009 14:40:04 +0000"  >Considering the fact that for a nt:unstructured node, the mixin properties are not removed when removing the mixin (because they are accepted by the remaining nodetype), I decided to change my code to remove the properties in all the cases. &lt;br/&gt;
&lt;br/&gt;
Depending on what has been said before, this should work on nt:unstructured and nt:resoure nodetypes: 1) remove mixin properties 2) remove mixin 3) save.&lt;br/&gt;
&lt;br/&gt;
But it does NOT. I get the same exception, except that it complains about the second property of the mixin: javax.jcr.nodetype.ConstraintViolationException: no matching property definition found for {&lt;a href=&quot;http://www.day.com/jcr/cq/1.0&quot;&gt;http://www.day.com/jcr/cq/1.0&lt;/a&gt;}lastRolledoutBy&lt;br/&gt;
&lt;br/&gt;
Code executed:&lt;br/&gt;
&lt;br/&gt;
targetNode.getProperty(&amp;quot;lastRolledout&amp;quot;).remove();&lt;br/&gt;
targetNode.getProperty(&amp;quot;lastRolledoutBy&amp;quot;).remove();&lt;br/&gt;
targetNode.removeMixin(&amp;quot;cq:LiveRelationship&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
Exception is thrown on session.save();&lt;br/&gt;
&lt;br/&gt;
I ran this code on beta4, so with the previous patch.</comment>
                    <comment id="12788786" author="stefan@jira" created="Thu, 10 Dec 2009 16:50:10 +0000"  >&amp;gt; [...] But it does NOT. I get the same exception, except that [...]&lt;br/&gt;
&lt;br/&gt;
yes, this is is an *open* issue which occurs when modifying a node&amp;#39;s mixins. it hasn&amp;#39;t been resolved yet. &lt;br/&gt;
&lt;br/&gt;
&amp;gt; [...] I ran this code on beta4, so with the previous patch.&lt;br/&gt;
&lt;br/&gt;
the patch has not been applied because it doesn&amp;#39;t solve the issue completely (see my previous comment).</comment>
                    <comment id="12797702" author="mreutegg" created="Thu, 7 Jan 2010 17:39:53 +0000"  >Updated patch with a fix for the remaining issue.</comment>
                    <comment id="12797711" author="mreutegg" created="Thu, 7 Jan 2010 17:57:10 +0000"  >Applied patch in revision: 896940</comment>
                    <comment id="12797766" author="mreutegg" created="Thu, 7 Jan 2010 19:43:06 +0000"  >Merged into 2.0 branch in revision: 896979</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12427286">JCR-2130</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12429659" name="JCR-2408.patch" size="22852" author="mreutegg" created="Thu, 7 Jan 2010 17:39:52 +0000" />
                    <attachment id="12426229" name="JCR-2408.patch" size="18840" author="stefan@jira" created="Thu, 26 Nov 2009 16:17:26 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 25 Nov 2009 12:51:13 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78227</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191530</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>