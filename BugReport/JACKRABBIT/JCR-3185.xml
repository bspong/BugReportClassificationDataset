<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:41:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3185/JCR-3185.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3185] refactor consistency checks in BundleDBPersistenceManager into a standalone class that could be re-used for other PMs</title>
                <link>https://issues.apache.org/jira/browse/JCR-3185</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>see subject</description>
                <environment></environment>
            <key id="12535697">JCR-3185</key>
            <summary>refactor consistency checks in BundleDBPersistenceManager into a standalone class that could be re-used for other PMs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="reschke">Julian Reschke</assignee>
                                <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Dec 2011 13:27:01 +0000</created>
                <updated>Wed, 25 Jan 2012 13:06:22 +0000</updated>
                    <resolved>Tue, 20 Dec 2011 18:49:51 +0000</resolved>
                                            <fixVersion>2.3.7</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13172439" author="reschke" created="Mon, 19 Dec 2011 17:41:19 +0000"  >Proposal.&lt;br/&gt;
&lt;br/&gt;
(We could add the code to the AbstractBundlePM as well, but I wanted to keep it separate)</comment>
                    <comment id="13173164" author="reschke" created="Tue, 20 Dec 2011 13:02:05 +0000"  >Proposed change.</comment>
                    <comment id="13173312" author="jukkaz" created="Tue, 20 Dec 2011 17:07:56 +0000"  >+1 Looks straightforward enough, and moving the code outside the PM implementations make sense.&lt;br/&gt;
&lt;br/&gt;
I wonder if it might be a good idea to change getAllNodeIds() to return a Collection (or a Set) instead of an Iterable so we wouldn&amp;#39;t need the extra getNumberOfBundles() call. AFAIUI all PM implementations in any case implement getAllNodeIds() with an in-memory list so the memory impact shouldn&amp;#39;t be a problem (and if it is, the getAllNodeIds() signature already contains the maxCount option for dealing with that issue). And implementing getAllNodeIds() with an actual backend iterator opens up problems about when and how the resources used by the iterator can and should be released.&lt;br/&gt;
&lt;br/&gt;
PS. There&amp;#39;s an svn:executable property in the patch that probably shouldn&amp;#39;t be there.</comment>
                    <comment id="13173329" author="reschke" created="Tue, 20 Dec 2011 17:24:18 +0000"  >I agree that returning a collection/set/or list would make sense. However, if we ever change the code to use the paging feature we&amp;#39;ll need the getCount() method anyway...</comment>
                    <comment id="13173337" author="jukkaz" created="Tue, 20 Dec 2011 17:32:12 +0000"  >IIRC the paging feature in getAllNodeIds() was just added just so a client could iterate over all the nodes in chunks of predefined size. At least in that use case the total number of nodes was not needed.</comment>
                    <comment id="13173348" author="reschke" created="Tue, 20 Dec 2011 17:50:54 +0000"  >OK; so let&amp;#39;s use a list for now, do not add getNumberOfBundles(), and address this in the future when we actually use paging,</comment>
                    <comment id="13180351" author="tmueller" created="Thu, 5 Jan 2012 12:59:57 +0000"  >Loading the whole list in memory will run out of memory in many cases.&lt;br/&gt;
&lt;br/&gt;
The call isn&amp;#39;t supposed to block other operations (specially for DataStore garbage collection).&lt;br/&gt;
&lt;br/&gt;
Many persistence manager implementations can&amp;#39;t return the exact size() (specially, but not only because the call is non-blocking).&lt;br/&gt;
&lt;br/&gt;
Therefore the easiest solution is to revert the change, and don&amp;#39;t log the size. Or add a method getNumberOfBundlesEstimate() or so.</comment>
                    <comment id="13180372" author="jukkaz" created="Thu, 5 Jan 2012 13:17:00 +0000"  >&amp;gt; Loading the whole list in memory will run out of memory in many cases. &lt;br/&gt;
&lt;br/&gt;
That&amp;#39;s best handled on the client side, e.g. by making the consistency checker process things in chunks of say 1m nodes at a time. I&amp;#39;d track that as a separate issue.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; don&amp;#39;t log the size&lt;br/&gt;
&lt;br/&gt;
That&amp;#39;s what I&amp;#39;d do.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12535458">JCR-3184</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12537318">JCR-3200</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12508071" name="JCR-3185.diff" size="31635" author="reschke" created="Tue, 20 Dec 2011 13:02:05 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 20 Dec 2011 17:07:56 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>221382</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>250182</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>