<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:41:39 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1573/JCR-1573.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1573] Lucene Query Exception: &apos;attempt to access a deleted document&apos;</title>
                <link>https://issues.apache.org/jira/browse/JCR-1573</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Hi,&lt;br/&gt;
&lt;br/&gt;
I am getting an exception when trying to execute a query through the (Spring) JcrTemplate class....using the following code:&lt;br/&gt;
QueryManager qMgr = session.getWorkspace().getQueryManager();&lt;br/&gt;
QueryResult result = qMgr.createQuery(xpathQuery, Query.XPATH ).execute();&lt;br/&gt;
&lt;br/&gt;
The exception is thrown at the second line and is as follows:&lt;br/&gt;
&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:113)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.lucene.search.Hits.getMoreDocs(Hits.java:74)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.lucene.search.Hits.&amp;amp;lt;init&amp;gt;(Hits.java:53)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.lucene.search.Searcher.search(Searcher.java:46)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.lucene.search.Searcher.search(Searcher.java:38)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.lucene.SearchIndex.executeQuery(SearchIndex.java:660)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.executeQuery(QueryResultImpl.java:242)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.getResults(QueryResultImpl.java:290)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.&amp;amp;lt;init&amp;gt;(QueryResultImpl.java:192)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.lucene.QueryImpl.execute(QueryImpl.java:138)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.apache.jackrabbit.core.query.QueryImpl.execute(QueryImpl.java:176)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at com.intel.cds.cr.jcr.JcrManager$5.doInJcr(JcrManager.java:363)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.springmodules.jcr.JcrTemplate.execute(JcrTemplate.java:76)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]at org.springmodules.jcr.JcrTemplate.execute(JcrTemplate.java:108)[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;[0x9]... 19 more[\n]&amp;quot;&lt;br/&gt;
[DEBUG] &amp;lt;&amp;lt; &amp;quot;&amp;lt;/Exception&amp;gt;&amp;lt;/detail&amp;gt;&amp;lt;/soapenv:Fault&amp;gt;&amp;lt;/soapenv:Body&amp;gt;&amp;lt;/soapenv:Envelope&amp;gt;&amp;quot;&lt;br/&gt;
org.apache.axis2.AxisFault: attempt to access a deleted document&lt;br/&gt;
	at org.apache.axis2.util.Utils.getInboundFaultFromMessageContext(Utils.java:486)&lt;br/&gt;
	at org.apache.axis2.description.OutInAxisOperationClient.handleResponse(OutInAxisOperation.java:343)&lt;br/&gt;
	at org.apache.axis2.description.OutInAxisOperationClient.send(OutInAxisOperation.java:389)&lt;br/&gt;
	at org.apache.axis2.description.OutInAxisOperationClient.executeImpl(OutInAxisOperation.java:211)&lt;br/&gt;
	at org.apache.axis2.client.OperationClient.execute(OperationClient.java:163)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
My Jackrabbit/Lucene configuration is as follows:&lt;br/&gt;
&lt;br/&gt;
&amp;lt;SearchIndex class=&amp;quot;org.apache.jackrabbit.core.query.lucene.SearchIndex&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;path&amp;quot; value=&amp;quot;${rep.home}/repository/index&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;useCompoundFile&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;mergeFactor&amp;quot; value=&amp;quot;5&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;cacheSize&amp;quot; value=&amp;quot;10000&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;respectDocumentOrder&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;  &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;lt;/SearchIndex&amp;gt;&lt;br/&gt;
&lt;br/&gt;
Is this a configuration issue or a bug?&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David.</description>
                <environment>Windows XP, PostgreSQL database, Spring, Tomcat </environment>
            <key id="12395419">JCR-1573</key>
            <summary>Lucene Query Exception: &apos;attempt to access a deleted document&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="dmckitterick">David McKitterick</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 May 2008 15:08:01 +0100</created>
                <updated>Thu, 26 Feb 2009 14:30:29 +0000</updated>
                    <resolved>Thu, 30 Oct 2008 16:59:42 +0000</resolved>
                            <version>core 1.4.2</version>
                                <fixVersion>core 1.4.9</fixVersion>
                <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                <component>query</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12594891" author="mreutegg" created="Wed, 7 May 2008 13:27:50 +0100"  >Can you please post the complete configuration and the workspace.xml of the workspace your are using?&lt;br/&gt;
&lt;br/&gt;
What Lucene version are you using?</comment>
                    <comment id="12594903" author="dmckitterick" created="Wed, 7 May 2008 14:10:47 +0100"  >Hi Marcel,&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve attached my Jackrabbit configuration file. My Lucene version is 2.2.0 and Jackrabbit core 1.4.2. Please let me know if you need any more information.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David.&lt;br/&gt;
</comment>
                    <comment id="12595510" author="mreutegg" created="Fri, 9 May 2008 10:02:36 +0100"  >The only thing I noticed while quickly looking through the repository.xml is the hardcoded url for the workspace persistence manager. The url should usually include the ${wsp.home} or ${wsp.name} parameter.&lt;br/&gt;
&lt;br/&gt;
Can you please check if the issue also occurs with a default configuration? Thanks.</comment>
                    <comment id="12595515" author="dmckitterick" created="Fri, 9 May 2008 10:31:47 +0100"  >The hardcoded url for the persistence manager points to a specific jdbc database location, where all the content is stored, i.e.&lt;br/&gt;
&amp;lt;param name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:&lt;a href=&quot;postgresql://localhost/crs_xml_repo&quot;&gt;postgresql://localhost/crs_xml_repo&lt;/a&gt;&amp;quot;/&amp;gt;&lt;br/&gt;
&lt;br/&gt;
I will try the default configuration again, but as I only increased some of the default values to improve the performance and scalability then I doubt that this is the problem.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David.</comment>
                    <comment id="12595676" author="dmckitterick" created="Fri, 9 May 2008 18:32:17 +0100"  >Hi Marcel,&lt;br/&gt;
&lt;br/&gt;
I have used the default configuration but I am still getting this error. Here is a snippet of my jackrabbit debug logs when the error occurs. Does anything here seem strange to you?&lt;br/&gt;
&lt;br/&gt;
DEBUG http-8080-1 org.springmodules.jcr.SessionFactoryUtils - Opening JCR Session&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.state.MLRUItemStateCache - &lt;a href=&apos;mailto:org.apache.jackrabbit.core.state.MLRUItemStateCache@1cdfd19&apos;&gt;org.apache.jackrabbit.core.state.MLRUItemStateCache@1cdfd19&lt;/a&gt; size=1, 1864/4194304&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.state.MLRUItemStateCache - &lt;a href=&apos;mailto:org.apache.jackrabbit.core.state.MLRUItemStateCache@1cdfd19&apos;&gt;org.apache.jackrabbit.core.state.MLRUItemStateCache@1cdfd19&lt;/a&gt; size=1, 1864/4194304&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.state.MLRUItemStateCache - &lt;a href=&apos;mailto:org.apache.jackrabbit.core.state.MLRUItemStateCache@18f7701&apos;&gt;org.apache.jackrabbit.core.state.MLRUItemStateCache@18f7701&lt;/a&gt; size=1, 1264/4194304&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.state.MLRUItemStateCache - &lt;a href=&apos;mailto:org.apache.jackrabbit.core.state.MLRUItemStateCache@18f7701&apos;&gt;org.apache.jackrabbit.core.state.MLRUItemStateCache@18f7701&lt;/a&gt; size=1, 1264/4194304&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - created item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - created item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - caching item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - caching item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.QueryImpl - Executing query: &lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={&lt;a href=&quot;http://release2.iclassproject.com/&quot;&gt;http://release2.iclassproject.com/&lt;/a&gt;}task Descendants=true Index=NONE&lt;br/&gt;
&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.QueryImpl - Executing query: &lt;br/&gt;
+ Root node&lt;br/&gt;
+ Select properties: *&lt;br/&gt;
&amp;nbsp;&amp;nbsp;+ PathQueryNode&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ LocationStepQueryNode:  NodeTest={&lt;a href=&quot;http://release2.iclassproject.com/&quot;&gt;http://release2.iclassproject.com/&lt;/a&gt;}task Descendants=true Index=NONE&lt;br/&gt;
&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.QueryResultImpl - getResults(2147483647)&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.QueryResultImpl - getResults(2147483647)&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.AbstractIndex - closing IndexWriter.&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.AbstractIndex - closing IndexWriter.&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.AbstractIndex - closing IndexWriter.&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.query.lucene.AbstractIndex - closing IndexWriter.&lt;br/&gt;
DEBUG http-8080-1 org.springmodules.jcr.SessionFactoryUtils - Closing JCR Session&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - invalidated item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - invalidated item cafebabe-cafe-babe-cafe-babecafebabe&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - removing item cafebabe-cafe-babe-cafe-babecafebabe from cache&lt;br/&gt;
DEBUG http-8080-1 org.apache.jackrabbit.core.ItemManager - removing item cafebabe-cafe-babe-cafe-babecafebabe from cache&lt;br/&gt;
&lt;br/&gt;
...&lt;br/&gt;
&lt;br/&gt;
DEBUG http-8080-1 org.apache.axis2.transport.http.AxisServlet - org.apache.axis2.AxisFault: attempt to access a deleted document&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Also, I think it might have something to do with my approach for updated entries. Here is my code from my update method:&lt;br/&gt;
&lt;br/&gt;
Node root = session.getRootNode();&lt;br/&gt;
	                &lt;br/&gt;
Node node = root.getNode(parentNode+&amp;quot;/&amp;quot;+uuid+&amp;quot;/&amp;quot;+ownerId);&lt;br/&gt;
&lt;br/&gt;
String ownerType = node.getProperty(CRSConstants.ownerTypeProperty).getString();&lt;br/&gt;
&lt;br/&gt;
node.checkout();&lt;br/&gt;
	            	&lt;br/&gt;
NodeIterator iter = node.getNodes();&lt;br/&gt;
&lt;br/&gt;
// remove existing child nodes before adding new node... is there a better to do this?	            	&lt;br/&gt;
while(iter.hasNext()) {&lt;br/&gt;
	 ((Node)iter.next()).remove();&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
try {&lt;br/&gt;
	session.importXML(&amp;quot;/&amp;quot;+parentNode+&amp;quot;/&amp;quot;+uuid+&amp;quot;/&amp;quot;+ownerId, ip,   ImportUUIDBehavior.IMPORT_UUID_CREATE_NEW);&lt;br/&gt;
} catch (IOException e) {&lt;br/&gt;
	logger.error(&amp;quot;Error thrown while importing xml&amp;quot;, e);&lt;br/&gt;
}&lt;br/&gt;
	                &lt;br/&gt;
node.setProperty(CRSConstants.ownerTypeProperty, ownerType);&lt;br/&gt;
	                &lt;br/&gt;
session.save();&lt;br/&gt;
node.checkin();&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Any thoughts on this?&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David.</comment>
                    <comment id="12596710" author="dmosses" created="Wed, 14 May 2008 11:30:57 +0100"  >Hi,&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m experiencing the same issue with Jackrabbit 1.4.&lt;br/&gt;
&lt;br/&gt;
I call:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;QueryManager qm = session.getWorkspace().getQueryManager();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Query query = qm.createQuery(searchTerm, Query.XPATH);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;QueryResult result = query.execute();&lt;br/&gt;
&lt;br/&gt;
And get the exception:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.IllegalArgumentException: attempt to access a deleted document&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.index.SegmentReader.document(SegmentReader.java:331)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.index.FilterIndexReader.document(FilterIndexReader.java:130)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.index.IndexReader.document(IndexReader.java:437)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.CachingIndexReader.getParent(CachingIndexReader.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SharedIndexReader.getParent(SharedIndexReader.java:78)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.ReadOnlyIndexReader.getParent(ReadOnlyIndexReader.java:141)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.CachingMultiIndexReader.getParentDocId(CachingMultiIndexReader.java:112)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SearchIndex$CombinedIndexReader.getParent(SearchIndex.java:1202)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.isValid(DescendantSelfAxisQuery.java:347)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.next(DescendantSelfAxisQuery.java:261)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Scorer.score(Scorer.java:48)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.ChildAxisQuery$ChildAxisScorer.calculateChildren(ChildAxisQuery.java:317)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.ChildAxisQuery$ChildAxisScorer.next(ChildAxisQuery.java:268)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Scorer.score(Scorer.java:48)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.collectContextHits(DescendantSelfAxisQuery.java:305)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.next(DescendantSelfAxisQuery.java:254)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Scorer.score(Scorer.java:48)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:146)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:113)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Hits.getMoreDocs(Hits.java:74)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Hits.&amp;lt;init&amp;gt;(Hits.java:53)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Searcher.search(Searcher.java:46)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.lucene.search.Searcher.search(Searcher.java:38)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SearchIndex.executeQuery(SearchIndex.java:660)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.executeQuery(QueryResultImpl.java:242)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.getResults(QueryResultImpl.java:290)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.&amp;lt;init&amp;gt;(QueryResultImpl.java:192)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.QueryImpl.execute(QueryImpl.java:138)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.QueryImpl.execute(QueryImpl.java:176)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.rmi.server.ServerQuery.execute(ServerQuery.java:58)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.Transport$1.run(Transport.java:153)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.Transport.serviceCall(Transport.java:149)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:466)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:707)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:595)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:247)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:223)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.rmi.server.ServerQuery_Stub.execute(Unknown Source)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.rmi.client.ClientQuery.execute(ClientQuery.java:63)&lt;br/&gt;
&lt;br/&gt;
This is a strange one because my system deletes documents that have &amp;#39;expired&amp;#39; on a regular basis and until recently this has not been a problem.  I have recently updated to 1.4 from 1.3.? but actually it&amp;#39;s been working fine with 1.4 for some time now as well - this is the first time I&amp;#39;ve experienced this problem.&lt;br/&gt;
&lt;br/&gt;
As far as I&amp;#39;m aware I&amp;#39;m using a completely standard workspace.xml (i.e. no changes to persistence manager etc).</comment>
                    <comment id="12610590" author="mreutegg" created="Fri, 4 Jul 2008 15:06:46 +0100"  >David, can you please check that you are using lucene 2.2.0? Jackrabbit currently does not work with lucene versions &amp;gt;= 2.3.x</comment>
                    <comment id="12610601" author="dmckitterick" created="Fri, 4 Jul 2008 15:48:34 +0100"  >Hi Marcel,&lt;br/&gt;
&lt;br/&gt;
Yes, I converted back to Lucene 2.2.0 and used the default Jackrabbit configurations. The problem still remained so I did some more testing. I discovered that the problem was occurring during my update process... here I would remove a particular node and then replace it with the updated version by importing the XML. It seems the lucene index did not pick up this remove/import action and then when a query was performed it would try to retrieve the removed node... therefore throwing the exception. I resolved this by adding my this extra line after my update process:&lt;br/&gt;
&lt;br/&gt;
node.update(session.getWorkspace().getName());&lt;br/&gt;
&lt;br/&gt;
This seemed to update the index and the exception has not re-occurred.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m guessing there probably is a better way to perform updates but it was not obvious to me from the documentation available.&lt;br/&gt;
&lt;br/&gt;
Anyway, thanks for your help.&lt;br/&gt;
&lt;br/&gt;
Best regards,&lt;br/&gt;
David.&lt;br/&gt;
</comment>
                    <comment id="12610915" author="mreutegg" created="Mon, 7 Jul 2008 09:51:11 +0100"  >&amp;gt; node.update(session.getWorkspace().getName());&lt;br/&gt;
&lt;br/&gt;
if that node is in the workspace which is returned by session.getWorkspace().getName() then this is actually a no-op.&lt;br/&gt;
&lt;br/&gt;
There must be something else you changed, which made the indexing work again correctly. Are you sure that reverting&lt;br/&gt;
back to Lucene 2.2 did not resolve the issue? You probably also have to re-index your workspaces because Lucene is not able to read index files from a newer version.</comment>
                    <comment id="12610920" author="dmckitterick" created="Mon, 7 Jul 2008 10:01:09 +0100"  >My initial thought was that it did not have a positive affect but perhaps you are right that this issue was resolved with the Lucene version change to 2.2.0. I&amp;#39;ll let you know if I have any other similar problems.&lt;br/&gt;
&lt;br/&gt;
Many thanks,&lt;br/&gt;
David.</comment>
                    <comment id="12618308" author="wolfgang.kurz@gwvs.de" created="Wed, 30 Jul 2008 13:10:33 +0100"  >Hello everyone,&lt;br/&gt;
&lt;br/&gt;
i am having the same problem.&lt;br/&gt;
&lt;br/&gt;
The problem started showing up when I started to delete subnodes in a&lt;br/&gt;
node that I wanted to update with new subnodes.&lt;br/&gt;
&lt;br/&gt;
Has anyone found a solution to this?&lt;br/&gt;
&lt;br/&gt;
Do I have to update the lucene search index manually or something?&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Wolfgang&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12618327" author="mreutegg" created="Wed, 30 Jul 2008 14:31:06 +0100"  >David, while going though this issue again, I noticed that the query configuration you posted might be incorrect. Can you please confirm that the XML fragment you posted is only for the repository wide index (the one at the very end in repository.xml) and not from a workspace.xml? In a workspace.xml file a search index configuration should rather look like this:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;SearchIndex class=&amp;quot;org.apache.jackrabbit.core.query.lucene.SearchIndex&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;path&amp;quot; value=&amp;quot;${wsp.home}/index&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/SearchIndex&amp;gt;&lt;br/&gt;
&lt;br/&gt;
yours had &amp;#39;${rep.home}/repository/index&amp;#39; for the path parameter.&lt;br/&gt;
&lt;br/&gt;
Wolfgang, please check your repository.xml and workspace.xml files as well and make sure you are using Lucene 2.2?&lt;br/&gt;
&lt;br/&gt;
Thanks for your feedback.</comment>
                    <comment id="12641384" author="m.meomartino" created="Tue, 21 Oct 2008 15:02:32 +0100"  >Hi everyone,&lt;br/&gt;
I&amp;#39;m having the same problem while searching for nodes with xPath in my Junit4 test case.&lt;br/&gt;
In this test I add some node to the repository-tree and then search with this xPath query:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//catalog/books//*&lt;br/&gt;
&lt;br/&gt;
then, after each test in @After methods, I provide to clean the repository tree and then saving session.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@After&lt;br/&gt;
	public void tearDownTest() {&lt;br/&gt;
		try {&lt;br/&gt;
			session.getRootNode().getNode(&amp;quot;catalog&amp;quot;).remove();&lt;br/&gt;
			session.save();&lt;br/&gt;
		}&lt;br/&gt;
		catch (RepositoryException e) {			&lt;br/&gt;
			e.printStackTrace();&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;br/&gt;
&lt;br/&gt;
The first time, during creation of repository, everything gones ok. But at  the next run i get this exception&lt;br/&gt;
&lt;br/&gt;
java.lang.IllegalArgumentException: attempt to access a deleted document&lt;br/&gt;
	at org.apache.lucene.index.SegmentReader.document(SegmentReader.java:331)&lt;br/&gt;
	at org.apache.lucene.index.FilterIndexReader.document(FilterIndexReader.java:130)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.CachingIndexReader.getParent(CachingIndexReader.java:107)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.SharedIndexReader.getParent(SharedIndexReader.java:78)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.ReadOnlyIndexReader.getParent(ReadOnlyIndexReader.java:141)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.CachingMultiIndexReader.getParentDocId(CachingMultiIndexReader.java:112)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.SearchIndex$CombinedIndexReader.getParent(SearchIndex.java:1234)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.isValid(DescendantSelfAxisQuery.java:347)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.DescendantSelfAxisQuery$DescendantSelfAxisScorer.next(DescendantSelfAxisQuery.java:261)&lt;br/&gt;
	at org.apache.lucene.search.Scorer.score(Scorer.java:48)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.ChildAxisQuery$ChildAxisScorer.calculateChildren(ChildAxisQuery.java:317)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.ChildAxisQuery$ChildAxisScorer.next(ChildAxisQuery.java:268)&lt;br/&gt;
	at org.apache.lucene.search.Scorer.score(Scorer.java:48)&lt;br/&gt;
	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:146)&lt;br/&gt;
	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:113)&lt;br/&gt;
	at org.apache.lucene.search.Hits.getMoreDocs(Hits.java:74)&lt;br/&gt;
	at org.apache.lucene.search.Hits.&amp;lt;init&amp;gt;(Hits.java:53)&lt;br/&gt;
	at org.apache.lucene.search.Searcher.search(Searcher.java:46)&lt;br/&gt;
	at org.apache.lucene.search.Searcher.search(Searcher.java:38)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.SearchIndex.executeQuery(SearchIndex.java:692)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.executeQuery(QueryResultImpl.java:242)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.getResults(QueryResultImpl.java:290)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.QueryResultImpl.&amp;lt;init&amp;gt;(QueryResultImpl.java:192)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.lucene.QueryImpl.execute(QueryImpl.java:138)&lt;br/&gt;
	at org.apache.jackrabbit.core.query.QueryImpl.execute(QueryImpl.java:176)&lt;br/&gt;
&lt;br/&gt;
the strange thing is that if i change the xPath query from&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//catalog/books//*&lt;br/&gt;
&lt;br/&gt;
into&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//catalog/books//element(*, somePrimaryNodeType)&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t get this exception anymore. &lt;br/&gt;
Can anyone shed any light on this issue&lt;br/&gt;
</comment>
                    <comment id="12641391" author="mreutegg" created="Tue, 21 Oct 2008 15:36:43 +0100"  >Can you please provide the complete test case or a description of how to reproduce the exception? Thank you.</comment>
                    <comment id="12641400" author="m.meomartino" created="Tue, 21 Oct 2008 16:04:26 +0100"  >The classes are:&lt;br/&gt;
&lt;br/&gt;
// TestClass&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ContentRepository cr;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@BeforeClass&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Initialize(){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//initialization of contentRepository class&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cr= new ContentRepository()&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;....&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Test&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testGetNodes() throws Exception {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String catalogBookPath = session.getRootNode().getNode(&amp;quot;catalog&amp;quot;).getNode(&amp;quot;book&amp;quot;).getPath();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BookNode bookNode = new BookNode();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;bookNode.setName(&amp;quot;mybook&amp;quot;);&lt;br/&gt;
		&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cr.addNode(catalogBookPath, bookNode);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List&amp;lt;BookNode&amp;gt; createdNode = cr.getNodes(&amp;quot;//catalog/books//*&amp;quot;);                  ..... exception&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@After&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void tearDownTest() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;session.getRootNode().getNode(&amp;quot;catalog&amp;quot;).remove();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;session.save();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch (RepositoryException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;e.printStackTrace();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
// class ContentRepository&lt;br/&gt;
&lt;br/&gt;
......&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void addNode(string bookPath, BookNode bookNode){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Node parentNode = session.getRootNode().getNode(bookPath);     &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;parentNode.addNode(bookNode.getName(), bookNode.getNodeType());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch (RepositoryException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;e.printStackTrace();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public List&amp;lt;BookNode&amp;gt; getNodes(String queryXPath){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;QueryManager queryManager = session.getWorkspace().getQueryManager();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Query query = queryManager.createQuery(xPath, Query.XPATH);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;QueryResult result = query.execute();       // exception&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.......&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
.......&lt;br/&gt;
&lt;br/&gt;
Hope is enough.&lt;br/&gt;
Thank you</comment>
                    <comment id="12644038" author="mreutegg" created="Thu, 30 Oct 2008 16:59:42 +0000"  >Fixed in revision: 709207&lt;br/&gt;
&lt;br/&gt;
The CombinedIndexReader in SearchIndex did not add the offset of the sub reader when resolving a ForeignSegmentDocId.&lt;br/&gt;
&lt;br/&gt;
Jukka, can you please merge this fix into the 1.5 branch? Thanks.</comment>
                    <comment id="12647602" author="jukkaz" created="Fri, 14 Nov 2008 13:15:25 +0000"  >Merged to the 1.5 branch in revision 713996.</comment>
                    <comment id="12677006" author="mreutegg" created="Thu, 26 Feb 2009 14:30:29 +0000"  >Merged changes into 1.4 branch in revision: 748161</comment>
                </comments>
                    <attachments>
                    <attachment id="12381595" name="jackrabbit-repo.xml" size="6669" author="dmckitterick" created="Wed, 7 May 2008 14:10:47 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 7 May 2008 12:27:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78501</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190186</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>