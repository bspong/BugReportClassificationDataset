<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:42:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1041/JCR-1041.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1041] Avoid using BitSets in ChildAxisQuery to minimize memory usage</title>
                <link>https://issues.apache.org/jira/browse/JCR-1041</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When doing ChildAxisQueries on large indexes the internal BitSet instance (hits) may consume a lot of memory because the BitSet is always as large as IndexReader.maxDoc(). In our case we had a query consisting of 7 ChildAxisQueries which combined to a total of 14MB. Since we have multiple users executing this query simultaneously this caused an out of memory error.</description>
                <environment></environment>
            <key id="12374961">JCR-1041</key>
            <summary>Avoid using BitSets in ChildAxisQuery to minimize memory usage</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="ckiehl">Christoph Kiehl</assignee>
                                <reporter username="ckiehl">Christoph Kiehl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jul 2007 16:16:54 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:50 +0000</updated>
                    <resolved>Wed, 15 Aug 2007 08:16:57 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-core</component>
                <component>query</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12516427" author="ckiehl" created="Mon, 30 Jul 2007 16:56:14 +0100"  >This patch introduces a few new classes for the handling of hits. In essence this patch does two things:&lt;br/&gt;
&lt;br/&gt;
1. It tries to use int arrays instead of BitSet to reduce memory consumption. If a BitSet is more efficient than an int array it switches to using a BitSet instance.&lt;br/&gt;
2. The nameTestHits are only created lazily by wrapping the nameTestScorer in a Hits instance.&lt;br/&gt;
3. The calculation if the index of a childnode is valid is only done if the corresponding hit is requested.&lt;br/&gt;
&lt;br/&gt;
In our internal tests the query execution performance didn&amp;#39;t suffer but is much better for ChildAxisQueries with a large number of matching child nodes.</comment>
                    <comment id="12518422" author="jukkaz" created="Wed, 8 Aug 2007 13:12:40 +0100"  >How about an alternative implementation of using just a TreeSet of Integers instead of BitSets? A sparse set would scale with the number of query results instead of the size of the entire workspace.</comment>
                    <comment id="12518568" author="ckiehl" created="Wed, 8 Aug 2007 23:43:18 +0100"  >Well, according to various sources (&lt;a href=&quot;http://martin.nobilitas.com/java/sizeof.html&quot;&gt;http://martin.nobilitas.com/java/sizeof.html&lt;/a&gt; and &lt;a href=&quot;http://www.javaworld.com/javaworld/javatips/jw-javatip130.html?page=2)&quot;&gt;http://www.javaworld.com/javaworld/javatips/jw-javatip130.html?page=2)&lt;/a&gt; an Integer instance needs 16 bytes. A native int needs 4 bytes. This is why I would prefer an array of ints (not even counting the TreeSet overhead which uses a TreeMap which wraps every Integer in an Entry instance).&lt;br/&gt;
The AdaptingHits class is only needed for corner cases where contextQuery result sets get really large. You could instead just use ArrayHits directly to resemble what a TreeSet would achieve just using less memory.&lt;br/&gt;
But I thought we could use those Hits classes in a few other places like DescendantSelfAxisQuery as well, where large contextQuery results are much more common.</comment>
                    <comment id="12519649" author="mreutegg" created="Tue, 14 Aug 2007 12:45:30 +0100"  >Very nice work.&lt;br/&gt;
&lt;br/&gt;
Can you please add a copy right header to the new files? And then feel free to commit the changes.</comment>
                    <comment id="12519879" author="ckiehl" created="Wed, 15 Aug 2007 08:16:57 +0100"  >Added suggested patch with additional license headers in revision 566042</comment>
                    <comment id="12524997" author="ckiehl" created="Wed, 5 Sep 2007 07:38:37 +0100"  >Fixed a little bug in ChildAxisScorer.skipTo() in revision 572885 as suggested by Ard Schrijvers in &lt;a href=&quot;http://www.nabble.com/AIOOBE-in-ChildAxisScorer-in-jackrabbit-trunk-tf4376105.html&quot;&gt;http://www.nabble.com/AIOOBE-in-ChildAxisScorer-in-jackrabbit-trunk-tf4376105.html&lt;/a&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12362773" name="avoid_using_bitsets.patch" size="25364" author="ckiehl" created="Mon, 30 Jul 2007 16:56:14 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 8 Aug 2007 12:12:40 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142500</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279612</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>