<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:29:45 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1198/JCR-1198.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1198] Issue while loading list of classes at that path itself.</title>
                <link>https://issues.apache.org/jira/browse/JCR-1198</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Hi,&lt;br/&gt;
&lt;br/&gt;
I cannot retrieve list of objects that are directly under the path that they were saved in. I did not know where to simulate this issue and hence I have used DigesterSimpleQueryTest. I have attached the path for the newly added test case testObjectListRetrievalAtBasePath. In case the patch is not up to the mark I have attached the modified file too.&lt;br/&gt;
&lt;br/&gt;
Instead of creating Page in /test if I create it in /sample/test and search in /sample/test it returns nothing but if I search in /sample it would return the object.&lt;br/&gt;
&lt;br/&gt;
Another important point here is that it is causing issues while retrieving Page class, the other test cases that are retrieving Paragraph class (embedded inside Page class) are still working fine!&lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
&lt;br/&gt;
Kaizer</description>
                <environment>Windows XP</environment>
            <key id="12381535">JCR-1198</key>
            <summary>Issue while loading list of classes at that path itself.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="clombart">Christophe Lombart</assignee>
                                <reporter username="kaizers">Kaizer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Oct 2007 09:29:23 +0000</created>
                <updated>Tue, 15 Jan 2008 23:27:02 +0000</updated>
                    <resolved>Wed, 28 Nov 2007 10:19:45 +0000</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-ocm</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12544417" author="kaizers" created="Wed, 21 Nov 2007 11:07:51 +0000"  >Patch for a new method of getObjects(Class, path) in OCM</comment>
                    <comment id="12544615" author="clombart" created="Wed, 21 Nov 2007 22:21:22 +0000"  >Thanks but the unit test failed. Can you review your patch for the  unit test DigesterSimpleQueryTest and add a new one for the new method getObjects</comment>
                    <comment id="12544709" author="kaizers" created="Thu, 22 Nov 2007 06:28:34 +0000"  >I have removed the earlier file. I have attached a new zip file &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1198&quot; title=&quot;Issue while loading list of classes at that path itself.&quot;&gt;&lt;strike&gt;JCR-1198&lt;/strike&gt;&lt;/a&gt;.zip which contains the patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1198&quot; title=&quot;Issue while loading list of classes at that path itself.&quot;&gt;&lt;strike&gt;JCR-1198&lt;/strike&gt;&lt;/a&gt;.patch) and also the source files. The patch also includes the test method testGetObjectsByClassNameAndPath which tests the new method added in OCM. In case of any issues in patch let me know. Since we are in different timezones it would take time to respond back to you.&lt;br/&gt;
&lt;br/&gt;
I am not convinced that the code in ObjectContentManager is correct. Extract from my earlier mail so that it is recorded as part of this issue id.&lt;br/&gt;
&lt;br/&gt;
- forming of jcrExpression in ObjectContentManagerImpl instead of QueryManager&lt;br/&gt;
- It will retrieve objects in that path only; basically no objects from child nodes are retrieved.&lt;br/&gt;
&lt;br/&gt;
Ideally in getObjects I would have formed a Query object and called the method of QueryManager to get the jcrExpression. The reason I could not do it right now is because the way query behaves for objects stored directly under that path.&lt;br/&gt;
&lt;br/&gt;
If there is any other idea or suggestion to change this then let me know and I can contribute a patch.&lt;br/&gt;
</comment>
                    <comment id="12544900" author="clombart" created="Thu, 22 Nov 2007 23:27:41 +0000"  >Patch applied. Thanks. &lt;br/&gt;
&lt;br/&gt;
I changed the jcr expression in the method getObjects otherwise it doesn&amp;#39;t work. We have to use &amp;quot;/&amp;quot; and not &amp;quot;//&amp;quot;&lt;br/&gt;
&amp;nbsp;Let me know if you are agree with that change. I also change the unit test to add more tests. &lt;br/&gt;
Tomorrow, I will refactor the getObjects impl to use the Query object.&lt;br/&gt;
&lt;br/&gt;
I would like also to make public the method getObjects(String jcrExpression, String language). What do you think about that ? </comment>
                    <comment id="12544986" author="kaizers" created="Fri, 23 Nov 2007 11:25:49 +0000"  >I had changed the getObjects method to check if the parent path is &amp;quot;/&amp;quot; and if so, set it to &amp;quot;&amp;quot; so that the expression wouldnt become &amp;quot;///element&amp;quot;. But if the path is &amp;quot;some/test&amp;quot;, then the parent path would be &amp;quot;some&amp;quot; in which case the jcr expression should be &amp;quot;some//element&amp;quot;. But if we use &amp;quot;/&amp;quot;, wouldnt the expression then become &amp;quot;some/element&amp;quot;?&lt;br/&gt;
&lt;br/&gt;
If the getObjects method uses a Query object, we&amp;#39;ll again be faced with the same scenario as the way the QueryManagerImpl builds the jcrExpression does not retrieve objects stored directly under the given path. This is why i feel that perhaps it is Jackrabbits implementation that may be incorrect. &lt;br/&gt;
&lt;br/&gt;
Yes, i think its a good idea to include the method getObjects(String jcrExpression, String language). &lt;br/&gt;
</comment>
                    <comment id="12544991" author="clombart" created="Fri, 23 Nov 2007 11:40:14 +0000"  >Concerning the Query object, it has to manage the node name to make this kind of query. I will review your patch this week-end.&lt;br/&gt;
&lt;br/&gt;
anyway, the query support in the OCM is not ideal. We should refactor later this part depending the community feedback </comment>
                    <comment id="12546037" author="clombart" created="Tue, 27 Nov 2007 22:55:32 +0000"  >Kaiser, &lt;br/&gt;
&lt;br/&gt;
I think the problem is solved. Is it ok for you ? &lt;br/&gt;
Did you review the code ? &lt;br/&gt;
&lt;br/&gt;
thanks</comment>
                    <comment id="12546190" author="kaizers" created="Wed, 28 Nov 2007 10:07:59 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
I had a look at the code and it does solve our problem. The test case works perfectly fine. It&amp;#39;s a good idea to have the node name in the Filter. Ideally i&amp;#39;d have liked the splitting of the path into the scope and the node name that is currently in ObjectContentManager to be part of QueryManagerImpl but i dont think it can be done as then the search would be restricted to that path itself and not its children.&lt;br/&gt;
&lt;br/&gt;
I think this issue can be marked as fixed now.&lt;br/&gt;
&lt;br/&gt;
Thanks a lot for your help!&lt;br/&gt;
&lt;br/&gt;
Kaizer</comment>
                    <comment id="12546194" author="clombart" created="Wed, 28 Nov 2007 10:19:45 +0000"  >Thanks for the feedback &lt;br/&gt;
FYI, we will maybe refactor the OCM  query implementation depending on the community feedback. </comment>
                    <comment id="12546617" author="kaizers" created="Thu, 29 Nov 2007 09:04:29 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
Please let me know if we would we be getting this fix as part of release 1.4 as it&amp;#39;s very important for my project.&lt;br/&gt;
&lt;br/&gt;
Thanks.</comment>
                    <comment id="12548600" author="kaizers" created="Wed, 5 Dec 2007 09:18:31 +0000"  >It seems that the original problem still persists. When I verified I checked for objects in that node only and another test case which checked for anywhere in the child. But for query to retrieve objects in current node or anywhere in child (self-or-descendant-axis?) it does not retrieve the objects of current node :-(.&lt;br/&gt;
&lt;br/&gt;
TestGetObjectsAnywhereInPath.patch demonstrates what I have stated above.&lt;br/&gt;
&lt;br/&gt;
Is there a way to form a Query in such a way that it retrieves objects from current node and also from its child nodes.</comment>
                    <comment id="12548646" author="kaizers" created="Wed, 5 Dec 2007 12:16:17 +0000"  >This issue seems to be bigger than I thought. Right now objects are retrieved just below one level of the scope set. E.g. after applying the patch TestGetObjectsAnywhereInPath.patch in the method if we change the scope from &amp;quot;/folder/test/&amp;quot; to &amp;quot;/folder/&amp;quot; it just retrieves 4 objects and does not retrieve the one under /folder/test/test1.&lt;br/&gt;
&lt;br/&gt;
This has happened after this issue was fixed.&lt;br/&gt;
&lt;br/&gt;
In QueryManagerImpl.buildJCRExpression method if I change &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (((filter.getScope() != null) &amp;amp;&amp;amp; (!filter.getScope().equals(&amp;quot;&amp;quot;)))) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jcrExp += &amp;quot;/jcr:root&amp;quot; + filter.getScope() + &amp;quot;element(&amp;quot; + filter.getNodeName() + &amp;quot;, &amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
to&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (((filter.getScope() != null) &amp;amp;&amp;amp; (!filter.getScope().equals(&amp;quot;&amp;quot;)))) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(filter.getNodeName().equals(&amp;quot;*&amp;quot;) &amp;amp;&amp;amp; !filter.getScope().equals(&amp;quot;//&amp;quot;))&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;filter.setScope(filter.getScope() + &amp;quot;/&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jcrExp += &amp;quot;/jcr:root&amp;quot; + filter.getScope() + &amp;quot;element(&amp;quot; + filter.getNodeName() + &amp;quot;, &amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
it works fine. Although this looks more like a hack to me but nevertheless all the test cases (including new one) pass.&lt;br/&gt;
&lt;br/&gt;
If there is a better way to accomplish this (not changing QueryManagerImpl code) then do let me know.</comment>
                    <comment id="12548658" author="kaizers" created="Wed, 5 Dec 2007 12:44:50 +0000"  >Changed the fix versions to 1.4 as this is quite critical part for my project</comment>
                </comments>
                    <attachments>
                    <attachment id="12370048" name="JCR-1198.zip" size="26461" author="kaizers" created="Thu, 22 Nov 2007 06:28:34 +0000" />
                    <attachment id="12371012" name="TestGetObjectsAnywhereInPath.patch" size="7434" author="kaizers" created="Wed, 5 Dec 2007 09:18:31 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 21 Nov 2007 22:21:22 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78633</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189934</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>