<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:57:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2009/JCR-2009.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2009] Large file download over webdav causes exception</title>
                <link>https://issues.apache.org/jira/browse/JCR-2009</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Downloading a large file (&amp;gt;2GB) from webdav causes an exception.&lt;br/&gt;
&lt;br/&gt;
(Note: uploading the file works ok, when jackrabbit is configured to use the filesystem DataStore.)&lt;br/&gt;
&lt;br/&gt;
When trying to retrieve the file with e.g. &amp;quot;wget&amp;quot;, we get the following error:&lt;br/&gt;
&lt;br/&gt;
Gozer:Desktop greg$ wget --http-user=xxx --http-passwd=xxx &lt;a href=&quot;http://localhost:8080/jackrabbit/repository/workbench/pkgs/demo/zip/zips/largetest-1.zip&quot;&gt;http://localhost:8080/jackrabbit/repository/workbench/pkgs/demo/zip/zips/largetest-1.zip&lt;/a&gt;&lt;br/&gt;
--08:59:50--  &lt;a href=&quot;http://localhost:8080/jackrabbit/repository/workbench/pkgs/demo/zip/zips/largetest-1.zip&quot;&gt;http://localhost:8080/jackrabbit/repository/workbench/pkgs/demo/zip/zips/largetest-1.zip&lt;/a&gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=&amp;gt; `largetest-1.zip&amp;#39;&lt;br/&gt;
Resolving localhost... done.&lt;br/&gt;
Connecting to localhost[127.0.0.1]:8080... connected.&lt;br/&gt;
HTTP request sent, awaiting response... 500 For input string: &amp;quot;3156213760&amp;quot;&lt;br/&gt;
09:04:53 ERROR 500: For input string: &amp;quot;3156213760&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
In the server log we see this:&lt;br/&gt;
&lt;br/&gt;
06.03.2009 08:59:50 *INFO * RepositoryImpl: SecurityManager = class org.apache.jackrabbit.core.security.simple.SimpleSecurityManager (RepositoryImpl.java, line 432)&lt;br/&gt;
2009-03-06 09:04:53.822::WARN:  /jackrabbit/repository/workbench/pkgs/demo/zip/zips/largetest-1.zip&lt;br/&gt;
java.lang.NumberFormatException: For input string: &amp;quot;3156213760&amp;quot;&lt;br/&gt;
	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)&lt;br/&gt;
	at java.lang.Integer.parseInt(Integer.java:459)&lt;br/&gt;
	at java.lang.Integer.parseInt(Integer.java:497)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.io.OutputContextImpl.setContentLength(OutputContextImpl.java:60)&lt;br/&gt;
	at org.apache.jackrabbit.server.io.ExportContextImpl.informCompleted(ExportContextImpl.java:192)&lt;br/&gt;
	at org.apache.jackrabbit.server.io.IOManagerImpl.exportContent(IOManagerImpl.java:157)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.simple.DavResourceImpl.spool(DavResourceImpl.java:332)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.spoolResource(AbstractWebdavServlet.java:422)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.doGet(AbstractWebdavServlet.java:388)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:229)&lt;br/&gt;
	at org.apache.jackrabbit.webdav.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:196)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:363)&lt;br/&gt;
	at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)&lt;br/&gt;
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)&lt;br/&gt;
	at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)&lt;br/&gt;
	at org.mortbay.jetty.Server.handle(Server.java:324)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:534)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:864)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:533)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:207)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:403)&lt;br/&gt;
	at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)&lt;br/&gt;
	at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:451)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The problem seems to lie in OutputContextImpl.java it makes the mistake of potentially trying to parse a Long as an Integer, here: &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/trunk/jackrabbit-webdav/src/main/java/org/apache/jackrabbit/webdav/io/OutputContextImpl.java&quot;&gt;http://svn.apache.org/repos/asf/jackrabbit/trunk/jackrabbit-webdav/src/main/java/org/apache/jackrabbit/webdav/io/OutputContextImpl.java&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
in the method setContentLength(long contentLength):&lt;br/&gt;
&lt;br/&gt;
public void setContentLength(long contentLength) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int length = Integer.parseInt(contentLength + &amp;quot;&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (length &amp;gt;= 0) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response.setContentLength(length);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m not sure, but a fix might be like this:&lt;br/&gt;
&lt;br/&gt;
public void setContentLength(long contentLength) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(contentLength &amp;lt;= Integer.MAX_VALUE &amp;amp;&amp;amp; contentLength &amp;gt;= 0) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response.setContentLength((int) contentLength);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else if (contentLength &amp;gt;  Integer.MAX_VALUE) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response.addHeader(&amp;quot;Content-Length&amp;quot;, Long.toString(contentLength));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
This would at least set the Content-Length header, and in some preliminary tests does seem to allow downloading the files.</description>
                <environment>Mac OS X 10.5.6, Java 1.5.0_16</environment>
            <key id="12416385">JCR-2009</key>
            <summary>Large file download over webdav causes exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="anchela">angela</assignee>
                                <reporter username="gschueler">Greg Schueler</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Mar 2009 05:28:34 +0000</created>
                <updated>Wed, 29 Apr 2009 08:50:32 +0100</updated>
                    <resolved>Thu, 12 Mar 2009 12:12:26 +0000</resolved>
                            <version>1.5.2</version>
                                <fixVersion>1.5.5</fixVersion>
                                <component>jackrabbit-webdav</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12681280" author="anchela" created="Thu, 12 Mar 2009 12:12:26 +0000"  >fixed as suggested (just added minor modifications and a simple test)&lt;br/&gt;
&lt;br/&gt;
thanks for reporting!</comment>
                    <comment id="12701537" author="jukkaz" created="Wed, 22 Apr 2009 15:14:24 +0100"  >Merged to the 1.5 branch in revision 767534. </comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 12 Mar 2009 12:12:26 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78357</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191249</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>