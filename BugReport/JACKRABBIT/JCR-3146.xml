<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:32:55 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3146/JCR-3146.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3146] Text extraction may congest thread pool in the repository</title>
                <link>https://issues.apache.org/jira/browse/JCR-3146</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Text extraction congests the thread pool in the repository when e.g. many PDFs are loaded into the workspace. Tasks submitted by the index merger are delayed because of that and will result in many index segment folders.</description>
                <environment></environment>
            <key id="12531317">JCR-3146</key>
            <summary>Text extraction may congest thread pool in the repository</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="alex.parvulescu">Alex Parvulescu</assignee>
                                <reporter username="alex.parvulescu">Alex Parvulescu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Nov 2011 13:36:31 +0000</created>
                <updated>Thu, 9 Feb 2012 19:29:17 +0000</updated>
                    <resolved>Tue, 15 Nov 2011 13:57:21 +0000</resolved>
                                            <fixVersion>2.2.12</fixVersion>
                <fixVersion>2.3.4</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13149630" author="alex.parvulescu" created="Mon, 14 Nov 2011 14:07:23 +0000"  >The solution is to define another queue for the tasks considered as low priority, so that they don&amp;#39;t fill the execution queue.&lt;br/&gt;
Then, depending on the executor&amp;#39;s load poll this queue for additional work items.&lt;br/&gt;
&lt;br/&gt;
The secondary queue will only be used as needed, and the load is configurable via the system property &lt;br/&gt;
&amp;quot;org.apache.jackrabbit.core.JackrabbitThreadPool.maxLoadForLowPriorityTasks&amp;quot;&lt;br/&gt;
This property is meant to be used as a percent. 0 means disabled / the default is 75.&lt;br/&gt;
&lt;br/&gt;
There are some timing issues with the indexing tests on account of this new async text extraction. I&amp;#39;ve tried to fix all of them, but there may be more.&lt;br/&gt;
&lt;br/&gt;
I haven&amp;#39;t touched yet on the tika extraction that happens in a different process. I think that will need some minor refactoring as well.&lt;br/&gt;
&lt;br/&gt;
Attaching proposed patch.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="13150424" author="mreutegg" created="Tue, 15 Nov 2011 12:25:31 +0000"  >In general looks good to me.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m not sure the communication between the threads in JackrabbitThreadPool&lt;br/&gt;
is 100% correct. E.g. the first statement in RetryLowPriorityTask.run()&lt;br/&gt;
checks if the queue is empty. To me it seems like this should never&lt;br/&gt;
happen, right?&lt;br/&gt;
&lt;br/&gt;
Style:&lt;br/&gt;
Should we rather keep the JackrabbitThreadPool package private and&lt;br/&gt;
only expose the marker as public interface? How about renaming&lt;br/&gt;
the LOW_PRIORITY_MARKER to LowPriorityTask and extend it from&lt;br/&gt;
Runnable? That way a client wouldn&amp;#39;t have to implement Runnable&lt;br/&gt;
and the marker interface.&lt;br/&gt;
&lt;br/&gt;
Minor:&lt;br/&gt;
&amp;nbsp;The method waitForTextExtractionTasksToFinish() already does an&lt;br/&gt;
index flush at the end. Aren&amp;#39;t the additional index flush calls&lt;br/&gt;
in IndexingQueueTest now obsolete?&lt;br/&gt;
</comment>
                    <comment id="13150450" author="alex.parvulescu" created="Tue, 15 Nov 2011 12:50:01 +0000"  >thanks for taking the time to review the patch&lt;br/&gt;
&lt;br/&gt;
&amp;gt; To me it seems like this should never happen, right? &lt;br/&gt;
yes, that is just premature optimization. I&amp;#39;ll remove it.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; Should we rather keep the JackrabbitThreadPool package private and only expose the marker as public interface?&lt;br/&gt;
you mean like moving the interface to the util package?&lt;br/&gt;
&lt;br/&gt;
&amp;gt; How about renaming the LOW_PRIORITY_MARKER to LowPriorityTask and extend it from Runnable?&lt;br/&gt;
that is a good idea&lt;br/&gt;
&lt;br/&gt;
&amp;gt; Aren&amp;#39;t the additional index flush calls in IndexingQueueTest now obsolete?&lt;br/&gt;
true. I had some issues with timing which are now hopefully fixed, so yes we can remove the extra flush&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="13150458" author="mreutegg" created="Tue, 15 Nov 2011 12:59:17 +0000"  >&amp;gt; you mean like moving the interface to the util package?&lt;br/&gt;
&lt;br/&gt;
no, I would still keep it in the same package as the JackrabbitThreadPool</comment>
                    <comment id="13150499" author="alex.parvulescu" created="Tue, 15 Nov 2011 13:57:21 +0000"  >fixed in rev:1202192</comment>
                    <comment id="13204760" author="jukkaz" created="Thu, 9 Feb 2012 19:29:17 +0000"  >Merged to the 2.2 branch in revision 1242468.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310040">
                <name>Required</name>
                                                <inwardlinks description="is required by">
                            <issuelink>
            <issuekey id="12531325">JCR-3147</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12503616" name="JCR-3146.patch" size="14031" author="alex.parvulescu" created="Mon, 14 Nov 2011 14:07:23 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 15 Nov 2011 12:25:31 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>217054</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>250202</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>