<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:37:45 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1775/JCR-1775.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1775] Transaction-safe versioning</title>
                <link>https://issues.apache.org/jira/browse/JCR-1775</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I&amp;#39;ve been working on a partial fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-630&quot; title=&quot;Versioning operations are not fully transactional&quot;&gt;JCR-630&lt;/a&gt;. Instead of implementing fully transactional versioning (i.e. a checkin will disappear when a transactin is rolled back), I&amp;#39;m ensuring that all versioning operations within a transaction will leave the version store in a consistent state even if the transaction otherwise fails at any point.</description>
                <environment></environment>
            <key id="12405231">JCR-1775</key>
            <summary>Transaction-safe versioning</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Sep 2008 13:00:52 +0100</created>
                <updated>Mon, 8 Dec 2008 11:09:42 +0000</updated>
                    <resolved>Tue, 7 Oct 2008 10:20:36 +0100</resolved>
                                            <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                <component>transactions</component>
                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12637426" author="jukkaz" created="Tue, 7 Oct 2008 10:20:36 +0100"  >Fixed in trunk. I have streamlined a number of the versioning operations and made sure that all versioning changes are persisted strictly before they get referenced in normal workspace content.</comment>
                    <comment id="12641319" author="ppakulski" created="Tue, 21 Oct 2008 10:42:39 +0100"  >I&amp;#39;ve created custom PM by simply overriding one method, to be able to track the sequence of stored changes :&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public synchronized void store(ChangeLog changeLog) throws ItemStateException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;super.store(changeLog);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log.warn(&amp;quot;STORE :&amp;quot; + getSchemaObjectPrefix() + &amp;quot;: &amp;quot; + changeLog);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Then I run checkout/checkin operation on single node :&lt;br/&gt;
&lt;br/&gt;
1) without transaction&lt;br/&gt;
&lt;br/&gt;
checkout&lt;br/&gt;
&lt;br/&gt;
11:12:17 WARN  STORE :D1V1R2_: {#addedStates=0, #modifiedStates=2, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
11:12:17 WARN  STORE :VERSION_: {#addedStates=0, #modifiedStates=0, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
&lt;br/&gt;
checkin&lt;br/&gt;
&lt;br/&gt;
11:12:17 WARN  STORE :VERSION_: {#addedStates=13, #modifiedStates=3, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
11:12:17 WARN  STORE :D1V1R2_: {#addedStates=0, #modifiedStates=3, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
11:12:17 WARN  STORE :VERSION_: {#addedStates=0, #modifiedStates=0, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
11:12:17 WARN  STORE :VERSION_: {#addedStates=0, #modifiedStates=0, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
&lt;br/&gt;
2) checkout/checkin in transaction&lt;br/&gt;
&lt;br/&gt;
11:13:57 WARN  STORE :D1V1R2_: {#addedStates=0, #modifiedStates=3, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
11:13:57 WARN  STORE :VERSION_: {#addedStates=0, #modifiedStates=0, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
11:13:57 WARN  STORE :VERSION_: {#addedStates=13, #modifiedStates=3, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
&lt;br/&gt;
Checkout/checkin in single JCR transaction still consist of 3 database level transactions, &lt;br/&gt;
&lt;br/&gt;
Moreover when using transactions, as you can see from the logs changes in workspace are persisted first before storing changes in the version storage.&lt;br/&gt;
&lt;br/&gt;
This is probably because of order of txResources in XASessionImpl class as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-631&quot; title=&quot;Change resources sequence during transaction commit.&quot;&gt;&lt;strike&gt;JCR-631&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12641325" author="ppakulski" created="Tue, 21 Oct 2008 10:49:58 +0100"  >D1V1R2 - is name of the workspace, VERSION is schemaObjectPrefix, i&amp;#39;m using MSSqlPersistenceManager</comment>
                    <comment id="12643780" author="jukkaz" created="Thu, 30 Oct 2008 08:22:46 +0000"  >The behaviour without transactions is as expected, even though it results in more store operations than would be optimal. The XA case is wrong, and I&amp;#39;ve been trying to address that.&lt;br/&gt;
&lt;br/&gt;
First I revisited my original plan of solving both the transaction issue and optimize the number of stores in versioning operations by moving the NodeReferences that point to the version store to the workspace persistence managers. This  would improve a number of things but breaks the backreference checks for example when deleting versions. I had an idea to resolve that issue but unfortunately it didn&amp;#39;t work out too well in practice.&lt;br/&gt;
&lt;br/&gt;
As a fallback I&amp;#39;m now solving just the XA case and leaving the multiple store operations in place.</comment>
                    <comment id="12644713" author="jukkaz" created="Mon, 3 Nov 2008 13:07:42 +0000"  >The XA case should also be fixed as of revision 710047. The sequence of saves for a checkin/checkout operation within an XA transaction is now:&lt;br/&gt;
&lt;br/&gt;
VERSION_: {#addedStates=14, #modifiedStates=3, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
DEFAULT_: {#addedStates=0, #modifiedStates=3, #deletedStates=0, #modifiedRefs=0}&lt;br/&gt;
VERSION_: {#addedStates=0, #modifiedStates=0, #deletedStates=0, #modifiedRefs=1}&lt;br/&gt;
&lt;br/&gt;
All tests (including a massive random/parallel test suite I ran over the weekend) pass.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                                <inwardlinks description="is part of">
                            <issuelink>
            <issuekey id="12355250">JCR-630</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 21 Oct 2008 09:42:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142850</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190244</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>