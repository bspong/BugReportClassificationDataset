<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:35:31 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2106/JCR-2106.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2106] SystemSessions created for GarbageCollector are not logged out of</title>
                <link>https://issues.apache.org/jira/browse/JCR-2106</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I have a simple garbage collection task that runs periodically. After upgrading to 1.5.5 it started logging a warning shortly after each run:&lt;br/&gt;
&lt;br/&gt;
2009-05-09 03:44:45,480 WARN [org.apache.jackrabbit.core.SessionImpl] - &amp;lt;Unclosed session detected. The session was opened here: &amp;gt;&lt;br/&gt;
java.lang.Exception: Stack Trace&lt;br/&gt;
	at org.apache.jackrabbit.core.SessionImpl.&amp;lt;init&amp;gt;(SessionImpl.java:239)&lt;br/&gt;
	at org.apache.jackrabbit.core.SystemSession.&amp;lt;init&amp;gt;(SystemSession.java:76)&lt;br/&gt;
	at org.apache.jackrabbit.core.SystemSession.create(SystemSession.java:64)&lt;br/&gt;
	at org.apache.jackrabbit.core.SessionImpl.createDataStoreGarbageCollector(SessionImpl.java:649)&lt;br/&gt;
&lt;br/&gt;
So it&amp;#39;s not my session, but an internally created SystemSession.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Code I&amp;#39;m using:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getTemplate().execute(new JcrCallback()&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public Object doInJcr(Session session)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throws IOException, RepositoryException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SessionImpl sessionImpl = (SessionImpl)session;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;GarbageCollector gc = sessionImpl.createDataStoreGarbageCollector();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;gc.scan();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;gc.stopScan();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;gc.deleteUnused();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return null;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}, true);&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12424953">JCR-2106</key>
            <summary>SystemSessions created for GarbageCollector are not logged out of</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tmueller">Thomas Mueller</assignee>
                                <reporter username="pkd">Peter Dettman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 May 2009 18:49:11 +0100</created>
                <updated>Wed, 5 Aug 2009 16:05:57 +0100</updated>
                    <resolved>Wed, 27 May 2009 11:21:46 +0100</resolved>
                            <version>1.5.5</version>
                                <fixVersion>1.5.7</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                          <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                    <timeestimate seconds="7200">2h</timeestimate>
                                  <comments>
                    <comment id="12707451" author="pkd" created="Fri, 8 May 2009 18:55:07 +0100"  >The attached patch for GarbageCollector logs out of the internal SystemSession objects when the user session has logged out, which resolves this for me locally.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12708027" author="tmueller" created="Mon, 11 May 2009 14:36:26 +0100"  >Committed in revision 773555 (trunk)&lt;br/&gt;
Thanks a lot for the patch!&lt;br/&gt;
</comment>
                    <comment id="12708135" author="pkd" created="Mon, 11 May 2009 18:55:25 +0100"  >You&amp;#39;re welcome... unfortunately the previous patch was not quite right. The GarbageCollector needs to keep a reference to the session listener or it may be garbage collected (the session only holds weak references to its listeners). I observed this actually occurring in testing on the latest build.&lt;br/&gt;
</comment>
                    <comment id="12708136" author="pkd" created="Mon, 11 May 2009 18:59:42 +0100"  >Patch against latest build (on top of previous patch). Stores the session listener in a field of GarbageCollector so that it is not collected.&lt;br/&gt;
&lt;br/&gt;
Also moves the closing of the system sessions from loggedOut() to loggingOut(); it seems more appropriate that the lifetime of those system sessions be bounded by the parent session.&lt;br/&gt;
</comment>
                    <comment id="12708452" author="tmueller" created="Tue, 12 May 2009 15:47:41 +0100"  >Hm, the GarbageCollector object could be garbage collected before the session is closed.&lt;br/&gt;
That means keeping a hard reference from the GarbageCollector to the listener&lt;br/&gt;
wouldn&amp;#39;t help, right?&lt;br/&gt;
&lt;br/&gt;
It looks like we need a new method GarbageCollector.close(), and a finalize() method&lt;br/&gt;
(in case people forgot to call close()).</comment>
                    <comment id="12711967" author="pkd" created="Fri, 22 May 2009 07:37:15 +0100"  >Ignore the 2nd patch, I&amp;#39;ve attached a 3rd that incorporates close/finalize as suggested.</comment>
                    <comment id="12713518" author="tmueller" created="Wed, 27 May 2009 11:21:46 +0100"  >Thanks a lot for the patch!&lt;br/&gt;
&lt;br/&gt;
Committed in revision 779084 (trunk)</comment>
                    <comment id="12731378" author="jukkaz" created="Wed, 15 Jul 2009 11:14:29 +0100"  >Merged to the 1.5 branch in revision 794213.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12382530">JCR-1216</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12407799" name="JCR-2106-2nd.patch" size="1698" author="pkd" created="Mon, 11 May 2009 18:59:42 +0100" />
                    <attachment id="12408778" name="JCR-2106-3rd.patch" size="2495" author="pkd" created="Fri, 22 May 2009 07:37:15 +0100" />
                    <attachment id="12407646" name="JCR-2106.patch" size="1733" author="pkd" created="Fri, 8 May 2009 18:55:07 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 11 May 2009 13:36:26 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>143005</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>280034</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>