<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:00:03 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1462/JCR-1462.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1462] repository.xml: throw an exception on error</title>
                <link>https://issues.apache.org/jira/browse/JCR-1462</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Currently, unsupported parameters in repository.xml and workspace.xml are ignored.&lt;br/&gt;
To find problems earlier, such problems should result in an exception,&lt;br/&gt;
and starting such a repository should not be possible.&lt;br/&gt;
The same should happen for unsupported values.&lt;br/&gt;
&lt;br/&gt;
For currently unavailable options&lt;br/&gt;
(such as text extraction filter classes if the class is not in the classpath),&lt;br/&gt;
at least a warning should be written to the error log, or an error should be thrown.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12390455">JCR-1462</key>
            <summary>repository.xml: throw an exception on error</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tmueller">Thomas Mueller</assignee>
                                <reporter username="tmueller">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Mar 2008 14:17:45 +0000</created>
                <updated>Mon, 8 Dec 2008 11:09:34 +0000</updated>
                    <resolved>Thu, 2 Oct 2008 16:34:18 +0100</resolved>
                                            <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12577465" author="tmueller" created="Tue, 11 Mar 2008 14:37:29 +0000"  >Committed in revision 635940.&lt;br/&gt;
This is a &amp;#39;proof of concept&amp;#39;; it logs a warning and does not throw an exception:&lt;br/&gt;
&lt;br/&gt;
&amp;quot;BeanConfig: org.apache.jackrabbit.core.fs.local.LocalFileSystem &lt;br/&gt;
does not support &amp;#39;abc&amp;#39;; the setting is ignored.&amp;quot;&lt;br/&gt;
when using&lt;br/&gt;
&amp;lt;FileSystem class=&amp;quot;org.apache.jackrabbit.core.fs.local.LocalFileSystem&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;abc&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;path&amp;quot; value=&amp;quot;${rep.home}/repository&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/FileSystem&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
Logging a warning could even be done in Jackrabbit 1.4.x I think.&lt;br/&gt;
If there are no problem I will change the code in a week or so to throw an exception.&lt;br/&gt;
</comment>
                    <comment id="12577480" author="mreutegg" created="Tue, 11 Mar 2008 15:28:23 +0000"  >I tend to agree that the repository should not start if a parameter is wrong. Though this means that existing configurations with errors will not upgrade smoothly, but I guess that&amp;#39;s OK.</comment>
                    <comment id="12579477" author="tmueller" created="Mon, 17 Mar 2008 15:12:11 +0000"  >Committed in revision 637933:&lt;br/&gt;
XML validation is now enabled when parsing configuration files.&lt;br/&gt;
However no exception is thrown if validation fails. Instead, a warning is&lt;br/&gt;
written to the log.</comment>
                    <comment id="12581918" author="mreutegg" created="Tue, 25 Mar 2008 13:18:17 +0000"  >I&amp;#39;m not happy with the current situation. Now that validation is enabled, there is a warn message in the log for every workspace.xml file we have. I&amp;#39;m not sure what causes it, but it&amp;#39;s probably the missing DTD in the workspace.xml files.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d rather want to see the initial idea implemented that the repository does not start up when there is an unknown parameter in the configuration. XML validation is IMO worth a different discussion.</comment>
                    <comment id="12581943" author="tmueller" created="Tue, 25 Mar 2008 13:46:43 +0000"  >&amp;gt; there is a warn message in the log for every workspace.xml file &lt;br/&gt;
Sorry, I didn&amp;#39;t see this... What about only logging a warning when parsing repository.xml?</comment>
                    <comment id="12581970" author="mreutegg" created="Tue, 25 Mar 2008 14:51:25 +0000"  >&amp;gt; What about only logging a warning when parsing repository.xml?&lt;br/&gt;
&lt;br/&gt;
I think that&amp;#39;s useful.</comment>
                    <comment id="12582001" author="tmueller" created="Tue, 25 Mar 2008 16:14:43 +0000"  >Revision 640880: throw an exception when using unsupported parameters</comment>
                    <comment id="12582003" author="tmueller" created="Tue, 25 Mar 2008 16:17:46 +0000"  >Revision 640884: log a warning when repository.xml can not be validated (but not for workspace.xml)</comment>
                    <comment id="12582203" author="mreutegg" created="Wed, 26 Mar 2008 09:35:02 +0000"  >IMO, this issue can be set to fixed.&lt;br/&gt;
&lt;br/&gt;
Thomas, do you want to implement anything else?</comment>
                    <comment id="12582206" author="tmueller" created="Wed, 26 Mar 2008 09:40:14 +0000"  >&amp;gt; do you want to implement anything else?&lt;br/&gt;
&lt;br/&gt;
Yes, throwing an exception instead of logging a warning if XML validation fails for repository.xml. That means, if there is an unknown tag in repository.xml. I would like to wait a week before doing that.&lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
Thomas&lt;br/&gt;
</comment>
                    <comment id="12629469" author="tmueller" created="Tue, 9 Sep 2008 13:19:46 +0100"  >This patch enables validation, and detects duplicate entries.&lt;br/&gt;
Before this patch is applied, the patch for bug&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1718&quot;&gt;https://issues.apache.org/jira/browse/JCR-1718&lt;/a&gt;&lt;br/&gt;
must be applied.</comment>
                    <comment id="12633175" author="tmueller" created="Mon, 22 Sep 2008 09:44:52 +0100"  >Committed in revision 697709</comment>
                    <comment id="12633868" author="mkwhitacre" created="Tue, 23 Sep 2008 21:07:22 +0100"  >I&amp;#39;m not sure I have permissions to reopen this bug but was advised to do so.  This bug seems to have introduced the requirement that all repository.xml files specify a DOCTYPE.  If you don&amp;#39;t have a doctype specified you start seeing SAX Parse exceptions like the following:&lt;br/&gt;
&lt;br/&gt;
org.xml.sax.SAXParseException: Document root element &amp;quot;Repository&amp;quot;,&lt;br/&gt;
must match DOCTYPE root &amp;quot;null&amp;quot;.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:236)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:172)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:382)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:316)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.rootElementSpecified(XMLDTDValidator.java:1652)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.handleStartElement(XMLDTDValidator.java:1931)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:795)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:878)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$ContentDispatcher.scanRootElementHook(XMLDocumentScannerImpl.java:1157)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1794)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:368)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:834)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:250)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:292)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.config.ConfigurationParser.parseXML(ConfigurationParser.java:215)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.config.RepositoryConfigurationParser.parseRepositoryConfig(RepositoryConfigurationParser.java:214)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.config.RepositoryConfig.create(RepositoryConfig.java:144)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.config.RepositoryConfig.create(RepositoryConfig.java:118)</comment>
                    <comment id="12633883" author="jukkaz" created="Tue, 23 Sep 2008 21:38:03 +0100"  >Reopened based on the last comment.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m not sure I see how much we are actually gaining by enabling DTD validation. Even any valid XHTML document would pass that test without Jackrabbit being any wiser. Validation would make much more sense if the DTD was specified by the configuration parser instead of the document being parsed.</comment>
                    <comment id="12634048" author="mreutegg" created="Wed, 24 Sep 2008 08:57:00 +0100"  >I think we should remove the DTD validation again.</comment>
                    <comment id="12634052" author="alexander.klimetschek" created="Wed, 24 Sep 2008 09:06:35 +0100"  >What about a two-pass parsing: in the first pass enable validation and log errors/warnings, but don&amp;#39;t stop and don&amp;#39;t build the internal config. Now in the second pass we disable validation and build the config, just as before.&lt;br/&gt;
&lt;br/&gt;
This way we at least print helpful errors on the console, without breaking the startup for still-working repository.xml files. WDYT?</comment>
                    <comment id="12634063" author="jukkaz" created="Wed, 24 Sep 2008 09:22:09 +0100"  >How about if we set the &lt;a href=&quot;http://apache.org/xml/features/validation/dynamic&quot;&gt;http://apache.org/xml/features/validation/dynamic&lt;/a&gt; option(see [1])? That should enable validation only when a DOCTYPE is present, which IMHO sounds like a good compromise.&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;http://xerces.apache.org/xerces2-j/features.html#validation.dynamic&quot;&gt;http://xerces.apache.org/xerces2-j/features.html#validation.dynamic&lt;/a&gt;</comment>
                    <comment id="12634071" author="jukkaz" created="Wed, 24 Sep 2008 10:19:03 +0100"  >Attached a proposed patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1462&quot; title=&quot;repository.xml: throw an exception on error&quot;&gt;&lt;strike&gt;JCR-1462&lt;/strike&gt;&lt;/a&gt;-dynamic.patch) that enables validation on all XML documents (including workspace.xml) when an explicit DOCTYPE is specified. This feature only works on Apache Xerces, so validation is simply disabled when some other parser is used.</comment>
                    <comment id="12634072" author="mreutegg" created="Wed, 24 Sep 2008 10:20:17 +0100"  >Is this option implementation independent?</comment>
                    <comment id="12634075" author="jukkaz" created="Wed, 24 Sep 2008 10:28:42 +0100"  >&amp;gt; Is this option implementation independent? &lt;br/&gt;
&lt;br/&gt;
No, it only works with Xerces. In the proposed patch I&amp;#39;m simply disabling validation if the parser does not support this feature.</comment>
                    <comment id="12634118" author="tmueller" created="Wed, 24 Sep 2008 13:05:32 +0100"  >&amp;gt; how much we are actually gaining by enabling DTD validation&lt;br/&gt;
&lt;br/&gt;
DTD validation is the easiest solution to detect typos in top level elements.&lt;br/&gt;
&lt;br/&gt;
Compatibility: Jackrabbit 1.5 will not work with 1.4 repository.xml files because of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1472&quot; title=&quot;extend security config -&amp;gt; repository-1.5.dtd&quot;&gt;&lt;strike&gt;JCR-1472&lt;/strike&gt;&lt;/a&gt; (SecurityManager). If we want to make the repository.xml backward compatible, we should have a look at that as well.&lt;br/&gt;
&lt;br/&gt;
factory.setFeature(&amp;quot;&lt;a href=&quot;http://apache.org/xml/features/validation/dynamic&quot;&gt;http://apache.org/xml/features/validation/dynamic&lt;/a&gt;&amp;quot;, true) is not supported in JDK 1.4 (JDK 1.5 is required). I guess we will anyway switch to JDK 1.5 soon, we could wait until then.&lt;br/&gt;
&lt;br/&gt;
What about only log (not throw) the exception until we can enable &amp;#39;dynamic validation&amp;#39;? I would just print warnings in the log file:&lt;br/&gt;
&lt;br/&gt;
24.09.2008 12:17:11 *WARN * [main] ConfigurationErrorHandler: Error parsing the configuration at line 23 using system id file:/C:/data/jackrabbit/jackrabbit-core/repository.xml: org.xml.sax.SAXParseException: Document root element &amp;quot;Repository&amp;quot;, must match DOCTYPE root &amp;quot;null&amp;quot;. (ConfigurationErrorHandler.java, line 44)&lt;br/&gt;
24.09.2008 12:17:11 *WARN * [main] ConfigurationErrorHandler: Error parsing the configuration at line 23 using system id file:/C:/data/jackrabbit/jackrabbit-core/repository.xml: org.xml.sax.SAXParseException: Document is invalid: no grammar found. (ConfigurationErrorHandler.java, line 44)&lt;br/&gt;
</comment>
                    <comment id="12636379" author="tmueller" created="Thu, 2 Oct 2008 16:34:18 +0100"  >Committed in revision 701158: only log a warning when not using a DTD</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                                <inwardlinks description="is related to">
                            <issuelink>
            <issuekey id="12395693">JCR-1582</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12389744" name="configPatch.txt" size="2785" author="tmueller" created="Tue, 9 Sep 2008 13:19:46 +0100" />
                    <attachment id="12390820" name="JCR-1462-dynamic.patch" size="4119" author="jukkaz" created="Wed, 24 Sep 2008 10:19:03 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 11 Mar 2008 15:28:23 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>97068</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279859</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>