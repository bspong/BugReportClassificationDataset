<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:56:44 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-952/JCR-952.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-952] Support lower and upper case functions in &quot;order by&quot; clause</title>
                <link>https://issues.apache.org/jira/browse/JCR-952</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The query languages should support lower- and upper-case functions within the &amp;quot;order by&amp;quot; clause.  This would provide case-insensitive ordering of query results.&lt;br/&gt;
&lt;br/&gt;
Example:  Find all &amp;quot;nt:base&amp;quot; nodes ordered by the &amp;quot;foo&amp;quot; property, but ignoring case&lt;br/&gt;
&lt;br/&gt;
In XPath:&lt;br/&gt;
&lt;br/&gt;
//element(*,nt:base) order by fn:lower-case(@foo)&lt;br/&gt;
&lt;br/&gt;
In SQL:&lt;br/&gt;
&lt;br/&gt;
SELECT * FROM nt:base ORDER BY lower(foo)&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12370468">JCR-952</key>
            <summary>Support lower and upper case functions in &quot;order by&quot; clause</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mduerig">Michael D&#252;rig</assignee>
                                <reporter username="jhang">James Hang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 May 2007 19:34:33 +0100</created>
                <updated>Tue, 8 Nov 2011 15:55:55 +0000</updated>
                    <resolved>Wed, 22 Dec 2010 14:32:50 +0000</resolved>
                            <version>1.3</version>
                                <fixVersion>2.3</fixVersion>
                                <component>jackrabbit-core</component>
                <component>query</component>
                        <due></due>
                    <votes>5</votes>
                        <watches>4</watches>
                                                    <comments>
                    <comment id="12769128" author="ddam" created="Fri, 23 Oct 2009 09:07:33 +0100"  >What I don&amp;#39;t understand is, why is this issue open for 2,5 years already? And why is it a minor issue? As far as I&amp;#39;m concerned, this is a major issue. Can this be easily solved?</comment>
                    <comment id="12769133" author="mreutegg" created="Fri, 23 Oct 2009 09:37:41 +0100"  >&amp;gt; What I don&amp;#39;t understand is, why is this issue open for 2,5 years already?&lt;br/&gt;
&lt;br/&gt;
because nobody provided a patch&lt;br/&gt;
&lt;br/&gt;
&amp;gt; And why is it a minor issue?&lt;br/&gt;
&lt;br/&gt;
because this is a feature that is not part of the JCR specification.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; As far as I&amp;#39;m concerned, this is a major issue.&lt;br/&gt;
&lt;br/&gt;
Feel free to contribute a patch.&lt;br/&gt;
&lt;br/&gt;
&amp;gt;  Can this be easily solved?&lt;br/&gt;
&lt;br/&gt;
It is actually solved already. At least partially. Using JQOM or JCR_SQL2 you already have the ability to use a lower/upper case function in the order by clause. XPath and SQL (the query syntax defined in JCR 1.0) do not support them yet.&lt;br/&gt;
&lt;br/&gt;
See classes LowerCaseSortComparator and UpperCaseSortComparator in jackrabbit-core. The parsers for XPath and SQL are in the module spi-commons.</comment>
                    <comment id="12769143" author="aschrijvers" created="Fri, 23 Oct 2009 10:18:32 +0100"  >Is there a usecase where people would like to sort case sensitive? If not, we could easily change the code snippet below, to first lowercase the terms. But, I am not sure whether we do want to have the option to sort case sensitive. &lt;br/&gt;
&lt;br/&gt;
In SharedFieldSortComparator :&lt;br/&gt;
&lt;br/&gt;
return new ScoreDocComparator() {&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public final int compare(final ScoreDoc i, final ScoreDoc j) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int idx1 = readerIndex(i.doc);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int idx2 = readerIndex(j.doc);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String iTerm = indexes[idx1].getTerm(i.doc - starts[idx1]);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String jTerm = indexes[idx2].getTerm(j.doc - starts[idx2]);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (iTerm == jTerm) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return 0;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else if (iTerm == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return -1;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else if (jTerm == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return 1;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return iTerm.compareTo(jTerm);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}</comment>
                    <comment id="12769170" author="mreutegg" created="Fri, 23 Oct 2009 11:45:06 +0100"  >I think there are use cases for both. But we cannot just change the current behaviour and redefine it. That might break existing clients.</comment>
                    <comment id="12769175" author="aschrijvers" created="Fri, 23 Oct 2009 12:01:21 +0100"  >Yes, agreed&lt;br/&gt;
</comment>
                    <comment id="12769178" author="ddam" created="Fri, 23 Oct 2009 12:05:35 +0100"  >What solution do you guys propose? Support for lower() and upper() functions in the order by clause, or perhaps the change proposed by  Ard, but then as an optional feature?</comment>
                    <comment id="12915623" author="alexkarpov" created="Tue, 28 Sep 2010 06:37:55 +0100"  >I have changed &lt;br/&gt;
\openjpa\openjpa-kernel\src\main\jjtree\org\apache\openjpa\kernel\jpql\JPQL.jjt&lt;br/&gt;
void orderby_extension() #ORDERBYEXTENSION : { }&lt;br/&gt;
{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;aggregate_select_expression()&lt;br/&gt;
}&lt;br/&gt;
to &lt;br/&gt;
void orderby_extension() #ORDERBYEXTENSION : { }&lt;br/&gt;
{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;aggregate_select_expression() | upper()&lt;br/&gt;
}&lt;br/&gt;
and it works &lt;br/&gt;
Developers, who knows code well, any potential problems I can meet due to my fix?&lt;br/&gt;
Thanks.</comment>
                    <comment id="12915672" author="jukkaz" created="Tue, 28 Sep 2010 09:28:08 +0100"  >&amp;gt; I have changed &lt;br/&gt;
&amp;gt;  \openjpa\openjpa-kernel\src\main\jjtree\org\apache\openjpa\kernel\jpql\JPQL.jjt &lt;br/&gt;
&lt;br/&gt;
Wrong issue?</comment>
                    <comment id="12915680" author="alexkarpov" created="Tue, 28 Sep 2010 10:23:58 +0100"  >Yep, sorry :)&lt;br/&gt;
</comment>
                    <comment id="12972560" author="mduerig" created="Fri, 17 Dec 2010 17:47:27 +0000"  >tentative patch. Needs cleanup and javadoc</comment>
                    <comment id="12974215" author="mduerig" created="Wed, 22 Dec 2010 14:32:50 +0000"  >Committed modified version of the patch at revision 1051916</comment>
                    <comment id="12974217" author="mduerig" created="Wed, 22 Dec 2010 14:35:15 +0000"  >XPath queries of the following form are now supported:&lt;br/&gt;
&lt;br/&gt;
//element(*,nt:base) order by fn:lower-case(@foo)&lt;br/&gt;
//element(*,nt:base) order by fn:upper-case(@foo)&lt;br/&gt;
&lt;br/&gt;
Meaning the property used for sorting is first converted to lower (upper) case before comparison takes place. &lt;br/&gt;
&lt;br/&gt;
</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10032">
                <name>Blocker</name>
                                <outwardlinks description="blocks">
                            <issuelink>
            <issuekey id="12493871">JCR-2854</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12466476" name="JCR-952.patch" size="16287" author="mduerig" created="Fri, 17 Dec 2010 17:47:27 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 23 Oct 2009 08:07:33 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>97812</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279662</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>