<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:50:09 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1395/JCR-1395.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1395] Use Commons IO 1.4</title>
                <link>https://issues.apache.org/jira/browse/JCR-1395</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Commons IO contains a number of utility classes and methods for working with files and streams. Many of those utilities would be quite useful in Jackrabbit, so I&amp;#39;d like to introduce commons-io 1.4 as a dependency to jackrabbit-core.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12388997">JCR-1395</key>
            <summary>Use Commons IO 1.4</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Feb 2008 12:34:13 +0000</created>
                <updated>Mon, 8 Dec 2008 11:09:33 +0000</updated>
                    <resolved>Fri, 29 Feb 2008 07:44:13 +0000</resolved>
                                            <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12570231" author="mreutegg" created="Tue, 19 Feb 2008 14:02:51 +0000"  >I think in general we should keep the number of dependencies as low as possible, but if there is a significant amount of code or complexity that we can remove from jackrabbit-core then I think we should do it.&lt;br/&gt;
&lt;br/&gt;
What kind of utilities are there that you think are useful?</comment>
                    <comment id="12570442" author="jukkaz" created="Tue, 19 Feb 2008 20:56:01 +0000"  >Attached is a quick example patch (io.patch) I put together based mostly on searching for InputStream use within jackrabbit-core. It should illustrate the kinds of benefits we&amp;#39;d see with code-io.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I think in general we should keep the number of dependencies as low as possible, but if there is a&lt;br/&gt;
&amp;gt; significant amount of code or complexity that we can remove from jackrabbit-core then I think we should do it.&lt;br/&gt;
&lt;br/&gt;
Agreed. Commons IO is probably a borderline case in that we can well live without it, but on the other hand it&amp;#39;s relatively small jar (about 100kB) and has no transitive dependencies, so the drawbacks aren&amp;#39;t that bad.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; What kind of utilities are there that you think are useful?&lt;br/&gt;
&lt;br/&gt;
Some examples:&lt;br/&gt;
&lt;br/&gt;
1) We have a number of places where we copy streams around using a loop with a temporary buffer. IOUtils.copy() could do such looping and low level buffering for us.&lt;br/&gt;
&lt;br/&gt;
2) We have quite a lot of code that manages temporary files for spooling streams. DeferredFileOutputStream is a perfect utility class for such needs.&lt;br/&gt;
&lt;br/&gt;
3) In a number of places we count the length of a stream. CountingInputStream and CountingOutputStream could do that for us.&lt;br/&gt;
&lt;br/&gt;
4) Even though I personally don&amp;#39;t like the idiom &amp;quot;if (stream != null) { try { stream.close(); } catch (IOException e) { } }&amp;quot; (I&amp;#39;d rather do just &amp;quot;stream.close()&amp;quot; and deal with any exceptions), it is quite widely used within Jackrabbit. IOUtils.closeQuietly(stream) does the same thing.&lt;br/&gt;
&lt;br/&gt;
5) The AutoCloseInputStream class would help us make sure that all streams we pass to a client will be properly closed when fully read or no longer used.&lt;br/&gt;
</comment>
                    <comment id="12570453" author="jukkaz" created="Tue, 19 Feb 2008 21:20:27 +0000"  >Just to avoid misunderstandings, I don&amp;#39;t prefer to apply the above patch as-is. It&amp;#39;s probably better to just introduce the Commons IO dependency, and then incrementally migrate the code to using it. A mass upgrade like the above patch risks introducing unintended errors to known-good code.</comment>
                    <comment id="12570455" author="tmueller" created="Tue, 19 Feb 2008 21:26:59 +0000"  >I also like to keep the number of dependencies as low as possible. Dependencies mean additional complexity because it means more work for a Jackrabbit user (installation), and because he could depend on a different version of the same library. This can be solved by &amp;#39;refactoring&amp;#39; the package name of the dependency (complex) or using special class loaders or OSGi (also very complex).&lt;br/&gt;
&lt;br/&gt;
I would prefer if we maintain our own utility classes. It is more work and also a bit risky (I don&amp;#39;t think it&amp;#39;s that bad actually), but easier for the user and less complex. One extreme is to have no dependencies (only depend on the JDK). I know some view it as &amp;#39;re-inventing the wheel&amp;#39; and they are right.&lt;br/&gt;
&lt;br/&gt;
If we don&amp;#39;t want to maintain our own utility classes (and I think we didn&amp;#39;t do a very good job at that so far), using Commons IO is a good solution. It&amp;#39;s much better than copy &amp;amp; paste source code. So adding Commons IO is OK for me.</comment>
                    <comment id="12570475" author="tripod" created="Tue, 19 Feb 2008 22:05:44 +0000"  >i agree with jukka that commons-io is a worthy dependency since it covers a lot of useful code that a I/O intensive application like jackrabbit needs.&lt;br/&gt;
&lt;br/&gt;
so +1 for adding commons-io as dependency and using where appropriate</comment>
                    <comment id="12571038" author="efranqueiro" created="Thu, 21 Feb 2008 13:26:28 +0000"  >I agree with Thomas that we don&amp;#39;t do a good job with maintaining the utility classes, and also we have som duplicated code (eg, in BundleDbPersistenceManager there&amp;#39;s a closeResultSet() method, and also a few direct calls to ResultSet.close(). The same happens with InputStream&amp;#39;s. I think we should have a common DbHelper with methods like close(ResultSet), close(Statement), close(Connection/ConnectionRecoveryManager) (that&amp;#39;s because I don&amp;#39;t like to call methods closeResultSet or closeSilently since it&amp;#39;s obvious by the signature). Like that, I think we should have a common StreamHelper. I don&amp;#39;t have a formed opinion on whether we should maintain them or if we should use another component, but we should definitely have one or the other. I&amp;#39;ll try to write a DbHelper class and patch for this.&lt;br/&gt;
Still, I think that some of examples mentioned by Jukka are actually very useful. In particular, I think that #5 would be very useful for the DbDataStore and the DbResources/DbInputStream I posted in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1388&quot; title=&quot;Jackrabbit does not allow concurrent reads to the data store if copyWhenReading=false&quot;&gt;&lt;strike&gt;JCR-1388&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12571441" author="efranqueiro" created="Fri, 22 Feb 2008 15:25:34 +0000"  >This patch replaces the calls to closing funcions and explicit calls to close() with a call to new unified closing functions. This is juast a PoC, and if there&amp;#39;s interest in pursuing this way, I can continue working on it. WDYT?</comment>
                    <comment id="12571509" author="efranqueiro" created="Fri, 22 Feb 2008 18:22:56 +0000"  >Same patch, but I deleted some methods but did not replace them. Also added some javadocs.</comment>
                    <comment id="12573626" author="jukkaz" created="Fri, 29 Feb 2008 07:44:13 +0000"  >Added the Commons IO dependency and applied a few of the more obvious code simplifications.&lt;br/&gt;
&lt;br/&gt;
Resolving as Fixed.</comment>
                </comments>
                    <attachments>
                    <attachment id="12375963" name="io.patch" size="62275" author="jukkaz" created="Tue, 19 Feb 2008 20:56:01 +0000" />
                    <attachment id="12376249" name="JCR-1395-closers.patch" size="47313" author="efranqueiro" created="Fri, 22 Feb 2008 18:22:56 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 19 Feb 2008 14:02:51 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142672</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279882</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>