<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:53:51 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1705/JCR-1705.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1705] Reduce memory usage of transient nodes</title>
                <link>https://issues.apache.org/jira/browse/JCR-1705</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When adding lots of transient nodes, most of them don&amp;#39;t have child nodes because they are leafs. The attached patch initializes NodeState.childNodeEntries with an unmodifiable empty ChildNodeEntries instance and turns it into a modifiable one only when needed.&lt;br/&gt;
&lt;br/&gt;
Running a test with 100k nodes (10 children per node) the memory consumption for child node entries drops from 42MB to 12MB with this patch.</description>
                <environment></environment>
            <key id="12401605">JCR-1705</key>
            <summary>Reduce memory usage of transient nodes</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Aug 2008 14:41:58 +0100</created>
                <updated>Mon, 8 Dec 2008 11:09:41 +0000</updated>
                    <resolved>Wed, 3 Sep 2008 14:11:57 +0100</resolved>
                                            <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12619522" author="jukkaz" created="Mon, 4 Aug 2008 15:09:34 +0100"  >+1 I like the way you got rid of many of the sharedChildNodeEntries conditionals!&lt;br/&gt;
&lt;br/&gt;
On the other hand, I don&amp;#39;t like that we add another special case to the already complex NodeState handling. But I guess cleaning up the NodeState class is a topic for another issue.</comment>
                    <comment id="12619524" author="stefan@jira" created="Mon, 4 Aug 2008 15:13:29 +0100"  >+1 for the patch, excellent :)</comment>
                    <comment id="12619540" author="efranqueiro" created="Mon, 4 Aug 2008 16:10:56 +0100"  >+1&lt;br/&gt;
I remember a few discussions about performance/memory consumption. We should get into that sometime, perhaps pre-1.5?&lt;br/&gt;
Also, like Jukka said, maybe we should try to clean up NodeState sometime :)&lt;br/&gt;
Regards,</comment>
                    <comment id="12619870" author="mreutegg" created="Tue, 5 Aug 2008 13:38:22 +0100"  >Based on Jukkas&amp;#39; comment I&amp;#39;ve refactored the NodeState class and pulled out the ChildNodeEntries and ChildNodeEntry classes. Instead of handling the shared child node entries in NodeState the ChildNodeEntries itself now know about when the internal maps are shared.&lt;br/&gt;
&lt;br/&gt;
Most of the patch is simply renaming NodeState.ChildNodeEntry to ChildNodeEntry, so don&amp;#39;t be shocked about the size of the patch ;)&lt;br/&gt;
&lt;br/&gt;
The memory saving is now a bit lower but still significant. With this patch the ChildNodeEntries consume 14MB.&lt;br/&gt;
&lt;br/&gt;
I think a similar approach is possible with the property names map.</comment>
                    <comment id="12620229" author="mreutegg" created="Wed, 6 Aug 2008 13:32:09 +0100"  >Updated patch to current trunk (ItemStates are not Serializable anymore) and introduced a NameSet, which works similar to the ChildNodeEntries. The new NameSet is used for the property names and the mixin type names inside a NodeState. The internal HashSet of a NameSet may be shared and/or obtained from a simple cache similar to HashCache introduced earlier in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1663&quot; title=&quot;REFERENCE properties produce duplicate strings in memory&quot;&gt;&lt;strike&gt;JCR-1663&lt;/strike&gt;&lt;/a&gt;.</comment>
                    <comment id="12620256" author="mreutegg" created="Wed, 6 Aug 2008 15:05:59 +0100"  >Once more, but now back to more readable size ;)&lt;br/&gt;
&lt;br/&gt;
The new patch only includes the memory improvements. Moving the child node entry classes has been solved in a separate issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1710&quot; title=&quot;Promote ChildNodeEntry and ChildNodeEntries to top level classes.&quot;&gt;&lt;strike&gt;JCR-1710&lt;/strike&gt;&lt;/a&gt;).</comment>
                    <comment id="12627720" author="jukkaz" created="Tue, 2 Sep 2008 16:58:26 +0100"  >+1 Looks great! I&amp;#39;m getting some impressive memory savings with this patch when importing large numbers of nodes through the transient space.</comment>
                    <comment id="12627989" author="mreutegg" created="Wed, 3 Sep 2008 14:11:57 +0100"  >Committed patch in revision: 691603&lt;br/&gt;
&lt;br/&gt;
Thank you all for reviewing.</comment>
                </comments>
                    <attachments>
                    <attachment id="12387642" name="JCR-1705.patch" size="28276" author="mreutegg" created="Wed, 6 Aug 2008 15:05:59 +0100" />
                    <attachment id="12387471" name="JCR-1705.patch" size="9463" author="mreutegg" created="Mon, 4 Aug 2008 14:42:50 +0100" />
                    <attachment id="12387634" name="JCR-1705-refactored.patch" size="124158" author="mreutegg" created="Wed, 6 Aug 2008 13:32:09 +0100" />
                    <attachment id="12387566" name="JCR-1705-refactored.patch" size="110105" author="mreutegg" created="Tue, 5 Aug 2008 13:38:22 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 4 Aug 2008 14:09:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142810</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279893</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>