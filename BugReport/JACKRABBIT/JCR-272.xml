<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:33:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-272/JCR-272.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-272] Removal of versions throws javax.jcr.ReferentialIntegrityException</title>
                <link>https://issues.apache.org/jira/browse/JCR-272</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>From the following thread : &lt;a href=&quot;http://www.mail-archive.com/jackrabbit-dev%40incubator.apache.org/msg03483.html&quot;&gt;http://www.mail-archive.com/jackrabbit-dev%40incubator.apache.org/msg03483.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
When trying to remove a version of a Node  the VersionHistory.removeVersion() method throws : &amp;quot;javax.jcr.ReferentialIntegrityException: Unable to remove version. At least once referenced.&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
Secton 8.2.2.10 (Removal of Versions) of the specification indicates that the version graph should be automatically repaired upon removal. Then, VersionHistory.removeVersion() should take care of references. (In fact, a user cannot alter the references (jcr:predecessors and jcr:successors), since they are protected properties.)&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s the example (*updated) :&lt;br/&gt;
&lt;br/&gt;
Node root1 = session.getRootNode() ;&lt;br/&gt;
Node test1 = root1.addNode(&amp;quot;test&amp;quot;) ;&lt;br/&gt;
test1.addMixin(&amp;quot;mix:versionable&amp;quot;);&lt;br/&gt;
test1.setProperty(&amp;quot;test&amp;quot;, &amp;quot;1&amp;quot;);&lt;br/&gt;
session.save();&lt;br/&gt;
test1.checkin();&lt;br/&gt;
&lt;br/&gt;
test1.checkout();&lt;br/&gt;
test1.setProperty(&amp;quot;test&amp;quot;, &amp;quot;2&amp;quot;);&lt;br/&gt;
session.save();&lt;br/&gt;
test1.checkin();&lt;br/&gt;
&lt;br/&gt;
test1.checkout();&lt;br/&gt;
test1.setProperty(&amp;quot;test&amp;quot;, &amp;quot;3&amp;quot;);&lt;br/&gt;
session.save();&lt;br/&gt;
test1.checkin();&lt;br/&gt;
&lt;br/&gt;
String baseVersion = test1.getBaseVersion().getName();&lt;br/&gt;
System.out.println(&amp;quot;Base version name: &amp;quot; + baseVersion);&lt;br/&gt;
&lt;br/&gt;
VersionHistory vh = test1.getVersionHistory();&lt;br/&gt;
for (VersionIterator vi = vh.getAllVersions(); vi.hasNext(); ) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Version currenVersion = vi.nextVersion();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String versionName = currenVersion.getName();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (!versionName.equals(&amp;quot;jcr:rootVersion&amp;quot;) &amp;amp;&amp;amp; !versionName.equals(baseVersion)) { &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String propertyValue = currenVersion.getNode(&amp;quot;jcr:frozenNode&amp;quot;).getProperty(&amp;quot;test&amp;quot;).getString();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(&amp;quot;Removing version : &amp;quot; + versionName + &amp;quot; with value: &amp;quot; + propertyValue);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;vh.removeVersion(versionName);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
Regards, &lt;br/&gt;
&lt;br/&gt;
Nicolas</description>
                <environment>CVS build (2005-11-16) and DerbyPersistenceManager</environment>
            <key id="12325829">JCR-272</key>
            <summary>Removal of versions throws javax.jcr.ReferentialIntegrityException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tripod">Tobias Bocanegra</assignee>
                                <reporter username="nic">Nicolas Belisle</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Nov 2005 12:59:09 +0000</created>
                <updated>Thu, 20 Jul 2006 11:25:22 +0100</updated>
                    <resolved>Thu, 20 Jul 2006 11:25:22 +0100</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                                <fixVersion>1.1</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>1</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12362423" author="jukkaz" created="Wed, 11 Jan 2006 18:04:17 +0000"  >Tagged for 1.0</comment>
                    <comment id="12422388" author="tripod" created="Thu, 20 Jul 2006 11:25:22 +0100"  >created new testcases:&lt;br/&gt;
&lt;br/&gt;
RemoveVersionTest&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Checks if all versions but the base and root one can be removed.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testRemoveAllBut2();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Checks if all versions by the base and root one can be removed.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testRemoveRootVersion();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Checks if all versions by the base and root one can be removed.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testRemoveBaseVersion();&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
and all succeed. i reckon this was fixed along the lines of some other versioning bugs.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 11 Jan 2006 18:04:17 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80404</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191217</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>