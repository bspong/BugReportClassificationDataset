<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:31:44 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2980/JCR-2980.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2980] Nodes that have properties marked for async extraction should be available for querying</title>
                <link>https://issues.apache.org/jira/browse/JCR-2980</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The problems only appears when dealing with nodes that have async extractors. In this case we return a lightweight copy of the node (without the property that will be processed in the background).&lt;br/&gt;
&lt;br/&gt;
The copy algorithm ignores certain field types (that have been probably introduced during the Lucene 3 upgrade, not sure) such as SingletonTokenStream(s).&lt;br/&gt;
So the lightweight copy does not include all the existing properties, therefore the node will not appear in queries during the extraction time.</description>
                <environment></environment>
            <key id="12508555">JCR-2980</key>
            <summary>Nodes that have properties marked for async extraction should be available for querying</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="alex.parvulescu">Alex Parvulescu</assignee>
                                <reporter username="alex.parvulescu">Alex Parvulescu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 May 2011 15:33:11 +0100</created>
                <updated>Fri, 23 Sep 2011 09:51:43 +0100</updated>
                    <resolved>Sun, 5 Jun 2011 05:49:08 +0100</resolved>
                            <version>2.3</version>
                                <fixVersion>2.2.8</fixVersion>
                                <component>indexing</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13040265" author="alex.parvulescu" created="Fri, 27 May 2011 15:51:49 +0100"  >fixed on trunk in rev 1128325&lt;br/&gt;
fixed on branch 2.2 in rev 1128329</comment>
                    <comment id="13042005" author="jukkaz" created="Wed, 1 Jun 2011 07:44:13 +0100"  >This change seems to introduce some regressions to the 2.2 branch, so reopening.&lt;br/&gt;
&lt;br/&gt;
See &lt;a href=&quot;https://builds.apache.org/job/Jackrabbit-2.2/1/org.apache.jackrabbit$jackrabbit-core/&quot;&gt;https://builds.apache.org/job/Jackrabbit-2.2/1/org.apache.jackrabbit$jackrabbit-core/&lt;/a&gt; for example build failures.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll revert the change from the 2.2 branch so I can proceed with the 2.2.7 release. We can do another 2.2.x release with this change once we&amp;#39;ve figured out the cause of the regression.</comment>
                    <comment id="13042010" author="jukkaz" created="Wed, 1 Jun 2011 08:02:07 +0100"  >Reverted from 2.2 in revision 1130018.</comment>
                    <comment id="13042219" author="alex.parvulescu" created="Wed, 1 Jun 2011 16:09:58 +0100"  >ouch, I&amp;#39;ve been looking at this all day and I can&amp;#39;t figure it out :)&lt;br/&gt;
&lt;br/&gt;
the extraction logic has changed a bit, also the lucene version, but still I can&amp;#39;t put my finger on it.&lt;br/&gt;
&lt;br/&gt;
I still think that the test was good enough to check what is going on in that small window when the processing happens, but adding the extra properties to the node copy seems to introduce some problems.&lt;br/&gt;
&lt;br/&gt;
also, apparently running the failing tests (IndexingAggregateTest.testNtFileAggregate and IndexingQueueTest.testInitialIndex) 2 times makes them pass, so I&amp;#39;d point to the sync logic between the extraction and current session, but I&amp;#39;m not sure.&lt;br/&gt;
&lt;br/&gt;
comments are always welcome</comment>
                    <comment id="13042236" author="jukkaz" created="Wed, 1 Jun 2011 16:32:52 +0100"  >Yep, I spent most of yesterday trying to understand the problem here and in the end had to just revert the change for now.&lt;br/&gt;
&lt;br/&gt;
We only upgraded to Lucene 3.0 in the trunk after 2.2 had already been branched (see &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2415&quot; title=&quot;Update Lucene to 3.0&quot;&gt;&lt;strike&gt;JCR-2415&lt;/strike&gt;&lt;/a&gt;), which is probably related to why the fix doesn&amp;#39;t work the same in the 2.2 branch as it does in trunk. However, I&amp;#39;m still at loss at why this seemingly innocent change is causing trouble for 2.2. </comment>
                    <comment id="13042299" author="jukkaz" created="Wed, 1 Jun 2011 18:17:29 +0100"  >Actually I just encountered this problem also on Jackrabbit trunk:&lt;br/&gt;
&lt;br/&gt;
testInitialIndex(org.apache.jackrabbit.core.query.lucene.IndexingQueueTest)  Time elapsed: 0.626 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;110&amp;gt; but was:&amp;lt;107&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.failNotEquals(Assert.java:282)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.assertEquals(Assert.java:64)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.assertEquals(Assert.java:136)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.assertEquals(Assert.java:142)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.IndexingQueueTest.testInitialIndex(IndexingQueueTest.java:127)&lt;br/&gt;
</comment>
                    <comment id="13044431" author="alex.parvulescu" created="Sun, 5 Jun 2011 05:40:34 +0100"  >I have finally figured it out. &lt;br/&gt;
It was my change that triggered this issue, in fact the TokenStream that I was passing to the node&amp;#39;s copy was not meant to be consumed more than once, so sometimes the copy consumed the data, leaving nothing else for the real node.&lt;br/&gt;
To be more exact, when the extraction was slow, it passed to the background. If this happened, the real node would loose its original data, because of the TokenStream.&lt;br/&gt;
&lt;br/&gt;
The fix was to add &amp;#39;reset&amp;#39; and &amp;#39;close&amp;#39; methods to the SingletonTokenStream, so that it can be consumed mode than once.</comment>
                    <comment id="13044433" author="alex.parvulescu" created="Sun, 5 Jun 2011 05:49:08 +0100"  >fixed on trunk in Revision 1131652&lt;br/&gt;
backported to 2.2 in Revision 1131653</comment>
                    <comment id="13044758" author="alex.parvulescu" created="Mon, 6 Jun 2011 10:29:58 +0100"  >I removed 2.2.7 as it is better to wait a bit and make sure that this time there are no more surprises :)&lt;br/&gt;
&lt;br/&gt;
It will be included in 2.2.8.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 1 Jun 2011 06:44:13 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>59629</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190825</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>