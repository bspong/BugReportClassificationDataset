<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:38:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-977/JCR-977.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-977] jcr:deref and parent axis in xpath predicates</title>
                <link>https://issues.apache.org/jira/browse/JCR-977</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Currently, the jcr:deref() function is not allowed in a xpath query predicate. Example :&lt;br/&gt;
book holds a reference property on its author(s)&lt;br/&gt;
authors have a name&lt;br/&gt;
&lt;br/&gt;
We want all books from a specific author :&lt;br/&gt;
&lt;br/&gt;
/jcr:root/element(*, bookType)[jcr:deref(@author, &amp;#39;authorType&amp;#39;)/@name = &amp;#39;King&amp;#39;]&lt;br/&gt;
&lt;br/&gt;
This fails with an InvalidQueryException currently (not supported).&lt;br/&gt;
&lt;br/&gt;
The error is raised in the XPathQueryBuilder class, in function : private QueryNode createFunction(SimpleNode node, QueryNode queryNode), in the block :&lt;br/&gt;
else if (NameFormat.format(JCR_DEREF, resolver).equals(fName))&lt;br/&gt;
&lt;br/&gt;
Problem is that with this query, when evaluating the jcr:deref() function, then in this method at this point, queryNode.getType() is 0 and tests raise the exception if queryNode.getType() is neither QueryNode.TYPE_LOCATION nor QueryNode.TYPE_PATH.&lt;br/&gt;
&lt;br/&gt;
I think this is a useful place to put a deref function in a query, as I don&amp;#39;t know how we could test the referenced node properties another way.&lt;br/&gt;
&lt;br/&gt;
Frederic Esnault</description>
                <environment>n/a</environment>
            <key id="12372201">JCR-977</key>
            <summary>jcr:deref and parent axis in xpath predicates</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mreutegg">Marcel Reutegger</assignee>
                                <reporter username="vk_phoenixfr">Frederic Esnault</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jun 2007 10:39:40 +0100</created>
                <updated>Mon, 2 Nov 2009 14:27:32 +0000</updated>
                    <resolved>Fri, 10 Jul 2009 12:54:30 +0100</resolved>
                                            <fixVersion>2.0-alpha4</fixVersion>
                                <component>jackrabbit-core</component>
                <component>jackrabbit-spi-commons</component>
                <component>query</component>
                        <due></due>
                    <votes>2</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12726220" author="dandiep" created="Wed, 1 Jul 2009 21:45:23 +0100"  >Here&amp;#39;s a first stab at this. Needs cleanup, but the important part is it works. :-)</comment>
                    <comment id="12726962" author="mreutegg" created="Fri, 3 Jul 2009 14:35:33 +0100"  >Good work, thanks a lot for the patch.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve reviewed the patch an reworked it a bit. Streamlined some of the code and fixed a bug in LuceneQueryBuilder.&lt;br/&gt;
&lt;br/&gt;
Dan, what do you think?</comment>
                    <comment id="12726963" author="mreutegg" created="Fri, 3 Jul 2009 14:36:14 +0100"  >Also affect spi-commons.</comment>
                    <comment id="12727770" author="dandiep" created="Mon, 6 Jul 2009 21:38:51 +0100"  >Thanks Marcel! Looks good, although I haven&amp;#39;t had time to upgrade to the 2.x tree and really test it out. Are you going to put this into 2.x?</comment>
                    <comment id="12727968" author="mreutegg" created="Tue, 7 Jul 2009 08:48:37 +0100"  >&amp;gt; Are you going to put this into 2.x?&lt;br/&gt;
&lt;br/&gt;
yes, this will go into 2.0.0&lt;br/&gt;
&lt;br/&gt;
Applied patch in revision: 791737&lt;br/&gt;
&lt;br/&gt;
Thanks again for your help.</comment>
                    <comment id="12728723" author="mreutegg" created="Wed, 8 Jul 2009 15:32:29 +0100"  >Fixed a bug in PredicateDerefQuery in revision: 792162</comment>
                    <comment id="12729613" author="mreutegg" created="Fri, 10 Jul 2009 12:43:12 +0100"  >There are some issues with the changes related to XPath QueryFormat.</comment>
                    <comment id="12729616" author="mreutegg" created="Fri, 10 Jul 2009 12:54:30 +0100"  >Fixed in revision: 792894</comment>
                    <comment id="12772520" author="mreutegg" created="Mon, 2 Nov 2009 14:27:32 +0000"  >Adjusted summary.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310000">
                <name>Duplicate</name>
                                                <inwardlinks description="is duplicated by">
                            <issuelink>
            <issuekey id="12398694">JCR-1659</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12412497" name="deref.patch" size="60492" author="mreutegg" created="Fri, 3 Jul 2009 14:35:33 +0100" />
                    <attachment id="12412315" name="deref.patch" size="54327" author="dandiep" created="Wed, 1 Jul 2009 21:45:23 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 1 Jul 2009 20:45:23 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142461</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190056</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>