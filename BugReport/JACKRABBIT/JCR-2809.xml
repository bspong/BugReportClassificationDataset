<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:41:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2809/JCR-2809.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2809] Lock expires almost immediately</title>
                <link>https://issues.apache.org/jira/browse/JCR-2809</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When a timeoutHint other than Long.MAX_VALUE is given to the javax.jcr.lock.LockManager API:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;lock(String absPath, boolean isDeep, boolean isSessionScoped, long timeoutHint, String ownerInfo)&lt;br/&gt;
&lt;br/&gt;
a timeoutTime in seconds will be computed as follows (o.a.j.core.lock.LockInfo#updateTimeoutTime):&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;long now = (System.currentTimeMillis() + 999) / 1000; // round up&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;this.timeoutTime = now + timeoutHint;&lt;br/&gt;
&lt;br/&gt;
the TimeoutHandler in o.a.j.core.lock.LockManagerImpl running every second will then check whether the timeout has expired (o.a.j.core.lock.LockInfo#isExpired):&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public boolean isExpired() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return timeoutTime != Long.MAX_VALUE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;amp;&amp;amp; timeoutTime * 1000 &amp;gt; System.currentTimeMillis();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Obviously, the latter condition is true from the very beginning. Replacing &amp;#39;&amp;gt;&amp;#39; with &amp;#39;&amp;lt;&amp;#39; or &amp;#39;&amp;lt;=&amp;#39; should do the trick.</description>
                <environment></environment>
            <key id="12479611">JCR-2809</key>
            <summary>Lock expires almost immediately</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tmueller">Thomas Mueller</assignee>
                                <reporter username="dpfister">Dominique Pfister</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Nov 2010 17:47:06 +0000</created>
                <updated>Fri, 23 Sep 2011 15:23:06 +0100</updated>
                    <resolved>Thu, 11 Nov 2010 15:23:39 +0000</resolved>
                            <version>2.1.2</version>
                                <fixVersion>2.2</fixVersion>
                                <component>locks</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12930841" author="tripod" created="Wed, 10 Nov 2010 23:45:03 +0000"  >or swapping the expressions for better understanding:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public boolean isExpired() { &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return timeoutTime != Long.MAX_VALUE &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;amp;&amp;amp; System.currentTimeMillis() &amp;gt; timeoutTime * 1000;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} &lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12930956" author="fmeschbe" created="Thu, 11 Nov 2010 08:12:58 +0000"  >And why not keep the timeout as ms internally to prevent the repeated multiplication by 1000 ? </comment>
                    <comment id="12930968" author="tmueller" created="Thu, 11 Nov 2010 10:06:48 +0000"  >I agree with Felix, repeated multiplication by 1000 could be avoided.&lt;br/&gt;
&lt;br/&gt;
There are more bugs it seems: &lt;br/&gt;
&lt;br/&gt;
- there is a space missing in the toString() representation&lt;br/&gt;
&lt;br/&gt;
- the lock timeout is ignored when using XA - is this on purpose?</comment>
                    <comment id="12930980" author="tmueller" created="Thu, 11 Nov 2010 10:43:24 +0000"  >There is one more bug when using XA: the timeout time (when will it expire since 1970) is used as the timeout hint (number of seconds until it expires). But anyway the timeout was ignored when using XA.</comment>
                    <comment id="12930982" author="tmueller" created="Thu, 11 Nov 2010 10:46:16 +0000"  >The existing ConcurrentLocking* tests are not included in TestAll. I don&amp;#39;t know the reason, it looks like a bug (why having tests if they are not used). I will add them unless somebody objects.</comment>
                    <comment id="12930985" author="tmueller" created="Thu, 11 Nov 2010 10:56:34 +0000"  >Proposed patch</comment>
                    <comment id="12931042" author="tmueller" created="Thu, 11 Nov 2010 15:23:39 +0000"  >Fixed in the trunk</comment>
                </comments>
                    <attachments>
                    <attachment id="12459338" name="jcr-2809-lockTimeout.patch" size="9293" author="tmueller" created="Thu, 11 Nov 2010 10:56:34 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 10 Nov 2010 23:45:03 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>59540</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190982</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>