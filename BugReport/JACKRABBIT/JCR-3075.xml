<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:37:23 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3075/JCR-3075.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3075] incorrect HTML excerpt generation for queries on japanese text content </title>
                <link>https://issues.apache.org/jira/browse/JCR-3075</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The generated excerpt highlights single characters instead of full words. Test case (to be added to FullTextQueryTest):&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testJapaneseAndHighlight() throws RepositoryException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// &lt;a href=&quot;http://translate.google.com/#auto&quot;&gt;http://translate.google.com/#auto&lt;/a&gt;|en|%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%88&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String jContent = &amp;quot;\u30b3\u30fe\u30c6\u30f3\u30c8&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// &lt;a href=&quot;http://translate.google.com/#auto&quot;&gt;http://translate.google.com/#auto&lt;/a&gt;|en|%E3%83%86%E3%82%B9%E3%83%88&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String jTest = &amp;quot;\u30c6\u30b9\u30c8&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String content = &amp;quot;some text with japanese: &amp;quot; + jContent&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ &amp;quot; (&amp;#39;content&amp;#39;)&amp;quot; + &amp;quot; and &amp;quot; + jTest + &amp;quot; (&amp;#39;test&amp;#39;).&amp;quot;;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// expected excerpt; note this may change if excerpt providers change&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String expectedExcerpt = &amp;quot;&amp;lt;div&amp;gt;&amp;lt;span&amp;gt;some text with japanese: &amp;quot; + jContent&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ &amp;quot; (&amp;#39;content&amp;#39;) and &amp;lt;strong&amp;gt;&amp;quot; + jTest&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ &amp;quot;&amp;lt;/strong&amp;gt; (&amp;#39;test&amp;#39;).&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Node n = testRootNode.addNode(&amp;quot;node1&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;n.setProperty(&amp;quot;title&amp;quot;, content);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;testRootNode.getSession().save();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String xpath = &amp;quot;/jcr:root&amp;quot; + testRoot + &amp;quot;/element(*, nt:unstructured)&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;+ &amp;quot;[jcr:contains(., &amp;#39;&amp;quot; + jTest + &amp;quot;&amp;#39;)]/rep:excerpt(.)&amp;quot;;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Query q = superuser.getWorkspace().getQueryManager()&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.createQuery(xpath, Query.XPATH);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;QueryResult qr = q.execute();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;RowIterator it = qr.getRows();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int cnt = 0;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while (it.hasNext()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cnt++;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Row found = it.nextRow();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(n.getPath(), found.getPath());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String excerpt = found.getValue(&amp;quot;rep:excerpt(.)&amp;quot;).getString();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(expectedExcerpt, excerpt);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(1, cnt);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12523336">JCR-3075</key>
            <summary>incorrect HTML excerpt generation for queries on japanese text content </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="alex.parvulescu">Alex Parvulescu</assignee>
                                <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2011 15:20:46 +0100</created>
                <updated>Tue, 8 Nov 2011 15:47:02 +0000</updated>
                    <resolved>Wed, 21 Sep 2011 16:28:20 +0100</resolved>
                                            <fixVersion>2.0.5</fixVersion>
                <fixVersion>2.1.6</fixVersion>
                <fixVersion>2.2.9</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13108009" author="alex.parvulescu" created="Mon, 19 Sep 2011 18:24:41 +0100"  >hmm, it would appear that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2458&quot; title=&quot;queryparser makes all CJK queries phrase queries regardless of analyzer&quot;&gt;&lt;strike&gt;LUCENE-2458&lt;/strike&gt;&lt;/a&gt; [0] has something to do with this. &lt;br/&gt;
(it treats the 1 word made out of 3 character sequence as a phrase of 3 words made of 1 char each).&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m not sure what is the best way forward. Upgrading lucene to 3.1 maybe?&lt;br/&gt;
I don&amp;#39;t think it&amp;#39;s just a drop-in replacement, I tried and there are some errors on the repo startup.&lt;br/&gt;
&lt;br/&gt;
This brings the question about the lucene version that JR is using, which seems to be really behind. We probably should try to update more often, but that is a different topic of discussion.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
[0] &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2458&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-2458&lt;/a&gt;&lt;br/&gt;
</comment>
                    <comment id="13109427" author="alex.parvulescu" created="Wed, 21 Sep 2011 13:12:50 +0100"  >this problem also affects excerpt generation for any quoted phrase search, not just japanese.&lt;br/&gt;
Normally a quoted phrase should be considered as only one item when building the excerpt.&lt;br/&gt;
&lt;br/&gt;
Now, because of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2458&quot; title=&quot;queryparser makes all CJK queries phrase queries regardless of analyzer&quot;&gt;&lt;strike&gt;LUCENE-2458&lt;/strike&gt;&lt;/a&gt;, a normal search using japanese turns into the equivalent of quoted search in let&amp;#39;s say english.&lt;br/&gt;
So because the excerpt generator has issues dealing with phrases, then any japanese search would have each character of the search token highlighted, instead of just one highlight containing the whole word.&lt;br/&gt;
&lt;br/&gt;
The patch should fix both the original issue, and highlighting for any quoted search.&lt;br/&gt;
The problem is there is one test failing and I&amp;#39;m not sure why :(&lt;br/&gt;
&lt;br/&gt;
The failing test is ExcerptTest#testEncodeIllegalCharsNoHighlights, which apparently fails because there is more info on the node returned from the search than expected.&lt;br/&gt;
This should not happen, as I haven&amp;#39;t touched that part of the code (node indexing), but sadly it does so I still need to investigate.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d also welcome some feedback on the approach.</comment>
                    <comment id="13109519" author="reschke" created="Wed, 21 Sep 2011 15:15:08 +0100"  >ExcerptTest#testEncodeIllegalCharsNoHighlights fails because it switched from testing excerpt(text) to excerpt(.). &lt;br/&gt;
&lt;br/&gt;
Other than that the new tests look good. I know next to nothing about Lucene, but if the code fixes the new tests while not breaking anything old, then this should probably go in.&lt;br/&gt;
&lt;br/&gt;
Thanks for taking over!</comment>
                    <comment id="13109523" author="alex.parvulescu" created="Wed, 21 Sep 2011 15:24:28 +0100"  >thanks Julian for going through the patch and identifying the problem. (as usual, it was me who broke the test ;)&lt;br/&gt;
&lt;br/&gt;
ok, I added some more tests to the suite, tweaked a little bit more.&lt;br/&gt;
It turns out the previous patch did not preserve the token order for a phrase query, which is not good.&lt;br/&gt;
&lt;br/&gt;
So now all the tests pass.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll probably commit this soon, but I&amp;#39;ll add v2 it here too, just to keep track. &lt;br/&gt;
</comment>
                    <comment id="13109573" author="alex.parvulescu" created="Wed, 21 Sep 2011 16:26:02 +0100"  >fixed on trunk in revision #1173694 and #1173707.&lt;br/&gt;
backported to 2.2 in revision #1173706.&lt;br/&gt;
&lt;br/&gt;
I had to tweak the trunk code (rev #1173707) because there were some changes in the lucene api, and I wanted to have the same code on both trunk and the 2.2 branch.&lt;br/&gt;
</comment>
                    <comment id="13113321" author="jukkaz" created="Fri, 23 Sep 2011 11:54:49 +0100"  >Merged to the 2.1 branch in revision 1174630 and to 2.0 in revision 1174642.</comment>
                </comments>
                    <attachments>
                    <attachment id="12495349" name="JCR-3075.patch" size="16373" author="alex.parvulescu" created="Wed, 21 Sep 2011 13:12:50 +0100" />
                    <attachment id="12495368" name="JCR-3075-v2.patch" size="20941" author="alex.parvulescu" created="Wed, 21 Sep 2011 15:24:28 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 19 Sep 2011 17:24:41 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>59620</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>250241</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>