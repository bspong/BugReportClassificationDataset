<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:49:12 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-349/JCR-349.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-349] New node type namespaces should be automatically registered</title>
                <link>https://issues.apache.org/jira/browse/JCR-349</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>A user currently needs to explicitly register any new namespaces used in new node types before registering the node types. See for example the problem on the mailing list:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/incubator-jackrabbit-dev/200603.mbox/%3c1142091097.13136.0.camel@localhost.localdomain%3e&quot;&gt;http://mail-archives.apache.org/mod_mbox/incubator-jackrabbit-dev/200603.mbox/%3c1142091097.13136.0.camel@localhost.localdomain%3e&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
The node type registration should be changed so that new namespaces are automatically registered.</description>
                <environment></environment>
            <key id="12330190">JCR-349</key>
            <summary>New node type namespaces should be automatically registered</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Sun, 12 Mar 2006 16:59:22 +0000</created>
                <updated>Fri, 13 Oct 2006 17:03:08 +0100</updated>
                    <resolved>Sun, 23 Apr 2006 06:49:30 +0100</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                                <fixVersion>1.1</fixVersion>
                                <component>config</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12375423" author="davek2" created="Fri, 21 Apr 2006 03:33:10 +0100"  >&amp;quot;Jukka Zitting&amp;quot; &amp;lt;&lt;a href=&apos;mailto:jukka.zitting@gmail.com&apos;&gt;jukka.zitting@gmail.com&lt;/a&gt;&amp;gt; wrote on 04/20/2006 12:29:23 PM:&lt;br/&gt;
&lt;br/&gt;
&amp;gt; Hi,&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; On 4/20/06, David Kennedy &amp;lt;&lt;a href=&apos;mailto:davek@us.ibm.com&apos;&gt;davek@us.ibm.com&lt;/a&gt;&amp;gt; wrote:&lt;br/&gt;
&amp;gt; &amp;gt; Attached is a patch (I&amp;#39;m not sure how you typically like to receive patches) for&lt;br/&gt;
&amp;gt; &amp;gt; the automatic registration of namespaces on import of xml or cnd nodetype&lt;br/&gt;
&amp;gt; &amp;gt; files (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-349&quot; title=&quot;New node type namespaces should be automatically registered&quot;&gt;&lt;strike&gt;JCR-349&lt;/strike&gt;&lt;/a&gt;).&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Excellent, thanks!&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;gt; I didn&amp;#39;t want the readers to have knowledge of workspaces or registries so&lt;br/&gt;
&amp;gt; &amp;gt; I basically added additional methods to the NodeTypeManagerImpl that would&lt;br/&gt;
&amp;gt; &amp;gt; take a registry in which the namespaces should be registered.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; How about adding the namespace registry as a private member variable&lt;br/&gt;
&amp;gt; of the NodeTypeManagerImpl class and have SessionImpl pass the&lt;br/&gt;
&amp;gt; namespace registry to the node type manager as a constructor argument?&lt;br/&gt;
&amp;gt; This way the registry handling would be completely transparent to the&lt;br/&gt;
&amp;gt; user and they could just continue using the existing methods.&lt;br/&gt;
&lt;br/&gt;
Yeah, I started out this way, but wasn&amp;#39;t sure you&amp;#39;d want the registration to be the default behavior&lt;br/&gt;
&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;gt; The code will ignore a namespace if it has already been registered (I can change&lt;br/&gt;
&amp;gt; &amp;gt; it to throw an exception if the registered uri is different than what&amp;#39;s in the file).&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; This is a good approach. BTW, instead of checking for the prefix you&lt;br/&gt;
&amp;gt; should be checking for the availability of the namespace URI. The&lt;br/&gt;
&amp;gt; process should be something like this:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;     if URI is not already registered, then&lt;br/&gt;
&amp;gt;         while PREFIX is already registered, do&lt;br/&gt;
&amp;gt;             generate another PREFIX&lt;br/&gt;
&amp;gt;         end while&lt;br/&gt;
&amp;gt;         register the PREFIX -&amp;gt; URI mapping&lt;br/&gt;
&amp;gt;     end if&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t follow the &amp;quot;generate another PREFIX&amp;quot;.  I changed the code to check for the uri, but if the uri isn&amp;#39;t found, I just try to register the prefix to uri.....if the prefix is already registered to a different uri, we&amp;#39;ll get an exception which is what we want.  If the prefix isn&amp;#39;t registered, we&amp;#39;re good to go.  Let me know if I&amp;#39;m missing something.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; It&amp;#39;s a bit cumbersome, especially since the getPrefix() and getURI()&lt;br/&gt;
&amp;gt; methods throw exceptions to indicate unregistered mappings, *and* it&lt;br/&gt;
&amp;gt; isn&amp;#39;t thread-safe, but this is the best we have at the moment. Perhaps&lt;br/&gt;
&amp;gt; we could encapsulate this functionality into a custom&lt;br/&gt;
&amp;gt; NamespaceRegistryImpl method...&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;gt; I&amp;#39;ve also included a test for each type of file.  The tests will fail if run a second&lt;br/&gt;
&amp;gt; &amp;gt; time against the same repository, but not because of the namespace registration,&lt;br/&gt;
&amp;gt; &amp;gt; but because the nodetypes already exist.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Yeah, that&amp;#39;s a problem with the fact that we currently can&amp;#39;t modify or&lt;br/&gt;
&amp;gt; even remove existing node types without manual intervention. I think&lt;br/&gt;
&amp;gt; it&amp;#39;s ok at the moment to just disable the test cases with a logged&lt;br/&gt;
&amp;gt; warning if the conflicting node types already exist.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;gt; This brings up another suggestion.  What do you think about an enhancement in&lt;br/&gt;
&amp;gt; &amp;gt; which we add another registerNodeTypes method which takes a flag to determine&lt;br/&gt;
&amp;gt; &amp;gt; whether it should bypass existing registeredNodeTypes?  This would permit the&lt;br/&gt;
&amp;gt; &amp;gt; user/developers to run their code that imports the same nodetypes without having&lt;br/&gt;
&amp;gt; &amp;gt; to clean out the registries.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; This functionality would probably be a good fit for a&lt;br/&gt;
&amp;gt; reregisterNodeTypes method. See &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-322&quot; title=&quot;Support node type modification and removal&quot;&gt;JCR-322&lt;/a&gt; for background.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;gt; Let me know what you think and if you&amp;#39;d like patches in a different format.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Looks good. Can you fix the issues I mentioned (ns registry as member&lt;br/&gt;
&amp;gt; variable, and the namespace registration process)?&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; I can use the zip format, but a more convenient alternative would be&lt;br/&gt;
&amp;gt; the output of &amp;quot;svn diff&amp;quot;. Quick steps to do this:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;  1) Checkout the latest sources from SVN as instructed on the&lt;br/&gt;
&amp;gt; Jackrabbit web site&lt;br/&gt;
&amp;gt;  2) Make your modifications&lt;br/&gt;
&amp;gt;  3) Use &amp;quot;svn add ...&amp;quot; to mark any new files and directories you&amp;#39;ve added&lt;br/&gt;
&amp;gt;  4) use &amp;quot;svn diff&amp;quot; from the main jackrabbit directory to get a listing&lt;br/&gt;
&amp;gt; of all the changes&lt;br/&gt;
&amp;gt;  5) Save the output in a file and attach it to the Jira issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-349&quot; title=&quot;New node type namespaces should be automatically registered&quot;&gt;&lt;strike&gt;JCR-349&lt;/strike&gt;&lt;/a&gt;)&lt;br/&gt;
&amp;gt;  6) Remember to select the license grant option on the attachment form&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; BR,&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Jukka Zitting&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; --&lt;br/&gt;
&amp;gt; Yukatan - &lt;a href=&quot;http://yukatan.fi/&quot;&gt;http://yukatan.fi/&lt;/a&gt; - &lt;a href=&apos;mailto:info@yukatan.fi&apos;&gt;info@yukatan.fi&lt;/a&gt;&lt;br/&gt;
&amp;gt; Software craftsmanship, JCR consulting, and Java development&lt;br/&gt;
</comment>
                    <comment id="12375435" author="davek2" created="Fri, 21 Apr 2006 05:13:13 +0100"  >Replaced original patch with this one to include the changes to the project.xml to copy the .cnd file to test-classes.</comment>
                    <comment id="12375833" author="jukkaz" created="Sun, 23 Apr 2006 06:49:30 +0100"  >Great work David, thanks a lot!&lt;br/&gt;
&lt;br/&gt;
I applied your patch in revision 396173 with minor cleanups and modifications listed below:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;* Changed code formatting to match the Jackrabbit conventions (see the Checkstyle configuration)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;* Made some minor reorganizations to make the code flow more apparent.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;* Added automatic namespace prefix generation as discussed below.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;* Made the unit tests check for existing namespaces to avoid errors when rerunning the test suite.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;* Used the TestRepository factory instead of the TransientRepository class to better integrate the unit tests with the main test suite.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I don&amp;#39;t follow the &amp;quot;generate another PREFIX&amp;quot;. I changed the code to check for the uri, but if the uri isn&amp;#39;t found, I just try to&lt;br/&gt;
&amp;gt; register the prefix to uri.....if the prefix is already registered to a different uri, we&amp;#39;ll get an exception which is what we want.&lt;br/&gt;
&amp;gt; If the prefix isn&amp;#39;t registered, we&amp;#39;re good to go. Let me know if I&amp;#39;m missing something. &lt;br/&gt;
&lt;br/&gt;
The namespace prefix is not really essential internally, so we can avoid the exception caused by a possible prefix conflict, by automatically generating a unique prefix in such a case.&lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12325637" name="nsreg" size="25843" author="davek2" created="Fri, 21 Apr 2006 05:13:13 +0100" />
                    <attachment id="12325633" name="nsreg" size="25336" author="davek2" created="Fri, 21 Apr 2006 03:33:10 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 21 Apr 2006 02:33:10 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142130</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279420</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>