<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:01:26 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1664/JCR-1664.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1664] JNDI Referencable Issues</title>
                <link>https://issues.apache.org/jira/browse/JCR-1664</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I&amp;#39;m questioning the use of Referencable in the BindableResource and BindableResourceFactory classes for the JNDI lookup process. Reason for this is because Referencable needs the Addrs to be in the EXACT order in order for it to be considered the same. (see &lt;a href=&quot;http://java.sun.com/j2se/1.4.2/docs/api/javax/naming/Reference.html#equals(java.lang.Object)&quot;&gt;http://java.sun.com/j2se/1.4.2/docs/api/javax/naming/Reference.html#equals(java.lang.Object)&lt;/a&gt; )&lt;br/&gt;
&lt;br/&gt;
In order for me to get the JNDI reference to be found correctly I had to change the BindableResource.getReference method to swap the order the StringReferences were added to match up what was being passed in by glassfish. This seems EXTREMELY fragile to me as I don&amp;#39;t know what order, say JBoss, would pass the StringRefences in in the Reference object for the Factory method.&lt;br/&gt;
&lt;br/&gt;
Also, another problem is that getReference is binding the class name to BindableRepository class implementation and not javax.jcr.Repository. This again causes them not to match if you follow the example on the wiki on setting up the JNDI reference and use javax.jcr.Repository as the type. This can either be fixed by changing the JNDI reference to use the BindableRepository class or the change the BindableRepository class to set that to the Repository interface. Not sure which would be considered &amp;#39;better&amp;#39;&lt;br/&gt;
&lt;br/&gt;
I have a patch that fixes the first issue (at least for glassfish), but not the second. Again, this seems like a really &amp;#39;breakable&amp;#39; setup right now and not sure what would be better to make sure this is avoided.</description>
                <environment>linux glassfish jndi spring</environment>
            <key id="12399181">JCR-1664</key>
            <summary>JNDI Referencable Issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="ender_01">Nicholas Stuart</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jun 2008 17:04:23 +0100</created>
                <updated>Wed, 14 Jan 2009 10:42:41 +0000</updated>
                    <resolved>Wed, 30 Jul 2008 14:53:08 +0100</resolved>
                            <version>core 1.4.5</version>
                                <fixVersion>core 1.4.6</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12608818" author="ender_01" created="Fri, 27 Jun 2008 17:07:10 +0100"  >path to swap StringRefAddr to match glassfish Reference object.</comment>
                    <comment id="12609282" author="ender_01" created="Mon, 30 Jun 2008 17:22:10 +0100"  >I also just tested this behaviour out in 1.4.5 and it is the same there. I haven&amp;#39;t looked at the code difference between 1.4.5 and 1.5 so they very well could be the same thing, so it may not be all that surprising.</comment>
                    <comment id="12613997" author="stefan@jira" created="Wed, 16 Jul 2008 16:56:30 +0100"  >the contract of javax.naming.Reference is pretty clear, i.e. it maintains an ordered list of RefAddr objects.&lt;br/&gt;
jackrabbit always adds the RefAddr objects in the same order.&lt;br/&gt;
&lt;br/&gt;
it seems like this is a glassfish issue not handling Reference&amp;#39;s correctly. i&amp;#39;m therefore tempted to resolve this issue as &amp;#39;Invalid&amp;#39;.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; Also, another problem is that getReference is binding the class name to BindableRepository class implementation and not javax.jcr.Repository. This again causes them not to match if you follow the example on the wiki on setting up the JNDI reference and use javax.jcr.Repository as the type.&lt;br/&gt;
&lt;br/&gt;
BindableRepository does implement javax.jcr.Repository. what WIKI page are you refering to?</comment>
                    <comment id="12614083" author="ender_01" created="Wed, 16 Jul 2008 21:08:45 +0100"  >Yes I understand Reference contains an ordered pair, and if I reverse the current order it works fine in GF as shown with the above patch. I have no idea how one would specifiy the order when creating a JNDI reference in the server though so I don&amp;#39;t know who&amp;#39;s fault it is. It seems that this order is preserved no matter how you add the values in GF&lt;br/&gt;
&lt;br/&gt;
Also, I am refering to &lt;a href=&quot;http://wiki.apache.org/jackrabbit/JackRabbitOnSunWebServer&quot;&gt;http://wiki.apache.org/jackrabbit/JackRabbitOnSunWebServer&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
And its not that BindableRepository implementing javax.jcr.Repository is a problem, its the fact that the full impl class is being returned for the lookup, and I&amp;#39;m guess Reference is doing an equals() compare, and not an &amp;quot;instanceof&amp;quot; test so it fails.</comment>
                    <comment id="12614725" author="stefan@jira" created="Fri, 18 Jul 2008 14:21:49 +0100"  >&amp;gt; Also, I am refering to &lt;a href=&quot;http://wiki.apache.org/jackrabbit/JackRabbitOnSunWebServer&quot;&gt;http://wiki.apache.org/jackrabbit/JackRabbitOnSunWebServer&lt;/a&gt; &lt;br/&gt;
&lt;br/&gt;
did you try the following?&lt;br/&gt;
&lt;br/&gt;
[...]&lt;br/&gt;
6. Create a new &amp;quot;Custom Resource&amp;quot; with the following paramter:&lt;br/&gt;
&lt;br/&gt;
Enabled: true Resource Type: org.apache.jackrabbit.core.jndi.BindableRepository Factory class: org.apache.jackrabbit.core.jndi.BindableRepositoryFactory&lt;br/&gt;
&lt;br/&gt;
Add to paramteters: 1st configFile and then repHomeDir&lt;br/&gt;
[...]&lt;br/&gt;
&lt;br/&gt;
if that works for you please let me know and update the said WIKI page.&lt;br/&gt;
&lt;br/&gt;
thanks!</comment>
                    <comment id="12616888" author="jukkaz" created="Fri, 25 Jul 2008 14:50:39 +0100"  >How about the attached patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1664&quot; title=&quot;JNDI Referencable Issues&quot;&gt;&lt;strike&gt;JCR-1664&lt;/strike&gt;&lt;/a&gt;.patch)? Instead of explicitly storing the configuration options, this patch makes BindableRepository contain the full Reference instance. This should avoid all ordering issues.&lt;br/&gt;
&lt;br/&gt;
I also streamlined these JNDI classes a bit by using the AbstractRepository base class and the JackrabbitRepository interface, and by inlining many of the static methods that weren&amp;#39;t being used outside the jndi package.</comment>
                    <comment id="12616890" author="jukkaz" created="Fri, 25 Jul 2008 14:54:18 +0100"  >Updated version of the patch. Need to keep explicitly synchronizing the static BindableRepositoryFactory.cache map.</comment>
                    <comment id="12616922" author="stefan@jira" created="Fri, 25 Jul 2008 16:29:09 +0100"  >&amp;gt; Updated version of the patch. Need to keep explicitly synchronizing the static BindableRepositoryFactory.cache map.&lt;br/&gt;
&lt;br/&gt;
+1 for the patch&lt;br/&gt;
&lt;br/&gt;
thanks, jukka!</comment>
                    <comment id="12618333" author="jukkaz" created="Wed, 30 Jul 2008 14:53:07 +0100"  >Patch applied in revision 681031. Resolving as Fixed.</comment>
                    <comment id="12631450" author="jukkaz" created="Tue, 16 Sep 2008 17:14:55 +0100"  >Merged to the 1.4 branch in revision 695960.&lt;br/&gt;
</comment>
                    <comment id="12662986" author="jukkaz" created="Mon, 12 Jan 2009 16:22:10 +0000"  >I just noticed that revision 683268 that contained changes relevant to this issue was incorrectly labelled with &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1644&quot; title=&quot;make NamespaceContext#getPrefix(java.lang.String) iterative instead of recursive&quot;&gt;&lt;strike&gt;JCR-1644&lt;/strike&gt;&lt;/a&gt; instead of &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1664&quot; title=&quot;JNDI Referencable Issues&quot;&gt;&lt;strike&gt;JCR-1664&lt;/strike&gt;&lt;/a&gt;, and that I therefore missed merging it to the 1.4 branch for the 1.4.6 release.&lt;br/&gt;
&lt;br/&gt;
1.4.6 still works with the previous 681031 changes merged, but it&amp;#39;s a bit more difficult to subclass BindableRepository. We can include the missing 683268 changes in a jackrabbit-core 1.4.7 release if there&amp;#39;s enough demand.</comment>
                    <comment id="12663721" author="jukkaz" created="Wed, 14 Jan 2009 10:42:41 +0000"  >See &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1935&quot; title=&quot;Incomplete JCR-1664 fix in BindableRepository&quot;&gt;&lt;strike&gt;JCR-1935&lt;/strike&gt;&lt;/a&gt; for the followup issue.</comment>
                </comments>
                    <attachments>
                    <attachment id="12386882" name="JCR-1664.patch" size="15655" author="jukkaz" created="Fri, 25 Jul 2008 14:54:18 +0100" />
                    <attachment id="12386881" name="JCR-1664.patch" size="15603" author="jukkaz" created="Fri, 25 Jul 2008 14:50:39 +0100" />
                    <attachment id="12384843" name="out.patch" size="777" author="ender_01" created="Fri, 27 Jun 2008 17:07:10 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 16 Jul 2008 15:56:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78466</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>192346</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>