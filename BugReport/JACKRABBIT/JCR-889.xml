<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:31:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-889/JCR-889.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-889] Add bundle support for PostgreSQL</title>
                <link>https://issues.apache.org/jira/browse/JCR-889</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The class DbNameIndex does not work with this RDBMS since the RETURN_GENERATED_KEYS JDBC feature is not implemented in current PostgreSQL drivers.</description>
                <environment></environment>
            <key id="12368101">JCR-889</key>
            <summary>Add bundle support for PostgreSQL</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="miguel.js">Miguel Angel Jim&#233;nez Sampedro</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Apr 2007 09:35:49 +0100</created>
                <updated>Tue, 15 Jan 2008 23:26:38 +0000</updated>
                    <resolved>Thu, 24 May 2007 04:56:22 +0100</resolved>
                                            <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12491916" author="miguel.js" created="Thu, 26 Apr 2007 09:39:30 +0100"  >This is the starting ddl I&amp;#39;m using on my tests with PostgreSQL.</comment>
                    <comment id="12497804" author="jukkaz" created="Tue, 22 May 2007 11:17:54 +0100"  >Looks good. Any progress on the modifications required work around the RETURN_GENERATED_KEYS issue?</comment>
                    <comment id="12497992" author="miguel.js" created="Tue, 22 May 2007 21:26:51 +0100"  >I have a solution tested extensively in our development environment, so I&amp;#39;m pretty sure it will work. The solution includes two new classes:&lt;br/&gt;
&lt;br/&gt;
org.apache.jackrabbit.core.persistence.bundle.PostgreSQLPersistenceManager&lt;br/&gt;
org.apache.jackrabbit.core.persistence.bundle.util.PostgreSQLNameIndex&lt;br/&gt;
&lt;br/&gt;
And the new ddl file to generate the schema.&lt;br/&gt;
&lt;br/&gt;
The work around to retrieve the generated key in postgres is implemented in PostgreSQLNameIndex. After doing the insert into &amp;lt;schemaObjectPrefix&amp;gt;NAMES table, the generated key is retrieved doing a second query on the implicit sequence that assigns values to the primary key column. It&amp;#39;s very similar to the NGKDbNameIndex class in that same package, but the query is very specific to PostgreSQL and looks like this:&lt;br/&gt;
&lt;br/&gt;
select currval(&amp;lt;schemaObjectPrefix&amp;gt;NAMES_ID_SEQ&amp;#39;)&lt;br/&gt;
&lt;br/&gt;
This is the link to the PostgreSQL documentation on the currval function: &lt;a href=&quot;http://www.postgresql.org/docs/8.1/interactive/functions-sequence.html&quot;&gt;http://www.postgresql.org/docs/8.1/interactive/functions-sequence.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I have tested it with a PostgreSQL 7.4, 8.0 and 8.1. I am attaching these files here for you to test, modify and hopefully integrate in the SVN repositories. As written before, feel free to make any changes in these files.</comment>
                    <comment id="12497994" author="miguel.js" created="Tue, 22 May 2007 21:30:04 +0100"  >This is the new ddl for PostgreSQL</comment>
                    <comment id="12498469" author="jukkaz" created="Thu, 24 May 2007 04:56:22 +0100"  >Excellent, thanks a lot!&lt;br/&gt;
&lt;br/&gt;
I committed the files with minor changes in revision 541146. I don&amp;#39;t have a PostgreSQL installation at hand right now, so I couldn&amp;#39;t test that it actually works, but the code seems to do all the right things. Please test and reopen this issue if necessary.</comment>
                    <comment id="12506207" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:26:51 +0100"  >We have used that with Jackrabbit 1.3 and a PostgeSQL 8.2 and can confirm that it works, using the PM for workspaces and versions.&lt;br/&gt;
&lt;br/&gt;
As Postgres 8.2 has useful new features, we improved the implementation and schema for 8.2. It has another index and the new 8.2 &amp;quot;RETURNING&amp;quot; feature, that allows to reduce the 2 statements going through the index to 1.&lt;br/&gt;
&lt;br/&gt;
The two changes are a different schema and a different PostgreSQLNameIndex class. The PostgreSQLPersistenceManager class needs no changes.</comment>
                    <comment id="12506209" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:27:43 +0100"  >The schema, only working with postgres &amp;gt; 8.2</comment>
                    <comment id="12506210" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:29:07 +0100"  >The slightly modifed PostgreSQLNameIndex class. Again, only for &amp;gt;= 8.2&lt;br/&gt;
&lt;br/&gt;
(Note that the &amp;gt; 8.2 in the previous file upload comment was meant to be &amp;gt;= 8.2 ;-)</comment>
                    <comment id="12506212" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:30:54 +0100"  >Not to forget: thanks to Hagen Overdick, our PostgreSQL expert, who did the work.</comment>
                </comments>
                    <attachments>
                    <attachment id="12360119" name="postgresql.ddl" size="679" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:27:43 +0100" />
                    <attachment id="12357920" name="postgresql.ddl" size="613" author="miguel.js" created="Tue, 22 May 2007 21:30:02 +0100" />
                    <attachment id="12356301" name="postgresql.ddl" size="661" author="miguel.js" created="Thu, 26 Apr 2007 09:39:30 +0100" />
                    <attachment id="12360120" name="PostgreSQLNameIndex.java" size="1639" author="alexander.klimetschek" created="Tue, 19 Jun 2007 16:29:07 +0100" />
                    <attachment id="12357921" name="PostgreSQLNameIndex.java" size="2792" author="miguel.js" created="Tue, 22 May 2007 21:30:37 +0100" />
                    <attachment id="12357922" name="PostgreSQLPersistenceManager.java" size="3617" author="miguel.js" created="Tue, 22 May 2007 21:30:59 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 22 May 2007 10:17:54 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142412</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279559</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>