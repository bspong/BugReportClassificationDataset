<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:55:51 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1587/JCR-1587.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1587] When trying to reuse version label in transaction, exception is thrown</title>
                <link>https://issues.apache.org/jira/browse/JCR-1587</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Following sequence causes failure:&lt;br/&gt;
1. first transaction:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;1.1 create versionable node&lt;br/&gt;
&amp;nbsp;&amp;nbsp;1.2 create version 1 of this node&lt;br/&gt;
2. second transaction:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;2.1 create version 2 of this node&lt;br/&gt;
&amp;nbsp;&amp;nbsp;2.2 assign a label to version 2&lt;br/&gt;
3. third transaction:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;3.1 restore a node to version 1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;3.2 remove version 2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;3.3 make version 3 of  same node&lt;br/&gt;
&amp;nbsp;&amp;nbsp;3.4 assign same label (which was assigned to version 2) to version 3 -&amp;gt; fails&lt;br/&gt;
&lt;br/&gt;
Same sequence which does not use transactions at all works fine.&lt;br/&gt;
Going to attach a test case.</description>
                <environment>Jackrabbit Core 1.4.4, Jencks 2.0, Springmodules 0.8a, Jackrabbit JCA 1.4&lt;br/&gt;
Java version: 1.6.0_06&lt;br/&gt;
OS name: &amp;quot;windows vista&amp;quot; version: &amp;quot;6.0&amp;quot; arch: &amp;quot;x86&amp;quot; Family: &amp;quot;windows&amp;quot;</environment>
            <key id="12395717">JCR-1587</key>
            <summary>When trying to reuse version label in transaction, exception is thrown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rpuch">Roman Puchkovskiy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 May 2008 15:39:34 +0100</created>
                <updated>Thu, 12 Jun 2008 20:36:58 +0100</updated>
                    <resolved>Wed, 14 May 2008 12:39:58 +0100</resolved>
                            <version>core 1.4.3</version>
                <version>core 1.4.4</version>
                                <fixVersion>core 1.4.5</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12595618" author="rpuch" created="Fri, 9 May 2008 15:41:55 +0100"  >This is a Maven project. To run tests, unpack and run &amp;#39;mvn test&amp;#39;.&lt;br/&gt;
Test contains two methods: one of them does not use transactions (passes), another uses transactions (fails).</comment>
                    <comment id="12596405" author="mreutegg" created="Tue, 13 May 2008 15:41:27 +0100"  >The sequence of checking the various places where an ItemState can reside is not correct in XAItemStateManager.&lt;br/&gt;
&lt;br/&gt;
E.g. in getItemState() first checks the transaction change log if it contains an item. If the item is not known to the change log the base class (LocalItemStateManager) is called. This means the change logs and item state managers are checked in the following sequence:&lt;br/&gt;
&lt;br/&gt;
1) transaction change log&lt;br/&gt;
2) local change log&lt;br/&gt;
3) shared item state manager&lt;br/&gt;
&lt;br/&gt;
This is actually wrong and should rather be:&lt;br/&gt;
&lt;br/&gt;
1) local change log&lt;br/&gt;
2) transaction change log&lt;br/&gt;
3) shared item state manager&lt;br/&gt;
&lt;br/&gt;
The test fails because the property for the version label &amp;quot;2&amp;quot; is marked deleted in the transaction change log, while at the same time is added in the local change log. Because the sequence of the checks is wrong, the version label property is incorrectly reported as destroyed.</comment>
                    <comment id="12596420" author="mreutegg" created="Tue, 13 May 2008 16:43:59 +0100"  >Proposed fix.&lt;br/&gt;
&lt;br/&gt;
All tests pass, including daily integration tests.&lt;br/&gt;
&lt;br/&gt;
Please review.</comment>
                    <comment id="12596639" author="rpuch" created="Wed, 14 May 2008 07:16:28 +0100"  >My tests pass too, and application works correctly in point where this issue is concerned. Tested with jackrabbit-core-1.4.4 with patch applied.</comment>
                    <comment id="12596733" author="mreutegg" created="Wed, 14 May 2008 12:39:57 +0100"  >Committed patch in revision: 656240</comment>
                    <comment id="12601064" author="jukkaz" created="Fri, 30 May 2008 11:02:14 +0100"  >Merged to the 1.4 branch in revision 661624.</comment>
                </comments>
                    <attachments>
                    <attachment id="12381966" name="JCR-1587.patch" size="6030" author="mreutegg" created="Tue, 13 May 2008 16:43:59 +0100" />
                    <attachment id="12381769" name="test-reassign-version-label-in-tx.zip" size="8347" author="rpuch" created="Fri, 9 May 2008 15:41:55 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 13 May 2008 14:41:27 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78495</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190173</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>