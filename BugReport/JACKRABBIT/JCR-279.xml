<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:50:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-279/JCR-279.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-279] IllegalStateException thrown when consuming events</title>
                <link>https://issues.apache.org/jira/browse/JCR-279</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>i assume, when session is closed, or beeing closed, the observation still tries to deliver some events:&lt;br/&gt;
&lt;br/&gt;
[java] 2005-11-24 22:58:41,764 [ObservationManager] WARN  org.apache.jackrabbit.core.observation.ObservationManagerFactory - EventConsumer threw exception: java.lang.IllegalStateException: not in&lt;br/&gt;
itialized&lt;br/&gt;
[java] 2005-11-24 22:58:41,764 [ObservationManager] DEBUG org.apache.jackrabbit.core.observation.ObservationManagerFactory - Stacktrace:&lt;br/&gt;
[java] java.lang.IllegalStateException: not initialized&lt;br/&gt;
[java]     at org.apache.jackrabbit.core.security.SimpleAccessManager.isGranted(SimpleAccessManager.java:119)&lt;br/&gt;
[java]     at org.apache.jackrabbit.core.observation.EventConsumer.consumeEvents(EventConsumer.java:231)&lt;br/&gt;
[java]     at org.apache.jackrabbit.core.observation.ObservationManagerFactory.run(ObservationManagerFactory.java:161)&lt;br/&gt;
[java]     at java.lang.Thread.run(Thread.java:595)&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12326019">JCR-279</key>
            <summary>IllegalStateException thrown when consuming events</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mreutegg">Marcel Reutegger</assignee>
                                <reporter username="tripod">Tobias Bocanegra</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Nov 2005 09:53:06 +0000</created>
                <updated>Mon, 28 Nov 2005 17:38:50 +0000</updated>
                    <resolved>Fri, 25 Nov 2005 18:38:30 +0000</resolved>
                                            <fixVersion>1.0</fixVersion>
                                <component>observation</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12358495" author="mreutegg" created="Fri, 25 Nov 2005 18:38:30 +0000"  >I agree, it probably happens when a session is being closed and the observation manager still tries to deliver events.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve changed the method EventConsumer.consumeEvents() to do some sanity checking on the session to avoid the IllegalStateException. However, because events are delivered in a separate thread it may still happen in rare cases that the exception is thrown. The warn log is not severe and does not harm operation of jackrabbit.&lt;br/&gt;
&lt;br/&gt;
Costin: could you please check if this change avoids the IllegalStateExceptions you see? Thanks.&lt;br/&gt;
&lt;br/&gt;
Fixed in revision: 348920</comment>
                    <comment id="12358497" author="costin" created="Fri, 25 Nov 2005 18:45:43 +0000"  >Sure (I&amp;#39;ll do an update right now and see how it goes). However isn&amp;#39;t event delivery guaranteed not matter if it&amp;#39;s asynchronous or not? A listener should receive events no matter if the session has been closed or not.</comment>
                    <comment id="12358504" author="mreutegg" created="Fri, 25 Nov 2005 20:08:21 +0000"  >Every event listener has to be bound to a session to check access rights. &lt;br/&gt;
&lt;br/&gt;
See spec section: 8.3.5. Event Filtering&lt;br/&gt;
&lt;br/&gt;
&amp;lt;spec&amp;gt;&lt;br/&gt;
An event listener will only receive events for which its session (the&lt;br/&gt;
session through which it was registered) has sufficient access&lt;br/&gt;
control permissions and which meet the filtering restrictions&lt;br/&gt;
specified upon registration. See 8.3.3 Observation Manager.&lt;br/&gt;
&amp;lt;/spec&amp;gt;&lt;br/&gt;
&lt;br/&gt;
IMO once the session is logged out, there is no way to check for access control anymore and the listener must be unregistered. Which is the case in jackrabbit.</comment>
                    <comment id="12358569" author="costin" created="Sun, 27 Nov 2005 07:10:38 +0000"  >I&amp;#39;ve checked the example and indeed there are no more exceptions. Thanks.</comment>
                    <comment id="12358614" author="mreutegg" created="Mon, 28 Nov 2005 17:38:50 +0000"  >Ok, then I&amp;#39;ll close this issue.&lt;br/&gt;
&lt;br/&gt;
Thanks for testing Costin.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 25 Nov 2005 18:38:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142076</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>253468</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>