<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:31:03 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-3275/JCR-3275.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-3275] Audit log</title>
                <link>https://issues.apache.org/jira/browse/JCR-3275</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>&lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2031&quot; title=&quot;Improved log message: include path&quot;&gt;&lt;strike&gt;JCR-2031&lt;/strike&gt;&lt;/a&gt; added the user name and path in debug logs for audit purposes. There are some problems with the fix that I had outlined in the comments for &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2031&quot; title=&quot;Improved log message: include path&quot;&gt;&lt;strike&gt;JCR-2031&lt;/strike&gt;&lt;/a&gt; and provided a patch. Additionally, it would use useful to add an update counter and size information to the debug log as well. Something like this:&lt;br/&gt;
&lt;br/&gt;
17.03.2009 14:43:37 [1] 18216140 admin@/apps/acme/templates/contentpage/thumbnail.png (12343) &lt;br/&gt;
17.03.2009 14:43:37 [2] 18216141 admin@/apps/acme/templates/contentpage/my.png (123) &lt;br/&gt;
17.03.2009 14:43:37 [3] 18216142 admin@/apps/acme/templates/contentpage/blah.png (1423) &lt;br/&gt;
17.03.2009 14:43:37 [4] 18216143 admin@/apps/acme/templates/contentpage/test.png (123423) &lt;br/&gt;
17.03.2009 14:43:37 [5] 18216144 admin@/apps/acme/templates/contentpage/test2.png (123423) &lt;br/&gt;
&lt;br/&gt;
&amp;lt;date&amp;gt; &amp;lt;time&amp;gt; [&amp;lt;counter&amp;gt;] &amp;lt;txid&amp;gt; &amp;lt;userid&amp;gt;@&amp;lt;path&amp;gt; (&amp;lt;size&amp;gt;)&lt;br/&gt;
&lt;br/&gt;
We should also think about whether we want this log as part of regular jackrabbit log or in a separate audit log. &lt;br/&gt;
</description>
                <environment></environment>
            <key id="12548071">JCR-3275</key>
            <summary>Audit log</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mreutegg">Marcel Reutegger</assignee>
                                <reporter username="meteatamel">Mete Atamel</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Mar 2012 08:17:29 +0100</created>
                <updated>Wed, 10 Oct 2012 11:10:10 +0100</updated>
                    <resolved>Mon, 23 Apr 2012 12:55:52 +0100</resolved>
                            <version>2.4</version>
                                <fixVersion>2.5</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>4</watches>
                          <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                    <timeestimate seconds="86400">24h</timeestimate>
                                  <comments>
                    <comment id="13238210" author="mreutegg" created="Mon, 26 Mar 2012 09:52:01 +0100"  >Patch provided in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-2031&quot; title=&quot;Improved log message: include path&quot;&gt;&lt;strike&gt;JCR-2031&lt;/strike&gt;&lt;/a&gt; looks good. Committed in revision 1305269</comment>
                    <comment id="13238356" author="meteatamel" created="Mon, 26 Mar 2012 14:09:21 +0100"  >Patch that adds counter and size support.</comment>
                    <comment id="13240391" author="meteatamel" created="Wed, 28 Mar 2012 14:12:02 +0100"  >The attached patch adds counter and size info to the debug log. Could someone with commit rights review and apply it please?</comment>
                    <comment id="13244209" author="meteatamel" created="Mon, 2 Apr 2012 15:11:29 +0100"  >The latest attached patch further improves the logs with additional info.</comment>
                    <comment id="13245061" author="mreutegg" created="Tue, 3 Apr 2012 09:26:40 +0100"  >Looks very good. I slightly changed where new data store items are logged. In your patch the BundleWriter logs a message when a node with a binary property is stored. This will also log when a node is updated, but the binary didn&amp;#39;t change. I think this is confusing for a person looking at the log. Instead I moved the log statement to the class BLOBInDataStore. There the message will only be logged when a binary is actually added to the data store.&lt;br/&gt;
&lt;br/&gt;
Comitted in revision: 1308743</comment>
                    <comment id="13259500" author="mreutegg" created="Mon, 23 Apr 2012 11:41:04 +0100"  >Re-opening because the log messages are only written on the cluster node where the changes are written. I think this is confusing because it will result in log information scattered across the cluster nodes.</comment>
                    <comment id="13259550" author="mreutegg" created="Mon, 23 Apr 2012 12:53:29 +0100"  >Patch provided by Mete Atamel to address the above mentioned limitation.</comment>
                    <comment id="13259552" author="mreutegg" created="Mon, 23 Apr 2012 12:55:52 +0100"  >Applied patch in revision 1329195</comment>
                    <comment id="13399188" author="c_koell" created="Fri, 22 Jun 2012 08:42:20 +0100"  >I would like to change the audit logs in ClusterNode also to debug like the other ones or is it needed as info for someone ?</comment>
                    <comment id="13399198" author="c_koell" created="Fri, 22 Jun 2012 09:11:37 +0100"  >changed to debug in revision 1352794.</comment>
                    <comment id="13400295" author="meteatamel" created="Mon, 25 Jun 2012 07:02:06 +0100"  >Hi Claus, we had set ClusterNode&amp;#39;s audit log to info because it&amp;#39;s the most useful one for audit purposes and not so chatty. We wanted to make sure it&amp;#39;s logged by default, so we have useful audit info by default without people having to change to debug level. Other audit logs are at debug as they are more chatty and we didn&amp;#39;t want the whole system to be overwhelmed with so many logs.</comment>
                    <comment id="13400298" author="c_koell" created="Mon, 25 Jun 2012 07:11:26 +0100"  >Ok i see .. but i think the logs are also chatty because it logs every  change on node level in the repo ;-) .. and we could add some speaking log and not only some values as used in other audit logs.&lt;br/&gt;
I have changed it to debug but if you need it as info please feel free to change it back</comment>
                    <comment id="13400306" author="meteatamel" created="Mon, 25 Jun 2012 07:29:20 +0100"  >Yes, they are somewhat chatty but that&amp;#39;s the nature of audit logging. I&amp;#39;m not sure if I follow your comment about speaking log. I think for audit logging to be useful, its basic form (i.e. ClusterNode part) needs to be logged at info level. Not many people want to enable debug logging which means no audit logging for majority of use cases and that defeats the purpose. So, I suggest we change ClusterNode audit logging back to info, so at least we have some audit log by default. I&amp;#39;d do it myself but I don&amp;#39;t have commit rights :-)</comment>
                    <comment id="13400325" author="c_koell" created="Mon, 25 Jun 2012 08:09:58 +0100"  >You are right its the nature :-) and so i thought we should have all audit logs at same level. You are right audit log should be logged in basic form but i don&amp;#39;t like to have different formats.&lt;br/&gt;
At the moment we have audit logs in ClusterNode, AbstractBundlePersistenceManager and BLOBInDataStore.&lt;br/&gt;
Two on debug level and one on info level. One looks like &amp;quot;Stored {} to DataStore ({})&amp;quot; and the other one in ClusterNode looks like &amp;quot;[{}] {} {} ({})&amp;quot; This is what i meant with speaking log ...&lt;br/&gt;
We should document what values are logged or not.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="13400361" author="mreutegg" created="Mon, 25 Jun 2012 09:32:55 +0100"  >I&amp;#39;m also in favour of changing it back to info.&lt;br/&gt;
&lt;br/&gt;
Please also note that this issue has fix version 2.5, which has already been released. We should not make changes anymore with this issue, but rather create a new one. Otherwise it&amp;#39;s not clear anymore what the behaviour is in a given release.</comment>
                    <comment id="13400364" author="c_koell" created="Mon, 25 Jun 2012 09:36:33 +0100"  >Ups sorry .. i will change it back and open a new one .. so that we may use in all audit logs a similar log style.</comment>
                    <comment id="13473137" author="gschneck" created="Wed, 10 Oct 2012 11:10:10 +0100"  >Additional comment / enhancement proposal :&lt;br/&gt;
&lt;br/&gt;
When saving several transaction at the same time, the Audit log could log all nodes impacted by the commits.&lt;br/&gt;
&lt;br/&gt;
For example, (using CRXDE Lite) I created 2 nodes,  /tmp/test and /tmp/test/subtest .&lt;br/&gt;
On save , I see only one line : &lt;br/&gt;
&lt;br/&gt;
10.10.2012 12:04:37.795 *DEBUG* [10.136.133.138 [1349863477688] POST /crx/server/crx.default/jcr%3aroot HTTP/1.1] org.apache.jackrabbit.core.cluster.ClusterNode revision 1099516356096 admin@/tmp&lt;br/&gt;
&lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12520977" name="JCR-3275-4.patch" size="10150" author="meteatamel" created="Mon, 2 Apr 2012 15:11:28 +0100" />
                    <attachment id="12523780" name="JCR-3275-5.patch" size="7901" author="mreutegg" created="Mon, 23 Apr 2012 12:53:29 +0100" />
                    <attachment id="12519954" name="JCR-3275.patch" size="3673" author="meteatamel" created="Mon, 26 Mar 2012 14:09:21 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 26 Mar 2012 08:52:01 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>233169</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>43771</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>