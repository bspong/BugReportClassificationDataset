<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:41:46 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-931/JCR-931.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-931] cluster synchronization NPE</title>
                <link>https://issues.apache.org/jira/browse/JCR-931</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>we have a 4 machines setup and encountered the following NPE in one of the nodes. After restarting tomcat, the problem seems to go away. But it would be nice to find out why.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.NodeIndexer.createDoc(NodeInd&lt;br/&gt;
exer.java:146)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SearchIndex.createDocument(Se&lt;br/&gt;
archIndex.java:566)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SearchIndex$2.next(SearchInde&lt;br/&gt;
x.java:368)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.MultiIndex.update(MultiIndex.&lt;br/&gt;
java:354)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.SearchIndex.updateNodes(Searc&lt;br/&gt;
hIndex.java:356)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.SearchManager.onEvent(SearchManager.java:4&lt;br/&gt;
23)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.EventConsumer.consumeEvents(Ev&lt;br/&gt;
entConsumer.java:231)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.ObservationDispatcher.dispatch&lt;br/&gt;
Events(ObservationDispatcher.java:201)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.EventStateCollection.dispatch(&lt;br/&gt;
EventStateCollection.java:424)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.externalUpdat&lt;br/&gt;
e(SharedItemStateManager.java:882)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl$WorkspaceInfo.externalUpdat&lt;br/&gt;
e(RepositoryImpl.java:1957)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.end(ClusterNode.java:8&lt;br/&gt;
34)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.consume(ClusterNode.ja&lt;br/&gt;
va:929)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.doSync(AbstractJou&lt;br/&gt;
rnal.java:191)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.sync(AbstractJourn&lt;br/&gt;
al.java:166)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.sync(ClusterNode.java:&lt;br/&gt;
283)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.start(ClusterNode.java&lt;br/&gt;
:229)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.&amp;lt;init&amp;gt;(RepositoryImpl.java:&lt;br/&gt;
308)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.RepositoryImpl.create(RepositoryImpl.java:&lt;br/&gt;
584)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.jndi.BindableRepository.createRepository(B&lt;br/&gt;
indableRepository.java:174)</description>
                <environment></environment>
            <key id="12369686">JCR-931</key>
            <summary>cluster synchronization NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="xilu1999">Xiaohua Lu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2007 16:26:02 +0100</created>
                <updated>Mon, 6 Aug 2007 07:45:58 +0100</updated>
                    <resolved>Tue, 22 May 2007 09:49:58 +0100</resolved>
                            <version>1.3</version>
                                <fixVersion>1.3.1</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12496917" author="ianeboston" created="Fri, 18 May 2007 16:42:39 +0100"  >Does the node in question hang to all requests after the exception (untill you restart the node)&lt;br/&gt;
or does it continue working ?&lt;br/&gt;
&lt;br/&gt;
Might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-929&quot; title=&quot;Under Heavy load in a Cluster HTTP Threads Block and stall requests&quot;&gt;&lt;strike&gt;JCR-929&lt;/strike&gt;&lt;/a&gt; ?</comment>
                    <comment id="12496920" author="xilu1999" created="Fri, 18 May 2007 16:50:19 +0100"  >it is not under heavy load and it was working after the exception and the exception is gone after restart tomcat</comment>
                    <comment id="12496962" author="ianeboston" created="Fri, 18 May 2007 18:21:35 +0100"  >thanks for the clarification, &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-929&quot; title=&quot;Under Heavy load in a Cluster HTTP Threads Block and stall requests&quot;&gt;&lt;strike&gt;JCR-929&lt;/strike&gt;&lt;/a&gt; was also seeing the same error as well as the lock. Seperate issues, I think.</comment>
                    <comment id="12497455" author="dpfister" created="Mon, 21 May 2007 14:55:03 +0100"  >While testing the clustering functionality, I encountered this exception on rare occasions. From the contents of the journal log , I deduced the following scenario:&lt;br/&gt;
&lt;br/&gt;
Cluster-Node1 (CN1):&lt;br/&gt;
(1) adds child node C to N&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;performs some other operations, &lt;br/&gt;
(2) deletes child node C,&lt;br/&gt;
&lt;br/&gt;
Cluster-Node2 (CN2):&lt;br/&gt;
----&amp;gt; CN1 executes (1)&lt;br/&gt;
- receives the notification about the addition of node C&lt;br/&gt;
- invokes all registered event handlers&lt;br/&gt;
- SearchManager.onEvent invokes updateNodes of its query handler (cf stack trace above)&lt;br/&gt;
- SearchIndex.updateNodes retrieves the node state, CN1 did not yet execute (2)&lt;br/&gt;
- SearchIndex.createDocument invokes NodeIndexer.createDoc&lt;br/&gt;
----&amp;gt; CN1 executes (2)&lt;br/&gt;
- NodeIndexer.createDoc tries to retrieve the node state&amp;#39;s child node entry in its parent: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;this returns null, since the node does no longer exists and the very next line, trying to&lt;br/&gt;
&amp;nbsp;&amp;nbsp;retrieve the child&amp;#39;s node name, throws.&lt;br/&gt;
</comment>
                    <comment id="12497763" author="mreutegg" created="Tue, 22 May 2007 09:49:58 +0100"  >I&amp;#39;ve added a check to the NodeIndexer to make sure the child node entry is present or otherwise throw a RepositoryException. The SearchIndex class will then log a warn message but continue to index the remaining items.&lt;br/&gt;
&lt;br/&gt;
Fixed in revision: 540492</comment>
                    <comment id="12500947" author="ianeboston" created="Sat, 2 Jun 2007 15:23:02 +0100"  >You might want to check what you transaction isolation is.&lt;br/&gt;
&lt;br/&gt;
In MySQL if its REPEATABLE-READ the nodes added on other nodes will not be updated on the current node until the current node does a commit.&lt;br/&gt;
&lt;br/&gt;
if its READ-COMMITTED the underlying problem might go away.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve been seeing simular problems that went away once the DB transaction isolation was put right, some versions of MySQL come shipped with REPEATABLE-READ on InnoDB (which you must use)&lt;br/&gt;
</comment>
                    <comment id="12501361" author="jukkaz" created="Mon, 4 Jun 2007 21:43:58 +0100"  >Merged to the 1.3 branch in revision 544256.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 18 May 2007 15:42:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78723</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190015</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>