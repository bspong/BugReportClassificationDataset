<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:32:07 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1248/JCR-1248.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1248] Helper Method to escape illegal XPath Search Term</title>
                <link>https://issues.apache.org/jira/browse/JCR-1248</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>If you try to perform a search like this&lt;br/&gt;
&lt;br/&gt;
//element(*, nt:base)[jcr:contains(., &amp;#39;test!&amp;#39;)]&lt;br/&gt;
&lt;br/&gt;
you get this exception&lt;br/&gt;
&lt;br/&gt;
javax.jcr.RepositoryException: Exception building query: org.apache.jackrabbit.core.query.lucene.fulltext.ParseException: Encountered &amp;quot;&amp;lt;EOF&amp;gt;&amp;quot; at line 1, column 6.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12383602">JCR-1248</key>
            <summary>Helper Method to escape illegal XPath Search Term</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="c_koell">Claus K&#246;ll</assignee>
                                <reporter username="c_koell">Claus K&#246;ll</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Nov 2007 09:11:36 +0000</created>
                <updated>Tue, 2 Mar 2010 09:12:17 +0000</updated>
                    <resolved>Mon, 20 Oct 2008 12:38:32 +0100</resolved>
                                            <fixVersion>1.5</fixVersion>
                                <component>jackrabbit-jcr-commons</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12547053" author="aschrijvers" created="Fri, 30 Nov 2007 09:26:10 +0000"  >Repeated from user-list: &lt;br/&gt;
&lt;br/&gt;
It seems that in LuceneQueryBuilder at&lt;br/&gt;
&lt;br/&gt;
Object visit(TextsearchQueryNode node, Object data) {&lt;br/&gt;
&lt;br/&gt;
it breaks at&lt;br/&gt;
&lt;br/&gt;
Query context = parser.parse(query.toString()); &lt;br/&gt;
&lt;br/&gt;
where the parser is o.a.j.core.query.lucene.fulltext.QueryParser. It seems to break on string ending with a &amp;quot;!&amp;quot;. Unfortunately, I do not have insight in how the QueryParser works. Perhaps somebody else knows where to look in the QueryParser .</comment>
                    <comment id="12547155" author="mreutegg" created="Fri, 30 Nov 2007 14:30:03 +0000"  >In addition to the already specified set of special character in JSR 170, Jackrabbit uses more of those characters for extended functionality.&lt;br/&gt;
&lt;br/&gt;
This set of characters should be limited to the ones really required (e.g. ! is equivalent to -) and clearly documented. It would be nice to also have a utility class that automatically escapes the special characters used in Jackrabbit.</comment>
                    <comment id="12640952" author="c_koell" created="Mon, 20 Oct 2008 10:14:16 +0100"  >I added a helper Method in org.apache.jackrabbit.util.Text to escape illegal XPathChars. &lt;br/&gt;
It checks illegal chars at the end of a XPatch search term.&lt;br/&gt;
</comment>
                    <comment id="12640981" author="c_koell" created="Mon, 20 Oct 2008 12:38:32 +0100"  >Committed in Rev: 706242</comment>
                    <comment id="12641179" author="jukkaz" created="Mon, 20 Oct 2008 23:03:00 +0100"  >This turned out to be implemented as a new feature in jcr-commons, changing issue metadata accordingly.&lt;br/&gt;
&lt;br/&gt;
I guess the original problem (ParseException) is the expected (though undocumented) behavior, so there&amp;#39;s no need to fix this for clients that don&amp;#39;t use the new helper method.</comment>
                    <comment id="12839819" author="monkiki" created="Mon, 1 Mar 2010 19:36:18 +0000"  >A query like this will fail:&lt;br/&gt;
&lt;br/&gt;
//element(*, nt:base)[jcr:contains(., &amp;#39;test \ done&amp;#39;)]&lt;br/&gt;
&lt;br/&gt;
Specification JSR-170 at point 6.6.5.2 says that literal instances like single quote ( &amp;#39; ), double quote ( &amp;quot; ) and hyphen ( - ) must be escaped with a backslash ( \ ), and backslash itself should be escaped as a double backslash ( \\ ). Also, I have noted that some chars like [ and ] need to be escaped also.</comment>
                    <comment id="12839871" author="alexander.klimetschek" created="Mon, 1 Mar 2010 21:36:44 +0000"  >&amp;gt; A query like this will fail: &lt;br/&gt;
&amp;gt; //element(*, nt:base)[jcr:contains(., &amp;#39;test \ done&amp;#39;)] &lt;br/&gt;
&lt;br/&gt;
Did you use org.apache.jackrabbit.util.Text.escapeIllegalXpathSearchChars() ? In case that one has a bug, please file a new issue.&lt;br/&gt;
&lt;br/&gt;
See also &lt;a href=&quot;http://wiki.apache.org/jackrabbit/EncodingAndEscaping&quot;&gt;http://wiki.apache.org/jackrabbit/EncodingAndEscaping&lt;/a&gt;</comment>
                    <comment id="12840068" author="monkiki" created="Tue, 2 Mar 2010 09:02:46 +0000"  >By the way, this sample code at &lt;a href=&quot;http://wiki.apache.org/jackrabbit/EncodingAndEscaping&quot;&gt;http://wiki.apache.org/jackrabbit/EncodingAndEscaping&lt;/a&gt; is recursive:&lt;br/&gt;
&lt;br/&gt;
String q =&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;quot;/jcr:root/foo/element(*, foo)&amp;quot; +&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;quot;[jcr:contains(@title, &amp;#39;&amp;quot; + Text.escapeIllegalXpathSearchChars(q).replaceAll(&amp;quot;&amp;#39;&amp;quot;, &amp;quot;&amp;#39;&amp;#39;&amp;quot;) + &amp;quot;&amp;#39;)]&amp;quot; +&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;quot;[@itemID = &amp;#39;&amp;quot; + itemID.replaceAll(&amp;quot;&amp;#39;&amp;quot;, &amp;quot;&amp;#39;&amp;#39;&amp;quot;) + &amp;quot;&amp;#39;]&amp;quot;;</comment>
                    <comment id="12840071" author="monkiki" created="Tue, 2 Mar 2010 09:12:17 +0000"  >I&amp;#39;m not sure if is a bug or a &amp;quot;feature&amp;quot;. The query&lt;br/&gt;
&lt;br/&gt;
String term = &amp;quot;pe[]pe&amp;quot;;&lt;br/&gt;
String scapedTerm = Text.escapeIllegalXpathSearchChars(term).replaceAll(&amp;quot;&amp;#39;&amp;quot;, &amp;quot;&amp;#39;&amp;#39;&amp;quot;)&lt;br/&gt;
String query = &amp;quot;/jcr:root//*[jcr:contains(okm:content,&amp;#39;&amp;quot;+escapedTerm+&amp;quot;&amp;#39;)]&amp;quot;&lt;br/&gt;
&lt;br/&gt;
should fail or the term &amp;quot;pe[]pe&amp;quot; should be escaped as &amp;quot;pe\[\]pe&amp;quot;?</comment>
                </comments>
                    <attachments>
                    <attachment id="12392463" name="patch.txt" size="1331" author="c_koell" created="Mon, 20 Oct 2008 10:14:16 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 30 Nov 2007 09:26:10 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142600</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279793</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>