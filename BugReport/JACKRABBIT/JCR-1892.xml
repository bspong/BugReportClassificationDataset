<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:52:25 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1892/JCR-1892.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1892] Unique ID for org.apache.jackrabbit.value.BinaryValue</title>
                <link>https://issues.apache.org/jira/browse/JCR-1892</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>BinaryValue should have a method get the unique identifier (if one is available). That way an application may not have to read the stream if that value is already processed.&lt;br/&gt;
&lt;br/&gt;
When the DataStore is used, a unique identifier is available, so probably this feature is quite simple to implement.&lt;br/&gt;
&lt;br/&gt;
See also &lt;a href=&quot;http://www.nabble.com/Workspace.copy()-Question-...-td20435164.html&quot;&gt;http://www.nabble.com/Workspace.copy()-Question-...-td20435164.html&lt;/a&gt; (but please don&amp;#39;t reply to this thread from now on - instead add comments to this issue).&lt;br/&gt;
&lt;br/&gt;
Another feature is getFileName() to get the file name if it is stored in the file system. This method may need a security mechanism, for example getFileName(Session s) so that the system can check it. In any case the file should not be modified, but maybe knowing the file name is already too dangerous in some cases.</description>
                <environment></environment>
            <key id="12409642">JCR-1892</key>
            <summary>Unique ID for org.apache.jackrabbit.value.BinaryValue</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tmueller">Thomas Mueller</assignee>
                                <reporter username="tmueller">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2008 12:24:23 +0000</created>
                <updated>Thu, 13 Aug 2009 16:03:44 +0100</updated>
                    <resolved>Tue, 27 Jan 2009 16:13:33 +0000</resolved>
                                            <fixVersion>1.6</fixVersion>
                                <component>jackrabbit-jcr-commons</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12661584" author="tmueller" created="Wed, 7 Jan 2009 14:11:51 +0000"  >Proposed JackrabbitValue interface</comment>
                    <comment id="12661587" author="tmueller" created="Wed, 7 Jan 2009 14:13:15 +0000"  >Implementation and tests for the JackrabbitValue.&lt;br/&gt;
Additionally, values already stored in the repository&lt;br/&gt;
are not spooled again if the value is stored again.</comment>
                    <comment id="12661638" author="jukkaz" created="Wed, 7 Jan 2009 17:09:02 +0000"  >Good stuff! Some comments:&lt;br/&gt;
&lt;br/&gt;
* Should we set some expectations (not necessarily fixed limits) about the size of the content identity string? With the current definition the implementation could simply return the base64 encoding of the entire binary value!&lt;br/&gt;
&lt;br/&gt;
* Do we need the DataStore.hasRecord() method? If we use getRecord() directly we wouldn&amp;#39;t need to worry about race conditions with the garbage collection.&lt;br/&gt;
&lt;br/&gt;
* In BinaryValueImpl.getContentIdentity() I&amp;#39;d use blob.getDataIdentifier().toString() (with appropriate null guards) to avoid surprises if we ever decide to make blob.toString() more expressive for debug purposes.&lt;br/&gt;
&lt;br/&gt;
* I wouldn&amp;#39;t call getContentIdentity() internally in jackrabbit-core as we already have access to the DataIdentifier in the source value. Also, a malicious user could have passed in their own subclass that overrides getContentIdentity().&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12661972" author="tmueller" created="Thu, 8 Jan 2009 14:13:07 +0000"  >&amp;gt; expectations about the string length&lt;br/&gt;
&lt;br/&gt;
Sure, what about &amp;quot;The string is normally about 50 characters long.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
&amp;gt; With the current definition the implementation could simply return the base64 encoding of the entire binary value!&lt;br/&gt;
&lt;br/&gt;
For very short binaries it may make sense to do that.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; Do we need the DataStore.hasRecord() method?&lt;br/&gt;
&lt;br/&gt;
No. Currently, DbDataStore.getRecord() throws an exception if the record doesn&amp;#39;t exist, I wanted to avoid that.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; race conditions with the garbage collection&lt;br/&gt;
&lt;br/&gt;
Good point! What about getRecordIfStored()? getRecord() would then just call that method and throw an exception if it returns null.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; BinaryValueImpl.getContentIdentity() I&amp;#39;d use blob.getDataIdentifier().toString()&lt;br/&gt;
&lt;br/&gt;
Ups, that was my plan...&lt;br/&gt;
&lt;br/&gt;
&amp;gt; not call getContentIdentity() internally&lt;br/&gt;
&lt;br/&gt;
You are right of course.&lt;br/&gt;
</comment>
                    <comment id="12662388" author="jukkaz" created="Fri, 9 Jan 2009 15:02:00 +0000"  >&amp;gt; Sure, what about &amp;quot;The string is normally about 50 characters long.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Or: &amp;quot;The returned string contains only ASCII letters and digits and is at most 128 characters long.&amp;quot; Both limitations are generic enough for most identifier formats (even a hex representation of a huge 512-bit hash), and they allow client applications to easily (no quoting) and efficiently (bounded size) use the returned strings.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; What about getRecordIfStored()?&lt;br/&gt;
&lt;br/&gt;
I think the current getRecord() is fine. If you already have a DataIdentifier for something, then it&amp;#39;s highly likely that the corresponding record also exists in the DataStore, and an exception would truly be exceptional.&lt;br/&gt;
</comment>
                    <comment id="12662918" author="tmueller" created="Mon, 12 Jan 2009 09:42:19 +0000"  >What about &lt;br/&gt;
&lt;br/&gt;
&amp;quot;The identifier is opaque, meaning it can have any format and size, however&lt;br/&gt;
it is at normally about 50 characters and at most 255 characters long.&lt;br/&gt;
The string only contains Unicode code points from 32 to 127 (including).&amp;quot;&lt;br/&gt;
&lt;br/&gt;
For some databases, the VARCHAR limit is 255. Unicode code points 32 to 127 are the same in ASCII, and I don&amp;#39;t like to exclude &amp;#39;:&amp;#39; and &amp;#39;/&amp;#39; to support URLs; and I don&amp;#39;t like to exclude base64 encoding.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; If you already have a DataIdentifier for something, then it&amp;#39;s highly likely that the corresponding record also exists in the DataStore&lt;br/&gt;
&lt;br/&gt;
One use case is fast data migration (from one repository to another). In that case the record usually doesn&amp;#39;t exist yet.&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t see any harm in getRecordIfStored().</comment>
                    <comment id="12667709" author="tmueller" created="Tue, 27 Jan 2009 16:13:33 +0000"  >Committed in revision 738119 (jackrabbit-core) and revision 738121 (jackrabbit-api).</comment>
                </comments>
                    <attachments>
                    <attachment id="12397299" name="JackrabbitValue-api.patch" size="2548" author="tmueller" created="Wed, 7 Jan 2009 14:11:51 +0000" />
                    <attachment id="12397300" name="JackrabbitValue-core.patch" size="12460" author="tmueller" created="Wed, 7 Jan 2009 14:13:15 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 7 Jan 2009 17:09:02 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142907</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>280018</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>