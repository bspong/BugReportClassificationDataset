<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:48:11 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1148/JCR-1148.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1148] NullPointerException in ItemState</title>
                <link>https://issues.apache.org/jira/browse/JCR-1148</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The following happens quite regularly when multiple threads are adding, retrieving and removing nodes simultaneously. Looking at the code of the pull method, this seems due to under-synchronization somewhere as overlayedState was tested at line 153 for null.&lt;br/&gt;
&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.ItemState.pull(ItemState.java:156)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.stateModified(LocalItemStateManager.java:421)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.StateChangeDispatcher.notifyStateModified(StateChangeDispatcher.java:85)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.stateModified(SharedItemStateManager.java:434)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.ItemState.notifyStateUpdated(ItemState.java:241)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.ChangeLog.persisted(ChangeLog.java:271)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager$Update.end(SharedItemStateManager.java:741)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.update(SharedItemStateManager.java:937)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:327)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.XAItemStateManager.update(XAItemStateManager.java:313)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:303)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SessionItemStateManager.update(SessionItemStateManager.java:307)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1374)</description>
                <environment></environment>
            <key id="12379275">JCR-1148</key>
            <summary>NullPointerException in ItemState</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="martijnh">Martijn Hendriks</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Sep 2007 12:28:22 +0100</created>
                <updated>Tue, 2 Jun 2009 13:18:27 +0100</updated>
                    <resolved>Wed, 19 Dec 2007 10:41:45 +0000</resolved>
                            <version>1.3</version>
                <version>1.3.1</version>
                <version>1.3.3</version>
                                <fixVersion>1.4</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12531022" author="efranqueiro" created="Fri, 28 Sep 2007 15:18:46 +0100"  >This issue is the same one Pablo mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-935&quot; title=&quot;ConcurrentModificationException during logout (cont&amp;#39;d)&quot;&gt;JCR-935&lt;/a&gt;. Are you using the fine grained locking strategy? Because in our testing this happened when using it.</comment>
                    <comment id="12531025" author="stefan@jira" created="Fri, 28 Sep 2007 15:31:47 +0100"  >what configuration are you using? any custom code/modifications involved?&lt;br/&gt;
&lt;br/&gt;
are you able to reproduce it with an out-of-the-box jackrabbit release? &lt;br/&gt;
&lt;br/&gt;
could you perhaps provide a simple test case?</comment>
                    <comment id="12531432" author="martijnh" created="Mon, 1 Oct 2007 08:54:10 +0100"  >&amp;gt; This issue is the same one Pablo mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-935&quot; title=&quot;ConcurrentModificationException during logout (cont&amp;#39;d)&quot;&gt;JCR-935&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Indeed, I didn&amp;#39;t search JIRA well enough...&lt;br/&gt;
&lt;br/&gt;
&amp;gt; what configuration are you using? any custom code/modifications involved?&lt;br/&gt;
&amp;gt; are you able to reproduce it with an out-of-the-box jackrabbit release?&lt;br/&gt;
&lt;br/&gt;
We&amp;#39;re using a patched 1.3 version, but I just reproduced it with the clean 1.3 release.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; could you perhaps provide a simple test case?&lt;br/&gt;
&lt;br/&gt;
I will try. The problem is that this issue turned up during an integration test from which it is a long way down to Jackrabbit code.</comment>
                    <comment id="12532033" author="martijnh" created="Wed, 3 Oct 2007 08:51:05 +0100"  >Here are the stacktraces of two threads involved in the NPE:&lt;br/&gt;
&lt;br/&gt;
The thread that throws the NPE (line information in ItemState has been changed due to debugging code):&lt;br/&gt;
&lt;br/&gt;
Thread [Thread-38] (Suspended (breakpoint at line 158 in ItemState))	&lt;br/&gt;
	NodeState(ItemState).pull() line: 158	&lt;br/&gt;
	XAItemStateManager(LocalItemStateManager).stateModified(ItemState) line: 420	&lt;br/&gt;
	StateChangeDispatcher.notifyStateModified(ItemState) line: 85	&lt;br/&gt;
	SharedItemStateManager.stateModified(ItemState) line: 390	&lt;br/&gt;
	NodeState(ItemState).notifyStateUpdated() line: 244	&lt;br/&gt;
	ChangeLog.persisted() line: 271	&lt;br/&gt;
	SharedItemStateManager$Update.end() line: 702	&lt;br/&gt;
	SharedItemStateManager.update(ChangeLog, EventStateCollectionFactory) line: 855	&lt;br/&gt;
	XAItemStateManager(LocalItemStateManager).update(ChangeLog) line: 326	&lt;br/&gt;
	XAItemStateManager.update(ChangeLog) line: 313	&lt;br/&gt;
	XAItemStateManager(LocalItemStateManager).update() line: 302	&lt;br/&gt;
	SessionItemStateManager.update() line: 306	&lt;br/&gt;
	NodeImpl(ItemImpl).save() line: 1214	&lt;br/&gt;
	XASessionImpl(SessionImpl).save() line: 849	&lt;br/&gt;
&lt;br/&gt;
The thread that just reset the overlayedState of the ItemState in the above thread to null:&lt;br/&gt;
&lt;br/&gt;
	ItemState.disconnect(ItemState.java:209)&lt;br/&gt;
	ChangeLog.modified(ChangeLog.java:70)&lt;br/&gt;
	LocalItemStateManager.store(LocalItemStateManager.java:268)&lt;br/&gt;
	SessionItemStateManager.store(SessionItemStateManager.java:283)&lt;br/&gt;
	NodeImpl.makePersistent(NodeImpl.java:984)&lt;br/&gt;
	ItemImpl.persistTransientItems(ItemImpl.java:687)&lt;br/&gt;
	ItemImpl.save(ItemImpl.java:1198)&lt;br/&gt;
	SessionImpl.save(SessionImpl.java:849)&lt;br/&gt;
&lt;br/&gt;
The problem is that saving causes a call to disconnect of an ItemState of the LocalItemStateManager, and that saving another session in another thread causes a call to pull of that ItemState through the SISM notification mechanism.</comment>
                    <comment id="12552436" author="mreutegg" created="Mon, 17 Dec 2007 15:11:53 +0000"  >I&amp;#39;m able to reproduce this issue with the test case ConcurrentyTest.testConcurrentWritingSessions() and FineGrainedISMLocking.</comment>
                    <comment id="12552437" author="mreutegg" created="Mon, 17 Dec 2007 15:15:52 +0000"  >Proposed fix.</comment>
                    <comment id="12552810" author="jukkaz" created="Tue, 18 Dec 2007 16:42:36 +0000"  >Looks good enough, though I must admit I&amp;#39;m having a hard time understanding the relevant data and control flows.</comment>
                    <comment id="12553293" author="mreutegg" created="Wed, 19 Dec 2007 10:41:45 +0000"  >Thank you for reviewing the patch.&lt;br/&gt;
&lt;br/&gt;
I committed the patch in revision 605509</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310000">
                <name>Duplicate</name>
                                                <inwardlinks description="is duplicated by">
                            <issuelink>
            <issuekey id="12426686">JCR-2126</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12371805" name="JCR-1148.patch" size="4930" author="mreutegg" created="Mon, 17 Dec 2007 15:15:52 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 28 Sep 2007 14:18:46 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78646</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190100</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>