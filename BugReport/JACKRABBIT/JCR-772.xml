<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:34:35 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-772/JCR-772.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-772] Merging between workspaces fails</title>
                <link>https://issues.apache.org/jira/browse/JCR-772</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I have setup 2 workspaces in Jackrabbit.  I have a preview and a production&lt;br/&gt;
workspace.  These workspaces keep a tree of menu nodes that can have content&lt;br/&gt;
associated to those menus.  Each node is of type nt:unstructured and has&lt;br/&gt;
mixin types of versionable, lockable, and referenceable.&lt;br/&gt;
&lt;br/&gt;
In our system you are only allowed to edit nodes in the preview workspace.&lt;br/&gt;
So what I do is when you go to edit a node we check it out, allow for edits,&lt;br/&gt;
then check it in.  This creates a new version on the node.  Then we merge&lt;br/&gt;
the node up to the production workspace.  All nodes in the production&lt;br/&gt;
workspace are always checked in and not locked.&lt;br/&gt;
&lt;br/&gt;
When I go to do a merge I run into problems when I try to merge a node that&lt;br/&gt;
has children.  Lets say I have node A with children B and C.  These all have&lt;br/&gt;
the same node types as stated above.  I make a change to a property in Node&lt;br/&gt;
A in the preview workspace and now want to merge it into the production&lt;br/&gt;
workspace (where it exists already).  Here is the code that is run:&lt;br/&gt;
&lt;br/&gt;
Node destNode = destSession.getNodeByUUID(getUUID());&lt;br/&gt;
NodeIterator ni = destNode.merge(&amp;quot;preview&amp;quot;, true);&lt;br/&gt;
&lt;br/&gt;
Now this fails in the ItemImpl.internalRemove() method with a&lt;br/&gt;
VersionException of cannot remove a child of a checked-in node.  Here is the&lt;br/&gt;
trace for the error:&lt;br/&gt;
at org.apache.jackrabbit.core.ItemImpl.internalRemove(ItemImpl.java:848)&lt;br/&gt;
at org.apache.jackrabbit.core.NodeImpl.internalMerge(NodeImpl.java:3693)&lt;br/&gt;
at org.apache.jackrabbit.core.NodeImpl.internalMerge(NodeImpl.java:3587)&lt;br/&gt;
at org.apache.jackrabbit.core.NodeImpl.merge(NodeImpl.java:3003)&lt;br/&gt;
&lt;br/&gt;
Now if I understand correctly when doing a merge the node that you are&lt;br/&gt;
trying to merge to needs to be older then the source node and the&lt;br/&gt;
destination node cannot be checked out (NodeImpl.doMergeTest() is where I&lt;br/&gt;
figured that out).  But then when I step through further in the merge in&lt;br/&gt;
NodeImpl it gets all the nodes of the src node and retrieves the same&lt;br/&gt;
children in the destination workspace and then tries to remove those&lt;br/&gt;
destination children but it can&amp;#39;t remove those children b/c the parent node&lt;br/&gt;
(which is node A in the production workspace) is not checked out, but&lt;br/&gt;
according to the mergeTest it can&amp;#39;t be checked out or the merge won&amp;#39;t even&lt;br/&gt;
begin.</description>
                <environment></environment>
            <key id="12363880">JCR-772</key>
            <summary>Merging between workspaces fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tripod">Tobias Bocanegra</assignee>
                                <reporter username="tripod">Tobias Bocanegra</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Mar 2007 13:40:21 +0000</created>
                <updated>Fri, 9 Mar 2007 08:42:24 +0000</updated>
                    <resolved>Thu, 1 Mar 2007 17:23:45 +0000</resolved>
                            <version>0.9</version>
                <version>1.0</version>
                <version>1.0.1</version>
                <version>1.1</version>
                <version>1.1.1</version>
                <version>1.2.1</version>
                <version>1.2.2</version>
                                <fixVersion>1.2.3</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12477033" author="tripod" created="Thu, 1 Mar 2007 17:23:45 +0000"  >fixed.</comment>
                    <comment id="12477629" author="jukkaz" created="Sat, 3 Mar 2007 14:14:42 +0000"  >Tagging this still for 1.2.3.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 3 Mar 2007 14:14:42 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80333</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190624</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>