<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:54:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-463/JCR-463.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-463] Uncommitted changes or connection leak with Container Managed Transactions</title>
                <link>https://issues.apache.org/jira/browse/JCR-463</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Apparently the connector doesn&amp;#39;t support CMT (container managed transactions). if the jcr session is closed inside a CMT the AS (application server) throws an exception on commit. And if the jcr session is leaved open, the AS commits the TX successfully but it causes a connection leak by leaving the session open.</description>
                <environment></environment>
            <key id="12344472">JCR-463</key>
            <summary>Uncommitted changes or connection leak with Container Managed Transactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jukkaz">Jukka Zitting</assignee>
                                <reporter username="edgarpoce">Edgar Poce</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jun 2006 08:40:00 +0100</created>
                <updated>Fri, 13 Oct 2006 17:03:17 +0100</updated>
                    <resolved>Sun, 17 Sep 2006 09:19:44 +0100</resolved>
                            <version>1.0</version>
                <version>1.0.1</version>
                                <fixVersion>1.1</fixVersion>
                                <component>jackrabbit-jca</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12416437" author="edgarpoce" created="Fri, 16 Jun 2006 10:17:57 +0100"  >The proposed patch *OPTIONALLY* binds the jcr session handle to the active transaction. When the tx is committed the session handle will be closed. The transaction will fail if the session is closed inside a transaction.&lt;br/&gt;
&lt;br/&gt;
The behaviour for CMT is different from the one described in the JCR specification (8.1.1), the logout call specifically.  &lt;br/&gt;
The logout should be permitted but it should be ignored when it&amp;#39;s inside a transaction? feedback is welcome.&lt;br/&gt;
&lt;br/&gt;
CMT (container managed transactions):&lt;br/&gt;
	public void test() throws Exception {&lt;br/&gt;
		InitialContext ctx = new InitialContext() ;&lt;br/&gt;
		Repository repo = (Repository) ctx.lookup(&amp;quot;java:jcr/local&amp;quot;) ;&lt;br/&gt;
		Credentials cred = new SimpleCredentials(&amp;quot;ed&amp;quot;,new char[]{&amp;#39;e&amp;#39;,&amp;#39;d&amp;#39;}) ;&lt;br/&gt;
		Session s = repo.login(cred) ;&lt;br/&gt;
		s.getRootNode().addNode(&amp;quot;node&amp;quot;) ;&lt;br/&gt;
		s.save();&lt;br/&gt;
	}&lt;br/&gt;
&lt;br/&gt;
BMT (bean managed transactions) behaves the same as before&lt;br/&gt;
	public void test() throws Exception {&lt;br/&gt;
	        utx.begin() ;&lt;br/&gt;
		InitialContext ctx = new InitialContext();&lt;br/&gt;
		Repository repo = (Repository) ctx.lookup(&amp;quot;java:jcr/local&amp;quot;);&lt;br/&gt;
		Credentials cred = new SimpleCredentials(&amp;quot;ed&amp;quot;, new char[] { &amp;#39;e&amp;#39;, &amp;#39;d&amp;#39; });&lt;br/&gt;
		Session s = repo.login(cred);&lt;br/&gt;
		s.getRootNode().addNode(&amp;quot;node&amp;quot;);&lt;br/&gt;
		s.save();&lt;br/&gt;
		utx.commit() ;&lt;br/&gt;
		s.logout() ;&lt;br/&gt;
	}</comment>
                    <comment id="12435217" author="jukkaz" created="Sat, 16 Sep 2006 13:39:59 +0100"  >Do you think this should be included in Jackrabbit 1.1? Some notes:&lt;br/&gt;
&lt;br/&gt;
1) TransactionBoundXAResource.java doesn&amp;#39;t have the standard license header.&lt;br/&gt;
&lt;br/&gt;
2) Is this backwards compatible or were previous versions just unusable due to the reported issue? If no, should the default value of the configuration option be false, at least for now?</comment>
                    <comment id="12435258" author="edgarpoce" created="Sat, 16 Sep 2006 19:51:01 +0100"  >&amp;gt; Do you think this should be included in Jackrabbit 1.1?&lt;br/&gt;
In case there isn&amp;#39;t a better patch I think it should. IMO a better patch should bind the xaresource lifecylcle to the tx only if the session was logged out inside the tx. I&amp;#39;ll try to prepare the patch the next week, in case it&amp;#39;s late for the release you are planning I think we should commit this patch as it is with the correct license header.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; 1) TransactionBoundXAResource.java doesn&amp;#39;t have the standard license header. &lt;br/&gt;
It wasn&amp;#39;t intended to be commited as it is. &lt;br/&gt;
&lt;br/&gt;
&amp;gt; 2) Is this backwards compatible or were previous versions just unusable due to the reported &lt;br/&gt;
&amp;gt; issue? &lt;br/&gt;
IMO the previous versions were unusable in the context of container managed transactions.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; If no, should the default value of the configuration option be false, at least for now?&lt;br/&gt;
It can be set to false if the client don&amp;#39;t use it in container managed transactions.&lt;br/&gt;
</comment>
                    <comment id="12435263" author="jukkaz" created="Sat, 16 Sep 2006 20:24:06 +0100"  >OK, thanks. I&amp;#39;ll apply the patch with the added license header for the release candidate tomorrow. If you have some modifications in mind, then it&amp;#39;s still OK to commit those in next week before the release.</comment>
                    <comment id="12435292" author="jukkaz" created="Sun, 17 Sep 2006 09:19:44 +0100"  >Patch applied in revision 446971.</comment>
                    <comment id="12439871" author="junglika" created="Wed, 4 Oct 2006 16:48:11 +0100"  >I think that the &amp;quot;logout method&amp;quot; (in JCASessionHandle) isn&amp;#39;t totally  correct. I consider that we must check, before closing session, if this session is binded to a transaction. In this situation the session mustn&amp;#39;t be closed: transaction  will close it.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void logout() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	if (!mc.getManagedConnectionFactory().getBindSessionToTrasaction().booleanValue()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;		mc.closeHandle(this);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
For example this is very important when we use spring, springmodules (jcr module) and jackrabbit because the springmodules library closes session when local transaction finishes. And if the session is closed by transaction a exception is throwed.&lt;br/&gt;
&lt;br/&gt;
Thanks</comment>
                </comments>
                    <attachments>
                    <attachment id="12335530" name="jca-bintToTransaction.diff" size="5282" author="edgarpoce" created="Fri, 16 Jun 2006 10:17:57 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 16 Sep 2006 12:39:59 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80429</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191102</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>