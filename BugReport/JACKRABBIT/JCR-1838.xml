<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:50:39 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1838/JCR-1838.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1838] Garbage collection deletes temporary files in FileDataStore</title>
                <link>https://issues.apache.org/jira/browse/JCR-1838</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>In FileDataStore.addRecord(InputStream), a temporary file is created. The data is written to the file and then it is moved to its final location (based on the contents hash).&lt;br/&gt;
&lt;br/&gt;
If the garbage collector runs whilst this temp file is present, it deletes it (on Solaris 10 at least), and the addRecord fails at the attempt to rename the now non-existent temp file.&lt;br/&gt;
&lt;br/&gt;
I am attaching a minimal patch that prevents these temp files being deleted by deleteOlderRecursive(..), regardless of their lastModified() value.&lt;br/&gt;
&lt;br/&gt;
I have made this a Minor priority, since there is the obvious workaround of disabling the GC.&lt;br/&gt;
</description>
                <environment>Solaris 10, JDK 1.6.0_03&lt;br/&gt;
</environment>
            <key id="12407241">JCR-1838</key>
            <summary>Garbage collection deletes temporary files in FileDataStore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tmueller">Thomas Mueller</assignee>
                                <reporter username="pkd">Peter Dettman</reporter>
                        <labels>
                    </labels>
                <created>Sun, 26 Oct 2008 12:21:55 +0000</created>
                <updated>Tue, 20 Jan 2009 15:02:44 +0000</updated>
                    <resolved>Wed, 17 Dec 2008 14:45:51 +0000</resolved>
                            <version>core 1.4.6</version>
                <version>1.5</version>
                                <fixVersion>core 1.4.7</fixVersion>
                <fixVersion>1.5.2</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12642789" author="pkd" created="Sun, 26 Oct 2008 12:26:43 +0000"  >Patch to prevent temporary files being deleted during garbage collection.&lt;br/&gt;
</comment>
                    <comment id="12643186" author="tmueller" created="Tue, 28 Oct 2008 11:28:02 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
Temporary files are only deleted if they are old. Is there anything special with your use case, for example: do you have a small repository (so that scanning it is very quick), or is streaming the data specially slow?&lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
Thomas&lt;br/&gt;
</comment>
                    <comment id="12643188" author="pkd" created="Tue, 28 Oct 2008 12:02:38 +0000"  >Yes, a quite small repository (a few large items), and the streaming of data is also slow.&lt;br/&gt;
&lt;br/&gt;
It seems that FileDataStore relies on the tmp file being updated at least once (at least one block is written?) b/w the GC calls to updateModifiedDateOnAccess(..) and deleteAllOlderThan(..). If not, then the lastModified() value on the tmpFile is &amp;quot;old&amp;quot;, and it is deleted.&lt;br/&gt;
&lt;br/&gt;
The attached patch fixes my immediate problems, but tmp files may then leak under some circumstances. There is the option of simply using deleteOnExit() on these files.&lt;br/&gt;
&lt;br/&gt;
Alternatively, tmp files could be tracked by the &amp;#39;inUse&amp;#39; map, or something similar.&lt;br/&gt;
</comment>
                    <comment id="12657405" author="tmueller" created="Wed, 17 Dec 2008 14:45:51 +0000"  >Committed in revision 727402</comment>
                    <comment id="12657438" author="jukkaz" created="Wed, 17 Dec 2008 16:21:06 +0000"  >Merged to the 1.5 branch in revision 727426.</comment>
                    <comment id="12663738" author="jukkaz" created="Wed, 14 Jan 2009 13:00:05 +0000"  >Merged also to the 1.4 branch in revision 734374.</comment>
                </comments>
                    <attachments>
                    <attachment id="12392835" name="jcr1838.diff" size="1048" author="pkd" created="Sun, 26 Oct 2008 12:26:42 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 28 Oct 2008 11:28:02 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78410</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>252614</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>