<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:32:56 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2417/JCR-2417.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2417] RepositoryException when using BindVariables in JCR-SQL2 CONTAINS</title>
                <link>https://issues.apache.org/jira/browse/JCR-2417</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>When using a BindVariable in a JCR-SQL2 CONTAINS constraint, the query fails with a RepositoryException.&lt;br/&gt;
&lt;br/&gt;
For example:&lt;br/&gt;
&lt;br/&gt;
String sql = &amp;quot;SELECT * FROM [nt:unstructured] WHERE ISCHILDNODE([/testroot]) AND CONTAINS(mytext, $searchExpression)&amp;quot;;&lt;br/&gt;
Query q = superuser.getWorkspace().getQueryManager().createQuery(sql, Query.JCR_SQL2);&lt;br/&gt;
q.bindValue(&amp;quot;searchExpression&amp;quot;, superuser.getValueFactory().createValue(&amp;quot;fox&amp;quot;));&lt;br/&gt;
q.execute();&lt;br/&gt;
&lt;br/&gt;
Results in:&lt;br/&gt;
&lt;br/&gt;
javax.jcr.RepositoryException: Unknown static operand type: &lt;a href=&apos;mailto:org.apache.jackrabbit.spi.commons.query.qom.BindVariableValueImpl@591a4d&apos;&gt;org.apache.jackrabbit.spi.commons.query.qom.BindVariableValueImpl@591a4d&lt;/a&gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.LuceneQueryFactoryImpl.create(LuceneQueryFactoryImpl.java:215)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.constraint.FullTextConstraint.&amp;lt;init&amp;gt;(FullTextConstraint.java:42)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.constraint.ConstraintBuilder$Visitor.visit(ConstraintBuilder.java:175)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.spi.commons.query.qom.FullTextSearchImpl.accept(FullTextSearchImpl.java:117)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.constraint.ConstraintBuilder$Visitor.visit(ConstraintBuilder.java:137)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.spi.commons.query.qom.AndImpl.accept(AndImpl.java:72)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.constraint.ConstraintBuilder.create(ConstraintBuilder.java:82)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.lucene.QueryObjectModelImpl.execute(QueryObjectModelImpl.java:109)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.QueryImpl.execute(QueryImpl.java:127)&lt;br/&gt;
&lt;br/&gt;
I tried to fix this issue but there is no way to access the BindVariables from the ConstraintBuilder from the LuceneQueryFactoryImpl and the ConstraintBuilder just passes the FullTextSearchImpl QOM subtree to the factory (via FullTextConstraint constructor) without any further visiting. If the signature would be &amp;quot;LuceneQueryFactoryImpl#create(FullTextSearchImpl fts, Value searchExpression)&amp;quot; we could visit the StaticOperand in the ConstraintBuilder and then modify the FullTextSearchImpl constructor accordingly, but this would imply that LuceneQueryFactory interface would need to be change accordingly and I don&amp;#39;t know what that would mean.</description>
                <environment></environment>
            <key id="12442117">JCR-2417</key>
            <summary>RepositoryException when using BindVariables in JCR-SQL2 CONTAINS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="buge">Philipp Bunge</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2009 17:17:55 +0000</created>
                <updated>Tue, 27 Apr 2010 09:23:06 +0100</updated>
                    <resolved>Mon, 8 Feb 2010 14:06:25 +0000</resolved>
                            <version>2.0-beta3</version>
                <version>2.0</version>
                                <fixVersion>2.1</fixVersion>
                                <component>query</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12784797" author="buge" created="Wed, 2 Dec 2009 12:34:21 +0000"  >A suggested solution for the bug including a corresponding unittest.</comment>
                    <comment id="12784799" author="buge" created="Wed, 2 Dec 2009 12:36:06 +0000"  >I&amp;#39;ve attached a patch which offers a possible solution which initializes the LuceneQueryFactoryImpl with the bind variable values and therefore does not require a change of the LuceneQueryFactory interface.</comment>
                    <comment id="12830029" author="buge" created="Fri, 5 Feb 2010 09:39:39 +0000"  >Fixed license header.</comment>
                    <comment id="12830946" author="mreutegg" created="Mon, 8 Feb 2010 14:06:25 +0000"  >Applied patch with minor changes (see below) to trunk in revision: 907659&lt;br/&gt;
&lt;br/&gt;
Fixed a minor javadoc issue and exception type in LuceneQueryFactoryImpl.&lt;br/&gt;
&lt;br/&gt;
Thanks a lot for the patch.</comment>
                </comments>
                    <attachments>
                    <attachment id="12434945" name="contains_with_bind_variable.patch" size="9079" author="buge" created="Fri, 5 Feb 2010 09:39:39 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 8 Feb 2010 14:06:25 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78223</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190306</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>