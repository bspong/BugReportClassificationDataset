<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:34:29 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-929/JCR-929.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-929] Under Heavy load in a Cluster HTTP Threads Block and stall requests</title>
                <link>https://issues.apache.org/jira/browse/JCR-929</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Under Heavy load created by mounting both nodes in the cluster in OSX Finder and then uploading large numebers of files to each node at the same time ( a few 1000), eventually one of the nodes stops responding and the Finder mount timesout and disconnects.&lt;br/&gt;
&lt;br/&gt;
Once that happens that node becomes unusable.&lt;br/&gt;
More mount attempts will prompt for a password indicating HTTP is still running, but will timeout once the connection is authenticated.&lt;br/&gt;
Access by the Web Browser will prompt for a password, conenct and provide a once only listing of any collection in the workspace. If you try to refresh that collection, the HTTP request hangs forever.</description>
                <environment>2 Node Cluster, OSX, JDK 1.5 with DatabaseJournal, DatabasePersistanceManager, all content in DB, using WebDAV to load</environment>
            <key id="12369651">JCR-929</key>
            <summary>Under Heavy load in a Cluster HTTP Threads Block and stall requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="dpfister">Dominique Pfister</assignee>
                                <reporter username="ianeboston">Ian Boston</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2007 08:40:57 +0100</created>
                <updated>Mon, 6 Aug 2007 07:45:58 +0100</updated>
                    <resolved>Mon, 11 Jun 2007 09:12:53 +0100</resolved>
                            <version>1.3</version>
                                <fixVersion>1.3.1</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12496808" author="ianeboston" created="Fri, 18 May 2007 08:44:56 +0100"  >Restarting the cluster node with the problem appears to clear the problem with no bad effects to the JCR,&lt;br/&gt;
&lt;br/&gt;
There are no deadlocks reported on any threads on the locked nodes and other https requests that do not use the JCR are operating correctly. &lt;br/&gt;
&lt;br/&gt;
Connecting a Profiler like JProfiler to the JVM on startup indicates that there are no blocked threads, and no deadlocks are detected.&lt;br/&gt;
&lt;br/&gt;
Adding a mbean monitor thread to analyse the threads within the JVM indicates that there are no blocked threads when the node stops responding.&lt;br/&gt;
&lt;br/&gt;
It does not look like this is a deadlock condition.</comment>
                    <comment id="12496810" author="ianeboston" created="Fri, 18 May 2007 08:51:07 +0100"  >&lt;br/&gt;
If the mbean monitor code looks at waiting threads 2 threads are found to go into a permanent wait state.&lt;br/&gt;
&lt;br/&gt;
The ClusterNode thread (used by the cluster node to replay journal entries) goes into a permanent wait state  on a RenetrantLock object within the LockManagerImpl&lt;br/&gt;
&lt;br/&gt;
Thread ClusterNode-localhost2 waiting by &lt;a href=&apos;mailto:EDU.oswego.cs.dl.util.concurrent.ReentrantLock@6c6ff1&apos;&gt;EDU.oswego.cs.dl.util.concurrent.ReentrantLock@6c6ff1&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.acquire(LockManagerImpl.java:599)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.nodeAdded(LockManagerImpl.java:838)&lt;br/&gt;
&lt;br/&gt;
And the HTTP threads all go into a permanent wait state  (when they access the JCR) in the AbstractJournal.lockAndSync on a WriterLock&lt;br/&gt;
&lt;br/&gt;
Thread http-8580-Processor23 waiting by EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$&lt;a href=&apos;mailto:WriterLock@8065c9&apos;&gt;WriterLock@8065c9&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474) &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.lockAndSync(AbstractJournal.java:228)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DefaultRecordProducer.append(DefaultRecordProducer.java:51) &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The LockManagerImpl.acquire contains a for(;;) loop that will loop forever if the lock is not aquired, I am putting some debug in the catch to see if the loop is spinning or if the wait is forever.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
I will also try and tracedown the objects being waited on to see if they give any clues to what is effectively deadlocking.&lt;br/&gt;
</comment>
                    <comment id="12496813" author="ianeboston" created="Fri, 18 May 2007 09:19:05 +0100"  >The reverse pattern also appears,&lt;br/&gt;
&lt;br/&gt;
The ClusterNode thread waiting in AbstractJournal.sync&lt;br/&gt;
&lt;br/&gt;
and the http threads waiting in the LockManagerImpl.aquire&lt;br/&gt;
&lt;br/&gt;
-----&lt;br/&gt;
&lt;br/&gt;
The previous case was ClusterNode thread in LockManagerImpl.aquire &lt;br/&gt;
&lt;br/&gt;
and http thread waiting in AbstractJournal.lockAndSync&lt;br/&gt;
&lt;br/&gt;
This indicates that both sets of threads interact with the locks in both places raising the potential for an interlock to happen.&lt;br/&gt;
&lt;br/&gt;
Since the AbstractJournal is the newer code, perhapse it should perform a LockManagerImpl aquire earlier than it does ?&lt;br/&gt;
&lt;br/&gt;
-----&lt;br/&gt;
&lt;br/&gt;
There is no indication that the spin lock inside LockManagerImpl.aquire ever comes out of the wait condition, except on a interupt to the JVM, at which point it goes back into the aquire.&lt;br/&gt;
&lt;br/&gt;
This prevents the JCR from shutting down since the shutdown operation also needs to aquire a lock.&lt;br/&gt;
&lt;br/&gt;
Will investicate the call tree to see if its possible to change the locking order to prevent the interlock without hitting performance</comment>
                    <comment id="12497390" author="mreutegg" created="Mon, 21 May 2007 10:16:32 +0100"  >Can you please attach the full stacktrace of the involved threads?</comment>
                    <comment id="12499116" author="ianeboston" created="Fri, 25 May 2007 16:26:00 +0100"  >&lt;br/&gt;
There is a stack trace of a node locked in waiting, the HTTP are locked and every request to this node, that hits the http thread will block in the same wait pattern&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Starting Thread Monitor ==================&lt;br/&gt;
Thread Transient File Reaper waiting by java.lang.ref.ReferenceQueue$&lt;a href=&apos;mailto:Lock@4622f&apos;&gt;Lock@4622f&lt;/a&gt; ::WAITING at org.apache.jackrabbit.util.TransientFileFactory$ReaperThread.run(TransientFileFactory.java:148)&lt;br/&gt;
Thread TP-Processor3 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@eb38d2&apos;&gt;ControlRunnable@eb38d2&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread TP-Processor2 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@df787e&apos;&gt;ControlRunnable@df787e&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread TP-Processor1 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@5fa15c&apos;&gt;ControlRunnable@5fa15c&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor25 waiting by &lt;a href=&apos;mailto:EDU.oswego.cs.dl.util.concurrent.ReentrantLock@5036f6&apos;&gt;EDU.oswego.cs.dl.util.concurrent.ReentrantLock@5036f6&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.acquire(LockManagerImpl.java:599)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.externalLock(LockManagerImpl.java:973)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.process(ClusterNode.java:723)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.consume(ClusterNode.java:910)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.doSync(AbstractJournal.java:191)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.lockAndSync(AbstractJournal.java:241)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DefaultRecordProducer.append(DefaultRecordProducer.java:51)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceUpdateChannel.updateCreated(ClusterNode.java:466)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager$Update.begin(SharedItemStateManager.java:530)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.beginUpdate(SharedItemStateManager.java:825)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.update(SharedItemStateManager.java:855)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:326)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.XAItemStateManager.update(XAItemStateManager.java:313)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:302)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SessionItemStateManager.update(SessionItemStateManager.java:306)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1214)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.NodeImpl.lock(NodeImpl.java:4070)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.lock(DavResourceImpl.java:685)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doLock(AbstractWebdavServlet.java:689)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:259)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8580-Processor24 waiting by EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$&lt;a href=&apos;mailto:WriterLock@488a98&apos;&gt;WriterLock@488a98&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.lockAndSync(AbstractJournal.java:228)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DefaultRecordProducer.append(DefaultRecordProducer.java:51)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceLockChannel.unlocked(ClusterNode.java:637)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.internalUnlock(LockManagerImpl.java:338)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.unlock(LockManagerImpl.java:428)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.XALockManager.unlock(XALockManager.java:103)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.NodeImpl.unlock(NodeImpl.java:4133)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.unlock(DavResourceImpl.java:739)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doUnlock(AbstractWebdavServlet.java:710)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:262)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8580-Processor22 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@40eb2a&apos;&gt;ControlRunnable@40eb2a&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor21 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@f45d1&apos;&gt;ControlRunnable@f45d1&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor20 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@b0cea2&apos;&gt;ControlRunnable@b0cea2&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor19 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@ce1b2b&apos;&gt;ControlRunnable@ce1b2b&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor18 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@59c4c6&apos;&gt;ControlRunnable@59c4c6&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor17 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@85ded7&apos;&gt;ControlRunnable@85ded7&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor16 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@e90ea7&apos;&gt;ControlRunnable@e90ea7&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor15 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@c11ce0&apos;&gt;ControlRunnable@c11ce0&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor14 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@4ecfa4&apos;&gt;ControlRunnable@4ecfa4&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor13 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@225841&apos;&gt;ControlRunnable@225841&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor12 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@d034cf&apos;&gt;ControlRunnable@d034cf&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor11 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3b1da2&apos;&gt;ControlRunnable@3b1da2&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor10 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@16b458&apos;&gt;ControlRunnable@16b458&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor9 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@9a3769&apos;&gt;ControlRunnable@9a3769&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor8 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@abd36b&apos;&gt;ControlRunnable@abd36b&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor7 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@c54d06&apos;&gt;ControlRunnable@c54d06&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor6 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@43f502&apos;&gt;ControlRunnable@43f502&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor5 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@8a7951&apos;&gt;ControlRunnable@8a7951&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor4 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@22da8f&apos;&gt;ControlRunnable@22da8f&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor3 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3af3cb&apos;&gt;ControlRunnable@3af3cb&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor2 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@5ba3ee&apos;&gt;ControlRunnable@5ba3ee&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8580-Processor1 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@67770f&apos;&gt;ControlRunnable@67770f&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread ClusterNode-node2 waiting by EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$&lt;a href=&apos;mailto:ReaderLock@aaab5d&apos;&gt;ReaderLock@aaab5d&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$ReaderLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$ReaderLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.sync(AbstractJournal.java:160)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.sync(ClusterNode.java:283)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode.run(ClusterNode.java:254)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@7dfc02&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@7dfc02&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@9d85b&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@9d85b&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread ObservationManager waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@5b60bf&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@5b60bf&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread Finalizer waiting by java.lang.ref.ReferenceQueue$&lt;a href=&apos;mailto:Lock@99d183&apos;&gt;Lock@99d183&lt;/a&gt; ::WAITING&lt;br/&gt;
Thread Reference Handler waiting by java.lang.ref.Reference$&lt;a href=&apos;mailto:Lock@1de95a&apos;&gt;Lock@1de95a&lt;/a&gt; ::WAITING&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Done Thread Monitor ==================</comment>
                    <comment id="12499122" author="ianeboston" created="Fri, 25 May 2007 16:51:29 +0100"  >&lt;br/&gt;
&lt;br/&gt;
Im not certain about this, but I think the aquire in te sync from the ClusterNode should be an attempt, and if it fails, it should back put and wait for the next cycle.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll give it a go and see what happens&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12499128" author="ianeboston" created="Fri, 25 May 2007 17:07:11 +0100"  >Doing that causes the ClusterNode thread to timeout but the 2 http threads go into waiting state, so they must be interlocking on waits somewhere. &lt;br/&gt;
&lt;br/&gt;
I cant really do an attempt in the main threads since if the operation doesnt get to the journal then it wont propagate, and doing a back off would have to back off far enough to undo the interlock.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The pattern looks slightly different now,  to I might have fixed the first problem.... sorry about all the long stack traces but  its going to be confusing if not in context.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Starting Thread Monitor ==================&lt;br/&gt;
Thread Transient File Reaper waiting by java.lang.ref.ReferenceQueue$&lt;a href=&apos;mailto:Lock@8da92&apos;&gt;Lock@8da92&lt;/a&gt; ::WAITING at org.apache.jackrabbit.util.TransientFileFactory$ReaperThread.run(TransientFileFactory.java:148)&lt;br/&gt;
Thread Transient File Reaper waiting by java.lang.ref.ReferenceQueue$&lt;a href=&apos;mailto:Lock@b410a&apos;&gt;Lock@b410a&lt;/a&gt; ::WAITING at org.apache.jackrabbit.util.TransientFileFactory$ReaperThread.run(TransientFileFactory.java:148)&lt;br/&gt;
Thread TP-Processor3 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@64886c&apos;&gt;ControlRunnable@64886c&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread TP-Processor2 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@388e0b&apos;&gt;ControlRunnable@388e0b&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread TP-Processor1 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@f59ac1&apos;&gt;ControlRunnable@f59ac1&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor25 waiting by &lt;a href=&apos;mailto:EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&apos;&gt;EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.acquire(LockManagerImpl.java:599)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.nodeAdded(LockManagerImpl.java:840)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.onEvent(LockManagerImpl.java:745)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.EventConsumer.consumeEvents(EventConsumer.java:231)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.ObservationDispatcher.dispatchEvents(ObservationDispatcher.java:201)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.observation.EventStateCollection.dispatch(EventStateCollection.java:424)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager$Update.end(SharedItemStateManager.java:721)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SharedItemStateManager.update(SharedItemStateManager.java:855)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:326)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.XAItemStateManager.update(XAItemStateManager.java:313)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:302)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.state.SessionItemStateManager.update(SessionItemStateManager.java:306)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1214)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.addMember(DavResourceImpl.java:517)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doPut(AbstractWebdavServlet.java:504)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:241)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8080-Processor23 waiting by EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$&lt;a href=&apos;mailto:WriterLock@bd12a5&apos;&gt;WriterLock@bd12a5&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.WriterPreferenceReadWriteLock$WriterLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.AbstractJournal.lockAndSync(AbstractJournal.java:233)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.journal.DefaultRecordProducer.append(DefaultRecordProducer.java:51)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceLockChannel.unlocked(ClusterNode.java:637)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.internalUnlock(LockManagerImpl.java:338)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.unlock(LockManagerImpl.java:428)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.XALockManager.unlock(XALockManager.java:103)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.NodeImpl.unlock(NodeImpl.java:4133)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.unlock(DavResourceImpl.java:739)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doUnlock(AbstractWebdavServlet.java:710)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:262)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8080-Processor22 waiting by &lt;a href=&apos;mailto:EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&apos;&gt;EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.acquire(LockManagerImpl.java:599)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.getLockInfo(LockManagerImpl.java:356)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.XALockManager.isLocked(XALockManager.java:143)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.NodeImpl.isLocked(NodeImpl.java:4161)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.getLock(DavResourceImpl.java:648)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.initProperties(DavResourceImpl.java:312)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.getProperties(DavResourceImpl.java:271)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.MultiStatusResponse.&amp;lt;init&amp;gt;(MultiStatusResponse.java:180)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.MultiStatus.addResourceProperties(MultiStatus.java:62)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doPropFind(AbstractWebdavServlet.java:435)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:232)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8080-Processor21 waiting by &lt;a href=&apos;mailto:EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&apos;&gt;EDU.oswego.cs.dl.util.concurrent.ReentrantLock@eb5563&lt;/a&gt; ::WAITING at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:-2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at EDU.oswego.cs.dl.util.concurrent.ReentrantLock.acquire(null:-1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.acquire(LockManagerImpl.java:599)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.LockManagerImpl.getLockInfo(LockManagerImpl.java:356)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.lock.XALockManager.isLocked(XALockManager.java:143)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.NodeImpl.isLocked(NodeImpl.java:4161)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.getLock(DavResourceImpl.java:648)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.isLocked(DavResourceImpl.java:855)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.webdav.simple.DavResourceImpl.addMember(DavResourceImpl.java:501)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.doPut(AbstractWebdavServlet.java:504)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.execute(AbstractWebdavServlet.java:241)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.server.AbstractWebdavServlet.service(AbstractWebdavServlet.java:193)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
Thread http-8080-Processor20 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@42de17&apos;&gt;ControlRunnable@42de17&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor19 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@2ea67&apos;&gt;ControlRunnable@2ea67&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor18 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@6b1a74&apos;&gt;ControlRunnable@6b1a74&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor17 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@95dc5a&apos;&gt;ControlRunnable@95dc5a&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor16 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@b5cc4d&apos;&gt;ControlRunnable@b5cc4d&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor15 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@77e923&apos;&gt;ControlRunnable@77e923&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor14 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@6afba3&apos;&gt;ControlRunnable@6afba3&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor13 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@ae8c15&apos;&gt;ControlRunnable@ae8c15&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor12 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@6eea56&apos;&gt;ControlRunnable@6eea56&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor11 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@daf576&apos;&gt;ControlRunnable@daf576&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor10 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@293c5e&apos;&gt;ControlRunnable@293c5e&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor9 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3a774f&apos;&gt;ControlRunnable@3a774f&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor8 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@6efb3f&apos;&gt;ControlRunnable@6efb3f&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor7 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@30e551&apos;&gt;ControlRunnable@30e551&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor6 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@1f6576&apos;&gt;ControlRunnable@1f6576&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor5 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3e2817&apos;&gt;ControlRunnable@3e2817&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor4 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@ba1328&apos;&gt;ControlRunnable@ba1328&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor3 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3fbf92&apos;&gt;ControlRunnable@3fbf92&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor2 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@3a3c1f&apos;&gt;ControlRunnable@3a3c1f&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread http-8080-Processor1 waiting by org.apache.tomcat.util.threads.ThreadPool$&lt;a href=&apos;mailto:ControlRunnable@4127c0&apos;&gt;ControlRunnable@4127c0&lt;/a&gt; ::WAITING at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:656)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@44b625&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@44b625&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@a7252d&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@a7252d&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread ObservationManager waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@79d52f&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@79d52f&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@8088da&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@8088da&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread IndexMerger waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@7000ea&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@7000ea&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread ObservationManager waiting by &lt;a href=&apos;mailto:org.apache.commons.collections.buffer.BlockingBuffer@4c15d9&apos;&gt;org.apache.commons.collections.buffer.BlockingBuffer@4c15d9&lt;/a&gt; ::WAITING at org.apache.commons.collections.buffer.BlockingBuffer.remove(BlockingBuffer.java:107)&lt;br/&gt;
Thread Finalizer waiting by java.lang.ref.ReferenceQueue$&lt;a href=&apos;mailto:Lock@c31c7d&apos;&gt;Lock@c31c7d&lt;/a&gt; ::WAITING&lt;br/&gt;
Thread Reference Handler waiting by java.lang.ref.Reference$&lt;a href=&apos;mailto:Lock@9c7650&apos;&gt;Lock@9c7650&lt;/a&gt; ::WAITING&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Done Thread Monitor ==================&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12499138" author="ianeboston" created="Fri, 25 May 2007 17:22:10 +0100"  >&lt;br/&gt;
&lt;br/&gt;
The thread that is in the Abstract Journal aquired a lock in the LockManagerImpl at about line 313 (1.3 TAG in svn) and then went into AbsracctJournal.lockAndSync via the cluster node.&lt;br/&gt;
&lt;br/&gt;
All the other threads are waiting for this lock to be released prior to continuing, this is ok,&lt;br/&gt;
&lt;br/&gt;
since there are no other threads waiting, I can only think that something is not releasing the journal lock in AbscractJournal (thankfully these are singletons !)</comment>
                    <comment id="12499181" author="ianeboston" created="Fri, 25 May 2007 18:41:09 +0100"  >&lt;br/&gt;
&lt;br/&gt;
I am seeing some collisions on the revision numbers. Which causes the local cache to become out of date.... but looking at the code paths, there is always an release operation.</comment>
                    <comment id="12499188" author="ianeboston" created="Fri, 25 May 2007 18:52:20 +0100"  >2 Log files, node 1 has locked up,&lt;br/&gt;
&lt;br/&gt;
It appears to be locked after being unable to deliver lock event,&lt;br/&gt;
&lt;br/&gt;
which looks like it was caused by a revision collision.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12499711" author="dpfister" created="Tue, 29 May 2007 08:48:58 +0100"  >Hi Ian,&lt;br/&gt;
&lt;br/&gt;
thank you for your stack traces and all your work! In your second thread dump, I&amp;#39;d say that the first one (Thread http-8080-Processor25) still holds the AbstractJournal&amp;#39;s RWLock (acquired in SharedItemStateManager$Update.begin) and therefore the VM&amp;#39;s state is similar to the first thread dump you provided: one thread holds the AbstractJournal&amp;#39;s RWLock and will start an item update (1), while other threads interoperate with the LockManager and therefore lock that one (2). When the item update (1) triggers a synchronization on the journal (because another instance made some changes) it might encounter a lock operation and will try to inform the LockManager about this event. Because of all other threads in (2) this will cause the deadlock.&lt;br/&gt;
&lt;br/&gt;
IMO, to solve this problem, LockManager operations will have to adopt the same pattern as SharedItemStateManager updates already do: lock-and-sync the journal when the operation starts, unlock at the end of it.&lt;br/&gt;
&lt;br/&gt;
Kind regards&lt;br/&gt;
Dominique</comment>
                    <comment id="12499768" author="ianeboston" created="Tue, 29 May 2007 12:30:17 +0100"  >Dominique,&lt;br/&gt;
&lt;br/&gt;
thanks for the pointer, that makes sense to me and fits other problems I am seeing where locks fail on non existent nodes during journal replay.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
I will give it a go and get back to you. Unfortunately, I will not have full network access until this Saturday.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Ian&lt;br/&gt;
&lt;br/&gt;
Sent from my Pearl, sorry about the briefness and spelling!  &lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12500059" author="ianeboston" created="Wed, 30 May 2007 09:22:15 +0100"  >That appears to have fixed this problem,  in the internal lock and unlock methods I have added an effective lockAndSync if and only if the event channel is notified of the lock or unlock which would cause a lock and sync after the lock manager jvm lock had been aquired. So deadlocks can&amp;#39;t happen as you predicted.&lt;br/&gt;
&lt;br/&gt;
I notice there may be some more places where this can happen.&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
The NodeTypeRegistry and the NameSpaceRegistry &lt;br/&gt;
&lt;br/&gt;
I have some additional errors appearing when the path can&amp;#39;t be built due to nonexistant child nodes, leading me to believe that something might be being dropped.&lt;br/&gt;
&lt;br/&gt;
Unfortunately, I don&amp;#39;t have net access and my blackberry won&amp;#39;t hook up to OSX so I can&amp;#39;t send a patch till Saturday at the earliest. Sorry&lt;br/&gt;
&lt;br/&gt;
Ian&lt;br/&gt;
&lt;br/&gt;
Sent from my Pearl, sorry about the briefness and spelling!  &lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12500761" author="xilu1999" created="Fri, 1 Jun 2007 18:03:45 +0100"  >I had a similar problem but the stack trace is slight different &lt;br/&gt;
The setup is a 4 nodes cluster and under heavy load (mainly updates), they all hang, from database side, three transaction updates are waiting for a select lock. The select lock seems to be blocked by one of the threads underneath&lt;br/&gt;
&lt;br/&gt;
thread 1 &lt;br/&gt;
Thread 25141: (state = BLOCKED)&lt;br/&gt;
&amp;nbsp;- java.lang.Object.wait(long) @bci=0 (Compiled frame; information may be imprecise)&lt;br/&gt;
&amp;nbsp;- java.lang.Object.wait() @bci=2, line=474 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.journal.AbstractJournal.sync() @bci=9, line=160 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.cluster.ClusterNode.sync() @bci=27, line=283 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.cluster.ClusterNode.run() @bci=38, line=254 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
thread 2 &lt;br/&gt;
Thread 25137: (state = BLOCKED)&lt;br/&gt;
&amp;nbsp;- org.apache.commons.collections.map.AbstractHashedMap.get(java.lang.Object) @bci=62, line=182 (Compiled frame; information may be imprecise)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.NodeState.getReorderedChildNodeEntries() @bci=57, line=671 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.CachingHierarchyManager.nodesReplaced(org.apache.jackrabbit.core.state.NodeState) @bci=1, line=385 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.StateChangeDispatcher.notifyNodesReplaced(org.apache.jackrabbit.core.state.NodeState) @bci=29, line=132 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SessionItemStateManager.nodesReplaced(org.apache.jackrabbit.core.state.NodeState) @bci=29, line=874 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.NodeState.notifyNodesReplaced() @bci=12, line=793 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.NodeState.setChildNodeEntries(java.util.List) @bci=73, line=473 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.NodeStateMerger.merge(org.apache.jackrabbit.core.state.NodeState, org.apache.jackrabbit.core.state.NodeStateMerger$MergeContext) @bci=291, line=139 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SessionItemStateManager.stateModified(org.apache.jackrabbit.core.state.ItemState) @bci=58, line=802 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.StateChangeDispatcher.notifyStateModified(org.apache.jackrabbit.core.state.ItemState) @bci=29, line=85 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.LocalItemStateManager.stateModified(org.apache.jackrabbit.core.state.ItemState) @bci=49, line=427 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.StateChangeDispatcher.notifyStateModified(org.apache.jackrabbit.core.state.ItemState) @bci=29, line=85 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager.stateModified(org.apache.jackrabbit.core.state.ItemState) @bci=5, line=390 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.ItemState.notifyStateUpdated() @bci=12, line=241 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.ChangeLog.persisted() @bci=30, line=271 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager.doExternalUpdate(org.apache.jackrabbit.core.state.ChangeLog) @bci=264, line=945 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager.externalUpdate(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollection) @bci=10, line=871 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.RepositoryImpl$WorkspaceInfo.externalUpdate(org.apache.jackrabbit.core.state.ChangeLog, java.util.List) @bci=25, line=1957 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.cluster.ClusterNode.end() @bci=182, line=834 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.cluster.ClusterNode.consume(org.apache.jackrabbit.core.journal.Record) @bci=469, line=929 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.journal.AbstractJournal.doSync(long) @bci=108, line=191 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.journal.AbstractJournal.lockAndSync() @bci=42, line=241 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.journal.DefaultRecordProducer.append() @bci=6, line=51 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceUpdateChannel.updateCreated(org.apache.jackrabbit.core.cluster.Update) @bci=36, line=466 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager$Update.begin() @bci=44, line=530 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager.beginUpdate(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory, org.apache.jackrabbit.core.virtual.VirtualItemStateProvider) @bci=15, line=825 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SharedItemStateManager.update(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory) @bci=4, line=855 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.LocalItemStateManager.update(org.apache.jackrabbit.core.state.ChangeLog) @bci=9, line=326 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.XAItemStateManager.update(org.apache.jackrabbit.core.state.ChangeLog) @bci=20, line=313 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.LocalItemStateManager.update() @bci=22, line=302 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.state.SessionItemStateManager.update() @bci=4, line=306 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.ItemImpl.save() @bci=594, line=1214 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- net.maven.mcr.event.AssetCompleteEventListener.markAssetComplete(javax.jcr.Node, boolean) @bci=137, line=185 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- net.maven.mcr.event.AssetCompleteEventListener.handleAssetCompleteCheck(java.lang.String) @bci=241, line=169 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- net.maven.mcr.event.AssetCompleteEventListener.onEvent(javax.jcr.observation.EventIterator) @bci=112, line=82 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.observation.EventConsumer.consumeEvents(org.apache.jackrabbit.core.observation.EventStateCollection) @bci=165, line=231 (Compiled frame)&lt;br/&gt;
&amp;nbsp;- org.apache.jackrabbit.core.observation.ObservationDispatcher.run() @bci=104, line=145 (Interpreted frame)&lt;br/&gt;
&amp;nbsp;- java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Since Thread 2 is blocked by JVM lock, it is also holding the select lock in doSync.getRecords. That explained the deadlock on database level. &lt;br/&gt;
&lt;br/&gt;
I am not sure these two problems are exactly the same, if not, I can file a seperate bug. Thanks.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12500805" author="ianeboston" created="Fri, 1 Jun 2007 19:40:17 +0100"  >I now have a patch for this which I will upload on saturday night, currently out of network range.&lt;br/&gt;
&lt;br/&gt;
Ian&lt;br/&gt;
&lt;br/&gt;
Sent from my Pearl, sorry about the briefness and spelling!  &lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12500953" author="ianeboston" created="Sat, 2 Jun 2007 16:54:11 +0100"  >This is my patch that appears to fix this problem.&lt;br/&gt;
&lt;br/&gt;
Its not what I would call perfect since it may be too wide, and the patch may not apply as there are some line shifts where I have other logging statements in the files.</comment>
                    <comment id="12501159" author="dpfister" created="Mon, 4 Jun 2007 10:17:29 +0100"  >Hi Ian,&lt;br/&gt;
&lt;br/&gt;
thank you for looking at this problem and providing a patch! I&amp;#39;ll take a look at it asap. I will possibly extend the o.a.j.c.cluster.LockEventChannel to provide the locking functionality you added in order not to expose the ClusterNode class directly to the LockManagerImpl.&lt;br/&gt;
&lt;br/&gt;
Kind regards&lt;br/&gt;
Dominique</comment>
                    <comment id="12501867" author="dpfister" created="Wed, 6 Jun 2007 10:25:22 +0100"  >Hi Ian,&lt;br/&gt;
&lt;br/&gt;
I implemented your changes, introducing a new interface ClusterOperation that hides the details of locking (unlocking) the journal before (after) some cluster operation starts (ends), which will be useful for nodetype/namespace operations as well. I&amp;#39;ve attached a patch file that should be directly applied to the jackrabbit 1.3 sources (patch -p0 &amp;lt; patch.544769) and I&amp;#39;d be grateful if you could test whether this patch resolves this issue.&lt;br/&gt;
&lt;br/&gt;
Kind regards&lt;br/&gt;
Dominique</comment>
                    <comment id="12502265" author="ianeboston" created="Thu, 7 Jun 2007 09:36:46 +0100"  >Yes you patch fixes the problem.... its also much cleaner and my gut feeling is that its quicker&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
</comment>
                    <comment id="12503046" author="ianeboston" created="Sat, 9 Jun 2007 11:05:49 +0100"  >There is one small failiure in teh tests when not in a cluster &lt;br/&gt;
About line 324&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;void internalUnlock(NodeImpl node)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throws LockException, RepositoryException {&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ClusterOperation operation = null;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if ( eventChannel != null ) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	operation = eventChannel.create(node.getNodeId());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean successful = false;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;acquire();&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12503319" author="dpfister" created="Mon, 11 Jun 2007 09:12:53 +0100"  >Thanks Ian, for pointing out that one! Tests now pass smoothly. &lt;br/&gt;
&lt;br/&gt;
Fixed in revision 546038.</comment>
                    <comment id="12514353" author="jukkaz" created="Fri, 20 Jul 2007 23:12:33 +0100"  >Merged to the 1.3 branch in revision 558172.</comment>
                </comments>
                    <attachments>
                    <attachment id="12358273" name="catalina.out.node1.txt" size="1076854" author="ianeboston" created="Fri, 25 May 2007 18:52:19 +0100" />
                    <attachment id="12358274" name="catalina.out.node2.txt" size="897915" author="ianeboston" created="Fri, 25 May 2007 18:52:20 +0100" />
                    <attachment id="12358758" name="JCR-929.patch" size="6851" author="ianeboston" created="Sat, 2 Jun 2007 16:54:11 +0100" />
                    <attachment id="12359061" name="patch.544769" size="19488" author="dpfister" created="Wed, 6 Jun 2007 10:25:22 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 21 May 2007 09:16:32 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78724</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190021</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>