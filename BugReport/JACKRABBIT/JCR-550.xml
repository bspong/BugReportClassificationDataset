<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:30:29 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-550/JCR-550.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-550] OutOfMemoryError when re-indexing the repository</title>
                <link>https://issues.apache.org/jira/browse/JCR-550</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>[ERROR] 20060825 17:06:40&lt;br/&gt;
(org.apache.jackrabbit.core.observation.ObservationManagerFactory) -&lt;br/&gt;
Synchronous EventConsumer threw exception. java.lang.OutOfMemoryError&lt;br/&gt;
&lt;br/&gt;
when we try to re-index a repository, the repository is quite big (more then 4 Gb of disk usage) and sometimes it stores 40Mb size documents.&lt;br/&gt;
&lt;br/&gt;
As attach I put all the last logs we registered, with the full stack traces.&lt;br/&gt;
&lt;br/&gt;
Related to this whe have also errors with Lucene:&lt;br/&gt;
&lt;br/&gt;
[DEBUG] 20060803 08:24:01 (org.apache.jackrabbit.core.query.LazyReader)&lt;br/&gt;
- Dump: &lt;br/&gt;
java.io.IOException: Invalid header signature; read 8656037701166316554,&lt;br/&gt;
expected -2226271756974174256&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.core.query.MsWordTextFilter&lt;br/&gt;
&lt;br/&gt;
and then this ones:&lt;br/&gt;
&lt;br/&gt;
[DEBUG] 20060803 08:37:17 (org.apache.jackrabbit.core.ItemManager) -&lt;br/&gt;
removing item 8637bf5f-4689-4e75-888f-b7b89bef40c8 from cache&lt;br/&gt;
[ WARN] 20060803 08:40:13 (org.apache.jackrabbit.core.RepositoryImpl) -&lt;br/&gt;
Existing lock file at C:\Wave\Repository\.lock deteteced. Repository was&lt;br/&gt;
not shut down properly.&lt;br/&gt;
[ERROR] 20060803 09:33:14&lt;br/&gt;
(org.apache.jackrabbit.core.observation.ObservationManagerFactory) -&lt;br/&gt;
Synchronous EventConsumer threw exception.&lt;br/&gt;
java.lang.NullPointerException: null values not allowed&lt;br/&gt;
&lt;br/&gt;
this is our repository.xml configuration for indexing&lt;br/&gt;
&lt;br/&gt;
&amp;lt;SearchIndex&lt;br/&gt;
class=&amp;quot;org.apache.jackrabbit.core.query.lucene.SearchIndex&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;path&amp;quot; value=&amp;quot;${wsp.home}/index&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;textFilterClasses&amp;quot;&lt;br/&gt;
value=&amp;quot;org.apache.jackrabbit.core.query.lucene.TextPlainTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.MsExcelTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.MsPowerPointTextFilter, &lt;br/&gt;
org.apache.jackrabbit.core.query.MsWordTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.PdfTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.HTMLTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.XMLTextFilter,&lt;br/&gt;
org.apache.jackrabbit.core.query.RTFTextFilter,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;org.apache.jackrabbit.core.query.OpenOfficeTextFilter&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;useCompoundFile&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;minMergeDocs&amp;quot; value=&amp;quot;100&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;volatileIdleTime&amp;quot; value=&amp;quot;3&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;maxMergeDocs&amp;quot; value=&amp;quot;100000&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;mergeFactor&amp;quot; value=&amp;quot;10&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;bufferSize&amp;quot; value=&amp;quot;10&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;cacheSize&amp;quot; value=&amp;quot;1000&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;forceConsistencyCheck&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;autoRepair&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;respectDocumentOrder&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;analyzer&amp;quot;&lt;br/&gt;
value=&amp;quot;org.apache.lucene.analysis.standard.StandardAnalyzer&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/SearchIndex&amp;gt;</description>
                <environment>tomcat 5.0 [256 up to 512 mb of ram] &lt;br/&gt;
jackrabbit 1.0.1 &lt;br/&gt;
jdk 1.4.2_12 &lt;br/&gt;
Intel Xeon 3.2GHz with 2Gb of memory&lt;br/&gt;
----&lt;br/&gt;
poi-3.0-alpha2-20060616.jar&lt;br/&gt;
poi-contrib-3.0-alpha2-20060616.jar&lt;br/&gt;
poi-scratchpad-3.0-alpha2-20060616.jar&lt;br/&gt;
jackrabbit-core-1.0.1.jar&lt;br/&gt;
jackrabbit-index-filters-1.0.1.jar&lt;br/&gt;
jackrabbit-jcr-commons-1.0.1.jar&lt;br/&gt;
jcr-1.0.jar&lt;br/&gt;
tm-extractors-0.4.jar&lt;br/&gt;
lucene-1.4.3.jar&lt;br/&gt;
</environment>
            <key id="12348796">JCR-550</key>
            <summary>OutOfMemoryError when re-indexing the repository</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="mreutegg">Marcel Reutegger</assignee>
                                <reporter username="christian.zanata">Christian Zanata</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Aug 2006 08:35:05 +0100</created>
                <updated>Tue, 12 Dec 2006 13:03:41 +0000</updated>
                    <resolved>Wed, 8 Nov 2006 09:10:02 +0000</resolved>
                            <version>1.0.1</version>
                <version>1.1</version>
                                <fixVersion>1.1.1</fixVersion>
                                <component>indexing</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12431236" author="mreutegg" created="Tue, 29 Aug 2006 14:28:53 +0100"  >Your log files seem to indicate that some of your content is corrupt:&lt;br/&gt;
&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: invalid QName literal&lt;br/&gt;
	at org.apache.jackrabbit.name.QName.valueOf(QName.java:618)&lt;br/&gt;
	at org.apache.jackrabbit.core.state.util.Serializer.deserialize(Serializer.java:124)&lt;br/&gt;
	at org.apache.jackrabbit.core.state.obj.ObjectPersistenceManager.load(ObjectPersistenceManager.java:206)&lt;br/&gt;
	... 61 more&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Please note that using the ObjectPersistenceManager on a production system is not recommended because it is not transactional. You should consider using DerbyPersistenceManager as your version storage.</comment>
                    <comment id="12431955" author="mreutegg" created="Thu, 31 Aug 2006 20:56:04 +0100"  >To reproduce this issue I tried to re-index a repository with 100&amp;#39;000 nodes. I was able to re-index the repository with as little as 32 mb heap size. My profiler did not show any exceptional memory usage in the search index. The memory usage was actually quite low.&lt;br/&gt;
&lt;br/&gt;
Can you please try to re-index your repository without the text filters? Maybe there is a memory leak in one of the filters when an exception is thrown on an invalid or corrupt document.&lt;br/&gt;
&lt;br/&gt;
Having a heap dump for analysis would also be helpful. Can you please run the re-indexing process with the following JVM option: -Xrunhprof:heap=sites,doe=n&lt;br/&gt;
This will allow you to create a heap dump on a Ctrl-Break (on Windows) or kill -QUIT (on Unix) on the JVM process.&lt;br/&gt;
&lt;br/&gt;
Thanks a lot.</comment>
                    <comment id="12432089" author="christian.zanata" created="Fri, 1 Sep 2006 08:58:45 +0100"  >Hi Marcel,&lt;br/&gt;
we think the problem is in PdfTextFilter or in PdfBox libraries. We are not sure about that and we still investigate in that direction. It seems that after an exception something don&amp;#39;t free the resources.</comment>
                    <comment id="12432119" author="ianeboston" created="Fri, 1 Sep 2006 12:14:41 +0100"  >2 things with pdfbox&lt;br/&gt;
&lt;br/&gt;
If you dont religiously close the streams it causes oom problems and a GC wont get to the finalize fast enough to avoid OOM&lt;br/&gt;
&lt;br/&gt;
2. PDFBox has to build the entire document including all the graphics images before it can render the text. If you have a refactored PDF you can get 1000&amp;#39;s of graphics line segments, this causes PDBBox to use lots of CPU and Heap converting to a text stream.&lt;br/&gt;
&lt;br/&gt;
I am using PDFBox in a different search engine in the same way and it randomly causes lots of problems with refactored PDF files.&lt;br/&gt;
&lt;br/&gt;
HTH</comment>
                    <comment id="12432434" author="c_koell" created="Mon, 4 Sep 2006 07:05:38 +0100"  >I tried to re-index my repsoitory without the text filters and it works fine.&lt;br/&gt;
So the bug is in one of the text filters ...&lt;br/&gt;
These text filters i used before &lt;br/&gt;
org.apache.jackrabbit.core.query.lucene.TextPlainTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.MsExcelTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.MsPowerPointTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.MsWordTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.PdfTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.HTMLTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.XMLTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.RTFTextFilter&lt;br/&gt;
org.apache.jackrabbit.core.query.OpenOfficeTextFilter&lt;br/&gt;
&lt;br/&gt;
So i can test to re-index the repository without some filters  ... Please give me a hint wich one i should use ???</comment>
                    <comment id="12432776" author="c_koell" created="Wed, 6 Sep 2006 08:42:58 +0100"  >hi marcel&lt;br/&gt;
the vm argument  -Xrunhprof:heap=sites,doe=n &lt;br/&gt;
does not work in my case. the re-index process stops after about 1-2 minutes with a outofmemory-error&lt;br/&gt;
is there another way to get a dump file ?&lt;br/&gt;
claus</comment>
                    <comment id="12433037" author="c_koell" created="Thu, 7 Sep 2006 07:57:14 +0100"  >hi @ all &lt;br/&gt;
in my case the most file types in my repository are word documents.&lt;br/&gt;
if i remove the org.apache.jackrabbit.core.query.MsWordTextFilter  class the re-index process works fine.&lt;br/&gt;
but if i enable the filter the process ends with a outofmemory error.&lt;br/&gt;
i think we must look for a memory leak ...&lt;br/&gt;
claus</comment>
                    <comment id="12446831" author="jukkaz" created="Fri, 3 Nov 2006 06:49:39 +0000"  >Does this issue still occur now that RuntimeExceptions are being catched per the &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-574&quot; title=&quot;MsExcelTextFilter throws Exception. Repository is not startable&quot;&gt;&lt;strike&gt;JCR-574&lt;/strike&gt;&lt;/a&gt; fix?</comment>
                    <comment id="12446843" author="mreutegg" created="Fri, 3 Nov 2006 07:46:32 +0000"  >Claus wrote:&lt;br/&gt;
&amp;gt; is there another way to get a dump file ?&lt;br/&gt;
&lt;br/&gt;
Acutally there is. jdk 1.4.2-12 supports the option -XX:+HeapDumpOnOutOfMemoryError&lt;br/&gt;
&lt;br/&gt;
With this option the JVM will create a dump it goes out of memory.</comment>
                    <comment id="12446852" author="c_koell" created="Fri, 3 Nov 2006 08:21:56 +0000"  >Hi Jukka ..&lt;br/&gt;
&lt;br/&gt;
The issue &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-574&quot; title=&quot;MsExcelTextFilter throws Exception. Repository is not startable&quot;&gt;&lt;strike&gt;JCR-574&lt;/strike&gt;&lt;/a&gt; is very different to this issue. The Problem was that the LazyReader  has only catched Exceptions not Runtime Exceptions.&lt;br/&gt;
The Problem here is that i get a OutOfMemoryException while re-indexing a huge Repository.&lt;br/&gt;
This is for me a very big problem because i can not work in a Production environment with Jackrabbit because we &lt;br/&gt;
have about 4-5 million documents (doc,xls,pdf). If i have to re-index the repsoitory i can not to this.&lt;br/&gt;
I will try the vm-argument what marcel wrote.&lt;br/&gt;
&lt;br/&gt;
claus</comment>
                    <comment id="12446854" author="jukkaz" created="Fri, 3 Nov 2006 08:30:57 +0000"  >I would assume that the OutOfMemoryException is triggered by the parsing of some large Word document, especially since you reported that the problem does not occur if you disable the Word document filter.&lt;br/&gt;
&lt;br/&gt;
Thus, if we catch the OutOfMemoryException caused by a single document, it will should not interrupt the whole indexing process. Any memory garbage should then get collected automatically unless the document parser stores information statically.</comment>
                    <comment id="12446865" author="c_koell" created="Fri, 3 Nov 2006 08:55:01 +0000"  >ok i didn&amp;#39;t think about this .. i will try the reindexing process with the fixed LazyReader and we will see if it works...&lt;br/&gt;
&lt;br/&gt;
but at the moment i start the repository with this arguments&lt;br/&gt;
-Xms1550m&lt;br/&gt;
-Xmx3000m&lt;br/&gt;
&lt;br/&gt;
i do not think that only one document causes the outofmemoryexception. i think there are objects they will not be garbaged&lt;br/&gt;
&lt;br/&gt;
claus</comment>
                    <comment id="12448052" author="c_koell" created="Wed, 8 Nov 2006 06:31:50 +0000"  >I must give Jukka right.&lt;br/&gt;
I have testetd to reindex the repsoitory and it works fine now.&lt;br/&gt;
For me this issue can be closed ..&lt;br/&gt;
Thanks lot&lt;br/&gt;
claus</comment>
                    <comment id="12448080" author="jukkaz" created="Wed, 8 Nov 2006 09:10:02 +0000"  >Thanks for testing this out! Resolved as Fixed.</comment>
                </comments>
                    <attachments>
                    <attachment id="12339747" name="ASF.LICENSE.NOT.GRANTED--log_files.zip" size="6231386" author="christian.zanata" created="Tue, 29 Aug 2006 08:35:06 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 29 Aug 2006 13:28:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>80466</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>191127</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>