<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:52:40 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-2420/JCR-2420.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-2420] Node removal fails with AccessDeniedException</title>
                <link>https://issues.apache.org/jira/browse/JCR-2420</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>I have a hierarchy of nodes which are all access controllable. The following hierarchy illustrates the setup for my problem.&lt;br/&gt;
root  -  read permissions to everyone&lt;br/&gt;
&amp;nbsp;&amp;nbsp;| - subFolder  -  all permissions to user A&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;| - subsubFolder  -  all permissions to user A&lt;br/&gt;
&lt;br/&gt;
The user A has all rights from the node &amp;quot;subFolder&amp;quot; downwards.&lt;br/&gt;
&lt;br/&gt;
I tried to remove the node &amp;quot;subsubFolder&amp;quot; with the user A. Clearly A has enough permissions to remove the node. But as soon as I call Session.save() an AccessDeniedException is thrown.&lt;br/&gt;
&lt;br/&gt;
I did a lot of debugging and found a possible cause for this fault. It led me to the function ACLProvider.AclPermissions.buildResult(). All line references are based on the source code in the subversion repository found here: &lt;a href=&quot;http://svn.apache.org/viewvc/jackrabbit/tags/1.6.0/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/authorization/acl/ACLProvider.java?view=markup&quot;&gt;http://svn.apache.org/viewvc/jackrabbit/tags/1.6.0/jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/authorization/acl/ACLProvider.java?view=markup&lt;/a&gt;.&lt;br/&gt;
On line 458 Jackrabbit collects all access control entries of the node, that I want to remove, and all its parents and puts it in the variable &amp;quot;entries&amp;quot;. In my example this variable contains three entries:&lt;br/&gt;
1. all permissions to user A&lt;br/&gt;
2. all permissions to user A&lt;br/&gt;
3. read permissions to everyone&lt;br/&gt;
On lines 460 - 466 it collects all access control entries of the node, that I want to remove, and puts it in &amp;quot;localACEs&amp;quot;. This variable contains one entry: all permissions to user A.&lt;br/&gt;
If I want to be able to remove &amp;quot;subsubFolder&amp;quot;, user A needs the permission from the parent node. The permissions of the parent nodes of &amp;quot;subsubFolder&amp;quot; are: all permissions to user A and read permissions to everyone. But that&amp;#39;s where the access check fails. In line 488 Jackrabbit checks if a permission from &amp;quot;entries&amp;quot; is local or not by looking it up in &amp;quot;localACEs&amp;quot;. If it is in there, the permission is local, else not. Unfortunately it recognizes the permission of the node &amp;quot;subFolder&amp;quot; as local. Thus the permissions of the parent nodes of &amp;quot;subsubFolder&amp;quot; are: read permissions to everyone. So I cannot remove the node.&lt;br/&gt;
The source of the error is the equals check of the access control entries. The permissions of node &amp;quot;subFolder&amp;quot; are considered equal to the one of &amp;quot;subsubFolder&amp;quot;. If I explicitly assign the permission &amp;quot;remove node permission to user A&amp;quot; to the node &amp;quot;subFolder&amp;quot;, it works fine, because it is recognized as parent permission.</description>
                <environment></environment>
            <key id="12442227">JCR-2420</key>
            <summary>Node removal fails with AccessDeniedException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="anchela">angela</assignee>
                                <reporter username="garfield3_83">Michael St&#228;mpfli</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Dec 2009 15:54:18 +0000</created>
                <updated>Thu, 26 Aug 2010 11:11:42 +0100</updated>
                    <resolved>Wed, 10 Mar 2010 15:20:09 +0000</resolved>
                            <version>1.6</version>
                                <fixVersion>2.0.3</fixVersion>
                <fixVersion>2.1</fixVersion>
                                <component>jackrabbit-core</component>
                <component>security</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12843591" author="anchela" created="Wed, 10 Mar 2010 15:20:09 +0000"  >fixed with rev. 921394&lt;br/&gt;
thanks for reporting this issue.</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 10 Mar 2010 15:20:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78220</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189659</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>