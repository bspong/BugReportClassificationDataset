<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 06:00:47 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1366/JCR-1366.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1366] DbDataStore: tablePrefix not accomodated during init test for existing DATASTORE table</title>
                <link>https://issues.apache.org/jira/browse/JCR-1366</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>we are providing a test db deployment with prepopulated data, including jackrabbit DataStore. I tried specifying the tablePrefix when creating the initial repository, and tables are created properly.&lt;br/&gt;
&lt;br/&gt;
However, when a clean installation is run with a fresh database that has an existing DataStore (stored at JACKRABBIT_DS_DATASTORE table), the startup fails, because during init, the meta data only checks for tables name matching the tableSQL property:&lt;br/&gt;
ResultSet rs = meta.getTables(null, null, tableSQL, null);&lt;br/&gt;
&lt;br/&gt;
but the tableSQL property is never modified based on the tablePrefix property (other uses of tableSQL modify queries based on the prefix).&lt;br/&gt;
&lt;br/&gt;
I think the init method should modify the tested table name based on the tablePrefix.&lt;br/&gt;
&lt;br/&gt;
Note: I assume different JDBC drivers may handle this differently (we are using SQL Server 2007 and jTDS driver), since the DatabaseMetaData is API is unclear on the parameter to getTables being a &amp;quot;tableNamePattern&amp;quot; - should wildcards work? Or should a specific table be specified? &lt;br/&gt;
&lt;br/&gt;
My DataStore config is below:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;DataStore class=&amp;quot;org.apache.jackrabbit.core.data.db.DbDataStore&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;className&amp;quot; value=&amp;quot;org.apache.jackrabbit.core.data.db.DbDataStore&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:jtds:&lt;a href=&quot;SQLServer://localhost:1433/nga_admin;prepareSQL=2;responseBuffering=adaptive&quot;&gt;SQLServer://localhost:1433/nga_admin;prepareSQL=2;responseBuffering=adaptive&lt;/a&gt;&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;user&amp;quot; value=&amp;quot;sa&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;password&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;databaseType&amp;quot; value=&amp;quot;sqlserver&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;driver&amp;quot; value=&amp;quot;net.sourceforge.jtds.jdbc.Driver&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;!-- a bug in jackrabbit makes tablePrefix not work --&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;tablePrefix&amp;quot; value=&amp;quot;JACKRABBIT_DS_&amp;quot;&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;minRecordLength&amp;quot; value=&amp;quot;1&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;maxConnections&amp;quot; value=&amp;quot;2&amp;quot;/&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;param name=&amp;quot;copyWhenReading&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;         &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;/DataStore&amp;gt;&lt;br/&gt;
</description>
                <environment>jdk 1.6, win xp, SQL SERVER 2007, jTDS jdbc driver</environment>
            <key id="12388225">JCR-1366</key>
            <summary>DbDataStore: tablePrefix not accomodated during init test for existing DATASTORE table</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="tysonnorris">Tyson Norris</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Feb 2008 19:31:37 +0000</created>
                <updated>Thu, 13 Aug 2009 16:03:39 +0100</updated>
                    <resolved>Wed, 17 Dec 2008 13:33:28 +0000</resolved>
                            <version>1.4</version>
                                <fixVersion>1.6</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>3</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12567670" author="tmueller" created="Mon, 11 Feb 2008 15:42:09 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
I see this feature is undocumented. I will document it. Currently the tablePrefix can only be used to set the catalog and schema name as in:&lt;br/&gt;
&lt;br/&gt;
&amp;lt;param name=&amp;quot;tablePrefix&amp;quot; value=&amp;quot;ds.&amp;quot;&amp;gt; &lt;br/&gt;
or (Microsoft SQL Server):&lt;br/&gt;
&amp;lt;param name=&amp;quot;tablePrefix&amp;quot; value=&amp;quot;ds.dbo.&amp;quot;&amp;gt; &lt;br/&gt;
&lt;br/&gt;
Could you explain why you like to change the table name (what is the use case)?&lt;br/&gt;
&lt;br/&gt;
&amp;gt; DatabaseMetaData is API is unclear on the parameter to getTables being a &amp;quot;tableNamePattern&amp;quot; - should wildcards work?&lt;br/&gt;
&lt;br/&gt;
It used to be unclear, but in recent JDKs this is better documented. It is in the class level Javadoc:&lt;br/&gt;
&amp;quot;Some DatabaseMetaData methods take arguments that are String patterns. These arguments all have names such as fooPattern. Within a pattern String, &amp;quot;%&amp;quot; means match any substring of 0 or more characters, and &amp;quot;_&amp;quot; means match any one character. Only metadata entries matching the search pattern are returned. If a search pattern argument is set to null, that argument&amp;#39;s criterion will be dropped from the search.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
There are still some problems, for example the table name is not always stored uppercase (MySQL, PostgreSQL). Also, the wildcard escape character (default should be \) doesn&amp;#39;t work with all databases.&lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
Thomas</comment>
                    <comment id="12567760" author="tysonnorris" created="Mon, 11 Feb 2008 19:11:37 +0000"  >We would like to be able to change the table name so that its use is obvious - i.e. change &amp;quot;DATASTORE&amp;quot; to &amp;quot;JACKRABBIT_DATASTORE&amp;quot;. It is unlikely that we would have a collision with the name DATASTORE, but nevertheless, it is possible. All other config options have proper working prefix options so that all of our JACKRABBIT tables are effectively named with the prefix &amp;quot;JACKRABBIT_&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
Thanks!&lt;br/&gt;
Tyson</comment>
                    <comment id="12573751" author="tmueller" created="Fri, 29 Feb 2008 14:06:33 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
Some databases don&amp;#39;t support long table names. To avoid collisions, I suggest to use a different (database-) schema.&lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
Thomas</comment>
                    <comment id="12589997" author="tmueller" created="Thu, 17 Apr 2008 13:14:07 +0100"  >It seems this problem should be fixed (see also &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1542)&quot;&gt;https://issues.apache.org/jira/browse/JCR-1542)&lt;/a&gt;.&lt;br/&gt;
There are two options:&lt;br/&gt;
&lt;br/&gt;
A) A prefix of &amp;quot;JACKRABBIT_&amp;quot; will result in a table called &amp;quot;JACKRABBIT_DATASTORE&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;this is in line with schemaObjectPrefix of the bundle db persistence manager&lt;br/&gt;
&amp;nbsp;&amp;nbsp;and database journal. The disadvantage is that &amp;quot;ds.&amp;quot; and &amp;quot;ds.dbo.&amp;quot; wouldn&amp;#39;t work&lt;br/&gt;
&amp;nbsp;&amp;nbsp;any more, but maybe that&amp;#39;s not a problem.&lt;br/&gt;
&lt;br/&gt;
B) Deprecate this setting, and introduce a new setting schemaObjectPrefix&lt;br/&gt;
&amp;nbsp;&amp;nbsp;that works exactly like in bundle db persistence manager and database journal (as in A).&lt;br/&gt;
&lt;br/&gt;
What do you think? My vote is B) because of compatibility. </comment>
                    <comment id="12639050" author="schans" created="Mon, 13 Oct 2008 14:40:05 +0100"  >The patch is quite trivial. It seems that the table query is mixed up with the table name. &lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t think the parameter name has to change. If a prefix is configured in the repository.xml the repository will fail to start with the first restart. &lt;br/&gt;
</comment>
                    <comment id="12639051" author="schans" created="Mon, 13 Oct 2008 14:44:11 +0100"  >I haven&amp;#39;t confirmed this myself, but looking at the code the same bug exists in 1.5 and trunk.</comment>
                    <comment id="12657382" author="tmueller" created="Wed, 17 Dec 2008 13:33:28 +0000"  >Committed in revision 727376</comment>
                    <comment id="12676976" author="ericwout" created="Thu, 26 Feb 2009 12:25:32 +0000"  >As a minor suggestion, I do think the tablePrefix parameter should be deprecated and replaced with a tableSpace parameter so that the different database configuration options for all the database-driven components (PersistenceManager, DataStore, Versioning, etc.) are the same (or at least comparable).&lt;br/&gt;
&lt;br/&gt;
As it is now, it could be confusing, since each element has different parameters to configure the connection with the database, while they more or less same.&lt;br/&gt;
&lt;br/&gt;
But this should probably be a new issue if accepted? ;)</comment>
                    <comment id="12678737" author="tmueller" created="Wed, 4 Mar 2009 14:09:32 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
Currently the DbDataStore doesn&amp;#39;t support tableSpace. If you need this feature, could you create a new issue?&lt;br/&gt;
I don&amp;#39;t know if tablePrefix is still required or not. &lt;br/&gt;
&lt;br/&gt;
Regards,&lt;br/&gt;
Thomas</comment>
                    <comment id="12678772" author="ericwout" created="Wed, 4 Mar 2009 16:24:24 +0000"  >Hi, no, I don&amp;#39;t actually need it. We&amp;#39;re helped by the schemaObjectPrefix (which is in line rest of the configurations already :) ).&lt;br/&gt;
&lt;br/&gt;
So if I understand it correctly by your comment, you implemented option B? I didn&amp;#39;t fully get that. If so, you can disregard my comment, since I thought there would still be two parameters.&lt;br/&gt;
&lt;br/&gt;
On the Wiki I already changed the documentation slightly based on comments from the user group, see &lt;a href=&quot;http://wiki.apache.org/jackrabbit/DataStore?action=diff&quot;&gt;http://wiki.apache.org/jackrabbit/DataStore?action=diff&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Is that still correct?</comment>
                    <comment id="12678821" author="tmueller" created="Wed, 4 Mar 2009 18:13:28 +0000"  >&amp;gt; no, I don&amp;#39;t actually need it&lt;br/&gt;
&lt;br/&gt;
That means it&amp;#39;s not urgent. However it would still be nice if all components had the same configuration parameters (as you wrote).&lt;br/&gt;
&lt;br/&gt;
&amp;gt; On the Wiki I already changed the documentation slightly&lt;br/&gt;
&lt;br/&gt;
As far as I see it&amp;#39;s correct. Thanks! &lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12392009" name="datastore_prefix.patch" size="1312" author="schans" created="Mon, 13 Oct 2008 14:40:05 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 11 Feb 2008 15:42:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>142658</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>279743</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>