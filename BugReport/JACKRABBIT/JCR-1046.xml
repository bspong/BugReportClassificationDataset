<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:48:31 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1046/JCR-1046.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1046] Non-versionable children of a versionable node should not be updated when a merge fails</title>
                <link>https://issues.apache.org/jira/browse/JCR-1046</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>The JCR specification (JSR-170) includes a merge algorithm that is inconsistent with the functionality described elsewhere in the JCR specification. Specifically from JSR-170 section 8.2.10 Merge:&lt;br/&gt;
&lt;br/&gt;
&amp;quot;In either case, (regardless of whether bestEffort is true or false) for each non-versionable node (including both referenceable and non-referenceable), if the merge result of its nearest versionable ancestor is update, or if it has no versionable ancestor, then it is updated to reflect the state of its corresponding node. Otherwise, it is left unchanged.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
The algorithm presented in 8.2.10.1 of the specification goes against the above statement as it does not take into consideration the merge result of the nearest versionable ancestor.&lt;br/&gt;
&lt;br/&gt;
One solution would be to have the doLeave(n) call that dofail(n, v&amp;#39;) calls altered to only perform a merge on the versionable children rather than all of the children. The merging of all children (versionable and non-versionable) should only be done if the nearest parent is not in a failed merge state regardless of whether the failure occurred from the current merge operation or a previous merge operation.&lt;br/&gt;
&lt;br/&gt;
I will attach a patch file that makes what I think is the required change.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12375148">JCR-1046</key>
            <summary>Non-versionable children of a versionable node should not be updated when a merge fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="tripod">Tobias Bocanegra</assignee>
                                <reporter username="bobwieler">Bob Wieler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Aug 2007 15:42:32 +0100</created>
                <updated>Fri, 22 Feb 2008 13:11:38 +0000</updated>
                    <resolved>Thu, 17 Jan 2008 09:28:28 +0000</resolved>
                            <version>1.3</version>
                <version>1.3.1</version>
                <version>1.3.3</version>
                <version>1.4</version>
                                <fixVersion>core 1.4.1</fixVersion>
                                <component>versioning</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12516989" author="bobwieler" created="Wed, 1 Aug 2007 15:46:02 +0100"  >Proposed fix for this issue. This is a diff from the trunk branch of jackrabbit (1.4-snapshot).</comment>
                    <comment id="12559668" author="bobwieler" created="Wed, 16 Jan 2008 21:43:13 +0000"  >The fix I supplied for this should actually only merge non-versionable children if the result of the merge is a fail or a leave, not just if it is a failure. Otherwise, non-versionable children will always be merged regardless of the merge status of the nearest versionable parent.&lt;br/&gt;
&lt;br/&gt;
I will update the attached diff with a different proposed fixed. More information on this issue can be found in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-1314&quot; title=&quot;Node incorrectly overridden when performing a merge&quot;&gt;&lt;strike&gt;JCR-1314&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
</comment>
                    <comment id="12559669" author="bobwieler" created="Wed, 16 Jan 2008 21:43:58 +0000"  >Updated patch.</comment>
                    <comment id="12559687" author="tripod" created="Wed, 16 Jan 2008 22:18:25 +0000"  >yes, i think your (latest) patch is correct. thanks for finding this!</comment>
                    <comment id="12559713" author="tripod" created="Wed, 16 Jan 2008 22:48:46 +0000"  >fixed as proposed.</comment>
                    <comment id="12559839" author="tripod" created="Thu, 17 Jan 2008 07:05:27 +0000"  >apparently some tests fail:&lt;br/&gt;
&lt;br/&gt;
CRAPITest&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;testMergeNodeNonVersionableSubNodeUpdate :&lt;br/&gt;
&amp;nbsp;junit.framework.AssertionFailedError&lt;br/&gt;
&amp;nbsp;junit.framework.AssertionFailedError&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.assertTrue(Assert.java:20)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at junit.framework.Assert.assertTrue(Assert.java:27)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.jackrabbit.test.api.version.MergeNonVersionableSubNodeTest.testMergeNodeNonVersionableSubNodeUpdate(MergeNonVersionableSubNodeTest.java:86)&lt;br/&gt;
&lt;br/&gt;
will investigate if tests are wrong or fix.</comment>
                    <comment id="12559870" author="tripod" created="Thu, 17 Jan 2008 09:28:28 +0000"  >fixed the failing tests (which were wrong and partially commented out!)</comment>
                    <comment id="12565682" author="jukkaz" created="Tue, 5 Feb 2008 10:13:45 +0000"  >Merged to the 1.4 branch in revision 618599.</comment>
                </comments>
                    <attachments>
                    <attachment id="12373317" name="jcr1046.diff" size="1065" author="bobwieler" created="Wed, 16 Jan 2008 21:43:57 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 16 Jan 2008 22:18:25 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78690</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>190089</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>