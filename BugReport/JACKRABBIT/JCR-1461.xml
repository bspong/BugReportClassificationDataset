<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Sat Jul 27 05:45:42 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/JCR-1461/JCR-1461.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[JCR-1461] Deadlock on concurrent commit/checkin operations</title>
                <link>https://issues.apache.org/jira/browse/JCR-1461</link>
                <project id="10591" key="JCR">Jackrabbit Content Repository</project>
                        <description>Running concurrently jackrabbit transactions including checkin operations leads to deadlock.</description>
                <environment></environment>
            <key id="12390451">JCR-1461</key>
            <summary>Deadlock on concurrent commit/checkin operations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="ppakulski">Przemo Pakulski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Mar 2008 13:17:43 +0000</created>
                <updated>Fri, 28 Mar 2008 09:15:13 +0000</updated>
                    <resolved>Fri, 14 Mar 2008 14:33:24 +0000</resolved>
                            <version>1.3.3</version>
                                <fixVersion>1.3.4</fixVersion>
                <fixVersion>core 1.4.2</fixVersion>
                                <component>jackrabbit-core</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12576182" author="ppakulski" created="Fri, 7 Mar 2008 13:25:45 +0000"  >Thread dump attached (2 threads only)</comment>
                    <comment id="12576936" author="mreutegg" created="Mon, 10 Mar 2008 10:34:36 +0000"  >Can you please provide a test case?</comment>
                    <comment id="12577798" author="mreutegg" created="Wed, 12 Mar 2008 10:57:18 +0000"  >So far I haven&amp;#39;t been able to reproduce the deadlock with a test.&lt;br/&gt;
&lt;br/&gt;
Just looking at the thread dump we can avoid the deadlock by pulling the getPath() in LockManagerImpl.getLockInfo() out of the acquire/release() scope.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve attached a patch with that change.&lt;br/&gt;
&lt;br/&gt;
Przemo, can you please build jackrabbit-core-1.3.4-rc1 again with this patch applied and check if the deadlock still occurs?&lt;br/&gt;
&lt;br/&gt;
It also seems that there&amp;#39;s another thread involved in the deadlock. Can you please attach the complete thread dump? Stripping off application specific stack frames is of course OK.</comment>
                    <comment id="12577929" author="ppakulski" created="Wed, 12 Mar 2008 17:10:01 +0000"  >Hm, deadlock occured when running 2 threads only. How do you know that another thread was involved ?</comment>
                    <comment id="12578663" author="mreutegg" created="Fri, 14 Mar 2008 09:30:07 +0000"  >I thought there was another thread holding the write lock on the SISM of the version manager, but it is in fact the grinder thread 1. The  So, you&amp;#39;re right those are the only two threads than can be involved.</comment>
                    <comment id="12578717" author="jukkaz" created="Fri, 14 Mar 2008 13:03:02 +0000"  >The patch seems correct enough to me (would there be a need to get the path within the locked region?), so I&amp;#39;d like to commit it to trunk and the 1.3 branch for proceeding with a 1.3.4 release candidate.</comment>
                    <comment id="12578720" author="mreutegg" created="Fri, 14 Mar 2008 13:14:02 +0000"  >&amp;gt; would there be a need to get the path within the locked region?&lt;br/&gt;
&lt;br/&gt;
according to dominique pfister this is not needed. based on his statement I&amp;#39;ve moved the call further up, outside the locked region.&lt;br/&gt;
&lt;br/&gt;
Feel free to commit the patch or let me know if I should do it.</comment>
                    <comment id="12578735" author="gklebus" created="Fri, 14 Mar 2008 13:48:49 +0000"  >Could we wait for feedback from Przemo re re-runnig his test using the patched jackrabbit 1.3.4rc? &lt;br/&gt;
</comment>
                    <comment id="12578737" author="jukkaz" created="Fri, 14 Mar 2008 13:51:49 +0000"  >&amp;gt; Could we wait for feedback from Przemo re re-runnig his test using the patched jackrabbit 1.3.4rc?&lt;br/&gt;
&lt;br/&gt;
Sure. Przemo, any update?</comment>
                    <comment id="12578766" author="jukkaz" created="Fri, 14 Mar 2008 14:33:24 +0000"  >Patch applied in revision 637106. Merged to 1.4 in revision 637107, and to 1.3 in revision 637110.&lt;br/&gt;
&lt;br/&gt;
Resolving as Fixed, as it seems obvious that at least the specific deadlock issue shown in the thread dump can not occur after this fix. Please reopen only if there&amp;#39;s a regression caused by this issue, and file separate issues if other deadlocks occur.</comment>
                    <comment id="12578797" author="mreutegg" created="Fri, 14 Mar 2008 15:12:36 +0000"  >I&amp;#39;ve finally been able to reproduce the deadlock with new random operation tests. I&amp;#39;ll commit them soon.&lt;br/&gt;
&lt;br/&gt;
Btw, that&amp;#39;s without the patch that Jukka recently applied.</comment>
                </comments>
                    <attachments>
                    <attachment id="12377689" name="JCR-1461.patch" size="1095" author="mreutegg" created="Wed, 12 Mar 2008 10:57:18 +0000" />
                    <attachment id="12377910" name="thread-dump-random-ops.txt" size="13337" author="mreutegg" created="Fri, 14 Mar 2008 15:12:36 +0000" />
                    <attachment id="12377344" name="thread-dump.txt" size="3359" author="ppakulski" created="Fri, 7 Mar 2008 13:25:45 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 10 Mar 2008 10:34:36 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>78549</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189927</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>