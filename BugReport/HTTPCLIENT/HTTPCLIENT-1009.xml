<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:12:02 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1009/HTTPCLIENT-1009.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1009] http client cache: SizeLimitedResponseReader is not setting content type for InputStreamEntity in constructResponse()</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1009</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>the newly created InputStreamEntity should be populated with content-encoding and content-type.</description>
                <environment></environment>
            <key id="12476897">HTTPCLIENT-1009</key>
            <summary>http client cache: SizeLimitedResponseReader is not setting content type for InputStreamEntity in constructResponse()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="fberger">Felix Berger</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Oct 2010 22:17:24 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:30 +0000</updated>
                    <resolved>Sun, 10 Oct 2010 21:00:29 +0100</resolved>
                            <version>4.1 Alpha2</version>
                                <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12919505" author="vwdiesel" created="Sat, 9 Oct 2010 17:07:15 +0100"  >The following test that I am adding to TestSizeLimitedResponseReader confirms that if the header is on the original response from the server it is moved onto the response:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Test&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testResponseCopiesAllOriginalHeaders() throws Exception {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;byte[] buf = new byte[] { 1, 2, 3 };&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpResponse response = new BasicHttpResponse(HttpVersion.HTTP_1_1, HttpStatus.SC_OK, &amp;quot;OK&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response.setEntity(new ByteArrayEntity(buf));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;response.setHeader(&amp;quot;Content-Encoding&amp;quot;, &amp;quot;gzip&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;impl = new SizeLimitedResponseReader(new HeapResourceFactory(), MAX_SIZE, request, response);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;impl.readResponse();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean tooLarge = impl.isLimitReached();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpResponse reconstructed = impl.getReconstructedResponse();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;byte[] result = EntityUtils.toByteArray(reconstructed.getEntity());&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Assert.assertFalse(tooLarge);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Assert.assertArrayEquals(buf, result);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Assert.assertEquals(&amp;quot;gzip&amp;quot;, reconstructed.getFirstHeader(&amp;quot;Content-Encoding&amp;quot;).getValue());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
If the response does not contain the headers for Content-Encoding and Content-Type in the first place - it really should not be the responsibility of the client side cache to add them or attempt to determine what they should be and place them onto the response.  I don&amp;#39;t believe that this is an issue of the cache.</comment>
                    <comment id="12919506" author="vwdiesel" created="Sat, 9 Oct 2010 17:11:18 +0100"  >This patch adds an additional test to the file TestSizeLimitedResponseReader for verifying that headers on the original response are copied onto the reconstructed response.&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.</comment>
                    <comment id="12919541" author="fberger" created="Sat, 9 Oct 2010 22:24:41 +0100"  >I was not referring to the response headers which are correctly copied over, but the entity attributes which are not copied over. I&amp;#39;m attaching a patch + test case that fixes the issue.&lt;br/&gt;
&lt;br/&gt;
I think I signed a waiver a few years ago that allows me to contribute to the apache commons.</comment>
                    <comment id="12919654" author="olegk" created="Sun, 10 Oct 2010 21:00:29 +0100"  >Both patches checked in.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12920185" author="vwdiesel" created="Tue, 12 Oct 2010 14:30:07 +0100"  >Oleg,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;The fix patch was missing one additional item (The value for isChunked) that was not being copied from the old entity onto the new one.  This patch adds just that one line.&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.</comment>
                    <comment id="12921383" author="olegk" created="Fri, 15 Oct 2010 15:37:10 +0100"  >Patch checked in. Many thanks, Joe&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12456965" name="chunked_value.patch" size="1062" author="vwdiesel" created="Tue, 12 Oct 2010 14:30:07 +0100" />
                    <attachment id="12456780" name="entity.patch" size="3269" author="fberger" created="Sat, 9 Oct 2010 22:24:41 +0100" />
                    <attachment id="12456774" name="test_reconstructed_response_headers.patch" size="1367" author="vwdiesel" created="Sat, 9 Oct 2010 17:11:18 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 9 Oct 2010 16:07:15 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>134010</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47308</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>