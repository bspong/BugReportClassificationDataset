<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:19:35 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-651/HTTPCLIENT-651.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-651] Inconsistent, order dependant behaviour in HttpMethodBase.getResponse*</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-651</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>`getReponseBodyAsString` is storing the body  and may therefore provide a valid result if the code is requesting the body as stream afterwards. If you switch the order and first call getResponseBodyAsStream and afterwards try to `getReponseBodyAsString`, the result will be `null`.&lt;br/&gt;
&lt;br/&gt;
I wrote a unittest which hopefully describes the IMHO confusing behaviour:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testHttpClientBodyVsStream() throws HttpException, IOException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final HttpClient httpClient = new HttpClient();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final GetMethod getMethod = new GetMethod(&amp;quot;&lt;a href=&quot;http://www.heise.de/&quot;&gt;http://www.heise.de/&lt;/a&gt;&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final String bodyFromStream;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final String body;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;httpClient.executeMethod(getMethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;body = getMethod.getResponseBodyAsString();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;bodyFromStream = IOUtils.toString(getMethod&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.getResponseBodyAsStream());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getMethod.releaseConnection();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(body, bodyFromStream);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void testHttpClientStreamVsBody() throws HttpException, IOException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final HttpClient httpClient = new HttpClient();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final GetMethod getMethod = new GetMethod(&amp;quot;&lt;a href=&quot;http://www.heise.de/&quot;&gt;http://www.heise.de/&lt;/a&gt;&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final String bodyFromStream;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final String body;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;httpClient.executeMethod(getMethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;bodyFromStream = IOUtils.toString(getMethod&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.getResponseBodyAsStream());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;body = getMethod.getResponseBodyAsString();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getMethod.releaseConnection();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// ** This will fail **&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(body, bodyFromStream);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Searching &lt;a href=&quot;http://svn.apache.org/repos/asf/jakarta/commons/proper/httpclient/trunk/src/java/org/apache/commons/httpclient/HttpMethodBase.java&quot;&gt;http://svn.apache.org/repos/asf/jakarta/commons/proper/httpclient/trunk/src/java/org/apache/commons/httpclient/HttpMethodBase.java&lt;/a&gt; I understand the outcome, but this is confusing.&lt;br/&gt;
&lt;br/&gt;
I would expect the body data to be gone after calling one of the getResponse*-Methods and calling them again not to return null but even to throw an IllegalStateException. I would not store the body at all in the method.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12369366">HTTPCLIENT-651</key>
            <summary>Inconsistent, order dependant behaviour in HttpMethodBase.getResponse*</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="oglueck">Ortwin Gl&#252;ck</assignee>
                                <reporter username="mfriedenhagen">Mirko Friedenhagen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 May 2007 09:56:08 +0100</created>
                <updated>Sun, 11 Nov 2007 19:14:58 +0000</updated>
                    <resolved>Fri, 18 May 2007 13:57:22 +0100</resolved>
                            <version>3.1 RC1</version>
                                <fixVersion>3.1 (end of life)</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12495909" author="olegk" created="Tue, 15 May 2007 10:11:51 +0100"  >Mirco,&lt;br/&gt;
The &amp;#39;modality&amp;#39; of the response handling logic in HttpClient is a well know and a very old problem that dates back to the days of HttpClient 1.x. (I remember discussing the issue as early as year 2002). The problem has been resolved in HttpClient 4.0 codeline. I do not see a possibility for fixing  the problem in HttpClient 3.x without taking a very high risk of breaking existing applications.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12495910" author="oglueck" created="Tue, 15 May 2007 10:14:52 +0100"  >We will improve the API doc.&lt;br/&gt;
&lt;br/&gt;
I agree it&amp;#39;s arguable if the response should be buffered at all in getResponseBodyAsString. Anyway, the buffered body is eligible for gc as soon as you release the reference to the method object.</comment>
                    <comment id="12495915" author="mfriedenhagen" created="Tue, 15 May 2007 10:21:58 +0100"  >Hello Oleg, hello Ortwin,&lt;br/&gt;
&lt;br/&gt;
thanks for the quick answers :-)&lt;br/&gt;
&lt;br/&gt;
Oleg, I looked in the trunk (see the link in my message, I do not find a branch for the 4.0 codeline) and I do not the think the behaviour has changed?!&lt;br/&gt;
&lt;br/&gt;
Ortwin, IMO a new major version should fix an issue even if breaking some old code instead of describing a strange behaviour (this is of course better than doing nothing ;-)).&lt;br/&gt;
&lt;br/&gt;
Regards&lt;br/&gt;
Mirko</comment>
                    <comment id="12495920" author="oglueck" created="Tue, 15 May 2007 10:29:34 +0100"  >Mirko,&lt;br/&gt;
&lt;br/&gt;
4.0 is under Http Components. See &lt;a href=&quot;http://svn.apache.org/repos/asf/jakarta/httpcomponents/httpclient/trunk/&quot;&gt;http://svn.apache.org/repos/asf/jakarta/httpcomponents/httpclient/trunk/&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
As mentioned before, the next major release (4.0) has a modified behaviour. We are not going to change the behaviour in the minor release (3.1).&lt;br/&gt;
&lt;br/&gt;
Ortwin</comment>
                    <comment id="12495923" author="mfriedenhagen" created="Tue, 15 May 2007 10:36:39 +0100"  >Again thanks for the quick answer. I did not understand that you wanted to fix the documentation for 3.1, which is of course the only possibility without breaking everyones code.&lt;br/&gt;
&lt;br/&gt;
Best Regards&lt;br/&gt;
Mirko</comment>
                    <comment id="12496869" author="oglueck" created="Fri, 18 May 2007 13:52:50 +0100"  >Improved API doc</comment>
                    <comment id="12496870" author="oglueck" created="Fri, 18 May 2007 13:57:22 +0100"  >Patch committed.</comment>
                </comments>
                    <attachments>
                    <attachment id="12357627" name="patch.txt" size="3497" author="oglueck" created="Fri, 18 May 2007 13:52:50 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 15 May 2007 09:11:51 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133690</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47826</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>