<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:14:49 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-214/HTTPCLIENT-214.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-214] HttpClient drops connection to the proxy when an invalid &apos;connection: close&apos; directive is encountered in &apos;connection established&apos; response</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-214</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>One of our customer is using our application to connect to our servlet using &lt;br/&gt;
https.  We are using httpClient for http protocol handling.  The customer has a &lt;br/&gt;
IBM proxy (see log file).  The connect failed with a null pointer exception.&lt;br/&gt;
&lt;br/&gt;
The log seem to indicate that the proxy server is returning 200 for &amp;quot;CONNECT&amp;quot;, &lt;br/&gt;
but the proxy also sends a &amp;quot;Connection:close&amp;quot; header.  The httpClient closed &lt;br/&gt;
the connection and then tried to create the SSL socket.  If the proxy server is &lt;br/&gt;
incorrect in sending 200 with &amp;quot;Connection:close&amp;quot;, then httpClient should throw &lt;br/&gt;
exception for invalid state (IllegalStateException ?).&lt;br/&gt;
&lt;br/&gt;
I will attach the log file.</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: PC</environment>
            <key id="12333773">HTTPCLIENT-214</key>
            <summary>HttpClient drops connection to the proxy when an invalid &apos;connection: close&apos; directive is encountered in &apos;connection established&apos; response</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="bin.chen@sabre-holdings.com">Bin Chen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 May 2003 04:35:26 +0100</created>
                <updated>Wed, 16 Feb 2011 20:44:16 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:23 +0100</resolved>
                            <version>Snapshot</version>
                                <fixVersion>2.0 Beta 2</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380530" author="bin.chen@sabre-holdings.com" created="Sat, 24 May 2003 04:36:05 +0100"  >Created an attachment (id=6471)&lt;br/&gt;
log file&lt;br/&gt;
</comment>
                    <comment id="12380531" author="olegk" created="Sun, 25 May 2003 22:35:44 +0100"  >Created an attachment (id=6486)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12380532" author="olegk" created="Sun, 25 May 2003 22:43:05 +0100"  >Bin,&lt;br/&gt;
I see things a bit differently here. It is not HttpClient that fails to work&lt;br/&gt;
with IBM Web Traffic Express Caching proxy on https, rather it is IBM Web&lt;br/&gt;
Traffic Express Caching proxy that fails to work properly. Sending &amp;#39;connection:&lt;br/&gt;
close&amp;#39; header along with connection established response appears ... well... odd&lt;br/&gt;
to me. So, the bug report should have gone to the IBM folks in the very first&lt;br/&gt;
place. &lt;br/&gt;
&lt;br/&gt;
Nevertheless, HttpClient has been tweaked to ignore inappropriate &amp;#39;connection&amp;#39;&lt;br/&gt;
directives in order to make it more robust when dealing with non-compliant proxy&lt;br/&gt;
servers.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The patch attached will also make HttpClient report a waring when an invalid&lt;br/&gt;
&amp;#39;connection: close&amp;#39; directive is encountered in &amp;#39;connection established&amp;#39; response.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380533" author="becke@u.washington.edu" created="Mon, 26 May 2003 23:09:20 +0100"  >Bin, it seems that you are using an older version of HttpClient.  I do not believe the latest version &lt;br/&gt;
of HttpClient will exhibit this problem.&lt;br/&gt;
&lt;br/&gt;
Oleg, I think the patch adds valuable feedback to the user but it does not appear to change the &lt;br/&gt;
behavior of Connect.  This is good as I think the current behavior is correct.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380534" author="olegk" created="Tue, 27 May 2003 02:12:43 +0100"  >Mike, I stumbled upon this problem while doing Javadoc cleanups for the beta-1&lt;br/&gt;
release. At that point, Bin, apparently, was still running an earlier nightly build.&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
PS: Patch committed</comment>
                    <comment id="12380535" author="bin.chen@sabre-holdings.com" created="Wed, 28 May 2003 01:20:18 +0100"  >Mike and Oleg,&lt;br/&gt;
&lt;br/&gt;
First as confirmation, we are using an old version of the nightly build (0308 &lt;br/&gt;
build modified by us).  I am not sure if we can afford to upgrade in this case.&lt;br/&gt;
&lt;br/&gt;
To clarify the situation, let me give a brief description of our application.  &lt;br/&gt;
Our application is actually a signed applet and the size of the applet is &lt;br/&gt;
fairly large.  So we actually have our customers installing all the jar files &lt;br/&gt;
(including httpClient) on the client machine.  The applet is used by several &lt;br/&gt;
thousands customers worldwide.  As result, upgrading is a big deal (not simply &lt;br/&gt;
a technical decision).  The applet is using http/https to communicate with our &lt;br/&gt;
web/app server and httpClient is used for the http communication.  Currently, &lt;br/&gt;
we released our product with the modified 0308 nightly build (we could not make &lt;br/&gt;
the latest nightly build work within our release schedule).  After the release, &lt;br/&gt;
we made the attempt to find a way to work with latest build and with the great &lt;br/&gt;
help from you guys we got there.  But the new code is not in the release yet.  &lt;br/&gt;
Also our average users are not very comfortable with computers so it is rather &lt;br/&gt;
difficult to make our users to test different scenarios.&lt;br/&gt;
&lt;br/&gt;
Now this bug is reported from the field and the customer is still using the old &lt;br/&gt;
code.&lt;br/&gt;
&lt;br/&gt;
Now come back to the bug.  If I read your comments correctly, then&lt;br/&gt;
1. The bug was caused by the incorrect behavior of IBM proxy server (200 with &lt;br/&gt;
connection:close).&lt;br/&gt;
2. The latest nightly build (or coming beta) will handle the error better, but &lt;br/&gt;
it still would not work.&lt;br/&gt;
&lt;br/&gt;
For point 1, I agree with that assessment.  &lt;br/&gt;
&lt;br/&gt;
For point 2, I would like to know what will be the expected behavior (logging &lt;br/&gt;
some warning or throwing exceptions).  Given that I do not have the environment &lt;br/&gt;
to reproduce the problem, I may have to let our customers do the test.  So I &lt;br/&gt;
would need to know what to expect.  &lt;br/&gt;
&lt;br/&gt;
Finally, I know that the httpClient is close to beta 2 and this should not stop &lt;br/&gt;
it.  But I hope this can be addressed in some later version.  Our customer have &lt;br/&gt;
tried to use our application with browser connection (one of the things applet &lt;br/&gt;
can do), it did navigate through the proxy server OK.  I would think that &lt;br/&gt;
httpClient can also work with the situation and find a way to work with &lt;br/&gt;
this &amp;quot;incorrect&amp;quot; proxy server behavior (may be ignoring the connection:close &lt;br/&gt;
when 200 is returned?).</comment>
                    <comment id="12380536" author="olegk" created="Wed, 28 May 2003 02:22:48 +0100"  >Bin,&lt;br/&gt;
I apologize if mine of Mike&amp;#39;s statements turned out to be confusing or&lt;br/&gt;
contradictory. &lt;br/&gt;
&lt;br/&gt;
In fact, since beta-1 HttpClient does ignore &amp;#39;connection: close&amp;#39; header (as well&lt;br/&gt;
as all other headers) when Connect method returns status code 200, and therefore&lt;br/&gt;
should work with non-compliant proxy servers including IBM Web Traffic Express&lt;br/&gt;
that one of your clients is using. &lt;br/&gt;
&lt;br/&gt;
I stumbled upon the problem pretty much by chance just a day before you filed&lt;br/&gt;
the report.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://cvs.apache.org/viewcvs/jakarta-commons/httpclient/src/java/org/apache/commons/httpclient/ConnectMethod.java.diff?r1=1.14&amp;r2=1.15&quot;&gt;http://cvs.apache.org/viewcvs/jakarta-commons/httpclient/src/java/org/apache/commons/httpclient/ConnectMethod.java.diff?r1=1.14&amp;amp;r2=1.15&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
My latest patch merely added a warning for non-compliant behaviour.&lt;br/&gt;
&lt;br/&gt;
I hope that clarified things a bit. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380537" author="bin.chen@sabre-holdings.com" created="Wed, 28 May 2003 03:13:38 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
Thanks, that is goog new for us.  By the way, when will the beta-1 be &lt;br/&gt;
released.  We are considering moving to the latest build, but prefer to wait &lt;br/&gt;
until beta-1 is released so we can stay on a more stable version.&lt;br/&gt;
&lt;br/&gt;
Bin Chen</comment>
                    <comment id="12380538" author="olegk" created="Wed, 28 May 2003 03:33:17 +0100"  >Bin,&lt;br/&gt;
Beta-1 has been tagged in the CVS two days ago is officially out. Unfortunately,&lt;br/&gt;
Jeff &amp;quot;Jandalf&amp;quot;, our release prime, has been staying off-line for quite some&lt;br/&gt;
time. We can&amp;#39;t deploy the official build without him, as only Jeff has necessary&lt;br/&gt;
access permissions for the official Jakarta file repository &amp;amp; web site. &lt;br/&gt;
&lt;br/&gt;
That should not stop you from obtaining the beta-1 release, though. Just get it&lt;br/&gt;
from the CVS by running the following command:&lt;br/&gt;
&lt;br/&gt;
cvs -d :pserver:&lt;a href=&apos;mailto:anoncvs@cvs.apache.org&apos;&gt;anoncvs@cvs.apache.org&lt;/a&gt;:/home/cvspublic co -r&lt;br/&gt;
HTTPCLIENT_2_0_BETA1 jakarta-commons/httpclient&lt;br/&gt;
&lt;br/&gt;
Cheers&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12380539" author="oglueck" created="Wed, 28 May 2003 14:44:07 +0100"  >Bin,&lt;br/&gt;
&lt;br/&gt;
The only way to fix the problem in your production environment will be to&lt;br/&gt;
upgrade to beta-1. This should be an easy upgrade because your version (0308) is&lt;br/&gt;
a post alpha-3 version. So the differences will be small (the diff is huge&lt;br/&gt;
though) on the API level. You should at least give it a try.</comment>
                </comments>
                    <attachments>
                    <attachment id="12326887" name="ASF.LICENSE.NOT.GRANTED--jserver IBM Proxy bug.txt" size="16547" author="bin.chen@sabre-holdings.com" created="Sat, 24 May 2003 04:36:05 +0100" />
                    <attachment id="12326888" name="ASF.LICENSE.NOT.GRANTED--proxyconnect.patch" size="1977" author="olegk" created="Sun, 25 May 2003 22:35:44 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>20198</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 25 May 2003 21:35:44 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133268</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189279</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>