<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:11:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1001/HTTPCLIENT-1001.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1001] CacheEntryUpdater does not properly update cache entry resource</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1001</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>CacheEntryUpdater#updateCacheEntry() copies the old cache entry&amp;#39;s resource, though I believe it should only do so if the response is a 304.  Otherwise it should take the response from the server to update the entry.  This method gets called when validating a cache entry and the server returns a 200 or 304.</description>
                <environment></environment>
            <key id="12475346">HTTPCLIENT-1001</key>
            <summary>CacheEntryUpdater does not properly update cache entry resource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="cim_michajlomatijkiw">Michajlo Matijkiw</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Sep 2010 21:59:05 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:26 +0000</updated>
                    <resolved>Fri, 1 Oct 2010 10:50:21 +0100</resolved>
                                            <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12916183" author="cim_michajlomatijkiw" created="Wed, 29 Sep 2010 17:09:35 +0100"  >This patch should be applied against TestCacheEntryUpdater and it exposes the mentioned bug.  I have started to work on a fix but was hoping for some feedback on my approach.&lt;br/&gt;
&lt;br/&gt;
I am looking to move the logic of CacheEntryUpdater#updateCacheEntry into BasicHttpCache (this is the only place where it is used).  The rest of CacheEntryUpdater&amp;#39;s methods can remain as helper methods.  I think this will simplify the logic and help prevent any code duplication.  I believe it might make resolving &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1003&quot; title=&quot;Handle conditional requests in cache&quot;&gt;&lt;strike&gt;HTTPCLIENT-1003&lt;/strike&gt;&lt;/a&gt; easier as well.&lt;br/&gt;
&lt;br/&gt;
Any thoughts?&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12916233" author="cim_michajlomatijkiw" created="Wed, 29 Sep 2010 19:39:40 +0100"  >This patch fixes functionality so that a stale cache entry&amp;#39;s resource is only copied into the new entry on 304 responses (it is still valid), and is replaced by all other responses.  The following changes were made:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- Move CacheEntryUpdater#updateCacheEntry() logic into BasicHttpCache#updateCacheEntry(), if the response is not 304 then call BasicCacheEntry#cacheAndReturnResponse()&lt;br/&gt;
&amp;nbsp;- Deleted CacheEntryUpdater tests &amp;quot;testUpdateCacheEntryReturnsDifferentEntryInstance()&amp;quot; and &amp;quot;testUpdatedEntryHasLatestRequestAndResponseDates()&amp;quot; - these are trivial and difficult to test with the rearranged code&lt;br/&gt;
&amp;nbsp;- Added &amp;quot;Via&amp;quot; header to backendResponse in CachingHttpClient revalidation method&lt;br/&gt;
&amp;nbsp;- Added tests to TestBasicHttpCache to check proper updating of response body&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12916331" author="cim_michajlomatijkiw" created="Thu, 30 Sep 2010 02:03:56 +0100"  >Please disregard the previous patch, I am currently working on another version that should be a little more elegant and make &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1003&quot; title=&quot;Handle conditional requests in cache&quot;&gt;&lt;strike&gt;HTTPCLIENT-1003&lt;/strike&gt;&lt;/a&gt; easier.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12916521" author="cim_michajlomatijkiw" created="Thu, 30 Sep 2010 16:43:07 +0100"  >This patch provides a slightly cleaner fix. &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- Only 304 responses go through updateCacheEntry, and I have updated CacheEntryUpdater#updateCacheEntry() to reinforce this&lt;br/&gt;
&amp;nbsp;- In CachingHttpClient#revalidateCacheEntry() non-304 responses go through handleBackendResponse() to ensure cachability&lt;br/&gt;
&amp;nbsp;- Updated unit tests to reflect this change&lt;br/&gt;
&lt;br/&gt;
I also fixed a random typo in CachedResponseSuitabilityChecker.java&lt;br/&gt;
&lt;br/&gt;
Please let me know if I have missed anything.&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12916843" author="olegk" created="Fri, 1 Oct 2010 10:50:21 +0100"  >Patch &amp;#39;cache_update_fix2.patch&amp;#39; checked in. Many thanks, Michajlo&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12455927" name="cache_entry_updater_bug_test.patch" size="2598" author="cim_michajlomatijkiw" created="Wed, 29 Sep 2010 17:09:35 +0100" />
                    <attachment id="12456019" name="cache_update_fix2.patch" size="8229" author="cim_michajlomatijkiw" created="Thu, 30 Sep 2010 16:43:07 +0100" />
                    <attachment id="12455937" name="cache_update_fix.patch" size="14627" author="cim_michajlomatijkiw" created="Wed, 29 Sep 2010 19:39:40 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 1 Oct 2010 09:50:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>134002</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47316</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>