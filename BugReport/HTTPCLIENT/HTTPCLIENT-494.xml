<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:18:02 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-494/HTTPCLIENT-494.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-494] Invalid redirects are not corrected</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-494</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>If a get is made to a page with a query argument containing a space, many web&lt;br/&gt;
servers, notably including Tomcat 5 can generate a redirect in which the space&lt;br/&gt;
in the query argument is not escaped correctly.  Most browsers including IE and&lt;br/&gt;
Firefox compensate for this by quoting any included spaces in the redirect&lt;br/&gt;
location.  Http client does not.  When this broken URL is presented to a&lt;br/&gt;
subsequent server, the GET command is interprted incorrectly resulting (usually)&lt;br/&gt;
in a 505.&lt;br/&gt;
&lt;br/&gt;
The fix is to replace spaces in redirect locations with +&amp;#39;s.  This doesn&amp;#39;t&lt;br/&gt;
entirely fix the problem but that is the job of the web server developers.</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12334053">HTTPCLIENT-494</key>
            <summary>Invalid redirects are not corrected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="olegk">Oleg Kalnichevski</assignee>
                                <reporter username="tdunning@veoh.com">Ted Dunning</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Sep 2005 16:04:33 +0100</created>
                <updated>Sun, 22 Apr 2007 08:11:06 +0100</updated>
                    <resolved>Sat, 10 Jun 2006 18:38:27 +0100</resolved>
                            <version>2.0.2</version>
                                <fixVersion>3.1 Alpha 1</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382602" author="rolweber@de.ibm.com" created="Fri, 9 Sep 2005 16:33:53 +0100"  >If we start to implement workarounds for all kinds of bugs that&lt;br/&gt;
are tolerated by browsers we&amp;#39;ll end up in hell&amp;#39;s kitchen, as a&lt;br/&gt;
german proverb says. The solution to your problem is:&lt;br/&gt;
&lt;br/&gt;
1. disable automatic redirects&lt;br/&gt;
2. get the Location: response header&lt;br/&gt;
3. fix anything you think should be fixed&lt;br/&gt;
4. generate a followup request with the fixed URL&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12382603" author="oglueck" created="Fri, 9 Sep 2005 17:16:02 +0100"  >I completely agree with Roland. HttpClient is not a browser. We do not&lt;br/&gt;
compensate for wrong user input. Sanitizing user input is the domain of your&lt;br/&gt;
application and not some library you are using. As my experience shows,&lt;br/&gt;
functions that try and guess what some malformed input could probably mean&lt;br/&gt;
quickly become useless and source of errors.</comment>
                    <comment id="12382604" author="tdunning@veoh.com" created="Sat, 10 Sep 2005 02:06:31 +0100"  >&lt;br/&gt;
Shooting from the hip like this is not so good.  I have already implemented a&lt;br/&gt;
work-around as described in my original message.&lt;br/&gt;
&lt;br/&gt;
This problem is a bug in HttpClient either way you take it.  Either of two cases&lt;br/&gt;
applies:&lt;br/&gt;
&lt;br/&gt;
- a (possibly optional) compensation is a good idea so that programs like&lt;br/&gt;
HttpUnit can accurately test web sites by mimicing wide-spread behavior &lt;br/&gt;
&lt;br/&gt;
or &lt;br/&gt;
&lt;br/&gt;
- compensation is a bad thing in which case HttpClient should be checking for&lt;br/&gt;
invalid input.&lt;br/&gt;
&lt;br/&gt;
I agree that this is also a bug on the part of Tomcat (or more likely acegi). &lt;br/&gt;
But that doesn&amp;#39;t absolve HttpClient from the responsibility for checking for&lt;br/&gt;
invalid inputs.  Keep in mind that this is *not* user input, but automatically&lt;br/&gt;
generated input.  Also, the error produced is after the redirect happens and is&lt;br/&gt;
a 505, unsupported protocol which is highly misleading.  A simple check for&lt;br/&gt;
valid location would allow HttpClient to provide an accurate and timely&lt;br/&gt;
indication of error.&lt;br/&gt;
</comment>
                    <comment id="12382605" author="becke@u.washington.edu" created="Sat, 10 Sep 2005 07:01:31 +0100"  >Adding a validation check to the location header would certainly help in this situation.  Seems reasonable.&lt;br/&gt;
&lt;br/&gt;
Ted, a patch and test against 3.0 would go a long way to getting this issue resolved :)&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382606" author="oglueck" created="Sun, 11 Sep 2005 02:13:50 +0100"  >Ted,&lt;br/&gt;
&lt;br/&gt;
do you mean you don&amp;#39;t get an exception?&lt;br/&gt;
Does this only happen when an invalid URL in a Location header is encountered or&lt;br/&gt;
when you create a new GetMethod?</comment>
                    <comment id="12382607" author="tdunning@veoh.com" created="Sun, 11 Sep 2005 03:07:12 +0100"  >&lt;br/&gt;
Odi,&lt;br/&gt;
&lt;br/&gt;
I haven&amp;#39;t checked to see if GetMethod would throw an exception if I give it an&lt;br/&gt;
invalid URL.  Hopefully it would.  What I have encountered is that when I&lt;br/&gt;
construct a GetMethod with a valid URL and then that URL gives me a redirect&lt;br/&gt;
with an invalid URL in the Location header field (DUE TO A SERVER BUG, NOT MY&lt;br/&gt;
INPUT), then I do not get an exception.  Instead, HttpClient dutifully submits&lt;br/&gt;
the invalid URL to the server that handles the redirect and I get a 505 invalid&lt;br/&gt;
protocol.&lt;br/&gt;
&lt;br/&gt;
The best thing for HttpClient to do would be to throw an exception when a&lt;br/&gt;
redirect to an invalid URL happens.  (or even whenever access to an invalid URL&lt;br/&gt;
is attempted).  That would tell the user of HttpClient what they need to know&lt;br/&gt;
(the server gave an invalid Location field) as soon as possible and as clearly&lt;br/&gt;
as possible.  The work-around that I use (and which was independently suggested&lt;br/&gt;
here) can then be implemented ... disable automatic redirects and try to fix the&lt;br/&gt;
URL by hand until the server can be corrected.&lt;br/&gt;
&lt;br/&gt;
I will be under water schedule-wise for the next few weeks.  Otherwise, I would&lt;br/&gt;
be happy to produce a test case and a patch.  When I come up for air, I may be&lt;br/&gt;
able to do it if it hasn&amp;#39;t happened before then.</comment>
                    <comment id="12382608" author="rolweber@de.ibm.com" created="Sun, 11 Sep 2005 18:09:06 +0100"  >If we build in this feature, we must be able to switch it off&lt;br/&gt;
through a parameter. How should we know that the server isn&amp;#39;t&lt;br/&gt;
capable of handling the presumably invalid redirect it sent us?&lt;br/&gt;
This change might break things that have worked before, though&lt;br/&gt;
not within the specifications.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12382609" author="oglueck" created="Mon, 12 Sep 2005 17:20:17 +0100"  >Ted,&lt;br/&gt;
&lt;br/&gt;
Thanks for the clarifications. I guess everybody misunderstood your initial&lt;br/&gt;
report. I suggest to create a new subclass of HttpProtocolException for this&lt;br/&gt;
issue where we add the malformed URL as a field. So it can easily be handled by&lt;br/&gt;
the application. I still would not try and fix the malformed URL.</comment>
                    <comment id="12382610" author="olegk" created="Mon, 12 Sep 2005 18:48:30 +0100"  >If we have to introduce new classes / methods in otder to fix the problem it&lt;br/&gt;
will have to wait until 3.1&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382611" author="oglueck" created="Mon, 12 Sep 2005 19:57:05 +0100"  >Oleg, it is just an exception sub-class. It won&amp;#39;t break the API.</comment>
                    <comment id="12382612" author="olegk" created="Mon, 12 Sep 2005 21:09:34 +0100"  >(In reply to comment #10)&lt;br/&gt;
&amp;gt; Oleg, it is just an exception sub-class. It won&amp;#39;t break the API.&lt;br/&gt;
&lt;br/&gt;
I am not saying it would break the API. However, the introduction of a new&lt;br/&gt;
exception class would effectively change the API, which is meant to stay frozen&lt;br/&gt;
until 3.0 release. I personally do not think this problem is severe enough to&lt;br/&gt;
justify the API change so late in the release process. My preference would be to&lt;br/&gt;
stick to the announced API freeze and to address this issue after the 3.0 release&lt;br/&gt;
&lt;br/&gt;
Oleg &lt;br/&gt;
</comment>
                    <comment id="12382613" author="becke@u.washington.edu" created="Mon, 12 Sep 2005 23:31:05 +0100"  >I agree with Oleg.  Adding this class doesn&amp;#39;t break the API, but it does change&lt;br/&gt;
it.  3.1 is the way to go.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382614" author="mohammad.rezaei@gs.com" created="Tue, 13 Sep 2005 00:56:37 +0100"  >Please make sure that relative URL&amp;#39;s are allowed in the Location: header.&lt;br/&gt;
Strictly speaking, this is against the HTTP RFC, but I think that&amp;#39;s more of an&lt;br/&gt;
oversight in the RFC. There is really nothing wrong with a relative redirect,&lt;br/&gt;
and it&amp;#39;s common practice after a POST request (just google &amp;quot;redirect afer&lt;br/&gt;
post&amp;quot;). All browsers handle relative redirects correctly.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Moh</comment>
                    <comment id="12382615" author="oglueck" created="Tue, 13 Sep 2005 01:00:15 +0100"  >The reason for this bug is that URI does not check for invalid characters. Space&lt;br/&gt;
is not an allowed character in a URI. Fixing this issue correctly would mean to&lt;br/&gt;
add a whole lot of checks to the URI class. With an URI consisting of several&lt;br/&gt;
parts that all have different sets of allowed and reserved characters and&lt;br/&gt;
because URIs can have several forms this is a worksome task. I should definitely&lt;br/&gt;
rewrite that darn URI class once. It is just too bad.</comment>
                    <comment id="12382616" author="oglueck" created="Tue, 13 Sep 2005 01:07:07 +0100"  >Created an attachment (id=16371)&lt;br/&gt;
Test cases&lt;br/&gt;
&lt;br/&gt;
Here are some test cases that reproduce the bug. The redirect test actually&lt;br/&gt;
throws a ConnectionClose exception. This is because HttpClient does not detect&lt;br/&gt;
the invalid URI and sends an invalid query to our internal test server which&lt;br/&gt;
just terminates the connection.</comment>
                    <comment id="12382617" author="olegk" created="Tue, 13 Sep 2005 03:13:48 +0100"  >(In reply to comment #13)&lt;br/&gt;
&amp;gt; Please make sure that relative URL&amp;#39;s are allowed in the Location: header.&lt;br/&gt;
&amp;gt; Strictly speaking, this is against the HTTP RFC, but I think that&amp;#39;s more of an&lt;br/&gt;
&amp;gt; oversight in the RFC. There is really nothing wrong with a relative redirect,&lt;br/&gt;
&amp;gt; and it&amp;#39;s common practice after a POST request (just google &amp;quot;redirect afer&lt;br/&gt;
&amp;gt; post&amp;quot;). All browsers handle relative redirects correctly.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Thanks&lt;br/&gt;
&amp;gt; Moh&lt;br/&gt;
&lt;br/&gt;
Mohammad,&lt;br/&gt;
If the &amp;#39;http.protocol.reject-relative-redirect&amp;#39; parameter is set to false,&lt;br/&gt;
HttpClient will attempt to process relative redirects. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382618" author="oglueck" created="Tue, 13 Sep 2005 07:20:58 +0100"  >Created an attachment (id=16373)&lt;br/&gt;
Test cases&lt;br/&gt;
&lt;br/&gt;
Fixed test case.</comment>
                    <comment id="12415616" author="olegk" created="Sat, 10 Jun 2006 05:25:14 +0100"  >Patch (take 1). Please review&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12415640" author="rolandw" created="Sat, 10 Jun 2006 13:31:31 +0100"  >patch looks good&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12415661" author="olegk" created="Sat, 10 Jun 2006 18:38:27 +0100"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12335283" name="invalidredirect.patch" size="9477" author="olegk" created="Sat, 10 Jun 2006 05:25:14 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>36568</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 9 Sep 2005 15:33:53 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133541</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47934</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>