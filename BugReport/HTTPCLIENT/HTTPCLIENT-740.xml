<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:20:34 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-740/HTTPCLIENT-740.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-740] AbstractConnPool constructor calls thread.Start()</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-740</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>AbstractConnPool constructor calls thread.Start()&lt;br/&gt;
&lt;br/&gt;
Findbugs says:&lt;br/&gt;
&lt;br/&gt;
Constructor invokes Thread.start()&lt;br/&gt;
&lt;br/&gt;
The constructor starts a thread. This is likely to be wrong if the class is ever extended/subclassed, since the thread will be started before the subclass constructor is started.&lt;br/&gt;
&lt;br/&gt;
The class is not final (and the constructor is protected) which suggests that the class is intended to be extended...</description>
                <environment></environment>
            <key id="12387579">HTTPCLIENT-740</key>
            <summary>AbstractConnPool constructor calls thread.Start()</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="rolandw">Roland Weber</assignee>
                                <reporter username="sebb@apache.org">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Jan 2008 21:44:11 +0000</created>
                <updated>Tue, 25 Jan 2011 10:58:48 +0000</updated>
                    <resolved>Sun, 3 Feb 2008 17:12:57 +0000</resolved>
                                            <fixVersion>4.0 Alpha 3</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12564849" author="rolandw" created="Fri, 1 Feb 2008 18:05:39 +0000"  >In this case, it is not a bug. The background thread being started does not depend on the completed initialization of the pool instance. That part of the code needs to be changed anyway, so I&amp;#39;ll move it to an extra method when the time comes. I hope that will be enough to silence findbugs.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12565060" author="sebb@apache.org" created="Sat, 2 Feb 2008 12:28:23 +0000"  >The RefQueueWorker constructor is passed &amp;quot;this&amp;quot; as a parameter, and uses that to call handleReference().&lt;br/&gt;
&lt;br/&gt;
Even if the class is not extended, this is a bug, because the constructor has not finished, and therefore the object may not have been completely constructed.&lt;br/&gt;
&lt;br/&gt;
The &amp;quot;this&amp;quot; reference must not be used by another thread until the constructor returns. The started thread may use it before the constructor returns.&lt;br/&gt;
&lt;br/&gt;
[See p41 of Java Concurrency in Practice for more details]</comment>
                    <comment id="12565190" author="rolandw" created="Sun, 3 Feb 2008 17:12:57 +0000"  >Hi Sebastian,&lt;br/&gt;
&lt;br/&gt;
the started thread implements a callback when connections or the connection manager are garbage collected. There are no connections that can be GCed before the constructor returns, and the connection manager is hard referenced from the call stack. Hence, the callback cannot be triggered unless somebody puts maliciously stupid code into derived class constructors.&lt;br/&gt;
&lt;br/&gt;
The reason why I start the thread immediately after creating the reference queue is to make sure that the reference queue is being handled. If I split this in two methods, somebody will create the reference queue without starting the thread, thereby creating a memory leak.&lt;br/&gt;
&lt;br/&gt;
Anyway, I moved the code for creating both reference queue and callback thread to an extra method that has to be called after creating the connection pool. I hope this addresses your requirements as well as mine. The price to pay is that derived classes can no longer populate the pool in the constructor if they want to support connection GC, since the reference queue must be known when creating a pool entry.&lt;br/&gt;
&lt;br/&gt;
Please review the change (revision 618019).&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12565195" author="sebb@apache.org" created="Sun, 3 Feb 2008 17:57:53 +0000"  >Seems OK to me as far as multi-threadedness is concerned.&lt;br/&gt;
&lt;br/&gt;
Probably ought to start documenting fields such as numConnections with the @GuardedBy annotation.&lt;br/&gt;
This is not a standard annotation, so the build would need to be updated to depend on the jar.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12565198" author="rolandw" created="Sun, 3 Feb 2008 18:03:50 +0000"  >Hi Sebastian,&lt;br/&gt;
&lt;br/&gt;
I would prefer to continue with TSCCM refactoring and bringing it to a somewhat consistent state before starting with the goldplating. But if you want to get started on this stuff, just go ahead. Oleg should be able to help you with modifying the Maven build, I&amp;#39;ll take care of my local Ant build when necessary. I just hope the jar you mentioned is only a build-time dependency.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 1 Feb 2008 18:05:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133778</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47444</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>