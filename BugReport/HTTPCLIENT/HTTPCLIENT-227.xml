<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:14:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-227/HTTPCLIENT-227.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-227] Missing Content-Length header causes a SocketException</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-227</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Essentially, we have an invalid HTTP server (Stellent CMS actually and we will file a bug with them), &lt;br/&gt;
which is returning headers like:&lt;br/&gt;
&lt;br/&gt;
HTTP/1.1 401 Unauthorized&lt;br/&gt;
WWW-Authenticate: Basic &amp;quot;Secure Realm&amp;quot;&lt;br/&gt;
Connection: keep-alive&lt;br/&gt;
&lt;br/&gt;
Which is clearly missing the Content-Length header.  Now, previously HttpClient handled this &lt;br/&gt;
perfectly by reading until the end of the connection (ie: treating it like it was a Connection: close), &lt;br/&gt;
however for some reason a socket exception is being thrown and the invalid connection is added &lt;br/&gt;
back into the connection pool and then every connection to the server after that thows an &lt;br/&gt;
exception.&lt;br/&gt;
&lt;br/&gt;
See the thread &amp;quot;SocketException with invalid server&amp;quot; for the full discussion of the issue.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll attach a patch that fixes the problem.  The biggest thing to consider is the changes to the &lt;br/&gt;
duplicate Connection header test cases which resolves around the question: if Connection: keep-&lt;br/&gt;
alive is present but no Content-Length is provided, should the connection be closed?  The patch &lt;br/&gt;
requires the answer to be yes and I really can&amp;#39;t see any other way to do it.</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12333786">HTTPCLIENT-227</key>
            <summary>Missing Content-Length header causes a SocketException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="adrian@ephox.com">Adrian Sutton</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jun 2003 13:30:54 +0100</created>
                <updated>Wed, 16 Feb 2011 20:44:11 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:25 +0100</resolved>
                            <version>1.0 Alpha</version>
                                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380647" author="adrian@ephox.com" created="Fri, 20 Jun 2003 13:35:30 +0100"  >Created an attachment (id=6906)&lt;br/&gt;
Fix take 1&lt;br/&gt;
</comment>
                    <comment id="12380648" author="olegk" created="Fri, 20 Jun 2003 15:27:03 +0100"  >Adrian,&lt;br/&gt;
I am afraid the patch will break support for chunk-encoded responses.&lt;br/&gt;
Chunk-encoded responses use &amp;#39;Transfer-Encoding&amp;#39; header instead of&lt;br/&gt;
&amp;#39;Content-Length&amp;#39; header. The patch in its existing form will cause connections&lt;br/&gt;
to be dropped after a chunk-encoded response is received.&lt;br/&gt;
Oleg</comment>
                    <comment id="12380649" author="adrian@ephox.com" created="Fri, 20 Jun 2003 15:30:24 +0100"  >doh...  Do we not have test cases for that?  I guess that&amp;#39;s something else to add.  I&amp;#39;ll take another &lt;br/&gt;
shot at it tonight.</comment>
                    <comment id="12380650" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:13:46 +0100"  >Created an attachment (id=6909)&lt;br/&gt;
Fix take 2.&lt;br/&gt;
</comment>
                    <comment id="12380651" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:14:51 +0100"  >Patch take 2 features:&lt;br/&gt;
&lt;br/&gt;
1. Works with chunked encoding.&lt;br/&gt;
2. A test case for chunked encoding.&lt;br/&gt;
3. Everything that was in take 1.&lt;br/&gt;
</comment>
                    <comment id="12380652" author="olegk" created="Fri, 20 Jun 2003 17:25:18 +0100"  >Adrian,&lt;br/&gt;
I do not like that darn &amp;#39;isChunked&amp;#39; flag. Besides, you forget to reset it in&lt;br/&gt;
HttpMethodBase#recycle. (I DO get convinced that the whole idea of recycling is&lt;br/&gt;
evil after all).&lt;br/&gt;
&lt;br/&gt;
I suggest that you just check for presence of &amp;#39;Transfer-Encoding&amp;#39; or&lt;br/&gt;
&amp;#39;Content-Length&amp;#39; header in response. That is it. Do not even parse them. We can&lt;br/&gt;
assume that the headers will be correctly reacted upon elsewhere.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380653" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:36:59 +0100"  >Yeah, I didn&amp;#39;t like the flag much either (and I never understood why you&amp;#39;d recycle methods) but &lt;br/&gt;
didn&amp;#39;t really like blindly assuming that the transfer encoding header was right.  I&amp;#39;m happy with it if &lt;br/&gt;
you are though.  New patch coming soon.</comment>
                    <comment id="12380654" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:40:18 +0100"  >Created an attachment (id=6910)&lt;br/&gt;
Take 3.&lt;br/&gt;
</comment>
                    <comment id="12380655" author="olegk" created="Fri, 20 Jun 2003 18:03:08 +0100"  >Adrian,&lt;br/&gt;
My rationale is that by the time decision needs to be made whether the&lt;br/&gt;
connection is to be closed, an invalid &amp;#39;Transfer-Encoding&amp;#39; or &amp;#39;Content-Length&amp;#39;&lt;br/&gt;
header would already have caused an exception. I would even go as far as saying&lt;br/&gt;
that the check would be sufficient&lt;br/&gt;
&lt;br/&gt;
+  if (responseHeaders.getFirstHeader(&amp;quot;Transfer-Encoding&amp;quot;) == null &amp;amp;&amp;amp;&lt;br/&gt;
+      responseHeaders.getFirstHeader(&amp;quot;Content-Length&amp;quot;) == null) {&lt;br/&gt;
+          LOG.debug(&amp;quot;Should close connection as content-length is missing.&amp;quot;);&lt;br/&gt;
+          return true;&lt;br/&gt;
+  }&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380656" author="adrian@ephox.com" created="Fri, 20 Jun 2003 18:17:38 +0100"  >Good point, my mind is now at ease.  :)  Any other issues you can see?  I&amp;#39;d like to wait for Mike to &lt;br/&gt;
take a look at the patch before committing it anyway since he&amp;#39;d been looking into the problem &lt;br/&gt;
earlier.</comment>
                    <comment id="12380657" author="olegk" created="Fri, 20 Jun 2003 18:22:04 +0100"  >Sure. Let Mike take a look. As far as I am concerned all the issues have been &lt;br/&gt;
addressed. I would like to streamline HttpMethodBase#getResponseContentLength() &lt;br/&gt;
method a bit, but I&amp;#39;ll submit it as a separate incremental patch&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380658" author="becke@u.washington.edu" created="Fri, 20 Jun 2003 20:52:34 +0100"  >This patch does not work in the absence of keep-alive headers.  I will attach a fix for this plus &lt;br/&gt;
some more test cases in a moment.  This patch just moves the content length test to the top of &lt;br/&gt;
shouldCloseConnection().&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380659" author="becke@u.washington.edu" created="Fri, 20 Jun 2003 20:52:59 +0100"  >Created an attachment (id=6912)&lt;br/&gt;
patch 3&lt;br/&gt;
</comment>
                    <comment id="12380660" author="adrian@ephox.com" created="Fri, 20 Jun 2003 20:59:43 +0100"  >gah... You&amp;#39;re right.  Your changes make sense and looks good to me.&lt;br/&gt;
&lt;br/&gt;
Oleg, how does this affect your reorganisation of that method?</comment>
                    <comment id="12380661" author="olegk" created="Fri, 20 Jun 2003 21:06:25 +0100"  >It does not affect it at all. I believe the patch is good to go now &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380662" author="adrian@ephox.com" created="Fri, 20 Jun 2003 21:35:55 +0100"  >Patch committed.</comment>
                </comments>
                    <attachments>
                    <attachment id="12326905" name="ASF.LICENSE.NOT.GRANTED--newContentLength3.patch" size="4785" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:40:18 +0100" />
                    <attachment id="12326904" name="ASF.LICENSE.NOT.GRANTED--noContentLength2.patch" size="5262" author="adrian@ephox.com" created="Fri, 20 Jun 2003 17:13:46 +0100" />
                    <attachment id="12326903" name="ASF.LICENSE.NOT.GRANTED--noContentLength.patch" size="3562" author="adrian@ephox.com" created="Fri, 20 Jun 2003 13:35:30 +0100" />
                    <attachment id="12326906" name="ASF.LICENSE.NOT.GRANTED--zerocontentlength.patch" size="4493" author="becke@u.washington.edu" created="Fri, 20 Jun 2003 20:52:59 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>20938</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 20 Jun 2003 14:27:03 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133281</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189024</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>