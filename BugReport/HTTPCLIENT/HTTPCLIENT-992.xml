<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:23:01 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-992/HTTPCLIENT-992.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-992] cache should not generate stale responses to requests explicitly requesting first-hand or fresh ones</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-992</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>The current implementation will serve a stale response in the case that it has a stale cache entry but revalidation with the origin fails. However, the RFC says we SHOULD NOT do this if the client explicitly requested a first-hand or fresh response (via no-cache, max-age, max-stale, or min-fresh).&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12473614">HTTPCLIENT-992</key>
            <summary>cache should not generate stale responses to requests explicitly requesting first-hand or fresh ones</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="cimjmoore">Jonathan Moore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Sep 2010 20:34:41 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:24 +0000</updated>
                    <resolved>Wed, 8 Sep 2010 21:45:45 +0100</resolved>
                            <version>4.1 Alpha2</version>
                                <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12907374" author="cimjmoore" created="Wed, 8 Sep 2010 20:36:02 +0100"  >The attached patch addresses this issue by either propagating the IOException (for no-cache requests) or by generating a 504 (Gateway Timeout) error.&lt;br/&gt;
&lt;br/&gt;
This patch is contributed to the ASF with the permission of my employer.&lt;br/&gt;
</comment>
                    <comment id="12907377" author="cimjmoore" created="Wed, 8 Sep 2010 20:43:25 +0100"  >By the way, here was something I could use a little input on, behavior-wise:&lt;br/&gt;
&lt;br/&gt;
Suppose we have a cache entry dated 10 seconds ago with &amp;#39;Cache-Control: max-age=5&amp;#39;. This is now 5 seconds stale and has an age of 10 seconds. If a client asks for this entry with &amp;#39;Cache-Control: max-age=20&amp;#39;, what should we do, if the revalidation with the origin fails?&lt;br/&gt;
&lt;br/&gt;
(a) return the stale cache entry, as the overall age of the request is less than the max-age requested&lt;br/&gt;
(b) return a 504 (Gateway Timeout), since max-age on a request assumes the cache entry is still fresh and just tightens the freshness constraints; if the client was ok with a stale entry they would have used &amp;#39;max-stale&amp;#39; instead&lt;br/&gt;
&lt;br/&gt;
The current patch does (a), preferring to returning a stale entry over a 504 error, but I am actually leaning a little towards (b) now. I think &amp;#39;max-age&amp;#39; on a request means &amp;quot;I want a *fresh* response no older than this&amp;quot;.&lt;br/&gt;
</comment>
                    <comment id="12907382" author="cimjmoore" created="Wed, 8 Sep 2010 20:48:56 +0100"  >I&amp;#39;ve attached a patch that implements option (b) above if so desired.&lt;br/&gt;
&lt;br/&gt;
This patch is contributed to the ASF with the permission of my employer.&lt;br/&gt;
</comment>
                    <comment id="12907404" author="cimjmoore" created="Wed, 8 Sep 2010 21:18:07 +0100"  >Answered my own question by reading the RFC:&lt;br/&gt;
&lt;br/&gt;
&amp;quot;max-age&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Indicates that the client is willing to accept a response whose age is no greater than the specified time in seconds. Unless max- stale directive is also included, the client is not willing to accept a stale response.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
So option (b) is actually the correct behavior here.&lt;br/&gt;
</comment>
                    <comment id="12907424" author="olegk" created="Wed, 8 Sep 2010 21:45:45 +0100"  >Committed option B.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12454143" name="stale-responses-to-explicit-requests.patch" size="7901" author="cimjmoore" created="Wed, 8 Sep 2010 20:36:02 +0100" />
                    <attachment id="12454146" name="stale-response-to-explicit-request-optionB.patch" size="7328" author="cimjmoore" created="Wed, 8 Sep 2010 20:48:56 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 8 Sep 2010 20:45:45 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133993</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47321</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>