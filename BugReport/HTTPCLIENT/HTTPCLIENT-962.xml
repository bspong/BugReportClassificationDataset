<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:22:38 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-962/HTTPCLIENT-962.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-962] client cache may be a shared cache but is caching responses to requests with Authorization headers</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-962</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>&amp;quot;      When a shared cache (see section 13.7) receives a request&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;containing an Authorization field, it MUST NOT return the&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;corresponding response as a reply to any other request, unless one&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;of the following specific exceptions holds:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1. If the response includes the &amp;quot;s-maxage&amp;quot; cache-control&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;directive, the cache MAY use that response in replying to a&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;subsequent request. But (if the specified maximum age has&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;passed) a proxy cache MUST first revalidate it with the origin&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;server, using the request-headers from the new request to allow&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;the origin server to authenticate the new request. (This is the&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;defined behavior for s-maxage.) If the response includes &amp;quot;s-&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;maxage=0&amp;quot;, the proxy MUST always revalidate it before re-using&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;it.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2. If the response includes the &amp;quot;must-revalidate&amp;quot; cache-control&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;directive, the cache MAY use that response in replying to a&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;subsequent request. But if the response is stale, all caches&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;MUST first revalidate it with the origin server, using the&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;request-headers from the new request to allow the origin server&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;to authenticate the new request.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;3. If the response includes the &amp;quot;public&amp;quot; cache-control directive,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;it MAY be returned in reply to any subsequent request.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.8&quot;&gt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.8&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
It isn&amp;#39;t clear whether the CachingHttpClient is a shared cache or not (it depends on where it gets used), so the conservative compliant behavior is to assume we are a shared cache. The current implementation is caching responses regardless of whether the original requests had Authorization headers or not.&lt;br/&gt;
&lt;br/&gt;
Patch and discussion forthcoming.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12468285">HTTPCLIENT-962</key>
            <summary>client cache may be a shared cache but is caching responses to requests with Authorization headers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="cimjmoore">Jonathan Moore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jun 2010 20:39:02 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:13 +0000</updated>
                    <resolved>Mon, 12 Jul 2010 20:40:57 +0100</resolved>
                            <version>4.1 Alpha2</version>
                                <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>1</watches>
                                                    <comments>
                    <comment id="12884036" author="cimjmoore" created="Wed, 30 Jun 2010 20:44:19 +0100"  >The attached patch does the bare minimum to bring the implementation into conditional compliance. Basically:&lt;br/&gt;
&lt;br/&gt;
* added a new method isSharedCache to CachingHttpClient. Currently this is hardcoded to return true. Eventually it would be good to have this be configurable on instantiation.&lt;br/&gt;
* updated the ResponseCachingPolicy to not cache responses to requests with Authorization headers&lt;br/&gt;
* added a set of protocol compliance tests to TestProtocolRequirements that are conditional based on whether the cache indicates it is shared or not via isSharedCache().&lt;br/&gt;
&lt;br/&gt;
Further work probably includes:&lt;br/&gt;
* allowing caching of responses that are allowed even for shared caches (s-maxage, must-revalidate, public).&lt;br/&gt;
* allowing caching of all authorized responses by a non-shared cache&lt;br/&gt;
&lt;br/&gt;
This patch is contributed to the ASF with the permission of my employer.&lt;br/&gt;
</comment>
                    <comment id="12884043" author="cimjmoore" created="Wed, 30 Jun 2010 21:04:31 +0100"  >Ok, this patch does the work to allow caching of authorized responses that have s-maxage, must-revalidate, or public parameters in their Cache-Control headers. If the CachingHttpClient is a shared cache, this is the best we can do for this.&lt;br/&gt;
&lt;br/&gt;
Still open: allowing the CachingHttpClient to be configured as a non-shared cache.&lt;br/&gt;
&lt;br/&gt;
This patch is contributed to the ASF with the permission of my employer.&lt;br/&gt;
</comment>
                    <comment id="12885032" author="olegk" created="Sun, 4 Jul 2010 15:00:36 +0100"  >Patch authorized-responses-2.patch checked in. Please let me know if I should keep the issue open for now, close it as FIXED or re-assign to FUTURE.&lt;br/&gt;
&lt;br/&gt;
Oleg   </comment>
                    <comment id="12887374" author="cimjmoore" created="Mon, 12 Jul 2010 15:00:53 +0100"  >Ok, I think we can close this issue, as the current behavior is conditionally compliant (just non-optimal, since we could cache some more responses if we knew we were a non-shared cache).&lt;br/&gt;
&lt;br/&gt;
I would vote for opening a new issue as an improvement (&amp;quot;allow configuration of a non-shared cache&amp;quot;).&lt;br/&gt;
</comment>
                    <comment id="12887486" author="olegk" created="Mon, 12 Jul 2010 20:40:57 +0100"  >Closing as FIXED. &lt;br/&gt;
&lt;br/&gt;
Please do feel free to raise a new improvement request as a follow-up to this issue.&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                </comments>
                    <attachments>
                    <attachment id="12448444" name="authorized-responses-2.patch" size="20443" author="cimjmoore" created="Wed, 30 Jun 2010 21:04:31 +0100" />
                    <attachment id="12448440" name="authorized-responses.patch" size="17219" author="cimjmoore" created="Wed, 30 Jun 2010 20:44:19 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 4 Jul 2010 14:00:36 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133963</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47342</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>