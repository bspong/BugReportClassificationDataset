<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:22:46 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-975/HTTPCLIENT-975.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-975] add support to caching module for RFC 5861 (stale-on-error and stale-while-revalidate)</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-975</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>These are Cache-Control extensions that allow an origin server to specify some additional behavior for stale cache entries. Stale-on-error configurations allow a cache to continue serving stale content for a certain period of time if a revalidation fails, and stale-while-revalidate similarly allows revalidation to occur asynchronously. Some reverse proxies such as Squid can be configured to understand these headers, which means that some origin servers are probably sending them, and that we can likewise take advantage of them.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12470838">HTTPCLIENT-975</key>
            <summary>add support to caching module for RFC 5861 (stale-on-error and stale-while-revalidate)</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="jonm">Jon Moore</assignee>
                                <reporter username="cimjmoore">Jonathan Moore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Aug 2010 22:12:04 +0100</created>
                <updated>Mon, 20 Dec 2010 18:31:33 +0000</updated>
                    <resolved>Mon, 20 Dec 2010 18:31:18 +0000</resolved>
                            <version>4.1 Beta1</version>
                                <fixVersion>4.1 Final</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>3</watches>
                                                    <comments>
                    <comment id="12969790" author="azeem" created="Thu, 9 Dec 2010 16:30:58 +0000"  >This patch adds support for &amp;quot;stale-if-error&amp;quot; - Cache-Control extension as defined in RFC 5861.  Many thanks to my colleagues Matthew Hawthorne and Michajlo Matijkiw for their valuable inputs. &lt;br/&gt;
&lt;br/&gt;
This patch has been submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Mohammed Azeem</comment>
                    <comment id="12970206" author="cim_michajlomatijkiw" created="Fri, 10 Dec 2010 15:58:26 +0000"  >This patch adds the &amp;#39;stale-while-revalidate&amp;#39; cache control extension.  This is accomplished with an ExecutorService that qualifying requests are handed off to for revalidtion.  Multiple revalidations for a single URI will be collapsed into one request.&lt;br/&gt;
&lt;br/&gt;
The number of background threads to be made available for asynchronous revalidation (the max number of concurrent revalidations) can be set in the CacheConfig object.  The default is 1, and a value of less than or equal to 0 will tell the CachingHttpClient to ignore the stale-while-revalidate directive and handle all revalidations synchronously.&lt;br/&gt;
&lt;br/&gt;
If applying this patch and the stale-if-error patch produce messy conflicts when applied I can combine the two.&lt;br/&gt;
&lt;br/&gt;
This patch is contributed with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12971293" author="jonm" created="Tue, 14 Dec 2010 16:07:22 +0000"  >@Mohammed: can you rebuild the patch against the latest trunk? It doesn&amp;#39;t quite apply right at the moment. I did, however, review the patch and it looks generally good.&lt;br/&gt;
&lt;br/&gt;
@Mishu: let&amp;#39;s keep the patches separate for now and apply them one at a time. Probably the stale-while-revalidate patch will need to be rebuilt, but it&amp;#39;s probably easier to do that after the stale-if-error patch has been applied.&lt;br/&gt;
</comment>
                    <comment id="12971297" author="azeem" created="Tue, 14 Dec 2010 16:32:21 +0000"  >Rebuilt the patch against the latest trunk.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Mohammed</comment>
                    <comment id="12971323" author="jonm" created="Tue, 14 Dec 2010 17:21:04 +0000"  >@Mohammed: patch checked in. I moved the acceptance tests from TestProtocolRecommendations to a new test class called TestRFC5861Compliance, since I think we want to keep TestProtocolRecommendations to those things specified in RFC2616.&lt;br/&gt;
&lt;br/&gt;
@Mishu: go for the stale-while-revalidate patch.&lt;br/&gt;
</comment>
                    <comment id="12971730" author="cim_michajlomatijkiw" created="Wed, 15 Dec 2010 16:32:31 +0000"  >Here is the patch bought up to date with trunk.  I also fixed a small typo i came across in CacheKeyValidator.&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
- Mishu</comment>
                    <comment id="12972054" author="jonm" created="Thu, 16 Dec 2010 11:57:57 +0000"  >@Mishu: thanks! Patch committed. I changed the default setting of background revalidation workers to 0 (disabling the feature by default), but only temporarily. The default fixedThreadPool being used right now has a potentially unbounded queue length, which I think isn&amp;#39;t safe for a default setting. I&amp;#39;m planning to add CacheConfig settings for the max idle worker lifetime and the max queue length, with sensible defaults, then re-enable the feature by default with conservative settings.&lt;br/&gt;
</comment>
                    <comment id="12973000" author="jonm" created="Sun, 19 Dec 2010 15:11:33 +0000"  >I think I found a bug in the current implementation: I think stale-while-revalidate probably needs to be subject to the same rules as those we apply when a revalidation fails due to an IOException. Namely, stale-while-revalidate probably needs to yield to must-revalidate (it is possible, although strange, for both directives to appear) and proxy-revalidate, and should probably also not asynchronously validate if the request has an explicit freshness requirement (max-stale for example).&lt;br/&gt;
&lt;br/&gt;
Also, I am finding that the main execute() method in CachingHttpClient is in serious need of refactoring -- it is really getting far too long, so I&amp;#39;m going to start by cleaning up there.&lt;br/&gt;
</comment>
                    <comment id="12973220" author="jonm" created="Mon, 20 Dec 2010 15:05:24 +0000"  >Upon re-reading the section of RFC2616 about cache control extensions:&lt;br/&gt;
&lt;a href=&quot;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.6&quot;&gt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.6&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
It does seem like the MAY of stale-if-error and stale-while-revalidate should yield to the MUSTs of must-revalidate and proxy-revalidate and the SHOULD NOT of returning a stale response if the client&amp;#39;s request includes explicit freshness contraints. I&amp;#39;ve also reached out to Mark Nottingham, the author of RFC5861, to validate this understanding.&lt;br/&gt;
&lt;br/&gt;
In the meantime, I&amp;#39;ll update the behavior here.</comment>
                    <comment id="12973253" author="jonm" created="Mon, 20 Dec 2010 16:51:39 +0000"  >Mark Nottingham confirmed my reading of things, so I&amp;#39;ll continue as planned (in flight right now).&lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12466222" name="stale-if-error.patch" size="16214" author="azeem" created="Tue, 14 Dec 2010 16:30:34 +0000" />
                    <attachment id="12465918" name="stale-if-error.patch" size="16140" author="azeem" created="Thu, 9 Dec 2010 16:30:58 +0000" />
                    <attachment id="12465993" name="stale-while-revalidate.patch" size="30651" author="cim_michajlomatijkiw" created="Fri, 10 Dec 2010 15:58:25 +0000" />
                    <attachment id="12466328" name="stale-while-revalidate.updated.patch" size="32169" author="cim_michajlomatijkiw" created="Wed, 15 Dec 2010 16:32:31 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 9 Dec 2010 16:30:58 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133976</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47486</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>