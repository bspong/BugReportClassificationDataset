<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:22:22 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-936/HTTPCLIENT-936.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-936] NullPointerException in NegotiateScheme</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-936</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>- server is configured to allow client to authenticate with kerberos with principal foobar&lt;br/&gt;
- client, using httpclient with a registered authscheme SPNEGO set as a NegotiateSchemeFactory&lt;br/&gt;
&lt;br/&gt;
- when the client authenticate with the (correct) principal foobar, it works !&lt;br/&gt;
- when the client authenticate with the (wrong) principal fooba, it fails with a NPE below.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.commons.codec.binary.Base64.encodeBase64(Base64.java:233)&lt;br/&gt;
	at org.apache.commons.codec.binary.Base64.encode(Base64.java:521)&lt;br/&gt;
	at org.apache.http.impl.auth.NegotiateScheme.authenticate(NegotiateScheme.java:240)&lt;br/&gt;
	at org.apache.http.client.protocol.RequestTargetAuthentication.process(RequestTargetAuthentication.java:99)&lt;br/&gt;
	at org.apache.http.protocol.ImmutableHttpProcessor.process(ImmutableHttpProcessor.java:108)&lt;br/&gt;
	at org.apache.http.protocol.HttpRequestExecutor.preProcess(HttpRequestExecutor.java:167)&lt;br/&gt;
	at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:460)&lt;br/&gt;
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:689)&lt;br/&gt;
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:624)&lt;br/&gt;
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:602)&lt;br/&gt;
</description>
                <environment>JDK1.6</environment>
            <key id="12463877">HTTPCLIENT-936</key>
            <summary>NullPointerException in NegotiateScheme</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="frigault">Francois Rigault</reporter>
                        <labels>
                        <label>keberos</label>
                        <label>negotiate</label>
                        <label>spnego</label>
                    </labels>
                <created>Thu, 6 May 2010 13:55:03 +0100</created>
                <updated>Tue, 25 Jan 2011 10:59:36 +0000</updated>
                    <resolved>Wed, 12 May 2010 19:33:59 +0100</resolved>
                            <version>4.1 Alpha1</version>
                                <fixVersion>4.1 Alpha2</fixVersion>
                                <component>HttpAuth</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12864769" author="olegk" created="Thu, 6 May 2010 14:44:24 +0100"  >Try this patch out. You will need to upgrade to the latest code snapshot from SVN trunk.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12865711" author="frigault" created="Mon, 10 May 2010 10:08:31 +0100"  >Hi&lt;br/&gt;
&lt;br/&gt;
I have an infinite loop now.&lt;br/&gt;
&lt;br/&gt;
start:&lt;br/&gt;
The client sends its token to the server ,&lt;br/&gt;
Server replies with a  WWW-Authenticate:  Negotiate sometoken&lt;br/&gt;
Client gets a new token from the kdc&lt;br/&gt;
It also gets a new token from the kdc for accessing the krbtgt, don&amp;#39;t know why&lt;br/&gt;
goto start</comment>
                    <comment id="12865717" author="olegk" created="Mon, 10 May 2010 10:23:15 +0100"  >Francois&lt;br/&gt;
&lt;br/&gt;
Could you please generate a wire / context log of the HTTP session and attach it to this issue? &lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://hc.apache.org/httpcomponents-client/logging.html&quot;&gt;http://hc.apache.org/httpcomponents-client/logging.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I also have to say I probably will not be able to do much about this problem as I cannot reproduce it locally. Please do consider investing some effort into fixing the bug in your environment and contributing the fix back to the community.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12866168" author="frigault" created="Tue, 11 May 2010 15:54:20 +0100"  >First patch to apply. Included:&lt;br/&gt;
- fix for API change in apache-commons (negotiate was not working with commons 1.4)&lt;br/&gt;
- add a way to inject a custom GSSManager for unit tests&lt;br/&gt;
</comment>
                    <comment id="12866172" author="frigault" created="Tue, 11 May 2010 15:58:45 +0100"  >&amp;gt; I cannot reproduce it locally&lt;br/&gt;
now you can :)&lt;br/&gt;
&lt;br/&gt;
this one depends on the first patch (patchCommonsApi)&lt;br/&gt;
&lt;br/&gt;
waiting for your comments</comment>
                    <comment id="12866308" author="olegk" created="Tue, 11 May 2010 21:14:14 +0100"  >Fantastic! Works (or rather does not work) like a charm! I love test cases! Working on a fix&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12866565" author="olegk" created="Wed, 12 May 2010 14:30:59 +0100"  >Francois,&lt;br/&gt;
&lt;br/&gt;
This patch fixes the problem for me. Both test cases pass now. Please try it out.&lt;br/&gt;
&lt;br/&gt;
If I hear no complaints I&amp;#39;ll commit the patch and close the issue in a day or two.&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12866605" author="frigault" created="Wed, 12 May 2010 17:03:00 +0100"  >works like a charm !</comment>
                    <comment id="12866681" author="olegk" created="Wed, 12 May 2010 19:33:59 +0100"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12444300" name="HTTPCLIENT-936-fix.patch" size="17822" author="olegk" created="Wed, 12 May 2010 14:30:59 +0100" />
                    <attachment id="12444203" name="patchAddUnitTestsForNegotiateScheme.txt" size="7307" author="frigault" created="Tue, 11 May 2010 15:58:45 +0100" />
                    <attachment id="12444202" name="patchCommonsApi.txt" size="1928" author="frigault" created="Tue, 11 May 2010 15:54:20 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 6 May 2010 13:44:24 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133941</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47356</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>