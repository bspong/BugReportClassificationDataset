<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:19:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-645/HTTPCLIENT-645.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-645] Cookie.compare(...) uses single instance STRING_COLLATOR to do blocking compares</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-645</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>I am using a MultiThreadedHttpConnectionManager with a single HttpClient instance and multiple GetMethod objects.  I have a 500 thread max.  I recently noticed that all 500 threads are in the same place and seem to be blocking each other - the stack trace is below.  I dug into the Cookie.compare(...) method and saw that it is using STRING_COLLARTOR.compare(c1.getPath(), c2.getPath()).  STRING_COLLATOR is defined as a single instance object, &amp;#39;private static final RuleBasedCollator STRING_COLLATOR = (RuleBasedCollator) RuleBasedCollator.getInstance(new Locale(&amp;quot;en&amp;quot;, &amp;quot;US&amp;quot;, &amp;quot;&amp;quot;));&amp;#39;.  I also saw that RuleBasedCollator.compare is synchronized.  That means that every thread that is trying to make a request is getting blocked while it tries to add cookies to the request method.  I do not see a workaround because this is the same static final object in every Cookie instance.  So, the more threads, the more synchronized comparisons.  At times I am fetching URLs all from the same site so I am going through this code a lot.  I need it to be much faster than it currently is because all of my threads are getting eaten up on this call and backlogging my system.  Can a different RuleBasedCollator be used for each compare (use the RuleBasedCollator.getInstance() for every compare?  I think that would solve things.&lt;br/&gt;
&lt;br/&gt;
Name: pool-1-thread-1443: 72.21.206.5&lt;br/&gt;
State: BLOCKED on &lt;a href=&apos;mailto:java.text.RuleBasedCollator@190330a&apos;&gt;java.text.RuleBasedCollator@190330a&lt;/a&gt; owned by: pool-1-thread-1867: 72.21.206.5&lt;br/&gt;
Total blocked: 9,598  Total waited: 381&lt;br/&gt;
&lt;br/&gt;
Stack trace: &lt;br/&gt;
java.text.RuleBasedCollator.compare(RuleBasedCollator.java:396)&lt;br/&gt;
org.apache.commons.httpclient.Cookie.compare(Cookie.java:484)&lt;br/&gt;
org.apache.commons.httpclient.cookie.CookieSpecBase.addInPathOrder(CookieSpecBase.java:578)&lt;br/&gt;
org.apache.commons.httpclient.cookie.CookieSpecBase.match(CookieSpecBase.java:557)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.addCookieRequestHeader(HttpMethodBase.java:1179)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.addRequestHeaders(HttpMethodBase.java:1305)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.writeRequestHeaders(HttpMethodBase.java:2036)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.writeRequest(HttpMethodBase.java:1919)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:993)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:397)&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:170)&lt;br/&gt;
org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:396)&lt;br/&gt;
org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:324)</description>
                <environment>RHEL-4u3, jdk-1.5.0.07, dual core AMD&amp;#39;s</environment>
            <key id="12367318">HTTPCLIENT-645</key>
            <summary>Cookie.compare(...) uses single instance STRING_COLLATOR to do blocking compares</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mrosett">Michael Rosett</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Apr 2007 20:40:24 +0100</created>
                <updated>Sun, 11 Nov 2007 19:14:58 +0000</updated>
                    <resolved>Mon, 23 Apr 2007 08:00:33 +0100</resolved>
                                            <fixVersion>3.1 (end of life)</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12489220" author="olegk" created="Mon, 16 Apr 2007 21:15:45 +0100"  >I suspect that creating an instance of RuleBasedCollator may be not particularly cheap either. &lt;br/&gt;
&lt;br/&gt;
The use of RuleBasedCollator to compare cookie paths is simply unjustified. I think we should remove RuleBasedCollator altogether.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12489221" author="olegk" created="Mon, 16 Apr 2007 21:16:48 +0100"  >Folks, any objections to this patch?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12490684" author="rolandw" created="Sun, 22 Apr 2007 07:39:42 +0100"  >looks good</comment>
                    <comment id="12490824" author="olegk" created="Mon, 23 Apr 2007 08:00:33 +0100"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12355640" name="cookie.patch" size="1518" author="olegk" created="Mon, 16 Apr 2007 21:16:48 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 16 Apr 2007 20:15:45 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133684</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47828</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>