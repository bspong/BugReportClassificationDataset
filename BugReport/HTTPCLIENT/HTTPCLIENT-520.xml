<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:18:19 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-520/HTTPCLIENT-520.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-520] MultipartEntity incorrectly computes unknown length</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-520</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>If any Part of a MultipartEntity reports an unknown length (-1), MultipartEntity&lt;br/&gt;
reports an erroneous length value. It should report an unknown length (-1) if&lt;br/&gt;
any of the parts is of unknown length, that would cause the POST to be chunked.&lt;br/&gt;
&lt;br/&gt;
See&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/jakarta-httpclient-user/200510.mbox/ajax/%3ceb3d689c0510250851t2eb78462tbf701135bbf718c9@mail.gmail.com%3e&quot;&gt;http://mail-archives.apache.org/mod_mbox/jakarta-httpclient-user/200510.mbox/ajax/%3ceb3d689c0510250851t2eb78462tbf701135bbf718c9@mail.gmail.com%3e&lt;/a&gt;</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: All</environment>
            <key id="12334079">HTTPCLIENT-520</key>
            <summary>MultipartEntity incorrectly computes unknown length</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="loic.peron@bigfoot.com">Lo&#239;c P&#233;ron</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Oct 2005 02:15:11 +0100</created>
                <updated>Wed, 16 Feb 2011 20:45:01 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:10 +0100</resolved>
                            <version>3.0 RC4</version>
                                <fixVersion>3.0 Final</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382741" author="olegk" created="Mon, 7 Nov 2005 03:23:17 +0000"  >Created an attachment (id=16887)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
&lt;br/&gt;
Please test and review&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382742" author="oglueck" created="Mon, 7 Nov 2005 22:01:45 +0000"  >looks okay</comment>
                    <comment id="12382743" author="becke@u.washington.edu" created="Mon, 7 Nov 2005 22:54:59 +0000"  >The code looks fine.  I can&amp;#39;t rememeber the specifics but I thought there was&lt;br/&gt;
some reason we didn&amp;#39;t support chunked multipart request in the past.  Has this&lt;br/&gt;
been tested in production?  Do servers actually support this?  Am I just crazy :)&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382744" author="olegk" created="Mon, 7 Nov 2005 23:57:41 +0000"  >(In reply to comment #3)&lt;br/&gt;
&amp;gt; The code looks fine.  I can&amp;#39;t rememeber the specifics but I thought there was&lt;br/&gt;
&amp;gt; some reason we didn&amp;#39;t support chunked multipart request in the past.  Has this&lt;br/&gt;
&amp;gt; been tested in production?  Do servers actually support this?  Am I just crazy :)&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Mike&lt;br/&gt;
&lt;br/&gt;
The &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-164&quot; title=&quot;Send InputStreams instead of files in MultipartPostMethod&quot;&gt;&lt;strike&gt;HTTPCLIENT-164&lt;/strike&gt;&lt;/a&gt; was consolidated with the &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-382&quot; title=&quot;Move multipart request to a new RequestEntity type&quot;&gt;&lt;strike&gt;HTTPCLIENT-382&lt;/strike&gt;&lt;/a&gt; at some point of time and&lt;br/&gt;
eventually lost track of. I am not sure this will ever work in production. It is&lt;br/&gt;
still better than sending wrong content-length header&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
</comment>
                    <comment id="12382745" author="becke@u.washington.edu" created="Tue, 8 Nov 2005 00:50:07 +0000"  >Agreed, sounds reasonable.  Patch away.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382746" author="olegk" created="Tue, 8 Nov 2005 06:43:13 +0000"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382747" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 18:15:48 +0000"  >Hi all,&lt;br/&gt;
&lt;br/&gt;
Thanks for your quick investigations. I did not intend to use this feature now,&lt;br/&gt;
but felt compelled to test your patch to show some gratitude ;)&lt;br/&gt;
&lt;br/&gt;
However, I found the unknown length for Parts to need some more modifications,&lt;br/&gt;
especially in Part.length() calling Part.lengthOfData(), and&lt;br/&gt;
FilePart(PartSource) requiring the source.length() &amp;gt;= 0.&lt;br/&gt;
&lt;br/&gt;
See attached patches for modification proposals.&lt;br/&gt;
&lt;br/&gt;
I did test transferring a 150Mb file using a PartSource wrapping an InputStream,&lt;br/&gt;
to a test servlet using FileUpload 1.0 (patched to accept posts of unknown length).</comment>
                    <comment id="12382748" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 18:16:49 +0000"  >Created an attachment (id=16898)&lt;br/&gt;
Part.patch (take 2)&lt;br/&gt;
</comment>
                    <comment id="12382749" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 18:17:30 +0000"  >Created an attachment (id=16899)&lt;br/&gt;
FilePart.patch (take 2)&lt;br/&gt;
</comment>
                    <comment id="12382750" author="oglueck" created="Tue, 8 Nov 2005 18:25:38 +0000"  >Lo&amp;#xEF;c,&lt;br/&gt;
&lt;br/&gt;
Thanks for the improvements. While you are at it, do you mind writing some&lt;br/&gt;
simple JUnit test cases for this issue? So we know it really works...&lt;br/&gt;
&lt;br/&gt;
Cheers&lt;br/&gt;
&lt;br/&gt;
Ortwin</comment>
                    <comment id="12382751" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 19:03:15 +0000"  >Created an attachment (id=16900)&lt;br/&gt;
PartSource wrapping an InputStream&lt;br/&gt;
</comment>
                    <comment id="12382752" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 19:10:01 +0000"  >Created an attachment (id=16901)&lt;br/&gt;
Test for unknown length FilePart&lt;br/&gt;
</comment>
                    <comment id="12382753" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 19:12:25 +0000"  >Hi,&lt;br/&gt;
&lt;br/&gt;
I added a simple test for a FIlePart of unknown length, exercising all the&lt;br/&gt;
proposed changes.&lt;br/&gt;
But I do not know how to check that the POST is really chunked; thge reply seems&lt;br/&gt;
to be the unchunked request.</comment>
                    <comment id="12382754" author="olegk" created="Wed, 9 Nov 2005 05:41:05 +0000"  >Created an attachment (id=16918)&lt;br/&gt;
Consolidated patch (take 2)&lt;br/&gt;
&lt;br/&gt;
If I hear no complaints, I&amp;#39;ll commit the patch tomorrow (~22:00 GMT)&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382755" author="oglueck" created="Wed, 9 Nov 2005 06:05:33 +0000"  >Created an attachment (id=16919)&lt;br/&gt;
Fixed patch (take 3)&lt;br/&gt;
&lt;br/&gt;
The patch assumed the dafault platform encoding to be ISO-8859-1 compatible.&lt;br/&gt;
Breaks with EBCDIC on zOS for instance.&lt;br/&gt;
&lt;br/&gt;
TestPartSource.createInputStream now actually creates a new input stream. Just&lt;br/&gt;
to get the semantics right even if it&amp;#39;s a test case. (Any retries would have&lt;br/&gt;
failed before)</comment>
                    <comment id="12382756" author="loic.peron@bigfoot.com" created="Wed, 9 Nov 2005 18:12:02 +0000"  >(In reply to comment #15)&lt;br/&gt;
&amp;gt; TestPartSource.createInputStream now actually creates a new input stream. Just&lt;br/&gt;
&amp;gt; to get the semantics right even if it&amp;#39;s a test case. (Any retries would have&lt;br/&gt;
&amp;gt; failed before)&lt;br/&gt;
&lt;br/&gt;
I had overlooked the retries. What if my InputStream cannot be recreated?&lt;br/&gt;
It seems to me that Part.isRepeatable() should be abstract and implemented only&lt;br/&gt;
in  StringPart (returning true) and FilePartSource (returning true), allowing&lt;br/&gt;
for a notRepeatable InputStream to be wrapped by a PartSource. Otherwise, a new&lt;br/&gt;
Part must be fully implemented.</comment>
                    <comment id="12382757" author="olegk" created="Thu, 10 Nov 2005 04:43:43 +0000"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382758" author="loic.peron@bigfoot.com" created="Thu, 10 Nov 2005 21:04:17 +0000"  >Created an attachment (id=16938)&lt;br/&gt;
Full patch including refactored isRepeatable()&lt;br/&gt;
&lt;br/&gt;
This patch consolidate all previous patches, and changes isRepeatable() to be&lt;br/&gt;
abstract in Part, implemented in StringPart, delegated in FilePart to&lt;br/&gt;
PartSource, implemented in ByteArrayPartSource and FilePartSource.&lt;br/&gt;
&lt;br/&gt;
This allows to wrap non-repeatable InputStreams with a PartSOurce and correctly&lt;br/&gt;
indicating repeatability.</comment>
                    <comment id="12382759" author="oglueck" created="Thu, 10 Nov 2005 21:17:01 +0000"  >Lo&amp;#xEF;c,&lt;br/&gt;
&lt;br/&gt;
We can not change the API at the current stage of the release process. We may&lt;br/&gt;
consider the Part API changes for 4.0. You may want to open a separate bug&lt;br/&gt;
report for this because this one is already resolved.&lt;br/&gt;
&lt;br/&gt;
Ortwin</comment>
                    <comment id="12382760" author="loic.peron@bigfoot.com" created="Thu, 10 Nov 2005 22:50:28 +0000"  >(In reply to comment #19)&lt;br/&gt;
&amp;gt; We can not change the API at the current stage of the release process. We may&lt;br/&gt;
&amp;gt; consider the Part API changes for 4.0.&lt;br/&gt;
&lt;br/&gt;
That is highly unfortunate, as it either requires Part.isRepeatable to be&lt;br/&gt;
overridden in a subclass, or PartSource.createInputStream() to be made always&lt;br/&gt;
repeatable.&lt;br/&gt;
&lt;br/&gt;
It does not simply allow non-repeatable InputStreams to be simply wrapped by a&lt;br/&gt;
PartSource.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; You may want to open a separate bug &lt;br/&gt;
&amp;gt; report for this because this one is already resolved.&lt;br/&gt;
&lt;br/&gt;
Done. Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-525&quot; title=&quot;Part.isRepeatable() should be abstract&quot;&gt;&lt;strike&gt;HTTPCLIENT-525&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
</comment>
                </comments>
                    <attachments>
                    <attachment id="12327308" name="ASF.LICENSE.NOT.GRANTED--httpclient-3.0-rc4-chunkedmultipart-FilePart.patch" size="639" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 18:17:30 +0000" />
                    <attachment id="12327307" name="ASF.LICENSE.NOT.GRANTED--httpclient-3.0-rc4-chunkedmultipart-Part.patch" size="1111" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 18:16:49 +0000" />
                    <attachment id="12327310" name="ASF.LICENSE.NOT.GRANTED--httpclient-3.0-rc4-chunkedmultipart-TestMultipartPost.patch" size="2118" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 19:10:01 +0000" />
                    <attachment id="12327309" name="ASF.LICENSE.NOT.GRANTED--InputStreamPartSource.java" size="624" author="loic.peron@bigfoot.com" created="Tue, 8 Nov 2005 19:03:15 +0000" />
                    <attachment id="12327313" name="ASF.LICENSE.NOT.GRANTED--multipart-4.patch" size="8896" author="loic.peron@bigfoot.com" created="Thu, 10 Nov 2005 21:04:17 +0000" />
                    <attachment id="12327312" name="ASF.LICENSE.NOT.GRANTED--multipart.patch" size="4482" author="oglueck" created="Wed, 9 Nov 2005 06:05:33 +0000" />
                    <attachment id="12327311" name="ASF.LICENSE.NOT.GRANTED--multipart.patch" size="4714" author="olegk" created="Wed, 9 Nov 2005 05:41:05 +0000" />
                    <attachment id="12327306" name="ASF.LICENSE.NOT.GRANTED--multipart.patch" size="958" author="olegk" created="Mon, 7 Nov 2005 03:23:17 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>8.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>37256</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 7 Nov 2005 03:23:17 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133567</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47088</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>