<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:17:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-467/HTTPCLIENT-467.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-467] CookieSpecBase.domainMatch() leaks cookies to 3rd party domains</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-467</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>The change committed for #32833&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://issues.apache.org/bugzilla/show_bug.cgi?id=32833&quot;&gt;http://issues.apache.org/bugzilla/show_bug.cgi?id=32833&lt;/a&gt;&amp;gt; is buggy; it doesn&amp;#39;t&lt;br/&gt;
match browser behavior and in fact leaks cookies to third party domains. &lt;br/&gt;
&lt;br/&gt;
To see, try the following:&lt;br/&gt;
&lt;br/&gt;
CookieSpecBase cspec = new CookieSpecBase();&lt;br/&gt;
Cookie cookie = new Cookie(&amp;quot;.hotmail.com&amp;quot;,&amp;quot;foo&amp;quot;,&amp;quot;bar&amp;quot;,&amp;quot;/&amp;quot;,Integer.MAX_VALUE,false);&lt;br/&gt;
cspec.match(&amp;quot;iwanttostealcookiesfromhotmail.com&amp;quot;,80,&amp;quot;/&amp;quot;,false,cookie);&lt;br/&gt;
&lt;br/&gt;
It will return true. Testing in Firefox1.0.4 and IE6 show no such similar&lt;br/&gt;
leakage for similar cases. (Indeed, it&amp;#39;d be a headline-making privacy bug if&lt;br/&gt;
they were to do this.)&lt;br/&gt;
&lt;br/&gt;
Those browsers do, in my limited testing, behave as desired by the filer of&lt;br/&gt;
#32833: a cookie of domain value &amp;#39;.mydomain.com&amp;#39; will be returned to exact host&lt;br/&gt;
&amp;#39;mydomain.com&amp;#39; (. However, the fix that was suggested was overbroad.&lt;br/&gt;
&lt;br/&gt;
I suggest instead for CookieSpecBase.domainMatch():&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public boolean domainMatch(final String host, final String domain) {&lt;br/&gt;
// BUGGY: matches a &amp;#39;.service.com&amp;#39; cookie to hosts like &amp;#39;enemyofservice.com&amp;#39;&lt;br/&gt;
//        return host.endsWith(domain)&lt;br/&gt;
//            || (domain.startsWith(&amp;quot;.&amp;quot;) &amp;amp;&amp;amp; host.endsWith(domain.substring(1)));&lt;br/&gt;
// BETTER: RFC2109, plus matches a &amp;#39;.service.com&amp;#39; cookie to exact host &amp;#39;service.com&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return host.equals(domain)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|| (domain.startsWith(&amp;quot;.&amp;quot;) &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;amp;&amp;amp; (host.endsWith(domain)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|| host.equals(domain.substring(1))));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: All</environment>
            <key id="12334026">HTTPCLIENT-467</key>
            <summary>CookieSpecBase.domainMatch() leaks cookies to 3rd party domains</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="gojomo@archive.org">Gordon Mohr</reporter>
                        <labels>
                    </labels>
                <created>Sun, 5 Jun 2005 17:05:43 +0100</created>
                <updated>Wed, 16 Feb 2011 20:43:54 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:02 +0100</resolved>
                            <version>3.0 RC2</version>
                                <fixVersion>3.0 RC3</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382387" author="gojomo@archive.org" created="Sun, 5 Jun 2005 18:15:47 +0100"  >Previous suggestion fails to reproduce another behavior of IE6 (but not&lt;br/&gt;
Firefox1.0.4): a cookie of domain &amp;quot;example.com&amp;quot; (no leading dot) will be sent by&lt;br/&gt;
IE to subdomains, like &amp;quot;&lt;a href=&quot;http://www.example.com&quot;&gt;www.example.com&lt;/a&gt;&amp;quot; (but not unrelated domains like&lt;br/&gt;
&amp;quot;anotherexample.com&amp;quot;). &lt;br/&gt;
&lt;br/&gt;
To match IE, this should do the trick (without again ruling-in unrelated but&lt;br/&gt;
similar-ending domains): &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public boolean domainMatch(final String host, final String domain) {&lt;br/&gt;
// EVEN BETTER (for mimicking IE): also sends &amp;quot;example.com&amp;quot; cookie to proper&lt;br/&gt;
subdomains like &amp;quot;&lt;a href=&quot;http://www.example.com&quot;&gt;www.example.com&lt;/a&gt;&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return (domain.startsWith(&amp;quot;.&amp;quot;)) &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;? (host.endsWith(domain) || host.equals(domain.substring(1)))&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;: (host.equals(domain) || host.endsWith(&amp;quot;.&amp;quot;+domain));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}</comment>
                    <comment id="12382388" author="olegk" created="Sun, 5 Jun 2005 20:14:30 +0100"  >This indeed represents a major blunder on our part. I stop short of marking this&lt;br/&gt;
bug as critical only because the browser compatibility policy is not a default one.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382389" author="olegk" created="Mon, 6 Jun 2005 05:35:57 +0100"  >Created an attachment (id=15305)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
&lt;br/&gt;
Gordon,&lt;br/&gt;
The way IE matches whatever.com cookie to &lt;a href=&quot;http://www.whatever.com&quot;&gt;www.whatever.com&lt;/a&gt; host does not make&lt;br/&gt;
any sense to me. I would rather stick to the more conservative approach of&lt;br/&gt;
Firefox. Please let me know if you could live with that. &lt;br/&gt;
&lt;br/&gt;
Folks, please review the patch&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382390" author="gojomo@archive.org" created="Mon, 6 Jun 2005 10:37:16 +0100"  >I don&amp;#39;t have enough info to have a strong opinion. In favor of (what appears to&lt;br/&gt;
be ) the Firefox approach, RFC2109 plus send &amp;quot;.domain.com&amp;quot; cookies to exact host&lt;br/&gt;
&amp;quot;domain.com&amp;quot;, the arguments would be:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- I trust the Mozilla/Firefox project in general to have converged on&lt;br/&gt;
reasonable tradeoffs over time&lt;br/&gt;
&amp;nbsp;- In my daily use of FF, I&amp;#39;ve never noticed a cookie problem with their policy&lt;br/&gt;
&amp;nbsp;- It&amp;#39;s a smaller deviation from written specs.&lt;br/&gt;
&lt;br/&gt;
In favor of (what appears to be) the IE6 approach, of the Firefox policy plus&lt;br/&gt;
send &amp;quot;domain.com&amp;quot; cookies to &amp;quot;sub.domain.com&amp;quot;, the argument would be:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- It&amp;#39;s still by far the most-used browser, and if the rationale of&lt;br/&gt;
CookieSpecBase/compatibility mode is (as suggested by the method comment) to&lt;br/&gt;
match &amp;quot;common browsers&amp;quot;, there&amp;#39;s no more &amp;quot;common&amp;quot; browser than IE&lt;br/&gt;
&lt;br/&gt;
I could go either way. Either would be an improvement over current bug. Without&lt;br/&gt;
time for more extensive testing, perhaps try the Firefox approach and see who&lt;br/&gt;
complains, with examples of real sites (if any) that break without the IE&lt;br/&gt;
behavior?  </comment>
                    <comment id="12382391" author="gojomo@archive.org" created="Mon, 6 Jun 2005 11:02:18 +0100"  >The patch proposed in #3 leaves first endsWith() test in place, which still&lt;br/&gt;
allows leakage on cookies whose &amp;#39;domain&amp;#39; value does not begin with a &amp;#39;.&amp;#39;. For&lt;br/&gt;
example:&lt;br/&gt;
&lt;br/&gt;
CookieSpecBase cspec = new CookieSpecBase();&lt;br/&gt;
Cookie cookie = new&lt;br/&gt;
Cookie(&amp;quot;sourceforge.net&amp;quot;,&amp;quot;foo&amp;quot;,&amp;quot;bar&amp;quot;,&amp;quot;/&amp;quot;,Integer.MAX_VALUE,false);&lt;br/&gt;
cspec.match(&amp;quot;antisourceforge.net&amp;quot;,80,&amp;quot;/&amp;quot;,false,cookie); // returns true&lt;br/&gt;
&lt;br/&gt;
Changing that to equals then requires an endsWith test inside the &amp;quot;.&amp;quot; case, as&lt;br/&gt;
in the suggestion in comment #1. (Which, as far as I can tell, then matches&lt;br/&gt;
Firefox cookie domain-matching behavior.)</comment>
                    <comment id="12382392" author="rolweber@de.ibm.com" created="Mon, 6 Jun 2005 15:38:27 +0100"  >The argument for the IE6 approach are cookies for which no domain is&lt;br/&gt;
set by the server. They default to the host in the URL that was accessed,&lt;br/&gt;
and some people use &amp;quot;domain.com&amp;quot; as a shortcut to &amp;quot;&lt;a href=&quot;http://www.domain.com&quot;&gt;www.domain.com&lt;/a&gt;&amp;quot;.&lt;br/&gt;
I doubt that this much tolerance is needed in HttpClient.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12382393" author="rolweber@de.ibm.com" created="Mon, 6 Jun 2005 17:50:01 +0100"  >I just read across RFC 2965 (Cookie 2). Section 3.2.2, Page 5:&lt;br/&gt;
&lt;br/&gt;
&amp;gt;   Domain=value&lt;br/&gt;
&amp;gt;      OPTIONAL.  The value of the Domain attribute specifies the domain&lt;br/&gt;
&amp;gt;      for which the cookie is valid.  If an explicitly specified value&lt;br/&gt;
&amp;gt;      does not start with a dot, the user agent supplies a leading dot.&lt;br/&gt;
&lt;br/&gt;
So the IE6 behavior for old cookies has become standard for cookie2. Or&lt;br/&gt;
else IE6 applies the standard behavior for cookie2 also to old cookies.&lt;br/&gt;
&lt;br/&gt;
Since we don&amp;#39;t support RFC 2965 yet, we don&amp;#39;t have to tolerate the missing&lt;br/&gt;
dot. On the other hand, the error seems to be so commonplace that it has&lt;br/&gt;
been deemed acceptable in a followup specification. So we could make&lt;br/&gt;
HttpClient more tolerant without sacrificing spec compliance by implementing&lt;br/&gt;
the IE6 behavior.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12382394" author="olegk" created="Mon, 6 Jun 2005 18:33:22 +0100"  >Created an attachment (id=15307)&lt;br/&gt;
Patch (take2)&lt;br/&gt;
&lt;br/&gt;
All right. This should do the trick. Please review&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382395" author="oglueck" created="Mon, 6 Jun 2005 18:45:13 +0100"  >Oleg, what about the case&lt;br/&gt;
&lt;br/&gt;
&amp;quot;.sourceforge.net&amp;quot; cookie against &amp;quot;&lt;a href=&quot;http://www.sourceforge.net&quot;&gt;www.sourceforge.net&lt;/a&gt;&amp;quot;? This case should be&lt;br/&gt;
covered by all specs.&lt;br/&gt;
&lt;br/&gt;
Odi</comment>
                    <comment id="12382396" author="olegk" created="Mon, 6 Jun 2005 19:03:06 +0100"  >(In reply to comment #9)&lt;br/&gt;
&amp;gt; Oleg, what about the case&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &amp;quot;.sourceforge.net&amp;quot; cookie against &amp;quot;&lt;a href=&quot;http://www.sourceforge.net&quot;&gt;www.sourceforge.net&lt;/a&gt;&amp;quot;? This case should be&lt;br/&gt;
&amp;gt; covered by all specs.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Odi&lt;br/&gt;
&lt;br/&gt;
Odi, &lt;br/&gt;
&lt;br/&gt;
This is a standard case. It should already be adequately covered by all the&lt;br/&gt;
cookie specs&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
</comment>
                    <comment id="12382397" author="oglueck" created="Mon, 6 Jun 2005 19:51:38 +0100"  >I don&amp;#39;t see test coverage, Oleg. Please add an additonal test case:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;public void testSecondDomainLevelCookieMatch3() throws Exception {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Cookie cookie = new Cookie(&amp;quot;.sourceforge.net&amp;quot;, &amp;quot;name&amp;quot;, null, &amp;quot;/&amp;quot;, null,&lt;br/&gt;
false); &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cookie.setDomainAttributeSpecified(true);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cookie.setPathAttributeSpecified(true);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CookieSpec cookiespec = new CookieSpecBase();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertTrue(cookiespec.match(&amp;quot;&lt;a href=&quot;http://www.sourceforge.net&quot;&gt;www.sourceforge.net&lt;/a&gt;&amp;quot;, 80, &amp;quot;/&amp;quot;, false, cookie));&lt;br/&gt;
</comment>
                    <comment id="12382398" author="olegk" created="Mon, 6 Jun 2005 20:23:58 +0100"  >As far as I am concerned the test cases below should exercise the code path in&lt;br/&gt;
question:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://jakarta.apache.org/commons/httpclient/3.0/xref-test/org/apache/commons/httpclient/cookie/TestCookieCompatibilitySpec.html#871&quot;&gt;http://jakarta.apache.org/commons/httpclient/3.0/xref-test/org/apache/commons/httpclient/cookie/TestCookieCompatibilitySpec.html#871&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I see no harm in adding another test case either&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382399" author="rolweber@de.ibm.com" created="Wed, 8 Jun 2005 17:12:36 +0100"  >Just for the records: while reading through RFC 2109, I encountered&lt;br/&gt;
section 4.3.2 about &amp;quot;Rejecting Cookies&amp;quot;. There, it is required to reject&lt;br/&gt;
cookies with a domain attribute that does not start with a dot. So it&lt;br/&gt;
would be a violation of the spec to supply the missing dot for Set-Cookie,&lt;br/&gt;
as IE does. For Set-Cookie2, that will be required instead of forbidden.&lt;br/&gt;
Looks like there are no security or privacy concerns about it anymore.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12382400" author="olegk" created="Fri, 10 Jun 2005 01:22:26 +0100"  >Folks, any objections to committing this patch?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382401" author="olegk" created="Tue, 14 Jun 2005 05:09:09 +0100"  >Patch committed.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327246" name="ASF.LICENSE.NOT.GRANTED--compatcookie.patch" size="3283" author="olegk" created="Mon, 6 Jun 2005 18:33:22 +0100" />
                    <attachment id="12327245" name="ASF.LICENSE.NOT.GRANTED--compatcookie.patch" size="2017" author="olegk" created="Mon, 6 Jun 2005 05:35:57 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35225</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 5 Jun 2005 19:14:30 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133514</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47217</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>