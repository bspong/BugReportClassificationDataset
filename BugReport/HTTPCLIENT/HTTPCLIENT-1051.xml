<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:12:30 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1051/HTTPCLIENT-1051.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1051] SSL connections cannot be established using resolvable IP address</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1051</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>HttpClient 4.1 introduced a regression in establishing SSL connections to remote peers (it seems this is a common regression for major httpclient updates, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-803&quot; title=&quot;SSL connections cannot be established using the IP address&quot;&gt;&lt;strike&gt;HTTPCLIENT-803&lt;/strike&gt;&lt;/a&gt;).&lt;br/&gt;
The new SSLSocketFactory.connectSocket method calls the X509HostnameVerifier with InetSocketAddress.getHostName() parameter. When the selected IP address has a reverse lookup name, the verifier is called with the resolved name, and so the IP check fails.&lt;br/&gt;
4.0 release checked for original ip/hostname, but this cannot be done with the new connectSocket() method. &lt;br/&gt;
The TestHostnameVerifier.java only checks 127.0.0.1/.2 and so masked the issue, because the matching certificate has both &amp;quot;localhost&amp;quot; and &amp;quot;127.0.0.1&amp;quot;, but actually only &amp;quot;localhost&amp;quot; is matched. A test case with 8.8.8.8 would be better.</description>
                <environment></environment>
            <key id="12497590">HTTPCLIENT-1051</key>
            <summary>SSL connections cannot be established using resolvable IP address</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="alexdupre">Alex Dupre</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2011 16:30:05 +0000</created>
                <updated>Fri, 29 Jul 2011 22:53:35 +0100</updated>
                    <resolved>Wed, 9 Mar 2011 13:11:46 +0000</resolved>
                            <version>4.1 Final</version>
                                <fixVersion>4.1.2</fixVersion>
                                <component>HttpConn</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12990280" author="olegk" created="Thu, 3 Feb 2011 20:18:21 +0000"  >I am not able to reproduce the problem. SSL connections to remote peers pass the default host name verification.&lt;br/&gt;
&lt;br/&gt;
---&lt;br/&gt;
executing requestGET &lt;a href=&quot;https://www.verisign.com/&quot;&gt;https://www.verisign.com/&lt;/a&gt; HTTP/1.1&lt;br/&gt;
[DEBUG] SingleClientConnManager - Get connection for route HttpRoute[{s}-&amp;gt;&lt;a href=&quot;https://www.verisign.com&quot;&gt;https://www.verisign.com&lt;/a&gt;]&lt;br/&gt;
[DEBUG] DefaultClientConnectionOperator - Connecting to &lt;a href=&quot;http://www.verisign.com/69.58.181.89:443&quot;&gt;www.verisign.com/69.58.181.89:443&lt;/a&gt;&lt;br/&gt;
[DEBUG] RequestAddCookies - CookieSpec selected: best-match&lt;br/&gt;
[DEBUG] DefaultHttpClient - Attempt 1 to execute request&lt;br/&gt;
[DEBUG] DefaultClientConnection - Sending request: GET / HTTP/1.1&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; GET / HTTP/1.1&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Host: &lt;a href=&quot;http://www.verisign.com&quot;&gt;www.verisign.com&lt;/a&gt;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Connection: Keep-Alive&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; User-Agent: Apache-HttpClient/4.1 (java 1.5)&lt;br/&gt;
[DEBUG] DefaultClientConnection - Receiving response: HTTP/1.1 200 OK&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; HTTP/1.1 200 OK&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Date: Thu, 03 Feb 2011 20:14:35 GMT&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Server: Apache&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Set-Cookie: v1st=D732270AE4FC9F76; path=/; expires=Wed, 19 Feb 2020 14:28:00 GMT; domain=.verisign.com&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Set-Cookie: v1st=D732270AE4FC9F76; path=/; expires=Wed, 19 Feb 2020 14:28:00 GMT; domain=.verisign.com&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; X-Powered-By: PHP/5.2.13&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Keep-Alive: timeout=5, max=100&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Connection: Keep-Alive&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Transfer-Encoding: chunked&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Content-Type: text/html&lt;br/&gt;
[DEBUG] ResponseProcessCookies - Cookie accepted: &amp;quot;[version: 0][name: v1st][value: D732270AE4FC9F76][domain: .verisign.com][path: /][expiry: Wed Feb 19 15:28:00 GMT+01:00 2020]&amp;quot;. &lt;br/&gt;
[DEBUG] ResponseProcessCookies - Cookie accepted: &amp;quot;[version: 0][name: v1st][value: D732270AE4FC9F76][domain: .verisign.com][path: /][expiry: Wed Feb 19 15:28:00 GMT+01:00 2020]&amp;quot;. &lt;br/&gt;
[DEBUG] DefaultHttpClient - Connection can be kept alive for 5000 MILLISECONDS&lt;br/&gt;
----------------------------------------&lt;br/&gt;
HTTP/1.1 200 OK&lt;br/&gt;
Response content length: -1&lt;br/&gt;
[DEBUG] SingleClientConnManager - Releasing connection org.apache.http.impl.conn.SingleClientConnManager$&lt;a href=&apos;mailto:ConnAdapter@15ad5c6&apos;&gt;ConnAdapter@15ad5c6&lt;/a&gt;&lt;br/&gt;
[DEBUG] DefaultClientConnection - Connection shut down&lt;br/&gt;
---&lt;br/&gt;
&lt;br/&gt;
Are you using a custom SSL socket factory by any chance? Does it implement the LayeredSchemeSocketFactory interface?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12990286" author="alexdupre" created="Thu, 3 Feb 2011 20:23:41 +0000"  >Wrong test. Try to connect to &lt;a href=&quot;https://93.62.162.60:8443/&quot;&gt;https://93.62.162.60:8443/&lt;/a&gt;. The certificate has CN=93.62.162.60, but the check is done for 93-62-162-60.ip23.fastwebnet.it</comment>
                    <comment id="13003374" author="olegk" created="Mon, 7 Mar 2011 14:53:28 +0000"  >I had to resort to a fairly ugly hack in order to fix the problem. A better solution would require changes to the X509HostnameVerifier API. I felt that deprecation of the X509HostnameVerifier interface was not warranted, as the use of an IP address for CN in a certificate was a hack by itself.&lt;br/&gt;
&lt;br/&gt;
Please review.&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="13003412" author="alexdupre" created="Mon, 7 Mar 2011 16:08:48 +0000"  >Well, I looked at the patch. It should fix the issue (though not completely, since the reverse lookup could give a wrong/unresolvable hostname), but as you said it&amp;#39;s a crude hack, and this opens to other security issues. Unfortunately the clean fix requires API modification.&lt;br/&gt;
&lt;br/&gt;
You say using an IP address as CN is a hack, but actually using it as an ipAddress SubjectAlternativeName is perfectly valid.&lt;br/&gt;
&lt;br/&gt;
The security issues arise from the fact that httpclient tries to match dns generated data (reverse lookups and now also resolved hostnames) instead of what the user actually typed, opening to DNS poisoning or connection redirect attacks.&lt;br/&gt;
&lt;br/&gt;
First scenario:&lt;br/&gt;
- user wants to connect to 1.2.3.4&lt;br/&gt;
- DNS reverse lookup is xxx.yyy.zzz&lt;br/&gt;
- a malicious proxy redirects the connection to server 4.3.2.1&lt;br/&gt;
- server certificate contains CN or SAN set to xxx.yyy.zzz&lt;br/&gt;
- All OK (but shouldn&amp;#39;t)&lt;br/&gt;
&lt;br/&gt;
Second scenario:&lt;br/&gt;
- user wants to connect to xxx.yyy.zzz&lt;br/&gt;
- hacked DNS incorrectly resolve it to 1.2.3.4&lt;br/&gt;
- server certificate has CN or SAN set to 1.2.3.4&lt;br/&gt;
- The connection is established OK (but clearly shouldn&amp;#39;t)&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="13003423" author="olegk" created="Mon, 7 Mar 2011 16:45:01 +0000"  >Fair enough. I&amp;#39;ll revert the patch and close the issue as WONTFIX&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13003488" author="alexdupre" created="Mon, 7 Mar 2011 18:15:53 +0000"  >Hmm, my comment was not meant to revert the patch. The first scenario was already exploitable and still is. Your patch is the &amp;quot;correct&amp;quot; solution without breaking the API.&lt;br/&gt;
&lt;br/&gt;
But to avoid any security issue (including the ones already present) the API have to be changed.</comment>
                    <comment id="13003555" author="olegk" created="Mon, 7 Mar 2011 20:09:09 +0000"  >The first scenario you are describing would also require involvement of green men from Mars and the malicious 4.3.2.1 server sending a certificate trusted by the client to be practical. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13003833" author="alexdupre" created="Tue, 8 Mar 2011 06:42:50 +0000"  >Even the second one requires the server presenting a trusted certificate. I don&amp;#39;t see much difference beetween the two cases.</comment>
                    <comment id="13004529" author="olegk" created="Wed, 9 Mar 2011 13:11:47 +0000"  >I committed a slightly better workaround for the problem that does not require reverse DNS lookups.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13004553" author="alexdupre" created="Wed, 9 Mar 2011 14:09:37 +0000"  >Great work, good patch, thanks!</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 3 Feb 2011 20:18:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>66645</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>46963</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>