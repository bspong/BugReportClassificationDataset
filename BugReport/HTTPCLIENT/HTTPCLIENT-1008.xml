<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:12:01 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1008/HTTPCLIENT-1008.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1008] Send all variants&apos; ETags on &quot;variant miss&quot;</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1008</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>From section 13.6 of RFC 2616:&lt;br/&gt;
&lt;br/&gt;
If an entity tag was assigned to a cached representation, the forwarded request SHOULD be conditional and include the entity tags in an If-None-Match header field from all its cache entries for the resource. This conveys to the server the set of entities currently held by the cache, so that if any one of these entities matches the requested entity, the server can use the ETag header field in its 304 (Not Modified) response to tell the cache which entry is appropriate. If the entity-tag of the new response matches that of an existing entry, the new response SHOULD be used to update the header fields of the existing entry, and the result MUST be returned to the client.&lt;br/&gt;
&lt;br/&gt;
Presently, we simply forward the request to the request without the conditionals.  This improvement would consist of adding the conditionals to the request, and properly handling the response.  An example of such would be the following:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- request resource with &amp;quot;Accept-Encoding: gzip&amp;quot;, response has &amp;quot;Etag: etag1&amp;quot;, &amp;quot;Vary: Accept-Encoding&amp;quot;&lt;br/&gt;
&amp;nbsp;- request resource with &amp;quot;Accept-Encoding: deflate&amp;quot;, request is forwarded with &amp;quot;If-None-Match: etag1&amp;quot; added, response is 200, with &amp;quot;ETag: etag2&amp;quot;&lt;br/&gt;
&amp;nbsp;- request resource with &amp;quot;Accept-Encoding: gzip, deflate&amp;quot;, request is forwarded with &amp;quot;If-None-Match: etag1, etag2&amp;quot; added, response is 304, with &amp;quot;ETag: etag1&amp;quot; indicating we should use the first response for this request</description>
                <environment></environment>
            <key id="12476797">HTTPCLIENT-1008</key>
            <summary>Send all variants&apos; ETags on &quot;variant miss&quot;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="cim_michajlomatijkiw">Michajlo Matijkiw</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Oct 2010 20:00:52 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:30 +0000</updated>
                    <resolved>Fri, 15 Oct 2010 20:44:43 +0100</resolved>
                                            <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="12920747" author="cim_michajlomatijkiw" created="Wed, 13 Oct 2010 21:14:21 +0100"  >This patch adds the functionality of negotiating responses with the server using variants.  When a request is made for a resource which has a cached copy with a different vary field value, all such entries&amp;#39; etags are sent to the server in a conditional request allowing the server to specify an entry already in the cache if it exits.  To accomplish this I needed to add HttpCache#getVariantCacheEntries(), since there was no way to retrieve variants from the cache.  The method negotiateResponseFromVariants was added to CachingHttpClient to handle the necessary logic.&lt;br/&gt;
&lt;br/&gt;
This patch was developed in collaboration with Mohammed Azeem Uddin and is submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12921411" author="olegk" created="Fri, 15 Oct 2010 16:45:09 +0100"  >Michajlo,&lt;br/&gt;
&lt;br/&gt;
One of the test cases fails for me. Could you please have a look?&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: org.apache.http.impl.client.cache.TestCachingHttpClient&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 56, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.235 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testTreatsCacheIOExceptionsAsCacheMiss(org.apache.http.impl.client.cache.TestCachingHttpClient)  Time elapsed: 0.011 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;Unexpected method call getVariantCacheEntries(&lt;a href=&quot;http://foo.example.com,&quot;&gt;http://foo.example.com,&lt;/a&gt; GET /stuff [Via: 1.1 localhost (Apache-HttpClient/4.1-alpha3-SNAPSHOT (cache))]):&lt;br/&gt;
</comment>
                    <comment id="12921415" author="cimjmoore" created="Fri, 15 Oct 2010 16:53:39 +0100"  >This was probably caused because Mishu and Mohammed&amp;#39;s patch was created against a version of trunk that predated my patch you just committed with the IOExceptions. I suspect it can be fixed just by updating the test case to add:&lt;br/&gt;
&lt;br/&gt;
EasyMock.expect(mockCache.getVariantEntries(...)).andThrow(new IOException()).anyTimes();&lt;br/&gt;
&lt;br/&gt;
and then putting try...catch blocks in CachingHttpClient if they are missing.&lt;br/&gt;
</comment>
                    <comment id="12921428" author="cim_michajlomatijkiw" created="Fri, 15 Oct 2010 17:29:43 +0100"  >That was indeed the case, updated patch attached.</comment>
                    <comment id="12921515" author="olegk" created="Fri, 15 Oct 2010 20:44:43 +0100"  >Patch checked in. Many thanks, Michajlo&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12457095" name="negotiated_response.patch" size="38333" author="cim_michajlomatijkiw" created="Wed, 13 Oct 2010 21:14:21 +0100" />
                    <attachment id="12457274" name="negotiated_response_updated.patch" size="39435" author="cim_michajlomatijkiw" created="Fri, 15 Oct 2010 17:29:43 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 15 Oct 2010 15:45:09 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>134009</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47310</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>