<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:15:43 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-292/HTTPCLIENT-292.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-292] NTLM Proxy and basic host authorization</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-292</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Using a Microsoft proxy with NTLM validation enabled the authorization against a&lt;br/&gt;
remote host does not work. This, of course, assuming that the page is correctly&lt;br/&gt;
fetched (which currently is not), see the NTLM authentication bug number 24327</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: All</environment>
            <key id="12333851">HTTPCLIENT-292</key>
            <summary>NTLM Proxy and basic host authorization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="barbolani@jazzfree.com">Alfonso</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Nov 2003 20:21:01 +0000</created>
                <updated>Thu, 2 May 2013 03:28:36 +0100</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:36 +0100</resolved>
                            <version>2.0 Beta 2</version>
                                <fixVersion>2.0 Final</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12381125" author="barbolani@jazzfree.com" created="Mon, 3 Nov 2003 20:30:44 +0000"  >Created an attachment (id=8887)&lt;br/&gt;
Debug log of the problem (edited to hide names)&lt;br/&gt;
</comment>
                    <comment id="12381126" author="barbolani@jazzfree.com" created="Mon, 3 Nov 2003 20:36:48 +0000"  >As I can see, one possible way of solving the problem is to &amp;quot;forget&amp;quot; the list of&lt;br/&gt;
realms used for proxy authentication when trying the validation after receiving&lt;br/&gt;
the &amp;quot;401&amp;quot; from the remote host. This can be done by changing in&lt;br/&gt;
HttpMethodBase#processAuthenticationResponse.&lt;br/&gt;
&lt;br/&gt;
In lines 2476-2484 it says&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;case HttpStatus.SC_UNAUTHORIZED:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;challenges =&lt;br/&gt;
getResponseHeaderGroup().getHeaders(HttpAuthenticator.WWW_AUTH);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;realmsUsed = realms;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;host = conn.getVirtualHost();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (host == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;host = conn.getHost();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;break;&lt;br/&gt;
&lt;br/&gt;
Clearing the list of realms used for the proxy could be something like &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;case HttpStatus.SC_UNAUTHORIZED:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;challenges =&lt;br/&gt;
getResponseHeaderGroup().getHeaders(HttpAuthenticator.WWW_AUTH);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxyRealms.clear();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;realmsUsed = realms;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;host = conn.getVirtualHost();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (host == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;host = conn.getHost();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;break;&lt;br/&gt;
&lt;br/&gt;
Recompiling after this change and trying again the test case retrieves the page&lt;br/&gt;
just fine (do I have to attach a log?)</comment>
                    <comment id="12381127" author="olegk" created="Mon, 3 Nov 2003 21:43:33 +0000"  >Yes, please. The log would be quite of some help.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381128" author="olegk" created="Tue, 4 Nov 2003 02:17:36 +0000"  >Alfonso,&lt;br/&gt;
Can you test if the patch below fixes the problem?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381129" author="olegk" created="Tue, 4 Nov 2003 02:18:05 +0000"  >Created an attachment (id=8895)&lt;br/&gt;
Possible fix. Please test&lt;br/&gt;
</comment>
                    <comment id="12381130" author="barbolani@jazzfree.com" created="Tue, 4 Nov 2003 05:24:20 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
Wow!!! again, thanks. Applied the patch and re-tested. It now works as expected.&lt;br/&gt;
As with the previous bug, should I close this or it is something you should do?.&lt;br/&gt;
&lt;br/&gt;
Thanks again&lt;br/&gt;
&lt;br/&gt;
Alfonso</comment>
                    <comment id="12381131" author="olegk" created="Tue, 4 Nov 2003 07:35:44 +0000"  >Patch committed to 2.0 branch. &lt;br/&gt;
&lt;br/&gt;
I just realized that one of my recent patches (auto-generated headers cleanup)&lt;br/&gt;
complete broke authentication in CVS HEAD. My bad. I&amp;#39;ll provide a fix for CVS&lt;br/&gt;
HEAD tomorrow. My apologies.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381132" author="olegk" created="Sat, 8 Nov 2003 19:11:21 +0000"  >Created an attachment (id=8996)&lt;br/&gt;
Patch against CVS HEAD (take 1)&lt;br/&gt;
</comment>
                    <comment id="12381133" author="olegk" created="Sat, 8 Nov 2003 19:14:16 +0000"  >The patch against CVS HEAD is virtually identical to that for 2.0 branch. The&lt;br/&gt;
patch also solves the problem with auto-generated headers by restricting headers&lt;br/&gt;
cleanup to &amp;#39;Cookie&amp;#39; headers only.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381134" author="olegk" created="Tue, 11 Nov 2003 01:43:41 +0000"  >Folks, any objections to committing this one?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381135" author="becke@u.washington.edu" created="Tue, 11 Nov 2003 03:14:12 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I haven&amp;#39;t had a chance to try this patch out, but if it works for you that&amp;#39;s&lt;br/&gt;
good enough for me.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381136" author="olegk" created="Tue, 11 Nov 2003 06:37:04 +0000"  >Mike,&lt;br/&gt;
It all can wait. There is no rush. I&amp;#39;d feel better if someone else had a look.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381137" author="becke@u.washington.edu" created="Wed, 12 Nov 2003 12:09:52 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
I finally had some time to try this one out.  It looks good to me.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381138" author="olegk" created="Fri, 14 Nov 2003 06:25:57 +0000"  >Patch committed to CVS HEAD&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381139" author="olegk" created="Sun, 16 Nov 2003 23:32:44 +0000"  >Sadly enough, I just discovered even though the patch fixed the problem with&lt;br/&gt;
NTLM Proxy + Basic host authentication, but unintentionally broke Basic Proxy +&lt;br/&gt;
[Digest | Basic] host authentication. I am going to reopen the bug report, and&lt;br/&gt;
start working on a better fix. This bug is a release blocker.&lt;br/&gt;
&lt;br/&gt;
Absence of a reliable and comprehensive testcase suite for all possible proxy +&lt;br/&gt;
host authentication combinations has become a real pain in the rear. As far as I&lt;br/&gt;
am concerned this is the greatest deficiency of HttpClient I know of at the moment.</comment>
                    <comment id="12381140" author="olegk" created="Mon, 17 Nov 2003 05:46:27 +0000"  >Created an attachment (id=9134)&lt;br/&gt;
Patch against 2.0 (take 2)&lt;br/&gt;
</comment>
                    <comment id="12381141" author="olegk" created="Mon, 17 Nov 2003 05:49:50 +0000"  >I am perfectly aware that the proposed fix is not pretty. Unfortunately I do not&lt;br/&gt;
see a more elegant solution that would not require API changes. Any better ideas?&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll try to come up with something more elegant for the 2.1 branch. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381142" author="becke@u.washington.edu" created="Mon, 17 Nov 2003 11:45:20 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I agree, our lack of auth/proxy tests is a continuous source of problems.  One of our goals for 2.1 &lt;br/&gt;
should be an effective method for testing all of the various combinations of proxy, authentication &lt;br/&gt;
and SSL.  Ideally it would be best to make this setup as simple as possible.  Do you have any &lt;br/&gt;
thoughts about how we can best accomplish this?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381143" author="becke@u.washington.edu" created="Mon, 24 Nov 2003 11:03:52 +0000"  >Created an attachment (id=9255)&lt;br/&gt;
2.0 Patch 3&lt;br/&gt;
</comment>
                    <comment id="12381144" author="becke@u.washington.edu" created="Mon, 24 Nov 2003 11:07:12 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
Attached is another take on this problem.  It removes the necessity of checking for NTLM explicitly.  &lt;br/&gt;
I was able to test it successfully with basic authentication on the proxy and digest on the host.  &lt;br/&gt;
NTLM has not been tested.   What do you think?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381145" author="olegk" created="Mon, 24 Nov 2003 20:57:39 +0000"  >Mike,&lt;br/&gt;
Unfortunately the patch would bring us exactly where we had started in the first&lt;br/&gt;
place :( NTLM proxy + target host authentication would still be left broken&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381146" author="becke@u.washington.edu" created="Mon, 24 Nov 2003 21:29:36 +0000"  >Yes, it seems we&amp;#39;re back to where we started from.  What exactly about that behavior is causing &lt;br/&gt;
problems?  Why does the proxy try to re-authenticate in the fourth request?  Also, is this a problem &lt;br/&gt;
if preemptive authentication is used?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381147" author="olegk" created="Mon, 24 Nov 2003 22:07:30 +0000"  >Mike, &lt;br/&gt;
my assumption is that the presence of (extra) Proxy-Authorization header prompts&lt;br/&gt;
the NTLM proxy to invalidate the authorization for the given connection and&lt;br/&gt;
force re-authentication. As HttpClient assumes that it has already attempted&lt;br/&gt;
authentication against the said proxy, it just gives up. &lt;br/&gt;
&lt;br/&gt;
I do not know NTLM authentication in great details, so I may be wrong here, but&lt;br/&gt;
the main difference to digest and basic authentication schemes is that NTLM&lt;br/&gt;
scheme is connection oriented. Once the agent has been successfully&lt;br/&gt;
authenticated with an NTLM authentication authority, user identity is propagated&lt;br/&gt;
to all the following requests as long as connection is kept alive, whereas&lt;br/&gt;
digest and basic authentication schemes are request oriented and thus must&lt;br/&gt;
include Proxy-Authorization | Authorization directive with every request.&lt;br/&gt;
Currently HttpClient does not differenciate connection and request oriented&lt;br/&gt;
schemes. &lt;br/&gt;
&lt;br/&gt;
I can well be wrong in my assumptions, but the empirical evidence seems to&lt;br/&gt;
support them so far. After all, my initial patch did fix the problem with NTLM&lt;br/&gt;
authentication.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381148" author="becke@u.washington.edu" created="Tue, 25 Nov 2003 02:35:52 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I agree, it does seem that the presence of the Proxy-Authorization header on the&lt;br/&gt;
already authenticated connection causes re-authentication.  So, for NTLM to work&lt;br/&gt;
the proxy-auth header must be removed once authenticated.  I don&amp;#39;t think either&lt;br/&gt;
patch 2 or 3 handles this case, unless (in the case of patch 2) the host also&lt;br/&gt;
uses NTLM.  What we really need is a way to remove NTLM headers after the&lt;br/&gt;
authentication has succeeded.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381149" author="olegk" created="Tue, 25 Nov 2003 03:11:23 +0000"  >&amp;gt; What we really need is a way to remove NTLM headers after the&lt;br/&gt;
&amp;gt; authentication has succeeded.&lt;br/&gt;
Agreed. However, that still poses the same problem: how do we tell NTLM&lt;br/&gt;
authentication from all others? I do not see a way around that ugly test for the&lt;br/&gt;
2.0 branch at least:&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
if (&amp;quot;NTLM&amp;quot;.equalsIgnoreCase(authscheme.getSchemeName())) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// clean up&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
As far as HEAD CVS goes, there are more elegant solutions, which would require&lt;br/&gt;
AuthScheme interface extension, though.&lt;br/&gt;
&lt;br/&gt;
What are your thoughts?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381150" author="olegk" created="Fri, 5 Dec 2003 01:00:33 +0000"  >Created an attachment (id=9393)&lt;br/&gt;
Patch against 2.0 (take 4)&lt;br/&gt;
</comment>
                    <comment id="12381151" author="olegk" created="Fri, 5 Dec 2003 01:05:39 +0000"  >The patch should take care of the problem for HttpClient 2.0. It ain&amp;#39;t not&lt;br/&gt;
pretty, but that appears to be the only option we have that does not require API&lt;br/&gt;
changes. Alfonso, if you are still monitoring this bug report, I would really&lt;br/&gt;
appreciate if you test the patch a little bit. If works for me, but a second&lt;br/&gt;
option would be quite welcome.&lt;br/&gt;
&lt;br/&gt;
Meanwhile, I&amp;#39;ll be working on a more elegant fix for the CVS HEAD&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12381152" author="becke@u.washington.edu" created="Fri, 5 Dec 2003 08:27:33 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
I tested with basic and digest authentication using a proxy and all seems to work for me.  Nice job.  &lt;br/&gt;
The fix is not the prettiest, but I think it&amp;#39;s the only real choice for 2.0.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381153" author="barbolani@jazzfree.com" created="Fri, 5 Dec 2003 22:29:15 +0000"  >I&amp;#39;m currently unable to test it and it could take a couple of weeks to test.&lt;br/&gt;
Will that be still be useful for you ?</comment>
                    <comment id="12381154" author="olegk" created="Fri, 5 Dec 2003 22:47:54 +0000"  >Alfonso,&lt;br/&gt;
Of course, we will not be able to wait that long before committing the patch,&lt;br/&gt;
but it would still be interesting to hear from you, whenever you happen to have&lt;br/&gt;
time.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381155" author="olegk" created="Tue, 9 Dec 2003 04:38:21 +0000"  >Created an attachment (id=9451)&lt;br/&gt;
Patch against 2.0 (take 5)&lt;br/&gt;
</comment>
                    <comment id="12381156" author="olegk" created="Tue, 9 Dec 2003 04:44:55 +0000"  >My previous patch turned out to be flawed: successful authentication against&lt;br/&gt;
NTLM proxy + basic host may get screwy when followed by redirect if NTLM headers&lt;br/&gt;
are not cleaned up. Corrected. &lt;br/&gt;
&lt;br/&gt;
(But the real stuff is still to follow shortly)&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381157" author="olegk" created="Tue, 9 Dec 2003 04:46:07 +0000"  >Created an attachment (id=9452)&lt;br/&gt;
Patch against CVS HEAD (take 2)&lt;br/&gt;
</comment>
                    <comment id="12381158" author="olegk" created="Tue, 9 Dec 2003 04:53:02 +0000"  >The patch also fixes the &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-46&quot; title=&quot;Plug-in authentication modules&quot;&gt;&lt;strike&gt;HTTPCLIENT-46&lt;/strike&gt;&lt;/a&gt; and provides foundation for fixing the bug&lt;br/&gt;
#15297. Once the patch is committed, the fix for the said bug will be just a&lt;br/&gt;
matter of adding a parameter to the HttpClientParams class&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Changelog:&lt;br/&gt;
&lt;br/&gt;
* Plug-in mechanism for authentication modules&lt;br/&gt;
&lt;br/&gt;
* AuthModule interface implementing authentication modules can now be&lt;br/&gt;
instantiated using default (parameter-less) constructor&lt;br/&gt;
&lt;br/&gt;
* Authentication modules can now retain limited state information (the state is&lt;br/&gt;
retained within the lifetime of the method director)&lt;br/&gt;
&lt;br/&gt;
* Authentication scheme selection routine can be easily parameterized &lt;br/&gt;
* Yet another massive refactoring of HttpMethodDirector (Haven&amp;#39;t I been a&lt;br/&gt;
trouble lately?)&lt;br/&gt;
&lt;br/&gt;
Still, I am not entirely satisfied with the existing state of authentication&lt;br/&gt;
framework: &lt;br/&gt;
* First of all, NTLM &amp;amp; Digest schemes still need to be refactored to take&lt;br/&gt;
advantage of their new-found capability to maintain authentication state&lt;br/&gt;
* Secondly, our current strategy is to keep authentication headers as long as&lt;br/&gt;
they may be useful and to remove them whenever we think (or guess) they may no&lt;br/&gt;
longer reflect the state of authentication process. It _might_ be better to make&lt;br/&gt;
authentication scheme smart enough to know what kind of authentication&lt;br/&gt;
information is required at the given point of the authentication process and to&lt;br/&gt;
supply authentication headers only when they are really needed&lt;br/&gt;
* Thirdly, our current approach towards deciding whether an authentication&lt;br/&gt;
attempt failed or succeeded is kind of screwy. Knowing the state of the&lt;br/&gt;
authentication process AND the response status code we should be able to tell if&lt;br/&gt;
authentication has been successful or has failed. Instead we just resort to what&lt;br/&gt;
is essentially guessing by maintaining a set of supposedly unique&lt;br/&gt;
tokens/ids/realms/god-knows-whats that represent authentication attempts.&lt;br/&gt;
Besides, currently we make an assumption that HttpClient may attempt to respond&lt;br/&gt;
to authorization challenge only once for a given realm and host. With this&lt;br/&gt;
scheme may get into trouble when trying to bolt interactive authentication on&lt;br/&gt;
top of it&lt;br/&gt;
* Finally, we totally neglected ports. Currently ports are not taken into&lt;br/&gt;
consideration when assigning credentials to the HTTP state, nor when keeping the&lt;br/&gt;
list of failed authentication attempts&lt;br/&gt;
&lt;br/&gt;
Anyways, first things first. Let me know what you think about the patch&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381159" author="becke@u.washington.edu" created="Tue, 9 Dec 2003 12:13:56 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
Does the 2.0 patch work with NTLM authentication?  I haven&amp;#39;t been able to try it but from scanning &lt;br/&gt;
the code I think there may be a problem.  I&amp;#39;m looking at the following section in execute():&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while (forwardCount++ &amp;lt; MAX_FORWARDS) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cleanAuthHeaders();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//write the request and read the response, will retry&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;processRequest(state, conn);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (!isRetryNeeded(statusLine.getStatusCode(), state, conn)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// nope, no retry needed, exit loop.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;break;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} //end of retry loop&lt;br/&gt;
&lt;br/&gt;
It seems that the NTLM authorization headers are removed before they can be sent in &lt;br/&gt;
processRequest().  They are added in isRetryNeeded() when challenged and then removed again by &lt;br/&gt;
cleanAuthHeaders() before sent to the server in processRequest().  What do you think?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381160" author="olegk" created="Tue, 9 Dec 2003 16:49:01 +0000"  >&amp;gt; What do you think?&lt;br/&gt;
&lt;br/&gt;
I think I screwed up. Corrected patches to follow soon.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381161" author="olegk" created="Tue, 9 Dec 2003 18:40:23 +0000"  >Created an attachment (id=9460)&lt;br/&gt;
Patch against 2.0 (take 6)&lt;br/&gt;
</comment>
                    <comment id="12381162" author="olegk" created="Tue, 9 Dec 2003 19:11:47 +0000"  >Created an attachment (id=9461)&lt;br/&gt;
Patch against CVS HEAD (take 3)&lt;br/&gt;
</comment>
                    <comment id="12381163" author="olegk" created="Tue, 9 Dec 2003 19:15:14 +0000"  >Problem corrected. I could test NTLM host authentication and seems to work fine.&lt;br/&gt;
Unfortunately I do not have access to a NTLM proxy, so this remains to be tested&lt;br/&gt;
yet. Let me know what you think.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381164" author="becke@u.washington.edu" created="Wed, 10 Dec 2003 11:37:59 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
As before, I was not able to test NTLM, but it looks correct to me.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381165" author="becke@u.washington.edu" created="Wed, 10 Dec 2003 12:34:34 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
The HEAD patch looks very good.  I only have two minor comments:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;- the else in AuthPolicy.getAuthScheme() should throw an IllegalStateException.&lt;br/&gt;
&amp;nbsp;- The get*AuthenticationRealm() methods in HttpMethod should probably be deprecated.&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
Mike</comment>
                    <comment id="12381166" author="olegk" created="Wed, 10 Dec 2003 16:42:56 +0000"  >Agreed. I&amp;#39;ll take care of these two points. If there are no other comments or&lt;br/&gt;
objections I would like to commit both patches tonight around 20:00 GMT and&lt;br/&gt;
continue with authentication cleanup on CVS HEAD. Please let me know by then if&lt;br/&gt;
anyone needs more time to review the patches.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381167" author="olegk" created="Thu, 11 Dec 2003 05:08:55 +0000"  >Both patches committed. With my fingers crossed I close the bug report. &lt;br/&gt;
&lt;br/&gt;
Alfonso, when you happen to have a chance, please retest your application using&lt;br/&gt;
the newest 2.0 and HEAD shapshots. That would be really appreciated.&lt;br/&gt;
&lt;br/&gt;
Meanwhile, I&amp;#39;ll carry on refactoring authentication logic on CVS HEAD&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381168" author="isabelle.blanc@mairie-paris.fr" created="Tue, 23 Dec 2003 22:30:49 +0000"  >i just feel so dumb for asking this, but ... errrmmmmm .... how should i use the&lt;br/&gt;
patches you release here ?? &lt;br/&gt;
they just look like cvs logs, so i suppose i have to go to the cvs repository,&lt;br/&gt;
download the modified classes and re-build all ... but the name &amp;quot;patch&amp;quot; made me&lt;br/&gt;
think there could be an easier use of it, am i wrong ?&lt;br/&gt;
&lt;br/&gt;
feel free to delete this post, but please, let me know if i&amp;#39;m *that* dumb !</comment>
                    <comment id="12381169" author="olegk" created="Wed, 24 Dec 2003 23:34:51 +0000"  >Isabelle,&lt;br/&gt;
The patches have already been applied. All you have to do is to pull the latest&lt;br/&gt;
code snapshot from the CVS. Please make sure to use HTTPCLIENT_2_0_BRANCH tag to&lt;br/&gt;
obtain 2.0 API compatible code (pre-2.0rc3). &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381170" author="isabelle.blanc@mairie-paris.fr" created="Mon, 29 Dec 2003 22:07:07 +0000"  >ok, thanks a lot :) - especially for being so nice towards someone *this* dumb ;]</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10001">
                <name>dependent</name>
                                <outwardlinks description="depends upon">
                            <issuelink>
            <issuekey id="12333605">HTTPCLIENT-46</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12333690">HTTPCLIENT-131</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12326999" name="ASF.LICENSE.NOT.GRANTED--auth.patch" size="1439" author="becke@u.washington.edu" created="Mon, 24 Nov 2003 11:03:52 +0000" />
                    <attachment id="12326997" name="ASF.LICENSE.NOT.GRANTED--auth.patch" size="3300" author="olegk" created="Sat, 8 Nov 2003 19:11:21 +0000" />
                    <attachment id="12326996" name="ASF.LICENSE.NOT.GRANTED--iisproxy+plus-basicauth.patch" size="1577" author="olegk" created="Tue, 4 Nov 2003 02:18:05 +0000" />
                    <attachment id="12326995" name="ASF.LICENSE.NOT.GRANTED--NTLMProxyAuthHost_Error.log" size="8968" author="barbolani@jazzfree.com" created="Mon, 3 Nov 2003 20:30:44 +0000" />
                    <attachment id="12327003" name="ASF.LICENSE.NOT.GRANTED--proxyauth-2.0.patch" size="6478" author="olegk" created="Tue, 9 Dec 2003 18:40:23 +0000" />
                    <attachment id="12327001" name="ASF.LICENSE.NOT.GRANTED--proxyauth-2.0.patch" size="6341" author="olegk" created="Tue, 9 Dec 2003 04:38:21 +0000" />
                    <attachment id="12326998" name="ASF.LICENSE.NOT.GRANTED--proxyauthhostauth.patch" size="1853" author="olegk" created="Mon, 17 Nov 2003 05:46:27 +0000" />
                    <attachment id="12327004" name="ASF.LICENSE.NOT.GRANTED--proxyauth.patch" size="62020" author="olegk" created="Tue, 9 Dec 2003 19:11:47 +0000" />
                    <attachment id="12327002" name="ASF.LICENSE.NOT.GRANTED--proxyauth.patch" size="48077" author="olegk" created="Tue, 9 Dec 2003 04:46:07 +0000" />
                    <attachment id="12327000" name="ASF.LICENSE.NOT.GRANTED--proxyauth.patch" size="6103" author="olegk" created="Fri, 5 Dec 2003 01:00:33 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>10.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>24352</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 3 Nov 2003 21:43:33 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133343</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>188712</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>