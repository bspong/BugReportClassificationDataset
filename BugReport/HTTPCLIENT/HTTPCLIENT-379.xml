<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:16:50 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-379/HTTPCLIENT-379.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-379] JVM bug 4949631 causes BufferOverflowException in HttpMethodBase.getResponseBodyAsString</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-379</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>ava.nio.BufferOverflowException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.nio.charset.CoderResult.throwException(CoderResult.java:259)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.StringCoding$CharsetSD.decode(StringCoding.java:188)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.StringCoding.decode(StringCoding.java:224)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.String.&amp;lt;init&amp;gt;(String.java:320)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at&lt;br/&gt;
org.apache.commons.httpclient.HttpConstants.getContentString(HttpConstants.java:199)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at&lt;br/&gt;
org.apache.commons.httpclient.HttpConstants.getContentString(HttpConstants.java:233)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at&lt;br/&gt;
org.apache.commons.httpclient.HttpMethodBase.getResponseBodyAsString(HttpMethodBase.java:735)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
This seems to be caused by a known JVM bug:&lt;br/&gt;
&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4949631&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4949631&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Strings over 16Mb can cause the problem.   Some workarounds are listed, the&lt;br/&gt;
essence being to split the string and call getBytes on each piece and reassemble&lt;br/&gt;
with a ByteBuffer.</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: All</environment>
            <key id="12333938">HTTPCLIENT-379</key>
            <summary>JVM bug 4949631 causes BufferOverflowException in HttpMethodBase.getResponseBodyAsString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="afrancis@thoughtworks.com">Alan Francis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Sep 2004 23:28:53 +0100</created>
                <updated>Wed, 16 Feb 2011 20:43:57 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:51 +0100</resolved>
                            <version>2.0 Milestone 1</version>
                                <fixVersion>2.0 Final</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12381898" author="oglueck" created="Wed, 15 Sep 2004 23:41:34 +0100"  >We strongly discourage users to use getResponseBodyAsString if the content is&lt;br/&gt;
large. getResponseBodyAsString imposes buffering and copying the data in the VM&lt;br/&gt;
which can easily exhaust the memory available to the VM. HttpClients should&lt;br/&gt;
avoid buffering the response by using getResponseBodyAsStream().&lt;br/&gt;
&lt;br/&gt;
Maybe we can log a warning message, if the content length is unknown or larger&lt;br/&gt;
than some megs and the user calls getResponseBodyAsString or getResponseBody.&lt;br/&gt;
The drawbacks of calling those methods and why to alternatives should be&lt;br/&gt;
documented in the API.</comment>
                    <comment id="12381899" author="olegk" created="Thu, 16 Sep 2004 00:02:59 +0100"  >Alan,&lt;br/&gt;
HttpMethod#getResponseBodyAsString is a convenience method. And as such it has&lt;br/&gt;
never been intended to handle large content. Any application specific concerns&lt;br/&gt;
(large content, corrupt connect) should be dealt with at the application level,&lt;br/&gt;
not at the transport level.&lt;br/&gt;
&lt;br/&gt;
If it&amp;#39;s OK with you, I&amp;#39;ll mark this report as INVALID&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381900" author="afrancis@thoughtworks.com" created="Thu, 16 Sep 2004 17:51:20 +0100"  >Hi Guys,&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t agree that the bug is invalid (of course thats up to you :-).  &lt;br/&gt;
&lt;br/&gt;
If the method doesn&amp;#39;t work for large responses, I&amp;#39;d expect to see Ortwin&amp;#39;s&lt;br/&gt;
suggestions of a log message as described below and something in the&lt;br/&gt;
documentation referring to the sun bug report and warning of undefined behaviour&lt;br/&gt;
if the response is over 16Mb.  What would be safer (IMO) is fail-fast with some&lt;br/&gt;
kind of ResponseTooLargeException (or something).&lt;br/&gt;
&lt;br/&gt;
As for our specific situation, it&amp;#39;s a safe bet our responses will be 5-20Mb and&lt;br/&gt;
so I&amp;#39;ll take the advice and go ahead and use the Stream method, if I happened to&lt;br/&gt;
be in a situation where I had no idea how big the response was before I tried to&lt;br/&gt;
get it, it seems a little worrying that a perfectly reasonable-looking method&lt;br/&gt;
might fail at random intervals.&lt;br/&gt;
&lt;br/&gt;
Alan</comment>
                    <comment id="12381901" author="oglueck" created="Thu, 16 Sep 2004 19:57:08 +0100"  >Alan,&lt;br/&gt;
&lt;br/&gt;
The method works perfectly for large responses. You have already discoverd that&lt;br/&gt;
the problem is inside Sun&amp;#39;s VM implementation. If you use any other VM (Sun&lt;br/&gt;
1.3.1, any IBM, any Blackdown) there is no bug. HttpClient is not broken.&lt;br/&gt;
Nothing to fix here.&lt;br/&gt;
&lt;br/&gt;
We are not going to work around Sun&amp;#39;s bugs at the HttpClient level as long as&lt;br/&gt;
there exists a simple workaround feasible for the user. e.g. using streams.&lt;br/&gt;
&lt;br/&gt;
I also don&amp;#39;t like your idea of an ResponseTooLargeException. It is perfectly&lt;br/&gt;
legal, although not very intelligent, to use getResponseAsString for&lt;br/&gt;
multimegabyte responses.&lt;br/&gt;
&lt;br/&gt;
I guess that at least API Doc improvements should be made to that method. But&lt;br/&gt;
this has nothing to do with Sun&amp;#39;s VM bug. It should rather push users towards&lt;br/&gt;
using streams instead of buffered responses. A warning message could further&lt;br/&gt;
help developers but I find it completely optional. I will attach a patch for&lt;br/&gt;
that in a minute.&lt;br/&gt;
&lt;br/&gt;
Ortwin Gl&amp;#xC3;&amp;#xBC;ck</comment>
                    <comment id="12381902" author="oglueck" created="Thu, 16 Sep 2004 20:12:22 +0100"  >Created an attachment (id=12749)&lt;br/&gt;
Patch to 2.0 branch&lt;br/&gt;
</comment>
                    <comment id="12381903" author="oglueck" created="Thu, 16 Sep 2004 20:12:45 +0100"  >Created an attachment (id=12750)&lt;br/&gt;
Patch to HEAD&lt;br/&gt;
</comment>
                    <comment id="12381904" author="oglueck" created="Thu, 16 Sep 2004 20:14:01 +0100"  >The attached patches add API Doc, a warning if the buffered content length is&lt;br/&gt;
unknown or &amp;gt; 1 MB and an optimization of buffer allocation.</comment>
                    <comment id="12381905" author="olegk" created="Thu, 16 Sep 2004 22:05:14 +0100"  >Odi,&lt;br/&gt;
are there any reasons for not using the new preferences API to parameterize&lt;br/&gt;
BUFFER_WARN_TRIGGER_LIMIT?&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12381906" author="oglueck" created="Thu, 16 Sep 2004 22:10:12 +0100"  >Of course not Oleg. Just getting lazy theese days... :-)</comment>
                    <comment id="12381907" author="oglueck" created="Fri, 17 Sep 2004 04:09:07 +0100"  >Created an attachment (id=12754)&lt;br/&gt;
Patch to HEAD, take 2&lt;br/&gt;
</comment>
                    <comment id="12381908" author="olegk" created="Fri, 17 Sep 2004 04:22:52 +0100"  >Looks good to me&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381909" author="becke@u.washington.edu" created="Fri, 17 Sep 2004 10:12:10 +0100"  >*** &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-367&quot; title=&quot;Performance Increase by setting the initial ByteArrayOS length&quot;&gt;&lt;strike&gt;HTTPCLIENT-367&lt;/strike&gt;&lt;/a&gt; has been marked as a duplicate of this bug. ***</comment>
                    <comment id="12381910" author="oglueck" created="Fri, 17 Sep 2004 16:03:14 +0100"  >Committed to 2.0 branch and HEAD.</comment>
                    <comment id="12381911" author="oglueck" created="Wed, 22 Sep 2004 15:31:10 +0100"  >Created an attachment (id=12829)&lt;br/&gt;
Documents the new parameter for 3.0 API&lt;br/&gt;
</comment>
                    <comment id="12381912" author="afrancis@thoughtworks.com" created="Wed, 22 Sep 2004 17:08:02 +0100"  >Thanks guys, I feel better :-)</comment>
                    <comment id="12381913" author="oglueck" created="Thu, 23 Sep 2004 01:26:58 +0100"  >Committed Documentation patch to HEAD.</comment>
                </comments>
                    <attachments>
                    <attachment id="12327145" name="ASF.LICENSE.NOT.GRANTED--patch-2.0.diff" size="3369" author="oglueck" created="Thu, 16 Sep 2004 20:12:22 +0100" />
                    <attachment id="12327148" name="ASF.LICENSE.NOT.GRANTED--patch.diff" size="1030" author="oglueck" created="Wed, 22 Sep 2004 15:31:10 +0100" />
                    <attachment id="12327147" name="ASF.LICENSE.NOT.GRANTED--patch.diff" size="4609" author="oglueck" created="Fri, 17 Sep 2004 04:09:07 +0100" />
                    <attachment id="12327146" name="ASF.LICENSE.NOT.GRANTED--patch-HEAD.diff" size="3524" author="oglueck" created="Thu, 16 Sep 2004 20:12:45 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>31246</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 15 Sep 2004 22:41:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133427</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47211</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>