<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:17:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-477/HTTPCLIENT-477.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-477] There is no way to specify a different auth scheme priority for host and proxy</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-477</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Using HttpClient 3.0 rc2, you cannot authenticate to a site using Basic&lt;br/&gt;
Autentication and to a proxy server using NTLM authentication.&lt;br/&gt;
&lt;br/&gt;
When you indicate a prefference to use NTLM over Basic authentication the&lt;br/&gt;
authentication will fail when it tries to authenticate NTML to the Proxy and to&lt;br/&gt;
the Site. If you indicate Basic, then NTLM authentication order the Basic&lt;br/&gt;
authentication will fail when used for the Proxy (since basic authentication&lt;br/&gt;
can&amp;#39;t send the domain name it fails).&lt;br/&gt;
&lt;br/&gt;
The email thread from the discussion group is pasted below for refference.&lt;br/&gt;
&lt;br/&gt;
==============================================================&lt;br/&gt;
==============================================================&lt;br/&gt;
&lt;br/&gt;
Hi all,&lt;br/&gt;
I am trying to authenticate to a server via a proxy which also requires&lt;br/&gt;
authentication. It seems that I can get either the proxy authentication to work&lt;br/&gt;
OR the site authentication to work, but not both.&lt;br/&gt;
&lt;br/&gt;
Both seem to work independently when I set the credentials (or proxy&lt;br/&gt;
credentials) using NTCredentials (e.g. if I connect to the site from a network&lt;br/&gt;
not using a proxy I can get it to work, and I can authenticate to the proxy only&lt;br/&gt;
to get a 401 authentication failed from the server when using the proxy).&lt;br/&gt;
&lt;br/&gt;
I read in the Authentication tutorial that you can&amp;#39;t authenticate using NTLM to&lt;br/&gt;
both the proxy and site, so I&amp;#39;m trying various combinations of authentication,&lt;br/&gt;
but I can&amp;#39;t find any documentation that specifically covers this case and I feel&lt;br/&gt;
like I&amp;#39;m just taking stabs in the dark right now.&lt;br/&gt;
&lt;br/&gt;
If anyone can point me in the direction of the light at the end of the tunnel&lt;br/&gt;
I&amp;#39;d really appreciate it.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David&lt;br/&gt;
&lt;br/&gt;
----------------&lt;br/&gt;
&lt;br/&gt;
On Wed, Jun 29, 2005 at 09:53:07AM -0700, David Parks wrote:&lt;br/&gt;
&amp;gt; Hi all,&lt;br/&gt;
&amp;gt; I am trying to authenticate to a server via a proxy which also requires&lt;br/&gt;
authentication. It seems that I can get either the proxy authentication to work&lt;br/&gt;
OR the site authentication to work, but not both.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Both seem to work independently when I set the credentials (or proxy&lt;br/&gt;
credentials) using NTCredentials (e.g. if I connect to the site from a network&lt;br/&gt;
not using a proxy I can get it to work, and I can authenticate to the proxy only&lt;br/&gt;
to get a 401 authentication failed from the server when using the proxy).&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; I read in the Authentication tutorial that you can&amp;#39;t authenticate using NTLM&lt;br/&gt;
to both the proxy and site, so I&amp;#39;m trying various combinations of&lt;br/&gt;
authentication, but I can&amp;#39;t find any documentation that specifically covers this&lt;br/&gt;
case and I feel like I&amp;#39;m just taking stabs in the dark right now.&lt;br/&gt;
&lt;br/&gt;
David,&lt;br/&gt;
&lt;br/&gt;
You _really_ can&amp;#39;t use NTLM to authenticate with the proxy and the&lt;br/&gt;
target host at the same, due to the nature of this authentication&lt;br/&gt;
scheme. Really. That was not a joke.&lt;br/&gt;
&lt;br/&gt;
Please consider using one of the following combinations instead:&lt;br/&gt;
&lt;br/&gt;
(1) BASIC proxy + NTLM host if both the clent and the proxy are within a&lt;br/&gt;
trusted network segment&lt;br/&gt;
&lt;br/&gt;
(2) NTLM proxy + SSL + BASIC host&lt;br/&gt;
&lt;br/&gt;
Both combinations should provide an adequate (or better in the latter case)&lt;br/&gt;
security&lt;br/&gt;
&lt;br/&gt;
Hope this helps&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; If anyone can point me in the direction of the light at the end of the tunnel&lt;br/&gt;
I&amp;#39;d really appreciate it.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Thanks,&lt;br/&gt;
&amp;gt; David&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&lt;br/&gt;
-------------------&lt;br/&gt;
&lt;br/&gt;
Thanks for the reply Oleg. This is what I figured, but I cannot see how to use&lt;br/&gt;
different authentication schemes for the Proxy vs. the Site authentication&lt;br/&gt;
challenge.&lt;br/&gt;
&lt;br/&gt;
I tried adding the code suggested in the Authentication tutorial:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List authPrefs = new ArrayList(2);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;authPrefs.add(AuthPolicy.DIGEST);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;authPrefs.add(AuthPolicy.BASIC);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;authPrefs.add(AuthPolicy.NTLM);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;This will exclude the NTLM authentication scheme&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;httpclient.getParams().setParameter(AuthPolicy.AUTH_SCHEME_PRIORITY,&lt;br/&gt;
authPrefs);&lt;br/&gt;
&lt;br/&gt;
I got a message stating that it was attempting BASIC authentication for the&lt;br/&gt;
Proxy and that it failed (probably because the domain doesn&amp;#39;t get passed I&lt;br/&gt;
guess). So my thought is that I need NTLM for the proxy authentication and Basic&lt;br/&gt;
will work for the site authentication.&lt;br/&gt;
&lt;br/&gt;
The question I am then working on is how to direct the HttpClient to select that&lt;br/&gt;
order of authentication methods. If I let it take NTLM as the preffered&lt;br/&gt;
authentication method then it will try to authenticate both challenges with NTLM.&lt;br/&gt;
&lt;br/&gt;
I sure there is just some little detail I&amp;#39;m missing here somewhere, it&amp;#39;s just&lt;br/&gt;
hard to find it.&lt;br/&gt;
&lt;br/&gt;
Thanks a lot!&lt;br/&gt;
David&lt;br/&gt;
&lt;br/&gt;
------------------&lt;br/&gt;
&lt;br/&gt;
David,&lt;br/&gt;
&lt;br/&gt;
I see the problem. This will require a patch and a new parameter.&lt;br/&gt;
Luckily the preference API introduced in HttpClient 3.0 allows up to add&lt;br/&gt;
parameters quite easily. Please file a feature request with Bugzilla&lt;br/&gt;
ASAP and I&amp;#39;ll do my best to hack up a patch before I leave for holidays&lt;br/&gt;
(that is Friday, July 1st)&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
--------------&lt;br/&gt;
&lt;br/&gt;
Hi Oleg, thanks, I&amp;#39;ll put that request in today.&lt;br/&gt;
This helps a lot, at least I know I&amp;#39;m on the right path now.&lt;br/&gt;
&lt;br/&gt;
I am attempting to devise a workaround for this by handling the authentication&lt;br/&gt;
manually (setDoAuthentication(false)).&lt;br/&gt;
&lt;br/&gt;
When I see a 401 error I am processing a basic authentication with the site&lt;br/&gt;
credentials, when I see a 407 error I want to process an NTLM authentication&lt;br/&gt;
with the proxy credentials.&lt;br/&gt;
&lt;br/&gt;
To that end I have the following code that runs after&lt;br/&gt;
httpclient.execute(getmethod) executes. The code below works perfectly for the&lt;br/&gt;
basic authentication (when the proxy is not in the picture).&lt;br/&gt;
&lt;br/&gt;
In looking up the Handshake of the NTLM authentication I see that I have a&lt;br/&gt;
problem with the code below since the handshake includes 2 challenge and&lt;br/&gt;
authorization steps before the authentication succeeds. I&amp;#39;m not clear how I&lt;br/&gt;
could manually authenticate the NTLM response. I would expect the NTLMScheme&lt;br/&gt;
class to contain a Type 1 and Type 3 authenticate() method for processing both&lt;br/&gt;
challenge responses. Is there another way of processing the NTLM authentication&lt;br/&gt;
after receiving the initial authentication challenge from the server?&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Check for Proxy or Site authentication&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(getmethod.getStatusCode() == 401){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Authenticate to the site using Basic authentication.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BasicScheme basicscheme = new BasicScheme();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String basic_auth_string = basicscheme.authenticate(new&lt;br/&gt;
NTCredentials(&amp;quot;cwftp&amp;quot;, &amp;quot;664A754c&amp;quot;, &amp;quot;&amp;quot;, &amp;quot;&amp;quot;), getmethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Header basic_auth_header = new Header(&amp;quot;Authorization&amp;quot;,&lt;br/&gt;
basic_auth_string);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getmethod.addRequestHeader(basic_auth_header);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;httpclient.executeMethod(getmethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}catch(Exception e){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;logger.log(Level.SEVERE, &amp;quot;ack!!!!&amp;quot;, e);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return getmethod;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}else if(getmethod.getStatusCode() == 407){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Authenticate to the site using Basic authentication&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;NTLMScheme ntlmscheme = new NTLMScheme();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String basic_auth_string = ntlmscheme.authenticate(new&lt;br/&gt;
NTCredentials(&amp;quot;00mercbac&amp;quot;, &amp;quot;!@SAMmerc2004&amp;quot;, &amp;quot;simproxy&amp;quot;, &amp;quot;CFC&amp;quot;), getmethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Header basic_auth_header = new Header(&amp;quot;Authorization&amp;quot;,&lt;br/&gt;
basic_auth_string);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getmethod.addRequestHeader(basic_auth_header);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;httpclient.executeMethod(getmethod);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}catch(Exception e){&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;logger.log(Level.SEVERE, &amp;quot;ack!!!!&amp;quot;, e);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return getmethod;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
David</description>
                <environment>Operating System: Windows 2000&lt;br/&gt;
Platform: All</environment>
            <key id="12334036">HTTPCLIENT-477</key>
            <summary>There is no way to specify a different auth scheme priority for host and proxy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="davidparks21@yahoo.com">David Parks</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jun 2005 07:33:52 +0100</created>
                <updated>Sun, 11 Nov 2007 19:12:05 +0000</updated>
                    <resolved>Thu, 18 Oct 2007 15:48:34 +0100</resolved>
                            <version>3.0 Beta 1</version>
                                <fixVersion>4.0 Alpha 2</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382463" author="olegk" created="Mon, 22 Aug 2005 23:12:55 +0100"  >Will require a new parameter and is likely to require more changes in the auth&lt;br/&gt;
code than I would be comfortable with so late in the release process. Pushed&lt;br/&gt;
back to 3.1&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12413903" author="olegk" created="Wed, 31 May 2006 05:04:59 +0100"  >I do not see a way to fix the problem cleanly in 3.1. I suggest we deal with it in 4.0 &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12535927" author="olegk" created="Thu, 18 Oct 2007 15:48:34 +0100"  >Httpclient 4.0 now uses distinct instances of the authentication handler interface to authenticate against target and proxy hosts. This allows for injection of a custom handler responsible for authentication with just one type of hosts.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35554</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 22 Aug 2005 22:12:55 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133524</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47843</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>