<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:13:20 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1147/HTTPCLIENT-1147.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1147] When HttpClient-Cache cannot open cache file, should act like miss</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1147</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Set up HttpClient-Cache like this:&lt;br/&gt;
final String cacheDir = &amp;quot;cachedir&amp;quot;;&lt;br/&gt;
HttpClient cachingHttpClient;&lt;br/&gt;
final CacheConfig cacheConfig = new CacheConfig();&lt;br/&gt;
cacheConfig.setSharedCache(false);&lt;br/&gt;
cacheConfig.setMaxObjectSizeBytes(262144); //256kb&lt;br/&gt;
&lt;br/&gt;
if(! new File(cacheDir, &amp;quot;httpclient-cache&amp;quot;).exists()){&lt;br/&gt;
	if(!new File(cacheDir, &amp;quot;httpclient-cache&amp;quot;).mkdir()){&lt;br/&gt;
		throw new RuntimeException(&amp;quot;failed to create httpclient cache directory: &amp;quot; + new File(cacheDir, &amp;quot;httpclient-cache&amp;quot;).getAbsolutePath());&lt;br/&gt;
	}&lt;br/&gt;
}&lt;br/&gt;
final ResourceFactory resourceFactory = new FileResourceFactory(new File(cacheDir, &amp;quot;httpclient-cache&amp;quot;));&lt;br/&gt;
&lt;br/&gt;
final HttpCacheStorage httpCacheStorage = new ManagedHttpCacheStorage(cacheConfig);&lt;br/&gt;
&lt;br/&gt;
cachingHttpClient = new CachingHttpClient(client, resourceFactory, httpCacheStorage, cacheConfig);&lt;br/&gt;
&lt;br/&gt;
Then make a request:&lt;br/&gt;
final HttpGet get = new HttpGet(url);&lt;br/&gt;
final HttpResponse response = cachingHttpClient.execute(get);&lt;br/&gt;
final StatusLine statusLine = response.getStatusLine();&lt;br/&gt;
if (statusLine.getStatusCode() &amp;gt;= 300) {&lt;br/&gt;
	if(statusLine.getStatusCode() == 404)&lt;br/&gt;
		throw new NoResultException();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw new HttpResponseException(statusLine.getStatusCode(),&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;statusLine.getReasonPhrase());&lt;br/&gt;
}&lt;br/&gt;
response.getEntity().getContent();&lt;br/&gt;
&lt;br/&gt;
Everything worked as expected.&lt;br/&gt;
&lt;br/&gt;
Now delete the cache directory (&amp;quot;cachedir/httpclient-cache&amp;quot; in this example).&lt;br/&gt;
&lt;br/&gt;
And make the same request again.&lt;br/&gt;
&lt;br/&gt;
Actual:&lt;br/&gt;
&amp;nbsp;Caused by: java.lang.IllegalStateException: Content has been consumed&lt;br/&gt;
	at org.apache.http.entity.BasicHttpEntity.getContent(BasicHttpEntity.java:84)&lt;br/&gt;
	at org.apache.http.conn.BasicManagedEntity.getContent(BasicManagedEntity.java:100)&lt;br/&gt;
&lt;br/&gt;
Expected:&lt;br/&gt;
HttpClient shouldn&amp;#39;t throw an exception - it should just perform the request again acting like a cache miss.</description>
                <environment></environment>
            <key id="12532498">HTTPCLIENT-1147</key>
            <summary>When HttpClient-Cache cannot open cache file, should act like miss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="candrews">Craig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Nov 2011 17:41:27 +0000</created>
                <updated>Thu, 2 Feb 2012 16:38:29 +0000</updated>
                    <resolved>Fri, 2 Dec 2011 14:18:01 +0000</resolved>
                            <version>4.2 Alpha1</version>
                                <fixVersion>4.1.3</fixVersion>
                <fixVersion>4.2 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13157493" author="olegk" created="Sat, 26 Nov 2011 13:52:21 +0000"  >Jon, could you please look into that?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13157630" author="vwdiesel" created="Sun, 27 Nov 2011 01:04:56 +0000"  >This patch is provided with permission of my employer with rights granted to the asf.</comment>
                    <comment id="13157631" author="vwdiesel" created="Sun, 27 Nov 2011 01:06:46 +0000"  >So the attached patch should take care of this problem.  The test has to be reworked a little bit - because right now it is doing external I/O (to get a URL resource) and some file based I/O (because of the directory configuration mentioned in this issue).  I believe that there has to be an easier way to test this issue.</comment>
                    <comment id="13161653" author="olegk" created="Fri, 2 Dec 2011 14:18:01 +0000"  >Patch checked in to both trunk and 4.1.x branch. Please test.&lt;br/&gt;
&lt;br/&gt;
Joe, many thanks for contributing the patch.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13198695" author="olegk" created="Thu, 2 Feb 2012 11:15:58 +0000"  >I did a lousy job reviewing the patch. I missed the fact that the patch broke API compatibility by adding an additional method to the Resource interface. &lt;br/&gt;
&lt;br/&gt;
I backed out those changes as they seem to have no impact on the resolution of the original issue. The test case testing the fix still pass for me even without API breaking changes.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13198859" author="sebb@apache.org" created="Thu, 2 Feb 2012 15:07:04 +0000"  >Adding a method to an interface does not break binary compatibility; however it will in general be source incompatible (unless all 3rd party implementation are subclasses of a base implementation that is also updated).&lt;br/&gt;
&lt;br/&gt;
See &lt;a href=&quot;http://java.sun.com/docs/books/jls/second_edition/html/binaryComp.doc.html#45347&quot;&gt;http://java.sun.com/docs/books/jls/second_edition/html/binaryComp.doc.html#45347&lt;/a&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12505220" name="issue_1147.patch" size="15476" author="vwdiesel" created="Sun, 27 Nov 2011 01:04:56 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 26 Nov 2011 13:52:21 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>218232</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>46882</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>