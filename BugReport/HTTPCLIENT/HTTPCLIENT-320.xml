<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:16:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-320/HTTPCLIENT-320.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-320] &quot;Socket Closed&quot; IOException thrown by HttpConnection</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-320</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>HttpClient.java was modified in version 2.0 Final in method executeMethod().&lt;br/&gt;
The call to connection.setSoTimeout() used to be in RC3 after the call to&lt;br/&gt;
connection.isOpen(), but in the final version the call happens before the call &lt;br/&gt;
to isOpen(). The result of the change is that the setSoTimeout() call could &lt;br/&gt;
throw IOException because of closed socket.&lt;br/&gt;
&lt;br/&gt;
I would fix the problem by adding to HttpConnection.setSoTimeout() (and to &lt;br/&gt;
other similar methods in HttpConnection) an explicit check (a call to isOpen&lt;br/&gt;
()) whether the socket is closed as the existence of socket object does not &lt;br/&gt;
guarantee it. I.e the following code:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void setSoTimeout(int timeout)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throws SocketException, IllegalStateException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LOG.debug(&amp;quot;HttpConnection.setSoTimeout(&amp;quot; + timeout + &amp;quot;)&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;soTimeout = timeout;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (socket != null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(timeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
would be changed to&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void setSoTimeout(int timeout)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throws SocketException, IllegalStateException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LOG.debug(&amp;quot;HttpConnection.setSoTimeout(&amp;quot; + timeout + &amp;quot;)&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;soTimeout = timeout;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (isOpen()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(timeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12333879">HTTPCLIENT-320</key>
            <summary>&quot;Socket Closed&quot; IOException thrown by HttpConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="pvirkkul@pvirkkul.com">Petri Virkkula</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Feb 2004 13:33:28 +0000</created>
                <updated>Wed, 16 Feb 2011 20:45:01 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:40 +0100</resolved>
                            <version>2.0 Final</version>
                                <fixVersion>2.0 Final</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12381493" author="olegk" created="Thu, 26 Feb 2004 17:17:18 +0000"  >Petri,&lt;br/&gt;
I do not quite see how the allegedly offending change may be causing this problem&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/java/org/apache/commons/httpclient/HttpClient.java?r1=1.76.2.2&amp;r2=1.76.2.3&amp;diff_format=h&amp;only_with_tag=HTTPCLIENT_2_0_BRANCH&quot;&gt;http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/java/org/apache/commons/httpclient/HttpClient.java?r1=1.76.2.2&amp;amp;r2=1.76.2.3&amp;amp;diff_format=h&amp;amp;only_with_tag=HTTPCLIENT_2_0_BRANCH&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
True, in 2.0-final connection.setSoTimeout() is called before the&lt;br/&gt;
connection.isOpen() check. However in both 2.0rc3 &amp;amp; 2.0-final the call occurs&lt;br/&gt;
BEFORE the socket is actually open. I do not quite see how it would be possible&lt;br/&gt;
for a socket closed IOException to be thrown with 2.0-final but not with&lt;br/&gt;
2.0-rc3. Am I missing something?&lt;br/&gt;
&lt;br/&gt;
What kind of JDK are you using? I suspect that this problem can well be JDK&lt;br/&gt;
specific, as I always thought that it was okay to call setSoTimeout() on a&lt;br/&gt;
closed socket.&lt;br/&gt;
&lt;br/&gt;
Anyhow, in case of HttpClient#executeMethod the call to&lt;br/&gt;
connection.setSoTimeout() does seem misplaced. The method should be called only&lt;br/&gt;
after the connection is open.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12381494" author="olegk" created="Thu, 26 Feb 2004 17:20:29 +0000"  >Ok, I think I got it. With the present sequence of calls HttpClient attempts to&lt;br/&gt;
set the socket timeout before the stale connection check is done. In the RC3&lt;br/&gt;
that was not that case. &lt;br/&gt;
&lt;br/&gt;
A patch to follow shortly&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381495" author="olegk" created="Thu, 26 Feb 2004 17:30:51 +0000"  >Created an attachment (id=10565)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12381496" author="pvirkkul@pvirkkul.com" created="Thu, 26 Feb 2004 18:35:08 +0000"  >The patch 1 solves the immediate symptons of the problems in HttpClient class. &lt;br/&gt;
However, I would add the socket stale check to HttpConnection class itself. &lt;br/&gt;
With the current fix you need always call HttpConnection#isOpen before calling &lt;br/&gt;
any of these methods:&lt;br/&gt;
&lt;br/&gt;
HttpConnection#setSoTimeout&lt;br/&gt;
HttpConnection#getSoTimeout&lt;br/&gt;
HttpConnection#setSendBufferSize&lt;br/&gt;
HttpConnection#getSendBufferSize&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12381497" author="olegk" created="Thu, 26 Feb 2004 19:04:50 +0000"  >Petri,&lt;br/&gt;
There&amp;#39;s a catch. The stale connection check can be VERY, VERY taxing in terms of&lt;br/&gt;
performance for relatively small payload request/response pairs. I really would&lt;br/&gt;
like to see it used very sparingly. &lt;br/&gt;
&lt;br/&gt;
What JDK are you using, BTW?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381498" author="pvirkkul@pvirkkul.com" created="Thu, 26 Feb 2004 19:49:30 +0000"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I am using Sun&amp;#39;s J2SE 1.4.1_01&lt;br/&gt;
&lt;br/&gt;
BR, Petri&lt;br/&gt;
</comment>
                    <comment id="12381499" author="olegk" created="Thu, 26 Feb 2004 21:05:13 +0000"  >Petri,&lt;br/&gt;
We have had quite a few reports of all sorts of stale connection check related&lt;br/&gt;
problems with early releases of Sun&amp;#39;s JDK 1.4.1. If it is an option consider&lt;br/&gt;
upgrading to 1.4.2 or latest service release of JDK 1.4.1 (1.4.1.7 as of writing)&lt;br/&gt;
&lt;br/&gt;
I still believe that it _should_ be okay to call setSoTimeout on a closed socket.&lt;br/&gt;
&lt;br/&gt;
Cheers,&lt;br/&gt;
Oleg</comment>
                    <comment id="12381500" author="olegk" created="Tue, 9 Mar 2004 00:34:52 +0000"  >Patch committed to the 2.0 branch. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327068" name="ASF.LICENSE.NOT.GRANTED--timeout.patch" size="1078" author="olegk" created="Thu, 26 Feb 2004 17:30:51 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>27242</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 26 Feb 2004 17:17:18 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133369</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47090</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>