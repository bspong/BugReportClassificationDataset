<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:15:57 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-307/HTTPCLIENT-307.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-307] An IOException or RuntimeException leaves the underlying socket in an undetermined state</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-307</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>If an application level IOException or RuntimeException occurs, the underlying&lt;br/&gt;
socket will be in an undetermined state. In many cases, this will lead to zombie&lt;br/&gt;
connections in the pool that do not respond properly.&lt;br/&gt;
&lt;br/&gt;
Simple example: uploading a file via POST. If we promise the server 1MB of data.&lt;br/&gt;
Shortly after starting the transfer an IOException occurs (e.g. the NFS server&lt;br/&gt;
the file was residing on stops responding). The connection is returned to the&lt;br/&gt;
pool (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-302&quot; title=&quot;exception during writeRequest leaves the connection un-released&quot;&gt;&lt;strike&gt;HTTPCLIENT-302&lt;/strike&gt;&lt;/a&gt;) but the the server is still expecting close to 1MB of data&lt;br/&gt;
on that socket. The next request on that socket (e.g. a GET) will send the HTTP&lt;br/&gt;
header but  the server thinks the header is part of the old stream and doesn&amp;#39;t&lt;br/&gt;
respond.</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: All</environment>
            <key id="12333866">HTTPCLIENT-307</key>
            <summary>An IOException or RuntimeException leaves the underlying socket in an undetermined state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="mohammad.rezaei@gs.com">Mohammad Rezaei</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Dec 2003 22:36:40 +0000</created>
                <updated>Wed, 16 Feb 2011 20:43:57 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:38 +0100</resolved>
                            <version>2.0 Beta 2</version>
                                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12381380" author="olegk" created="Wed, 17 Dec 2003 22:56:50 +0000"  >Mohammad,&lt;br/&gt;
I did not forget about this one. But again (as pain in the rear as I can be), I&lt;br/&gt;
am not sure it this bug warrants a fix for 2.0 for the following reason: bugs&lt;br/&gt;
like that are horribly difficult to test comprehensively and 2.0 architecture is&lt;br/&gt;
too convoluted not to stand a risk of breaking something else while trying to&lt;br/&gt;
fix this bug. Am I getting too paranoid? Anyone seeing the situation differently?&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll happily provide a fix for CVS HEAD, though.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381381" author="mohammad.rezaei@gs.com" created="Wed, 17 Dec 2003 23:03:15 +0000"  >You know the code much better than I do. I&amp;#39;ll trust your judgement and therefore&lt;br/&gt;
have no objection to seeing this fix in 2.1.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Moh</comment>
                    <comment id="12381382" author="oglueck" created="Wed, 17 Dec 2003 23:06:21 +0000"  >I do not favour a 2.0 patch either as I am pretty sure you can easily handle&lt;br/&gt;
this situation outside HttpClient by catching the exception and forceClose the&lt;br/&gt;
connection.</comment>
                    <comment id="12381383" author="skoehler@upb.de" created="Wed, 17 Dec 2003 23:22:19 +0000"  >So how can somebody close a connection if he cannot get the ConnectionObject&lt;br/&gt;
without restructuring the whole code?&lt;br/&gt;
I&amp;#39;m only using the executeMethod()-method and i don&amp;#39;t see any way of getting the&lt;br/&gt;
HttpConnection-object that&amp;#39;s used.&lt;br/&gt;
Your suggestion would also workaround my &amp;quot;HttpClient finished downloads even if&lt;br/&gt;
there are gigabytes to download&amp;quot;-problem too.&lt;br/&gt;
&lt;br/&gt;
But after all it&amp;#39;s still a workaround.</comment>
                    <comment id="12381384" author="mohammad.rezaei@gs.com" created="Wed, 17 Dec 2003 23:26:04 +0000"  >Sven, that was my problem exactly. Currently, my workaround is to subclass the&lt;br/&gt;
method and add the try/catch blocks in the writeRequest method. At that point,&lt;br/&gt;
the connection is available.&lt;br/&gt;
Mike, what exactly is &amp;quot;forceClose&amp;quot;? The only reference I see to it are a couple&lt;br/&gt;
of test cases that send &amp;quot;Connection: close&amp;quot; headers, which is not appropriate in&lt;br/&gt;
this case.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Moh</comment>
                    <comment id="12381385" author="olegk" created="Wed, 17 Dec 2003 23:38:04 +0000"  >Mohammad,&lt;br/&gt;
Your strategy is absolutely correct: subclass PostMethod, provide try catch&lt;br/&gt;
block in execute method, call HttpMethodBase#setForceCloseConnection(true)&lt;br/&gt;
or/and simply close the connection that you get as a parameter to the method.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381386" author="becke@u.washington.edu" created="Thu, 18 Dec 2003 02:31:05 +0000"  >I agree this is something that we should add.  As for where to add it, I&amp;#39;m not&lt;br/&gt;
sure.  We should definitely take care of it in CVS HEAD, but I&amp;#39;m wondering if we&lt;br/&gt;
should include the connection.close() as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-302&quot; title=&quot;exception during writeRequest leaves the connection un-released&quot;&gt;&lt;strike&gt;HTTPCLIENT-302&lt;/strike&gt;&lt;/a&gt;.  My thinking being&lt;br/&gt;
that if we&amp;#39;re releasing the connection anyway, what harm will closing it cause?&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;Like Oleg though, I&amp;#39;m quite wary about changing this so late.&lt;br/&gt;
&lt;br/&gt;
I suggest we come up with a patch quickly, that we can test in the next few&lt;br/&gt;
days.  If after a few days of testing we feel confident that all is working, we&lt;br/&gt;
should include it in rc3.  If we have any trouble, the change should be backed&lt;br/&gt;
out and left until after 2.0 final.  How does everyone feel about this?&lt;br/&gt;
&lt;br/&gt;
For Moh&amp;#39;s workaround I think calling connection.close() is probably better than&lt;br/&gt;
setting via HttpMethodBase#setForceCloseConnection(true).  Setting forceClose&lt;br/&gt;
only closes the connection after the response body has been consumed.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381387" author="olegk" created="Tue, 13 Jan 2004 07:09:48 +0000"  >The patch for the &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-302&quot; title=&quot;exception during writeRequest leaves the connection un-released&quot;&gt;&lt;strike&gt;HTTPCLIENT-302&lt;/strike&gt;&lt;/a&gt; should have taken care of this one too. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>25592</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 17 Dec 2003 22:56:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133356</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189244</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>