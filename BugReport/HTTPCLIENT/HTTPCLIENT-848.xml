<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:21:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-848/HTTPCLIENT-848.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-848] HttpClient:- Connections not released when SSL Tunneling fails.</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-848</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Trying to use HTTPS, and SSL tunneling fails as expected because the host is not accepted by the squid proxy, so squid proxy return 403. &lt;br/&gt;
&lt;br/&gt;
The problem I am seeing is that, when ever this happens the connections are not released to the pool. I traced the code and it appears that in &lt;br/&gt;
HttpMethidDirector.java:  executeWithRetry()&lt;br/&gt;
when executeConnect() return false and there is no retry, the connections are not released.&lt;br/&gt;
&lt;br/&gt;
Is this expected? Or am I doing something wrong.</description>
                <environment></environment>
            <key id="12425134">HTTPCLIENT-848</key>
            <summary>HttpClient:- Connections not released when SSL Tunneling fails.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="praveen19">praveen neppalli naga</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 May 2009 20:43:02 +0100</created>
                <updated>Tue, 25 Jan 2011 10:59:15 +0000</updated>
                    <resolved>Sat, 16 May 2009 13:29:33 +0100</resolved>
                            <version>3.1 (end of life)</version>
                                <fixVersion>3.1.1</fixVersion>
                                <component>HttpConn</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12708192" author="olegk" created="Mon, 11 May 2009 21:19:46 +0100"  >Are you sure your application _always_ invokes HttpMethod#releaseConnection() when done with the request? The best way to ensure the underlying connection gets released back to the pool is by calling this method from a finally block.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12708196" author="praveen19" created="Mon, 11 May 2009 21:22:44 +0100"  >absolutely. I do HttpMethod#releaseConnection() in the finally block.&lt;br/&gt;
&lt;br/&gt;
I debugged through the code before i opened this issue. </comment>
                    <comment id="12708201" author="olegk" created="Mon, 11 May 2009 21:27:49 +0100"  >Could you please attach a _complete_ context / wire log of a session exhibiting the problem? &lt;br/&gt;
&lt;br/&gt;
Even if this is a genuine bug in HttpClient it is unlikely to get fixed, as 3.x branch is effectively approaching end of life. Consider upgrading to HttpClient 4.0&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12709949" author="praveen19" created="Fri, 15 May 2009 21:14:39 +0100"  >Hi Oleg, sorry for the delayed response. I just saw you resolved the issue.&lt;br/&gt;
&lt;br/&gt;
I tested the scenario with 4.0 and i dont see the problem. &lt;br/&gt;
But I just want to prove that its a bug in 3.x version as I am not in a position to upgrade to 4.0 as its a beta. &lt;br/&gt;
What information/logs do you need. I have a test case which will reproduce this behavior.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Praveen</comment>
                    <comment id="12709953" author="olegk" created="Fri, 15 May 2009 21:23:15 +0100"  >Feel free to re-open the issue and attach a wire/context log (which can be produced using thus guide [1]) and the test case.&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;http://hc.apache.org/httpclient-3.x/logging.html&quot;&gt;http://hc.apache.org/httpclient-3.x/logging.html&lt;/a&gt;</comment>
                    <comment id="12709991" author="praveen19" created="Fri, 15 May 2009 23:10:44 +0100"  >Reopening,&lt;br/&gt;
I am going to attach the context/wire logs and a simple test case.</comment>
                    <comment id="12709996" author="praveen19" created="Fri, 15 May 2009 23:18:14 +0100"  >Attached the logs and the test case.&lt;br/&gt;
This is the scenario.&lt;br/&gt;
&lt;br/&gt;
Make https get  call using httpclient 3.1 to say &amp;quot;&lt;a href=&quot;https://www.verisin.com/&quot;&gt;https://www.verisin.com/&lt;/a&gt;&amp;quot;&lt;br/&gt;
Have a squid proxy and dont authorize &amp;quot;&lt;a href=&quot;https://www.verisin.com/&quot;&gt;https://www.verisin.com/&lt;/a&gt;&amp;quot; in the acl list, so squid will block this call.&lt;br/&gt;
As expected httpClient makes a CONNECT with squid proxy to tunnel with the host.&lt;br/&gt;
Squid responds back with 403.&lt;br/&gt;
httpClient does not release connection to the pool so any subsequent calls for the same host will not get connection.&lt;br/&gt;
MaxTotalConnections = 4&lt;br/&gt;
DefaultMaxConnectionsPerHost = 1&lt;br/&gt;
&lt;br/&gt;
The expected behavior is that, httpClient releases the connection to the pool for this specific host when CONNECT call fails.&lt;br/&gt;
&lt;br/&gt;
Also Pplease let me know if I doing something wrong.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Praveen</comment>
                    <comment id="12710105" author="olegk" created="Sat, 16 May 2009 13:29:33 +0100"  >Fixed in SVN trunk. Please re-test.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12710512" author="praveen19" created="Mon, 18 May 2009 23:05:45 +0100"  >I verified the fix and it works fine.&lt;br/&gt;
Thanks for  your quick turn around.&lt;br/&gt;
&lt;br/&gt;
Do you want me to go ahead and close the issue?&lt;br/&gt;
&lt;br/&gt;
Also when do you think this fix will be released?&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Praveen</comment>
                    <comment id="12710663" author="olegk" created="Tue, 19 May 2009 09:19:31 +0100"  >&amp;gt; Also when do you think this fix will be released?&lt;br/&gt;
&lt;br/&gt;
Praveen,&lt;br/&gt;
&lt;br/&gt;
It is very unlikely there will ever be another official release of the 3.x branch&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12408283" name="context.log" size="9530" author="praveen19" created="Fri, 15 May 2009 23:18:14 +0100" />
                    <attachment id="12408282" name="HttpClientTest.java" size="2382" author="praveen19" created="Fri, 15 May 2009 23:18:14 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 11 May 2009 20:19:46 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133867</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47396</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>