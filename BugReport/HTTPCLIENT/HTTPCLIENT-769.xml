<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:20:53 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-769/HTTPCLIENT-769.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-769] java.lang.IllegalStateException: Connection already open.</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-769</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>I am seeing many of the same problems noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-741&quot; title=&quot;AbstractClientConnAdapter prone to concurrency issues&quot;&gt;&lt;strike&gt;HTTPCLIENT-741&lt;/strike&gt;&lt;/a&gt; using the latest builds from the maven repo.&lt;br/&gt;
&lt;br/&gt;
java.lang.IllegalStateException: Connection already open.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:150)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPooledConnAdapter.open(AbstractPooledConnAdapter.java:119)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.DefaultClientRequestDirector.execute(DefaultClientRequestDirector.java:308)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:501)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:456)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:422)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.hi5.os.Hi5RemoteContentFetcher.fetch(Hi5RemoteContentFetcher.java:279)&lt;br/&gt;
</description>
                <environment>jdk 1.6, linux SUSE 10&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;244833 2008-05-01 11:03 lib/httpclient-4.0-alpha4-20080427.214350-9.jar&lt;br/&gt;
&amp;nbsp;168993 2008-05-01 11:03 lib/httpcore-4.0-beta2-20080408.115743-9.jar&lt;br/&gt;
&amp;nbsp;176761 2008-05-01 11:03 lib/httpcore-nio-4.0-beta2-20080408.115743-9.jar&lt;br/&gt;
&amp;nbsp;&amp;nbsp;22040 2008-05-01 11:03 lib/httpmime-4.0-alpha4-20080427.214350-9.jar&lt;br/&gt;
&lt;br/&gt;
</environment>
            <key id="12395160">HTTPCLIENT-769</key>
            <summary>java.lang.IllegalStateException: Connection already open.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="plindner">Paul Lindner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 May 2008 21:51:45 +0100</created>
                <updated>Sat, 24 May 2008 21:12:09 +0100</updated>
                    <resolved>Sat, 3 May 2008 00:14:45 +0100</resolved>
                            <version>4.0 Alpha 4</version>
                                <fixVersion>4.0 Alpha 4</fixVersion>
                                <component>HttpConn</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12593636" author="plindner" created="Thu, 1 May 2008 21:54:47 +0100"  >Updated with stacktrace and list of jars used.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12593660" author="olegk" created="Thu, 1 May 2008 23:32:29 +0100"  >Paul,&lt;br/&gt;
What is it _exactly_ you are doing that triggers the exception? Can you put together a test case to reproduce the bug?&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12593663" author="plindner" created="Thu, 1 May 2008 23:40:33 +0100"  >This code is an implementation of a Fetcher interface as used in the Shindig project.  It&amp;#39;s basically a proxy server, to a smallish set of backend servers ( &amp;lt; 50)&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;netstat -an |grep &amp;#39;:80[ ]*ESTAB&amp;#39; |awk &amp;#39;{print $5}&amp;#39;|sort |uniq -c |sort -rn&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;3 75.126.76.168:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;3 74.53.174.114:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;3 70.42.240.21:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2 74.200.66.167:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2 72.249.66.221:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2 168.143.164.40:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1 72.249.66.208:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1 67.228.130.71:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1 216.69.179.28:80&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;1 208.76.70.58:80&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;</comment>
                    <comment id="12593680" author="sebb@apache.org" created="Fri, 2 May 2008 01:37:05 +0100"  >This might be because the RouteTracker#connected field is not synch or volatile.&lt;br/&gt;
&lt;br/&gt;
There seem to be quite a few fields that are initialised in ctors that could benefit from being made final.&lt;br/&gt;
Easy enough to do this when they are private, but some of them are protected: is that because subclasses need read-write access, or just read-access?</comment>
                    <comment id="12593683" author="plindner" created="Fri, 2 May 2008 02:05:06 +0100"  >One test case.&lt;br/&gt;
&lt;br/&gt;
One host with about 10-20 req/sec, each response has Connection:close, so we should never reuse these connections -- yet we are.  About 10% of the time we get the error java.lang.IllegalStateException: Connection already open.&lt;br/&gt;
&lt;br/&gt;
Maybe something isn&amp;#39;t getting cleaned up properly?&lt;br/&gt;
</comment>
                    <comment id="12593693" author="sberlin" created="Fri, 2 May 2008 02:32:13 +0100"  >We also just released a new beta with httpcore-4.0-beta2-20080408.115743-9 , httpcore-nio-4.0-beta2-20080408.115743-9, and httpclient-4.0-alpha4-20080427.214350-9, and are still getting these exceptions.  I&amp;#39;ll spend some time looking into it again tomorrow, but another pair of eyes would be very helpful -- myself and a few others here have tried to track this down a few times, and have come up with nothing.  (Although we tend to get lost trying to comprehend how the connection management code works in practice -- it&amp;#39;s very intricate.)</comment>
                    <comment id="12593720" author="plindner" created="Fri, 2 May 2008 07:11:04 +0100"  >Another data point.  I ran my requests through a single thread and found the same errors (just less often).  So I don&amp;#39;t think it&amp;#39;s a concurrency issue, I think it&amp;#39;s an issue with cleanups not being done properly.&lt;br/&gt;
</comment>
                    <comment id="12593759" author="sebb@apache.org" created="Fri, 2 May 2008 11:44:59 +0100"  >Unless cleanups are done by a separate embedded worker thread?&lt;br/&gt;
&lt;br/&gt;
Still worth fixing the obvious unsynch variables though.</comment>
                    <comment id="12593856" author="olegk" created="Fri, 2 May 2008 20:21:34 +0100"  >Folks,&lt;br/&gt;
&lt;br/&gt;
I managed to track down the cause of the problem. Paul was absolutely right. It is a problem with the cleanup code, not a concurrency issue. Anyways, the issue appears severe enough to block the release. I am waiting for the write access to the SVN to come back to commit the fix. &lt;br/&gt;
&lt;br/&gt;
Sam,&lt;br/&gt;
&lt;br/&gt;
The connection management code is so complex, it can easily cause a severe hair loss. The fact that Roland had a tendency to over-complicate things did not quite help. However, overall Roland did a great job on the connection management API. The code just needs some time to mature.&lt;br/&gt;
&lt;br/&gt;
Are you seeing other exceptions in the latest release of LimeWire or only this one? Is it okay to proceed with the release if this issue is fixed?&lt;br/&gt;
&lt;br/&gt;
Sebastian,&lt;br/&gt;
&lt;br/&gt;
Please go ahead and fix whatever sync issues as you see necessary. You have as many rights to shape HttpClient&amp;#39;s code as any other committer on the project.&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12593861" author="sberlin" created="Fri, 2 May 2008 20:41:28 +0100"  >That&amp;#39;s great, Oleg!  As far as I can tell, that was the only httpcomponents-related bug we saw reported.  (You can check it out for yourself @ bugreports.limewire.com/bugs/home.jsp -- pretty nifty bug-watching system.)&lt;br/&gt;
&lt;br/&gt;
Re: connection management code -- I completely agree.  Roland did an absolutely fantastic job with it.  Adding in support for aborting connection requests was a breeze.  It&amp;#39;s complicated, but not unnecessarily so.</comment>
                    <comment id="12593927" author="olegk" created="Sat, 3 May 2008 00:14:44 +0100"  >I committed the fix and uploaded the latest snapshot to the maven repository.&lt;br/&gt;
&lt;br/&gt;
Paul,&lt;br/&gt;
&lt;br/&gt;
Could you please test your application with the latest snapshot and confirm the fix?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12593949" author="plindner" created="Sat, 3 May 2008 02:00:16 +0100"  >Works in heavy production load.&lt;br/&gt;
&lt;br/&gt;
There&amp;#39;s a new behavior that results in a ConcurrentModificationException that I&amp;#39;ll detail in a new bug.&lt;br/&gt;
</comment>
                    <comment id="12599618" author="sberlin" created="Sat, 24 May 2008 21:12:09 +0100"  >We&amp;#39;re still seeing this bug (albiet much more rarely) against snapshot httpclient-4.0-alpha5-20080522.192134-5.jar.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ll spend a bit of time digging in to see what causes it.  The good news is that other than this very rare bug, HttpClient is working absolutely perfectly. :-)</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10020">
                <name>Cloners</name>
                                                <inwardlinks description="is a clone of">
                            <issuelink>
            <issuekey id="12387709">HTTPCLIENT-741</issuekey>
        </issuelink>
                    </inwardlinks>
                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12381281" name="Hi5RemoteContentFetcher.java" size="13612" author="plindner" created="Thu, 1 May 2008 23:40:33 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 1 May 2008 22:32:29 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133805</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47700</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>