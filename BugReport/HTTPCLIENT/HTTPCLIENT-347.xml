<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:16:31 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-347/HTTPCLIENT-347.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-347] MultiThreadedConnectionManager Accounting Problems</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-347</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>getConnectionsInPool() is certainly a more intutive name. &lt;br/&gt;
At the same, as you already mentioned, certainly there need to be a connection killer method: &lt;br/&gt;
MultiThreadedHttpConnectionManager.destroyIdleConnections(long idleTime) &lt;br/&gt;
&lt;br/&gt;
Also, I would recommend one method which could spit out connection statistics at any time for the &lt;br/&gt;
given Connection Manager. This will be great method for testing purpose as well. &lt;br/&gt;
MultiThreadedHttpConnectionManager.displayCurrentStatistics(); &lt;br/&gt;
----------------------------------&lt;br/&gt;
Curent Connection Statistics&lt;br/&gt;
----------------------------------&lt;br/&gt;
Total connectinos in Pool = 10&lt;br/&gt;
Open connectinos          = 3&lt;br/&gt;
Close connections         = 5&lt;br/&gt;
Stale connections         = 2 &lt;br/&gt;
And, if are even more adventurous we could extend our report to: &lt;br/&gt;
Average wait time for connection = 1356 ms&lt;br/&gt;
Maximum wait time for connectino = 1892 ms</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12333906">HTTPCLIENT-347</key>
            <summary>MultiThreadedConnectionManager Accounting Problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="becke@u.washington.edu">Michael Becke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Jun 2004 09:38:11 +0100</created>
                <updated>Wed, 16 Feb 2011 20:43:39 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:47 +0100</resolved>
                            <version>3.0 Alpha 2</version>
                                <fixVersion>3.0 Alpha 2</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12381709" author="becke@u.washington.edu" created="Fri, 4 Jun 2004 09:48:13 +0100"  >Created an attachment (id=11758)&lt;br/&gt;
Patch 1&lt;br/&gt;
</comment>
                    <comment id="12381710" author="becke@u.washington.edu" created="Fri, 4 Jun 2004 09:57:15 +0100"  >Sorry for all the spam on this one.  I accidentally created the bug before I finished filling out the form.&lt;br/&gt;
&lt;br/&gt;
The attached patch adds deleteClosedConnections() which in combination with closeIdleConnections() &lt;br/&gt;
should do what we&amp;#39;re looking for.  I&amp;#39;m not entirely satisfied with this solution as it involves calling &lt;br/&gt;
HttpConnection.isOpen(), but I think it&amp;#39;s the only way to be sure that we get rid of connections that are &lt;br/&gt;
not longer needed.  The only other possibility would be to disable staleConnectionChecking on the &lt;br/&gt;
connections or to add a isClosed() method to HttpConnection that does not involve isStale().&lt;br/&gt;
&lt;br/&gt;
This patch does not include any connection statistics.&lt;br/&gt;
&lt;br/&gt;
Please let me know what you think.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381711" author="olegk" created="Fri, 4 Jun 2004 20:58:06 +0100"  >Mike,&lt;br/&gt;
I never liked the fact that connection open check was coupled with the stale&lt;br/&gt;
connection check. Now I like it even less. It&amp;#39;s kind of wasteful to perform a&lt;br/&gt;
rather expensive stale connection check on a connection, which is about to be&lt;br/&gt;
dropped. What do you think about decoupling these two tests in HttpClient 3.0?&lt;br/&gt;
&lt;br/&gt;
Otherwise the patch looks good&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381712" author="becke@u.washington.edu" created="Sat, 5 Jun 2004 09:03:41 +0100"  >Yes, agreed.  The coupling of isOpen() and isStale() definitely causes some issues.  I will try to clean this &lt;br/&gt;
up without breaking anything.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381713" author="becke@u.washington.edu" created="Sat, 5 Jun 2004 09:53:46 +0100"  >Created an attachment (id=11769)&lt;br/&gt;
patch 2&lt;br/&gt;
</comment>
                    <comment id="12381714" author="becke@u.washington.edu" created="Sat, 5 Jun 2004 09:55:09 +0100"  >This one doesn&amp;#39;t fix the problems with isOpen(), but it adds a couple of new options that get around it.  &lt;br/&gt;
Let me know what you think.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381715" author="olegk" created="Sat, 5 Jun 2004 21:46:51 +0100"  >I can&amp;#39;t say I like it but I live with this solution. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381716" author="eric@tibco.com" created="Mon, 7 Jun 2004 22:24:30 +0100"  >Don&amp;#39;t know whether it matters to much, but if I read it correctly, it is&lt;br/&gt;
possible that this will result in two calls to isStale() if checking is enabled.&lt;br/&gt;
&amp;nbsp;I thought that some had experienced isStale() as slow, so adding a second call&lt;br/&gt;
seems like a bad idea.</comment>
                    <comment id="12381717" author="becke@u.washington.edu" created="Tue, 8 Jun 2004 11:15:23 +0100"  >Hi Eric,&lt;br/&gt;
&lt;br/&gt;
Yes, the original version of the patch did indirectly call isStale().  You are correct that this is potentially &lt;br/&gt;
a slow operation.  The second patch should not have this problem though, as isClosed() is now being &lt;br/&gt;
used which does not make use of isStale().&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381718" author="becke@u.washington.edu" created="Tue, 8 Jun 2004 11:18:22 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
Agreed, this is not the nicest solution.  I would openly welcome any creative alternatives.  Unless &lt;br/&gt;
something nicer comes up, I will apply this patch tomorrow night.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381719" author="olegk" created="Tue, 8 Jun 2004 16:16:26 +0100"  >Mike,&lt;br/&gt;
&lt;br/&gt;
Having HttpConnection#isOpen and HttpConnection#isClosed methods is awfully&lt;br/&gt;
confusing. What are reasons for having to call isStale from isOpen? I personally&lt;br/&gt;
see no sense in performing stale check in the isOpen method. As a consumer of&lt;br/&gt;
that method I do not give a damn whether the connection is stale or not. All I&lt;br/&gt;
want to know whether the connection is considered open and whether HttpClient&lt;br/&gt;
should attempt to automatically recover in case of connection failure. That&amp;#39;s&lt;br/&gt;
it. What comfort to me is the fact that the connection is open and valid at the&lt;br/&gt;
time I call isOpen when it can still go stale by the time HTTP method executes?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381720" author="rolweber@de.ibm.com" created="Tue, 8 Jun 2004 17:22:32 +0100"  >Without digging into the source code, I wonder whether this is the time&lt;br/&gt;
to define an enumeration class ConnectionStatus with possible values:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;OPEN_FOR_SURE OPEN_OR_STALE STALE CLOSED IN_USE...&lt;br/&gt;
and a single query method Connection.getStatus(boolean checkForStale)?&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12381721" author="becke@u.washington.edu" created="Tue, 8 Jun 2004 20:33:58 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
The original purpose was to ensure a connection is open before writing, since stale connections are &lt;br/&gt;
essentially closed.  We ran into a number of problems with connection reliability, particularly in the case &lt;br/&gt;
of post methods which cannot be retried (BUG #19063).&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381722" author="becke@u.washington.edu" created="Tue, 8 Jun 2004 20:36:52 +0100"  >Hi Roland,&lt;br/&gt;
&lt;br/&gt;
Yes, I like that.  It would give us some more flexibility and it avoids direct confusion with isOpen().   I&amp;#39;ll &lt;br/&gt;
give it a try tonight.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381723" author="olegk" created="Tue, 8 Jun 2004 20:43:17 +0100"  >Mike,&lt;br/&gt;
I remember that. I am not questioning the rationale of stale check. The question&lt;br/&gt;
is if there&amp;#39;s any good reason for isOpen to call isStale?&lt;br/&gt;
&lt;br/&gt;
Roland,&lt;br/&gt;
I see one problem with this approach. In HTTP there&amp;#39;s no such thing as&lt;br/&gt;
OPEN_FOR_SURE. A perfectly valid connection at the time of getStatus call may go&lt;br/&gt;
stale by the time HttpClient is actually ready to do the writing on that connection&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381724" author="olegk" created="Tue, 8 Jun 2004 20:53:58 +0100"  >Created an attachment (id=11788)&lt;br/&gt;
Patch 3&lt;br/&gt;
</comment>
                    <comment id="12381725" author="olegk" created="Tue, 8 Jun 2004 20:54:33 +0100"  >Well, how about that?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381726" author="rolweber@de.ibm.com" created="Tue, 8 Jun 2004 20:55:29 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
I originally had plain OPEN in the list, but wanted to emphasize&lt;br/&gt;
the difference between OPEN and OPEN_OR_STALE. You could rename&lt;br/&gt;
it to STILL_CONSIDERED_OPEN_AFTER_PERFORMING_A_STALE_CHECK ;-)&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12381727" author="becke@u.washington.edu" created="Tue, 8 Jun 2004 21:07:46 +0100"  >Yes, that certainly clears things up.  The only issue, which I guess is actually&lt;br/&gt;
not that important, is the changing meaning of isOpen().  I was initially trying&lt;br/&gt;
to avoid changing how it operated, but I guess it may not be worth it given that&lt;br/&gt;
HttpClient users really shouldn&amp;#39;t be using HttpConnections directly anyway.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381728" author="becke@u.washington.edu" created="Fri, 25 Jun 2004 05:48:25 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I think this one is ready to be applied.  Do you want to take care of it or should I?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12381729" author="olegk" created="Fri, 25 Jun 2004 05:57:26 +0100"  >Mike, it&amp;#39;s been all your work. Go ahead, commit it. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12381730" author="becke@u.washington.edu" created="Fri, 25 Jun 2004 11:36:11 +0100"  >Patch applied to HEAD.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                </comments>
                    <attachments>
                    <attachment id="12327111" name="ASF.LICENSE.NOT.GRANTED--connmngmt2.patch" size="14206" author="olegk" created="Tue, 8 Jun 2004 20:53:58 +0100" />
                    <attachment id="12327110" name="ASF.LICENSE.NOT.GRANTED--deleteConnections.patch" size="14094" author="becke@u.washington.edu" created="Sat, 5 Jun 2004 09:53:46 +0100" />
                    <attachment id="12327109" name="ASF.LICENSE.NOT.GRANTED--deleteConnections.patch" size="9439" author="becke@u.washington.edu" created="Fri, 4 Jun 2004 09:48:13 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>29383</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 4 Jun 2004 19:58:06 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133396</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47258</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>