<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:15:21 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-261/HTTPCLIENT-261.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-261] infinite loop on 302 redirect with different host in Location: header</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-261</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Using the CVS version - 2.1 rc I think.&lt;br/&gt;
&lt;br/&gt;
Trying to get the url contents for a url with followRedirects specified and &lt;br/&gt;
StrictMode off and I get a 302 redirect to a different url with a different &lt;br/&gt;
host in the Location header causes it to go into an infinite loop (mercifully &lt;br/&gt;
aborting at 100 redirects).  An example offending url: &lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://www.snowcrest.net/mice/mice.htm&quot;&gt;http://www.snowcrest.net/mice/mice.htm&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
The problem lies in HttpMethodBase.java version 1.177 at line 1225.  It does &lt;br/&gt;
the following:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (getRequestHeader(&amp;quot;host&amp;quot;) != null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LOG.debug(&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;Request to add Host header ignored: header already added&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
and there is already the Host header from the previous url request so it &lt;br/&gt;
endlessly loops until it aborts at the max redirects (default is 100 I guess).  &lt;br/&gt;
I commented this out and it worked fine.</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: All</environment>
            <key id="12333820">HTTPCLIENT-261</key>
            <summary>infinite loop on 302 redirect with different host in Location: header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="brentbeardsley@yahoo.com">Brent Beardsley</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Aug 2003 02:12:44 +0100</created>
                <updated>Wed, 16 Feb 2011 20:43:46 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:31 +0100</resolved>
                            <version>2.0 Milestone 2</version>
                                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380902" author="brentbeardsley@yahoo.com" created="Sat, 23 Aug 2003 02:20:57 +0100"  >2.0 rc 2 actually</comment>
                    <comment id="12380903" author="becke@u.washington.edu" created="Sat, 23 Aug 2003 23:10:50 +0100"  >Hi Brent,&lt;br/&gt;
&lt;br/&gt;
I tried doing a GET on &amp;lt;&lt;a href=&quot;http://www.snowcrest.net/mice/mice.htm&quot;&gt;http://www.snowcrest.net/mice/mice.htm&lt;/a&gt;&amp;gt; using the latest from CVS  &lt;br/&gt;
HTTPCLIENT_2_0_BRANCH(2.0 pre-rc2) and CVS HEAD(2.1 pre-alpha) and got expected behavior.  &lt;br/&gt;
The 2.0 code did not handle the redirect as it is to another host (see &amp;lt;&lt;a href=&quot;http://jakarta.apache.org/&quot;&gt;http://jakarta.apache.org/&lt;/a&gt;&lt;br/&gt;
commons/httpclient/redirects.html&amp;gt;).  The 2.1 code handled the redirect correctly.  Please verify &lt;br/&gt;
which version of HttpClient you are using.  If the problem persists please post sample code and a &lt;br/&gt;
wire log &amp;lt;&lt;a href=&quot;http://jakarta.apache.org/commons/httpclient/logging.html&quot;&gt;http://jakarta.apache.org/commons/httpclient/logging.html&lt;/a&gt;&amp;gt;.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380904" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 02:28:41 +0100"  >Created an attachment (id=8035)&lt;br/&gt;
test client java app demonstrating infinite loop&lt;br/&gt;
</comment>
                    <comment id="12380905" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 02:31:25 +0100"  >Created an attachment (id=8036)&lt;br/&gt;
infinte loop wire log from the test app&lt;br/&gt;
</comment>
                    <comment id="12380906" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 02:34:11 +0100"  >In the wire log it says 2.1m1 for the version - I just grabbed the latest from &lt;br/&gt;
CVS and tried it and it still does the infinite loop.</comment>
                    <comment id="12380907" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 06:55:02 +0100"  >Hi Brent,&lt;br/&gt;
&lt;br/&gt;
Your example code looks quite like the code I tried.  Just to be sure though I tried yours.  My &lt;br/&gt;
results were the same.  All seems to work for me.  Please see my wire log attached below.  &lt;br/&gt;
&lt;br/&gt;
From looking for your wire log it seems strange that the server is redirecting to the same page that &lt;br/&gt;
is being requested.  Are you accessing the internet directly or do you have you have a proxy?&lt;br/&gt;
&lt;br/&gt;
Anyone else have some ideas?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380908" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 06:55:55 +0100"  >Created an attachment (id=8044)&lt;br/&gt;
successful wire log&lt;br/&gt;
</comment>
                    <comment id="12380909" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 07:19:20 +0100"  >Hi Mike,&lt;br/&gt;
&lt;br/&gt;
Your log still contains the same problem as mine:&lt;br/&gt;
&lt;br/&gt;
HttpMethodBase - -Request to add Host header ignored: header already added&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;m using WinProxy and I can&amp;#39;t bypass it and I don&amp;#39;t have an environment setup &lt;br/&gt;
on the firewall box to test it.&lt;br/&gt;
&lt;br/&gt;
Is there a problem doing what I suggested in my initial report - commenting out &lt;br/&gt;
the getRequestHeader....return?  If I comment that out it works as it should.&lt;br/&gt;
&lt;br/&gt;
Brent</comment>
                    <comment id="12380910" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 07:22:48 +0100"  >Hi Mike,&lt;br/&gt;
&lt;br/&gt;
Should also add that in your log as well it does not actually switch hosts as &lt;br/&gt;
it should because of that getResponseHeader....return.  Notice that Host &lt;br/&gt;
request header is the same &amp;quot;&lt;a href=&quot;http://www.snowcrest.net&quot;&gt;www.snowcrest.net&lt;/a&gt;&amp;quot; and it should have switched to &lt;br/&gt;
users.snowcrest.net&lt;br/&gt;
&lt;br/&gt;
Brent</comment>
                    <comment id="12380911" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 07:51:20 +0100"  >Hi Brent,&lt;br/&gt;
&lt;br/&gt;
Sorry for being a little dense.  You are quite right.  I will post a patch+test in a few minutes.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380912" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 10:02:17 +0100"  >Created an attachment (id=8046)&lt;br/&gt;
fix + patch&lt;br/&gt;
</comment>
                    <comment id="12380913" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 10:03:47 +0100"  >Attached is a fix for this plus a test case.  I will apply the patch to HEAD tomorrow unless there are &lt;br/&gt;
objections.  Thank you for your patience Brent.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380914" author="becke@u.washington.edu" created="Thu, 4 Sep 2003 10:15:05 +0100"  >Patch applied.</comment>
                </comments>
                    <attachments>
                    <attachment id="12326954" name="ASF.LICENSE.NOT.GRANTED--hostHeader.patch" size="4950" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 10:02:17 +0100" />
                    <attachment id="12326951" name="ASF.LICENSE.NOT.GRANTED--HttpClientInfiniteLoop.java" size="1558" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 02:28:41 +0100" />
                    <attachment id="12326953" name="ASF.LICENSE.NOT.GRANTED--infiniteLoop.log" size="20930" author="becke@u.washington.edu" created="Wed, 3 Sep 2003 06:55:55 +0100" />
                    <attachment id="12326952" name="ASF.LICENSE.NOT.GRANTED--infiteloopwirelog.txt" size="330472" author="brentbeardsley@yahoo.com" created="Wed, 3 Sep 2003 02:31:25 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>22667</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sat, 23 Aug 2003 22:10:50 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133312</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189215</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>