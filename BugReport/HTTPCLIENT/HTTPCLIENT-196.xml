<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:14:38 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-196/HTTPCLIENT-196.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-196] httpClient failed to reconnect after keep-alive connection timed out</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-196</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Description:&lt;br/&gt;
&lt;br/&gt;
When using httpClient with https tunnelling througha proxy server, after keep-&lt;br/&gt;
alive connection timed out on server side.  The httpClient code was unable to &lt;br/&gt;
establish the connection again.&lt;br/&gt;
&lt;br/&gt;
Cause:&lt;br/&gt;
&lt;br/&gt;
The HttpMethodBase.processRequest&amp;#39;s retry loop retries the connection without &lt;br/&gt;
going through the &amp;quot;CONNECT&amp;quot; request to the proxy server.  Our proxy server &lt;br/&gt;
returns 407 error code.  In case of tunnelling connection, proper reconnect &lt;br/&gt;
should be done by first doing the &amp;quot;CONNECT&amp;quot; sequence to get authenticated &lt;br/&gt;
throught the proxy.&lt;br/&gt;
&lt;br/&gt;
Temp fix and Work around:&lt;br/&gt;
&lt;br/&gt;
We implemented some work around to do the retry from the application layer.  In &lt;br/&gt;
order to detect the situation, we have to rely on the error message contained &lt;br/&gt;
in the HttpRecoverableException.  We are checking the text &amp;quot;Connection aborted &lt;br/&gt;
by peer: socket write error&amp;quot;.  We also have to modify the HttpMethodBase code &lt;br/&gt;
to throw the HttpRecoverableException out to the application.</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: PC</environment>
            <key id="12333755">HTTPCLIENT-196</key>
            <summary>httpClient failed to reconnect after keep-alive connection timed out</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="bin.chen@sabre-holdings.com">Bin Chen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2003 04:01:41 +0100</created>
                <updated>Wed, 16 Feb 2011 20:45:04 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:20 +0100</resolved>
                            <version>2.0 Beta 1</version>
                                <fixVersion>2.0 Beta 2</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380254" author="bin.chen@sabre-holdings.com" created="Wed, 23 Apr 2003 04:05:28 +0100"  >Created an attachment (id=5963)&lt;br/&gt;
Temp fix for checking &amp;quot;Connection aborted by peer: socket write error&amp;quot; and throw exception&lt;br/&gt;
</comment>
                    <comment id="12380255" author="becke@u.washington.edu" created="Wed, 23 Apr 2003 04:43:32 +0100"  >HttpClient does not support reusing tunneled HTTPS connections.  This is a known&lt;br/&gt;
problem.  This problem was &amp;quot;fixed&amp;quot; post alpha-3 so you will need to get a&lt;br/&gt;
nightly build for this one.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380256" author="bin.chen@sabre-holdings.com" created="Tue, 29 Apr 2003 01:15:53 +0100"  >Mike,&lt;br/&gt;
&lt;br/&gt;
I have the latest code from nightly build now.  It looks like that the &lt;br/&gt;
tunnelled https connection is now being closed each time.  We definitely need &lt;br/&gt;
keep-alive in our application (connecting each time would be too slow for our &lt;br/&gt;
app).  Will the final release of httpClient support tunnelling https connection?</comment>
                    <comment id="12380257" author="olegk" created="Tue, 29 Apr 2003 01:41:39 +0100"  >Bin, the wire log would be very helpful&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12380258" author="bin.chen@sabre-holdings.com" created="Tue, 29 Apr 2003 01:54:15 +0100"  >Created an attachment (id=6055)&lt;br/&gt;
wire log showing each POST follows CONNECT&lt;br/&gt;
</comment>
                    <comment id="12380259" author="bin.chen@sabre-holdings.com" created="Tue, 29 Apr 2003 01:56:23 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
The wire log was chopped off from the top.  But it has enough transactions in &lt;br/&gt;
it and it shows that each time, the complete &amp;quot;CONNECT&amp;quot;/&amp;quot;POST&amp;quot; sequence is &lt;br/&gt;
performed.  That is due to the httpClient code decides to close the tunnelled &lt;br/&gt;
connection each time.</comment>
                    <comment id="12380260" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 02:00:11 +0100"  >Yes, as mentioned in some previous emails HttpClient does not support tunneled&lt;br/&gt;
HTTPS presistence.  This is due to a design flaw that keeps HttpClient from&lt;br/&gt;
correctly re-establishing a connection after timeout.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380261" author="olegk" created="Tue, 29 Apr 2003 02:07:54 +0100"  >Mike,&lt;br/&gt;
This is not about connection timeout. According to the log tunneled connection&lt;br/&gt;
gets closed after each request/response exchange. I am currently trying to&lt;br/&gt;
reproduce the problem on my development system.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380262" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 02:28:10 +0100"  >Tunneled HTTPS connections are setup so that they only get used once.  This&lt;br/&gt;
appears to be what is happening.  After the NTLM request/response exchange the&lt;br/&gt;
method is executed and the response is read.  At this point&lt;br/&gt;
HttpConnection.releaseConnection() is called and it explicitly closes itself&lt;br/&gt;
because is tunneled HTTPS.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380263" author="olegk" created="Tue, 29 Apr 2003 02:39:21 +0100"  >I thought the only problem was that HttpClient due to the current design could&lt;br/&gt;
not properly retry requests over tunneled connection (as CONNECT can&amp;#39;t be&lt;br/&gt;
cleanly re-issued). But what&amp;#39;s the reason for always closing tunneled connections?&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12380264" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 03:01:17 +0100"  >This purpose was to &amp;quot;fix&amp;quot; this problem by not allowing these connections to be&lt;br/&gt;
reused.  We decided &amp;quot;I believe in the IRC meeting&amp;quot; that this was the way to go.&lt;br/&gt;
&amp;nbsp;The reason being that since tunneled+HTTPS connections cannot be reused&lt;br/&gt;
reliably they should not be reused.  &lt;br/&gt;
&lt;br/&gt;
The main problem case WAS when a method got a previously used connection (that&lt;br/&gt;
had timed out) and tried to use it.  This would cause the method to fail, with&lt;br/&gt;
the only feasable solution being to retry in HttpClient.  Since we were waiting&lt;br/&gt;
to push the retry logic into HttpClient this was also put off.  Thus the fairly&lt;br/&gt;
lousy solution.&lt;br/&gt;
&lt;br/&gt;
The reason I say &amp;quot;WAS&amp;quot; above is that I think we can fix this now.  I think, now&lt;br/&gt;
that we have the ability to test for stale connections, this can be handled by&lt;br/&gt;
HttpClient.  HttpClient is currently calling HttpConnection.isOpen() in&lt;br/&gt;
execute(), which should preemptively take care of stale tunneled+HTTPS&lt;br/&gt;
connections.  I believe that if we remove the force close in&lt;br/&gt;
HttpConnection.releaseConnection() we may have a viable solution.  At least for&lt;br/&gt;
people who are using HttpClient (not the connections directly) and also have JRE&lt;br/&gt;
1.4 or better.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380265" author="olegk" created="Tue, 29 Apr 2003 03:21:47 +0100"  >Sorry, Mike. You are right. I guess I am getting old. &lt;br/&gt;
&lt;br/&gt;
It&amp;#39;s your call if it is safe to relax somewhat the restriction on tunnelled&lt;br/&gt;
connection pooling.&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
PS: We HAVE GOT to move past 2.0 as soon as possible.</comment>
                    <comment id="12380266" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 03:41:48 +0100"  >No worries.  Things have been getting pretty complicated lately.  I am having&lt;br/&gt;
trouble keeping track of all of the various HttpClient nuances.  &lt;br/&gt;
&lt;br/&gt;
We definitely need to push on past beta-1 very soon.  This interim period has&lt;br/&gt;
been taking way too long.&lt;br/&gt;
&lt;br/&gt;
I will make a few tests without the force close just to make sure that it works.&lt;br/&gt;
&amp;nbsp;My only worry is for the people who are using connections directly.  It will&lt;br/&gt;
work for them, assuming that isOpen() is being called before the method is executed.&lt;br/&gt;
&lt;br/&gt;
Laura, do you have any thoughts?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380267" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 04:01:26 +0100"  >Created an attachment (id=6061)&lt;br/&gt;
remove force connection close patch&lt;br/&gt;
</comment>
                    <comment id="12380268" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 04:09:47 +0100"  >The above patch removes the force close in HttpConnection.releaseConnection()&lt;br/&gt;
when using tunneled+HTTPS connections.  As expected, this correctly allows&lt;br/&gt;
persistent connections when using JRE 1.4 or later.  As previously discovered&lt;br/&gt;
pre 1.4 implementations of JSSE do not correctly handle the isStale() read test.&lt;br/&gt;
&lt;br/&gt;
Bin, I don&amp;#39;t know how useful this will be for you as it appears you are using&lt;br/&gt;
1.3.1.  Please give it a try though, just to be sure.&lt;br/&gt;
&lt;br/&gt;
Laura, I&amp;#39;m singling you out just because I know your app uses connections&lt;br/&gt;
directly, I hope you don&amp;#39;t mind:)  I would appreciate any feedback you might&lt;br/&gt;
have, assuming that you are using tunneled HTTPS.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380269" author="olegk" created="Tue, 29 Apr 2003 04:18:52 +0100"  >Mike,&lt;br/&gt;
I tested the patch a bit. It works fine with JDK 1.4 for me (and does not with&lt;br/&gt;
1.2 which is expected). Once we get Laura&amp;#39;s consent I&amp;#39;d call it the end of the&lt;br/&gt;
story. This is as good as it gets for 2.0 release in my opinion.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380270" author="bin.chen@sabre-holdings.com" created="Wed, 30 Apr 2003 21:48:10 +0100"  >Releated issue with MethodRetryHandler:&lt;br/&gt;
&lt;br/&gt;
We are trying to use the MethodRetryHandler to control when the httpClient &lt;br/&gt;
should retry after HttpRecoverableException.  We run into two issues:&lt;br/&gt;
1. One of our criteria of retrying depends on if the connection is tunnelled.  &lt;br/&gt;
We will need to have access to the HttpConnection object to know that (using &lt;br/&gt;
isSecure/isProxied combination).  Are there any other ways to get that &lt;br/&gt;
information from HttpMethod?  If not, can httpClient code pass the data to &lt;br/&gt;
retryMethod?&lt;br/&gt;
2. It would be mroe convenient to have a base class implementing the &lt;br/&gt;
MethodRetryHandler so app can call the super for cases it doe snto want to &lt;br/&gt;
override.</comment>
                    <comment id="12380271" author="becke@u.washington.edu" created="Wed, 30 Apr 2003 22:46:13 +0100"  >Sounds reasonable.  I will add this tonight.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380272" author="becke@u.washington.edu" created="Thu, 1 May 2003 08:03:13 +0100"  >Created an attachment (id=6113)&lt;br/&gt;
retry handler patch&lt;br/&gt;
</comment>
                    <comment id="12380273" author="becke@u.washington.edu" created="Thu, 1 May 2003 08:06:02 +0100"  >This patch extracts the default retry handler to a new class and adds the&lt;br/&gt;
connection as a new parameter.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380274" author="olegk" created="Thu, 1 May 2003 20:20:52 +0100"  >Looks good to me.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380275" author="becke@u.washington.edu" created="Thu, 1 May 2003 20:30:08 +0100"  >Patch applied.</comment>
                </comments>
                    <attachments>
                    <attachment id="12326828" name="ASF.LICENSE.NOT.GRANTED--closeConnection.patch" size="1200" author="becke@u.washington.edu" created="Tue, 29 Apr 2003 04:01:26 +0100" />
                    <attachment id="12326826" name="ASF.LICENSE.NOT.GRANTED--HttpMethodBase_processRequest_keep-alive-reconnect.java" size="2413" author="bin.chen@sabre-holdings.com" created="Wed, 23 Apr 2003 04:05:28 +0100" />
                    <attachment id="12326829" name="ASF.LICENSE.NOT.GRANTED--retry.patch" size="8508" author="becke@u.washington.edu" created="Thu, 1 May 2003 08:03:13 +0100" />
                    <attachment id="12326827" name="ASF.LICENSE.NOT.GRANTED--test12.txt" size="108190" author="bin.chen@sabre-holdings.com" created="Tue, 29 Apr 2003 01:54:15 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>4.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>19230</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 23 Apr 2003 03:43:32 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133250</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>188727</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>