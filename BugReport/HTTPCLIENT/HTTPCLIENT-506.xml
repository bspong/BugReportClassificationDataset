<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:18:11 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-506/HTTPCLIENT-506.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-506] Digest auth uses wrong uri in proxy authentication</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-506</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>I&amp;#39;m having a problem getting httpclient-rc1 to authenticate using&lt;br/&gt;
digest to our IAS server.  I&amp;#39;ve tried upgrading to rc3 without any&lt;br/&gt;
effect.  I also got our IT guys to upgrade IAS without luck.  I was&lt;br/&gt;
also able to have the GET method work under IAS and CONNECT to work&lt;br/&gt;
with a couple other proxy servers.  After examining ethereal logs for&lt;br/&gt;
my (commons) code and firefox to the same URLs I noticed that the&lt;br/&gt;
value for the &amp;quot;uri&amp;quot; setting in the &amp;quot;Proxy-Authorization&amp;quot; header was&lt;br/&gt;
the only significant difference.  After looking at RFC 2617 I noticed&lt;br/&gt;
that in section 3.2.2 (The Authorization Request Header) it states:&lt;br/&gt;
&lt;br/&gt;
digest-uri&lt;br/&gt;
The URI from Request-URI of the Request-Line; duplicated here because&lt;br/&gt;
proxies are allowed to change the Request-Line in transit.&lt;br/&gt;
&lt;br/&gt;
A re-examination of the headers showed that firefox was matching the Request-URI&lt;br/&gt;
with the digest-uri but that httpclient was not.  I reproduced partial headers&lt;br/&gt;
below.  I tried modifying the RC3 source to produce a hard-coded value for &amp;quot;uri&amp;quot;&lt;br/&gt;
and demonstrated that it would successfully authenticate to that URI.  I also&lt;br/&gt;
checked that authentication would fail to any other URI and it did.&lt;br/&gt;
&lt;br/&gt;
partial httpclient header (fails with 407):&lt;br/&gt;
CONNECT gmail.google.com:443 HTTP/1.1&lt;br/&gt;
Proxy-Authorization: Digest username=&amp;quot;proxytest&amp;quot;, realm=&amp;quot;Digest&amp;quot;,&lt;br/&gt;
nonce=&amp;quot;503902c343c8c501057a85cea6bad2734378fb44b4cbd1970bf320637871dae85373082cf70ac254&amp;quot;,&lt;br/&gt;
uri=&amp;quot;/&amp;quot;, response=&amp;quot;7717d0738332a3d8e83e9102b5ead6b9&amp;quot;, qop=&amp;quot;auth&amp;quot;, nc=00000001,&lt;br/&gt;
cnonce=&amp;quot;583aa0469b31290dc2acd7ec6cfc98f1&amp;quot;, algorithm=&amp;quot;MD5-sess&amp;quot;,&lt;br/&gt;
opaque=&amp;quot;bb319760fce84856e5648d3536502d81&amp;quot;&lt;br/&gt;
&lt;br/&gt;
partial firefox header (succeeds with 200):&lt;br/&gt;
CONNECT mail1.combrio.local:443 HTTP/1.1&lt;br/&gt;
Proxy-Authorization: Digest username=&amp;quot;proxytest&amp;quot;, realm=&amp;quot;Digest&amp;quot;,&lt;br/&gt;
nonce=&amp;quot;0e61fe645ec8c5015aa3afe8cfe5219488ed473e277a8cddf8225ad66e74fd214f97d9d96ac99991&amp;quot;,&lt;br/&gt;
uri=&amp;quot;mail1.combrio.local:443&amp;quot;, algorithm=MD5-sess,&lt;br/&gt;
response=&amp;quot;bfac109287273e867531170475172ccf&amp;quot;,&lt;br/&gt;
opaque=&amp;quot;70cb2a1533b85882d0f1aa1e2ad1fbae&amp;quot;, qop=auth, nc=00000001,&lt;br/&gt;
cnonce=&amp;quot;b41aecd6e527e774&amp;quot;</description>
                <environment>Operating System: Linux&lt;br/&gt;
Platform: PC</environment>
            <key id="12334065">HTTPCLIENT-506</key>
            <summary>Digest auth uses wrong uri in proxy authentication</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="ender3rd@gmail.com">Owen Smith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Oct 2005 06:49:07 +0100</created>
                <updated>Wed, 16 Feb 2011 20:45:00 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:08 +0100</resolved>
                            <version>3.0 RC1</version>
                                <fixVersion>3.1 Alpha 1</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382668" author="oglueck" created="Wed, 5 Oct 2005 06:53:56 +0100"  >Is probably only an issue with proxy auth. Have to check if we can fix this in&lt;br/&gt;
3.0 without modifying the API.</comment>
                    <comment id="12382669" author="olegk" created="Wed, 5 Oct 2005 07:06:58 +0100"  >(In reply to comment #1)&lt;br/&gt;
&amp;gt; Is probably only an issue with proxy auth. Have to check if we can fix this in&lt;br/&gt;
&amp;gt; 3.0 without modifying the API.&lt;br/&gt;
&lt;br/&gt;
I am afraid not. At the moment there&amp;#39;s no way of telling for classes that&lt;br/&gt;
implement the AuthScheme interface whether the request is to be sent via a proxy&lt;br/&gt;
or not.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382670" author="olegk" created="Wed, 5 Oct 2005 08:07:39 +0100"  >Owen,&lt;br/&gt;
Can you also capture the content of the Digest response generated by Firefox for&lt;br/&gt;
non-SSL (non-tunneled) connections ? I wonder if the digest-uri value would be&lt;br/&gt;
something like &amp;quot;&lt;a href=&quot;http://www.yahoo.com:80/stuff&quot;&gt;http://www.yahoo.com:80/stuff&lt;/a&gt;&amp;quot; or like &amp;quot;/stuff&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Meanwhile, we&amp;#39;ll be thinking of a workaround for the 3.0 release that does not&lt;br/&gt;
require API changes. The proper fix for this problem most likely will have to&lt;br/&gt;
wait until 3.1 or even 4.0&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382671" author="ender3rd@gmail.com" created="Wed, 5 Oct 2005 08:48:41 +0100"  >(In reply to comment #3)&lt;br/&gt;
&amp;gt; Owen,&lt;br/&gt;
&amp;gt; Can you also capture the content of the Digest response generated by Firefox for&lt;br/&gt;
&amp;gt; non-SSL (non-tunneled) connections ? I wonder if the digest-uri value would be&lt;br/&gt;
&amp;gt; something like &amp;quot;&lt;a href=&quot;http://www.yahoo.com:80/stuff&quot;&gt;http://www.yahoo.com:80/stuff&lt;/a&gt;&amp;quot; or like &amp;quot;/stuff&amp;quot;&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Meanwhile, we&amp;#39;ll be thinking of a workaround for the 3.0 release that does not&lt;br/&gt;
&amp;gt; require API changes. The proper fix for this problem most likely will have to&lt;br/&gt;
&amp;gt; wait until 3.1 or even 4.0&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Oleg&lt;br/&gt;
&lt;br/&gt;
Oleg,&lt;br/&gt;
See below for similar headers for a non-SSL connection.  It&amp;#39;s like &amp;quot;/stuff&amp;quot;&lt;br/&gt;
though I&amp;#39;m not sure if that is strictly RFC compliant or not.  Tommorrow I&amp;#39;ll&lt;br/&gt;
try a few variations and see if anything interesting happens.&lt;br/&gt;
&lt;br/&gt;
from firefox:&lt;br/&gt;
GET &lt;a href=&quot;http://www.google.com/search?q=combrio&quot;&gt;http://www.google.com/search?q=combrio&lt;/a&gt; HTTP/1.1&lt;br/&gt;
Proxy-Authorization: Digest username=&amp;quot;proxytest&amp;quot;, realm=&amp;quot;Digest&amp;quot;,&lt;br/&gt;
nonce=&amp;quot;9ead1d6748c8c5015ad4977b92780d2d2bf1ce754d79f240533feaf1a90b59badf7027bba74334a7&amp;quot;,&lt;br/&gt;
uri=&amp;quot;/search?q=combrio&amp;quot;, algorithm=MD5-sess,&lt;br/&gt;
response=&amp;quot;42ad6a4571edb21780c26827a0c3910e&amp;quot;,&lt;br/&gt;
opaque=&amp;quot;9c55241868ffb3f34487f1a72519110a&amp;quot;, qop=auth, nc=00000001,&lt;br/&gt;
cnonce=&amp;quot;2e4b57bad694b520&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Owen</comment>
                    <comment id="12382672" author="olegk" created="Wed, 5 Oct 2005 19:25:46 +0100"  >(In reply to comment #4)&lt;br/&gt;
...&lt;br/&gt;
&amp;gt; Oleg,&lt;br/&gt;
&amp;gt; See below for similar headers for a non-SSL connection.  It&amp;#39;s like &amp;quot;/stuff&amp;quot;&lt;br/&gt;
&amp;gt; though I&amp;#39;m not sure if that is strictly RFC compliant or not.  Tommorrow I&amp;#39;ll&lt;br/&gt;
&amp;gt; try a few variations and see if anything interesting happens.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&lt;br/&gt;
So, the situation is far from being simple. There&amp;#39;s no consistency in how&lt;br/&gt;
various HTTP agents and servers handle the digest-uri. I re-read the RFC and&lt;br/&gt;
this did not make things any clearer for me. There are ways of seeing and not&lt;br/&gt;
seeing, depending on what one wants or does not want to see. Hence, the&lt;br/&gt;
inconsistency in implementations&lt;br/&gt;
&lt;br/&gt;
I suggest the following:&lt;br/&gt;
(1) For release 3.0 we basically do nothing because we simply can&amp;#39;t work around&lt;br/&gt;
the problem without unfreezing the API&lt;br/&gt;
(2) For release 3.1 we can fix the problem for CONNECT methods. This can be done&lt;br/&gt;
without breaking the 3.x API comatibility&lt;br/&gt;
(3) We revisit the problem in the course of 4.0 development and try to come up&lt;br/&gt;
with a proper fix for the problem&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382673" author="oglueck" created="Wed, 5 Oct 2005 19:52:20 +0100"  >If anybody wants to come up with a patch meanwhile, please do so. Even though it&lt;br/&gt;
will not be checked in before 3.1, it would provide Owen with a manual solution&lt;br/&gt;
if API compatibility is not an issue.</comment>
                    <comment id="12382674" author="ender3rd@gmail.com" created="Tue, 11 Oct 2005 02:46:48 +0100"  >Created an attachment (id=16638)&lt;br/&gt;
Hackish patch&lt;br/&gt;
&lt;br/&gt;
I managed to generate this patch and tested it against both IAS and another&lt;br/&gt;
proxy server.  It seems to fix this problem without breaking other things.  I&lt;br/&gt;
know that this isn&amp;#39;t a very good solution and if someone with a better&lt;br/&gt;
knowledge of the internals could figure out a way to clean it up that would be&lt;br/&gt;
great.</comment>
                    <comment id="12382675" author="olegk" created="Tue, 11 Oct 2005 04:11:15 +0100"  >Created an attachment (id=16639)&lt;br/&gt;
Hackish patch (a slightly different take)&lt;br/&gt;
&lt;br/&gt;
This patch is still butt-ugly, but it leaves DigestAuthScheme virginally&lt;br/&gt;
ignorant of ConnectMethod, which is in my opinion slightly less hackish&lt;br/&gt;
&lt;br/&gt;
What do you think?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382676" author="ender3rd@gmail.com" created="Tue, 11 Oct 2005 05:22:16 +0100"  >I&amp;#39;ve tested in on my system and it appears to work.  I&amp;#39;d say that your fix is&lt;br/&gt;
definately less hackish than mine, probably the best that can be done for this&lt;br/&gt;
version of the API.  Thanks for the quick improvement.&lt;br/&gt;
&lt;br/&gt;
Owen&lt;br/&gt;
&lt;br/&gt;
(In reply to comment #8)&lt;br/&gt;
&amp;gt; Created an attachment (id=16639) [edit]&lt;br/&gt;
&amp;gt; Hackish patch (a slightly different take)&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; This patch is still butt-ugly, but it leaves DigestAuthScheme virginally&lt;br/&gt;
&amp;gt; ignorant of ConnectMethod, which is in my opinion slightly less hackish&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; What do you think?&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Oleg&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12382677" author="olegk" created="Tue, 11 Oct 2005 05:49:05 +0100"  >I agree this is most likely as good as it gets for 3.x API&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382678" author="olegk" created="Thu, 30 Mar 2006 19:32:39 +0100"  >Folks, any objections to committing this patch?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382679" author="oglueck" created="Thu, 30 Mar 2006 19:37:26 +0100"  >Fine with me.&lt;br/&gt;
Typo: in the deprecation warning there is a wrong reference to the c&amp;#39;tor (wrong&lt;br/&gt;
parameter type).</comment>
                    <comment id="12382680" author="olegk" created="Thu, 30 Mar 2006 20:11:27 +0100"  >Patch committed to SVN TRUNK (3.1 branch)&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327293" name="ASF.LICENSE.NOT.GRANTED--commons-httpclient.patch" size="2469" author="ender3rd@gmail.com" created="Tue, 11 Oct 2005 02:46:48 +0100" />
                    <attachment id="12327294" name="ASF.LICENSE.NOT.GRANTED--digest.patch" size="4408" author="olegk" created="Tue, 11 Oct 2005 04:11:15 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>36918</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 5 Oct 2005 05:53:56 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133553</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47093</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>