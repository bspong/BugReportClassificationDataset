<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:15:06 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-239/HTTPCLIENT-239.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-239] Redirect 302 to the same URL causes max redirects exception</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-239</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>I noticed that if the server returns a 302 without a URL in the link, the &lt;br/&gt;
HttpClient follows the empty URL up to the maximum times (100 by default).  &lt;br/&gt;
Instead it should check and if the URL is an empty string it shouldn&amp;#39;t try to &lt;br/&gt;
follow the redirect.&lt;br/&gt;
&lt;br/&gt;
12:18:17,430 [U:          ] [main                ] ERROR &lt;br/&gt;
HttpMethodBase               - Narrowly avoided an infinite loop in execute&lt;br/&gt;
12:18:17,430 [U:          ] [main                ] DEBUG &lt;br/&gt;
URLMonitor                   - Method.execute attempt 1 failed &lt;br/&gt;
&lt;a href=&quot;http://www.stagecoach.co.uk:&quot;&gt;http://www.stagecoach.co.uk:&lt;/a&gt; &lt;br/&gt;
org.apache.commons.httpclient.HttpRecoverableException: Maximum redirects (100) &lt;br/&gt;
exceeded&lt;br/&gt;
12:18:17,430 [U:          ] [main                ] DEBUG &lt;br/&gt;
URLMonitor                   - HttpRecoverableException &lt;br/&gt;
(&lt;a href=&quot;http://www.stagecoach.co.uk&quot;&gt;http://www.stagecoach.co.uk&lt;/a&gt;) : &lt;br/&gt;
org.apache.commons.httpclient.HttpRecoverableException: Maximum redirects (100) &lt;br/&gt;
exceeded&lt;br/&gt;
	at org.apache.commons.httpclient.HttpMethodBase.execute&lt;br/&gt;
(HttpMethodBase.java:1065)&lt;br/&gt;
	at com.verideon.veriguard.domain.URLMonitor.monitor(URLMonitor.java:189)&lt;br/&gt;
	at com.verideon.veriguard.domain.URLMonitor.monitor(URLMonitor.java:101)&lt;br/&gt;
	at com.verideon.veriguard.domain.TestURLMonitor.getPage&lt;br/&gt;
(TestURLMonitor.java:58)&lt;br/&gt;
	at com.verideon.veriguard.domain.TestURLMonitor.monitorURL&lt;br/&gt;
(TestURLMonitor.java:47)&lt;br/&gt;
	at com.verideon.veriguard.domain.TestURLMonitor.testMonitorURLStageCoach&lt;br/&gt;
(TestURLMonitor.java:138)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke&lt;br/&gt;
(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke&lt;br/&gt;
(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:324)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests&lt;br/&gt;
(RemoteTestRunner.java:392)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run&lt;br/&gt;
(RemoteTestRunner.java:276)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main&lt;br/&gt;
(RemoteTestRunner.java:167)&lt;br/&gt;
&lt;br/&gt;
Result with telnet:&lt;br/&gt;
&lt;br/&gt;
GET /&lt;br/&gt;
HTTP/1.1 302 Object moved&lt;br/&gt;
Server: Microsoft-IIS/5.0&lt;br/&gt;
Date: Tue, 01 Jul 2003 10:05:58 GMT&lt;br/&gt;
X-Powered-By: ASP.NET&lt;br/&gt;
Location: &lt;a href=&quot;http://www.stagecoach.co.uk&quot;&gt;http://www.stagecoach.co.uk&lt;/a&gt;&lt;br/&gt;
Connection: Keep-Alive&lt;br/&gt;
Content-Length: 121&lt;br/&gt;
Content-Type: text/html&lt;br/&gt;
Set-Cookie: ASPSESSIONIDCQCSRAAB=IFJJLEADOPDDNNGHLPFBIIIE; path=/&lt;br/&gt;
Cache-control: private&lt;br/&gt;
&lt;br/&gt;
&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Object moved&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Object Moved&amp;lt;/h1&amp;gt;This object may be found &amp;lt;a HREF=&amp;quot;&amp;quot;&amp;gt;here&amp;lt;/a&amp;gt;.&amp;lt;/body&amp;gt;&lt;br/&gt;
Connection closed by foreign host.</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: PC</environment>
            <key id="12333798">HTTPCLIENT-239</key>
            <summary>Redirect 302 to the same URL causes max redirects exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="michael@advweb.com">Michael Mattox</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Jul 2003 18:21:33 +0100</created>
                <updated>Wed, 16 Feb 2011 20:45:13 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:27 +0100</resolved>
                            <version>Snapshot</version>
                                <fixVersion>3.0 Final</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380711" author="olegk" created="Tue, 1 Jul 2003 20:29:34 +0100"  >Michael,&lt;br/&gt;
I can&amp;#39;t reproduce the problem with the current CVS snapshot. What version of&lt;br/&gt;
HttpClient are you using? Make sure it is at least beta-1. Complete wire log&lt;br/&gt;
would also help.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380712" author="becke@u.washington.edu" created="Tue, 1 Jul 2003 20:32:54 +0100"  >HttpClient does not look at the HTML content.  It uses the location header as per the RFC.  It seems &lt;br/&gt;
that this site redirects to itself:&lt;br/&gt;
&lt;br/&gt;
Location: &lt;a href=&quot;http://www.stagecoach.co.uk&quot;&gt;http://www.stagecoach.co.uk&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380713" author="michael@advweb.com" created="Tue, 1 Jul 2003 20:35:15 +0100"  >Ok, I was using the link in the HTML content.  Is it possible to have &lt;br/&gt;
httpclient not follow a redirect when the redirect is the same as the current &lt;br/&gt;
URL?  This would avoid the problem.&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12380714" author="olegk" created="Tue, 1 Jul 2003 21:25:24 +0100"  >Ok. The problem is perfectly reproducible. Still, I believe that HttpClient&lt;br/&gt;
behavior is absolutely correct. It just does exactly what it is told to do by&lt;br/&gt;
the target HTTP server. It is not up to HttpClient to decide whether the target&lt;br/&gt;
URL makes sense or not, as long it is a valid URL. I suggest you disable&lt;br/&gt;
automatic redirect for that particular URL and implement custom redirect logic&lt;br/&gt;
that suits your needs. &lt;br/&gt;
&lt;br/&gt;
Does anyone see it differently?&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
PS: I tried hitting the site in question with Galeon and it did not work either.&lt;br/&gt;
I could not care less if the site works with IE</comment>
                    <comment id="12380715" author="michael@advweb.com" created="Tue, 1 Jul 2003 21:33:02 +0100"  >I see it differently although not strongly enough to pursue it.  I see an &lt;br/&gt;
opportunity to prevent httpclient from doing something that doesn&amp;#39;t make sense, &lt;br/&gt;
and an opportunity to optimize the performance by preventing 100 GETs.  Overall &lt;br/&gt;
it&amp;#39;s not a big deal, we can leave the report as invalid.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12380716" author="olegk" created="Tue, 1 Jul 2003 21:47:59 +0100"  >Michael, redirect logic in HttpClient will be completely overhauled in the 2.1&lt;br/&gt;
release. We can decide at that point whether HttpClient should follow redirects&lt;br/&gt;
to the same URL or not. I am just not entirely sure if there are no legitimate&lt;br/&gt;
use scenarios for such redirects.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380717" author="csell" created="Tue, 1 Jul 2003 22:57:17 +0100"  >the spec does mention that a client SHOULD detect and prevent circular redirects</comment>
                    <comment id="12380718" author="olegk" created="Tue, 1 Jul 2003 23:11:15 +0100"  >HttpClient DOES prevent circular redirects by keeping a max count on allowed&lt;br/&gt;
automatic redirects. The question is whether HttpClient should make an&lt;br/&gt;
assumption that a redirect to the same URL will always result in a infinite&lt;br/&gt;
loop. I am not entirely sure this assumption is valid.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380719" author="csell" created="Wed, 2 Jul 2003 00:40:57 +0100"  >there is a difference between limiting the number of redirects and preventing&lt;br/&gt;
circular redirects. If I do the latter, a redirect to an URL that already&lt;br/&gt;
appeared in the redirect chain will be rejected, even if the max number of&lt;br/&gt;
redirects has not been reached.</comment>
                    <comment id="12380720" author="olegk" created="Wed, 2 Jul 2003 01:04:05 +0100"  >Christian,&lt;br/&gt;
Can you show me where in the RFC it is stated that redirects to the same&lt;br/&gt;
location are not allowed? In my humble opinion, multiple redirects to the same&lt;br/&gt;
location != an infinite loop.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380721" author="csell" created="Wed, 2 Jul 2003 01:41:43 +0100"  >ok, heres the quote from section 10.3 in RFC 2616:&lt;br/&gt;
&lt;br/&gt;
&amp;quot;A client SHOULD detect infinite redirection loops, since such loops generate&lt;br/&gt;
network traffic for each redirection. &lt;br/&gt;
Note: previous versions of this specification recommended a maximum of five&lt;br/&gt;
redirections. Content developers should be aware that there might be clients&lt;br/&gt;
that implement such a fixed limitation.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
To me, DETECTING an infinite loop is something else than limiting the number of&lt;br/&gt;
redirects, as the above remark about previous versions also confirms.&lt;br/&gt;
&lt;br/&gt;
And, IMHO, multiple redirects to the same location == an infinite loop (unless&lt;br/&gt;
the resource at the location has changed in the meantime)&lt;br/&gt;
&lt;br/&gt;
- I hope this issue does not get into an inifite loop ;-) -</comment>
                    <comment id="12380722" author="olegk" created="Wed, 2 Jul 2003 02:02:05 +0100"  >I respectfully disagree with your interpretation even though in most of the&lt;br/&gt;
cases it corresponds to what the majority of users may expect to see (including&lt;br/&gt;
myself). This said, HttpClient is a general purpose HTTP agent and as such&lt;br/&gt;
should follow the letter of the specification rather than make informed guesses.&lt;br/&gt;
We are not supposed to invent stuff. Nowhere in the spec &amp;#39;circular redirects&amp;#39;&lt;br/&gt;
are mentioned. The spec states that an HTTP agent should avoid infinite loops,&lt;br/&gt;
which is not the same thing as circular redirects in my opinion.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380723" author="csell" created="Wed, 2 Jul 2003 02:38:41 +0100"  >&amp;gt;The spec states that an HTTP agent should avoid infinite loops,&lt;br/&gt;
&amp;gt;which is not the same thing as circular redirects in my opinion.&lt;br/&gt;
&lt;br/&gt;
If you want to follow the letter, please do. The letter specifically mentions&lt;br/&gt;
DETECTING an infinite loop, not AVOIDING it. If you limit the redirects you are&lt;br/&gt;
not detecting anything - after all the loop might end 2 steps after your limit.&lt;br/&gt;
&lt;br/&gt;
Christian</comment>
                    <comment id="12380724" author="olegk" created="Wed, 2 Jul 2003 02:55:15 +0100"  >HttpClient does detect and does avoid infinite redirection loops in its present&lt;br/&gt;
implementation. In the 2.1 release it may optionally handle circular redirection&lt;br/&gt;
loops as well.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380725" author="becke@u.washington.edu" created="Wed, 2 Jul 2003 03:45:00 +0100"  >Okay gentlemen.  You are essentially both correct.  HttpClient currently works&lt;br/&gt;
for this case (i.e. does not loop forever and warns the user) however the&lt;br/&gt;
behavior is sub-optimal.  &lt;br/&gt;
&lt;br/&gt;
Let us revisit this in 2.1 where it may make some sense to detect circular&lt;br/&gt;
redirects.  Case closed for now?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380726" author="olegk" created="Sat, 10 Apr 2004 23:34:20 +0100"  >Created an attachment (id=11207)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12380727" author="olegk" created="Sat, 10 Apr 2004 23:44:25 +0100"  >The fix is pretty straightforward. Important notes:&lt;br/&gt;
&lt;br/&gt;
* Circular redirect check is on per default and in lenient mode, is off in&lt;br/&gt;
strict mode&lt;br/&gt;
&lt;br/&gt;
* Authentication attempts excluded from the redirect count and do not affect the&lt;br/&gt;
max redirect check.&lt;br/&gt;
&lt;br/&gt;
Let me know if you agree. Feedback welcome&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380728" author="becke@u.washington.edu" created="Mon, 12 Apr 2004 05:21:40 +0100"  >Very nice, looks good to me.  I have only one very minor suggestion.  I would rename &lt;br/&gt;
CIRCULAR_REDIRECTS to ALLOW_CIRCULAR_REDIRECTS, just so that it&amp;#39;s more readable on its own.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380729" author="olegk" created="Mon, 12 Apr 2004 18:32:59 +0100"  >CIRCULAR_REDIRECTS renamed to ALLOW_CIRCULAR_REDIRECTS. Patch committed.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12326919" name="ASF.LICENSE.NOT.GRANTED--redirect.patch" size="19950" author="olegk" created="Sat, 10 Apr 2004 23:34:20 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>21216</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 1 Jul 2003 19:29:34 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133293</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189324</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>