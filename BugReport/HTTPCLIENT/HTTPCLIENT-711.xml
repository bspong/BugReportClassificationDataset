<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:20:13 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-711/HTTPCLIENT-711.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-711] bad route computed for redirected requests</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-711</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>BasicRouteDirector appears to miscalculate complex routes. Example to follow. </description>
                <environment></environment>
            <key id="12384517">HTTPCLIENT-711</key>
            <summary>bad route computed for redirected requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="olegk">Oleg Kalnichevski</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Dec 2007 17:27:14 +0000</created>
                <updated>Tue, 25 Jan 2011 10:58:42 +0000</updated>
                    <resolved>Sat, 15 Dec 2007 14:36:42 +0000</resolved>
                            <version>4.0 Alpha 2</version>
                                <fixVersion>4.0 Alpha 3</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                                                  <comments>
                    <comment id="12551039" author="olegk" created="Wed, 12 Dec 2007 17:28:27 +0000"  >======================================&lt;br/&gt;
HttpHost targetHost = new HttpHost(&amp;quot;&lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&amp;quot;, 80); &lt;br/&gt;
HttpHost proxy = new HttpHost(&amp;quot;localhost&amp;quot;, 8080); &lt;br/&gt;
HttpRoute route = new HttpRoute(targetHost, null, proxy, false);&lt;br/&gt;
&lt;br/&gt;
HttpGet httpget = new HttpGet(&amp;quot;&lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt;&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
RoutedRequest routedReq = new RoutedRequest.Impl(httpget, route); &lt;br/&gt;
System.out.println(&amp;quot;executing request to &amp;quot; + route);&lt;br/&gt;
&lt;br/&gt;
HttpResponse response = httpclient.execute(routedReq, null);&lt;br/&gt;
HttpEntity entity = response.getEntity();&lt;br/&gt;
&lt;br/&gt;
System.out.println(&amp;quot;----------------------------------------&amp;quot;);&lt;br/&gt;
System.out.println(response.getStatusLine());&lt;br/&gt;
if (entity != null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(&amp;quot;Response content length: &amp;quot; + entity.getContentLength());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(&amp;quot;Chunked?: &amp;quot; + entity.isChunked());&lt;br/&gt;
}&lt;br/&gt;
if (entity != null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;entity.consumeContent();&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
======================================&lt;br/&gt;
&lt;br/&gt;
======================================&lt;br/&gt;
executing request to HttpRoute[{}-&amp;gt;&lt;a href=&quot;http://localhost:8080-&amp;gt;http://www.google.com:80&quot;&gt;http://localhost:8080-&amp;amp;gt;http://www.google.com:80&lt;/a&gt;]&lt;br/&gt;
[DEBUG] SingleClientConnManager - SingleClientConnManager.getConnection: HttpRoute[{}-&amp;gt;&lt;a href=&quot;http://localhost:8080-&amp;gt;http://www.google.com:80&quot;&gt;http://localhost:8080-&amp;amp;gt;http://www.google.com:80&lt;/a&gt;]&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Stale connection check&lt;br/&gt;
[DEBUG] RequestAddCookies - CookieSpec selected: compatibility&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Attempt 1 to execute request&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;GET &lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt; HTTP/1.1[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Host: &lt;a href=&quot;http://www.google.com:80&quot;&gt;www.google.com:80&lt;/a&gt;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Connection: Keep-Alive[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; GET &lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt; HTTP/1.1&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Host: &lt;a href=&quot;http://www.google.com:80&quot;&gt;www.google.com:80&lt;/a&gt;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Connection: Keep-Alive&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;HTTP/1.0 407 Proxy Authentication Required[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Server: squid/2.5.STABLE13[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Mime-Version: 1.0[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Date: Wed, 12 Dec 2007 17:20:43 GMT[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Content-Type: text/html[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Content-Length: 1292[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Expires: Wed, 12 Dec 2007 17:20:43 GMT[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Proxy-Authenticate: Basic realm=&amp;quot;test-proxy&amp;quot;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;X-Cache: MISS from localhost[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Proxy-Connection: close[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; HTTP/1.0 407 Proxy Authentication Required&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Server: squid/2.5.STABLE13&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Mime-Version: 1.0&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Date: Wed, 12 Dec 2007 17:20:43 GMT&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Content-Type: text/html&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Content-Length: 1292&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Expires: Wed, 12 Dec 2007 17:20:43 GMT&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Proxy-Authenticate: Basic realm=&amp;quot;test-proxy&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; X-Cache: MISS from localhost&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Proxy-Connection: close&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Proxy requested authentication&lt;br/&gt;
[DEBUG] AbstractAuthenticationHandler - Supported authentication schemes in the order of preference: [digest, basic]&lt;br/&gt;
[DEBUG] AbstractAuthenticationHandler - Challenge for digest authentication scheme not available&lt;br/&gt;
[DEBUG] AbstractAuthenticationHandler - basic authentication scheme selected&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Authorization challenge processed&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Authentication scope: BASIC &amp;#39;test-proxy&amp;#39;@localhost:8080&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Found credentials&lt;br/&gt;
[DEBUG] DefaultClientConnection - Connection closed&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Stale connection check&lt;br/&gt;
[DEBUG] RequestAddCookies - CookieSpec selected: compatibility&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Attempt 2 to execute request&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;GET &lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt; HTTP/1.1[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Host: &lt;a href=&quot;http://www.google.com:80&quot;&gt;www.google.com:80&lt;/a&gt;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Connection: Keep-Alive[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Proxy-Authorization: Basic c3F1aWQ6c3F1aWQ=[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; GET &lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt; HTTP/1.1&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Host: &lt;a href=&quot;http://www.google.com:80&quot;&gt;www.google.com:80&lt;/a&gt;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Connection: Keep-Alive&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Proxy-Authorization: Basic c3F1aWQ6c3F1aWQ=&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;HTTP/1.0 302 Moved Temporarily[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Location: &lt;a href=&quot;http://www.google.ch/&quot;&gt;http://www.google.ch/&lt;/a&gt;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Cache-Control: private[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Set-Cookie: PREF=ID=52fb518e7ee097ab:TM=1197480041:LM=1197480041:S=a1pxJQbheNzl_ekF; expires=Fri, 11-Dec-2009 17:20:41 GMT; path=/; domain=.google.com[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Content-Type: text/html[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Server: gws[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Content-Length: 218[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Date: Wed, 12 Dec 2007 17:20:41 GMT[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;X-Cache: MISS from localhost[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;Proxy-Connection: keep-alive[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; HTTP/1.0 302 Moved Temporarily&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Location: &lt;a href=&quot;http://www.google.ch/&quot;&gt;http://www.google.ch/&lt;/a&gt;&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Cache-Control: private&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Set-Cookie: PREF=ID=52fb518e7ee097ab:TM=1197480041:LM=1197480041:S=a1pxJQbheNzl_ekF; expires=Fri, 11-Dec-2009 17:20:41 GMT; path=/; domain=.google.com&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Content-Type: text/html&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Server: gws&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Content-Length: 218&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Date: Wed, 12 Dec 2007 17:20:41 GMT&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; X-Cache: MISS from localhost&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; Proxy-Connection: keep-alive&lt;br/&gt;
[DEBUG] ResponseProcessCookies - Cookie accepted: &amp;quot;[version: 0][name: PREF][name: ID=52fb518e7ee097ab:TM=1197480041:LM=1197480041:S=a1pxJQbheNzl_ekF][domain: .google.com][path: /][expiry: Fri Dec 11 18:20:41 GMT+01:00 2009]&amp;quot;. &lt;br/&gt;
[DEBUG] DefaultRedirectHandler - Redirect requested to location &amp;#39;&lt;a href=&quot;http://www.google.ch/&amp;#39;&quot;&gt;http://www.google.ch/&amp;amp;#39;&lt;/a&gt;&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Redirecting to &amp;#39;&lt;a href=&quot;http://www.google.ch/&amp;#39;&quot;&gt;http://www.google.ch/&amp;amp;#39;&lt;/a&gt; via HttpRoute[{tl}-&amp;gt;&lt;a href=&quot;http://localhost:8080-&amp;gt;http://www.google.ch&quot;&gt;http://localhost:8080-&amp;amp;gt;http://www.google.ch&lt;/a&gt;]&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Connection kept alive&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;HTML&amp;gt;&amp;lt;HEAD&amp;gt;&amp;lt;meta http-equiv=&amp;quot;content-type&amp;quot; content=&amp;quot;text/html;charset=utf-8&amp;quot;&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;TITLE&amp;gt;302 Moved&amp;lt;/TITLE&amp;gt;&amp;lt;/HEAD&amp;gt;&amp;lt;BODY&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;H1&amp;gt;302 Moved&amp;lt;/H1&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;The document has moved[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;A HREF=&amp;quot;&lt;a href=&quot;http://www.google.ch/&quot;&gt;http://www.google.ch/&lt;/a&gt;&amp;quot;&amp;gt;here&amp;lt;/A&amp;gt;.[\r][\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;/BODY&amp;gt;&amp;lt;/HTML&amp;gt;[\r][\n]&amp;quot;&lt;br/&gt;
[DEBUG] SingleClientConnManager - Released connection open but not reusable.&lt;br/&gt;
[DEBUG] DefaultClientConnection - Connection shut down&lt;br/&gt;
[DEBUG] SingleClientConnManager - SingleClientConnManager.getConnection: HttpRoute[{tl}-&amp;gt;&lt;a href=&quot;http://localhost:8080-&amp;gt;http://www.google.ch&quot;&gt;http://localhost:8080-&amp;amp;gt;http://www.google.ch&lt;/a&gt;]&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;CONNECT &lt;a href=&quot;http://www.google.ch:80&quot;&gt;www.google.ch:80&lt;/a&gt; HTTP/1.1[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Host: &lt;a href=&quot;http://www.google.ch&quot;&gt;www.google.ch&lt;/a&gt;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;Proxy-Authorization: Basic c3F1aWQ6c3F1aWQ=[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;gt;&amp;gt; &amp;quot;[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; CONNECT &lt;a href=&quot;http://www.google.ch:80&quot;&gt;www.google.ch:80&lt;/a&gt; HTTP/1.1&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; User-Agent: Apache-HttpClient/UNAVAILABLE (java 1.4)&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Host: &lt;a href=&quot;http://www.google.ch&quot;&gt;www.google.ch&lt;/a&gt;&lt;br/&gt;
[DEBUG] headers - &amp;gt;&amp;gt; Proxy-Authorization: Basic c3F1aWQ6c3F1aWQ=&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;HTTP/1.0 200 Connection established[EOL]&amp;quot;&lt;br/&gt;
[DEBUG] headers - &amp;lt;&amp;lt; HTTP/1.0 200 Connection established&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Tunnel to target created.&lt;br/&gt;
[DEBUG] SingleClientConnManager - Released connection open but not reusable.&lt;br/&gt;
[DEBUG] DefaultClientConnection - Connection shut down&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.IllegalArgumentException: Target scheme (http) must have layered socket factory.&lt;br/&gt;
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.updateSecureConnection(DefaultClientConnectionOperator.java:184)&lt;br/&gt;
	at org.apache.http.impl.conn.AbstractPoolEntry.layerProtocol(AbstractPoolEntry.java:282)&lt;br/&gt;
	at org.apache.http.impl.conn.AbstractPooledConnAdapter.layerProtocol(AbstractPooledConnAdapter.java:148)&lt;br/&gt;
	at org.apache.http.impl.client.DefaultClientRequestDirector.establishRoute(DefaultClientRequestDirector.java:508)&lt;br/&gt;
	at org.apache.http.impl.client.DefaultClientRequestDirector.execute(DefaultClientRequestDirector.java:287)&lt;br/&gt;
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:511)======================================&lt;br/&gt;
</comment>
                    <comment id="12551042" author="rolandw" created="Wed, 12 Dec 2007 17:40:11 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
the problem is not the BasicRouteDirector. The problem is that the route for plain HTTP through the proxy is considered a layered route, although it should be a plain route. This could happen if you are using a LayeredSocketFactory for scheme &amp;quot;http&amp;quot;. IIRC, the decision whether a route is layered is not based on the scheme name but on the factory type. I&amp;#39;ll have a look at it.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551044" author="rolandw" created="Wed, 12 Dec 2007 17:45:18 +0000"  >Yepp, have a look at impl.conn.DefaultHttpRoutePlanner:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Scheme schm = this.connectionManager.getSchemeRegistry().&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getScheme(target.getSchemeName());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// as it is typically used for TLS/SSL, we assume that&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// a layered scheme implies a secure connection&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean secure = schm.isLayered();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpRoute route = null;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (proxy == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;route = new HttpRoute(target, null, secure);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;route = new HttpRoute(target, null, proxy, secure);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
And the constructor of Scheme has:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;this.layered = (factory instanceof LayeredSocketFactory);&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551046" author="rolandw" created="Wed, 12 Dec 2007 17:50:39 +0000"  >Hmmm... it seems this is only half the story. The DefaultHttpRoutePlanner will use the same value for both &amp;quot;layered&amp;quot; and &amp;quot;secure&amp;quot;, which is not what we are seeing in your log. The buggy code is in DefaultClientRequestDirector, method handleResponse:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpRoute newRoute = new HttpRoute(&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;newTarget,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;localAddress,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;proxy,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;schm.isLayered(),&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(proxy != null),&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(proxy != null));&lt;br/&gt;
&lt;br/&gt;
The director should rather use the RoutePlanner from the client to compute the route for the redirected request.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551205" author="rolandw" created="Thu, 13 Dec 2007 03:53:27 +0000"  >I suggest the following changes to address this problem:&lt;br/&gt;
&lt;br/&gt;
1. remove HttpClient.execute(RouteRequest...) methods&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(optionally replace with HttpClient.execute(HttpRequest,HttpHost target,...) methods&lt;br/&gt;
2. change ClientRequestDirector to expect HttpRequest+HttpHost instead of RoutedRequest&lt;br/&gt;
3. change DefaultClientRequestDirector to expect a route planner in the constructor&lt;br/&gt;
4. move Abstract/DefaultHttpClient.determineRoute to the ClientRequestDirector&lt;br/&gt;
5. move RoutedRequest from the API to an impl package, or drop it altogether&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(it seems to have outlived it&amp;#39;s usefulness in the API)&lt;br/&gt;
&lt;br/&gt;
After 4, the request director can take care of all route planning for the original and followup requests.&lt;br/&gt;
&lt;br/&gt;
The purpose of RoutedRequest was to allow application-defined routes. This can now be achieved by implementing a custom route planner and passing an application-defined route as request parameter or in the context. We can also consider to add this functionality to the default route planner.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551208" author="rolandw" created="Thu, 13 Dec 2007 04:11:45 +0000"  >on a related matter, this section indicates a bug in connection re-use handling:&lt;br/&gt;
&lt;br/&gt;
[DEBUG] DefaultClientRequestDirector - Connection kept alive&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;HTML&amp;gt;&amp;lt;HEAD&amp;gt;&amp;lt;meta http-equiv=&amp;quot;content-type&amp;quot; content=&amp;quot;text/html;charset=utf-8&amp;quot;&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;TITLE&amp;gt;302 Moved&amp;lt;/TITLE&amp;gt;&amp;lt;/HEAD&amp;gt;&amp;lt;BODY&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;H1&amp;gt;302 Moved&amp;lt;/H1&amp;gt;[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;The document has moved[\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;A HREF=&amp;quot;&lt;a href=&quot;http://www.google.ch/&quot;&gt;http://www.google.ch/&lt;/a&gt;&amp;quot;&amp;gt;here&amp;lt;/A&amp;gt;.[\r][\n]&amp;quot;&lt;br/&gt;
[DEBUG] wire - &amp;lt;&amp;lt; &amp;quot;&amp;lt;/BODY&amp;gt;&amp;lt;/HTML&amp;gt;[\r][\n]&amp;quot;&lt;br/&gt;
[DEBUG] SingleClientConnManager - Released connection open but not reusable. &lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve committed a change which I hope will fix this issue.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551455" author="olegk" created="Thu, 13 Dec 2007 10:18:08 +0000"  >Sounds like a plan. +1 from me. Could you please also consider making changes to HttpRoute API too? I personally profoundly dislike boolean parameters, as I never manager to remember what is true and what is false in each particular case. Three boolean parameters in a row just kill me. Could we use enumerations instead or some such?    &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12551579" author="rolandw" created="Thu, 13 Dec 2007 19:05:31 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
I haven&amp;#39;t fixed the route computation for redirected requests, but I&amp;#39;ve completed all preliminary steps.&lt;br/&gt;
Maybe you can take it from here... it&amp;#39;s getting late for me.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551735" author="olegk" created="Fri, 14 Dec 2007 09:05:00 +0000"  >I can take it over from here&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12551794" author="olegk" created="Fri, 14 Dec 2007 13:28:30 +0000"  >The HttpRoutePlanner interface and its default impl in their current form are two restrictive. DefaultHttpRoutePlanner always uses null for localAddress and the default proxy as set in the context. This is no way to pass a different proxy host or a local address. Do you mind my doing some changes to the HttpRoutePlanner interface?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12551796" author="rolandw" created="Fri, 14 Dec 2007 13:35:20 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
the context is request specific, and so are the request parameters.&lt;br/&gt;
Is it really necessary to move this stuff into the interface?&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t mind a DHRP that interprets more context or parameters,&lt;br/&gt;
but I would rather not have this stuff as method arguments.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12551799" author="olegk" created="Fri, 14 Dec 2007 13:44:57 +0000"  >Roland,&lt;br/&gt;
Now I am completely lost. I just noticed you had eliminated #execute method from HttpClient interface that takes HttpRoute as a parameter. I thought you wanted to do away with RoutedRequest, not HttpRoute. What is your plan about passing custom localAddress and proxy host?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12551812" author="rolandw" created="Fri, 14 Dec 2007 14:22:20 +0000"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
the idea is to have all route computations done in the route planner. If a specific proxy or local address is needed, then the route planner should know about it, not the application. A specific route planner can get proxy and local address data from context (default or request specific), from parameters (default or request specific), as constructor arguments, or from any other place like system properties.&lt;br/&gt;
&lt;br/&gt;
I consider the case where the route is computed by the application rather than in the route planner as rare. Usually, applications should be able to encapsulate routing logic into a route planner, either the default one or a custom one. For the rare case that individual requests must be route by the application explicitly, I was planning to extend the default route planner with an additional request property or context attribute, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-716&quot; title=&quot;application-defined routes&quot;&gt;&lt;strike&gt;HTTPCLIENT-716&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
&amp;nbsp;</comment>
                    <comment id="12551814" author="olegk" created="Fri, 14 Dec 2007 14:31:04 +0000"  >OK. I think I got it&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12552078" author="olegk" created="Sat, 15 Dec 2007 14:36:42 +0000"  >Fixed in SVN trunk.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
            <subtask id="12384566">HTTPCLIENT-713</subtask>
            <subtask id="12384567">HTTPCLIENT-714</subtask>
            <subtask id="12384568">HTTPCLIENT-715</subtask>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 12 Dec 2007 17:40:11 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133749</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47461</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>