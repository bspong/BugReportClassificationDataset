<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:17:49 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-469/HTTPCLIENT-469.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-469] Stale connection check does not work with IBM JSSE/JRE</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-469</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>OS: Windows/AIX&lt;br/&gt;
JRE: IBM JRE 1.4.1&lt;br/&gt;
JSSE: IBM&amp;#39;s implementation (SSLite?)&lt;br/&gt;
HttpClient Library: 2.0.2 release&lt;br/&gt;
&lt;br/&gt;
My code enabled connection pooling feature to gain performance improvement in &lt;br/&gt;
the SSL Handshake area. The code works perfectly on Sun JRE 1.4.2 with a think &lt;br/&gt;
time of 60seconds between requests, but the same code fails on IBM JRE. On IBM &lt;br/&gt;
JRE, the code fails to detech stale connections, thus causing down the stream &lt;br/&gt;
setSoTimeout() call to fail.&lt;br/&gt;
&lt;br/&gt;
Further debugging into the library code revealed difference in the way the &lt;br/&gt;
HTTPConnection.isStale() behaves. With in that method, particularly, the &lt;br/&gt;
inputStream.isAvailable() method returns 0 with Sun JRE but -1 with IBM JRE.&lt;br/&gt;
&lt;br/&gt;
I made a small code change to HttpConnection.isStale() method by moving the try&lt;br/&gt;
{}finally{} block outside of the if(inputStream.isAvailable()==0) check in the &lt;br/&gt;
following code and BINGO, everything started working on IBM JVM&amp;#x92;s. It did not &lt;br/&gt;
break anything on Sun&amp;#x92;s JVM.&lt;br/&gt;
&lt;br/&gt;
============== CODE BEGIN&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;protected boolean isStale() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got called. soTimeout=&amp;quot; &lt;br/&gt;
+ soTimeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean isStale = true;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (isOpen) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got called. &lt;br/&gt;
isOpen=&amp;quot; + isOpen);        	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// the connection is open, but now we have to see if we can read it&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// assume the connection is not stale.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;isStale = false;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {         &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (inputStream.available() == 0) {		// ALWAYS &lt;br/&gt;
RETURNS -1 on IBM JVM &amp;#x85; 0 on SUN&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	&lt;br/&gt;
		  // try {		// SUBBA &amp;#x96; MOVED OUTSIDE IF&lt;br/&gt;
	                	socket.setSoTimeout(1);&lt;br/&gt;
	                  	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() &lt;br/&gt;
got called. setSoTimeout(1)&amp;quot;);                    	&lt;br/&gt;
	                    &lt;br/&gt;
	                    inputStream.mark(1);&lt;br/&gt;
	                    int byteRead = inputStream.read();&lt;br/&gt;
	                	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() &lt;br/&gt;
got called. bytesRead=&amp;quot; + byteRead);                    	&lt;br/&gt;
	                    &lt;br/&gt;
	                    if (byteRead == -1) {&lt;br/&gt;
	                    	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() &lt;br/&gt;
got called. SETTING isStale to TRUE HERE&amp;quot;);                    	&lt;br/&gt;
	                    	&lt;br/&gt;
	                        // again - if the socket is reporting all data &lt;br/&gt;
read,&lt;br/&gt;
	                        // probably stale&lt;br/&gt;
	                        isStale = true;&lt;br/&gt;
	                    } else {&lt;br/&gt;
	                        inputStream.reset();&lt;br/&gt;
	                    }&lt;br/&gt;
		    // SUBBA &amp;#x96; MOVED OUTSIDE IF&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got &lt;br/&gt;
called. finally block - BEGIN &amp;quot; + soTimeout);                    	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//    socket.setSoTimeout(soTimeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got &lt;br/&gt;
called. finally block - DONE&amp;quot;);                        &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// }&lt;br/&gt;
&lt;br/&gt;
	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}                        &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got &lt;br/&gt;
called. finally block - BEGIN &amp;quot; + soTimeout);                    	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(soTimeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	LOG.debug(&amp;quot;##SUBBA## HttpConnection.isStale() got &lt;br/&gt;
called. finally block - DONE&amp;quot;);                        &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
.....&lt;br/&gt;
.....&lt;br/&gt;
.....&lt;br/&gt;
========================== CODE END&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve attached logs captured before and after the change on both the JRE&amp;#39;s for &lt;br/&gt;
your review:&lt;br/&gt;
&lt;br/&gt;
==================================&lt;br/&gt;
IBM&amp;#x92;s LOG (after change):&lt;br/&gt;
==================================&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:700&amp;gt; &amp;lt;Getting &lt;br/&gt;
free connection, hostConfig=HostConfiguration&lt;br/&gt;
[host=uatservices30.ilab.fnfismd.com, protocol=https:443, port=443]&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:492&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. soTimeout=0&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:495&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. isOpen=true&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:500&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. [class &lt;br/&gt;
java.io.BufferedInputStream].available=-1&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:523&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. finally block - BEGIN 0&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:532&amp;gt; &amp;lt;An error occurred while &lt;br/&gt;
reading from the socket, is appears to be stale&amp;gt;&lt;br/&gt;
java.net.SocketException: Socket is closed&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:927)&lt;br/&gt;
	at com.ibm.sslite.bf.setSoTimeout(Unknown Source)&lt;br/&gt;
	at com.ibm.jsse.bg.setSoTimeout(Unknown Source)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.isStale&lt;br/&gt;
(HttpConnection.java:524)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.isOpen&lt;br/&gt;
(HttpConnection.java:436)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.isOpen(MultiThreadedHttpConnectionManager.java:1122)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:626)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:540&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() return=true&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:26:55 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:437&amp;gt; &amp;lt;Connection is stale, &lt;br/&gt;
closing...&amp;gt;&lt;br/&gt;
&lt;br/&gt;
==================================&lt;br/&gt;
IBM&amp;#x92;s LOG (before change):&lt;br/&gt;
==================================&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:666&amp;gt; &amp;lt;enter &lt;br/&gt;
HttpConnectionManager.ConnectionPool.getHostPool(HostConfiguration)&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:700&amp;gt; &amp;lt;Getting &lt;br/&gt;
free connection, hostConfig=HostConfiguration&lt;br/&gt;
[host=uatservices30.ilab.fnfismd.com, protocol=https:443, port=443]&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:492&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called.&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:495&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. isOpen=true&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:500&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. [class &lt;br/&gt;
java.io.BufferedInputStream].available=-1&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:538&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() return=false&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:599&amp;gt; &amp;lt;HttpConnection.setSoTimeout(0)&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;WARN&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:607&amp;gt; &amp;lt;##SUBBA## Socket Exception&amp;gt;&lt;br/&gt;
java.net.SocketException: Socket is closed&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:927)&lt;br/&gt;
	at com.ibm.sslite.bf.setSoTimeout(Unknown Source)&lt;br/&gt;
	at com.ibm.jsse.bg.setSoTimeout(Unknown Source)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.setSoTimeout&lt;br/&gt;
(HttpConnection.java:603)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.setSoTimeout(MultiThreadedHttpConnectionManager.java:1296)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:633)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:1151&amp;gt; &amp;lt;enter &lt;br/&gt;
HttpConnection.releaseConnection()&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:513&amp;gt; &amp;lt;enter &lt;br/&gt;
HttpConnectionManager.releaseConnection(HttpConnection)&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:791&amp;gt; &amp;lt;Freeing &lt;br/&gt;
connection, hostConfig=HostConfiguration[host=uatservices30.ilab.fnfismd.com, &lt;br/&gt;
protocol=https:443, port=443]&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:666&amp;gt; &amp;lt;enter &lt;br/&gt;
HttpConnectionManager.ConnectionPool.getHostPool(HostConfiguration)&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:07:29 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:774&amp;gt; &amp;lt;Notifying &lt;br/&gt;
no-one, there are no waiting threads&amp;gt;&lt;br/&gt;
java.net.SocketException: Socket is closed&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:927)&lt;br/&gt;
	at com.ibm.sslite.bf.setSoTimeout(Unknown Source)&lt;br/&gt;
	at com.ibm.jsse.bg.setSoTimeout(Unknown Source)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.setSoTimeout&lt;br/&gt;
(HttpConnection.java:603)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.setSoTimeout(MultiThreadedHttpConnectionManager.java:1296)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:633)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
java.net.SocketException: Socket is closed&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:927)&lt;br/&gt;
	at com.ibm.sslite.bf.setSoTimeout(Unknown Source)&lt;br/&gt;
	at com.ibm.jsse.bg.setSoTimeout(Unknown Source)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.setSoTimeout&lt;br/&gt;
(HttpConnection.java:603)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.setSoTimeout(MultiThreadedHttpConnectionManager.java:1296)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:633)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.net.SocketException: Socket is closed&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:927)&lt;br/&gt;
	at com.ibm.sslite.bf.setSoTimeout(Unknown Source)&lt;br/&gt;
	at com.ibm.jsse.bg.setSoTimeout(Unknown Source)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.setSoTimeout&lt;br/&gt;
(HttpConnection.java:603)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.setSoTimeout(MultiThreadedHttpConnectionManager.java:1296)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:633)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
============================================&lt;br/&gt;
**SUN&amp;#x92;s LOG (after change = before change):&lt;br/&gt;
============================================&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.MultiThreadedHttpConnectionManager:700&amp;gt; &amp;lt;Getting &lt;br/&gt;
free connection, hostConfig=HostConfiguration&lt;br/&gt;
[host=uatservices30.ilab.fnfismd.com, protocol=https:443, port=443]&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:492&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. soTimeout=0&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:495&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. isOpen=true&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:500&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. [class &lt;br/&gt;
java.io.BufferedInputStream].available=0&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:506&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. setSoTimeout(1)&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:510&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. bytesRead=-1&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:513&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. SETTING isStale to TRUE HERE&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:523&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() got called. finally block - BEGIN 0&amp;gt;&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:532&amp;gt; &amp;lt;An error occurred while &lt;br/&gt;
reading from the socket, is appears to be stale&amp;gt;&lt;br/&gt;
java.net.SocketException: Socket Closed&lt;br/&gt;
	at java.net.PlainSocketImpl.setOption(PlainSocketImpl.java:177)&lt;br/&gt;
	at java.net.Socket.setSoTimeout(Socket.java:924)&lt;br/&gt;
	at com.sun.net.ssl.internal.ssl.SSLSocketImpl.setSoTimeout(DashoA12275)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.isStale&lt;br/&gt;
(HttpConnection.java:524)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpConnection.isOpen&lt;br/&gt;
(HttpConnection.java:436)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnection&lt;br/&gt;
Adapter.isOpen(MultiThreadedHttpConnectionManager.java:1122)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:626)&lt;br/&gt;
	at org.apache.commons.httpclient.HttpClient.executeMethod&lt;br/&gt;
(HttpClient.java:497)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.ApacheHttpClient.invokeRequest&lt;br/&gt;
(ApacheHttpClient.java:69)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequest&lt;br/&gt;
(MsWSManager.java:86)&lt;br/&gt;
	at &lt;br/&gt;
com.touchpoint.pia.services.transactions.msp.MsWSManager.invokeRequestWithPaylo&lt;br/&gt;
ad(MsWSManager.java:114)&lt;br/&gt;
	at com.touchpoint.pia.services.transactions.msp.MsWSManager.main&lt;br/&gt;
(MsWSManager.java:179)&lt;br/&gt;
&amp;lt;Jun 10, 2005 1:25:12 PM EDT&amp;gt; &amp;lt;DEBUG&amp;gt; &lt;br/&gt;
&amp;lt;apache.commons.httpclient.HttpConnection:540&amp;gt; &amp;lt;##SUBBA## &lt;br/&gt;
HttpConnection.isStale() return=true&amp;gt;</description>
                <environment>Operating System: Windows XP&lt;br/&gt;
Platform: PC</environment>
            <key id="12334028">HTTPCLIENT-469</key>
            <summary>Stale connection check does not work with IBM JSSE/JRE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="sayyagar">Subba Ayyagari</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Jun 2005 05:04:04 +0100</created>
                <updated>Wed, 16 Feb 2011 20:44:46 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:03 +0100</resolved>
                            <version>2.0.2</version>
                                <fixVersion>3.0 RC3</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382409" author="olegk" created="Sun, 12 Jun 2005 03:12:15 +0100"  >Subba,&lt;br/&gt;
&lt;br/&gt;
In both HttpClient 2.0.2 and 3.0-rc2 releases if (inputStream.available() == 0)&lt;br/&gt;
&amp;nbsp;check is executed inside a try/catch block. See for yourself:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://jakarta.apache.org/commons/httpclient/xref/org/apache/commons/httpclient/HttpConnection.html#497&quot;&gt;http://jakarta.apache.org/commons/httpclient/xref/org/apache/commons/httpclient/HttpConnection.html#497&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Are you sure you are using the correct source code snapshot?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382410" author="sayyagar" created="Tue, 14 Jun 2005 00:06:58 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
I apologize for not posting the full contents of the updated isStale() method.&lt;br/&gt;
Here is the full implementation of the method.&lt;br/&gt;
&lt;br/&gt;
If you walk through the code for the situation where inputStream.isAvailable()&lt;br/&gt;
returns -1 (which is the case with IBM JRE 1.4.1), the new code forces the&lt;br/&gt;
finally block to execute setSoTimeout which will fail thus returning &amp;quot;true&amp;quot; from&lt;br/&gt;
the isStale method.&lt;br/&gt;
&lt;br/&gt;
With the old code, it never throws exception thus returning &amp;quot;false&amp;quot; from the&lt;br/&gt;
isStale method. This leaves a closed connection to sit in the pool, which later&lt;br/&gt;
causes the executeMethod to fail (as shown in the stack trace in the logs&lt;br/&gt;
attached with the original post).&lt;br/&gt;
&lt;br/&gt;
You can simulate the failure by enabling connection pooling, and submitting two&lt;br/&gt;
requests with a think time of 60sec between them using IBM JRE. That 60sec (may&lt;br/&gt;
vary with WebServer configuration I guess) will force the connection to go stale.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Please let me know if I explained the situation properly or not.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
&lt;br/&gt;
=============================&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;protected boolean isStale() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean isStale = true;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (isOpen) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// the connection is open, but now we have to see if we can read it&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// assume the connection is not stale.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;isStale = false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {            	&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	if (inputStream.available() == 0) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;inputStream.mark(1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int byteRead = inputStream.read();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (byteRead == -1) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// again - if the socket is reporting all data read,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// probably stale&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;isStale = true;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;inputStream.reset();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}                        &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(soTimeout);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (InterruptedIOException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// aha - the connection is NOT stale - continue on!&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (IOException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// oops - the connection is stale, the read or soTimeout failed.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LOG.debug(&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;An error occurred while reading from the socket, is appears&lt;br/&gt;
to be stale&amp;quot;,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;e&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;isStale = true;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return isStale;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
=======================================</comment>
                    <comment id="12382411" author="olegk" created="Tue, 14 Jun 2005 02:09:05 +0100"  >Subba,&lt;br/&gt;
Wouldn&amp;#39;t this be a better fix?&lt;br/&gt;
&lt;br/&gt;
Index: src/java/org/apache/commons/httpclient/HttpConnection.java&lt;br/&gt;
===================================================================&lt;br/&gt;
--- src/java/org/apache/commons/httpclient/HttpConnection.java	(revision 190386)&lt;br/&gt;
+++ src/java/org/apache/commons/httpclient/HttpConnection.java	(working copy)&lt;br/&gt;
@@ -499,7 +499,7 @@&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// assume the connection is not stale.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;isStale = false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
-                if (inputStream.available() == 0) {&lt;br/&gt;
+                if (inputStream.available() &amp;lt;= 0) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;socket.setSoTimeout(1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;inputStream.mark(1);&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
PS: if you know your way around SVN please submit your patch in diff -u format&lt;br/&gt;
</comment>
                    <comment id="12382412" author="sayyagar" created="Tue, 14 Jun 2005 02:40:15 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
Perfect. Works for me.&lt;br/&gt;
&lt;br/&gt;
Thanks&lt;br/&gt;
Subba.</comment>
                    <comment id="12382413" author="olegk" created="Tue, 14 Jun 2005 02:49:17 +0100"  >Created an attachment (id=15389)&lt;br/&gt;
Patch&lt;br/&gt;
&lt;br/&gt;
If hear no complaints i&amp;#39;ll commit the patch in a few days&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382414" author="becke@u.washington.edu" created="Tue, 14 Jun 2005 13:11:24 +0100"  >Looks good.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382415" author="olegk" created="Wed, 15 Jun 2005 04:44:45 +0100"  >Patch committed.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327247" name="ASF.LICENSE.NOT.GRANTED--stalecheck.patch" size="642" author="olegk" created="Tue, 14 Jun 2005 02:49:17 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>1.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35322</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 12 Jun 2005 02:12:15 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133516</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47124</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>