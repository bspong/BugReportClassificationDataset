<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:15:10 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-243/HTTPCLIENT-243.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-243] Transfer-Encoding: identity not supported + possible patch</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-243</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>In HttpMethodBase.readResponseBody only chunked transfer encoding is &lt;br/&gt;
supported.  Some proxy servers like Privoxy, etc send a Transfer-Encoding: &lt;br/&gt;
identity header and HttpClient fails quietly and returns a null result input &lt;br/&gt;
stream.  At line 2037 in HttpMethodBase.java revision 1.160 I inserted the &lt;br/&gt;
following two lines and it appeared to work fine:&lt;br/&gt;
&lt;br/&gt;
} else if (&amp;quot;identity&amp;quot;.equalsIgnoreCase(transferEncodingHeader.getValue())) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;result = is;&lt;br/&gt;
&lt;br/&gt;
I think it should at least throw an exception or do something when it &lt;br/&gt;
encounters an unsupported Transfer-Encoding instead of returning a null input &lt;br/&gt;
stream.</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: All</environment>
            <key id="12333802">HTTPCLIENT-243</key>
            <summary>Transfer-Encoding: identity not supported + possible patch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="brentbeardsley@yahoo.com">Brent Beardsley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jul 2003 03:20:58 +0100</created>
                <updated>Wed, 16 Feb 2011 20:43:49 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:10:28 +0100</resolved>
                            <version>2.0 Beta 2</version>
                                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12380759" author="eric@tibco.com" created="Tue, 8 Jul 2003 03:30:37 +0100"  >A good catch, but I don&amp;#39;t think the suggested patch is quite right, as it&lt;br/&gt;
doesn&amp;#39;t compute the content length if the transferEncodingHeader is specified as&lt;br/&gt;
identity.&lt;br/&gt;
&lt;br/&gt;
I think rearranging the two cases, something like this:&lt;br/&gt;
&lt;br/&gt;
if (transferEncoding == null ||&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;quot;identity&amp;quot;.equalsIgnoreCase(transferEncoding.getValue() )) {&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;... do what is currently the second case&lt;br/&gt;
}&lt;br/&gt;
else if (&amp;quot;chunked&amp;quot;.equalsIgnoreCase(transferEncodingHeader.getValue() ) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;... do what is currently in the first case&lt;br/&gt;
}&lt;br/&gt;
else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;LOG.warn(&amp;quot;Unexpected transfer encoding&amp;quot;);&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
might work better.  Since I don&amp;#39;t have the indicated servers handy, perhaps the&lt;br/&gt;
submitter can try the suggested rearrangement?&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12380760" author="olegk" created="Tue, 8 Jul 2003 03:53:14 +0100"  >Eric, please correct me if I am wrong, but it seems there&amp;#39;s a certain&lt;br/&gt;
terminology confusion. &amp;#39;Identity&amp;#39; is a content encoding, not a transfer&lt;br/&gt;
encoding. RFC 2616 defines only one valid transfer encoding: chunked.&lt;br/&gt;
&lt;br/&gt;
I think the fix suggested by Brent is indeed the right one. Transfer-encoding &amp;amp;&lt;br/&gt;
Content-Length headers are mutually exclusive. We just have to print a&lt;br/&gt;
BIIIIIIIIG FAT waring message in case transfer encoding is anything but chunked&lt;br/&gt;
and return the input stream as is&lt;br/&gt;
&lt;br/&gt;
Am I missing something?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380761" author="olegk" created="Tue, 8 Jul 2003 04:03:17 +0100"  >Created an attachment (id=7128)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12380762" author="brentbeardsley@yahoo.com" created="Tue, 8 Jul 2003 04:15:06 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
I just looked at the patch and was wondering if you should only warn if you&amp;#39;re &lt;br/&gt;
in Strict mode?&lt;br/&gt;
&lt;br/&gt;
Brent</comment>
                    <comment id="12380763" author="olegk" created="Tue, 8 Jul 2003 04:22:54 +0100"  >Brent,&lt;br/&gt;
That surely can be done. (I still think it is a pretty serious compliance&lt;br/&gt;
problem on the part of Privoxy, and they should rather be warned, but I can live&lt;br/&gt;
with a warning in strict mode only)&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380764" author="olegk" created="Tue, 8 Jul 2003 04:25:42 +0100"  >Created an attachment (id=7133)&lt;br/&gt;
Patch (take 2)&lt;br/&gt;
</comment>
                    <comment id="12380765" author="eric@tibco.com" created="Tue, 8 Jul 2003 04:45:42 +0100"  >Brent,&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t suppose you could provide a wire log?  It might help clarify.&lt;br/&gt;
&lt;br/&gt;
Oleg,&lt;br/&gt;
&lt;br/&gt;
I have no idea whether my analysis is correct or not.  I only noticed this issue&lt;br/&gt;
due to my almost pathological interest in making sure streams are properly wrapped.&lt;br/&gt;
&lt;br/&gt;
The RFC apparently got it wrong on this point.  From section 3.6:&lt;br/&gt;
&amp;quot;The Internet Assigned Numbers Authority (IANA) acts as a registry for&lt;br/&gt;
transfer-coding value tokens. Initially, the registry contains the following&lt;br/&gt;
tokens: &amp;quot;chunked&amp;quot; (section 3.6.1), &amp;quot;identity&amp;quot; (section 3.6.2), &amp;quot;gzip&amp;quot; (section&lt;br/&gt;
3.5), &amp;quot;compress&amp;quot; (section 3.5), and &amp;quot;deflate&amp;quot; (section 3.5).&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Except that there is no section 3.6.2.&lt;br/&gt;
&lt;br/&gt;
I found these two links:&lt;br/&gt;
&lt;a href=&quot;http://lists.w3.org/Archives/Public/ietf-http-wg-old/2001SepDec/0018.html&quot;&gt;http://lists.w3.org/Archives/Public/ietf-http-wg-old/2001SepDec/0018.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://ftp.ics.uci.edu/pub/ietf/http/hypermail/1998q3/0135.html&quot;&gt;http://ftp.ics.uci.edu/pub/ietf/http/hypermail/1998q3/0135.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Which seem to suggest that leaving &amp;quot;identity&amp;quot; in was a mistake.  Maybe you knew&lt;br/&gt;
all this, I certainly didn&amp;#39;t.  In any case, your assertion that only &amp;quot;chunked&amp;quot;&lt;br/&gt;
is valid appears to be wrong, in that &amp;quot;gzip&amp;quot;, &amp;quot;compress&amp;quot;, and &amp;quot;deflate&amp;quot; are&lt;br/&gt;
possible values too.&lt;br/&gt;
&lt;br/&gt;
Anyway, I think it is still necessary to be able to determine the&lt;br/&gt;
content-length, so I think my original suggestion might be appropriate, if we&lt;br/&gt;
support the &amp;quot;identity&amp;quot; transfer encoding at all.&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve not had a chance to look at the patches you&amp;#39;ve supplied, just mining for&lt;br/&gt;
information so far.&lt;br/&gt;
&lt;br/&gt;
-Eric.</comment>
                    <comment id="12380766" author="olegk" created="Tue, 8 Jul 2003 05:29:43 +0100"  >Eric,&lt;br/&gt;
I do not know it for sure either. I am just trying to make some (more or less)&lt;br/&gt;
informed guesses. One thing for sure the RFC is terribly contradictory on this&lt;br/&gt;
issue. &lt;br/&gt;
--------------------------------------------------------------------&lt;br/&gt;
3.6 Transfer Codings&lt;br/&gt;
...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;Whenever a transfer-coding is applied to a message-body, the set of&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;transfer-codings MUST include &amp;quot;chunked&amp;quot;, unless the message is&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;terminated by closing the connection. When the &amp;quot;chunked&amp;quot; transfer-&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;coding is used, it MUST be the last transfer-coding applied to the&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;message-body. The &amp;quot;chunked&amp;quot; transfer-coding MUST NOT be applied more&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;than once to a message-body. These rules allow the recipient to&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;determine the transfer-length of the message (section 4.4).&lt;br/&gt;
...&lt;br/&gt;
--------------------------------------------------------------------&lt;br/&gt;
&lt;br/&gt;
so, what I can gather from the above paragraph is that chunk encoding must be&lt;br/&gt;
used anyway to ensure that the content length could be determined, no matter&lt;br/&gt;
what additional encodings are appled. &lt;br/&gt;
&lt;br/&gt;
There&amp;#39;s one thing I am pretty sure about that content length &amp;amp; transfer encoding&lt;br/&gt;
directives are mutually exclusive.&lt;br/&gt;
&lt;br/&gt;
--------------------------------------------------------------------&lt;br/&gt;
4.4 Message Length&lt;br/&gt;
&lt;br/&gt;
...&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;3.If a Content-Length header field (section 14.13) is present, its&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;decimal value in OCTETs represents both the entity-length and the&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;transfer-length. The Content-Length header field MUST NOT be sent&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if these two lengths are different (i.e., if a Transfer-Encoding&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;header field is present). If a message is received with both a&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Transfer-Encoding header field and a Content-Length header field,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;the latter MUST be ignored.&lt;br/&gt;
...&lt;br/&gt;
--------------------------------------------------------------------&lt;br/&gt;
&lt;br/&gt;
Anyways, what that all means to me that &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;if (&amp;quot;chunked&amp;quot;.equalsIgnoreCase(transferEncodingHeader.getValue()))&lt;br/&gt;
&lt;br/&gt;
is really not good enough. The code needs to be made more robust when dealing&lt;br/&gt;
with composite transfer encodings&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380767" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 08:45:02 +0100"  >Created an attachment (id=7143)&lt;br/&gt;
Patch (try 3)&lt;br/&gt;
</comment>
                    <comment id="12380768" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 08:46:47 +0100"  >I think this patch should take care of composite &amp;quot;Transfer Encoding&amp;quot; headers.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380769" author="olegk" created="Tue, 8 Jul 2003 16:09:34 +0100"  >Created an attachment (id=7153)&lt;br/&gt;
Patch (take 4)&lt;br/&gt;
</comment>
                    <comment id="12380770" author="olegk" created="Tue, 8 Jul 2003 16:12:01 +0100"  >Mike, your patch looks good to me. I just added a warning message in case&lt;br/&gt;
transfer encoding is no recognized. If you think it is ok, go ahead and commit&lt;br/&gt;
the patch to both branches.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380771" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 19:54:31 +0100"  >Patch committed to 2.0 and HEAD.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380772" author="olegk" created="Tue, 8 Jul 2003 20:03:10 +0100"  >Created an attachment (id=7158)&lt;br/&gt;
Follow-up patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12380773" author="olegk" created="Tue, 8 Jul 2003 20:06:19 +0100"  >Mike,&lt;br/&gt;
I had a sudden change of heart. I think we should have a facility to forcefully&lt;br/&gt;
close connection, in case something is wrong (like missing chunk encoding). It&lt;br/&gt;
is not good enough to hope that the server would drop the connection on its own&lt;br/&gt;
accord. There are other cases where this feature may come in handy.&lt;br/&gt;
&lt;br/&gt;
Oleg  </comment>
                    <comment id="12380774" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 21:19:15 +0100"  >We should probably set forceCloseConnection when there is no content length or&lt;br/&gt;
transfer encoding, but there is a response.  The following case from&lt;br/&gt;
readResponseBody():&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (expectedLength == -1) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (canResponseHaveBody(statusLine.getStatusCode())) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;result = is;            &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
We can then remove the test for no transfer encoding and missing content length&lt;br/&gt;
in shouldCloseConnection().&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380775" author="olegk" created="Tue, 8 Jul 2003 21:34:20 +0100"  >Makes sense to me. I suggest, though, this patch goes into CVS HEAD only.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380776" author="olegk" created="Tue, 8 Jul 2003 21:42:30 +0100"  >Created an attachment (id=7161)&lt;br/&gt;
Follow-up patch (take 2)&lt;br/&gt;
</comment>
                    <comment id="12380777" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 22:31:28 +0100"  >Created an attachment (id=7162)&lt;br/&gt;
Follow-up patch (take 3)&lt;br/&gt;
</comment>
                    <comment id="12380778" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 22:34:25 +0100"  >Oleg,&lt;br/&gt;
&lt;br/&gt;
This last patch modifies the javadocs a little and renames the&lt;br/&gt;
forceConnectionClose variable so that it is suitable for an is*() method.  Just&lt;br/&gt;
cosmetic changes:)&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12380779" author="olegk" created="Tue, 8 Jul 2003 22:49:16 +0100"  >Fair enough. I think the patch is good to be committed.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380780" author="olegk" created="Wed, 9 Jul 2003 06:13:26 +0100"  >Patch applied to 2.0 branch &amp;amp; HEAD&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380781" author="olegk" created="Thu, 10 Jul 2003 16:55:29 +0100"  >Created an attachment (id=7205)&lt;br/&gt;
Follow-up patch (take 1)&lt;br/&gt;
</comment>
                    <comment id="12380782" author="olegk" created="Fri, 11 Jul 2003 02:59:02 +0100"  >Created an attachment (id=7228)&lt;br/&gt;
Follow-up patch (take 2)&lt;br/&gt;
</comment>
                    <comment id="12380783" author="olegk" created="Fri, 11 Jul 2003 03:01:46 +0100"  >Another revision of the transfer-encoding patch. I hope it is going to be the&lt;br/&gt;
final one&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12380784" author="becke@u.washington.edu" created="Fri, 11 Jul 2003 09:10:13 +0100"  >Looks good to me.  Applied.</comment>
                    <comment id="12380785" author="olegk" created="Sat, 12 Jul 2003 04:27:02 +0100"  >Applied to 2.0 branch.</comment>
                </comments>
                    <attachments>
                    <attachment id="12326931" name="ASF.LICENSE.NOT.GRANTED--close.patch" size="3425" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 22:31:28 +0100" />
                    <attachment id="12326927" name="ASF.LICENSE.NOT.GRANTED--patch.txt" size="2391" author="becke@u.washington.edu" created="Tue, 8 Jul 2003 08:45:02 +0100" />
                    <attachment id="12326933" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="3623" author="olegk" created="Fri, 11 Jul 2003 02:59:02 +0100" />
                    <attachment id="12326932" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="2096" author="olegk" created="Thu, 10 Jul 2003 16:55:29 +0100" />
                    <attachment id="12326930" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="3401" author="olegk" created="Tue, 8 Jul 2003 21:42:30 +0100" />
                    <attachment id="12326929" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="2954" author="olegk" created="Tue, 8 Jul 2003 20:03:10 +0100" />
                    <attachment id="12326928" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="3026" author="olegk" created="Tue, 8 Jul 2003 16:09:34 +0100" />
                    <attachment id="12326926" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="1369" author="olegk" created="Tue, 8 Jul 2003 04:25:42 +0100" />
                    <attachment id="12326925" name="ASF.LICENSE.NOT.GRANTED--transfer-encoding.patch" size="1351" author="olegk" created="Tue, 8 Jul 2003 04:03:17 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>9.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>21378</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 8 Jul 2003 02:30:37 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133297</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>189134</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>