<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:21:35 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-852/HTTPCLIENT-852.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-852] CircularRedirectException encountered when using a proxy, but not when reaching the target directly</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-852</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>A CircularRedirectException is encountered when using a proxy (tinyproxy on a remote machine), whereas everything is fine when using no proxy. The target is a URL such as &lt;a href=&quot;http://www.seoconsultants.com/w3c/status-codes/301.asp&quot;&gt;http://www.seoconsultants.com/w3c/status-codes/301.asp&lt;/a&gt; which has a 301 redirection.&lt;br/&gt;
&lt;br/&gt;
The issue can be fixed by using ALLOW_CIRCULAR_REDIRECTS set to true (client params), but I can&amp;#39;t consider this a &amp;quot;real&amp;quot; fix.&lt;br/&gt;
&lt;br/&gt;
Here is a snippet of code that exemplifies the problem (use your own proxy):&lt;br/&gt;
&lt;br/&gt;
---&lt;br/&gt;
String proxyHost = &amp;quot;xyz.webfactional.com&amp;quot;;&lt;br/&gt;
int proxyPort = 7295;&lt;br/&gt;
&lt;br/&gt;
DefaultHttpClient httpclient = new DefaultHttpClient();&lt;br/&gt;
// without a proxy it&amp;#39;s OK!&lt;br/&gt;
httpclient.getParams().setParameter(ConnRoutePNames.DEFAULT_PROXY,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;new HttpHost(proxyHost, proxyPort, &amp;quot;http&amp;quot;));&lt;br/&gt;
&lt;br/&gt;
HttpParams params = httpclient.getParams();&lt;br/&gt;
HttpClientParams.setRedirecting(params, true);&lt;br/&gt;
HttpProtocolParams.setUserAgent(params,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.10) Gecko/2009042315 Firefox/3.0.10&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
// OK, this fixes the problem, but at what cost / other problems ?&lt;br/&gt;
//httpclient.getParams().setParameter(ClientPNames.ALLOW_CIRCULAR_REDIRECTS, true);&lt;br/&gt;
&lt;br/&gt;
String url = &amp;quot;&lt;a href=&quot;http://www.seoconsultants.com/w3c/status-codes/301.asp&quot;&gt;http://www.seoconsultants.com/w3c/status-codes/301.asp&lt;/a&gt;&amp;quot;;&lt;br/&gt;
&lt;br/&gt;
HttpUriRequest request;&lt;br/&gt;
HttpResponse response;&lt;br/&gt;
&lt;br/&gt;
request = new HttpGet(url);&lt;br/&gt;
System.out.println(&amp;quot;request = &amp;quot; + request.getRequestLine());&lt;br/&gt;
response = httpclient.execute(request);&lt;br/&gt;
System.out.println(&amp;quot;status = &amp;quot; + response.getStatusLine());&lt;br/&gt;
System.out.println(&amp;quot;headers = &amp;quot; + Arrays.asList(response.getAllHeaders()));&lt;br/&gt;
---</description>
                <environment>Proxy: tinyproxy/1.6.4</environment>
            <key id="12426612">HTTPCLIENT-852</key>
            <summary>CircularRedirectException encountered when using a proxy, but not when reaching the target directly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="sp1tf1r3">Charles Fr Rey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 May 2009 19:31:52 +0100</created>
                <updated>Tue, 25 Jan 2011 10:59:15 +0000</updated>
                    <resolved>Mon, 1 Jun 2009 11:59:19 +0100</resolved>
                            <version>4.0 Beta 2</version>
                                <fixVersion>4.0 Final</fixVersion>
                                <component>HttpClient</component>
                <component>HttpConn</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12714130" author="olegk" created="Thu, 28 May 2009 20:43:05 +0100"  >&amp;gt; I&amp;#39;ve already opened an issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-852&quot; title=&quot;CircularRedirectException encountered when using a proxy, but not when reaching the target directly&quot;&gt;&lt;strike&gt;HTTPCLIENT-852&lt;/strike&gt;&lt;/a&gt;), sorry if that was inappropriate.&lt;br/&gt;
&lt;br/&gt;
Charles,&lt;br/&gt;
That was perfectly appropriate.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; I join with this message 3 logs that show what happens without proxy, with the proxy and with the proxy and the &lt;br/&gt;
&amp;gt; option ALLOW_CIRCULAR_REDIRECTS. &lt;br/&gt;
&lt;br/&gt;
Could you please attach those logs to this report?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12714169" author="sp1tf1r3" created="Thu, 28 May 2009 22:00:23 +0100"  >Here are the logs. (Didn&amp;#39;t see the possibility to attach files at first). I&amp;#39;ve only edited the logs to hide my real proxy host.</comment>
                    <comment id="12714441" author="sp1tf1r3" created="Fri, 29 May 2009 13:51:57 +0100"  >I don&amp;#39;t know if it has something to do with the issue, but there&amp;#39;s something strange that appears in the log (when using the proxy):&lt;br/&gt;
&lt;br/&gt;
[java] 2009/05/28 19:57:13:507 CEST [DEBUG] RequestAddCookies - Cookie [version: 0][name: ASPSESSIONIDCSARBQBA][value: JPLPAMKCADCFBCNFOJBFJPMP][domain: &lt;a href=&quot;http://www.seoconsultants.com&quot;&gt;www.seoconsultants.com&lt;/a&gt;][path: /][expiry: null] match [&lt;a href=&quot;http://www.seoconsultants.com:7295/&quot;&gt;www.seoconsultants.com:7295/&lt;/a&gt;]&lt;br/&gt;
&lt;br/&gt;
7295 is the proxyPort, and shouldn&amp;#39;t have anything to do with the target host in the example (&lt;a href=&quot;http://www.seoconsultants.com&quot;&gt;www.seoconsultants.com&lt;/a&gt;).</comment>
                    <comment id="12714443" author="olegk" created="Fri, 29 May 2009 14:00:52 +0100"  >I examined the logs and that is what I have found so far: &lt;br/&gt;
&lt;br/&gt;
The bug in HttpClient is triggered only when the redirect needs to be retried for some reason, for instance, due to an I/O error. There appears to be a bug Tinyproxy&amp;#39;s connection management code causing a perfectly re-usable HTTP/1.1 connection to be dropped without proper notification of the client. The proxy should have sent the &amp;#39;Connection: close&amp;#39; if it was not going to re-use HTTP/1.1connection). HttpClient assumes that the connection is still good, executes the redirect on the same connection, which fails because the connection has been closed on the proxy side. The second retry fails because HttpClient mistakenly assumes the URI has already been visited.&lt;br/&gt;
&lt;br/&gt;
While Tinyproxy&amp;#39;s behavior is clearly broken, HttpClient should also be able to deal with failed redirects and retry those correctly. The fix for this issue, however, will require quite a bit of refactoring in the DefaultRequestDirector and DefaultRedirectHandler and may take a few days to complete. &lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12714446" author="olegk" created="Fri, 29 May 2009 14:09:20 +0100"  >&amp;gt; [java] 2009/05/28 19:57:13:507 CEST [DEBUG] RequestAddCookies - Cookie [version: 0][name: &lt;br/&gt;
&amp;gt; ASPSESSIONIDCSARBQBA][value: JPLPAMKCADCFBCNFOJBFJPMP][domain: &lt;a href=&quot;http://www.seoconsultants.com&quot;&gt;www.seoconsultants.com&lt;/a&gt;]&lt;br/&gt;
&amp;gt; [path: /][expiry: null] match [&lt;a href=&quot;http://www.seoconsultants.com:7295/&quot;&gt;www.seoconsultants.com:7295/&lt;/a&gt;]&lt;br/&gt;
&lt;br/&gt;
&amp;gt; 7295 is the proxyPort, and shouldn&amp;#39;t have anything to do with the target host in the example &lt;br/&gt;
&amp;gt; (&lt;a href=&quot;http://www.seoconsultants.com&quot;&gt;www.seoconsultants.com&lt;/a&gt;). &lt;br/&gt;
&lt;br/&gt;
Charles,&lt;br/&gt;
&lt;br/&gt;
Please raise a separate JIRA for this issue.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12714576" author="sp1tf1r3" created="Fri, 29 May 2009 21:13:40 +0100"  >Thanks for your feedback. I appreciate the good work put in this library and will do everything I can to help improve it.</comment>
                    <comment id="12715058" author="olegk" created="Mon, 1 Jun 2009 11:59:19 +0100"  >Charles,&lt;br/&gt;
&lt;br/&gt;
I found a bug in the DefaultHttpRequestDirector that caused that issue. Fortunately, the fix was fairly minor in scope. No refactoring was necessary. &lt;br/&gt;
&lt;br/&gt;
Could you please re-test your application with the latest code snapshot and confirm the issue has been resolved?&lt;br/&gt;
&lt;br/&gt;
You can find compiled snapshots here:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/httpcomponents/httpclient/4.0-beta3-SNAPSHOT/&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/httpcomponents/httpclient/4.0-beta3-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12715479" author="sp1tf1r3" created="Tue, 2 Jun 2009 12:12:57 +0100"  >OK, seems fixed, that&amp;#39;s great!</comment>
                </comments>
                    <attachments>
                    <attachment id="12409301" name="withoutproxy.log" size="7572" author="sp1tf1r3" created="Thu, 28 May 2009 22:00:23 +0100" />
                    <attachment id="12409303" name="withproxyALLOW_CIRC_RED.log" size="14005" author="sp1tf1r3" created="Thu, 28 May 2009 22:00:23 +0100" />
                    <attachment id="12409302" name="withproxy.log" size="10877" author="sp1tf1r3" created="Thu, 28 May 2009 22:00:23 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 28 May 2009 19:43:05 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133869</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47395</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>