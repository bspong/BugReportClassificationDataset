<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:20:59 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-776/HTTPCLIENT-776.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-776] NPE w/ AbstractPoolEntry.open</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-776</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>java.lang.NullPointerException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:171)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPooledConnAdapter.open(AbstractPooledConnAdapter.java:119)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.DefaultClientRequestDirector.execute(DefaultClientRequestDirector.java:309)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:501)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:456)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:422)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor.performRequest(DefaultHttpExecutor.java:97)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor.access$000(DefaultHttpExecutor.java:26)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor$MultiRequestor.run(DefaultHttpExecutor.java:135)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.limewire.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1006)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.limewire.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:549)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
&lt;br/&gt;
Seeing a lot of these against Alpha4.  Also seeing still the occassional IllegalStateException of:&lt;br/&gt;
&lt;br/&gt;
java.lang.IllegalStateException: Connection already open.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:150)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.conn.AbstractPooledConnAdapter.open(AbstractPooledConnAdapter.java:119)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.DefaultClientRequestDirector.execute(DefaultClientRequestDirector.java:309)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:501)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:456)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:422)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor.performRequest(DefaultHttpExecutor.java:97)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor.access$000(DefaultHttpExecutor.java:26)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.limegroup.gnutella.http.DefaultHttpExecutor$MultiRequestor.run(DefaultHttpExecutor.java:135)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.limewire.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1006)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at org.limewire.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:549)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12396423">HTTPCLIENT-776</key>
            <summary>NPE w/ AbstractPoolEntry.open</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="sberlin">Sam Berlin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 May 2008 16:49:56 +0100</created>
                <updated>Tue, 25 Jan 2011 10:58:59 +0000</updated>
                    <resolved>Wed, 21 May 2008 18:33:08 +0100</resolved>
                            <version>4.0 Alpha 4</version>
                                <fixVersion>4.0 Beta 1</fixVersion>
                                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12598339" author="sberlin" created="Tue, 20 May 2008 16:55:39 +0100"  >The only possible way I can see the NPE happening is if the AbstractPoolEntry instance gets into open(HttpRoute, HttpContext, HttpParams), gets through to line 161: this.tracker = new RouteTracker(route) ... and then another thread calls calls resetTrackedRoute on the same AbstractPoolEntry before the open(..) thread continues to line 171.</comment>
                    <comment id="12598357" author="sberlin" created="Tue, 20 May 2008 17:53:28 +0100"  >The NPE can happen if another thread calls AbortableHttpRequest.abort() while AbstractPoolEntry is in the process of opening.  &lt;br/&gt;
&lt;br/&gt;
The abort flow is:&lt;br/&gt;
&amp;nbsp;HttpRequestBase.abort  -&amp;gt; ConnectionReleaseTrigger.abortConnection -&amp;gt; AbstractClientConnAdapter.abortConnection -&amp;gt; AbstractPooledConnAdapter.shutdown -&amp;gt; AbstractPoolEntry.resetTrackedRoute&lt;br/&gt;
&lt;br/&gt;
The request flow can get into open() from another thread, leaving it open to tracker becoming null at any time.&lt;br/&gt;
&lt;br/&gt;
... not completely sure right now how to fix it.</comment>
                    <comment id="12598414" author="sberlin" created="Tue, 20 May 2008 20:15:26 +0100"  >Attached is a testcase that reproduces the problem -- testAbortBeforeSocketCreate is throwing the NPE right now.  I&amp;#39;m really not positive how to fix it (but am still looking into it).   The basic problem is that you can abort the request before DefaultClientConnectionOperator creates the socket, which means that the socket isn&amp;#39;t closed or marked as should-be-closed when the request is aborted.  This means that when after abort is called, openConnection still continues as normal &amp;amp; connects to the host, then it goes back to AbstractPoolEntry.open, where tracker is null &amp;amp; throws the NPE.&lt;br/&gt;
&lt;br/&gt;
(I&amp;#39;m not marking the attachment as intended for inclusion, because there&amp;#39;s still some more testcases, and hopefully some fixes, that I want to write.)</comment>
                    <comment id="12598458" author="sberlin" created="Tue, 20 May 2008 21:45:22 +0100"  >Looks like this change: &lt;a href=&quot;http://fisheye6.cenqua.com/browse/httpcomponents/httpclient/trunk/module-client/src/main/java/org/apache/http/impl/conn/AbstractClientConnAdapter.java?ignore1=B&amp;ignore2=b&amp;r1=652020&amp;r2=652945&amp;u=3&quot;&gt;http://fisheye6.cenqua.com/browse/httpcomponents/httpclient/trunk/module-client/src/main/java/org/apache/http/impl/conn/AbstractClientConnAdapter.java?ignore1=B&amp;amp;ignore2=b&amp;amp;r1=652020&amp;amp;r2=652945&amp;amp;u=3&lt;/a&gt; caused it.  I think the change is a good one, but had the side effect of causing tracker to be nulled out, which exposes the problem.</comment>
                    <comment id="12598463" author="olegk" created="Tue, 20 May 2008 21:58:39 +0100"  >Since it&amp;#39;s reproducible, we can surely fix it. If you do not come up with a fix, I&amp;#39;ll look into it in the coming days.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12598510" author="sberlin" created="Tue, 20 May 2008 23:26:10 +0100"  >The attached patch should fix the problems, plus adds a few new tests (two of which would have failed before).&lt;br/&gt;
&lt;br/&gt;
Basically I captured the &amp;#39;shutdown&amp;#39; event in DefaultClientConnection and prevent opening(..) from completely succesfully if the connection was shutdown prior to an opening announcement.  Also in AbstractPoolEntry we check for &amp;#39;tracker&amp;#39; becoming null and fail after the operator connects if tracker became null.  With respect to AbstractPoolEntry, it&amp;#39;s not completely clear that a side effect of &amp;#39;resetTrackedRoute&amp;#39; will prevent open(..) from completing, so I added it to the javadoc.  A better way would be renaming it to something like shutdownEntry().   It was previously called &amp;#39;closing&amp;#39; (before resetTrackedRoute), meaning it was notification that something external was being shutdown... but it&amp;#39;s kind of active itself, given that there&amp;#39;s an open(..) method that can be aborted due to it.&lt;br/&gt;
&lt;br/&gt;
(I&amp;#39;d check this in, but haven&amp;#39;t gotten any notifications about an account setup yet. Sorry!)</comment>
                    <comment id="12598723" author="olegk" created="Wed, 21 May 2008 18:33:08 +0100"  >Patch checked in. Many thanks, Sam&lt;br/&gt;
&lt;br/&gt;
I am sorry it has been taking so long to get your account set up. Only Erik can request a new account creation and he still appears off-line.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12382420" name="changes.txt" size="22800" author="sberlin" created="Tue, 20 May 2008 23:26:10 +0100" />
                    <attachment id="12382406" name="changes.txt" size="15163" author="sberlin" created="Tue, 20 May 2008 20:15:26 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Tue, 20 May 2008 20:58:39 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133811</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47420</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>