<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:12:54 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1103/HTTPCLIENT-1103.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1103] GzipDecompressingEntity (and therefore ContentEncodingHttpClient) not consistent with EntityUtils.consumeEntity</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1103</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Invoking EntityUtils.consume( entity ) after a previous call to entity.getContent (and subsequent processing of the content) throws a java.io.EOFException when gzip decompression support is enabled via ContentEncodingHttpClient or some similar mechanism.  I invoke EntityUtils.consume in a &amp;#39;finally&amp;#39; block - maybe I&amp;#39;m not using the API correctly ... ?  &lt;br/&gt;
&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
	at java.util.zip.GZIPInputStream.readUByte(GZIPInputStream.java:207)&lt;br/&gt;
	at java.util.zip.GZIPInputStream.readUShort(GZIPInputStream.java:197)&lt;br/&gt;
	at java.util.zip.GZIPInputStream.readHeader(GZIPInputStream.java:136)&lt;br/&gt;
	at java.util.zip.GZIPInputStream.&amp;lt;init&amp;gt;(GZIPInputStream.java:58)&lt;br/&gt;
	at java.util.zip.GZIPInputStream.&amp;lt;init&amp;gt;(GZIPInputStream.java:68)&lt;br/&gt;
	at org.apache.http.client.entity.GzipDecompressingEntity.getContent(GzipDecompressingEntity.java:63)&lt;br/&gt;
	at org.apache.http.conn.BasicManagedEntity.getContent(BasicManagedEntity.java:88)&lt;br/&gt;
	at org.apache.http.util.EntityUtils.consume(EntityUtils.java:65)&lt;br/&gt;
&lt;br/&gt;
I believe the problem is that the underlying DecompressingEntity allocates a new GzipInputStream for each call to getContent, rather than caching the stream created by the first getContent call.  &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk/httpclient/src/main/java/org/apache/http/client/entity/DecompressingEntity.java&quot;&gt;http://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk/httpclient/src/main/java/org/apache/http/client/entity/DecompressingEntity.java&lt;/a&gt;&lt;br/&gt;
The &amp;quot;CustomProtocolInterceptors&amp;quot; example has the same bug:  &lt;a href=&quot;http://hc.apache.org/httpcomponents-client-ga/examples.html&quot;&gt;http://hc.apache.org/httpcomponents-client-ga/examples.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I worked around the problem implementing the example with my own GzipDecompressingEntity (scala code - lazy value not evaluated till accessed):&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;class GzipDecompressingEntity( entity:http.HttpEntity) extends http.entity.HttpEntityWrapper(entity) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private lazy val gzipStream = new GZIPInputStream( entity.getContent() )&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/** &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Wrap entity stream in GZIPInputStream&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;override def getContent():java.io.InputStream = gzipStream&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/**&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Return -1 - don&amp;#39;t know unzipped content size&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*/&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;override def getContentLength():Long = -1L&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment>jdk6</environment>
            <key id="12511179">HTTPCLIENT-1103</key>
            <summary>GzipDecompressingEntity (and therefore ContentEncodingHttpClient) not consistent with EntityUtils.consumeEntity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="catdogboy">Reuben Pasquini</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jun 2011 23:33:22 +0100</created>
                <updated>Wed, 22 Jun 2011 19:55:46 +0100</updated>
                    <resolved>Wed, 22 Jun 2011 17:47:54 +0100</resolved>
                            <version>4.1.1</version>
                                <fixVersion>4.1.2</fixVersion>
                <fixVersion>4.2 Alpha1</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13053186" author="olegk" created="Wed, 22 Jun 2011 12:17:24 +0100"  >I think this issue is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1075&quot; title=&quot;ContentEncodingHttpClient.execute(HttpGet, ResponseHandler&amp;lt;T&amp;gt;) throws IOException when reading compressed response&quot;&gt;&lt;strike&gt;HTTPCLIENT-1075&lt;/strike&gt;&lt;/a&gt;. Could you please retest your application with the latest SVN snapshot (either off trunk or 4.1.x branch) and let me know if that fixes the problem for you?&lt;br/&gt;
&lt;br/&gt;
Oleg  </comment>
                    <comment id="13053339" author="catdogboy" created="Wed, 22 Jun 2011 17:46:22 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
Thanks for the quick response.  Yes - you&amp;#39;re right - a build from SVN runs fine for me.  I don&amp;#39;t suppose there&amp;#39;s an ETA for a 4.1.2 or 4.2 publish to maven.org ?&lt;br/&gt;
&lt;br/&gt;
Thanks again!&lt;br/&gt;
&lt;br/&gt;
Cheers,&lt;br/&gt;
Reuben&lt;br/&gt;
</comment>
                    <comment id="13053341" author="catdogboy" created="Wed, 22 Jun 2011 17:47:54 +0100"  >Oleg already fixed this in SVN for a previous ticket ...</comment>
                    <comment id="13053395" author="olegk" created="Wed, 22 Jun 2011 19:55:46 +0100"  >We are probably looking at the second half of July as a likely release time-frame for 4.1.2 and Q1 2012 for 4.2&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 22 Jun 2011 11:17:24 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>70240</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47007</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>