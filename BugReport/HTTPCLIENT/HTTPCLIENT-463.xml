<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:17:45 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-463/HTTPCLIENT-463.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-463] Occasional &quot;Host connection pool not found&quot;</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-463</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>I&amp;#39;m using HttpClient with MultiThreadedHttpConnectionManager in a crawler&lt;br/&gt;
application. The application issues requests to many hosts, in 10-20 parallel&lt;br/&gt;
request threads. Each thread creates a new GetMethod, but all threads use the&lt;br/&gt;
same instance of HttpClient, created once with a multi-threaded manager.&lt;br/&gt;
&lt;br/&gt;
The code in each thread looks like this:&lt;br/&gt;
&lt;br/&gt;
GetMethod get = new GetMethod(url);&lt;br/&gt;
try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;int code = getSharedHttpClient().executeMethod(get);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// ... read response, do stuff&lt;br/&gt;
} finally {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;get.releaseConnection();&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
From time to time I get an error like this:&lt;br/&gt;
&lt;br/&gt;
Host connection pool not found, hostConfig=HostConfiguration[host=&lt;a href=&quot;http://a.b.c&quot;&gt;http://a.b.c&lt;/a&gt;]&lt;br/&gt;
&lt;br/&gt;
where the url is a random url from my fetch list. I looked into the source code&lt;br/&gt;
of the nightly release (MultiThreadedHttpConnectionManager.java:979), but the&lt;br/&gt;
comment there is not enlightening... ;-) Any help or suggestions for further&lt;br/&gt;
debugging would be appreciated.</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12334022">HTTPCLIENT-463</key>
            <summary>Occasional &quot;Host connection pool not found&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="ab@getopt.org">Andrzej Bialecki</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 May 2005 18:50:19 +0100</created>
                <updated>Wed, 16 Feb 2011 20:45:07 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:02 +0100</resolved>
                            <version>Snapshot</version>
                                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382344" author="oglueck" created="Fri, 27 May 2005 17:43:59 +0100"  >Could this be a race condition, i.e. do we need more synchronization? Michael?</comment>
                    <comment id="12382345" author="becke@u.washington.edu" created="Sun, 29 May 2005 14:22:31 +0100"  >I definitely don&amp;#39;t think we need more synchronization.  The MTHCM is chock full of that already.  &lt;br/&gt;
Getting this error message is quite strange, as it should not been seen under normal working &lt;br/&gt;
conditions.  As far as I can tell, the only way it will happen is if a connection is returned to the wrong &lt;br/&gt;
connection manager, or if a connection&amp;#39;s host/port/protocol/proxy is changed after it is checked out.&lt;br/&gt;
&lt;br/&gt;
Andrzej, could you give us a little more detail about your application, and also attempt to rule out the &lt;br/&gt;
above two scenarios?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382346" author="ab@getopt.org" created="Sun, 29 May 2005 17:17:07 +0100"  >Created an attachment (id=15199)&lt;br/&gt;
Nutch protocol-httpclient handler&lt;br/&gt;
&lt;br/&gt;
The application in question is Nutch (&lt;a href=&quot;http://www.nutch.org&quot;&gt;http://www.nutch.org&lt;/a&gt;). I&amp;#39;m porting it&amp;#39;s&lt;br/&gt;
HTTP protocol handler to use httpclient.&lt;br/&gt;
&lt;br/&gt;
I attached the protocol-http source code here. It&amp;#39;s full of Nutch-specific&lt;br/&gt;
classes, but at least it will give you an idea of the control flow. The method&lt;br/&gt;
Http.getProtocolOutput() is called repeatedly, from multiple threads, in order&lt;br/&gt;
to retrieve the page content.</comment>
                    <comment id="12382347" author="olegk" created="Sun, 29 May 2005 21:48:28 +0100"  >Mike,&lt;br/&gt;
Can it be that hostCode/equals methods of HostConfiguration class contribute to&lt;br/&gt;
this problem? &lt;br/&gt;
&lt;br/&gt;
As I just realized this patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-441&quot; title=&quot;Cookie.java hashCode method violates contract&quot;&gt;&lt;strike&gt;HTTPCLIENT-441&lt;/strike&gt;&lt;/a&gt;) may have not completely solved the&lt;br/&gt;
issue and may have produced some side effects on the way MTHCM functions&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382348" author="olegk" created="Sun, 29 May 2005 21:50:42 +0100"  >Created an attachment (id=15200)&lt;br/&gt;
HostConfiguration hashCode/equals fix&lt;br/&gt;
&lt;br/&gt;
Andrzej,&lt;br/&gt;
Could you please test this patch against SVN trunk or the latest nightly in&lt;br/&gt;
your environment?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382349" author="becke@u.washington.edu" created="Mon, 30 May 2005 14:22:50 +0100"  >I&amp;#39;m not sure if this is the problem or not.  An error in HostConfiguration.equals() would certainly cause &lt;br/&gt;
problems with the MTHCM, but nothing appears have been wrong.  What problem in equals() is this &lt;br/&gt;
patch fixing?&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382350" author="olegk" created="Mon, 30 May 2005 18:14:07 +0100"  >Mike, &lt;br/&gt;
Presently #hashCode of HostConfiguration does not include localAddress attribute&lt;br/&gt;
into hash computation, whereas #equals does compare localAddress attributes,&lt;br/&gt;
which, I believe, is a violation of hashCode/equals contract. I took liberty of&lt;br/&gt;
changing #equals method to make it slightly more readable while checking on the&lt;br/&gt;
correctness of its implementation. I am not saying #equals method is broken in&lt;br/&gt;
any way. It is just not easy to see what is going on in the code&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382351" author="ab@getopt.org" created="Tue, 31 May 2005 09:06:16 +0100"  >Thanks for the patch! I&amp;#39;m running a test crawl with this patch, so far it&amp;#39;s&lt;br/&gt;
running well. I&amp;#39;ll let you know when it finishes, it could take another day or so.</comment>
                    <comment id="12382352" author="rolweber@de.ibm.com" created="Wed, 1 Jun 2005 01:55:09 +0100"  >Hi Oleg,&lt;br/&gt;
&lt;br/&gt;
different objects are allowed to return the same hash code. So it&lt;br/&gt;
is OK for hashCode() to omit attributes considered by equals().&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland</comment>
                    <comment id="12382353" author="ab@getopt.org" created="Thu, 2 Jun 2005 06:17:43 +0100"  >After applying the patch and testing, the problem didn&amp;#39;t occur, so it appears to&lt;br/&gt;
fix it. I suggest applying this patch to the trunk, and close the issue for now&lt;br/&gt;
- if the problem appears again, I&amp;#39;ll re-open this issue.&lt;br/&gt;
&lt;br/&gt;
Thank you!</comment>
                    <comment id="12382354" author="olegk" created="Thu, 2 Jun 2005 06:33:35 +0100"  >Andrzej,&lt;br/&gt;
Curiously enough, as Roland pointed out the patch actually should not make any&lt;br/&gt;
difference. It does make #hashCode a little more efficient and #equals a bit&lt;br/&gt;
more readable, but should have no effect on HashMap lookups. I believe the patch&lt;br/&gt;
should be checked in, but it still does not explain the cause of the problem&lt;br/&gt;
&lt;br/&gt;
Mike et al, do you have any objections to committing the patch?&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12382355" author="becke@u.washington.edu" created="Thu, 2 Jun 2005 06:46:45 +0100"  >The patch looks good to me.  As you say it just cleans up the code some.  What&lt;br/&gt;
exactly is causing the problem here is a mystery to me.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382356" author="olegk" created="Thu, 2 Jun 2005 08:19:06 +0100"  >Patch committed. &lt;br/&gt;
&lt;br/&gt;
Andrzej, could you please test your application with the latest SVN snapshot and&lt;br/&gt;
let us know if the problem still persists?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382357" author="olegk" created="Wed, 8 Jun 2005 03:53:03 +0100"  >Andrzej,&lt;br/&gt;
&lt;br/&gt;
Feel free to reopen the report if some new data becomes available&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327240" name="ASF.LICENSE.NOT.GRANTED--hostconfig.patch" size="2390" author="olegk" created="Sun, 29 May 2005 21:50:42 +0100" />
                    <attachment id="12327239" name="ASF.LICENSE.NOT.GRANTED--src.zip" size="20179" author="ab@getopt.org" created="Sun, 29 May 2005 17:17:07 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>35057</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 27 May 2005 16:43:59 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133510</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47069</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>