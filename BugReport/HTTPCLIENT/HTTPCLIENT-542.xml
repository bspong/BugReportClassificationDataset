<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:18:33 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-542/HTTPCLIENT-542.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-542] Explicit VirtualHosts Can Cause Issues On Redirects</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-542</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>If you set an explicit virtual host then a getmethod may get stuck in a redirect&lt;br/&gt;
loop (up to maxRedirects).&lt;br/&gt;
&lt;br/&gt;
e.g. execute a get on &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt; (with a &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt; virtualhost).  That&lt;br/&gt;
redirects to &lt;a href=&quot;http://www.google.co.nz&quot;&gt;www.google.co.nz&lt;/a&gt; (at least if you come from an NZ IP).  The current&lt;br/&gt;
httpclient behavior is to then connect to &lt;a href=&quot;http://www.google.co.nz&quot;&gt;www.google.co.nz&lt;/a&gt; but pass through,&lt;br/&gt;
with the request, &amp;quot;Host: &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&amp;quot;.  Google will then reply with another&lt;br/&gt;
&lt;a href=&quot;http://www.google.co.nz&quot;&gt;www.google.co.nz&lt;/a&gt; redirect and the loop continues.&lt;br/&gt;
&lt;br/&gt;
There are probably a few ways to work around this.  It seems reasonable to drop&lt;br/&gt;
an explicity set virtual host in the event a redirect redirects to a different&lt;br/&gt;
uri authority.  The following patch works for me:&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
diff -Naur&lt;br/&gt;
../../t2/commons-httpclient/src/java/org/apache/commons/httpclient/HttpMethodDirector.java&lt;br/&gt;
src/java/org/apache/commons/httpclient/HttpMethodDirector.java&lt;br/&gt;
---&lt;br/&gt;
../../t2/commons-httpclient/src/java/org/apache/commons/httpclient/HttpMethodDirector.java&lt;br/&gt;
2005-12-22 01:06:55.000000000 +1300&lt;br/&gt;
+++ src/java/org/apache/commons/httpclient/HttpMethodDirector.java	2005-12-22&lt;br/&gt;
19:09:51.000000000 +1300&lt;br/&gt;
@@ -605,6 +605,27 @@&lt;br/&gt;
&amp;nbsp;					redirectUri = new URI(currentUri, redirectUri);&lt;br/&gt;
&amp;nbsp;				}&lt;br/&gt;
&amp;nbsp;			}&lt;br/&gt;
+            do {&lt;br/&gt;
+                // scenario we&amp;#39;re trying to avoid:&lt;br/&gt;
+                // virtual host is set (e.g. google.com); a request to that&lt;br/&gt;
server responds&lt;br/&gt;
+                // with a redirect to google.co.nz; we issue a request to&lt;br/&gt;
google.co.nz with &lt;br/&gt;
+                // a virtual host request of google.com&lt;br/&gt;
+                // &lt;br/&gt;
+                // This code will remove any set virtual host if the redirect&lt;br/&gt;
is to a different &lt;br/&gt;
+                // domain&lt;br/&gt;
+&lt;br/&gt;
+                if(redirectUri.isRelativeURI()) {&lt;br/&gt;
+                    break;&lt;br/&gt;
+                }&lt;br/&gt;
+&lt;br/&gt;
+                String vhost = hostConfiguration.getParams().getVirtualHost();&lt;br/&gt;
+                if(vhost==null)&lt;br/&gt;
+                    break;&lt;br/&gt;
+                if(redirectUri.getAuthority()!=currentUri.getAuthority()) {&lt;br/&gt;
+                    hostConfiguration.getParams().setVirtualHost(null);&lt;br/&gt;
+                }&lt;br/&gt;
+            } while(false);&lt;br/&gt;
+</description>
                <environment>Operating System: other&lt;br/&gt;
Platform: Other</environment>
            <key id="12334101">HTTPCLIENT-542</key>
            <summary>Explicit VirtualHosts Can Cause Issues On Redirects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="p.issues.apache.org@rimuhosting.com">Peter Bryant</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Dec 2005 15:29:34 +0000</created>
                <updated>Wed, 16 Feb 2011 20:45:07 +0000</updated>
                    <resolved>Sun, 22 Apr 2007 08:11:13 +0100</resolved>
                            <version>Snapshot</version>
                                <fixVersion>3.0.1</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12382969" author="olegk" created="Thu, 22 Dec 2005 18:43:47 +0000"  >Please provide a test case (or a wire log) to demonstrate the problem&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382970" author="p.issues.apache.org@rimuhosting.com" created="Thu, 22 Dec 2005 20:13:48 +0000"  >Request to &lt;a href=&quot;http://google.com/&quot;&gt;http://google.com/&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
input/output: GET / HTTP/1.1&lt;br/&gt;
User-Agent: Jakarta Commons-HttpClient/3.0&lt;br/&gt;
Host: google.com&lt;br/&gt;
&lt;br/&gt;
HTTP/1.1 301 Moved Permanently&lt;br/&gt;
Location: &lt;a href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&lt;br/&gt;
Set-Cookie:&lt;br/&gt;
PREF=ID=1f19f8bb9ac951a9:TM=1135227992:LM=1135227992:S=Ly6FRGzsKeYnIlWw;&lt;br/&gt;
expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com&lt;br/&gt;
Content-Type: text/html&lt;br/&gt;
Server: GWS/2.1&lt;br/&gt;
Content-Length: 222&lt;br/&gt;
Date: Thu, 22 Dec 2005 05:06:32 GMT&lt;br/&gt;
&lt;br/&gt;
&amp;lt;HTML&amp;gt;&amp;lt;HEAD&amp;gt;&amp;lt;meta http-equiv=&amp;quot;content-type&amp;quot; content=&amp;quot;text/html;charset=us-ascii&amp;quot;&amp;gt;&lt;br/&gt;
&amp;lt;TITLE&amp;gt;301 Moved&amp;lt;/TITLE&amp;gt;&amp;lt;/HEAD&amp;gt;&amp;lt;BODY&amp;gt;&lt;br/&gt;
&amp;lt;H1&amp;gt;301 Moved&amp;lt;/H1&amp;gt;&lt;br/&gt;
The document has moved&lt;br/&gt;
&amp;lt;A HREF=&amp;quot;&lt;a href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&amp;quot;&amp;gt;here&amp;lt;/A&amp;gt;.&lt;br/&gt;
&amp;lt;/BODY&amp;gt;&amp;lt;/HTML&amp;gt;&lt;br/&gt;
&lt;br/&gt;
Redirect attempt (to &lt;a href=&quot;http://www.google.com,&quot;&gt;www.google.com,&lt;/a&gt; note the code is still passing google.com&lt;br/&gt;
as the Host)&lt;br/&gt;
GET / HTTP/1.1&lt;br/&gt;
User-Agent: Jakarta Commons-HttpClient/3.0&lt;br/&gt;
Host: google.com&lt;br/&gt;
&lt;br/&gt;
HTTP/1.1 301 Moved Permanently&lt;br/&gt;
Location: &lt;a href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&lt;br/&gt;
Set-Cookie:&lt;br/&gt;
PREF=ID=74be7d5195fba646:TM=1135227996:LM=1135227996:S=b8jDlWu8OEBw6erI;&lt;br/&gt;
expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com&lt;br/&gt;
Content-Type: text/html&lt;br/&gt;
Server: GWS/2.1&lt;br/&gt;
Content-Length: 222&lt;br/&gt;
Date: Thu, 22 Dec 2005 05:06:36 GMT&lt;br/&gt;
&lt;br/&gt;
&amp;lt;HTML&amp;gt;&amp;lt;HEAD&amp;gt;&amp;lt;meta http-equiv=&amp;quot;content-type&amp;quot; content=&amp;quot;text/html;charset=us-ascii&amp;quot;&amp;gt;&lt;br/&gt;
&amp;lt;TITLE&amp;gt;301 Moved&amp;lt;/TITLE&amp;gt;&amp;lt;/HEAD&amp;gt;&amp;lt;BODY&amp;gt;&lt;br/&gt;
&amp;lt;H1&amp;gt;301 Moved&amp;lt;/H1&amp;gt;&lt;br/&gt;
The document has moved&lt;br/&gt;
&amp;lt;A HREF=&amp;quot;&lt;a href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&amp;quot;&amp;gt;here&amp;lt;/A&amp;gt;.&lt;br/&gt;
&amp;lt;/BODY&amp;gt;&amp;lt;/HTML&amp;gt;&lt;br/&gt;
&lt;br/&gt;
And so it will continue.  Google will adamantly redirect you to &lt;a href=&quot;http://www.google.com,&quot;&gt;www.google.com,&lt;/a&gt;&lt;br/&gt;
httpclient will adamantly request the google.com host.&lt;br/&gt;
</comment>
                    <comment id="12382971" author="olegk" created="Thu, 22 Dec 2005 21:55:40 +0000"  >Peter,&lt;br/&gt;
Could you please attach the test code as well?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382972" author="p.issues.apache.org@rimuhosting.com" created="Thu, 22 Dec 2005 22:08:18 +0000"  >Created an attachment (id=17260)&lt;br/&gt;
test code&lt;br/&gt;
</comment>
                    <comment id="12382973" author="p.issues.apache.org@rimuhosting.com" created="Thu, 22 Dec 2005 22:13:46 +0000"  >note: the attached foo.java file will reproduce the problem.  &lt;br/&gt;
&lt;br/&gt;
As an aside it causes complaints about cookies (WARNING: Cookie rejected:&lt;br/&gt;
&amp;quot;$Version=0;&lt;br/&gt;
REF=ID=907888a1032f157b:TM=1135256845:LM=1135256845:S=gSqOk4-s42mhCarE; $Path=/;&lt;br/&gt;
$Domain=.google.com&amp;quot;. Illegal domain attribute &amp;quot;.google.com&amp;quot;. Domain of origin:&lt;br/&gt;
&amp;quot;google.com&amp;quot;).  &lt;br/&gt;
&lt;br/&gt;
Is httpclient sending back cookies that were sent to it?  After a redirect?  If&lt;br/&gt;
so then I&amp;#39;m not sure how you&amp;#39;d handle things if the domain changes.  e.g. a&lt;br/&gt;
cookie set on google.com should probably not be passed onto example.com after a&lt;br/&gt;
redirect.  But what about a redirect to subdir.google.com?  In this case I think&lt;br/&gt;
there may be something worth investigating in the cookiespec classes.</comment>
                    <comment id="12382974" author="olegk" created="Thu, 22 Dec 2005 22:26:29 +0000"  >(In reply to comment #5)&lt;br/&gt;
&amp;gt; note: the attached foo.java file will reproduce the problem.  &lt;br/&gt;
&lt;br/&gt;
I suspect this problem again boils down to which host HttpClient interprets as a&lt;br/&gt;
target host and a virtual one given the ambiguous configuration. I&amp;#39;ll run a few&lt;br/&gt;
tests at home this evening to investigate further&lt;br/&gt;
&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; As an aside it causes complaints about cookies (WARNING: Cookie rejected:&lt;br/&gt;
&amp;gt; &amp;quot;$Version=0;&lt;br/&gt;
&amp;gt; REF=ID=907888a1032f157b:TM=1135256845:LM=1135256845:S=gSqOk4-s42mhCarE; $Path=/;&lt;br/&gt;
&amp;gt; $Domain=.google.com&amp;quot;. Illegal domain attribute &amp;quot;.google.com&amp;quot;. Domain of origin:&lt;br/&gt;
&amp;gt; &amp;quot;google.com&amp;quot;).  &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&lt;br/&gt;
This is yet another issue that has been beaten to death on numerous occasions.&lt;br/&gt;
Per RFC 2109 policy the &amp;quot;.google.com&amp;quot; domain attribute is not valid for the&lt;br/&gt;
target host &amp;quot;google.com&amp;quot;. Use a more lenient &amp;#39;browser compatibility&amp;#39; policy instead&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382975" author="p.issues.apache.org@rimuhosting.com" created="Fri, 23 Dec 2005 04:55:43 +0000"  >The problem is because httpclient is using the explicity set virtualhost.  My&lt;br/&gt;
initial post has code which resolves the problem in case  you missed that.</comment>
                    <comment id="12382976" author="olegk" created="Fri, 23 Dec 2005 07:45:07 +0000"  >Created an attachment (id=17267)&lt;br/&gt;
Patch (take 1)&lt;br/&gt;
&lt;br/&gt;
The patch takes care of the problem. I&amp;#39;ll hack up a test case sometime this&lt;br/&gt;
weekend, unless someone else beats me to it (read, volunteers welcome)&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382977" author="olegk" created="Wed, 28 Dec 2005 00:09:37 +0000"  >Created an attachment (id=17286)&lt;br/&gt;
Patch (take 1) + test case&lt;br/&gt;
&lt;br/&gt;
Please review&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12382978" author="oglueck" created="Sun, 8 Jan 2006 00:45:30 +0000"  >looks ok</comment>
                    <comment id="12382979" author="becke@u.washington.edu" created="Sun, 8 Jan 2006 02:32:41 +0000"  >Yep, fine with me.&lt;br/&gt;
&lt;br/&gt;
Mike</comment>
                    <comment id="12382980" author="olegk" created="Sun, 8 Jan 2006 03:13:50 +0000"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12327357" name="ASF.LICENSE.NOT.GRANTED--foo.java" size="858" author="p.issues.apache.org@rimuhosting.com" created="Thu, 22 Dec 2005 22:08:18 +0000" />
                    <attachment id="12327359" name="ASF.LICENSE.NOT.GRANTED--virtualhost.patch" size="5593" author="olegk" created="Wed, 28 Dec 2005 00:09:37 +0000" />
                    <attachment id="12327358" name="ASF.LICENSE.NOT.GRANTED--virtualhost.patch" size="900" author="olegk" created="Fri, 23 Dec 2005 07:45:07 +0000" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>3.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                <customfieldname>Bugzilla Id</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>38004</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Thu, 22 Dec 2005 18:43:47 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133586</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47072</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>