<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:22:48 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-978/HTTPCLIENT-978.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-978] provide an ehcache implementation for HttpCache</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-978</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Provide an implementation of the HttpCache interface that stores cache entries in ehcache.&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12471324">HTTPCLIENT-978</key>
            <summary>provide an ehcache implementation for HttpCache</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="cimjmoore">Jonathan Moore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2010 18:32:37 +0100</created>
                <updated>Tue, 25 Jan 2011 11:00:17 +0000</updated>
                    <resolved>Sat, 21 Aug 2010 21:32:49 +0100</resolved>
                                            <fixVersion>4.1 Beta1</fixVersion>
                                <component>HttpCache</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>4</watches>
                                                    <comments>
                    <comment id="12897350" author="cimjmoore" created="Wed, 11 Aug 2010 18:34:01 +0100"  >Again, we have some code we are dusting off to solidify (and adhere to the updated HttpCache interface) and contribute.&lt;br/&gt;
&lt;br/&gt;
Major question to answer is how the contribution should be structured:&lt;br/&gt;
(a) new top-level module in httpcomponents-client (e.g. httpclient-cache-ehcache)?&lt;br/&gt;
(b) new sub-package as part of httpclient-cache?&lt;br/&gt;
</comment>
                    <comment id="12897383" author="olegk" created="Wed, 11 Aug 2010 19:49:24 +0100"  >Both options are possible. If we are talking just two to three impl classes a whole new module might be on overkill, so option B would be preferred.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12897812" author="cim_michajlomatijkiw" created="Thu, 12 Aug 2010 17:11:15 +0100"  >This patch adds the package org.apache.http.impl.client.cache.ehcache, and a few tests for it.  The package contains a single class, EhcacheHttpCache, which is a simple HttpCache implementation build around ehcache.  The pom.xml was also updated to add the ehcache java interface and its dependency, slf4j.  There are a total of 2 new files, and one modified.&lt;br/&gt;
&lt;br/&gt;
This patch is contributed with the permission of my employer.</comment>
                    <comment id="12897975" author="olegk" created="Thu, 12 Aug 2010 23:10:02 +0100"  >Michajlo &lt;br/&gt;
&lt;br/&gt;
There has been a number of changes to the caching API. Could you please rebuild your patch based the latest code snapshot from SVN trunk?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12898357" author="cim_michajlomatijkiw" created="Fri, 13 Aug 2010 19:41:03 +0100"  >Sorry about that, I have attached the updated patch against the trunk.&lt;br/&gt;
&lt;br/&gt;
Most remains the same from the last cache, I have made all of EhcacheHttpCache&amp;#39;s operations synchronized.  I have also added another test which runs the protocol requirement tests against a CachingHttpClientCache using the Ehcache backend.&lt;br/&gt;
&lt;br/&gt;
Something that should be discussed is behavior on a failed update.  In the event of multiple EhcacheHttpCache instances updating the same cache they may trample eachothers&amp;#39; data on update.  For now we do a compare and swap update, and throw an IOException on failure.  This might be a good case to reintroduce the HttpCacheOperationException.  Having a configurable number of retries before throwing an exception is another option to explore.</comment>
                    <comment id="12898736" author="olegk" created="Sun, 15 Aug 2010 20:11:20 +0100"  >Patch checked in with some very minor tweaks to the test cases and dependency definitions. &lt;br/&gt;
&lt;br/&gt;
Throwing plain IOException definitely does not sound right. Feel free to introduce a specific exception class for failed updates.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12899925" author="cim_michajlomatijkiw" created="Wed, 18 Aug 2010 18:41:55 +0100"  >We have updated the ehcache implementation to support a disk based ehcache.  Since some members of HttpCacheEntry are not Serializable, they could only be stored in memory, and would not be able to be written to disk.&lt;br/&gt;
&lt;br/&gt;
We reintroduced the HttpCacheEntrySerializer interface and added an implementation, JSONCacheEntrySerializer.  The HttpCacheEntrySerializer interfaced is used by ehcache to serialize HttpCacheEntrys to be stored in the cache.  This interface will also be used by the memcached interface we are working on bringing to date.</comment>
                    <comment id="12899999" author="olegk" created="Wed, 18 Aug 2010 20:57:57 +0100"  >Michajlo,&lt;br/&gt;
&lt;br/&gt;
I am fine with reintroducing HttpCacheEntrySerializer but I am somewhat reluctant to introduce a dependency on jettison if it can be avoided. I think we should provide a very simple serializer based on standard java object serialization code. We should also fix HttpCacheEntry. I guess HttpCacheEntry serialization breaks due to BasicStatusLine being non-serializable. I am going to fix in HttpCore.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12900043" author="cim_michajlomatijkiw" created="Wed, 18 Aug 2010 22:25:29 +0100"  >Would it also be possible to make BasicHeader serializable?&lt;br/&gt;
&lt;br/&gt;
Thank you,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12900220" author="olegk" created="Thu, 19 Aug 2010 09:48:52 +0100"  >Already done. I&amp;#39;ll try to cut a new release of HttpCore in the coming days / weeks&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12900431" author="cim_michajlomatijkiw" created="Thu, 19 Aug 2010 21:17:22 +0100"  >This patch includes the following changes:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Bought up to date to reflect Jonathan Moore&amp;#39;s recent reorganization patch&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Reintroduction of HttpCacheEntrySerializer interface, and reintroduction/reworking of DefaultCacheEntrySerializer &lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Fixed TestEhcacheProtocolRequirements name Protcol/Protocol typo, the mispelled version should be deleted if it still exists&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Updated TestEhcacheHttpCache tests- added testCacheGetNullEntry, testCacheUpdateNullEntry, and testCacheUpdate &lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Fixed update bug&lt;br/&gt;
&lt;br/&gt;
Some notes:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- DefaultCacheEntrySerializer makes the assumption that the underlying Set implementation used to hold variants is serializable, I feel like this is a pretty safe assumption&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- It might be better practice to create a wrapper object as in intermediary for serialization in DefaultCacheEntrySerializer, but the current version should only be a temporary fix until the new httpcore is released, then we will be able to serialize HttpCacheEntry directly&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Should TestEhcacheHttpCache be renamed to TestEhcacheHttpCacheStorage?  I can update the patch to include this, but I thought it might be easier to do on your end after the problems with the Protcol/Protocol typo.&lt;br/&gt;
&lt;br/&gt;
Adding HttpCacheOperationException for failed updates is turning out to be a little more involved than I had expected, so I was planning on adding this in a later patch.&lt;br/&gt;
&lt;br/&gt;
Please let me know if there&amp;#39;s anything else you would like me to include or change.&lt;br/&gt;
&lt;br/&gt;
This patch is submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thank you,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12901090" author="olegk" created="Sat, 21 Aug 2010 21:32:49 +0100"  >Patch checked in with some changes to the exception handling code. Please review.&lt;br/&gt;
&lt;br/&gt;
For the time being I added a sub-class of IOException called HttpCacheOperationException, which can be used to signal cache operation failures. While strictly speaking HttpCacheOperationException does not represent an I/O error, I am not sure if such distinction is worth the trouble of having to propagate HttpCacheOperationException in each and every method of HttpCacheStorage and HttpCache. Feel free to suggest a more elegant solution.&lt;br/&gt;
&lt;br/&gt;
TestEhcacheHttpCache renamed to TestEhcacheHttpCacheStorage. &lt;br/&gt;
&lt;br/&gt;
Michajlo, many thanks for contributing the patch.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12901393" author="cim_michajlomatijkiw" created="Mon, 23 Aug 2010 14:31:45 +0100"  >I agree, I think extending IOException is fine for now.  I believe the eventual goal is to use the HttpCacheOperationException to trigger a configurable number of retries on update failure, so the current implementation can be reevaluated at that point if necessary.&lt;br/&gt;
&lt;br/&gt;
A quick fix, my coworker pointed out a small bug in TestHttpCacheEntrySerializers, line 86, &amp;quot;one.getAllHeaders()&amp;quot; should be &amp;quot;two.getAllHeaders()&amp;quot;.  I looked over the rest of the file and all seems good.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12902389" author="olegk" created="Wed, 25 Aug 2010 12:58:47 +0100"  >&amp;gt; I believe the eventual goal is to use the HttpCacheOperationException to trigger a configurable number of retries on update failure, &lt;br/&gt;
&amp;gt; so the current implementation can be reevaluated at that point if necessary.&lt;br/&gt;
&lt;br/&gt;
Could HttpCacheUpdateException be a better name for such exception? It could also contain a piece of information (just a Boolean attribute) indicating whether or not the failure is fatal. The consumer of HttpCacheStorage implementation could choose to catch the exception and retry the operation, if the failure is non fatal. HttpCacheUpdateException may still extend IOException for the sake of simplicity. &lt;br/&gt;
&lt;br/&gt;
&amp;gt; A quick fix, my coworker pointed out a small bug in TestHttpCacheEntrySerializers, line 86, &amp;quot;one.getAllHeaders()&amp;quot; should be &amp;quot;two.getAllHeaders()&amp;quot;. &lt;br/&gt;
&lt;br/&gt;
Fixed.&lt;br/&gt;
&lt;br/&gt;
Cheers&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
</comment>
                    <comment id="12903436" author="cim_michajlomatijkiw" created="Fri, 27 Aug 2010 15:48:10 +0100"  >I have renamed HttpCacheOperationException to HttpCacheUpdateException, and it no longer extends IOException (you will probably have to delete HttpCacheOperationException.java after applying the patch, it should be empty).  I spoke with Jonathan Moore and it was decided that this is best since the exception should never make it outside of the cache module, and without extending IOException the compiler will guarantee it.&lt;br/&gt;
&lt;br/&gt;
CacheConfig now has a field for maximum number of update retries, and after that many failed update retries, EhcacheHttpCacheStorage will throw the exception.  The exception is caught by BasicHttpCache and a warning is logged.  While a failed update is not ideal, subsequent accesses will re-validate the entry.&lt;br/&gt;
&lt;br/&gt;
The tests were also updated to verify the behavior with failed updates.&lt;br/&gt;
&lt;br/&gt;
This patch was submitted with the permission of my employer.&lt;br/&gt;
&lt;br/&gt;
Thanks,&lt;br/&gt;
Michajlo</comment>
                    <comment id="12903576" author="olegk" created="Fri, 27 Aug 2010 21:00:30 +0100"  >Patch checked in. Many thanks, Michajlo&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                    <attachments>
                    <attachment id="12453245" name="cache_update_exception.diff" size="17684" author="cim_michajlomatijkiw" created="Fri, 27 Aug 2010 15:48:10 +0100" />
                    <attachment id="12452567" name="ehcache_w_serialization3.patch" size="25069" author="cim_michajlomatijkiw" created="Thu, 19 Aug 2010 21:17:22 +0100" />
                    <attachment id="12452425" name="ehcache_w_serialization.patch" size="20435" author="cim_michajlomatijkiw" created="Wed, 18 Aug 2010 18:41:54 +0100" />
                    <attachment id="12452041" name="httpclient-cache_ehcache-patch2.patch" size="7107" author="cim_michajlomatijkiw" created="Fri, 13 Aug 2010 19:41:03 +0100" />
                    <attachment id="12451919" name="httpclient-cache_ehcache-patch.patch" size="4634" author="cim_michajlomatijkiw" created="Thu, 12 Aug 2010 17:11:15 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>5.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Wed, 11 Aug 2010 18:49:24 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133979</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47334</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>