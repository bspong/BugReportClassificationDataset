<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:13:15 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-1139/HTTPCLIENT-1139.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-1139] NTLM Authentication No Longer Working In Latest Release</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1139</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>Our application has been working fine using NTLM auth with HttpClient for 3 years.   We were most recently on 4.0.3.    Upon upgrading to 4.1.2, NTLM stopped working.&lt;br/&gt;
&lt;br/&gt;
I tried both the new for 4.1 built-in NTLM and the &amp;quot;old way&amp;quot; of using JCIFS: client.getAuthSchemes().register(&amp;quot;ntlm&amp;quot;, new NTLMSchemeFactory()); &lt;br/&gt;
&lt;br/&gt;
Using wireshark I can see that NTLM auth is not even attempted using 4.1.2.    Rolling back to 4.0.3 immediately resolved this problem.</description>
                <environment>testing on Windows x64, using SharePoint 2010 as a test server that accepts NTLM auth</environment>
            <key id="12528505">HTTPCLIENT-1139</key>
            <summary>NTLM Authentication No Longer Working In Latest Release</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png">Resolved</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="jnadler">Jeff Nadler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Oct 2011 16:42:42 +0100</created>
                <updated>Mon, 24 Oct 2011 20:43:33 +0100</updated>
                    <resolved>Mon, 24 Oct 2011 20:43:32 +0100</resolved>
                            <version>4.1.2</version>
                                <fixVersion>4.2 Alpha1</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="13134256" author="olegk" created="Mon, 24 Oct 2011 18:14:58 +0100"  >Jeff,&lt;br/&gt;
I suspect authentication fails because the server also sends a SPNEGO/kerberos challenge, which takes precedence over NTLM. If the SPNEGO auth scheme fails NTLM authentication is not attempted due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1107&quot; title=&quot;HttpClient does not retry authentication when multiple challenges are present if the primary one fails&quot;&gt;&lt;strike&gt;HTTPCLIENT-1107&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Anyway, please attach wire / context logs of both sessions (successful with 4.0.3 and unsuccessful with 4.1.2).&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="13134263" author="jnadler" created="Mon, 24 Oct 2011 18:20:17 +0100"  >That may well be the cause.   I&amp;#39;ll generate a wire log.   &lt;br/&gt;
&lt;br/&gt;
Also I should note that with 4.1.2, use of a HTTP proxy that requires NTLM auth is also broken.   Reverting to 4.0.3 fixed that problem as well.</comment>
                    <comment id="13134377" author="jnadler" created="Mon, 24 Oct 2011 20:17:57 +0100"  >I&amp;#39;ve attached the logs you requested.   </comment>
                    <comment id="13134409" author="olegk" created="Mon, 24 Oct 2011 20:42:47 +0100"  >As I suspected &lt;br/&gt;
&lt;br/&gt;
---&lt;br/&gt;
DEBUG[pool-1-thread-1] (AbstractAuthenticationHandler.java:151) - Authentication schemes in the order of preference: [negotiate, NTLM, Digest, Basic]&lt;br/&gt;
DEBUG[pool-1-thread-1] (AbstractAuthenticationHandler.java:161) - negotiate authentication scheme selected&lt;br/&gt;
DEBUG[pool-1-thread-1] (NegotiateScheme.java:316) - Received challenge &amp;#39;&amp;#39; from the auth server&lt;br/&gt;
DEBUG[pool-1-thread-1] (DefaultRequestDirector.java:1196) - Authorization challenge processed&lt;br/&gt;
DEBUG[pool-1-thread-1] (DefaultRequestDirector.java:1224) - Authentication scope: NEGOTIATE &amp;lt;any realm&amp;gt;@192.168.3.44:80&lt;br/&gt;
DEBUG[pool-1-thread-1] (DefaultRequestDirector.java:1231) - Found credentials&lt;br/&gt;
DEBUG[pool-1-thread-1] (NegotiateScheme.java:179) - init 192.168.3.44&lt;br/&gt;
ERROR[pool-1-thread-1] (RequestTargetAuthentication.java:113) - Authentication error: Invalid name provided (Mechanism level: Could not load configuration file C:\Windows\krb5.ini (The system cannot find the file specified))&lt;br/&gt;
---&lt;br/&gt;
&lt;br/&gt;
HttpClient 4.1.2 picks the SPNEGO/Kerberos auth scheme over NTLM, which apparently has not been properly set up. You basically have three options here&lt;br/&gt;
(1) Setup SPNEGO/Kerberos&lt;br/&gt;
(2) Unregister the Negotiate scheme altogether&lt;br/&gt;
(3) Modify auth scheme order of preference to make HttpClient pick NTLM over SPNEGO/Kerberos.&lt;br/&gt;
&lt;br/&gt;
Oleg&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
</comment>
                    <comment id="13134410" author="olegk" created="Mon, 24 Oct 2011 20:43:32 +0100"  >Duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1107&quot; title=&quot;HttpClient does not retry authentication when multiple challenges are present if the primary one fails&quot;&gt;&lt;strike&gt;HTTPCLIENT-1107&lt;/strike&gt;&lt;/a&gt;</comment>
                </comments>
                    <attachments>
                    <attachment id="12500519" name="HttpClient4.0.3-NTLMWire" size="10806" author="jnadler" created="Mon, 24 Oct 2011 20:17:57 +0100" />
                    <attachment id="12500520" name="HttpClient4.1.2-NTLMWire" size="7475" author="jnadler" created="Mon, 24 Oct 2011 20:17:57 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 24 Oct 2011 17:14:58 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>214366</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>46922</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>