<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:19:41 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-659/HTTPCLIENT-659.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-659] DateUtils should cache SimpleDateFormat</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-659</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>DateUtils create a SimpleDateFormat for each invocation of #formatDate and #parseDate. This can be optimized if SimpleDateFormat instances are cached. Since SimpleDateFormat is not threadsafe, the cache must be threadlocal.</description>
                <environment></environment>
            <key id="12371339">HTTPCLIENT-659</key>
            <summary>DateUtils should cache SimpleDateFormat</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="heron">Daniel M&#252;ller</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Jun 2007 14:48:48 +0100</created>
                <updated>Sun, 11 Nov 2007 19:12:06 +0000</updated>
                    <resolved>Wed, 24 Oct 2007 16:03:41 +0100</resolved>
                                            <fixVersion>4.0 Alpha 2</fixVersion>
                                <component>HttpCookie</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12503178" author="heron" created="Sun, 10 Jun 2007 14:52:10 +0100"  >the patch introduces a package locale SimpleDateFormatFactory which does cache instances of SimpleDateFormat threadlocal</comment>
                    <comment id="12503186" author="olegk" created="Sun, 10 Jun 2007 17:59:38 +0100"  >I personally tend to avoid usingthreadlocals in libraries but in this case it seems justified. If I hear no objections, I&amp;#39;ll commit the patch&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12503188" author="rolandw" created="Sun, 10 Jun 2007 18:14:17 +0100"  >If there are many threads making few calls each to this method, we are opening a memory hole. In particular since a whole map of formats is stored. Can we please wrap the map in a SoftReference to allow garbage collection?&lt;br/&gt;
&lt;br/&gt;
There is an @Override in the source code, and not inside a comment. I don&amp;#39;t know what it&amp;#39;s supposed to mean, but it is not valid Java 1.3 source.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
&lt;br/&gt;
</comment>
                    <comment id="12503200" author="olegk" created="Sun, 10 Jun 2007 20:11:26 +0100"  >&amp;gt; Can we please wrap the map in a SoftReference to allow garbage collection?&lt;br/&gt;
&lt;br/&gt;
Sounds reasonable.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12505526" author="olegk" created="Sat, 16 Jun 2007 20:18:09 +0100"  >Will deal with it post-ALPHA5.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12505591" author="heron" created="Sun, 17 Jun 2007 13:56:45 +0100"  >I searched for alternative approaches and digged up a FastDateFormat in commons.lang[1], which is fully threadsafe. Maybe http-core could use this one. I don&amp;#39;t propose to introduce commons.lang as a dependency, but simply to incorporate the FastDateFormat (partial or whole) as a util into http-core. The code has no dependencies on the rest of commons.lang (only one call to Validate).&lt;br/&gt;
&lt;br/&gt;
Just some thoughts,&lt;br/&gt;
Daniel&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;http://jakarta.apache.org/commons/lang/api/org/apache/commons/lang/time/FastDateFormat.html&quot;&gt;http://jakarta.apache.org/commons/lang/api/org/apache/commons/lang/time/FastDateFormat.html&lt;/a&gt;</comment>
                    <comment id="12505592" author="oglueck" created="Sun, 17 Jun 2007 14:02:50 +0100"  >I support the FastDateFormat approach. It solves the threadsafety problem in a much more elegant way.</comment>
                    <comment id="12505593" author="rolandw" created="Sun, 17 Jun 2007 14:16:07 +0100"  >You noticed that FastDateFormat is for formatting only, not for parsing?&lt;br/&gt;
Since this is obviously a case where multiple implementations are available and have different advantages/drawbacks, maybe it is time to define an interface and make DateUtils - in it&amp;#39;s current form - the default implementation. Optimizing static helper methods without a specified target environment is soooooo ugly.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12505594" author="heron" created="Sun, 17 Jun 2007 14:41:09 +0100"  >Yes, saw it. Unfortunately after I sent of the comment. So much for prudent investigation methods. I&amp;#39;ll have a look if I can come up with something.&lt;br/&gt;
&lt;br/&gt;
And for the specified target environment: I guess this would be parsing and formatting of the three required formats:&lt;br/&gt;
- RFC 1123 (EEE, dd MMM yyyy HH:mm:ss zzz)&lt;br/&gt;
- RFC1036 (EEEE, dd-MMM-yy HH:mm:ss zzz)&lt;br/&gt;
- ascitime() (EEE MMM d HH:mm:ss yyyy)&lt;br/&gt;
&lt;br/&gt;
Cheers,&lt;br/&gt;
Daniel</comment>
                    <comment id="12505595" author="rolandw" created="Sun, 17 Jun 2007 15:08:50 +0100"  >Hello Daniel,&lt;br/&gt;
&lt;br/&gt;
target _environment_ is...&lt;br/&gt;
a) client HTTP application, few threads, few operations -&amp;gt; current implementation is fine&lt;br/&gt;
b) server application, few threads, many operations -&amp;gt; full per-thread caching is fine&lt;br/&gt;
c) server application, many threads, few operations -&amp;gt; current implementation not so good, full caching not so good either&lt;br/&gt;
d) ....&lt;br/&gt;
&lt;br/&gt;
Within HttpCore, only formatting should be required. Date parsing is for cookies. So maybe reduce DateUtils to formatting only, based on FastDateFormat. Date parsing goes to HttpCookie and gets an interface for substituting different implementations.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;</comment>
                    <comment id="12505596" author="olegk" created="Sun, 17 Jun 2007 16:04:14 +0100"  >Folks,&lt;br/&gt;
In fact the static methods of DateUtils are not being used in HttpCore AT ALL. HttpDateGenerator imports a few static variables from DateUtils, but that is it.&lt;br/&gt;
&lt;br/&gt;
this.dateformat = new SimpleDateFormat(DateUtils.PATTERN_RFC1123, Locale.US);&lt;br/&gt;
this.dateformat.setTimeZone(DateUtils.GMT);&lt;br/&gt;
&lt;br/&gt;
(1) I suggest DateUtils gets moved to HttpClient&lt;br/&gt;
(2) I am in favor of using ThreadLocals and SoftReferences to cache DateFormatters, but will not stand in your way should you decide to &amp;#39;borrow&amp;#39; FastDateFormat from Commons Lang as long as it is not in Core&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12505597" author="rolandw" created="Sun, 17 Jun 2007 16:09:07 +0100"  >I&amp;#39;ve taken a look at FastDateFormat. It maintains several internal caches in form of static HashMaps.&lt;br/&gt;
I&amp;#39;d hate to introduce that as a default anywhere in HttpComponents.&lt;br/&gt;
&lt;br/&gt;
Moving DateUtils to HttpClient/Cookie sounds good. There we can take as many stabs at it as we want to.&lt;br/&gt;
&lt;br/&gt;
cheers,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Roland&lt;br/&gt;
</comment>
                    <comment id="12505601" author="olegk" created="Sun, 17 Jun 2007 16:56:27 +0100"  >This needs to be done before the code freeze for ALPHA5. Folks, if I hear no laud objections, I&amp;#39;ll move DateUtils to HttpCookie within the next few days.&lt;br/&gt;
&lt;br/&gt;
Oleg </comment>
                    <comment id="12535951" author="olegk" created="Thu, 18 Oct 2007 16:54:17 +0100"  >A small variation on the Daniel&amp;#39;s original patch. HashMaps containing date format instances are now softly referecned by the thread local to allow for their garbage-collection. Please review.&lt;br/&gt;
&lt;br/&gt;
If I hear no complaints, I&amp;#39;ll check in the patch in a few days.&lt;br/&gt;
&lt;br/&gt;
Oleg  &lt;br/&gt;
&amp;nbsp;</comment>
                    <comment id="12537340" author="olegk" created="Wed, 24 Oct 2007 16:03:41 +0100"  >Patch checked in&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310010">
                <name>Incorporates</name>
                                <outwardlinks description="incorporates">
                            <issuelink>
            <issuekey id="12371810">HTTPCORE-84</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12367957" name="20071018-001-dateutils.patch" size="4158" author="olegk" created="Thu, 18 Oct 2007 16:54:17 +0100" />
                    <attachment id="12359370" name="org.apache.http.util.patch" size="3399" author="heron" created="Sun, 10 Jun 2007 14:52:10 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>2.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Sun, 10 Jun 2007 16:59:38 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133698</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47838</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>