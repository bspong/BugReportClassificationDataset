<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jul 08 06:22:17 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HTTPCLIENT-929/HTTPCLIENT-929.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[HTTPCLIENT-929] Request with two forward slashes for path fails</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-929</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                        <description>The following code demonstrates the problem:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;DefaultHttpClient client = new DefaultHttpClient();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;client.execute(new HttpGet(&amp;quot;&lt;a href=&quot;http://www.google.com//&quot;&gt;http://www.google.com//&lt;/a&gt;&amp;quot;));&lt;br/&gt;
&lt;br/&gt;
When a request is made, the DefaultRequestDirector invokes rewriteRequestURI(). I don&amp;#39;t fully understand why this method does what it does. For a non-proxied request, it attempts to render the URI to a relative URI. In doing so, it tries to create a relative URI whose content is &amp;quot;//&amp;quot;. Per RFC 2396 section 5 (Relative URI References), a relative URI that begins with &amp;quot;//&amp;quot; is a network-path reference, and the &amp;quot;//&amp;quot; must be immediately followed by an authority. Therefore, while &amp;quot;&lt;a href=&quot;http://www.google.com//&quot;&gt;http://www.google.com//&lt;/a&gt;&amp;quot; is a valid absolute URI, &amp;quot;//&amp;quot; is not a valid relative one. The resulting exception:&lt;br/&gt;
&lt;br/&gt;
[...]&lt;br/&gt;
Caused by: org.apache.http.ProtocolException: Invalid URI: &lt;a href=&quot;http://www.google.com//&quot;&gt;http://www.google.com//&lt;/a&gt;&lt;br/&gt;
	at org.apache.http.impl.client.DefaultRequestDirector.rewriteRequestURI(DefaultRequestDirector.java:339)&lt;br/&gt;
	at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:434)&lt;br/&gt;
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:641)&lt;br/&gt;
	... 31 more&lt;br/&gt;
Caused by: java.net.URISyntaxException: Expected authority at index 2: //&lt;br/&gt;
	at java.net.URI$Parser.fail(URI.java:2809)&lt;br/&gt;
	at java.net.URI$Parser.failExpecting(URI.java:2815)&lt;br/&gt;
	at java.net.URI$Parser.parseHierarchical(URI.java:3063)&lt;br/&gt;
	at java.net.URI$Parser.parse(URI.java:3024)&lt;br/&gt;
	at java.net.URI.&amp;lt;init&amp;gt;(URI.java:578)&lt;br/&gt;
	at org.apache.http.client.utils.URIUtils.createURI(URIUtils.java:106)&lt;br/&gt;
	at org.apache.http.client.utils.URIUtils.rewriteURI(URIUtils.java:141)&lt;br/&gt;
	at org.apache.http.client.utils.URIUtils.rewriteURI(URIUtils.java:159)&lt;br/&gt;
	at org.apache.http.impl.client.DefaultRequestDirector.rewriteRequestURI(DefaultRequestDirector.java:333)&lt;br/&gt;
	... 33 more&lt;br/&gt;
</description>
                <environment></environment>
            <key id="12461019">HTTPCLIENT-929</key>
            <summary>Request with two forward slashes for path fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="zzantozz">Ryan Stewart</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Apr 2010 14:47:24 +0100</created>
                <updated>Wed, 2 Mar 2011 23:11:55 +0000</updated>
                    <resolved>Sat, 3 Apr 2010 19:24:18 +0100</resolved>
                            <version>4.0.1</version>
                                <fixVersion>4.1 Alpha2</fixVersion>
                                <component>HttpClient</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>0</watches>
                                                    <comments>
                    <comment id="12852923" author="olegk" created="Fri, 2 Apr 2010 20:07:26 +0100"  >&amp;gt; When a request is made, the DefaultRequestDirector invokes rewriteRequestURI(). &lt;br/&gt;
&amp;gt; I don&amp;#39;t fully understand why this method does what it does&lt;br/&gt;
&lt;br/&gt;
DefaultRequestDirector rewrites the request URI in order to comply with the requirements of the RFC 2626&lt;br/&gt;
&lt;br/&gt;
---&lt;br/&gt;
5.1.2 Request-URI&lt;br/&gt;
&lt;br/&gt;
...&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;The most common form of Request-URI is that used to identify a&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;resource on an origin server or gateway. In this case the absolute&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;path of the URI MUST be transmitted (see section 3.2.1, abs_path) as&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;the Request-URI, and the network location of the URI (authority) MUST&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;be transmitted in a Host header field. For example, a client wishing&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;to retrieve the resource above directly from the origin server would&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;create a TCP connection to port 80 of the host &amp;quot;&lt;a href=&quot;http://www.w3.org&quot;&gt;www.w3.org&lt;/a&gt;&amp;quot; and send&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;the lines:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;GET /pub/WWW/TheProject.html HTTP/1.1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Host: &lt;a href=&quot;http://www.w3.org&quot;&gt;www.w3.org&lt;/a&gt;&lt;br/&gt;
---&lt;br/&gt;
&lt;br/&gt;
The only thing that can be done about this problem is replacing multiple &amp;quot;/&amp;quot; in the abs_path with a single one.&lt;br/&gt;
&lt;br/&gt;
Would that solve the problem for you?&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12853069" author="zzantozz" created="Sat, 3 Apr 2010 04:34:57 +0100"  >Yes, I think that&amp;#39;s the right approach. The problem should only happen when the path is composed of nothing but two or more slashes, but it should also be safe to replace any series of multiple slashes with a single one. Alternately, while I was looking into it, I discovered that URI has a relativize method that works like so: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;URI uri1 = URI.create(&amp;quot;&lt;a href=&quot;http://www.google.com/foo&quot;&gt;http://www.google.com/foo&lt;/a&gt;&amp;quot;); &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;URI uri2 = URI.create(&amp;quot;&lt;a href=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt;&amp;quot;).relativize(uri1); &lt;br/&gt;
&lt;br/&gt;
Final content of uri2: path=&amp;quot;foo&amp;quot;. When you tell it to relativize &amp;quot;&lt;a href=&quot;http://www.google.com//&quot;&gt;http://www.google.com//&lt;/a&gt;&amp;quot;, you get an empty URI, which is accurate. Could you just use this instead of reconstructing the URI manually?</comment>
                    <comment id="12853176" author="olegk" created="Sat, 3 Apr 2010 19:24:18 +0100"  >Fixed in SVN trunk&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=930558&amp;view=rev&quot;&gt;http://svn.apache.org/viewvc?rev=930558&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I looked at #relativize method but felt it was an overkill. I opted for a simpler and likely faster custom routine. Please review.&lt;br/&gt;
&lt;br/&gt;
Oleg</comment>
                    <comment id="12853213" author="zzantozz" created="Sun, 4 Apr 2010 03:15:49 +0100"  >The change looks good. I built the latest SVN trunk, and it runs the test case above without problem.</comment>
                    <comment id="13001748" author="angus.ng" created="Wed, 2 Mar 2011 23:07:58 +0000"  >I am using httpclient 4.1. I had a problem with this fix. In DefaultRequestDirector.rewriteRequestURI method, for non-proxied URI and when it is a absolute URI, it will call the URIUtils.rewriteURI, which then take the &amp;quot;RawPath&amp;quot; from an uri and normalize it. So when I pass an uri, for example, &lt;a href=&quot;http://www.whatever.com/1//3,&quot;&gt;http://www.whatever.com/1//3,&lt;/a&gt; it will automatically remove the extra slash and become &lt;a href=&quot;http://www.whatever.com/1/3&quot;&gt;http://www.whatever.com/1/3&lt;/a&gt;. I&amp;#39;ve got a REStful service to accept the uri (/{param1}/{param2}/{param3}) and it takes when there is an empty value past in. Now because of the auto slash removal, the &amp;quot;3&amp;quot; value shift left for a position and match to the {param2}. I wouldn&amp;#39;t say the above solution is wrong, but I guess it should not change what value that user pass in.</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="10030">
                <name>Reference</name>
                                <outwardlinks description="relates to">
                            <issuelink>
            <issuekey id="12500252">HTTPCLIENT-1066</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>0.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Fri, 2 Apr 2010 19:07:26 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>133935</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>47041</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>